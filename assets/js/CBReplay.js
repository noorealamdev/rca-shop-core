/*
 Sizzle CSS Selector Engine
 Copyright 2012 JQXLite Foundation and other contributors
 Released under the MIT license
 http://sizzlejs.com/
 @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js  localForage -- Offline Storage, Improved
    Version 1.7.3
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
  _noScroll &&  this.dirty || forceDraw this.notaResized[n]*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(d){var b=0;return function(){return b<d.length?{done:!1,value:d[b++]}:{done:!0}}};$jscomp.arrayIterator=function(d){return{next:$jscomp.arrayIteratorImpl(d)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,b,c){d!=Array.prototype&&d!=Object.prototype&&(d[b]=c.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(d,b){this.$jscomp$symbol$id_=d;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function d(c){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return d}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.asyncIterator;d||(d=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};
$jscomp.makeIterator=function(d){var b="undefined"!=typeof Symbol&&Symbol.iterator&&d[Symbol.iterator];return b?b.call(d):$jscomp.arrayIterator(d)};$jscomp.polyfill=function(d,b,c,e){if(b){c=$jscomp.global;d=d.split(".");for(e=0;e<d.length-1;e++){var f=d[e];f in c||(c[f]={});c=c[f]}d=d[d.length-1];e=c[d];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,d,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(d){function b(){this.batch_=null}function c(b){return b instanceof f?b:new f(function(e,c){e(b)})}if(d&&!$jscomp.FORCE_POLYFILL_PROMISE)return d;b.prototype.asyncExecute=function(b){if(null==this.batch_){this.batch_=[];var e=this;this.asyncExecuteFunction(function(){e.executeBatch_()})}this.batch_.push(b)};var e=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(b){e(b,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var b=
    this.batch_;this.batch_=[];for(var e=0;e<b.length;++e){var c=b[e];b[e]=null;try{c()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};b.prototype.asyncThrow_=function(b){this.asyncExecuteFunction(function(){throw b;})};var f=function(b){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var e=this.createResolveAndReject_();try{b(e.resolve,e.reject)}catch(l){e.reject(l)}};f.prototype.createResolveAndReject_=function(){function b(b){return function(f){c||(c=!0,b.call(e,f))}}var e=this,c=!1;
    return{resolve:b(this.resolveTo_),reject:b(this.reject_)}};f.prototype.resolveTo_=function(b){if(b===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof f)this.settleSameAsPromise_(b);else{a:switch(typeof b){case "object":var e=null!=b;break a;case "function":e=!0;break a;default:e=!1}e?this.resolveToNonPromiseObj_(b):this.fulfill_(b)}};f.prototype.resolveToNonPromiseObj_=function(b){var e=void 0;try{e=b.then}catch(l){this.reject_(l);return}"function"==typeof e?
    this.settleSameAsThenable_(e,b):this.fulfill_(b)};f.prototype.reject_=function(b){this.settle_(2,b)};f.prototype.fulfill_=function(b){this.settle_(1,b)};f.prototype.settle_=function(b,e){if(0!=this.state_)throw Error("Cannot settle("+b+", "+e+"): Promise already settled in state"+this.state_);this.state_=b;this.result_=e;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var b=0;b<this.onSettledCallbacks_.length;++b)g.asyncExecute(this.onSettledCallbacks_[b]);
    this.onSettledCallbacks_=null}};var g=new b;f.prototype.settleSameAsPromise_=function(b){var e=this.createResolveAndReject_();b.callWhenSettled_(e.resolve,e.reject)};f.prototype.settleSameAsThenable_=function(b,e){var c=this.createResolveAndReject_();try{b.call(e,c.resolve,c.reject)}catch(m){c.reject(m)}};f.prototype.then=function(b,e){function c(b,e){return"function"==typeof b?function(e){try{d(b(e))}catch(u){g(u)}}:e}var d,g,h=new f(function(b,e){d=b;g=e});this.callWhenSettled_(c(b,d),c(e,g));return h};
    f.prototype.catch=function(b){return this.then(void 0,b)};f.prototype.callWhenSettled_=function(b,e){function c(){switch(f.state_){case 1:b(f.result_);break;case 2:e(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?g.asyncExecute(c):this.onSettledCallbacks_.push(c)};f.resolve=c;f.reject=function(b){return new f(function(e,c){c(b)})};f.race=function(b){return new f(function(e,f){for(var d=$jscomp.makeIterator(b),g=d.next();!g.done;g=d.next())c(g.value).callWhenSettled_(e,
        f)})};f.all=function(b){var e=$jscomp.makeIterator(b),d=e.next();return d.done?c([]):new f(function(b,f){function g(e){return function(c){h[e]=c;k--;0==k&&b(h)}}var h=[],k=0;do h.push(void 0),k++,c(d.value).callWhenSettled_(g(h.length-1),f),d=e.next();while(!d.done)})};return f},"es6","es3");$jscomp.underscoreProtoCanBeSet=function(){var d={a:!0},b={};try{return b.__proto__=d,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(d,b){d.__proto__=b;if(d.__proto__!==b)throw new TypeError(d+" is not extensible");return d}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(d){if(!(d instanceof Object))throw new TypeError("Iterator result "+d+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(d){this.yieldResult=d};$jscomp.generator.Context.prototype.throw_=function(d){this.abruptCompletion_={exception:d,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(d){this.abruptCompletion_={return:d};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(d){this.abruptCompletion_={jumpTo:d};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(d,b){this.nextAddress=b;return{value:d}};$jscomp.generator.Context.prototype.yieldAll=function(d,b){d=$jscomp.makeIterator(d);var c=d.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=d,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(d){this.nextAddress=d};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(d,b){this.catchAddress_=d;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(d){this.catchAddress_=0;this.finallyAddress_=d||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(d,b){this.nextAddress=d;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(d){this.catchAddress_=d||0;d=this.abruptCompletion_.exception;this.abruptCompletion_=null;return d};$jscomp.generator.Context.prototype.enterFinallyBlock=function(d,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=d||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(d,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=d};$jscomp.generator.Context.prototype.forIn=function(d){return new $jscomp.generator.Context.PropertyIterator(d)};
$jscomp.generator.Context.PropertyIterator=function(d){this.object_=d;this.properties_=[];for(var b in d)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var d=this.properties_.pop();if(d in this.object_)return d}return null};$jscomp.generator.Engine_=function(d){this.context_=new $jscomp.generator.Context;this.program_=d};
$jscomp.generator.Engine_.prototype.next_=function(d){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,d,this.context_.next_);this.context_.next_(d);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(d){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(b){return{value:b,done:!0}},d,this.context_.return);this.context_.return(d);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(d){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],d,this.context_.next_);this.context_.throw_(d);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(d,b,c){try{var e=d.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(e);if(!e.done)return this.context_.stop_(),e;var f=e.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var d=this.program_(this.context_);if(d)return this.context_.stop_(),{value:d.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){d=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(d.isException)throw d.exception;return{value:d.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(d){this.next=function(b){return d.next_(b)};this.throw=function(b){return d.throw_(b)};this.return=function(b){return d.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(d,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,d.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(d){function b(b){return d.next(b)}function c(b){return d.throw(b)}return new Promise(function(e,f){function g(d){d.done?e(d.value):Promise.resolve(d.value).then(b,c).then(g,f)}g(d.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(d){return $jscomp.asyncExecutePromiseGenerator(d())};$jscomp.asyncExecutePromiseGeneratorProgram=function(d){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(d)))};
$jscomp.findInternal=function(d,b,c){d instanceof String&&(d=String(d));for(var e=d.length,f=0;f<e;f++){var g=d[f];if(b.call(c,g,f,d))return{i:f,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");
$jscomp.checkStringArgs=function(d,b,c){if(null==d)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return d+""};
$jscomp.polyfill("String.prototype.startsWith",function(d){return d?d:function(b,c){var e=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var f=e.length,d=b.length;c=Math.max(0,Math.min(c|0,e.length));for(var h=0;h<d&&c<f;)if(e[c++]!=b[h++])return!1;return h>=d}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(d){return d?d:function(b,c){var e=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=e.length);c=Math.max(0,Math.min(c|0,e.length));for(var f=b.length;0<f&&0<c;)if(e[--c]!=b[--f])return!1;return 0>=f}},"es6","es3");
$jscomp.iteratorFromArray=function(d,b){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var c=0,e={next:function(){if(c<d.length){var f=c++;return{value:b(f,d[f]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(d){return d?d:function(b,c,e){var f=this.length||0;0>c&&(c=Math.max(0,f+c));if(null==e||e>f)e=f;e=Number(e);0>e&&(e=Math.max(0,f+e));for(c=Number(c||0);c<e;c++)this[c]=b;return this}},"es6","es3");$jscomp.polyfill("Object.setPrototypeOf",function(d){return d||$jscomp.setPrototypeOf},"es6","es5");$jscomp.polyfill("Array.prototype.findIndex",function(d){return d?d:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");
$jscomp.polyfill("Array.prototype.entries",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(b,c){return[b,c]})}},"es6","es3");
(function(d,b,c){function e(e,c){e=b(e);e.data("JSGrid",this);this._container=e;this.data=[];this.fields=[];this._sortField=this._editingRow=null;this._sortOrder="asc";this._firstDisplayingPage=1;this._init(c);this.render()}var f=function(e,c){return b.isFunction(e)?e.apply(c,b.makeArray(arguments).slice(2)):e},g=function(e){var c=b.Deferred();e&&e.then?e.then(function(){c.resolve.apply(c,arguments)},function(){c.reject.apply(c,arguments)}):c.resolve(e);return c.promise()},h={loadData:b.noop,insertItem:b.noop,
    updateItem:b.noop,deleteItem:b.noop};e.prototype={width:"auto",height:"auto",updateOnResize:!0,rowClass:b.noop,rowRenderer:null,rowClick:function(e){this.editing&&this.editItem(b(e.event.target).closest("tr"))},rowDoubleClick:b.noop,noDataContent:"Not found",noDataRowClass:"jsgrid-nodata-row",heading:!0,headerRowRenderer:null,headerRowClass:"jsgrid-header-row",headerCellClass:"jsgrid-header-cell",filtering:!1,filterRowRenderer:null,filterRowClass:"jsgrid-filter-row",inserting:!1,insertRowRenderer:null,
    insertRowClass:"jsgrid-insert-row",editing:!1,editRowRenderer:null,editRowClass:"jsgrid-edit-row",confirmDeleting:!0,deleteConfirm:"Are you sure?",selecting:!0,selectedRowClass:"jsgrid-selected-row",oddRowClass:"jsgrid-row",evenRowClass:"jsgrid-alt-row",cellClass:"jsgrid-cell",sorting:!1,sortableClass:"jsgrid-header-sortable",sortAscClass:"jsgrid-header-sort jsgrid-header-sort-asc",sortDescClass:"jsgrid-header-sort jsgrid-header-sort-desc",paging:!1,pagerContainer:null,pageIndex:1,pageSize:20,pageButtonCount:15,
    pagerFormat:"Pages: {first} {prev} {pages} {next} {last} &nbsp;&nbsp; {pageIndex} of {pageCount}",pagePrevText:"Prev",pageNextText:"Next",pageFirstText:"First",pageLastText:"Last",pageNavigatorNextText:"...",pageNavigatorPrevText:"...",pagerContainerClass:"jsgrid-pager-container",pagerClass:"jsgrid-pager",pagerNavButtonClass:"jsgrid-pager-nav-button",pagerNavButtonInactiveClass:"jsgrid-pager-nav-inactive-button",pageClass:"jsgrid-pager-page",currentPageClass:"jsgrid-pager-current-page",customLoading:!1,
    pageLoading:!1,autoload:!1,controller:h,loadIndication:!0,loadIndicationDelay:500,loadMessage:"Please, wait...",loadShading:!0,invalidMessage:"Invalid data entered!",invalidNotify:function(e){e=b.map(e.errors,function(b){return b.message||null});d.alert([this.invalidMessage].concat(e).join("\n"))},onInit:b.noop,onRefreshing:b.noop,onRefreshed:b.noop,onPageChanged:b.noop,onItemDeleting:b.noop,onItemDeleted:b.noop,onItemInserting:b.noop,onItemInserted:b.noop,onItemEditing:b.noop,onItemUpdating:b.noop,
    onItemUpdated:b.noop,onItemInvalid:b.noop,onDataLoading:b.noop,onDataLoaded:b.noop,onOptionChanging:b.noop,onOptionChanged:b.noop,onError:b.noop,invalidClass:"jsgrid-invalid",containerClass:"jsgrid",tableClass:"jsgrid-table",gridHeaderClass:"jsgrid-grid-header",gridBodyClass:"jsgrid-grid-body",_init:function(e){b.extend(this,e);this._initLoadStrategy();this._initController();this._initFields();this._attachWindowLoadResize();this._attachWindowResizeCallback();this._callEventHandler(this.onInit)},loadStrategy:function(){return this.pageLoading?
        new jsGrid.loadStrategies.PageLoadingStrategy(this):new jsGrid.loadStrategies.DirectLoadingStrategy(this)},_initLoadStrategy:function(){this._loadStrategy=f(this.loadStrategy,this)},_initController:function(){this._controller=b.extend({},h,f(this.controller,this))},renderTemplate:function(b,e,d){args=[];for(var g in d)args.push(d[g]);args.unshift(b,e);b=f.apply(null,args);return b===c||null===b?"":b},loadIndicator:function(b){return new jsGrid.LoadIndicator(b)},validation:function(b){return jsGrid.Validation&&
        new jsGrid.Validation(b)},_initFields:function(){var e=this;e.fields=b.map(e.fields,function(c){b.isPlainObject(c)&&(c=new (c.type&&jsGrid.fields[c.type]||jsGrid.Field)(c));c._grid=e;return c})},_attachWindowLoadResize:function(){b(d).on("load",b.proxy(this._refreshSize,this))},_attachWindowResizeCallback:function(){if(this.updateOnResize)b(d).on("resize",b.proxy(this._refreshSize,this))},_detachWindowResizeCallback:function(){b(d).off("resize",this._refreshSize)},option:function(b,e){if(1===arguments.length)return this[b];
        var c={option:b,oldValue:this[b],newValue:e};this._callEventHandler(this.onOptionChanging,c);this._handleOptionChange(c.option,c.newValue);this._callEventHandler(this.onOptionChanged,{option:c.option,value:c.newValue})},fieldOption:function(b,e,c){b=this._normalizeField(b);if(2===arguments.length)return b[e];b[e]=c;this._renderGrid()},_handleOptionChange:function(b,e){this[b]=e;switch(b){case "width":case "height":this._refreshSize();break;case "rowClass":case "rowRenderer":case "rowClick":case "rowDoubleClick":case "noDataRowClass":case "noDataContent":case "selecting":case "selectedRowClass":case "oddRowClass":case "evenRowClass":this._refreshContent();
        break;case "pageButtonCount":case "pagerFormat":case "pagePrevText":case "pageNextText":case "pageFirstText":case "pageLastText":case "pageNavigatorNextText":case "pageNavigatorPrevText":case "pagerClass":case "pagerNavButtonClass":case "pageClass":case "currentPageClass":case "pagerRenderer":this._refreshPager();break;case "fields":this._initFields();this.render();break;case "data":case "editing":case "heading":case "filtering":case "inserting":case "paging":this.refresh();break;case "loadStrategy":case "pageLoading":this._initLoadStrategy();
        this.search();break;case "pageIndex":this.openPage(e);break;case "pageSize":this.refresh();this.search();break;case "editRowRenderer":case "editRowClass":this.cancelEdit();break;case "updateOnResize":this._detachWindowResizeCallback();this._attachWindowResizeCallback();break;case "invalidNotify":case "invalidMessage":break;default:this.render()}},destroy:function(){this._detachWindowResizeCallback();this._clear();this._container.removeData("JSGrid")},render:function(){this._renderGrid();return this.autoload?
        this.loadData():b.Deferred().resolve().promise()},_renderGrid:function(){this._clear();this._container.addClass(this.containerClass).css("position","relative").append(this._createHeader()).append(this._createBody());this._pagerContainer=this._createPagerContainer();this._loadIndicator=this._createLoadIndicator();this._validation=this._createValidation();this.refresh()},_createLoadIndicator:function(){return f(this.loadIndicator,this,{message:this.loadMessage,shading:this.loadShading,container:this._container})},
    _createValidation:function(){return f(this.validation,this)},_clear:function(){this.cancelEdit();clearTimeout(this._loadingTimer);this._pagerContainer&&this._pagerContainer.empty();this._container.empty().css({position:"",width:"",height:""})},_createHeader:function(){var e=this._headerRow=this._createHeaderRow(),c=this._filterRow=this._createFilterRow(),f=this._insertRow=this._createInsertRow();e=this._headerGrid=b("<table>").addClass(this.tableClass).append(e).append(c).append(f);return this._header=
        b("<div>").addClass(this.gridHeaderClass).addClass(this._scrollBarWidth()?"jsgrid-header-scrollbar":"").append(e)},_createBody:function(){var e=this._content=b("<tbody>");e=this._bodyGrid=b("<table>").addClass(this.tableClass).append(e);return this._body=b("<div>").addClass(this.gridBodyClass).append(e).on("scroll",b.proxy(function(b){this._header.scrollLeft(b.target.scrollLeft)},this))},_createPagerContainer:function(){var e=this.pagerContainer||b("<div>").appendTo(this._container);return b(e).addClass(this.pagerContainerClass)},
    _eachField:function(e){var c=this;b.each(this.fields,function(b,f){f.visible&&e.call(c,f,b)})},_createHeaderRow:function(){if(b.isFunction(this.headerRowRenderer))return b(this.renderTemplate(this.headerRowRenderer,this));var e=b("<tr>").addClass(this.headerRowClass);this._eachField(function(c,f){var d=this._prepareCell("<th>",c,"headercss",this.headerCellClass).append(this.renderTemplate(c.headerTemplate,c)).appendTo(e);if(this.sorting&&c.sorting)d.addClass(this.sortableClass).on("click",b.proxy(function(){this.sort(f)},
        this))});return e},_prepareCell:function(e,c,f,d){return b(e).css("width",c.width).addClass(d||this.cellClass).addClass(f&&c[f]||c.css).addClass(c.align?"jsgrid-align-"+c.align:"")},_createFilterRow:function(){if(b.isFunction(this.filterRowRenderer))return b(this.renderTemplate(this.filterRowRenderer,this));var e=b("<tr>").addClass(this.filterRowClass);this._eachField(function(b){this._prepareCell("<td>",b,"filtercss").append(this.renderTemplate(b.filterTemplate,b)).appendTo(e)});return e},_createInsertRow:function(){if(b.isFunction(this.insertRowRenderer))return b(this.renderTemplate(this.insertRowRenderer,
        this));var e=b("<tr>").addClass(this.insertRowClass);this._eachField(function(b){this._prepareCell("<td>",b,"insertcss").append(this.renderTemplate(b.insertTemplate,b)).appendTo(e)});return e},_callEventHandler:function(e,c){e.call(this,b.extend(c,{grid:this}));return c},reset:function(){this._resetSorting();this._resetPager();return this._loadStrategy.reset()},_resetPager:function(){this._firstDisplayingPage=1;this._setPage(1)},_resetSorting:function(){this._sortField=null;this._sortOrder="asc";
        this._clearSortingCss()},refresh:function(){this._callEventHandler(this.onRefreshing);this.cancelEdit();this._refreshHeading();this._refreshFiltering();this._refreshInserting();this._refreshContent();this._refreshPager();this._refreshSize();this._callEventHandler(this.onRefreshed)},_refreshHeading:function(){this._headerRow.toggle(this.heading)},_refreshFiltering:function(){this._filterRow.toggle(this.filtering)},_refreshInserting:function(){this._insertRow.toggle(this.inserting)},_refreshContent:function(){var b=
        this._content;b.empty();if(!this.data.length)return b.append(this._createNoDataRow()),this;for(var e=this._loadStrategy.firstDisplayIndex(),c=this._loadStrategy.lastDisplayIndex();e<c;e++)b.append(this._createRow(this.data[e],e))},_createNoDataRow:function(){var e=0;this._eachField(function(){e++});return b("<tr>").addClass(this.noDataRowClass).append(b("<td>").addClass(this.cellClass).attr("colspan",e).append(this.renderTemplate(this.noDataContent,this)))},_createRow:function(e,c){if(b.isFunction(this.rowRenderer))var f=
        this.renderTemplate(this.rowRenderer,this,{item:e,itemIndex:c});else f=b("<tr>"),this._renderCells(f,e);f.addClass(this._getRowClasses(e,c)).data("JSGridItem",e).on("click",b.proxy(function(b){this.rowClick({item:e,itemIndex:c,event:b})},this)).on("dblclick",b.proxy(function(b){this.rowDoubleClick({item:e,itemIndex:c,event:b})},this));this.selecting&&this._attachRowHover(f);return f},_getRowClasses:function(b,e){var c=[];c.push((e+1)%2?this.oddRowClass:this.evenRowClass);c.push(f(this.rowClass,this,
        b,e));return c.join(" ")},_attachRowHover:function(e){var c=this.selectedRowClass;e.hover(function(){b(this).addClass(c)},function(){b(this).removeClass(c)})},_renderCells:function(b,e){this._eachField(function(c){b.append(this._createCell(e,c))});return this},_createCell:function(e,c){var f=this._getItemFieldValue(e,c);e={value:f,item:e};f=b.isFunction(c.cellRenderer)?this.renderTemplate(c.cellRenderer,c,e):b("<td>").append(this.renderTemplate(c.itemTemplate||f,c,e));return this._prepareCell(f,c)},
    _getItemFieldValue:function(b,e){e=e.name.split(".");for(b=b[e.shift()];b&&e.length;)b=b[e.shift()];return b},_setItemFieldValue:function(b,e,c){e=e.name.split(".");for(var f=b,d=e[0];f&&e.length;)b=f,d=e.shift(),f=b[d];if(!f)for(;e.length;)b=b[d]={},d=e.shift();b[d]=c},sort:function(e,c){b.isPlainObject(e)&&(c=e.order,e=e.field);this._clearSortingCss();this._setSortingParams(e,c);this._setSortingCss();return this._loadStrategy.sort()},_clearSortingCss:function(){this._headerRow.find("th").removeClass(this.sortAscClass).removeClass(this.sortDescClass)},
    _setSortingParams:function(b,e){b=this._normalizeField(b);e=e||(this._sortField===b?this._reversedSortOrder(this._sortOrder):"asc");this._sortField=b;this._sortOrder=e},_normalizeField:function(e){return b.isNumeric(e)?this.fields[e]:"string"===typeof e?b.grep(this.fields,function(b){return b.name===e})[0]:e},_reversedSortOrder:function(b){return"asc"===b?"desc":"asc"},_setSortingCss:function(){var b=this._visibleFieldIndex(this._sortField);this._headerRow.find("th").eq(b).addClass("asc"===this._sortOrder?
        this.sortAscClass:this.sortDescClass)},_visibleFieldIndex:function(e){return b.inArray(e,b.grep(this.fields,function(b){return b.visible}))},_sortData:function(){var b=this._sortFactor(),e=this._sortField;e&&this.data.sort(function(c,f){return b*e.sortingFunc(c[e.name],f[e.name])})},_sortFactor:function(){return"asc"===this._sortOrder?1:-1},_itemsCount:function(){return this._loadStrategy.itemsCount()},_pagesCount:function(){var b=this._itemsCount(),e=this.pageSize;return Math.floor(b/e)+(b%e?1:0)},
    _refreshPager:function(){var b=this._pagerContainer;b.empty();this.paging&&b.append(this._createPager());var e=this.paging&&1<this._pagesCount();b.toggle(e)},_createPager:function(){var e=b.isFunction(this.pagerRenderer)?b(this.pagerRenderer({pageIndex:this.pageIndex,pageCount:this._pagesCount()})):b("<div>").append(this._createPagerByFormat());e.addClass(this.pagerClass);return e},_createPagerByFormat:function(){var e=this.pageIndex,c=this._pagesCount(),f=this._itemsCount(),d=this.pagerFormat.split(" ");
        return b.map(d,b.proxy(function(d){var g=d;"{pages}"===d?g=this._createPages():"{first}"===d?g=this._createPagerNavButton(this.pageFirstText,1,1<e):"{prev}"===d?g=this._createPagerNavButton(this.pagePrevText,e-1,1<e):"{next}"===d?g=this._createPagerNavButton(this.pageNextText,e+1,e<c):"{last}"===d?g=this._createPagerNavButton(this.pageLastText,c,e<c):"{pageIndex}"===d?g=e:"{pageCount}"===d?g=c:"{itemCount}"===d&&(g=f);return b.isArray(g)?g.concat([" "]):[g," "]},this))},_createPages:function(){var b=
        this._pagesCount(),e=this.pageButtonCount,c=this._firstDisplayingPage,f=[];1<c&&f.push(this._createPagerPageNavButton(this.pageNavigatorPrevText,this.showPrevPages));for(var d=0,g=c;d<e&&g<=b;d++,g++)f.push(g===this.pageIndex?this._createPagerCurrentPage():this._createPagerPage(g));c+e-1<b&&f.push(this._createPagerPageNavButton(this.pageNavigatorNextText,this.showNextPages));return f},_createPagerNavButton:function(e,c,f){return this._createPagerButton(e,this.pagerNavButtonClass+(f?"":" "+this.pagerNavButtonInactiveClass),
        f?function(){this.openPage(c)}:b.noop)},_createPagerPageNavButton:function(b,e){return this._createPagerButton(b,this.pagerNavButtonClass,e)},_createPagerPage:function(b){return this._createPagerButton(b,this.pageClass,function(){this.openPage(b)})},_createPagerButton:function(e,c,f){e=b("<a>").attr("href","javascript:void(0);").html(e).on("click",b.proxy(f,this));return b("<span>").addClass(c).append(e)},_createPagerCurrentPage:function(){return b("<span>").addClass(this.pageClass).addClass(this.currentPageClass).text(this.pageIndex)},
    _refreshSize:function(){this._refreshHeight();this._refreshWidth()},_refreshWidth:function(){var b=this._headerGrid,e=this._bodyGrid,c=this.width;"auto"===c&&(b.width("auto"),c=b.outerWidth());b.width("");e.width("");this._container.width(c);c=b.outerWidth();e.width(c)},_scrollBarWidth:function(){var e;return function(){if(e===c){var f=b("<div style='width:50px;height:50px;overflow:hidden;position:absolute;top:-10000px;left:-10000px;'></div>"),d=b("<div style='height:100px;'></div>");f.append(d).appendTo("body");
        var g=d.innerWidth();f.css("overflow-y","auto");d=d.innerWidth();f.remove();e=g-d}return e}}(),_refreshHeight:function(){var b=this._container,e=this._pagerContainer,c=this.height;b.height(c);if("auto"!==c){c=b.height();var f=this._header.outerHeight(!0);e.parents(b).length&&(f+=e.outerHeight(!0));this._body.outerHeight(c-f)}},showPrevPages:function(){var b=this._firstDisplayingPage,e=this.pageButtonCount;this._firstDisplayingPage=b>e?b-e:1;this._refreshPager()},showNextPages:function(){var b=this._firstDisplayingPage,
        e=this.pageButtonCount,c=this._pagesCount();this._firstDisplayingPage=b+2*e>c?c-e+1:b+e;this._refreshPager()},openPage:function(b){1>b||b>this._pagesCount()||(this._setPage(b),this._loadStrategy.openPage(b))},_setPage:function(b){var e=this._firstDisplayingPage,c=this.pageButtonCount;this.pageIndex=b;b<e&&(this._firstDisplayingPage=b);b>e+c-1&&(this._firstDisplayingPage=b-c+1);this._callEventHandler(this.onPageChanged,{pageIndex:b})},_controllerCall:function(e,c,f,d){if(f)return b.Deferred().reject().promise();
        this._showLoading();f=this._controller;if(!f||!f[e])throw Error("controller has no method '"+e+"'");return g(f[e](c)).done(b.proxy(d,this)).fail(b.proxy(this._errorHandler,this)).always(b.proxy(this._hideLoading,this))},_errorHandler:function(){this._callEventHandler(this.onError,{args:b.makeArray(arguments)})},_showLoading:function(){this.loadIndication&&(clearTimeout(this._loadingTimer),this._loadingTimer=setTimeout(b.proxy(function(){this._loadIndicator.show()},this),this.loadIndicationDelay))},
    _hideLoading:function(){this.loadIndication&&(clearTimeout(this._loadingTimer),this._loadIndicator.hide())},search:function(b){this._resetSorting();this._resetPager();return this.loadData(b)},loadData:function(e){e=e||(this.filtering?this.getFilter():{});b.extend(e,this._loadStrategy.loadParams(),this._sortingParams());var c=this._callEventHandler(this.onDataLoading,{filter:e});return this._controllerCall("loadData",e,c.cancel,function(b){b&&(this._loadStrategy.finishLoad(b),this._callEventHandler(this.onDataLoaded,
        {data:b}))})},getFilter:function(){var b={};this._eachField(function(e){e.filtering&&this._setItemFieldValue(b,e,e.filterValue())});return b},_sortingParams:function(){return this.sorting&&this._sortField?{sortField:this._sortField.name,sortOrder:this._sortOrder}:{}},getSorting:function(){var b=this._sortingParams();return{field:b.sortField,order:b.sortOrder}},clearFilter:function(){var b=this._createFilterRow();this._filterRow.replaceWith(b);this._filterRow=b;return this.search()},insertItem:function(e){var c=
        e||this._getValidatedInsertItem();if(!c)return b.Deferred().reject().promise();e=this._callEventHandler(this.onItemInserting,{item:c});return this._controllerCall("insertItem",c,e.cancel,function(b){b=b||c;this._loadStrategy.finishInsert(b);this._callEventHandler(this.onItemInserted,{item:b})})},_getValidatedInsertItem:function(){var b=this._getInsertItem();return this._validateItem(b,this._insertRow)?b:null},_getInsertItem:function(){var b={};this._eachField(function(e){e.inserting&&this._setItemFieldValue(b,
        e,e.insertValue())});return b},_validateItem:function(e,f){var d=[],g={item:e,itemIndex:this._rowIndex(f),row:f};this._eachField(function(h){if(h.validate){var k=this._getItemFieldValue(e,h);k!==c&&(k=this._validation.validate(b.extend({value:k,rules:h.validate},g)),this._setCellValidity(f.children().eq(this._visibleFieldIndex(h)),k),k.length&&d.push.apply(d,b.map(k,function(b){return{field:h,message:b}})))}});if(!d.length)return!0;var h=b.extend({errors:d},g);this._callEventHandler(this.onItemInvalid,
        h);this.invalidNotify(h);return!1},_setCellValidity:function(b,e){b.toggleClass(this.invalidClass,!!e.length).attr("title",e.join("\n"))},clearInsert:function(){var b=this._createInsertRow();this._insertRow.replaceWith(b);this._insertRow=b;this.refresh()},editItem:function(b){b=this.rowByItem(b);b.length&&this._editRow(b)},rowByItem:function(e){return e.jquery||e.nodeType?b(e):this._content.find("tr").filter(function(){return b.data(this,"JSGridItem")===e})},_editRow:function(b){if(this.editing){var e=
        b.data("JSGridItem");this._callEventHandler(this.onItemEditing,{row:b,item:e,itemIndex:this._itemIndex(e)}).cancel||(this._editingRow&&this.cancelEdit(),e=this._createEditRow(e),this._editingRow=b,b.hide(),e.insertBefore(b),b.data("JSGridEditRow",e))}},_createEditRow:function(e){if(b.isFunction(this.editRowRenderer))return b(this.renderTemplate(field.editRowRenderer,field,{item:e,itemIndex:this._itemIndex(e)}));var c=b("<tr>").addClass(this.editRowClass);this._eachField(function(b){var f=this._getItemFieldValue(e,
        b);this._prepareCell("<td>",b,"editcss").append(this.renderTemplate(b.editTemplate||"",b,{value:f,item:e})).appendTo(c)});return c},updateItem:function(b,e){1===arguments.length&&(e=b);var c=b?this.rowByItem(b):this._editingRow;if(e=e||this._getValidatedEditedItem())return this._updateRow(c,e)},_getValidatedEditedItem:function(){var b=this._getEditedItem();return this._validateItem(b,this._getEditRow())?b:null},_updateRow:function(e,c){var f=e.data("JSGridItem"),d=this._itemIndex(f),g=b.extend(!0,
        {},f);b.extend(!0,f,c);c=this._callEventHandler(this.onItemUpdating,{row:e,item:f,itemIndex:d,previousItem:g});return this._controllerCall("updateItem",f,c.cancel,function(b){b=b||f;var c=this._finishUpdate(e,b,d);this._callEventHandler(this.onItemUpdated,{row:c,item:b,itemIndex:d,previousItem:g})})},_rowIndex:function(e){return this._content.children().index(b(e))},_itemIndex:function(e){return b.inArray(e,this.data)},_finishUpdate:function(b,e,c){this.cancelEdit();this.data[c]=e;e=this._createRow(e,
        c);b.replaceWith(e);return e},_getEditedItem:function(){var b={};this._eachField(function(e){e.editing&&this._setItemFieldValue(b,e,e.editValue())});return b},cancelEdit:function(){this._editingRow&&(this._getEditRow().remove(),this._editingRow.show(),this._editingRow=null)},_getEditRow:function(){return this._editingRow.data("JSGridEditRow")},deleteItem:function(b){b=this.rowByItem(b);if(b.length&&(!this.confirmDeleting||d.confirm(f(this.deleteConfirm,this,b.data("JSGridItem")))))return this._deleteRow(b)},
    _deleteRow:function(b){var e=b.data("JSGridItem"),c=this._itemIndex(e),f=this._callEventHandler(this.onItemDeleting,{row:b,item:e,itemIndex:c});return this._controllerCall("deleteItem",e,f.cancel,function(){this._loadStrategy.finishDelete(e,c);this._callEventHandler(this.onItemDeleted,{row:b,item:e,itemIndex:c})})}};b.fn.jsGrid=function(f){var d=b.makeArray(arguments).slice(1),g=this;this.each(function(){var h=b(this),k=h.data("JSGrid");if(k)if("string"===typeof f){if(h=k[f].apply(k,d),h!==c&&h!==
k)return g=h,!1}else k._detachWindowResizeCallback(),k._init(f),k.render();else new e(h,f)});return g};var k={},l={},m=function(e,c){b.each(c,function(c,f){b.isPlainObject(f)?m(e[c]||e[c[0].toUpperCase()+c.slice(1)],f):e.hasOwnProperty(c)?e[c]=f:e.prototype[c]=f})};d.jsGrid={Grid:e,fields:k,setDefaults:function(c,f){if(b.isPlainObject(c))var d=e.prototype;else d=k[c].prototype,c=f||{};b.extend(d,c)},locales:l,locale:function(e){var c=b.isPlainObject(e)?e:l[e];if(!c)throw Error("unknown locale "+e);
        m(jsGrid,c)},version:"1.5.2"}})(window,jQuery);
(function(d,b,c){function e(b){this._init(b)}e.prototype={container:"body",message:"Loading...",shading:!0,zIndex:1E3,shaderClass:"jsgrid-load-shader",loadPanelClass:"jsgrid-load-panel",_init:function(e){b.extend(!0,this,e);this._initContainer();this._initShader();this._initLoadPanel()},_initContainer:function(){this._container=b(this.container)},_initShader:function(){this.shading&&(this._shader=b("<div>").addClass(this.shaderClass).hide().css({position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:this.zIndex}).appendTo(this._container))},
    _initLoadPanel:function(){this._loadPanel=b("<div>").addClass(this.loadPanelClass).text(this.message).hide().css({position:"absolute",top:"50%",left:"50%",zIndex:this.zIndex}).appendTo(this._container)},show:function(){var b=this._loadPanel.show(),e=b.outerWidth(),c=b.outerHeight();b.css({marginTop:-c/2,marginLeft:-e/2});this._shader.show()},hide:function(){this._loadPanel.hide();this._shader.hide()}};d.LoadIndicator=e})(jsGrid,jQuery);
(function(d,b,c){function e(b){this._grid=b}function f(b){this._grid=b;this._itemsCount=0}e.prototype={firstDisplayIndex:function(){var b=this._grid;return b.option("paging")?(b.option("pageIndex")-1)*b.option("pageSize"):0},lastDisplayIndex:function(){var b=this._grid,e=b.option("data").length;return b.option("paging")?Math.min(b.option("pageIndex")*b.option("pageSize"),e):e},itemsCount:function(){return this._grid.option("data").length},openPage:function(b){this._grid.refresh()},loadParams:function(){return{}},
    sort:function(){this._grid._sortData();this._grid.refresh();return b.Deferred().resolve().promise()},reset:function(){this._grid.refresh();return b.Deferred().resolve().promise()},finishLoad:function(b){this._grid.option("data",b)},finishInsert:function(b){var e=this._grid;e.option("data").push(b);e.refresh()},finishDelete:function(b,e){b=this._grid;b.option("data").splice(e,1);b.reset()}};f.prototype={firstDisplayIndex:function(){return 0},lastDisplayIndex:function(){return this._grid.option("data").length},
    itemsCount:function(){return this._itemsCount},openPage:function(b){this._grid.loadData()},loadParams:function(){var b=this._grid;return{pageIndex:b.option("pageIndex"),pageSize:b.option("pageSize")}},reset:function(){return this._grid.loadData()},sort:function(){return this._grid.loadData()},finishLoad:function(b){this._itemsCount=b.itemsCount;this._grid.option("data",b.data)},finishInsert:function(b){this._grid.search()},finishDelete:function(b,e){this._grid.search()}};d.loadStrategies={DirectLoadingStrategy:e,
    PageLoadingStrategy:f}})(jsGrid,jQuery);(function(d,b,c){var e=function(b){return"undefined"!==typeof b&&null!==b};d.sortStrategies={string:function(b,c){return e(b)||e(c)?e(b)?e(c)?(""+b).localeCompare(""+c):1:-1:0},number:function(b,e){return b-e},date:function(b,e){return b-e},numberAsString:function(b,e){return parseFloat(b)-parseFloat(e)}}})(jsGrid,jQuery);
(function(d,b,c){function e(b){this._init(b)}e.prototype={_init:function(e){b.extend(!0,this,e)},validate:function(e){var c=[];b.each(this._normalizeRules(e.rules),function(f,d){d.validator(e.value,e.item,d.param)||(f=b.isFunction(d.message)?d.message(e.value,e.item):d.message,c.push(f))});return c},_normalizeRules:function(e){b.isArray(e)||(e=[e]);return b.map(e,b.proxy(function(b){return this._normalizeRule(b)},this))},_normalizeRule:function(e){"string"===typeof e&&(e={validator:e});b.isFunction(e)&&
    (e={validator:e});if(b.isPlainObject(e))e=b.extend({},e);else throw Error("wrong validation config specified");return b.isFunction(e.validator)?e:this._applyNamedValidator(e,e.validator)},_applyNamedValidator:function(e,c){delete e.validator;var d=f[c];if(!d)throw Error('unknown validator "'+c+'"');b.isFunction(d)&&(d={validator:d});return b.extend({},d,e)}};d.Validation=e;var f={required:{message:"Field is required",validator:function(b){return b!==c&&null!==b&&""!==b}},rangeLength:{message:"Field value length is out of the defined range",
        validator:function(b,e,c){return b.length>=c[0]&&b.length<=c[1]}},minLength:{message:"Field value is too short",validator:function(b,e,c){return b.length>=c}},maxLength:{message:"Field value is too long",validator:function(b,e,c){return b.length<=c}},pattern:{message:"Field value is not matching the defined pattern",validator:function(b,e,c){"string"===typeof c&&(c=new RegExp("^(?:"+c+")$"));return c.test(b)}},range:{message:"Field value is out of the defined range",validator:function(b,e,c){return b>=
            c[0]&&b<=c[1]}},min:{message:"Field value is too small",validator:function(b,e,c){return b>=c}},max:{message:"Field value is too large",validator:function(b,e,c){return b<=c}}};d.validators=f})(jsGrid,jQuery);
(function(d,b,c){function e(e){b.extend(!0,this,e);this.sortingFunc=this._getSortingFunc()}e.prototype={name:"",title:null,css:"",align:"",width:100,visible:!0,filtering:!0,inserting:!0,editing:!0,sorting:!0,sorter:"string",headerTemplate:function(){return this.title===c||null===this.title?this.name:this.title},itemTemplate:function(b,e){return b},filterTemplate:function(){return""},insertTemplate:function(){return""},editTemplate:function(b,e){this._value=b;return this.itemTemplate(b,e)},filterValue:function(){return""},
    insertValue:function(){return""},editValue:function(){return this._value},_getSortingFunc:function(){var e=this.sorter;if(b.isFunction(e))return e;if("string"===typeof e)return d.sortStrategies[e];throw Error('wrong sorter for the field "'+this.name+'"!');}};d.Field=e})(jsGrid,jQuery);
(function(d,b,c){function e(b){f.call(this,b)}var f=d.Field;e.prototype=new f({autosearch:!0,readOnly:!1,filterTemplate:function(){if(!this.filtering)return"";var b=this._grid,e=this.filterControl=this._createTextBox();if(this.autosearch)e.on("keypress",function(e){13===e.which&&(b.search(),e.preventDefault())});return e},insertTemplate:function(){return this.inserting?this.insertControl=this._createTextBox():""},editTemplate:function(b){if(!this.editing)return this.itemTemplate(b);var e=this.editControl=
        this._createTextBox();e.val(b);return e},filterValue:function(){return this.filterControl.val()},insertValue:function(){return this.insertControl.val()},editValue:function(){return this.editControl.val()},_createTextBox:function(){return b("<input>").attr("type","text").prop("readonly",!!this.readOnly)}});d.fields.text=d.TextField=e})(jsGrid,jQuery);
(function(d,b,c){function e(b){f.call(this,b)}var f=d.TextField;e.prototype=new f({sorter:"number",align:"right",readOnly:!1,filterValue:function(){return parseInt(this.filterControl.val()||0,10)},insertValue:function(){return parseInt(this.insertControl.val()||0,10)},editValue:function(){return parseInt(this.editControl.val()||0,10)},_createTextBox:function(){return b("<input>").attr("type","number").prop("readonly",!!this.readOnly)}});d.fields.number=d.NumberField=e})(jsGrid,jQuery);
(function(d,b,c){function e(b){f.call(this,b)}var f=d.TextField;e.prototype=new f({insertTemplate:function(){return this.inserting?this.insertControl=this._createTextArea():""},editTemplate:function(b){if(!this.editing)return this.itemTemplate(b);var e=this.editControl=this._createTextArea();e.val(b);return e},_createTextArea:function(){return b("<textarea>").prop("readonly",!!this.readOnly)}});d.fields.textarea=d.TextAreaField=e})(jsGrid,jQuery);
(function(d,b,c){function e(b){this.items=[];this.selectedIndex=-1;this.textField=this.valueField="";b.valueField&&b.items.length&&(this.valueType="number"===typeof b.items[0][b.valueField]?"number":"string");this.sorter=this.valueType;f.call(this,b)}var f=d.NumberField;e.prototype=new f({align:"center",valueType:"number",itemTemplate:function(e){var f=this.items,d=this.valueField,g=this.textField;f=d?b.grep(f,function(b,c){return b[d]===e})[0]||{}:f[e];g=g?f[g]:f;return g===c||null===g?"":g},filterTemplate:function(){if(!this.filtering)return"";
        var b=this._grid,e=this.filterControl=this._createSelect();if(this.autosearch)e.on("change",function(e){b.search()});return e},insertTemplate:function(){return this.inserting?this.insertControl=this._createSelect():""},editTemplate:function(b){if(!this.editing)return this.itemTemplate(b);var e=this.editControl=this._createSelect();b!==c&&e.val(b);return e},filterValue:function(){var b=this.filterControl.val();return"number"===this.valueType?parseInt(b||0,10):b},insertValue:function(){var b=this.insertControl.val();
        return"number"===this.valueType?parseInt(b||0,10):b},editValue:function(){var b=this.editControl.val();return"number"===this.valueType?parseInt(b||0,10):b},_createSelect:function(){var e=b("<select>"),c=this.valueField,f=this.textField,d=this.selectedIndex;b.each(this.items,function(g,h){var k=c?h[c]:g;h=f?h[f]:h;b("<option>").attr("value",k).text(h).appendTo(e).prop("selected",d===g)});e.prop("disabled",!!this.readOnly);return e}});d.fields.select=d.SelectField=e})(jsGrid,jQuery);
(function(d,b,c){function e(b){f.call(this,b)}var f=d.Field;e.prototype=new f({sorter:"number",align:"center",autosearch:!0,itemTemplate:function(b){return this._createCheckbox().prop({checked:b,disabled:!0})},filterTemplate:function(){if(!this.filtering)return"";var e=this._grid,c=this.filterControl=this._createCheckbox();c.prop({readOnly:!0,indeterminate:!0});c.on("click",function(){var e=b(this);e.prop("readOnly")?e.prop({checked:!1,readOnly:!1}):e.prop("checked")||e.prop({readOnly:!0,indeterminate:!0})});
        if(this.autosearch)c.on("click",function(){e.search()});return c},insertTemplate:function(){return this.inserting?this.insertControl=this._createCheckbox():""},editTemplate:function(b){if(!this.editing)return this.itemTemplate(b);var e=this.editControl=this._createCheckbox();e.prop("checked",b);return e},filterValue:function(){return this.filterControl.get(0).indeterminate?c:this.filterControl.is(":checked")},insertValue:function(){return this.insertControl.is(":checked")},editValue:function(){return this.editControl.is(":checked")},
    _createCheckbox:function(){return b("<input>").attr("type","checkbox")}});d.fields.checkbox=d.CheckboxField=e})(jsGrid,jQuery);
(function(d,b,c){function e(b){f.call(this,b);this._configInitialized=!1}var f=d.Field;e.prototype=new f({css:"jsgrid-control-field",align:"center",width:50,filtering:!1,inserting:!1,editing:!1,sorting:!1,buttonClass:"jsgrid-button",modeButtonClass:"jsgrid-mode-button",modeOnButtonClass:"jsgrid-mode-on-button",searchModeButtonClass:"jsgrid-search-mode-button",insertModeButtonClass:"jsgrid-insert-mode-button",editButtonClass:"jsgrid-edit-button",deleteButtonClass:"jsgrid-delete-button",searchButtonClass:"jsgrid-search-button",
    clearFilterButtonClass:"jsgrid-clear-filter-button",insertButtonClass:"jsgrid-insert-button",updateButtonClass:"jsgrid-update-button",cancelEditButtonClass:"jsgrid-cancel-edit-button",searchModeButtonTooltip:"Switch to searching",insertModeButtonTooltip:"Switch to inserting",editButtonTooltip:"Edit",deleteButtonTooltip:"Delete",searchButtonTooltip:"Search",clearFilterButtonTooltip:"Clear filter",insertButtonTooltip:"Insert",updateButtonTooltip:"Update",cancelEditButtonTooltip:"Cancel edit",editButton:!0,
    deleteButton:!0,clearFilterButton:!0,modeSwitchButton:!0,_initConfig:function(){this._hasFiltering=this._grid.filtering;(this._hasInserting=this._grid.inserting)&&this.modeSwitchButton&&(this._grid.inserting=!1);this._configInitialized=!0},headerTemplate:function(){this._configInitialized||this._initConfig();var b=this._hasFiltering,e=this._hasInserting;return this.modeSwitchButton&&(b||e)?b&&!e?this._createFilterSwitchButton():e&&!b?this._createInsertSwitchButton():this._createModeSwitchButton():
        ""},itemTemplate:function(e,c){e=b([]);this.editButton&&(e=e.add(this._createEditButton(c)));this.deleteButton&&(e=e.add(this._createDeleteButton(c)));return e},filterTemplate:function(){var b=this._createSearchButton();return this.clearFilterButton?b.add(this._createClearFilterButton()):b},insertTemplate:function(){return this._createInsertButton()},editTemplate:function(){return this._createUpdateButton().add(this._createCancelEditButton())},_createFilterSwitchButton:function(){return this._createOnOffSwitchButton("filtering",
        this.searchModeButtonClass,!0)},_createInsertSwitchButton:function(){return this._createOnOffSwitchButton("inserting",this.insertModeButtonClass,!1)},_createOnOffSwitchButton:function(e,c,f){var d=f,g=b.proxy(function(){h.toggleClass(this.modeOnButtonClass,d)},this),h=this._createGridButton(this.modeButtonClass+" "+c,"",function(b){d=!d;b.option(e,d);g()});g();return h},_createModeSwitchButton:function(){var e=!1,c=b.proxy(function(){f.attr("title",e?this.searchModeButtonTooltip:this.insertModeButtonTooltip).toggleClass(this.insertModeButtonClass,
        !e).toggleClass(this.searchModeButtonClass,e)},this),f=this._createGridButton(this.modeButtonClass,"",function(b){e=!e;b.option("inserting",e);b.option("filtering",!e);c()});c();return f},_createEditButton:function(b){return this._createGridButton(this.editButtonClass,this.editButtonTooltip,function(e,c){e.editItem(b);c.stopPropagation()})},_createDeleteButton:function(b){return this._createGridButton(this.deleteButtonClass,this.deleteButtonTooltip,function(e,c){e.deleteItem(b);c.stopPropagation()})},
    _createSearchButton:function(){return this._createGridButton(this.searchButtonClass,this.searchButtonTooltip,function(b){b.search()})},_createClearFilterButton:function(){return this._createGridButton(this.clearFilterButtonClass,this.clearFilterButtonTooltip,function(b){b.clearFilter()})},_createInsertButton:function(){return this._createGridButton(this.insertButtonClass,this.insertButtonTooltip,function(b){b.insertItem().done(function(){b.clearInsert()})})},_createUpdateButton:function(){return this._createGridButton(this.updateButtonClass,
        this.updateButtonTooltip,function(b,e){b.updateItem();e.stopPropagation()})},_createCancelEditButton:function(){return this._createGridButton(this.cancelEditButtonClass,this.cancelEditButtonTooltip,function(b,e){b.cancelEdit();e.stopPropagation()})},_createGridButton:function(e,c,f){var d=this._grid;return b("<input>").addClass(this.buttonClass).addClass(e).attr({type:"button",title:c}).on("click",function(b){f(d,b)})},editValue:function(){return""}});d.fields.control=d.ControlField=e})(jsGrid,jQuery);
Array.prototype.filter||(Array.prototype.filter=function(d){for(var b=this.length,c=Array(b),e=0,f=0;f<b;++f){var g=this[f];d(g,f,this)&&(c[e++]=g)}c.length=e;return c});Array.prototype.some||(Array.prototype.some=function(d){for(var b=this.length,c=0;c<b;++c)if(d(this[c],c,this))return!0;return!1});Array.prototype.every||(Array.prototype.every=function(d){return!this.some(function(b,c,e){return!d(b,c,e)})});
Array.prototype.remove||(Array.prototype.remove=function(d,b){if(!b){if(!d)return[];b=this.length}return this.filter(function(c,e,f){return e<d||e>=b})});Array.prototype.forEach||(Array.prototype.forEach=function(d){for(var b=this.length,c=0;c<b;++c)d(this[c],c,this)});Array.prototype.indexOf||(Array.prototype.indexOf=function(d,b){b=this.length;for(var c=0;c<b;++c)if(this[c]===d)return c;return-1});Array.prototype.contains||(Array.prototype.contains=function(d,b){return 0<=this.indexOf(d)});
Array.prototype.map||(Array.prototype.map=function(d){for(var b=this.length,c=Array(b),e=0;e<b;++e)c[e]=d(this[e],e,this);return c});Array.prototype.reduce||(Array.prototype.reduce=function(d,b){for(var c=this.length,e=0;e<c;++e)b=d(b,this[e],e,this);return b});var oldBrowser=document.all&&!document.addEventListener;
oldBrowser||function(d,b){function c(b){var e=oa[b]={};v.each(b.split(Y),function(b,c){e[c]=!0});return e}function e(e,c,f){if(f===b&&1===e.nodeType)if(f="data-"+c.replace(cb,"-$1").toLowerCase(),f=e.getAttribute(f),"string"===typeof f){try{f="true"===f?!0:"false"===f?!1:"null"===f?null:+f+""===f?+f:pa.test(f)?v.parseJSON(f):f}catch(Fa){}v.data(e,c,f)}else f=b;return f}function f(b){for(var e in b)if(("data"!==e||!v.isEmptyObject(b[e]))&&"toJSON"!==e)return!1;return!0}function g(){return!1}function h(){return!0}
    function k(b){return!b||!b.parentNode||11===b.parentNode.nodeType}function l(b,e){do b=b[e];while(b&&1!==b.nodeType);return b}function m(b,e,c){e=e||0;if(v.isFunction(e))return v.grep(b,function(b,f){return!!e.call(b,f,b)===c});if(e.nodeType)return v.grep(b,function(b,f){return b===e===c});if("string"===typeof e){var f=v.grep(b,function(b){return 1===b.nodeType});if(eb.test(e))return v.filter(e,f,!c);e=v.filter(e,f)}return v.grep(b,function(b,f){return 0<=v.inArray(b,e)===c})}function p(b){var e=
        Ma.split("|");b=b.createDocumentFragment();if(b.createElement)for(;e.length;)b.createElement(e.pop());return b}function r(b,e){return b.getElementsByTagName(e)[0]||b.appendChild(b.ownerDocument.createElement(e))}function t(b,e){if(1===e.nodeType&&v.hasData(b)){var c,f;var d=v._data(b);b=v._data(e,d);var g=d.events;if(g)for(c in delete b.handle,b.events={},g)for(d=0,f=g[c].length;d<f;d++)v.event.add(e,c,g[c][d]);b.data&&(b.data=v.extend({},b.data))}}function w(b,e){if(1===e.nodeType){e.clearAttributes&&
    e.clearAttributes();e.mergeAttributes&&e.mergeAttributes(b);var c=e.nodeName.toLowerCase();"object"===c?(e.parentNode&&(e.outerHTML=b.outerHTML),v.support.html5Clone&&b.innerHTML&&!v.trim(e.innerHTML)&&(e.innerHTML=b.innerHTML)):"input"===c&&Na.test(b.type)?(e.defaultChecked=e.checked=b.checked,e.value!==b.value&&(e.value=b.value)):"option"===c?e.selected=b.defaultSelected:"input"===c||"textarea"===c?e.defaultValue=b.defaultValue:"script"===c&&e.text!==b.text&&(e.text=b.text);e.removeAttribute(v.expando)}}
    function q(b){return"undefined"!==typeof b.getElementsByTagName?b.getElementsByTagName("*"):"undefined"!==typeof b.querySelectorAll?b.querySelectorAll("*"):[]}function u(b){Na.test(b.type)&&(b.defaultChecked=b.checked)}function y(b,e){if(e in b)return e;for(var c=e.charAt(0).toUpperCase()+e.slice(1),f=e,d=Oa.length;d--;)if(e=Oa[d]+c,e in b)return e;return f}function z(b,e){b=e||b;return"none"===v.css(b,"display")||!v.contains(b.ownerDocument,b)}function A(b,e){for(var c,f,d=[],g=0,h=b.length;g<h;g++)c=
        b[g],c.style&&(d[g]=v._data(c,"olddisplay"),e?(d[g]||"none"!==c.style.display||(c.style.display=""),""===c.style.display&&z(c)&&(d[g]=v._data(c,"olddisplay",K(c.nodeName)))):(f=ca(c,"display"),d[g]||"none"===f||v._data(c,"olddisplay",f)));for(g=0;g<h;g++)c=b[g],!c.style||e&&"none"!==c.style.display&&""!==c.style.display||(c.style.display=e?d[g]||"":"none");return b}function C(b,e,c){return(b=fb.exec(e))?Math.max(0,b[1]-(c||0))+(b[2]||"px"):e}function B(b,e,c,f){e=c===(f?"border":"content")?4:"width"===
    e?1:0;for(var d=0;4>e;e+=2)"margin"===c&&(d+=v.css(b,c+ma[e],!0)),f?("content"===c&&(d-=parseFloat(ca(b,"padding"+ma[e]))||0),"margin"!==c&&(d-=parseFloat(ca(b,"border"+ma[e]+"Width"))||0)):(d+=parseFloat(ca(b,"padding"+ma[e]))||0,"padding"!==c&&(d+=parseFloat(ca(b,"border"+ma[e]+"Width"))||0));return d}function D(b,e,c){var f="width"===e?b.offsetWidth:b.offsetHeight,d=!0,g=v.support.boxSizing&&"border-box"===v.css(b,"boxSizing");if(0>=f||null==f){f=ca(b,e);if(0>f||null==f)f=b.style[e];if(ya.test(f))return f;
        d=g&&(v.support.boxSizingReliable||f===b.style[e]);f=parseFloat(f)||0}return f+B(b,e,c||(g?"border":"content"),d)+"px"}function K(b){if(Ga[b])return Ga[b];var e=v("<"+b+">").appendTo(E.body),c=e.css("display");e.remove();if("none"===c||""===c)qa=E.body.appendChild(qa||v.extend(E.createElement("iframe"),{frameBorder:0,width:0,height:0})),ra&&qa.createElement||(ra=(qa.contentWindow||qa.contentDocument).document,ra.write("<!doctype html><html><body>"),ra.close()),e=ra.body.appendChild(ra.createElement(b)),
        c=ca(e,"display"),E.body.removeChild(qa);return Ga[b]=c}function I(b,e,c,f){var d;if(v.isArray(e))v.each(e,function(e,d){c||gb.test(b)?f(b,d):I(b+"["+("object"===typeof d?e:"")+"]",d,c,f)});else if(c||"object"!==v.type(e))f(b,e);else for(d in e)I(b+"["+d+"]",e[d],c,f)}function G(){setTimeout(function(){sa=b},0);return sa=v.now()}function H(b,e){v.each(e,function(e,c){for(var f=(va[e]||[]).concat(va["*"]),d=0,g=f.length;d<g&&!f[d].call(b,e,c);d++);})}function N(b,e,c){var f=0,d=za.length,g=v.Deferred().always(function(){delete h.elem}),
        h=function(){var e=sa||G();e=Math.max(0,k.startTime+k.duration-e);for(var c=1-(e/k.duration||0),f=0,d=k.tweens.length;f<d;f++)k.tweens[f].run(c);g.notifyWith(b,[k,c,e]);if(1>c&&d)return e;g.resolveWith(b,[k]);return!1},k=g.promise({elem:b,props:v.extend({},e),opts:v.extend(!0,{specialEasing:{}},c),originalProperties:e,originalOptions:c,startTime:sa||G(),duration:c.duration,tweens:[],createTween:function(e,c,f){e=v.Tween(b,k.opts,e,c,k.opts.specialEasing[e]||k.opts.easing);k.tweens.push(e);return e},
            stop:function(e){for(var c=0,f=e?k.tweens.length:0;c<f;c++)k.tweens[c].run(1);e?g.resolveWith(b,[k,e]):g.rejectWith(b,[k,e]);return this}});c=k.props;for(Q(c,k.opts.specialEasing);f<d;f++)if(e=za[f].call(k,b,c,k.opts))return e;H(k,c);v.isFunction(k.opts.start)&&k.opts.start.call(b,k);v.fx.timer(v.extend(h,{anim:k,queue:k.opts.queue,elem:b}));return k.progress(k.opts.progress).done(k.opts.done,k.opts.complete).fail(k.opts.fail).always(k.opts.always)}function Q(b,e){var c,f;for(c in b){var d=v.camelCase(c);
        var g=e[d];var h=b[c];v.isArray(h)&&(g=h[1],h=b[c]=h[0]);c!==d&&(b[d]=h,delete b[c]);if((f=v.cssHooks[d])&&"expand"in f)for(c in h=f.expand(h),delete b[d],h)c in b||(b[c]=h[c],e[c]=g);else e[d]=g}}function J(b,e,c,f,d){return new J.prototype.init(b,e,c,f,d)}function O(b,e){var c={height:b},f=0;for(e=e?1:0;4>f;f+=2-e){var d=ma[f];c["margin"+d]=c["padding"+d]=b}e&&(c.opacity=c.width=b);return c}function L(b){return v.isWindow(b)?b:9===b.nodeType?b.defaultView||b.parentWindow:!1}var M,E=d.document,F=
            d.navigator,R=d.JQXLite,U=d.$,W=Array.prototype.push,P=Array.prototype.slice,Z=Array.prototype.indexOf,ba=Object.prototype.toString,S=Object.prototype.hasOwnProperty,da=String.prototype.trim,v=function(b,e){return new v.fn.init(b,e,na)},X=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,aa=/\S/,Y=/\s+/,ha=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,wa=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,ka=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,V=/^[\],:{}\s]*$/,Aa=/(?:^|:|,)(?:\s*\[)+/g,ta=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,
        Ba=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,la=/^-ms-/,ia=/-([\da-z])/gi,T=function(b,e){return(e+"").toUpperCase()},Ca=function(){E.addEventListener?(E.removeEventListener("DOMContentLoaded",Ca,!1),v.ready()):"complete"===E.readyState&&(E.detachEvent("onreadystatechange",Ca),v.ready())},ja={};v.fn=v.prototype={constructor:v,init:function(e,c,f){if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if("string"===typeof e){var d="<"===e.charAt(0)&&
        ">"===e.charAt(e.length-1)&&3<=e.length?[null,e,null]:wa.exec(e);if(!d||!d[1]&&c)return!c||c.jqx?(c||f).find(e):this.constructor(c).find(e);if(d[1])return e=(c=c instanceof v?c[0]:c)&&c.nodeType?c.ownerDocument||c:E,e=v.parseHTML(d[1],e,!0),ka.test(d[1])&&v.isPlainObject(c)&&this.attr.call(e,c,!0),v.merge(this,e);if((c=E.getElementById(d[2]))&&c.parentNode){if(c.id!==d[2])return f.find(e);this.length=1;this[0]=c}this.context=E;this.selector=e;return this}if(v.isFunction(e))return f.ready(e);e.selector!==
        b&&(this.selector=e.selector,this.context=e.context);return v.makeArray(e,this)},selector:"",jqx:"4.5.0",length:0,size:function(){return this.length},toArray:function(){return P.call(this)},get:function(b){return null==b?this.toArray():0>b?this[this.length+b]:this[b]},pushStack:function(b,e,c){b=v.merge(this.constructor(),b);b.prevObject=this;b.context=this.context;"find"===e?b.selector=this.selector+(this.selector?" ":"")+c:e&&(b.selector=this.selector+"."+e+"("+c+")");return b},each:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           e){return v.each(this,b,e)},ready:function(b){v.ready.promise().done(b);return this},eq:function(b){b=+b;return-1===b?this.slice(b):this.slice(b,b+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(P.apply(this,arguments),"slice",P.call(arguments).join(","))},map:function(b){return this.pushStack(v.map(this,function(e,c){return b.call(e,c,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:W,sort:[].sort,splice:[].splice};
    v.fn.init.prototype=v.fn;v.extend=v.fn.extend=function(){var e,c,f,d=arguments[0]||{},g=1,h=arguments.length,k=!1;"boolean"===typeof d&&(k=d,d=arguments[1]||{},g=2);"object"===typeof d||v.isFunction(d)||(d={});h===g&&(d=this,--g);for(;g<h;g++)if(null!=(e=arguments[g]))for(c in e){var q=d[c];var l=e[c];d!==l&&(k&&l&&(v.isPlainObject(l)||(f=v.isArray(l)))?(f?(f=!1,q=q&&v.isArray(q)?q:[]):q=q&&v.isPlainObject(q)?q:{},d[c]=v.extend(k,q,l)):l!==b&&(d[c]=l))}return d};v.extend({noConflict:function(b){d.$===
        v&&(d.$=U);b&&d.JQXLite===v&&(d.JQXLite=R);return v},isReady:!1,readyWait:1,holdReady:function(b){b?v.readyWait++:v.ready(!0)},ready:function(b){if(!0===b?!--v.readyWait:!v.isReady){if(!E.body)return setTimeout(v.ready,1);v.isReady=!0;!0!==b&&0<--v.readyWait||(M.resolveWith(E,[v]),v.fn.trigger&&v(E).trigger("ready").off("ready"))}},isFunction:function(b){return"function"===v.type(b)},isArray:Array.isArray||function(b){return"array"===v.type(b)},isWindow:function(b){return null!=b&&b==b.window},isNumeric:function(b){return!isNaN(parseFloat(b))&&
            isFinite(b)},type:function(b){return null==b?String(b):ja[ba.call(b)]||"object"},isPlainObject:function(e){if(!e||"object"!==v.type(e)||e.nodeType||v.isWindow(e))return!1;try{if(e.constructor&&!S.call(e,"constructor")&&!S.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(bb){return!1}for(var c in e);return c===b||S.call(e,c)},isEmptyObject:function(b){for(var e in b)return!1;return!0},error:function(b){throw Error(b);},parseHTML:function(b,e,c){var f;if(!b||"string"!==typeof b)return null;
            "boolean"===typeof e&&(c=e,e=0);e=e||E;if(f=ka.exec(b))return[e.createElement(f[1])];f=v.buildFragment([b],e,c?null:[]);return v.merge([],(f.cacheable?v.clone(f.fragment):f.fragment).childNodes)},parseJSON:function(b){if(!b||"string"!==typeof b)return null;b=v.trim(b);if(d.JSON&&d.JSON.parse)return d.JSON.parse(b);if(V.test(b.replace(ta,"@").replace(Ba,"]").replace(Aa,"")))return(new Function("return "+b))();v.error("Invalid JSON: "+b)},parseXML:function(e){if(!e||"string"!==typeof e)return null;
            try{if(d.DOMParser){var c=new DOMParser;var f=c.parseFromString(e,"text/xml")}else f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(e)}catch(Fa){f=b}f&&f.documentElement&&!f.getElementsByTagName("parsererror").length||v.error("Invalid XML: "+e);return f},noop:function(){},globalEval:function(b){b&&aa.test(b)&&(d.execScript||function(b){d.eval.call(d,b)})(b)},camelCase:function(b){return b.replace(la,"ms-").replace(ia,T)},nodeName:function(b,e){return b.nodeName&&b.nodeName.toLowerCase()===
            e.toLowerCase()},each:function(e,c,f){var d,g=0,h=e.length,k=h===b||v.isFunction(e);if(f)if(k)for(d in e){if(!1===c.apply(e[d],f))break}else for(;g<h&&!1!==c.apply(e[g++],f););else if(k)for(d in e){if(!1===c.call(e[d],d,e[d]))break}else for(;g<h&&!1!==c.call(e[g],g,e[g++]););return e},trim:da&&!da.call("\ufeff\u00a0")?function(b){return null==b?"":da.call(b)}:function(b){return null==b?"":(b+"").replace(ha,"")},makeArray:function(b,e){var c=e||[];null!=b&&(e=v.type(b),null==b.length||"string"===e||
        "function"===e||"regexp"===e||v.isWindow(b)?W.call(c,b):v.merge(c,b));return c},inArray:function(b,e,c){if(e){if(Z)return Z.call(e,b,c);var f=e.length;for(c=c?0>c?Math.max(0,f+c):c:0;c<f;c++)if(c in e&&e[c]===b)return c}return-1},merge:function(e,c){var f=c.length,d=e.length,g=0;if("number"===typeof f)for(;g<f;g++)e[d++]=c[g];else for(;c[g]!==b;)e[d++]=c[g++];e.length=d;return e},grep:function(b,e,c){var f=[],d=0,g=b.length;for(c=!!c;d<g;d++){var h=!!e(b[d],d);c!==h&&f.push(b[d])}return f},map:function(e,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    c,f){var d,g=[],h=0,k=e.length;if(e instanceof v||k!==b&&"number"===typeof k&&(0<k&&e[0]&&e[k-1]||0===k||v.isArray(e)))for(;h<k;h++){var q=c(e[h],h,f);null!=q&&(g[g.length]=q)}else for(d in e)q=c(e[d],d,f),null!=q&&(g[g.length]=q);return g.concat.apply([],g)},guid:1,proxy:function(e,c){if("string"===typeof c){var f=e[c];c=e;e=f}if(!v.isFunction(e))return b;var d=P.call(arguments,2);f=function(){return e.apply(c,d.concat(P.call(arguments)))};f.guid=e.guid=e.guid||v.guid++;return f},access:function(e,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          c,f,d,g,h,k){var q=null==f,l=0,u=e.length;if(f&&"object"===typeof f){for(l in f)v.access(e,c,l,f[l],1,h,d);g=1}else if(d!==b){var m=k===b&&v.isFunction(d);q&&(m?(m=c,c=function(b,e,c){return m.call(v(b),c)}):(c.call(e,d),c=null));if(c)for(;l<u;l++)c(e[l],f,m?d.call(e[l],l,c(e[l],f)):d,k);g=1}return g?e:q?c.call(e):u?c(e[0],f):h},now:function(){return(new Date).getTime()}});v.ready.promise=function(b){if(!M)if(M=v.Deferred(),"complete"===E.readyState)setTimeout(v.ready,1);else if(E.addEventListener)E.addEventListener("DOMContentLoaded",
        Ca,!1),d.addEventListener("load",v.ready,!1);else{E.attachEvent("onreadystatechange",Ca);d.attachEvent("onload",v.ready);var e=!1;try{e=null==d.frameElement&&E.documentElement}catch(bb){}e&&e.doScroll&&function Fa(){if(!v.isReady){try{e.doScroll("left")}catch(db){return setTimeout(Fa,50)}v.ready()}}()}return M.promise(b)};v.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(b,e){ja["[object "+e+"]"]=e.toLowerCase()});var na=v(E);var oa={};v.Callbacks=function(e){e=
        "string"===typeof e?oa[e]||c(e):v.extend({},e);var f,d,g,h,k,q,l=[],u=!e.once&&[],m=function(b){f=e.memory&&b;d=!0;q=h||0;h=0;k=l.length;for(g=!0;l&&q<k;q++)if(!1===l[q].apply(b[0],b[1])&&e.stopOnFalse){f=!1;break}g=!1;l&&(u?u.length&&m(u.shift()):f?l=[]:p.disable())},p={add:function(){if(l){var b=l.length;(function xa(b){v.each(b,function(b,c){b=v.type(c);"function"===b?e.unique&&p.has(c)||l.push(c):c&&c.length&&"string"!==b&&xa(c)})})(arguments);g?k=l.length:f&&(h=b,m(f))}return this},remove:function(){l&&
        v.each(arguments,function(b,e){for(var c;-1<(c=v.inArray(e,l,c));)l.splice(c,1),g&&(c<=k&&k--,c<=q&&q--)});return this},has:function(b){return-1<v.inArray(b,l)},empty:function(){l=[];return this},disable:function(){l=u=f=b;return this},disabled:function(){return!l},lock:function(){u=b;f||p.disable();return this},locked:function(){return!u},fireWith:function(b,e){e=e||[];e=[b,e.slice?e.slice():e];!l||d&&!u||(g?u.push(e):m(e));return this},fire:function(){p.fireWith(this,arguments);return this},fired:function(){return!!d}};
        return p};v.extend({Deferred:function(b){var e=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],c="pending",f={state:function(){return c},always:function(){d.done(arguments).fail(arguments);return this},then:function(){var b=arguments;return v.Deferred(function(c){v.each(e,function(e,f){var g=f[0],h=b[e];d[f[1]](v.isFunction(h)?function(){var b=h.apply(this,arguments);if(b&&v.isFunction(b.promise))b.promise().done(c.resolve).fail(c.reject).progress(c.notify);
            else c[g+"With"](this===d?c:this,[b])}:c[g])});b=null}).promise()},promise:function(b){return null!=b?v.extend(b,f):f}},d={};f.pipe=f.then;v.each(e,function(b,g){var h=g[2],k=g[3];f[g[1]]=h.add;k&&h.add(function(){c=k},e[b^1][2].disable,e[2][2].lock);d[g[0]]=h.fire;d[g[0]+"With"]=h.fireWith});f.promise(d);b&&b.call(d,d);return d},when:function(b){var e=0,c=P.call(arguments),f=c.length,d=1!==f||b&&v.isFunction(b.promise)?f:0,g=1===d?b:v.Deferred(),h=function(b,e,c){return function(f){e[b]=this;c[b]=
            1<arguments.length?P.call(arguments):f;c===q?g.notifyWith(e,c):--d||g.resolveWith(e,c)}},k;if(1<f){var q=Array(f);var l=Array(f);for(k=Array(f);e<f;e++)c[e]&&v.isFunction(c[e].promise)?c[e].promise().done(h(e,k,c)).fail(g.reject).progress(h(e,l,q)):--d}d||g.resolveWith(k,c);return g.promise()}});v.support=function(){var b,e=E.createElement("div");e.setAttribute("className","t");e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";var c=e.getElementsByTagName("*");var f=
        e.getElementsByTagName("a")[0];if(!c||!f||!c.length)return{};var g=E.createElement("select");var h=g.appendChild(E.createElement("option"));c=e.getElementsByTagName("input")[0];f.style.cssText="top:1px;float:left;opacity:.5";var k={leadingWhitespace:3===e.firstChild.nodeType,tbody:!e.getElementsByTagName("tbody").length,htmlSerialize:!!e.getElementsByTagName("link").length,style:/top/.test(f.getAttribute("style")),hrefNormalized:"/a"===f.getAttribute("href"),opacity:/^0.5/.test(f.style.opacity),cssFloat:!!f.style.cssFloat,
        checkOn:"on"===c.value,optSelected:h.selected,getSetAttribute:"t"!==e.className,enctype:!!E.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==E.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===E.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1};c.checked=!0;k.noCloneChecked=c.cloneNode(!0).checked;g.disabled=!0;k.optDisabled=
        !h.disabled;try{delete e.test}catch(Mb){k.deleteExpando=!1}!e.addEventListener&&e.attachEvent&&e.fireEvent&&(e.attachEvent("onclick",f=function(){k.noCloneEvent=!1}),e.cloneNode(!0).fireEvent("onclick"),e.detachEvent("onclick",f));c=E.createElement("input");c.value="t";c.setAttribute("type","radio");k.radioValue="t"===c.value;c.setAttribute("checked","checked");c.setAttribute("name","t");e.appendChild(c);f=E.createDocumentFragment();f.appendChild(e.lastChild);k.checkClone=f.cloneNode(!0).cloneNode(!0).lastChild.checked;
        k.appendChecked=c.checked;f.removeChild(c);f.appendChild(e);if(e.attachEvent)for(b in{submit:!0,change:!0,focusin:!0}){c="on"+b;var q=c in e;q||(e.setAttribute(c,"return;"),q="function"===typeof e[c]);k[b+"Bubbles"]=q}v(function(){var b=E.getElementsByTagName("body")[0];if(b){var e=E.createElement("div");e.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px";b.insertBefore(e,b.firstChild);var c=E.createElement("div");e.appendChild(c);c.innerHTML="<table><tr><td></td><td>t</td></tr></table>";
            var f=c.getElementsByTagName("td");f[0].style.cssText="padding:0;margin:0;border:0;display:none";q=0===f[0].offsetHeight;f[0].style.display="";f[1].style.display="none";k.reliableHiddenOffsets=q&&0===f[0].offsetHeight;c.innerHTML="";c.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";k.boxSizing=4===c.offsetWidth;k.doesNotIncludeMarginInBodyOffset=1!==b.offsetTop;d.getComputedStyle&&
            (k.pixelPosition="1%"!==(d.getComputedStyle(c,null)||{}).top,k.boxSizingReliable="4px"===(d.getComputedStyle(c,null)||{width:"4px"}).width,f=E.createElement("div"),f.style.cssText=c.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;",f.style.marginRight=f.style.width="0",c.style.width="1px",c.appendChild(f),k.reliableMarginRight=!parseFloat((d.getComputedStyle(f,null)||{}).marginRight));"undefined"!==typeof c.style.zoom&&(c.innerHTML="",c.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;width:1px;padding:1px;display:inline;zoom:1",
                k.inlineBlockNeedsLayout=3===c.offsetWidth,c.style.display="block",c.style.overflow="visible",c.innerHTML="<div></div>",c.firstChild.style.width="5px",k.shrinkWrapBlocks=3!==c.offsetWidth,e.style.zoom=1);b.removeChild(e)}});f.removeChild(e);c=f=g=h=c=f=e=null;return k}();var pa=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,cb=/([A-Z])/g;v.extend({cache:{},deletedIds:[],uuid:0,expando:"JQXLite"+(v.fn.jqx+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},
        hasData:function(b){b=b.nodeType?v.cache[b[v.expando]]:b[v.expando];return!!b&&!f(b)},data:function(e,c,f,d){if(v.acceptData(e)){var g=v.expando,h="string"===typeof c,k=e.nodeType,q=k?v.cache:e,l=k?e[g]:e[g]&&g;if(l&&q[l]&&(d||q[l].data)||!h||f!==b){l||(k?e[g]=l=v.deletedIds.pop()||v.guid++:l=g);q[l]||(q[l]={},k||(q[l].toJSON=v.noop));if("object"===typeof c||"function"===typeof c)d?q[l]=v.extend(q[l],c):q[l].data=v.extend(q[l].data,c);e=q[l];d||(e.data||(e.data={}),e=e.data);f!==b&&(e[v.camelCase(c)]=
            f);h?(f=e[c],null==f&&(f=e[v.camelCase(c)])):f=e;return f}}},removeData:function(b,e,c){if(v.acceptData(b)){var d,g,h=b.nodeType,k=h?v.cache:b,q=h?b[v.expando]:v.expando;if(k[q]){if(e&&(d=c?k[q]:k[q].data)){v.isArray(e)||(e in d?e=[e]:(e=v.camelCase(e),e=e in d?[e]:e.split(" ")));var l=0;for(g=e.length;l<g;l++)delete d[e[l]];if(!(c?f:v.isEmptyObject)(d))return}if(!c&&(delete k[q].data,!f(k[q])))return;h?v.cleanData([b],!0):v.support.deleteExpando||k!=k.window?delete k[q]:k[q]=null}}},_data:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    e,c){return v.data(b,e,c,!0)},acceptData:function(b){var e=b.nodeName&&v.noData[b.nodeName.toLowerCase()];return!e||!0!==e&&b.getAttribute("classid")===e}});v.fn.extend({data:function(c,f){var d,g=this[0],h=0,k=null;if(c===b){if(this.length&&(k=v.data(g),1===g.nodeType&&!v._data(g,"parsedAttrs"))){var q=g.attributes;for(d=q.length;h<d;h++){var l=q[h].name;l.indexOf("data-")||(l=v.camelCase(l.substring(5)),e(g,l,k[l]))}v._data(g,"parsedAttrs",!0)}return k}if("object"===typeof c)return this.each(function(){v.data(this,
            c)});var u=c.split(".",2);u[1]=u[1]?"."+u[1]:"";var m=u[1]+"!";return v.access(this,function(f){if(f===b)return k=this.triggerHandler("getData"+m,[u[0]]),k===b&&g&&(k=v.data(g,c),k=e(g,c,k)),k===b&&u[1]?this.data(u[0]):k;u[1]=f;this.each(function(){var b=v(this);b.triggerHandler("setData"+m,u);v.data(this,c,f);b.triggerHandler("changeData"+m,u)})},null,f,1<arguments.length,null,!1)},removeData:function(b){return this.each(function(){v.removeData(this,b)})}});v.extend({queue:function(b,e,c){if(b){e=
            (e||"fx")+"queue";var f=v._data(b,e);c&&(!f||v.isArray(c)?f=v._data(b,e,v.makeArray(c)):f.push(c));return f||[]}},dequeue:function(b,e){e=e||"fx";var c=v.queue(b,e),f=c.length,d=c.shift(),g=v._queueHooks(b,e),h=function(){v.dequeue(b,e)};"inprogress"===d&&(d=c.shift(),f--);d&&("fx"===e&&c.unshift("inprogress"),delete g.stop,d.call(b,h,g));!f&&g&&g.empty.fire()},_queueHooks:function(b,e){var c=e+"queueHooks";return v._data(b,c)||v._data(b,c,{empty:v.Callbacks("once memory").add(function(){v.removeData(b,
                e+"queue",!0);v.removeData(b,c,!0)})})}});v.fn.extend({queue:function(e,c){var f=2;"string"!==typeof e&&(c=e,e="fx",f--);return arguments.length<f?v.queue(this[0],e):c===b?this:this.each(function(){var b=v.queue(this,e,c);v._queueHooks(this,e);"fx"===e&&"inprogress"!==b[0]&&v.dequeue(this,e)})},dequeue:function(b){return this.each(function(){v.dequeue(this,b)})},delay:function(b,e){b=v.fx?v.fx.speeds[b]||b:b;return this.queue(e||"fx",function(e,c){var f=setTimeout(e,b);c.stop=function(){clearTimeout(f)}})},
        clearQueue:function(b){return this.queue(b||"fx",[])},promise:function(e,c){var f,d=1,g=v.Deferred(),h=this,k=this.length,q=function(){--d||g.resolveWith(h,[h])};"string"!==typeof e&&(c=e,e=b);for(e=e||"fx";k--;)(f=v._data(h[k],e+"queueHooks"))&&f.empty&&(d++,f.empty.add(q));q();return g.promise(c)}});var ua=/[\t\r\n]/g,hb=/\r/g,Ha=/^(?:button|input)$/i,ib=/^(?:button|input|object|select|textarea)$/i,jb=/^a(?:rea|)$/i,Pa=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,
        kb=v.support.getSetAttribute;v.fn.extend({attr:function(b,e){return v.access(this,v.attr,b,e,1<arguments.length)},removeAttr:function(b){return this.each(function(){v.removeAttr(this,b)})},prop:function(b,e){return v.access(this,v.prop,b,e,1<arguments.length)},removeProp:function(e){e=v.propFix[e]||e;return this.each(function(){try{this[e]=b,delete this[e]}catch(Ea){}})},addClass:function(b){var e,c;if(v.isFunction(b))return this.each(function(e){v(this).addClass(b.call(this,e,this.className))});
            if(b&&"string"===typeof b){var f=b.split(Y);var d=0;for(e=this.length;d<e;d++){var g=this[d];if(1===g.nodeType)if(g.className||1!==f.length){var h=" "+g.className+" ";var k=0;for(c=f.length;k<c;k++)0>h.indexOf(" "+f[k]+" ")&&(h+=f[k]+" ");g.className=v.trim(h)}else g.className=b}}return this},removeClass:function(e){var c,f;if(v.isFunction(e))return this.each(function(b){v(this).removeClass(e.call(this,b,this.className))});if(e&&"string"===typeof e||e===b){var d=(e||"").split(Y);var g=0;for(f=this.length;g<
        f;g++){var h=this[g];if(1===h.nodeType&&h.className){var k=(" "+h.className+" ").replace(ua," ");var q=0;for(c=d.length;q<c;q++)for(;0<=k.indexOf(" "+d[q]+" ");)k=k.replace(" "+d[q]+" "," ");h.className=e?v.trim(k):""}}}return this},toggleClass:function(b,e){var c=typeof b,f="boolean"===typeof e;return v.isFunction(b)?this.each(function(c){v(this).toggleClass(b.call(this,c,this.className,e),e)}):this.each(function(){if("string"===c)for(var d,g=0,h=v(this),k=e,q=b.split(Y);d=q[g++];)k=f?k:!h.hasClass(d),
            h[k?"addClass":"removeClass"](d);else if("undefined"===c||"boolean"===c)this.className&&v._data(this,"__className__",this.className),this.className=this.className||!1===b?"":v._data(this,"__className__")||""})},hasClass:function(b){b=" "+b+" ";for(var e=0,c=this.length;e<c;e++)if(1===this[e].nodeType&&0<=(" "+this[e].className+" ").replace(ua," ").indexOf(b))return!0;return!1},val:function(e){var c,f,d=this[0];if(arguments.length){var g=v.isFunction(e);return this.each(function(f){var d=v(this);1===
        this.nodeType&&(f=g?e.call(this,f,d.val()):e,null==f?f="":"number"===typeof f?f+="":v.isArray(f)&&(f=v.map(f,function(b){return null==b?"":b+""})),c=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()],c&&"set"in c&&c.set(this,f,"value")!==b||(this.value=f))})}if(d){if((c=v.valHooks[d.type]||v.valHooks[d.nodeName.toLowerCase()])&&"get"in c&&(f=c.get(d,"value"))!==b)return f;f=d.value;return"string"===typeof f?f.replace(hb,""):null==f?"":f}}});v.extend({valHooks:{option:{get:function(b){var e=
                    b.attributes.value;return!e||e.specified?b.value:b.text}},select:{get:function(b){for(var e,c=b.options,f=b.selectedIndex,d=(b="select-one"===b.type||0>f)?null:[],g=b?f+1:c.length,h=0>f?g:b?f:0;h<g;h++)if(e=c[h],!(!e.selected&&h!==f||(v.support.optDisabled?e.disabled:null!==e.getAttribute("disabled"))||e.parentNode.disabled&&v.nodeName(e.parentNode,"optgroup"))){e=v(e).val();if(b)return e;d.push(e)}return d},set:function(b,e){var c=v.makeArray(e);v(b).find("option").each(function(){this.selected=
                    0<=v.inArray(v(this).val(),c)});c.length||(b.selectedIndex=-1);return c}}},attrFn:{},attr:function(e,c,f,d){var g,h=e.nodeType;if(e&&3!==h&&8!==h&&2!==h){if(d&&v.isFunction(v.fn[c]))return v(e)[c](f);if("undefined"===typeof e.getAttribute)return v.prop(e,c,f);if(d=1!==h||!v.isXMLDoc(e)){c=c.toLowerCase();var k=v.attrHooks[c]||(Pa.test(c)?lb:void 0)}if(f!==b)if(null===f)v.removeAttr(e,c);else{if(k&&"set"in k&&d&&(g=k.set(e,f,c))!==b)return g;e.setAttribute(c,f+"");return f}else{if(k&&"get"in k&&d&&
            null!==(g=k.get(e,c)))return g;g=e.getAttribute(c);return null===g?b:g}}},removeAttr:function(b,e){var c,f,d,g=0;if(e&&1===b.nodeType)for(c=e.split(Y);g<c.length;g++)if(f=c[g])e=v.propFix[f]||f,(d=Pa.test(f))||v.attr(b,f,""),b.removeAttribute(kb?f:e),d&&e in b&&(b[e]=!1)},attrHooks:{type:{set:function(b,e){if(Ha.test(b.nodeName)&&b.parentNode)v.error("type property can't be changed");else if(!v.support.radioValue&&"radio"===e&&v.nodeName(b,"input")){var c=b.value;b.setAttribute("type",e);c&&(b.value=
                    c);return e}}},value:{get:function(b,e){return e in b?b.value:null},set:function(b,e,c){b.value=e}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,c,f){var d,g=e.nodeType;if(e&&3!==g&&8!==g&&2!==g){if(1!==g||!v.isXMLDoc(e)){c=v.propFix[c]||c;var h=v.propHooks[c]}return f!==
        b?h&&"set"in h&&(d=h.set(e,f,c))!==b?d:e[c]=f:h&&"get"in h&&null!==(d=h.get(e,c))?d:e[c]}},propHooks:{tabIndex:{get:function(e){var c=e.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):ib.test(e.nodeName)||jb.test(e.nodeName)&&e.href?0:b}}}});var lb={get:function(e,c){var f,d=v.prop(e,c);return!0===d||"boolean"!==typeof d&&(f=e.getAttributeNode(c))&&!1!==f.nodeValue?c.toLowerCase():b},set:function(b,e,c){!1===e?v.removeAttr(b,c):(e=v.propFix[c]||c,e in b&&(b[e]=!0),b.setAttribute(c,
            c.toLowerCase()));return c}};v.support.enctype||(v.propFix.enctype="encoding");var Qa=/^([^\.]*|)(?:\.(.+)|)$/,mb=/(?:^|\s)hover(\.\S+|)\b/,nb=/^key/,ob=/^(?:mouse|contextmenu)|click/,Ra=/^(?:focusinfocus|focusoutblur)$/,Sa=function(b){return v.event.special.hover?b:b.replace(mb,"mouseenter$1 mouseleave$1")};v.event={add:function(e,c,f,d,g){var h;if(3!==e.nodeType&&8!==e.nodeType&&c&&f&&(h=v._data(e))){if(f.handler){var k=f;f=k.handler;g=k.selector}f.guid||(f.guid=v.guid++);var q=h.events;q||(h.events=
            q={});var l=h.handle;l||(h.handle=l=function(e){return"undefined"===typeof v||e&&v.event.triggered===e.type?b:v.event.dispatch.apply(l.elem,arguments)},l.elem=e);c=v.trim(Sa(c)).split(" ");for(h=0;h<c.length;h++){var u=Qa.exec(c[h])||[];var m=u[1];var p=(u[2]||"").split(".").sort();var y=v.event.special[m]||{};m=(g?y.delegateType:y.bindType)||m;y=v.event.special[m]||{};u=v.extend({type:m,origType:u[1],data:d,handler:f,guid:f.guid,selector:g,needsContext:g&&v.expr.match.needsContext.test(g),namespace:p.join(".")},
            k);var r=q[m];r||(r=q[m]=[],r.delegateCount=0,y.setup&&!1!==y.setup.call(e,d,p,l)||(e.addEventListener?d&&d.passive!==b?e.addEventListener(m,l,d):e.addEventListener(m,l,!1):e.attachEvent&&e.attachEvent("on"+m,l)));y.add&&(y.add.call(e,u),u.handler.guid||(u.handler.guid=f.guid));g?r.splice(r.delegateCount++,0,u):r.push(u);v.event.global[m]=!0}e=null}},global:{},remove:function(b,e,c,f,d){var g,h,k,q,l=v.hasData(b)&&v._data(b);if(l&&(q=l.events)){e=v.trim(Sa(e||"")).split(" ");for(g=0;g<e.length;g++){var u=
            Qa.exec(e[g])||[];var m=h=u[1];u=u[2];if(m){var p=v.event.special[m]||{};m=(f?p.delegateType:p.bindType)||m;var y=q[m]||[];var r=y.length;u=u?new RegExp("(^|\\.)"+u.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(k=0;k<y.length;k++){var t=y[k];!d&&h!==t.origType||c&&c.guid!==t.guid||u&&!u.test(t.namespace)||f&&f!==t.selector&&("**"!==f||!t.selector)||(y.splice(k--,1),t.selector&&y.delegateCount--,p.remove&&p.remove.call(b,t))}0===y.length&&r!==y.length&&(p.teardown&&!1!==p.teardown.call(b,
            u,l.handle)||v.removeEvent(b,m,l.handle),delete q[m])}else for(m in q)v.event.remove(b,m+e[g],c,f,!0)}v.isEmptyObject(q)&&(delete l.handle,v.removeData(b,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(e,c,f,g){if(!f||3!==f.nodeType&&8!==f.nodeType){var h,k=e.type||e;var q=[];if(!Ra.test(k+v.event.triggered)){if(0<=k.indexOf("!")){k=k.slice(0,-1);var l=!0}0<=k.indexOf(".")&&(q=k.split("."),k=q.shift(),q.sort());if(f&&!v.event.customEvent[k]||v.event.global[k])if(e=
            "object"===typeof e?e[v.expando]?e:new v.Event(k,e):new v.Event(k),e.type=k,e.isTrigger=!0,e.exclusive=l,e.namespace=q.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,q=0>k.indexOf(":")?"on"+k:"",f){e.result=b;e.target||(e.target=f);c=null!=c?v.makeArray(c):[];c.unshift(e);var u=v.event.special[k]||{};if(!u.trigger||!1!==u.trigger.apply(f,c)){var m=[[f,u.bindType||k]];if(!g&&!u.noBubble&&!v.isWindow(f)){var p=u.delegateType||k;l=Ra.test(p+k)?f:f.parentNode;
            for(h=f;l;l=l.parentNode)m.push([l,p]),h=l;h===(f.ownerDocument||E)&&m.push([h.defaultView||h.parentWindow||d,p])}for(h=0;h<m.length&&!e.isPropagationStopped();h++)l=m[h][0],e.type=m[h][1],(p=(v._data(l,"events")||{})[e.type]&&v._data(l,"handle"))&&p.apply(l,c),(p=q&&l[q])&&v.acceptData(l)&&p.apply&&!1===p.apply(l,c)&&e.preventDefault();e.type=k;g||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(f.ownerDocument,c)||"click"===k&&v.nodeName(f,"a")||!v.acceptData(f)||!q||!f[k]||("focus"===
            k||"blur"===k)&&0===e.target.offsetWidth||v.isWindow(f)||((h=f[q])&&(f[q]=null),v.event.triggered=k,f[k](),v.event.triggered=b,h&&(f[q]=h));return e.result}}else for(h in f=v.cache,f)f[h].events&&f[h].events[k]&&v.event.trigger(e,c,f[h].handle.elem,!0)}}},dispatch:function(e){e=v.event.fix(e||d.event);var c,f,g=(v._data(this,"events")||{})[e.type]||[],h=g.delegateCount,k=P.call(arguments),q=!e.exclusive&&!e.namespace,l=v.event.special[e.type]||{},u=[];k[0]=e;e.delegateTarget=this;if(!l.preDispatch||
            !1!==l.preDispatch.call(this,e)){if(h&&(!e.button||"click"!==e.type))for(f=e.target;f!=this;f=f.parentNode||this)if(!0!==f.disabled||"click"!==e.type){var m={};var p=[];for(c=0;c<h;c++){var y=g[c];var r=y.selector;m[r]===b&&(m[r]=y.needsContext?0<=v(r,this).index(f):v.find(r,this,null,[f]).length);m[r]&&p.push(y)}p.length&&u.push({elem:f,matches:p})}g.length>h&&u.push({elem:this,matches:g.slice(h)});for(c=0;c<u.length&&!e.isPropagationStopped();c++)for(m=u[c],e.currentTarget=m.elem,f=0;f<m.matches.length&&
        !e.isImmediatePropagationStopped();f++)if(y=m.matches[f],q||!e.namespace&&!y.namespace||e.namespace_re&&e.namespace_re.test(y.namespace))e.data=y.data,e.handleObj=y,y=((v.event.special[y.origType]||{}).handle||y.handler).apply(m.elem,k),y!==b&&(e.result=y,!1===y&&(e.preventDefault(),e.stopPropagation()));l.postDispatch&&l.postDispatch.call(this,e);return e.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),
        fixHooks:{},keyHooks:{props:["char","charCode","key","keyCode"],filter:function(b,e){null==b.which&&(b.which=null!=e.charCode?e.charCode:e.keyCode);return b}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,c){var f=c.button,d=c.fromElement;if(null==e.pageX&&null!=c.clientX){var g=e.target.ownerDocument||E;var h=g.documentElement;g=g.body;e.pageX=c.clientX+(h&&h.scrollLeft||g&&g.scrollLeft||0)-(h&&h.clientLeft||
                g&&g.clientLeft||0);e.pageY=c.clientY+(h&&h.scrollTop||g&&g.scrollTop||0)-(h&&h.clientTop||g&&g.clientTop||0)}!e.relatedTarget&&d&&(e.relatedTarget=d===e.target?c.toElement:d);e.which||f===b||(e.which=f&1?1:f&2?3:f&4?2:0);return e}},fix:function(b){if(b[v.expando])return b;var e,c=b,f=v.event.fixHooks[b.type]||{},d=f.props?this.props.concat(f.props):this.props;b=v.Event(c);for(e=d.length;e;){var g=d[--e];b[g]=c[g]}b.target||(b.target=c.srcElement||E);3===b.target.nodeType&&(b.target=b.target.parentNode);
            b.metaKey=!!b.metaKey;return f.filter?f.filter(b,c):b},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(b,e,c){v.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(b,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}},simulate:function(b,e,c,f){b=v.extend(new v.Event,c,{type:b,isSimulated:!0,originalEvent:{}});f?v.event.trigger(b,null,e):v.event.dispatch.call(e,b);b.isDefaultPrevented()&&c.preventDefault()}};v.event.handle=
        v.event.dispatch;v.removeEvent=E.removeEventListener?function(b,e,c){b.removeEventListener&&b.removeEventListener(e,c,!1)}:function(b,e,c){e="on"+e;b.detachEvent&&("undefined"===typeof b[e]&&(b[e]=null),b.detachEvent(e,c))};v.Event=function(b,e){if(!(this instanceof v.Event))return new v.Event(b,e);b&&b.type?(this.originalEvent=b,this.type=b.type,this.isDefaultPrevented=b.defaultPrevented||!1===b.returnValue||b.getPreventDefault&&b.getPreventDefault()?h:g):this.type=b;e&&v.extend(this,e);this.timeStamp=
        b&&b.timeStamp||v.now();this[v.expando]=!0};v.Event.prototype={preventDefault:function(){this.isDefaultPrevented=h;var b=this.originalEvent;b&&(b.preventDefault?b.preventDefault():b.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=h;var b=this.originalEvent;b&&(b.stopPropagation&&b.stopPropagation(),b.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=h;this.stopPropagation()},isDefaultPrevented:g,isPropagationStopped:g,isImmediatePropagationStopped:g};
    v.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(b,e){v.event.special[b]={delegateType:e,bindType:e,handle:function(b){var c=b.relatedTarget,f=b.handleObj;if(!c||c!==this&&!v.contains(this,c)){b.type=f.origType;var d=f.handler.apply(this,arguments);b.type=e}return d}}});v.fn.extend({on:function(e,c,f,d,h){var k;if("object"===typeof e){"string"!==typeof c&&(f=f||c,c=b);for(k in e)this.on(k,c,f,e[k],h);return this}null==f&&null==d?(d=c,f=c=b):null==d&&("string"===typeof c?(d=f,f=b):(d=
            f,f=c,c=b));if(!1===d)d=g;else if(!d)return this;if(1===h){var q=d;d=function(b){v().off(b);return q.apply(this,arguments)};d.guid=q.guid||(q.guid=v.guid++)}return this.each(function(){v.event.add(this,e,d,f,c)})},off:function(e,c,f){if(e&&e.preventDefault&&e.handleObj){var d=e.handleObj;v(e.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler);return this}if("object"===typeof e){for(d in e)this.off(d,c,e[d]);return this}if(!1===c||"function"===typeof c)f=c,c=
            b;!1===f&&(f=g);return this.each(function(){v.event.remove(this,e,f,c)})},delegate:function(b,e,c,f){return this.on(e,b,c,f)},undelegate:function(b,e,c){return 1===arguments.length?this.off(b,"**"):this.off(e,b||"**",c)},trigger:function(b,e){return this.each(function(){v.event.trigger(b,e,this)})},triggerHandler:function(b,e){if(this[0])return v.event.trigger(b,e,this[0],!0)},toggle:function(b){var e=arguments,c=b.guid||v.guid++,f=0,d=function(c){var d=(v._data(this,"lastToggle"+b.guid)||0)%f;v._data(this,
            "lastToggle"+b.guid,d+1);c.preventDefault();return e[d].apply(this,arguments)||!1};for(d.guid=c;f<e.length;)e[f++].guid=c;return this.click(d)},hover:function(b,e){return this.mouseenter(b).mouseleave(e||b)}});v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(b,e){v.fn[e]=function(b,c){null==c&&(c=b,b=null);return 0<arguments.length?
        this.on(e,null,b,c):this.trigger(e)};nb.test(e)&&(v.event.fixHooks[e]=v.event.keyHooks);ob.test(e)&&(v.event.fixHooks[e]=v.event.mouseHooks)});(function(b,e){function c(b,e,c,f){c=c||[];e=e||B;var d,g,h,k=e.nodeType;if(!b||"string"!==typeof b)return c;if(1!==k&&9!==k)return[];var q=ka(e);if(!q&&!f&&(d=I.exec(b)))if(h=d[1])if(9===k)if((g=e.getElementById(h))&&g.parentNode){if(g.id===h)return c.push(g),c}else return c;else{if(e.ownerDocument&&(g=e.ownerDocument.getElementById(h))&&ja(e,g)&&g.id===h)return c.push(g),
        c}else{if(d[2])return O.apply(c,V.call(e.getElementsByTagName(b),0)),c;if((h=d[3])&&la&&e.getElementsByClassName)return O.apply(c,V.call(e.getElementsByClassName(h),0)),c}return r(b.replace(ba,"$1"),e,c,f,q)}function f(b){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===b}}function d(b){return function(e){var c=e.nodeName.toLowerCase();return("input"===c||"button"===c)&&e.type===b}}function g(b){return L(function(e){e=+e;return L(function(c,f){for(var d,g=b([],c.length,e),h=g.length;h--;)c[d=
        g[h]]&&(c[d]=!(f[d]=c[d]))})})}function h(b,e,c){if(b===e)return c;for(b=b.nextSibling;b;){if(b===e)return-1;b=b.nextSibling}return 1}function k(b,e){var f,d,g,h,k;if(h=Aa[C][b+" "])return e?0:h.slice(0);h=b;var q=[];for(k=T.preFilter;h;){if(!l||(f=K.exec(h)))f&&(h=h.slice(f[0].length)||h),q.push(d=[]);var l=!1;if(f=M.exec(h))d.push(l=new H(f.shift())),h=h.slice(l.length),l.type=f[0].replace(ba," ");for(g in T.filter)!(f=aa[g].exec(h))||k[g]&&!(f=k[g](f))||(d.push(l=new H(f.shift())),h=h.slice(l.length),
        l.type=g,l.matches=f);if(!l)break}return e?h.length:h?c.error(b):Aa(b,q).slice(0)}function q(b,e,c){var f=e.dir,d=c&&"parentNode"===e.dir,g=J++;return e.first?function(e,c,g){for(;e=e[f];)if(d||1===e.nodeType)return b(e,c,g)}:function(e,c,h){if(!h)for(var k,q=Q+" "+g+" ",l=q+w;e=e[f];){if(d||1===e.nodeType){if((k=e[C])===l)return e.sizset;if("string"===typeof k&&0===k.indexOf(q)){if(e.sizset)return e}else{e[C]=l;if(b(e,c,h))return e.sizset=!0,e;e.sizset=!1}}}else for(;e=e[f];)if((d||1===e.nodeType)&&
        b(e,c,h))return e}}function l(b){return 1<b.length?function(e,c,f){for(var d=b.length;d--;)if(!b[d](e,c,f))return!1;return!0}:b[0]}function u(b,e,c,f,d){for(var g,h=[],k=0,q=b.length,l=null!=e;k<q;k++)if(g=b[k])if(!c||c(g,f,d))h.push(g),l&&e.push(k);return h}function m(b,e,f,d,g,h){d&&!d[C]&&(d=m(d));g&&!g[C]&&(g=m(g,h));return L(function(h,k,q,l){var m,p=[],y=[],r=k.length,t;if(!(t=h)){t=e||"*";for(var w=q.nodeType?[q]:q,z=[],A=0,G=w.length;A<G;A++)c(t,w[A],z);t=z}t=!b||!h&&e?t:u(t,p,b,q,l);w=f?
        g||(h?b:r||d)?[]:k:t;f&&f(t,w,q,l);if(d){var v=u(w,y);d(v,[],q,l);for(q=v.length;q--;)if(m=v[q])w[y[q]]=!(t[y[q]]=m)}if(h){if(g||b){if(g){v=[];for(q=w.length;q--;)(m=w[q])&&v.push(t[q]=m);g(null,w=[],v,l)}for(q=w.length;q--;)(m=w[q])&&-1<(v=g?D.call(h,m):p[q])&&(h[v]=!(k[v]=m))}}else w=u(w===k?w.splice(r,w.length):w),g?g(null,k,w,l):O.apply(k,w)})}function p(b){var e,c,f=b.length,d=T.relative[b[0].type];var g=d||T.relative[" "];for(var h=d?1:0,k=q(function(b){return b===e},g,!0),u=q(function(b){return-1<
        D.call(e,b)},g,!0),y=[function(b,c,f){return!d&&(f||c!==G)||((e=c).nodeType?k(b,c,f):u(b,c,f))}];h<f;h++)if(g=T.relative[b[h].type])y=[q(l(y),g)];else{g=T.filter[b[h].type].apply(null,b[h].matches);if(g[C]){for(c=++h;c<f&&!T.relative[b[c].type];c++);return m(1<h&&l(y),1<h&&b.slice(0,h-1).join("").replace(ba,"$1"),g,h<c&&p(b.slice(h,c)),c<f&&p(b=b.slice(c)),c<f&&b.join(""))}y.push(g)}return l(y)}function y(b,e){var f=0<e.length,d=0<b.length,g=function(h,k,q,l,m){var p,y,r=[],t=0,z="0",A=h&&[],v=null!=
        m,C=G,N=h||d&&T.find.TAG("*",m&&k.parentNode||k),H=Q+=null==C?1:Math.E;v&&(G=k!==B&&k,w=g.el);for(;null!=(m=N[z]);z++){if(d&&m){for(p=0;y=b[p];p++)if(y(m,k,q)){l.push(m);break}v&&(Q=H,w=++g.el)}f&&((m=!y&&m)&&t--,h&&A.push(m))}t+=z;if(f&&z!==t){for(p=0;y=e[p];p++)y(A,r,k,q);if(h){if(0<t)for(;z--;)A[z]||r[z]||(r[z]=E.call(l));r=u(r)}O.apply(l,r);v&&!h&&0<r.length&&1<t+e.length&&c.uniqueSort(l)}v&&(Q=H,G=C);return A};g.el=0;return f?L(g):g}function r(b,e,c,f,d){var g,h,q,l=k(b);if(!f&&1===l.length){var u=
        l[0]=l[0].slice(0);if(2<u.length&&"ID"===(h=u[0]).type&&9===e.nodeType&&!d&&T.relative[u[1].type]){e=T.find.ID(h.matches[0].replace(W,""),e,d)[0];if(!e)return c;b=b.slice(u.shift().length)}for(g=aa.POS.test(b)?-1:u.length-1;0<=g;g--){h=u[g];if(T.relative[q=h.type])break;if(q=T.find[q])if(f=q(h.matches[0].replace(W,""),Z.test(u[0].type)&&e.parentNode||e,d)){u.splice(g,1);b=f.length&&u.join("");if(!b)return O.apply(c,V.call(f,0)),c;break}}}Y(b,l)(f,e,d,c,Z.test(b));return c}function t(){}var w,z,A,
        G,N=!0,C=("sizcache"+Math.random()).replace(".",""),H=String,B=b.document,fa=B.documentElement,Q=0,J=0,E=[].pop,O=[].push,V=[].slice,D=[].indexOf||function(b){for(var e=0,c=this.length;e<c;e++)if(this[e]===b)return e;return-1},L=function(b,e){b[C]=null==e||e;return b};b=function(){var b={},e=[];return L(function(c,f){e.push(c)>T.cacheLength&&delete b[e.shift()];return b[c+" "]=f},b)};var F=b(),Aa=b(),Ea=b();b="\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+
        "(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w#")+")|)|)[\\x20\\t\\r\\n\\f]*\\]";var ta=":((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+b+")|[^:]|\\\\.)*|.*))\\)|)",ba=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,K=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,M=/^[\x20\t\r\n\f]*([\x20\t\r\n\f>+~])[\x20\t\r\n\f]*/,R=new RegExp(ta),I=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,Z=/[\x20\t\r\n\f]*[+~]/,S=/h\d/i,Ba=/input|select|textarea|button/i,W=/\\(?!\\)/g,
        aa={ID:/^#((?:\\.|[-\w]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[-\w]|[^\x00-\xa0])+)/,NAME:/^\[name=['"]?((?:\\.|[-\w]|[^\x00-\xa0])+)['"]?\]/,TAG:new RegExp("^("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w*")+")"),ATTR:new RegExp("^"+b),PSEUDO:new RegExp("^"+ta),POS:/:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i,CHILD:/^:(only|nth|first|last)-child(?:\([\x20\t\r\n\f]*(even|odd|(([+-]|)(\d*)n|)[\x20\t\r\n\f]*(?:([+-]|)[\x20\t\r\n\f]*(\d+)|))[\x20\t\r\n\f]*\)|)/i,
            needsContext:/^[\x20\t\r\n\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i},P=function(b){var e=B.createElement("div");try{return b(e)}catch(Qb){return!1}finally{}};b=P(function(b){b.appendChild(B.createComment(""));return!b.getElementsByTagName("*").length});var da=P(function(b){b.innerHTML="<a href='#'></a>";return b.firstChild&&"undefined"!==typeof b.firstChild.getAttribute&&"#"===b.firstChild.getAttribute("href")}),X=P(function(b){b.innerHTML=
        "<select></select>";b=typeof b.lastChild.getAttribute("multiple");return"boolean"!==b&&"string"!==b}),la=P(function(b){b.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!b.getElementsByClassName||!b.getElementsByClassName("e").length)return!1;b.lastChild.className="e";return 2===b.getElementsByClassName("e").length}),U=P(function(b){b.id=C+0;b.innerHTML="<a name='"+C+"'></a><div name='"+C+"'></div>";fa.insertBefore(b,fa.firstChild);var e=B.getElementsByName&&B.getElementsByName(C).length===
        2+B.getElementsByName(C+0).length;z=!B.getElementById(C);fa.removeChild(b);return e});try{V.call(fa.childNodes,0)[0].nodeType}catch(Pb){V=function(b){for(var e,c=[];e=this[b];b++)c.push(e);return c}}c.matches=function(b,e){return c(b,null,null,e)};c.matchesSelector=function(b,e){return 0<c(e,null,null,[b]).length};var ia=c.getText=function(b){var e,c="",f=0;if(e=b.nodeType)if(1===e||9===e||11===e){if("string"===typeof b.textContent)return b.textContent;for(b=b.firstChild;b;b=b.nextSibling)c+=ia(b)}else{if(3===
        e||4===e)return b.nodeValue}else for(;e=b[f];f++)c+=ia(e);return c};var ka=c.isXML=function(b){return(b=b&&(b.ownerDocument||b).documentElement)?"HTML"!==b.nodeName:!1};var ja=c.contains=fa.contains?function(b,e){var c=9===b.nodeType?b.documentElement:b;e=e&&e.parentNode;return b===e||!!(e&&1===e.nodeType&&c.contains&&c.contains(e))}:fa.compareDocumentPosition?function(b,e){return e&&!!(b.compareDocumentPosition(e)&16)}:function(b,e){for(;e=e.parentNode;)if(e===b)return!0;return!1};c.attr=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               e){var c,f=ka(b);f||(e=e.toLowerCase());return(c=T.attrHandle[e])?c(b):f||X?b.getAttribute(e):(c=b.getAttributeNode(e))?"boolean"===typeof b[e]?b[e]?e:null:c.specified?c.value:null:null};var T=c.selectors={cacheLength:50,createPseudo:L,match:aa,attrHandle:da?{}:{href:function(b){return b.getAttribute("href",2)},type:function(b){return b.getAttribute("type")}},find:{ID:z?function(b,e,c){if("undefined"!==typeof e.getElementById&&!c)return(b=e.getElementById(b))&&b.parentNode?[b]:[]}:function(b,c,f){if("undefined"!==
                typeof c.getElementById&&!f)return(c=c.getElementById(b))?c.id===b||"undefined"!==typeof c.getAttributeNode&&c.getAttributeNode("id").value===b?[c]:e:[]},TAG:b?function(b,e){if("undefined"!==typeof e.getElementsByTagName)return e.getElementsByTagName(b)}:function(b,e){e=e.getElementsByTagName(b);if("*"===b){for(var c=[],f=0;b=e[f];f++)1===b.nodeType&&c.push(b);return c}return e},NAME:U&&function(b,e){if("undefined"!==typeof e.getElementsByName)return e.getElementsByName(name)},CLASS:la&&function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     e,c){if("undefined"!==typeof e.getElementsByClassName&&!c)return e.getElementsByClassName(b)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(b){b[1]=b[1].replace(W,"");b[3]=(b[4]||b[5]||"").replace(W,"");"~="===b[2]&&(b[3]=" "+b[3]+" ");return b.slice(0,4)},CHILD:function(b){b[1]=b[1].toLowerCase();"nth"===b[1]?(b[2]||c.error(b[0]),b[3]=+(b[3]?b[4]+(b[5]||1):2*("even"===b[2]||"odd"===b[2])),
                b[4]=+(b[6]+b[7]||"odd"===b[2])):b[2]&&c.error(b[0]);return b},PSEUDO:function(b){var e,c;if(aa.CHILD.test(b[0]))return null;if(b[3])b[2]=b[3];else if(e=b[4])R.test(e)&&(c=k(e,!0))&&(c=e.indexOf(")",e.length-c)-e.length)&&(e=e.slice(0,c),b[0]=b[0].slice(0,c)),b[2]=e;return b.slice(0,3)}},filter:{ID:z?function(b){b=b.replace(W,"");return function(e){return e.getAttribute("id")===b}}:function(b){b=b.replace(W,"");return function(e){return(e="undefined"!==typeof e.getAttributeNode&&e.getAttributeNode("id"))&&
                e.value===b}},TAG:function(b){if("*"===b)return function(){return!0};b=b.replace(W,"").toLowerCase();return function(e){return e.nodeName&&e.nodeName.toLowerCase()===b}},CLASS:function(b){var e=F[C][b+" "];return e||(e=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+b+"([\\x20\\t\\r\\n\\f]|$)"),F(b,function(b){return e.test(b.className||"undefined"!==typeof b.getAttribute&&b.getAttribute("class")||"")}))},ATTR:function(b,e,f){return function(d,g){d=c.attr(d,b);if(null==d)return"!="===e;if(!e)return!0;d+="";
                return"="===e?d===f:"!="===e?d!==f:"^="===e?f&&0===d.indexOf(f):"*="===e?f&&-1<d.indexOf(f):"$="===e?f&&d.substr(d.length-f.length)===f:"~="===e?-1<(" "+d+" ").indexOf(f):"|="===e?d===f||d.substr(0,f.length+1)===f+"-":!1}},CHILD:function(b,e,c,f){return"nth"===b?function(b){var e=b.parentNode;if(1===c&&0===f)return!0;if(e){var d=0;for(e=e.firstChild;e&&(1!==e.nodeType||(d++,b!==e));e=e.nextSibling);}d-=f;return d===c||0===d%c&&0<=d/c}:function(e){var c=e;switch(b){case "only":case "first":for(;c=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       c.previousSibling;)if(1===c.nodeType)return!1;if("first"===b)return!0;c=e;case "last":for(;c=c.nextSibling;)if(1===c.nodeType)return!1;return!0}}},PSEUDO:function(b,e){var f=T.pseudos[b]||T.setFilters[b.toLowerCase()]||c.error("unsupported pseudo: "+b);if(f[C])return f(e);if(1<f.length){var d=[b,b,"",e];return T.setFilters.hasOwnProperty(b.toLowerCase())?L(function(b,c){for(var d,g=f(b,e),h=g.length;h--;)d=D.call(b,g[h]),b[d]=!(c[d]=g[h])}):function(b){return f(b,0,d)}}return f}},pseudos:{not:L(function(b){var e=
                [],c=[],f=Y(b.replace(ba,"$1"));return f[C]?L(function(b,e,c,d){d=f(b,null,d,[]);for(var g=b.length;g--;)if(c=d[g])b[g]=!(e[g]=c)}):function(b,d,g){e[0]=b;f(e,null,g,c);return!c.pop()}}),has:L(function(b){return function(e){return 0<c(b,e).length}}),contains:L(function(b){return function(e){return-1<(e.textContent||e.innerText||ia(e)).indexOf(b)}}),enabled:function(b){return!1===b.disabled},disabled:function(b){return!0===b.disabled},checked:function(b){var e=b.nodeName.toLowerCase();return"input"===
                e&&!!b.checked||"option"===e&&!!b.selected},selected:function(b){b.parentNode&&b.parentNode.selectedIndex;return!0===b.selected},parent:function(b){return!T.pseudos.empty(b)},empty:function(b){var e;for(b=b.firstChild;b;){if("@"<b.nodeName||3===(e=b.nodeType)||4===e)return!1;b=b.nextSibling}return!0},header:function(b){return S.test(b.nodeName)},text:function(b){var e,c;return"input"===b.nodeName.toLowerCase()&&"text"===(e=b.type)&&(null==(c=b.getAttribute("type"))||c.toLowerCase()===e)},radio:f("radio"),
            checkbox:f("checkbox"),file:f("file"),password:f("password"),image:f("image"),submit:d("submit"),reset:d("reset"),button:function(b){var e=b.nodeName.toLowerCase();return"input"===e&&"button"===b.type||"button"===e},input:function(b){return Ba.test(b.nodeName)},focus:function(b){var e=b.ownerDocument;return b===e.activeElement&&(!e.hasFocus||e.hasFocus())&&!!(b.type||b.href||~b.tabIndex)},active:function(b){return b===b.ownerDocument.activeElement},first:g(function(){return[0]}),last:g(function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                e){return[e-1]}),eq:g(function(b,e,c){return[0>c?c+e:c]}),even:g(function(b,e){for(var c=0;c<e;c+=2)b.push(c);return b}),odd:g(function(b,e){for(var c=1;c<e;c+=2)b.push(c);return b}),lt:g(function(b,e,c){for(e=0>c?c+e:c;0<=--e;)b.push(e);return b}),gt:g(function(b,e,c){for(c=0>c?c+e:c;++c<e;)b.push(c);return b})}};var ha=fa.compareDocumentPosition?function(b,e){return b===e?(A=!0,0):(b.compareDocumentPosition&&e.compareDocumentPosition?b.compareDocumentPosition(e)&4:b.compareDocumentPosition)?-1:
        1}:function(b,e){if(b===e)return A=!0,0;if(b.sourceIndex&&e.sourceIndex)return b.sourceIndex-e.sourceIndex;var c=[],f=[];var d=b.parentNode;var g=e.parentNode;var k=d;if(d===g)return h(b,e);if(!d)return-1;if(!g)return 1;for(;k;)c.unshift(k),k=k.parentNode;for(k=g;k;)f.unshift(k),k=k.parentNode;d=c.length;g=f.length;for(k=0;k<d&&k<g;k++)if(c[k]!==f[k])return h(c[k],f[k]);return k===d?h(b,f[k],-1):h(c[k],e,1)};[0,0].sort(ha);N=!A;c.uniqueSort=function(b){var e,c=[],f=1,d=0;A=N;b.sort(ha);if(A){for(;e=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  b[f];f++)e===b[f-1]&&(d=c.push(f));for(;d--;)b.splice(c[d],1)}return b};c.error=function(b){throw Error("Syntax error, unrecognized expression: "+b);};var Y=c.compile=function(b,e){var c,f=[],d=[],g=Ea[C][b+" "];if(!g){e||(e=k(b));for(c=e.length;c--;)g=p(e[c]),g[C]?f.push(g):d.push(g);g=Ea(b,y(d,f))}return g};B.querySelectorAll&&function(){var b,e=r,f=/'|\\/g,d=/=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,g=[":focus"],h=[":active"],q=fa.matchesSelector||fa.mozMatchesSelector||fa.webkitMatchesSelector||
        fa.oMatchesSelector||fa.msMatchesSelector;P(function(b){b.innerHTML="<select><option selected=''></option></select>";b.querySelectorAll("[selected]").length||g.push("\\[[\\x20\\t\\r\\n\\f]*(?:checked|disabled|ismap|multiple|readonly|selected|value)");b.querySelectorAll(":checked").length||g.push(":checked")});P(function(b){b.innerHTML="<p test=''></p>";b.querySelectorAll("[test^='']").length&&g.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:\"\"|'')");b.innerHTML="<input type='hidden'/>";b.querySelectorAll(":enabled").length||
    g.push(":enabled",":disabled")});g=new RegExp(g.join("|"));r=function(b,c,d,h,q){if(!h&&!q&&!g.test(b)){var l=!0,u=C;var m=c;var p=9===c.nodeType&&b;if(1===c.nodeType&&"object"!==c.nodeName.toLowerCase()){p=k(b);(l=c.getAttribute("id"))?u=l.replace(f,"\\$&"):c.setAttribute("id",u);u="[id='"+u+"'] ";for(m=p.length;m--;)p[m]=u+p[m].join("");m=Z.test(b)&&c.parentNode||c;p=p.join(",")}if(p)try{return O.apply(d,V.call(m.querySelectorAll(p),0)),d}catch(Tb){}finally{l||c.removeAttribute("id")}}return e(b,
        c,d,h,q)};q&&(P(function(e){b=q.call(e,"div");try{q.call(e,"[test!='']:sizzle"),h.push("!=",ta)}catch(Rb){}}),h=new RegExp(h.join("|")),c.matchesSelector=function(e,f){f=f.replace(d,"='$1']");if(!ka(e)&&!h.test(f)&&!g.test(f))try{var k=q.call(e,f);if(k||b||e.document&&11!==e.document.nodeType)return k}catch(Sb){}return 0<c(f,null,null,[e]).length})}();T.pseudos.nth=T.pseudos.eq;T.filters=t.prototype=T.pseudos;T.setFilters=new t;c.attr=v.attr;v.find=c;v.expr=c.selectors;v.expr[":"]=v.expr.pseudos;
        v.unique=c.uniqueSort;v.text=c.getText;v.isXMLDoc=c.isXML;v.contains=c.contains})(d);var pb=/Until$/,qb=/^(?:parents|prev(?:Until|All))/,eb=/^.[^:#\[\.,]*$/,Ta=v.expr.match.needsContext,rb={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(b){var e,c,f,d=this;if("string"!==typeof b)return v(b).filter(function(){h=0;for(e=d.length;h<e;h++)if(v.contains(d[h],this))return!0});var g=this.pushStack("","find",b);var h=0;for(e=this.length;h<e;h++){var k=g.length;v.find(b,this[h],g);if(0<
            h)for(c=k;c<g.length;c++)for(f=0;f<k;f++)if(g[f]===g[c]){g.splice(c--,1);break}}return g},has:function(b){var e,c=v(b,this),f=c.length;return this.filter(function(){for(e=0;e<f;e++)if(v.contains(this,c[e]))return!0})},not:function(b){return this.pushStack(m(this,b,!1),"not",b)},filter:function(b){return this.pushStack(m(this,b,!0),"filter",b)},is:function(b){return!!b&&("string"===typeof b?Ta.test(b)?0<=v(b,this.context).index(this[0]):0<v.filter(b,this).length:0<this.filter(b).length)},closest:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         e){for(var c,f=0,d=this.length,g=[],h=Ta.test(b)||"string"!==typeof b?v(b,e||this.context):0;f<d;f++)for(c=this[f];c&&c.ownerDocument&&c!==e&&11!==c.nodeType;){if(h?-1<h.index(c):v.find.matchesSelector(c,b)){g.push(c);break}c=c.parentNode}g=1<g.length?v.unique(g):g;return this.pushStack(g,"closest",b)},index:function(b){return b?"string"===typeof b?v.inArray(this[0],v(b)):v.inArray(b.jqx?b[0]:b,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(b,e){b="string"===typeof b?v(b,
            e):v.makeArray(b&&b.nodeType?[b]:b);e=v.merge(this.get(),b);return this.pushStack(k(b[0])||k(e[0])?e:v.unique(e))},addBack:function(b){return this.add(null==b?this.prevObject:this.prevObject.filter(b))}});v.fn.andSelf=v.fn.addBack;v.each({parent:function(b){return(b=b.parentNode)&&11!==b.nodeType?b:null},parents:function(b){return v.dir(b,"parentNode")},parentsUntil:function(b,e,c){return v.dir(b,"parentNode",c)},next:function(b){return l(b,"nextSibling")},prev:function(b){return l(b,"previousSibling")},
        nextAll:function(b){return v.dir(b,"nextSibling")},prevAll:function(b){return v.dir(b,"previousSibling")},nextUntil:function(b,e,c){return v.dir(b,"nextSibling",c)},prevUntil:function(b,e,c){return v.dir(b,"previousSibling",c)},siblings:function(b){return v.sibling((b.parentNode||{}).firstChild,b)},children:function(b){return v.sibling(b.firstChild)},contents:function(b){return v.nodeName(b,"iframe")?b.contentDocument||b.contentWindow.document:v.merge([],b.childNodes)}},function(b,e){v.fn[b]=function(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  f){var d=v.map(this,e,c);pb.test(b)||(f=c);f&&"string"===typeof f&&(d=v.filter(f,d));d=1<this.length&&!rb[b]?v.unique(d):d;1<this.length&&qb.test(b)&&(d=d.reverse());return this.pushStack(d,b,P.call(arguments).join(","))}});v.extend({filter:function(b,e,c){c&&(b=":not("+b+")");return 1===e.length?v.find.matchesSelector(e[0],b)?[e[0]]:[]:v.find.matches(b,e)},dir:function(e,c,f){var d=[];for(e=e[c];e&&9!==e.nodeType&&(f===b||1!==e.nodeType||!v(e).is(f));)1===e.nodeType&&d.push(e),e=e[c];return d},sibling:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       e){for(var c=[];b;b=b.nextSibling)1===b.nodeType&&b!==e&&c.push(b);return c}});var Ma="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",sb=/ JQXLite\d+="(?:null|\d+)"/g,Ia=/^\s+/,Ua=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Va=/<([\w:]+)/,tb=/<tbody/i,ub=/<|&#?\w+;/,vb=/<(?:script|style|link)/i,wb=/<(?:script|object|embed|option|style)/i,Ja=new RegExp("<(?:"+Ma+
        ")[\\s/>]","i"),Na=/^(?:checkbox|radio)$/,Wa=/checked\s*(?:[^=]|=\s*.checked.)/i,xb=/\/(java|ecma)script/i,yb=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,ea={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Xa=p(E),Ka=Xa.appendChild(E.createElement("div"));
    ea.optgroup=ea.option;ea.tbody=ea.tfoot=ea.colgroup=ea.caption=ea.thead;ea.th=ea.td;v.support.htmlSerialize||(ea._default=[1,"X<div>","</div>"]);v.fn.extend({text:function(e){return v.access(this,function(e){return e===b?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||E).createTextNode(e))},null,e,arguments.length)},wrapAll:function(b){if(v.isFunction(b))return this.each(function(e){v(this).wrapAll(b.call(this,e))});if(this[0]){var e=v(b,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&
        e.insertBefore(this[0]);e.map(function(){for(var b=this;b.firstChild&&1===b.firstChild.nodeType;)b=b.firstChild;return b}).append(this)}return this},wrapInner:function(b){return v.isFunction(b)?this.each(function(e){v(this).wrapInner(b.call(this,e))}):this.each(function(){var e=v(this),c=e.contents();c.length?c.wrapAll(b):e.append(b)})},wrap:function(b){var e=v.isFunction(b);return this.each(function(c){v(this).wrapAll(e?b.call(this,c):b)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,
            "body")||v(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(b){1!==this.nodeType&&11!==this.nodeType||this.appendChild(b)})},prepend:function(){return this.domManip(arguments,!0,function(b){1!==this.nodeType&&11!==this.nodeType||this.insertBefore(b,this.firstChild)})},before:function(){if(!k(this[0]))return this.domManip(arguments,!1,function(b){this.parentNode.insertBefore(b,this)});if(arguments.length){var b=v.clean(arguments);return this.pushStack(v.merge(b,
            this),"before",this.selector)}},after:function(){if(!k(this[0]))return this.domManip(arguments,!1,function(b){this.parentNode.insertBefore(b,this.nextSibling)});if(arguments.length){var b=v.clean(arguments);return this.pushStack(v.merge(this,b),"after",this.selector)}},remove:function(b,e){for(var c,f=0;null!=(c=this[f]);f++)if(!b||v.filter(b,[c]).length)e||1!==c.nodeType||(v.cleanData(c.getElementsByTagName("*")),v.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c);return this},empty:function(){for(var b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                e=0;null!=(b=this[e]);e++)for(1===b.nodeType&&v.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);return this},clone:function(b,e){b=null==b?!1:b;e=null==e?b:e;return this.map(function(){return v.clone(this,b,e)})},html:function(e){return v.access(this,function(e){var c=this[0]||{},f=0,d=this.length;if(e===b)return 1===c.nodeType?c.innerHTML.replace(sb,""):b;if(!("string"!==typeof e||vb.test(e)||!v.support.htmlSerialize&&Ja.test(e)||!v.support.leadingWhitespace&&Ia.test(e)||
            ea[(Va.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Ua,"<$1></$2>");try{for(;f<d;f++)c=this[f]||{},1===c.nodeType&&(v.cleanData(c.getElementsByTagName("*")),c.innerHTML=e);c=0}catch(Lb){}}c&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(b){if(!k(this[0])){if(v.isFunction(b))return this.each(function(e){var c=v(this),f=c.html();c.replaceWith(b.call(this,e,f))});"string"!==typeof b&&(b=v(b).detach());return this.each(function(){var e=this.nextSibling,c=this.parentNode;
            v(this).remove();e?v(e).before(b):v(c).append(b)})}return this.length?this.pushStack(v(v.isFunction(b)?b():b),"replaceWith",b):this},detach:function(b){return this.remove(b,!0)},domManip:function(e,c,f){e=[].concat.apply([],e);var d=0,g=e[0],h=[],k=this.length;if(!v.support.checkClone&&1<k&&"string"===typeof g&&Wa.test(g))return this.each(function(){v(this).domManip(e,c,f)});if(v.isFunction(g))return this.each(function(d){var h=v(this);e[0]=g.call(this,d,c?h.html():b);h.domManip(e,c,f)});if(this[0]){var q=
            v.buildFragment(e,this,h);var l=q.fragment;var u=l.firstChild;1===l.childNodes.length&&(l=u);if(u)for(c=c&&v.nodeName(u,"tr"),q=q.cacheable||k-1;d<k;d++)f.call(c&&v.nodeName(this[d],"table")?r(this[d],"tbody"):this[d],d===q?l:v.clone(l,!0,!0));l=u=null;h.length&&v.each(h,function(b,e){e.src?v.ajax?v.ajax({url:e.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):v.error("no ajax"):v.globalEval((e.text||e.textContent||e.innerHTML||"").replace(yb,""));e.parentNode&&e.parentNode.removeChild(e)})}return this}});
    v.buildFragment=function(e,c,f){var d=e[0];c=c||E;c=!c.nodeType&&c[0]||c;c=c.ownerDocument||c;if(1===e.length&&"string"===typeof d&&512>d.length&&c===E&&"<"===d.charAt(0)&&!wb.test(d)&&(v.support.checkClone||!Wa.test(d))&&(v.support.html5Clone||!Ja.test(d))){var g=!0;var h=v.fragments[d];var k=h!==b}h||(h=c.createDocumentFragment(),v.clean(e,c,h,f),g&&(v.fragments[d]=k&&h));return{fragment:h,cacheable:g}};v.fragments={};v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",
        replaceAll:"replaceWith"},function(b,e){v.fn[b]=function(c){var f=0,d=[];c=v(c);var g=c.length;var h=1===this.length&&this[0].parentNode;if((null==h||h&&11===h.nodeType&&1===h.childNodes.length)&&1===g)return c[e](this[0]),this;for(;f<g;f++)h=(0<f?this.clone(!0):this).get(),v(c[f])[e](h),d=d.concat(h);return this.pushStack(d,b,c.selector)}});v.extend({clone:function(b,e,c){var f;if(v.support.html5Clone||v.isXMLDoc(b)||!Ja.test("<"+b.nodeName+">"))var d=b.cloneNode(!0);else Ka.innerHTML=b.outerHTML,
            Ka.removeChild(d=Ka.firstChild);if(!(v.support.noCloneEvent&&v.support.noCloneChecked||1!==b.nodeType&&11!==b.nodeType||v.isXMLDoc(b))){w(b,d);var g=q(b);var h=q(d);for(f=0;g[f];++f)h[f]&&w(g[f],h[f])}if(e&&(t(b,d),c))for(g=q(b),h=q(d),f=0;g[f];++f)t(g[f],h[f]);return d},clean:function(b,e,c,f){var d,g,h=e===E&&Xa,k=[];e&&"undefined"!==typeof e.createDocumentFragment||(e=E);for(d=0;null!=(g=b[d]);d++)if("number"===typeof g&&(g+=""),g){if("string"===typeof g)if(ub.test(g)){h=h||p(e);var q=e.createElement("div");
            h.appendChild(q);g=g.replace(Ua,"<$1></$2>");var l=(Va.exec(g)||["",""])[1].toLowerCase();var m=ea[l]||ea._default;var y=m[0];for(q.innerHTML=m[1]+g+m[2];y--;)q=q.lastChild;if(!v.support.tbody)for(y=tb.test(g),m="table"!==l||y?"<table>"!==m[1]||y?[]:q.childNodes:q.firstChild&&q.firstChild.childNodes,l=m.length-1;0<=l;--l)v.nodeName(m[l],"tbody")&&!m[l].childNodes.length&&m[l].parentNode.removeChild(m[l]);!v.support.leadingWhitespace&&Ia.test(g)&&q.insertBefore(e.createTextNode(Ia.exec(g)[0]),q.firstChild);
            g=q.childNodes;q.parentNode.removeChild(q)}else g=e.createTextNode(g);g.nodeType?k.push(g):v.merge(k,g)}q&&(g=q=h=null);if(!v.support.appendChecked)for(d=0;null!=(g=k[d]);d++)v.nodeName(g,"input")?u(g):"undefined"!==typeof g.getElementsByTagName&&v.grep(g.getElementsByTagName("input"),u);if(c)for(b=function(b){if(!b.type||xb.test(b.type))return f?f.push(b.parentNode?b.parentNode.removeChild(b):b):c.appendChild(b)},d=0;null!=(g=k[d]);d++)v.nodeName(g,"script")&&b(g)||(c.appendChild(g),"undefined"!==
        typeof g.getElementsByTagName&&(g=v.grep(v.merge([],g.getElementsByTagName("script")),b),k.splice.apply(k,[d+1,0].concat(g)),d+=g.length));return k},cleanData:function(b,e){for(var c,f,d,g,h=0,k=v.expando,q=v.cache,l=v.support.deleteExpando,u=v.event.special;null!=(d=b[h]);h++)if(e||v.acceptData(d))if(c=(f=d[k])&&q[f]){if(c.events)for(g in c.events)u[g]?v.event.remove(d,g):v.removeEvent(d,g,c.handle);q[f]&&(delete q[f],l?delete d[k]:d.removeAttribute?d.removeAttribute(k):d[k]=null,v.deletedIds.push(f))}}});
    (function(){v.uaMatch=function(b){b=b.toLowerCase();b=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||0>b.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];return{browser:b[1]||"",version:b[2]||"0"}};var b=v.uaMatch(F.userAgent);var e={};b.browser&&(e[b.browser]=!0,e.version=b.version);e.chrome?e.webkit=!0:e.webkit&&(e.safari=!0);v.browser=e;v.sub=function(){function b(e,c){return new b.fn.init(e,
        c)}v.extend(!0,b,this);b.superclass=this;b.fn=b.prototype=this();b.fn.constructor=b;b.sub=this.sub;b.fn.init=function(c,f){f&&f instanceof v&&!(f instanceof b)&&(f=b(f));return v.fn.init.call(this,c,f,e)};b.fn.init.prototype=b.fn;var e=b(E);return b}})();var ca,qa,ra,La=/alpha\([^)]*\)/i,zb=/opacity=([^)]*)/,Ab=/^(top|right|bottom|left)$/,Bb=/^(none|table(?!-c[ea]).+)/,Ya=/^margin/,fb=new RegExp("^("+X+")(.*)$","i"),ya=new RegExp("^("+X+")(?!px)[a-z%]+$","i"),Cb=new RegExp("^([-+])=("+X+")","i"),
        Ga={BODY:"block"},Db={position:"absolute",visibility:"hidden",display:"block"},Za={letterSpacing:0,fontWeight:400},ma=["Top","Right","Bottom","Left"],Oa=["Webkit","O","Moz","ms"],Eb=v.fn.toggle;v.fn.extend({css:function(e,c){return v.access(this,function(e,c,f){return f!==b?v.style(e,c,f):v.css(e,c)},e,c,1<arguments.length)},show:function(){return A(this,!0)},hide:function(){return A(this)},toggle:function(b,e){var c="boolean"===typeof b;return v.isFunction(b)&&v.isFunction(e)?Eb.apply(this,arguments):
            this.each(function(){(c?b:z(this))?v(this).show():v(this).hide()})}});v.extend({cssHooks:{opacity:{get:function(b,e){if(e)return b=ca(b,"opacity"),""===b?"1":b}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":v.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,c,f,d){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var g,h=v.camelCase(c),k=e.style;c=v.cssProps[h]||(v.cssProps[h]=y(k,h));var q=v.cssHooks[c]||v.cssHooks[h];
            if(f!==b){var l=typeof f;"string"===l&&(g=Cb.exec(f))&&(f=(g[1]+1)*g[2]+parseFloat(v.css(e,c)),l="number");if(!(null==f||"number"===l&&isNaN(f)||("number"!==l||v.cssNumber[h]||(f+="px"),q&&"set"in q&&(f=q.set(e,f,d))===b)))try{k[c]=f}catch(Ob){}}else return q&&"get"in q&&(g=q.get(e,!1,d))!==b?g:k[c]}},css:function(e,c,f,d){var g;var h=v.camelCase(c);c=v.cssProps[h]||(v.cssProps[h]=y(e.style,h));(h=v.cssHooks[c]||v.cssHooks[h])&&"get"in h&&(g=h.get(e,!0,d));g===b&&(g=ca(e,c));"normal"===g&&c in Za&&
        (g=Za[c]);return f||d!==b?(e=parseFloat(g),f||v.isNumeric(e)?e||0:g):g},swap:function(b,e,c){var f,d={};for(f in e)d[f]=b.style[f],b.style[f]=e[f];c=c.call(b);for(f in e)b.style[f]=d[f];return c}});d.getComputedStyle?ca=function(b,e){var c=d.getComputedStyle(b,null),f=b.style;if(c){var g=c.getPropertyValue(e)||c[e];""!==g||v.contains(b.ownerDocument,b)||(g=v.style(b,e));if(ya.test(g)&&Ya.test(e)){b=f.width;e=f.minWidth;var h=f.maxWidth;f.minWidth=f.maxWidth=f.width=g;g=c.width;f.width=b;f.minWidth=
        e;f.maxWidth=h}}return g}:E.documentElement.currentStyle&&(ca=function(b,e){var c,f=b.currentStyle&&b.currentStyle[e],d=b.style;null==f&&d&&d[e]&&(f=d[e]);if(ya.test(f)&&!Ab.test(e)){var g=d.left;if(c=b.runtimeStyle&&b.runtimeStyle.left)b.runtimeStyle.left=b.currentStyle.left;d.left="fontSize"===e?"1em":f;f=d.pixelLeft+"px";d.left=g;c&&(b.runtimeStyle.left=c)}return""===f?"auto":f});v.each(["height","width"],function(b,e){v.cssHooks[e]={get:function(b,c,f){if(c)return 0===b.offsetWidth&&Bb.test(ca(b,
            "display"))?v.swap(b,Db,function(){return D(b,e,f)}):D(b,e,f)},set:function(b,c,f){return C(b,c,f?B(b,e,f,v.support.boxSizing&&"border-box"===v.css(b,"boxSizing")):0)}}});v.support.opacity||(v.cssHooks.opacity={get:function(b,e){return zb.test((e&&b.currentStyle?b.currentStyle.filter:b.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(b,e){var c=b.style;b=b.currentStyle;var f=v.isNumeric(e)?"alpha(opacity="+100*e+")":"",d=b&&b.filter||c.filter||"";c.zoom=1;if(1<=e&&""===v.trim(d.replace(La,
            ""))&&c.removeAttribute&&(c.removeAttribute("filter"),b&&!b.filter))return;c.filter=La.test(d)?d.replace(La,f):d+" "+f}});v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(b,e){return v.swap(b,{display:"inline-block"},function(){if(e)return ca(b,"marginRight")})}});!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],function(b,e){v.cssHooks[e]={get:function(b,c){if(c)return c=ca(b,e),ya.test(c)?v(b).position()[e]+"px":c}}})});v.expr&&v.expr.filters&&(v.expr.filters.hidden=
        function(b){return 0===b.offsetWidth&&0===b.offsetHeight||!v.support.reliableHiddenOffsets&&"none"===(b.style&&b.style.display||ca(b,"display"))},v.expr.filters.visible=function(b){return!v.expr.filters.hidden(b)});v.each({margin:"",padding:"",border:"Width"},function(b,e){v.cssHooks[b+e]={expand:function(c){var f="string"===typeof c?c.split(" "):[c],d={};for(c=0;4>c;c++)d[b+ma[c]+e]=f[c]||f[c-2]||f[0];return d}};Ya.test(b)||(v.cssHooks[b+e].set=C)});var Fb=/%20/g,gb=/\[\]$/,$a=/\r?\n/g,Gb=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,
        Hb=/^(?:select|textarea)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?v.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Hb.test(this.nodeName)||Gb.test(this.type))}).map(function(b,e){b=v(this).val();return null==b?null:v.isArray(b)?v.map(b,function(b,c){return{name:e.name,value:b.replace($a,"\r\n")}}):{name:e.name,value:b.replace($a,"\r\n")}}).get()}});
    v.param=function(e,c){var f,d=[],g=function(b,e){e=v.isFunction(e)?e():null==e?"":e;d[d.length]=encodeURIComponent(b)+"="+encodeURIComponent(e)};c===b&&(c=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(e)||e.jqx&&!v.isPlainObject(e))v.each(e,function(){g(this.name,this.value)});else for(f in e)I(f,e[f],c,g);return d.join("&").replace(Fb,"+")};v.support.ajax&&v.ajaxTransport(function(e){if(!e.crossDomain||v.support.cors){var c;return{send:function(f,g){var h,k=e.xhr();e.username?k.open(e.type,
            e.url,e.async,e.username,e.password):k.open(e.type,e.url,e.async);if(e.xhrFields)for(h in e.xhrFields)k[h]=e.xhrFields[h];e.mimeType&&k.overrideMimeType&&k.overrideMimeType(e.mimeType);e.crossDomain||f["X-Requested-With"]||(f["X-Requested-With"]="XMLHttpRequest");try{for(h in f)k.setRequestHeader(h,f[h])}catch(Nb){}k.send(e.hasContent&&e.data||null);c=function(f,d){var h;try{if(c&&(d||4===k.readyState))if(c=b,q&&(k.onreadystatechange=v.noop,xhrOnUnloadAbort&&delete xhrCallbacks[q]),d)4!==k.readyState&&
        k.abort();else{var l=k.status;var u=k.getAllResponseHeaders();var m={};(h=k.responseXML)&&h.documentElement&&(m.xml=h);try{m.text=k.responseText}catch(xa){}try{var p=k.statusText}catch(xa){p=""}l||!e.isLocal||e.crossDomain?1223===l&&(l=204):l=m.text?200:404}}catch(xa){d||g(-1,xa)}m&&g(l,p,m,u)};if(e.async)if(4===k.readyState)setTimeout(c,0);else{var q=++xhrId;xhrOnUnloadAbort&&(xhrCallbacks||(xhrCallbacks={},v(d).unload(xhrOnUnloadAbort)),xhrCallbacks[q]=c);k.onreadystatechange=c}else c()},abort:function(){c&&
        c(0,1)}}}});var sa,Da,Ib=/^(?:toggle|show|hide)$/,Jb=new RegExp("^(?:([-+])=|)("+X+")([a-z%]*)$","i"),Kb=/queueHooks$/,za=[function(b,e,c){var f,d=this,g=b.style,h={},k=[],q=b.nodeType&&z(b);if(!c.queue){var l=v._queueHooks(b,"fx");if(null==l.unqueued){l.unqueued=0;var u=l.empty.fire;l.empty.fire=function(){l.unqueued||u()}}l.unqueued++;d.always(function(){d.always(function(){l.unqueued--;v.queue(b,"fx").length||l.empty.fire()})})}1===b.nodeType&&("height"in e||"width"in e)&&(c.overflow=[g.overflow,
        g.overflowX,g.overflowY],"inline"===v.css(b,"display")&&"none"===v.css(b,"float")&&(v.support.inlineBlockNeedsLayout&&"inline"!==K(b.nodeName)?g.zoom=1:g.display="inline-block"));c.overflow&&(g.overflow="hidden",v.support.shrinkWrapBlocks||d.done(function(){g.overflow=c.overflow[0];g.overflowX=c.overflow[1];g.overflowY=c.overflow[2]}));for(f in e){var m=e[f];if(Ib.exec(m)){delete e[f];var p=p||"toggle"===m;m!==(q?"hide":"show")&&k.push(f)}}if(e=k.length)for(m=v._data(b,"fxshow")||v._data(b,"fxshow",
        {}),("hidden"in m)&&(q=m.hidden),p&&(m.hidden=!q),q?v(b).show():d.done(function(){v(b).hide()}),d.done(function(){var e;v.removeData(b,"fxshow",!0);for(e in h)v.style(b,e,h[e])}),f=0;f<e;f++){p=k[f];var y=d.createTween(p,q?m[p]:0);h[p]=m[p]||v.style(b,p);p in m||(m[p]=y.start,q&&(y.end=y.start,y.start="width"===p||"height"===p?1:0))}}],va={"*":[function(b,e){var c=this.createTween(b,e),f=Jb.exec(e),d=c.cur(),g=+d||0,h=1,k=20;if(f){e=+f[2];var q=f[3]||(v.cssNumber[b]?"":"px");if("px"!==q&&g){g=v.css(c.elem,
            b,!0)||e||1;do h=h||".5",g/=h,v.style(c.elem,b,g+q);while(h!==(h=c.cur()/d)&&1!==h&&--k)}c.unit=q;c.start=g;c.end=f[1]?g+(f[1]+1)*e:e}return c}]};v.Animation=v.extend(N,{tweener:function(b,e){v.isFunction(b)?(e=b,b=["*"]):b=b.split(" ");for(var c,f=0,d=b.length;f<d;f++)c=b[f],va[c]=va[c]||[],va[c].unshift(e)},prefilter:function(b,e){e?za.unshift(b):za.push(b)}});v.Tween=J;J.prototype={constructor:J,init:function(b,e,c,f,d,g){this.elem=b;this.prop=c;this.easing=d||"swing";this.options=e;this.start=
            this.now=this.cur();this.end=f;this.unit=g||(v.cssNumber[c]?"":"px")},cur:function(){var b=J.propHooks[this.prop];return b&&b.get?b.get(this):J.propHooks._default.get(this)},run:function(b){var e,c=J.propHooks[this.prop];this.pos=this.options.duration?e=v.easing[this.easing](b,this.options.duration*b,0,1,this.options.duration):e=b;this.now=(this.end-this.start)*e+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);c&&c.set?c.set(this):J.propHooks._default.set(this);return this}};
    J.prototype.init.prototype=J.prototype;J.propHooks={_default:{get:function(b){return null==b.elem[b.prop]||b.elem.style&&null!=b.elem.style[b.prop]?(b=v.css(b.elem,b.prop,!1,""))&&"auto"!==b?b:0:b.elem[b.prop]},set:function(b){if(v.fx.step[b.prop])v.fx.step[b.prop](b);else b.elem.style&&(null!=b.elem.style[v.cssProps[b.prop]]||v.cssHooks[b.prop])?v.style(b.elem,b.prop,b.now+b.unit):b.elem[b.prop]=b.now}}};J.propHooks.scrollTop=J.propHooks.scrollLeft={set:function(b){b.elem.nodeType&&b.elem.parentNode&&
        (b.elem[b.prop]=b.now)}};v.each(["toggle","show","hide"],function(b,e){var c=v.fn[e];v.fn[e]=function(f,d,g){return null==f||"boolean"===typeof f||!b&&v.isFunction(f)&&v.isFunction(d)?c.apply(this,arguments):this.animate(O(e,!0),f,d,g)}});v.fn.extend({fadeTo:function(b,e,c,f){return this.filter(z).css("opacity",0).show().end().animate({opacity:e},b,c,f)},animate:function(b,e,c,f){var d=v.isEmptyObject(b),g=v.speed(e,c,f);e=function(){var e=N(this,v.extend({},b),g);d&&e.stop(!0)};return d||!1===g.queue?
            this.each(e):this.queue(g.queue,e)},stop:function(e,c,f){var d=function(b){var e=b.stop;delete b.stop;e(f)};"string"!==typeof e&&(f=c,c=e,e=b);c&&!1!==e&&this.queue(e||"fx",[]);return this.each(function(){var b=!0,c=null!=e&&e+"queueHooks",g=v.timers,h=v._data(this);if(c)h[c]&&h[c].stop&&d(h[c]);else for(c in h)h[c]&&h[c].stop&&Kb.test(c)&&d(h[c]);for(c=g.length;c--;)g[c].elem!==this||null!=e&&g[c].queue!==e||(g[c].anim.stop(f),b=!1,g.splice(c,1));!b&&f||v.dequeue(this,e)})}});v.each({slideDown:O("show"),
        slideUp:O("hide"),slideToggle:O("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(b,e){v.fn[b]=function(b,c,f){return this.animate(e,b,c,f)}});v.speed=function(b,e,c){var f=b&&"object"===typeof b?v.extend({},b):{complete:c||!c&&e||v.isFunction(b)&&b,duration:b,easing:c&&e||e&&!v.isFunction(e)&&e};f.duration=v.fx.off?0:"number"===typeof f.duration?f.duration:f.duration in v.fx.speeds?v.fx.speeds[f.duration]:v.fx.speeds._default;if(null==f.queue||!0===
        f.queue)f.queue="fx";f.old=f.complete;f.complete=function(){v.isFunction(f.old)&&f.old.call(this);f.queue&&v.dequeue(this,f.queue)};return f};v.easing={linear:function(b){return b},swing:function(b){return.5-Math.cos(b*Math.PI)/2}};v.timers=[];v.fx=J.prototype.init;v.fx.tick=function(){var e=v.timers,c=0;for(sa=v.now();c<e.length;c++){var f=e[c];f()||e[c]!==f||e.splice(c--,1)}e.length||v.fx.stop();sa=b};v.fx.timer=function(b){b()&&v.timers.push(b)&&!Da&&(Da=setInterval(v.fx.tick,v.fx.interval))};
    v.fx.interval=13;v.fx.stop=function(){clearInterval(Da);Da=null};v.fx.speeds={slow:600,fast:200,_default:400};v.fx.step={};v.expr&&v.expr.filters&&(v.expr.filters.animated=function(b){return v.grep(v.timers,function(e){return b===e.elem}).length});var ab=/^(?:body|html)$/i;v.fn.offset=function(e){if(arguments.length)return e===b?this:this.each(function(b){v.offset.setOffset(this,e,b)});var c,f,d,g={top:0,left:0};if(d=(f=this[0])&&f.ownerDocument){if((c=d.body)===f)return v.offset.bodyOffset(f);var h=
        d.documentElement;if(!v.contains(h,f))return g;"undefined"!==typeof f.getBoundingClientRect&&(g=f.getBoundingClientRect());f=L(d);d=h.clientTop||c.clientTop||0;c=h.clientLeft||c.clientLeft||0;var k=f.pageYOffset||h.scrollTop;return{top:g.top+k-d,left:g.left+(f.pageXOffset||h.scrollLeft)-c}}};v.offset={bodyOffset:function(b){var e=b.offsetTop,c=b.offsetLeft;v.support.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat(v.css(b,"marginTop"))||0,c+=parseFloat(v.css(b,"marginLeft"))||0);return{top:e,left:c}},
        setOffset:function(b,e,c){var f=v.css(b,"position");"static"===f&&(b.style.position="relative");var d=v(b),g=d.offset(),h=v.css(b,"top"),k=v.css(b,"left"),q={};("absolute"===f||"fixed"===f)&&-1<v.inArray("auto",[h,k])?(k=d.position(),f=k.top,k=k.left):(f=parseFloat(h)||0,k=parseFloat(k)||0);v.isFunction(e)&&(e=e.call(b,c,g));null!=e.top&&(q.top=e.top-g.top+f);null!=e.left&&(q.left=e.left-g.left+k);"using"in e?e.using.call(b,q):d.css(q)}};v.fn.extend({isRendered:function(){var b=this[0];return null==
        b.parentNode||0===b.offsetWidth||0===b.offsetHeight?!1:!0},getSizeFromStyle:function(){var b=null,e=null,c=this[0];c.style.width&&(b=c.style.width);c.style.height&&(e=c.style.height);if(c=d.getComputedStyle?getComputedStyle(c,null):c.currentStyle)c.width&&(b=c.width),c.height&&(e=c.height);"0px"===b&&(b=0);"0px"===e&&(e=0);null===b&&(b=0);null===e&&(e=0);return{width:b,height:e}},initAnimate:function(){},sizeStyleChanged:function(b){var e=this,c=function(b){var c=f;b&&b[0]&&"style"===b[0].attributeName&&
        "attributes"===b[0].type&&(c.element.offsetWidth!==c.offsetWidth||c.element.offsetHeight!==c.offsetHeight)&&(c.offsetWidth=c.element.offsetWidth,c.offsetHeight=c.element.offsetHeight,e.isRendered()&&c.callback())};var f={element:e[0],offsetWidth:e[0].offsetWidth,offsetHeight:e[0].offsetHeight,callback:b};try{e.elementStyleObserver||(e.elementStyleObserver=new MutationObserver(c),e.elementStyleObserver.observe(e[0],{attributes:!0,childList:!1,characterData:!1}))}catch(db){}},position:function(){if(this[0]){var b=
            this[0],e=this.offsetParent(),c=this.offset(),f=ab.test(e[0].nodeName)?{top:0,left:0}:e.offset();c.top-=parseFloat(v.css(b,"marginTop"))||0;c.left-=parseFloat(v.css(b,"marginLeft"))||0;f.top+=parseFloat(v.css(e[0],"borderTopWidth"))||0;f.left+=parseFloat(v.css(e[0],"borderLeftWidth"))||0;return{top:c.top-f.top,left:c.left-f.left}}},offsetParent:function(){return this.map(function(){for(var b=this.offsetParent||E.body;b&&!ab.test(b.nodeName)&&"static"===v.css(b,"position");)b=b.offsetParent;return b||
            E.body})}});v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,c){var f=/Y/.test(c);v.fn[e]=function(d){return v.access(this,function(e,d,g){var h=L(e);if(g===b)return h?c in h?h[c]:h.document.documentElement[d]:e[d];h?h.scrollTo(f?v(h).scrollLeft():g,f?g:v(h).scrollTop()):e[d]=g},e,d,arguments.length,null)}});v.each({Height:"height",Width:"width"},function(e,c){v.each({padding:"inner"+e,content:c,"":"outer"+e},function(f,d){v.fn[d]=function(d,g){var h=arguments.length&&(f||"boolean"!==
        typeof d),k=f||(!0===d||!0===g?"margin":"border");return v.access(this,function(c,f,d){return v.isWindow(c)?c.document.documentElement["client"+e]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+e],f["scroll"+e],c.body["offset"+e],f["offset"+e],f["client"+e])):d===b?v.css(c,f,d,k):v.style(c,f,d,k)},c,h?d:b,h,null)}})});d.JQXLite=d.jqxHelper=v;"function"===typeof define&&define.amd&&define.amd.JQXLite&&define("jqx",[],function(){return v})}(window);
(function(d){d.jQuery?d.minQuery=d.JQXLite=d.jQuery:d.$?d.minQuery=d.JQXLite=d.$:d.$=d.minQuery=d.JQXLite})(window);JQXLite.generateID=function(){var d=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},b="";do b="jqx"+d()+d()+d();while(0<$("#"+b).length);return b};var jqxBaseFramework=window.jqxBaseFramework=window.minQuery||window.jQuery;
(function(d){d.jqx=d.jqx||{};window.jqx=d.jqx;var b={createInstance:function(b,e,f){if("jqxDataAdapter"==e)return new d.jqx.dataAdapter(f[0],f[1]||{});d(b)[e](f||{});return d(b)[e]("getInstance")}};window.jqwidgets=b;d.jqx.define=function(b,e,f){b[e]=function(){this.baseType&&(this.base=new b[this.baseType],this.base.defineInstance());this.defineInstance();this.metaInfo()};b[e].prototype.defineInstance=function(){};b[e].prototype.metaInfo=function(){};b[e].prototype.base=null;b[e].prototype.baseType=
    void 0;f&&b[f]&&(b[e].prototype.baseType=f)};d.jqx.invoke=function(b,e){if(0!=e.length){var c=typeof e==Array||0<e.length?e[0]:e;for(e=typeof e==Array||1<e.length?Array.prototype.slice.call(e,1):d({}).toArray();void 0==b[c]&&null!=b.base;){if(void 0!=b[c]&&d.isFunction(b[c]))return b[c].apply(b,e);if("string"==typeof c){var g=c.toLowerCase();if(void 0!=b[g]&&d.isFunction(b[g]))return b[g].apply(b,e)}b=b.base}if(void 0!=b[c]&&d.isFunction(b[c]))return b[c].apply(b,e);if("string"==typeof c&&(g=c.toLowerCase(),
void 0!=b[g]&&d.isFunction(b[g])))return b[g].apply(b,e)}};d.jqx.getByPriority=function(b){for(var e=void 0,c=0;c<b.length&&void 0==e;c++)void 0==e&&void 0!=b[c]&&(e=b[c]);return e};d.jqx.hasProperty=function(b,e){if("object"==typeof e)for(var c in e){for(;b;){if(b.hasOwnProperty(c)||b.hasOwnProperty(c.toLowerCase()))return!0;b=b.base}break}else for(;b;){if(b.hasOwnProperty(e)||b.hasOwnProperty(e.toLowerCase()))return!0;b=b.base}return!1};d.jqx.hasFunction=function(b,e){if(0==e.length||void 0==b)return!1;
    var c=typeof e==Array||0<e.length?e[0]:e;for((typeof e==Array||1<e.length)&&Array.prototype.slice.call(e,1);void 0==b[c]&&null!=b.base;){if(b[c]&&d.isFunction(b[c])||"string"==typeof c&&(e=c.toLowerCase(),b[e]&&d.isFunction(b[e])))return!0;b=b.base}return b[c]&&d.isFunction(b[c])||"string"==typeof c&&(e=c.toLowerCase(),b[e]&&d.isFunction(b[e]))?!0:!1};d.jqx.isPropertySetter=function(b,e){return 1==e.length&&"object"==typeof e[0]||2==e.length&&"string"==typeof e[0]&&!d.jqx.hasFunction(b,e)?!0:!1};
    d.jqx.validatePropertySetter=function(b,e,f){if(!d.jqx.propertySetterValidation)return!0;if(1==e.length&&"object"==typeof e[0]){for(var c in e[0]){for(e=b;!e.hasOwnProperty(c)&&e.base;)e=e.base;if(!e||!e.hasOwnProperty(c)){if(!f)if(e.hasOwnProperty(c.toString().toLowerCase()))break;else throw"Invalid property: "+c;return!1}}return!0}if(2!=e.length){if(!f)throw 0<="Invalid property: "+e.length?e[0]:"";return!1}for(;!b.hasOwnProperty(e[0])&&b.base;)b=b.base;if(!b||!b.hasOwnProperty(e[0])){if(!f)throw"Invalid property: "+
    e[0];return!1}return!0};Object.keys||(Object.keys=function(){var b=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),f="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),d=f.length;return function(c){if("object"!==typeof c&&("function"!==typeof c||null===c))throw new TypeError("Object.keys called on non-object");var g=[],h;for(h in c)b.call(c,h)&&g.push(h);if(e)for(h=0;h<d;h++)b.call(c,f[h])&&g.push(f[h]);return g}}());
    d.jqx.set=function(b,e){var c=0;if(1==e.length&&"object"==typeof e[0]){if(b.isInitialized&&Object.keys&&1<Object.keys(e[0]).length){var g=d.data(b.base?b.base.element:b.element,b.widgetName).initArgs;if(g&&JSON&&JSON.stringify&&e[0]&&g[0])try{if(JSON.stringify(e[0])==JSON.stringify(g[0])){var h=!0;d.each(e[0],function(e,c){if(b[e]!=c)return h=!1});if(h)return}}catch(m){}b.batchUpdate=e[0];var k={},l={};d.each(e[0],function(e,f){for(var d=b;!d.hasOwnProperty(e)&&null!=d.base;)d=d.base;d.hasOwnProperty(e)?
        b[e]!=f&&(k[e]=b[e],l[e]=f,c++):d.hasOwnProperty(e.toLowerCase())&&b[e.toLowerCase()]!=f&&(k[e.toLowerCase()]=b[e.toLowerCase()],l[e.toLowerCase()]=f,c++)});2>c&&(b.batchUpdate=null)}d.each(e[0],function(e,c){for(var f=b;!f.hasOwnProperty(e)&&null!=f.base;)f=f.base;if(f.hasOwnProperty(e))d.jqx.setvalueraiseevent(f,e,c);else if(f.hasOwnProperty(e.toLowerCase()))d.jqx.setvalueraiseevent(f,e.toLowerCase(),c);else if(d.jqx.propertySetterValidation)throw"jqxCore: invalid property '"+e+"'";});null!=b.batchUpdate&&
    (b.batchUpdate=null,b.propertiesChangedHandler&&1<c&&b.propertiesChangedHandler(b,k,l))}else if(2==e.length){for(;!b.hasOwnProperty(e[0])&&b.base;)b=b.base;if(b.hasOwnProperty(e[0]))d.jqx.setvalueraiseevent(b,e[0],e[1]);else if(b.hasOwnProperty(e[0].toLowerCase()))d.jqx.setvalueraiseevent(b,e[0].toLowerCase(),e[1]);else if(d.jqx.propertySetterValidation)throw"jqxCore: invalid property '"+e[0]+"'";}};d.jqx.setvalueraiseevent=function(b,e,f){var c=b[e];b[e]=f;if(b.isInitialized&&(void 0!=b.propertyChangedHandler&&
    b.propertyChangedHandler(b,e,c,f),void 0!=b.propertyChangeMap&&void 0!=b.propertyChangeMap[e]))b.propertyChangeMap[e](b,e,c,f)};d.jqx.get=function(b,e){if(void 0!=e&&null!=e){if(b.propertyMap){var c=b.propertyMap(e);if(null!=c)return c}if(b.hasOwnProperty(e))return b[e];if(b.hasOwnProperty(e.toLowerCase()))return b[e.toLowerCase()];c=void 0;if(typeof e==Array){if(1!=e.length)return;c=e[0]}else"string"==typeof e&&(c=e);for(;!b.hasOwnProperty(c)&&b.base;)b=b.base;if(b)return b[c]}};d.jqx.serialize=
        function(b){if(d.isArray(b)){var e="[";for(var c=0;c<b.length;c++)0<c&&(e+=", "),e+=d.jqx.serialize(b[c]);e+="]"}else if("object"==typeof b){e="{";var g=0;for(c in b)0<g++&&(e+=", "),e+=c+": "+d.jqx.serialize(b[c]);e+="}"}else e=b.toString();return e};d.jqx.propertySetterValidation=!0;d.jqx.jqxWidgetProxy=function(b,e,f){d(e);b=d.data(e,b);if(void 0!=b){b=b.instance;if(d.jqx.hasFunction(b,f))return d.jqx.invoke(b,f);if(d.jqx.isPropertySetter(b,f)){if(d.jqx.validatePropertySetter(b,f)){d.jqx.set(b,
        f);return}}else{if("object"==typeof f&&0==f.length)return;if("object"==typeof f&&1==f.length&&d.jqx.hasProperty(b,f[0]))return d.jqx.get(b,f[0]);if("string"==typeof f&&d.jqx.hasProperty(b,f[0]))return d.jqx.get(b,f)}throw"jqxCore: Invalid parameter '"+d.jqx.serialize(f)+"' does not exist.";}};d.jqx.applyWidget=function(b,e,f,g){var c=!1;try{c=void 0!=window.MSApp}catch(r){}var k=d(b);g?(g.host=k,g.element=b):g=new d.jqx["_"+e];""==b.id&&(b.id=d.jqx.utilities.createId());var l={host:k,element:b,instance:g,
        initArgs:f};g.widgetName=e;d.data(b,e,l);d.data(b,"jqxWidget",l.instance);var m=[];for(g=l.instance;g;)g.isInitialized=!1,m.push(g),g=g.base;m.reverse();m[0].theme=d.jqx.theme||"";d.jqx.jqxWidgetProxy(e,b,f);for(var p in m)g=m[p],0==p&&(g.host=k,g.element=b,g.WinJS=c),void 0!=g&&(g.definedInstance&&g.definedInstance(),null!=g.createInstance&&(c?MSApp.execUnsafeLocalFunction(function(){g.createInstance(f)}):g.createInstance(f)));for(p in m)void 0!=m[p]&&(m[p].isInitialized=!0);c?MSApp.execUnsafeLocalFunction(function(){l.instance.refresh(!0)}):
        l.instance.refresh(!0)};d.jqx.jqxWidget=function(c,e,f){try{Array.prototype.slice.call(f,0)}catch(l){}var g="";e&&(g="_"+e);d.jqx.define(d.jqx,"_"+c,g);var h=[];if(!window[c]){var k=function(b){if(null==b)return"";switch(d.type(b)){case "string":case "number":case "date":case "boolean":case "bool":return null===b?"":b.toString()}var e="";d.each(b,function(b,c){0<b&&(e+=", ");e+="[";var f=0;if("object"==d.type(c))for(var g in c)0<f&&(e+=", "),e+="{"+g+":"+c[g]+"}",f++;else 0<f&&(e+=", "),e+="{"+b+
        ":"+c+"}";e+="]"});return e};b[c]=window[c]=function(b,e){var f=[];e||(e={});f.push(e);var g=b;"object"===d.type(g)&&b[0]?(g=b[0].id,""===g&&(g=b[0].id=d.jqx.utilities.createId())):"object"===d.type(b)&&b&&b.nodeName&&(g=b.id,""===g&&(g=b.id=d.jqx.utilities.createId()));if(window.jqxWidgets&&window.jqxWidgets[g]){e&&d.each(window.jqxWidgets[g],function(b){if((b=d(this.element).data())&&b.jqxWidget)d(this.element)[c](e)});if(1==window.jqxWidgets[g].length){var l=d(window.jqxWidgets[g][0].widgetInstance.element).data();
        if(l&&l.jqxWidget)return window.jqxWidgets[g][0]}if((l=d(window.jqxWidgets[g][0].widgetInstance.element).data())&&l.jqxWidget)return window.jqxWidgets[g]}var m=d(b);if(0===m.length){m=d("<div></div>");if("jqxInput"===c||"jqxPasswordInput"===c||"jqxMaskedInput"===c)m=d("<input/>");"jqxTextArea"===c&&(m=d("<textarea></textarea>"));if("jqxButton"===c||"jqxRepeatButton"===c||"jqxToggleButton"===c)m=d("<button/>");"jqxSplitter"===c&&(m=d("<div><div>Panel 1</div><div>Panel 2</div></div>"));"jqxTabs"===
    c&&(m=d("<div><ul><li>Tab 1</li><li>Tab 2</li></ul><div>Content 1</div><div>Content 2</div></div>"));"jqxRibbon"===c&&(m=d("<div><ul><li>Tab 1</li><li>Tab 2</li></ul><div><div>Content 1</div><div>Content 2</div></div></div>"));"jqxDocking"===c&&(m=d("<div><div><div><div>Title 1</div><div>Content 1</div></div></div></div>"));"jqxWindow"===c&&(m=d("<div><div>Title 1</div><div>Content 1</div></div>"))}var q=[];d.each(m,function(b){b=m[b];d.jqx.applyWidget(b,c,f,void 0);if(!h[c]){var e=d.data(b,"jqxWidget");
        e=d.jqx["_"+c].prototype.defineInstance();d.jqx["_"+c].prototype.metaInfo&&d.jqx["_"+c].prototype.metaInfo();"jqxDockingLayout"==c&&(e=d.extend(e,d.jqx._jqxLayout.prototype.defineInstance()));if("jqxToggleButton"==c||"jqxRepeatButton"==c)e=d.extend(e,d.jqx._jqxButton.prototype.defineInstance());"jqxTreeGrid"==c&&(e=d.extend(e,d.jqx._jqxDataTable.prototype.defineInstance()));var l=function(b){this.widgetInstance=b=d.data(b,"jqxWidget");var e=d.extend(this,b);e.on=e.addEventListener=function(b,c){e.addHandler(e.base?
            e.base.host:e.host,b,c)};e.off=e.removeEventListener=function(b){e.removeHandler(e.base?e.base.host:e.host,b)};for(var c in b)"function"==d.type(b[c])&&(e[c]=d.proxy(b[c],b));return e};h[c]=l;d.each(e,function(b,e){Object.defineProperty(l.prototype,b,{get:function(){return this.widgetInstance?this.widgetInstance[b]:e},set:function(e){if(this.widgetInstance&&(this.widgetInstance[b]!=e||"width"===b||"height"===b)){var f=this.widgetInstance[b],g=d.type(f),h=d.type(e),q=!1;if(g!=h||"source"===b||"width"===
                b||"height"===b)q=!0;if(q||k(f)!=k(e)){g={};g[b]=e;if(this.widgetInstance.host)this.widgetInstance.host[c](g);else this.widgetInstance.base.host[c](g);this.widgetInstance[b]=e;this.widgetInstance.propertyUpdated&&this.widgetInstance.propertyUpdated(b,f,e)}}}})})}e=new h[c](b);q.push(e);window.jqxWidgets||(window.jqxWidgets=[]);window.jqxWidgets[g]||(window.jqxWidgets[g]=[]);window.jqxWidgets[g].push(e)});return 1===q.length?q[0]:q}}d.fn[c]=function(){var b=Array.prototype.slice.call(arguments,0);
        if(0==b.length||1==b.length&&"object"==typeof b[0]){if(0==this.length){if(this.selector)throw Error("Invalid Selector - "+this.selector+"! Please, check whether the used ID or CSS Class name is correct.");throw Error("Invalid Selector! Please, check whether the used ID or CSS Class name is correct.");}return this.each(function(){d(this);null==d.data(this,c)?d.jqx.applyWidget(this,c,b,void 0):d.jqx.jqxWidgetProxy(c,this,b)})}if(0==this.length){if(this.selector)throw Error("Invalid Selector - "+this.selector+
            "! Please, check whether the used ID or CSS Class name is correct.");throw Error("Invalid Selector! Please, check whether the used ID or CSS Class name is correct.");}var e=null,f=0;this.each(function(){var g=d.jqx.jqxWidgetProxy(c,this,b);if(0==f)e=g,f++;else{if(1==f){var h=[];h.push(e);e=h}e.push(g)}});return e};try{d.extend(d.jqx["_"+c].prototype,Array.prototype.slice.call(f,0)[0])}catch(l){}d.extend(d.jqx["_"+c].prototype,{toThemeProperty:function(b,e){return d.jqx.toThemeProperty(this,b,e)},
        isMaterialized:function(){if(!this.theme)return!1;if(0<=this.theme.indexOf("material"))return!0},isModern:function(){if(!this.theme)return!1;if(0<=this.theme.indexOf("light")||"dark"===this.theme)return!0},_addBarAndLabel:function(b){var e=d("<label></label");e[0].innerHTML=this.placeHolder;e.addClass(this.toThemeProperty("jqx-input-label"));b.after(e);this.label=e;e=d("<span></span>");b.after(e);e.addClass(this.toThemeProperty("jqx-input-bar"));this.bar=e;this.bar.css("top",this.host.height())}});
        d.jqx["_"+c].prototype.refresh=function(){this.base&&this.base.refresh(!0)};d.jqx["_"+c].prototype.createInstance=function(){};d.jqx["_"+c].prototype.addEventHandler=function(b,e){if(this.base)this.base.host.on(b,e);else this.host.on(b,e)};d.jqx["_"+c].prototype.removeEventHandler=function(b,e){this.base?this.base.host.off(b):this.host.off(b)};d.jqx["_"+c].prototype.applyTo=function(b,e){if(!(e instanceof Array)){var f=[];f.push(e);e=f}d.jqx.applyWidget(b,c,e,this)};d.jqx["_"+c].prototype.getInstance=
            function(){return this};d.jqx["_"+c].prototype.propertyChangeMap={};d.jqx["_"+c].prototype.addHandler=function(b,e,c,f){d.jqx.addHandler(d(b),e,c,f)};d.jqx["_"+c].prototype.removeHandler=function(b,e,c){d.jqx.removeHandler(d(b),e,c)};d.jqx["_"+c].prototype.setOptions=function(){if(this.host&&this.host.length&&1==this.host.length)return d.jqx.jqxWidgetProxy(c,this.host[0],arguments)}};d.jqx.toThemeProperty=function(b,e,f){if(""==b.theme)return e;e=e.split(" ");for(var c="",d=0;d<e.length;d++){0<d&&
    (c+=" ");var k=e[d];c=null!=f&&f?c+(k+"-"+b.theme):c+(k+" "+k+"-"+b.theme)}return c};d.jqx.addHandler=function(b,e,f,g){e=e.split(" ");for(var c=0;c<e.length;c++){var k=e[c];if(window.addEventListener)switch(k){case "mousewheel":d.jqx.browser.mozilla?b[0].addEventListener("DOMMouseScroll",f,!1):b[0].addEventListener("mousewheel",f,!1);continue;case "mousemove":if(!g){b[0].addEventListener("mousemove",f,!1);continue}break;case "touchmove":if(!g){b[0].addEventListener("touchmove",f,!1);continue}else if(g&&
        g.passive){b[0].addEventListener("touchmove",f,g);continue}}if(void 0==g||null==g)if(b.on)b.on(k,f);else b.bind(k,f);else if(b.on)b.on(k,g,f);else b.bind(k,g,f)}};d.jqx.removeHandler=function(b,e,f){if(e){e=e.split(" ");for(var c=0;c<e.length;c++){var h=e[c];if(window.removeEventListener)switch(h){case "mousewheel":d.jqx.browser.mozilla?b[0].removeEventListener("DOMMouseScroll",f,!1):b[0].removeEventListener("mousewheel",f,!1);continue;case "mousemove":if(f){b[0].removeEventListener("mousemove",f,
        !1);continue}break;case "touchmove":if(f){b[0].removeEventListener("touchmove",f,!1);continue}}void 0==h?b.off?b.off():b.unbind():void 0==f?b.off?b.off(h):b.unbind(h):b.off?b.off(h,f):b.unbind(h,f)}}else b.off?b.off():b.unbind()};d.jqx.credits=d.jqx.credits||"";d.jqx.theme=d.jqx.theme||"";d.jqx.scrollAnimation=d.jqx.scrollAnimation||!1;d.jqx.resizeDelay=d.jqx.resizeDelay||10;d.jqx.ready=function(){d(window).trigger("jqxReady")};d.jqx.init=function(b){d.each(b,function(b,c){"theme"==b&&(d.jqx.theme=
        c);"scrollBarSize"==b&&(d.jqx.utilities.scrollBarSize=c);"touchScrollBarSize"==b&&(d.jqx.utilities.touchScrollBarSize=c);"scrollBarButtonsVisibility"==b&&(d.jqx.utilities.scrollBarButtonsVisibility=c)})};d.jqx.utilities=d.jqx.utilities||{};d.extend(d.jqx.utilities,{scrollBarSize:13,touchScrollBarSize:8,scrollBarButtonsVisibility:"visible",createId:function(){var b=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return"jqxWidget"+b()+b()+b()},setTheme:function(b,e,f){if("undefined"!==
            typeof f&&f[0].className.split){void 0===b&&(b="");void 0===e&&(e="");for(var c=f[0].className.split(" "),h=[],k=[],l=f.children(),m=0;m<c.length;m+=1)0<=c[m].indexOf(b)&&(0<b.length?(h.push(c[m]),k.push(c[m].replace(b,e))):k.push(c[m].replace("-"+e,"")+"-"+e));this._removeOldClasses(h,f);this._addNewClasses(k,f);for(m=0;m<l.length;m+=1)this.setTheme(b,e,d(l[m]))}},_removeOldClasses:function(b,e){for(var c=0;c<b.length;c+=1)e.removeClass(b[c])},_addNewClasses:function(b,e){for(var c=0;c<b.length;c+=
            1)e.addClass(b[c])},getOffset:function(b){var e=d.jqx.mobile.getLeftPos(b[0]);return{top:d.jqx.mobile.getTopPos(b[0]),left:e}},resize:function(b,e,f,g){void 0===g&&(g=!0);var c=-1,k=this,l=function(b){if(!k.hiddenWidgets)return-1;for(var e=-1,c=0;c<k.hiddenWidgets.length;c++)if(b.id){if(k.hiddenWidgets[c].id==b.id){e=c;break}}else if(k.hiddenWidgets[c].id==b[0].id){e=c;break}return e};if(this.resizeHandlers){for(var m=0;m<this.resizeHandlers.length;m++)if(b.id){if(this.resizeHandlers[m].id==b.id){c=
            m;break}}else if(this.resizeHandlers[m].id==b[0].id){c=m;break}if(!0===f){-1!=c&&(this.resizeHandlers.splice(c,1),this.watchedElementData&&0<this.watchedElementData.length&&this.watchedElementData.splice(c,1));0==this.resizeHandlers.length&&(f=d(window),f.off?(f.off("resize.jqx"),f.off("orientationchange.jqx"),f.off("orientationchanged.jqx")):(f.unbind("resize.jqx"),f.unbind("orientationchange.jqx"),f.unbind("orientationchanged.jqx")),this.resizeHandlers=null);b=l(b);-1!=b&&this.hiddenWidgets&&this.hiddenWidgets.splice(b,
            1);return}}else if(!0===f){b=l(b);-1!=b&&this.hiddenWidgets&&this.hiddenWidgets.splice(b,1);return}k=this;var p=function(b,e){if(k.resizeHandlers){var c=function(b){var e=-1;for(b=b.parentNode;b;)e++,b=b.parentNode;return e},f=function(b,e){if(!b.widget||!e.widget)return 0;b=c(b.widget[0]);e=c(e.widget[0]);return b<e?-1:b>e?1:0},g=function(b){if(0<k.hiddenWidgets.length){k.hiddenWidgets.sort(f);var c=function(){for(var b=!1,c=[],f=0;f<k.hiddenWidgets.length;f++){var g=k.hiddenWidgets[f];d.jqx.isHidden(g.widget)?
            (b=!0,c.push(g)):g.callback&&g.callback(e)}k.hiddenWidgets=c;b||clearInterval(k.__resizeInterval)};0==b?(c(),k.__resizeInterval&&clearInterval(k.__resizeInterval)):(k.__resizeInterval&&clearInterval(k.__resizeInterval),k.__resizeInterval=setInterval(function(){c()},100))}};k.hiddenWidgets&&0<k.hiddenWidgets.length&&g(!1);k.hiddenWidgets=[];k.resizeHandlers.sort(f);for(var h=0;h<k.resizeHandlers.length;h++){var q=k.resizeHandlers[h],m=q.widget,p=q.data;if(p&&p.jqxWidget){var t=p.jqxWidget.width,r=
            p.jqxWidget.height;p.jqxWidget.base&&(void 0==t&&(t=p.jqxWidget.base.width),void 0==r&&(r=p.jqxWidget.base.height));void 0===t&&void 0===r&&(t=p.jqxWidget.element.style.width,r=p.jqxWidget.element.style.height);var w=!1;null!=t&&-1!=t.toString().indexOf("%")&&(w=!0);null!=r&&-1!=r.toString().indexOf("%")&&(w=!0);if(d.jqx.isHidden(m))-1===l(m)&&(w||!0===b)&&!0!==q.data.nestedWidget&&k.hiddenWidgets.push(q);else if(void 0===b||!0!==b){if(w){q.callback(e);if(k.watchedElementData)for(m=0;m<k.watchedElementData.length;m++)if(k.watchedElementData[m].element==
            p.jqxWidget.element){k.watchedElementData[m].offsetWidth=p.jqxWidget.element.offsetWidth;k.watchedElementData[m].offsetHeight=p.jqxWidget.element.offsetHeight;break}0<=k.hiddenWidgets.indexOf(q)&&k.hiddenWidgets.splice(k.hiddenWidgets.indexOf(q),1)}p.jqxWidget.element&&(q=p.jqxWidget.element.className,!((0<=q.indexOf("dropdownlist")||0<=q.indexOf("datetimeinput")||0<=q.indexOf("combobox")||0<=q.indexOf("menu"))&&p.jqxWidget.isOpened&&p.jqxWidget.isOpened())||e&&"resize"==e&&d.jqx.mobile.isTouchDevice()||
        p.jqxWidget.close())}}}g()}};this.resizeHandlers||(this.resizeHandlers=[],f=d(window),f.on?(this._initResize=this._resizeTimer=null,f.on("resize.jqx",function(b){void 0!=k._resizeTimer&&clearTimeout(k._resizeTimer);k._initResize?k._resizeTimer=setTimeout(function(){p(null,"resize")},d.jqx.resizeDelay):(k._initResize=!0,p(null,"resize"))}),f.on("orientationchange.jqx",function(b){p(null,"orientationchange")}),f.on("orientationchanged.jqx",function(b){p(null,"orientationchange")})):(f.bind("resize.jqx",
            function(b){p(null,"orientationchange")}),f.bind("orientationchange.jqx",function(b){p(null,"orientationchange")}),f.bind("orientationchanged.jqx",function(b){p(null,"orientationchange")})));f=b.data();g&&-1===c&&this.resizeHandlers.push({id:b[0].id,widget:b,callback:e,data:f});try{var r=f.jqxWidget.width,t=f.jqxWidget.height;f.jqxWidget.base&&(void 0==r&&(r=f.jqxWidget.base.width),void 0==t&&(t=f.jqxWidget.base.height));void 0===r&&void 0===t&&(r=f.jqxWidget.element.style.width,t=f.jqxWidget.element.style.height);
            c=!1;null!=r&&-1!=r.toString().indexOf("%")&&(c=!0);null!=t&&-1!=t.toString().indexOf("%")&&(c=!0);c&&(this.watchedElementData||(this.watchedElementData=[]),k=this,r=function(b){k.watchedElementData.forEach&&k.watchedElementData.forEach(function(b){if(b.element.offsetWidth!==b.offsetWidth||b.element.offsetHeight!==b.offsetHeight)b.offsetWidth=b.element.offsetWidth,b.offsetHeight=b.element.offsetHeight,b.timer&&clearTimeout(b.timer),b.timer=setTimeout(function(){d.jqx.isHidden(d(b.element))?b.timer=
                setInterval(function(){d.jqx.isHidden(d(b.element))||(clearInterval(b.timer),b.callback())},100):b.callback()})})},k.watchedElementData.push({element:b[0],offsetWidth:b[0].offsetWidth,offsetHeight:b[0].offsetHeight,callback:e}),k.observer||(k.observer=new MutationObserver(r),k.observer.observe(document.body,{attributes:!0,childList:!0,characterData:!0})))}catch(w){}d.jqx.isHidden(b)&&!0===g&&p(!0);d.jqx.resize=function(){p(null,"resize")}},parseJSON:function(b){if(!b||"string"!==typeof b)return null;
            b=d.trim(b);if(window.JSON&&window.JSON.parse)return window.JSON.parse(b);if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return(new Function("return "+b))();throw Error("Invalid JSON: "+b);},html:function(b,e){if(!d(b).on)return d(b).html(e);try{return d.access(b,function(e){var c=b[0]||{},f=0,k=b.length;if(void 0===e)return 1===c.nodeType?c.innerHTML.replace(rinlinejQuery,
            ""):void 0;var l=/<(?:script|style|link)/i,m=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,p=/<([\w:]+)/,r=/<(?:abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video)[\s/>]/i,t=/^\s+/,w={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>",
                "</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};if(!("string"!==typeof e||l.test(e)||!d.support.htmlSerialize&&r.test(e)||!d.support.leadingWhitespace&&t.test(e)||w[(p.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(m,"<$1></$2>");try{for(;f<k;f++)c=this[f]||{},1===c.nodeType&&(d.cleanData(c.getElementsByTagName("*")),c.innerHTML=e);c=0}catch(q){}}c&&b.empty().append(e)},null,e,arguments.length)}catch(f){return d(b).html(e)}},
        hasTransform:function(b){var e=b.css("transform");if(""==e||"none"==e)if(e=b.parents().css("transform"),""==e||"none"==e){var c=d.jqx.utilities.getBrowser();if("msie"==c.browser){if(e=b.css("-ms-transform"),""==e||"none"==e)e=b.parents().css("-ms-transform")}else if("chrome"==c.browser){if(e=b.css("-webkit-transform"),""==e||"none"==e)e=b.parents().css("-webkit-transform")}else if("opera"==c.browser){if(e=b.css("-o-transform"),""==e||"none"==e)e=b.parents().css("-o-transform")}else"mozilla"==c.browser&&
        (e=b.css("-moz-transform"),""==e||"none"==e)&&(e=b.parents().css("-moz-transform"))}else return""!=e&&"none"!=e;if(""==e||"none"==e)e=d(document.body).css("transform");return""!=e&&"none"!=e&&null!=e},getBrowser:function(){var b=navigator.userAgent.toLowerCase(),e=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||0>b.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[],f={browser:e[1]||"",version:e[2]||
                "0"};0<=b.indexOf("rv:11.0")&&0<=b.indexOf(".net4.0c")&&(f.browser="msie",f.version="11",e[1]="msie");0<=b.indexOf("edge")&&(f.browser="msie",f.version="12",e[1]="msie");f[e[1]]=e[1];return f}});d.jqx.browser=d.jqx.utilities.getBrowser();d.jqx.isHidden=function(b){if(!b||!b[0])return!1;var e=b[0].offsetHeight;return 0===b[0].offsetWidth||0===e?!0:!1};d.jqx.ariaEnabled=!0;d.jqx.aria=function(b,e,f){if(d.jqx.ariaEnabled)if(void 0==e)d.each(b.aria,function(e,c){var f=b.base?b.base.host.attr(e):b.host.attr(e);
        if(void 0==f||d.isFunction(f)){f=b[c.name];d.isFunction(f)&&(f=b[c.name]());void 0==f&&(f="");try{b.base?b.base.host.attr(e,f.toString()):b.host.attr(e,f.toString())}catch(l){}}else{e=f;switch(c.type){case "number":e=new Number(f);isNaN(e)&&(e=f);break;case "boolean":e="true"==f?!0:!1;break;case "date":if(e=new Date(f),"Invalid Date"==e||isNaN(e))e=f}b[c.name]=e}});else try{b.host?b.base?b.base.host?b.base.host.attr(e,f.toString()):b.attr(e,f.toString()):b.host?b.element.setAttribute?b.element.setAttribute(e,
        f.toString()):b.host.attr(e,f.toString()):b.attr(e,f.toString()):b.setAttribute&&b.setAttribute(e,f.toString())}catch(g){}};Array.prototype.indexOf||(Array.prototype.indexOf=function(b,e){var c=this.length;e=Number(e)||0;e=0>e?Math.ceil(e):Math.floor(e);for(0>e&&(e+=c);e<c;e++)if(e in this&&this[e]===b)return e;return-1});d.jqx.mobile=d.jqx.mobile||{};d.jqx.position=function(b){var e=parseInt(b.pageX),c=parseInt(b.pageY);d.jqx.mobile.isTouchDevice()&&(b=d.jqx.mobile.getTouches(b)[0],e=parseInt(b.pageX),
        c=parseInt(b.pageY));return{left:e,top:c}};d.extend(d.jqx.mobile,{_touchListener:function(b,e){e={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};var c=e[b.type],d=document.createEvent("MouseEvents");d.initMouseEvent(c,b.bubbles,b.cancelable,b.view,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,b.relatedTarget);d._pageX=b.pageX;d._pageY=b.pageY;b.target.dispatchEvent(d);e=b.target["on"+e[b.type]];"function"===typeof e&&e(b)},setMobileSimulator:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     e){if(!this.isTouchDevice()&&(this.simulatetouches=!0,0==e&&(this.simulatetouches=!1),e={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},window.addEventListener))for(var c in e)b.addEventListener&&(b.removeEventListener(c,this._touchListener),b.addEventListener(c,this._touchListener,!1))},isTouchDevice:function(){if(void 0!=this.touchDevice)return this.touchDevice;var b="Browser CodeName: "+navigator.appCodeName;b+="Browser Name: "+navigator.appName;b+="Browser Version: "+navigator.appVersion;
            b+="Platform: "+navigator.platform;b+="User-agent header: "+navigator.userAgent;if(-1!=b.indexOf("Android")||-1!=b.indexOf("IEMobile")||-1!=b.indexOf("Windows Phone")||-1!=b.indexOf("WPDesktop")||-1!=b.indexOf("ZuneWP7")||-1!=b.indexOf("BlackBerry")&&-1!=b.indexOf("Mobile Safari")||-1!=b.indexOf("ipod")||-1!=b.indexOf("nokia")||-1!=b.indexOf("Nokia"))return!0;if(-1!=b.indexOf("Chrome/17")||-1!=b.indexOf("CrOS")||-1!=b.indexOf("Opera")&&-1==b.indexOf("Mobi")&&-1==b.indexOf("Mini")&&-1!=b.indexOf("Platform: Win"))return!1;
            if(-1!=b.indexOf("HybridDeviceTouch"))return!0;if(-1!=b.indexOf("HybridDeviceMouse"))return!1;if(-1!=b.indexOf("Opera")&&-1!=b.indexOf("Mobi")&&-1!=b.indexOf("Opera Mobi"))return!0;if(-1!=b.indexOf("Mozilla/5.0 (X11; Linux x86_64)"))return!1;var e={ios:"i(?:Pad|Phone|Pod)(?:.*)CPU(?: iPhone)? OS ",android:"(Android |HTC_|Silk/)",blackberry:"BlackBerry(?:.*)Version/",rimTablet:"RIM Tablet OS ",webos:"(?:webOS|hpwOS)/",bada:"Bada/"};try{if(void 0!=this.touchDevice)return this.touchDevice;this.touchDevice=
                !1;for(var f in e)if(e.hasOwnProperty(f)&&b.match(new RegExp("(?:"+e[f]+")([^\\s;]+)")))return"blackberry"==f.toString()?this.touchDevice=!1:this.touchDevice=!0;var d=navigator.userAgent;if(-1!=navigator.platform.toLowerCase().indexOf("win")){if(0<=d.indexOf("Windows Phone")||0<=d.indexOf("WPDesktop")||0<=d.indexOf("IEMobile")||0<=d.indexOf("ZuneWP7"))return this.touchDevice=!0;if(0<=d.indexOf("Touch"))return"MSPointerDown"in window||"pointerdown"in window||0<=d.indexOf("ARM")?this.touchDevice=!0:
                this.touchDevice=!1}if(-1!=navigator.platform.toLowerCase().indexOf("win"))return this.touchDevice=!1;if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)this.touchDevice=!0;return this.touchDevice}catch(h){return this.touchDevice=!1}},getLeftPos:function(b){for(var e=b.offsetLeft;null!=(b=b.offsetParent);)"HTML"!=b.tagName&&(e+=b.offsetLeft,document.all&&(e+=b.clientLeft));return e},getTopPos:function(b){for(var e=b.offsetTop,c=d(b).coord();null!=(b=b.offsetParent);)"HTML"!=
        b.tagName&&(e+=b.offsetTop-b.scrollTop,document.all&&(e+=b.clientTop));b=navigator.userAgent.toLowerCase();if((-1!=b.indexOf("windows phone")||-1!=b.indexOf("WPDesktop")||-1!=b.indexOf("ZuneWP7")||-1!=b.indexOf("msie 9")||-1!=b.indexOf("msie 11")||-1!=b.indexOf("msie 10"))&&-1!=b.indexOf("touch"))return c.top;if(this.isSafariMobileBrowser()){if(this.isSafari4MobileBrowser()&&this.isIPadSafariMobileBrowser())return e;if(-1!=b.indexOf("version/7"))return c.top;if(-1!=b.indexOf("version/6")||-1!=b.indexOf("version/5"))e+=
            d(window).scrollTop();return/(Android.*Chrome\/[.0-9]* (!?Mobile))/.exec(navigator.userAgent)||/(Android.*Chrome\/[.0-9]* Mobile)/.exec(navigator.userAgent)?e+d(window).scrollTop():c.top}return e},isChromeMobileBrowser:function(){return-1!=navigator.userAgent.toLowerCase().indexOf("android")},isOperaMiniMobileBrowser:function(){var b=navigator.userAgent.toLowerCase();return-1!=b.indexOf("opera mini")||-1!=b.indexOf("opera mobi")},isOperaMiniBrowser:function(){return-1!=navigator.userAgent.toLowerCase().indexOf("opera mini")},
        isNewSafariMobileBrowser:function(){var b=navigator.userAgent.toLowerCase(),e=-1!=b.indexOf("ipad")||-1!=b.indexOf("iphone")||-1!=b.indexOf("ipod");return e=e&&-1!=b.indexOf("version/5")},isSafari4MobileBrowser:function(){var b=navigator.userAgent.toLowerCase(),e=-1!=b.indexOf("ipad")||-1!=b.indexOf("iphone")||-1!=b.indexOf("ipod");return e=e&&-1!=b.indexOf("version/4")},isWindowsPhone:function(){var b=navigator.userAgent.toLowerCase();return-1!=b.indexOf("windows phone")||-1!=b.indexOf("WPDesktop")||
            -1!=b.indexOf("ZuneWP7")||-1!=b.indexOf("msie 9")||-1!=b.indexOf("msie 11")||-1!=b.indexOf("msie 10")&&-1!=b.indexOf("touch")},isSafariMobileBrowser:function(){var b=navigator.userAgent.toLowerCase();return/(Android.*Chrome\/[.0-9]* (!?Mobile))/.exec(navigator.userAgent)||/(Android.*Chrome\/[.0-9]* Mobile)/.exec(navigator.userAgent)?!0:-1!=b.indexOf("ipad")||-1!=b.indexOf("iphone")||-1!=b.indexOf("ipod")||-1!=b.indexOf("mobile safari")},isIPadSafariMobileBrowser:function(){return-1!=navigator.userAgent.toLowerCase().indexOf("ipad")},
        isMobileBrowser:function(){var b=navigator.userAgent.toLowerCase();return-1!=b.indexOf("ipad")||-1!=b.indexOf("iphone")||-1!=b.indexOf("android")},getTouches:function(b){if(b.originalEvent){if(b.originalEvent.touches&&b.originalEvent.touches.length)return b.originalEvent.touches;if(b.originalEvent.changedTouches&&b.originalEvent.changedTouches.length)return b.originalEvent.changedTouches}b.touches||(b.touches=[],b.touches[0]=void 0!=b.originalEvent?b.originalEvent:b,void 0!=b.originalEvent&&b.pageX&&
        (b.touches[0]=b),"mousemove"==b.type&&(b.touches[0]=b));return b.touches},getTouchEventName:function(b){if(this.isWindowsPhone()){if(-1!=navigator.userAgent.toLowerCase().indexOf("windows phone 7")){if(-1!=b.toLowerCase().indexOf("start"))return"MSPointerDown";if(-1!=b.toLowerCase().indexOf("move"))return"MSPointerMove";if(-1!=b.toLowerCase().indexOf("end"))return"MSPointerUp"}if(-1!=b.toLowerCase().indexOf("start"))return"pointerdown";if(-1!=b.toLowerCase().indexOf("move"))return"pointermove";if(-1!=
            b.toLowerCase().indexOf("end"))return"pointerup"}else return b},dispatchMouseEvent:function(b,e,f){if(!this.simulatetouches){var c=document.createEvent("MouseEvent");c.initMouseEvent(b,!0,!0,e.view,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null);null!=f&&f.dispatchEvent(c)}},getRootNode:function(b){for(;1!==b.nodeType;)b=b.parentNode;return b},setTouchScroll:function(b,e){this.enableScrolling||(this.enableScrolling=[]);this.enableScrolling[e]=b},touchScroll:function(b,e,f,g,h,k){function c(b){return b.targetTouches&&
        1<=b.targetTouches.length?b.targetTouches[0].clientY:b.originalEvent&&void 0!==b.originalEvent.clientY?b.originalEvent.clientY:t.getTouches(b)[0].clientY}function m(b){return b.targetTouches&&1<=b.targetTouches.length?b.targetTouches[0].clientX:b.originalEvent&&void 0!==b.originalEvent.clientX?b.originalEvent.clientX:t.getTouches(b)[0].clientX}function p(){if(O){var b=Date.now()-Q;b=-O*Math.exp(-b/Z);.5<b||-.5>b?(da(L+b),requestAnimationFrame(p)):da(L)}}function r(){if(O){var b=Date.now()-Q;b=-O*
            Math.exp(-b/Z);.5<b||-.5>b?(v(M+b),requestAnimationFrame(r)):v(M)}}if(null!=b){var t=this;this.scrolling||(this.scrolling=[]);var w=this.scrolling[g]=!1;b=d(b);var q=["select","input","textarea"],u=0;this.enableScrolling||(this.enableScrolling=[]);this.enableScrolling[g]=!0;var y=this.getTouchEventName("touchstart")+".touchScroll",z=this.getTouchEventName("touchend")+".touchScroll",A=this.getTouchEventName("touchmove")+".touchScroll",C,B,D,K,I,G,H,N,Q,J,O,L,M,E;var F=e;var R=D=0,U=0,W=0;var P=h.jqxScrollBar("max");
            var Z=325;var ba=function(){var b=Date.now();var e=b-Q;Q=b;b=D-N;var c=R-C;N=D;C=R;I=!0;G=1E3*b/(1+e)*.8+.2*G;H=1E3*c/(1+e)*.8+.2*H},S=!1;u=function(b){if(!t.enableScrolling[g])return!0;if(-1===d.inArray(b.target.tagName.toLowerCase(),q)){D=k.jqxScrollBar("value");R=h.jqxScrollBar("value");var e=t.getTouches(b),f=e[0];1==e.length&&t.dispatchMouseEvent("mousedown",f,t.getRootNode(f.target));P=h.jqxScrollBar("max");F=k.jqxScrollBar("max");S=!1;I=!0;K=c(b);E=m(b);G=O=H=0;N=D;C=R;Q=Date.now();clearInterval(J);
                J=setInterval(ba,100);U=D;W=R;w=!1;return t.scrolling[g]=!0}};if(b.on)b.on(y,u);else b.bind(y,u);var da=function(b,e){D=b>F?F:0>b?0:b;f(null,b,0,0,e);return b>F?"max":0>b?"min":"value"},v=function(b,e){R=b>P?P:0>b?0:b;f(b,null,0,0,e);return b>P?"max":0>b?"min":"value"};e=function(b){function e(b){if(I){var e=c(b);var g=m(b);var h=K-e;B=E-g;if(2<h||-2>h){K=e;e=da(D+h,b);ba();if("min"==e&&0===U||"max"==e&&U===F||!d)return!0;b.preventDefault();b.stopPropagation();S=!0;return!1}if(2<B||-2>B){E=g;e=v(R+
                B,b);ba();if("min"==e&&0===W||"max"==e&&W===P||!f)return!0;S=!0;b.preventDefault();b.stopPropagation();return!1}b.preventDefault()}}if(!t.enableScrolling[g]||!t.scrolling[g])return!0;S&&(b.preventDefault(),b.stopPropagation());if(1<t.getTouches(b).length)return!0;w=!0;var f=null!=h?"hidden"!=h[0].style.visibility:!0,d=null!=k?"hidden"!=k[0].style.visibility:!0;(f||d)&&(f||d)&&e(b)};if(b.on)b.on(A,e);else b.bind(A,e);var X=function(b){if(!t.enableScrolling[g])return!0;var e=t.getTouches(b)[0];if(!t.scrolling[g])return!0;
                I=!1;clearInterval(J);if(10<G||-10>G)O=.8*G,L=Math.round(D+O),Q=Date.now(),requestAnimationFrame(p);else if(10<H||-10>H)O=.8*H,M=Math.round(R+O),Q=Date.now(),requestAnimationFrame(r);t.scrolling[g]=!1;if(w)t.dispatchMouseEvent("mouseup",e,b.target);else return e=t.getTouches(b)[0],b=t.getRootNode(e.target),t.dispatchMouseEvent("mouseup",e,b),t.dispatchMouseEvent("click",e,b),!0};this.simulatetouches&&(void 0!=d(window).on||d(window),e=function(b){try{X(b)}catch(Y){}t.scrolling[g]=!1},void 0!=d(window).on?
                d(document).on("mouseup.touchScroll",e):d(document).bind("mouseup.touchScroll",e),window.frameElement&&null!=window.top&&(e=function(b){try{X(b)}catch(Y){}t.scrolling[g]=!1},window.top.document&&(d(window.top.document).on?d(window.top.document).on("mouseup",e):d(window.top.document).bind("mouseup",e))),void 0!=d(document).on||d(document),e=function(b){if(!t.scrolling[g])return!0;t.scrolling[g]=!1;b=t.getTouches(b)[0];var e=t.getRootNode(b.target);t.dispatchMouseEvent("mouseup",b,e);t.dispatchMouseEvent("click",
                b,e)},void 0!=d(document).on?d(document).on("touchend",e):d(document).bind("touchend",e));b.on&&(b.on("dragstart",function(b){b.preventDefault()}),b.on("selectstart",function(b){b.preventDefault()}));b.on?b.on(z+" touchcancel.touchScroll",X):b.bind(z+" touchcancel.touchScroll",X)}}});d.jqx.cookie=d.jqx.cookie||{};d.extend(d.jqx.cookie,{cookie:function(b,e,f){if(1<arguments.length&&"[object Object]"!==String(e)){f=d.extend({},f);if(null===e||void 0===e)f.expires=-1;if("number"===typeof f.expires){var c=
            f.expires,h=f.expires=new Date;h.setDate(h.getDate()+c)}e=String(e);return document.cookie=[encodeURIComponent(b),"=",f.raw?e:encodeURIComponent(e),f.expires?"; expires="+f.expires.toUTCString():"",f.path?"; path="+f.path:"",f.domain?"; domain="+f.domain:"",f.secure?"; secure":""].join("")}f=e||{};h=f.raw?function(b){return b}:decodeURIComponent;return(c=(new RegExp("(?:^|; )"+encodeURIComponent(b)+"=([^;]*)")).exec(document.cookie))?h(c[1]):null}});d.jqx.string=d.jqx.string||{};d.extend(d.jqx.string,
        {replace:function(b,e,f){if(e===f)return this;for(var c=b.indexOf(e);-1!=c;)b=b.replace(e,f),c=b.indexOf(e);return b},contains:function(b,e){return null==b||null==e?!1:-1!=b.indexOf(e)},containsIgnoreCase:function(b,e){return null==b||null==e?!1:-1!=b.toString().toUpperCase().indexOf(e.toString().toUpperCase())},equals:function(b,e){if(null==b||null==e)return!1;b=this.normalize(b);return e.length==b.length?b.slice(0,e.length)==e:!1},equalsIgnoreCase:function(b,e){if(null==b||null==e)return!1;b=this.normalize(b);
                return e.length==b.length?b.toUpperCase().slice(0,e.length)==e.toUpperCase():!1},startsWith:function(b,e){return null==b||null==e?!1:b.slice(0,e.length)==e},startsWithIgnoreCase:function(b,e){return null==b||null==e?!1:b.toUpperCase().slice(0,e.length)==e.toUpperCase()},normalize:function(b){65279==b.charCodeAt(b.length-1)&&(b=b.substring(0,b.length-1));return b},endsWith:function(b,e){if(null==b||null==e)return!1;b=this.normalize(b);return b.slice(-e.length)==e},endsWithIgnoreCase:function(b,e){if(null==
                b||null==e)return!1;b=this.normalize(b);return b.toUpperCase().slice(-e.length)==e.toUpperCase()}});d.extend(d.easing,{easeOutBack:function(b,e,f,d,h,k){void 0==k&&(k=1.70158);return d*((e=e/h-1)*e*((k+1)*e+k)+1)+f},easeInQuad:function(b,e,f,d,h){return d*(e/=h)*e+f},easeInOutCirc:function(b,e,f,d,h){return 1>(e/=h/2)?-d/2*(Math.sqrt(1-e*e)-1)+f:d/2*(Math.sqrt(1-(e-=2)*e)+1)+f},easeInOutSine:function(b,e,f,d,h){return-d/2*(Math.cos(Math.PI*e/h)-1)+f},easeInCubic:function(b,e,f,d,h){return d*(e/=h)*
            e*e+f},easeOutCubic:function(b,e,f,d,h){return d*((e=e/h-1)*e*e+1)+f},easeInOutCubic:function(b,e,f,d,h){return 1>(e/=h/2)?d/2*e*e*e+f:d/2*((e-=2)*e*e+2)+f},easeInSine:function(b,e,f,d,h){return-d*Math.cos(e/h*(Math.PI/2))+d+f},easeOutSine:function(b,e,f,d,h){return d*Math.sin(e/h*(Math.PI/2))+f}})})(jqxBaseFramework);
(function(d){d.event&&d.event.special&&d.extend(d.event.special,{close:{noBubble:!0},open:{noBubble:!0},cellclick:{noBubble:!0},rowclick:{noBubble:!0},tabclick:{noBubble:!0},selected:{noBubble:!0},expanded:{noBubble:!0},collapsed:{noBubble:!0},valuechanged:{noBubble:!0},expandedItem:{noBubble:!0},collapsedItem:{noBubble:!0},expandingItem:{noBubble:!0},collapsingItem:{noBubble:!0}});d.fn.extend&&d.fn.extend({ischildof:function(b){if(!d(this).parents)return b.element.contains(this.element);for(var e=
        d(this).parents().get(),c=0;c<e.length;c++)if("string"!=typeof b){var g=e[c];if(void 0!==b&&g==b[0])return!0}else if(void 0!==b&&d(e[c]).is(b))return!0;return!1}});d.fn.jqxProxy=function(){var b=d(this).data().jqxWidget,e=Array.prototype.slice.call(arguments,0),f=b.element;f||(f=b.base.element);return d.jqx.jqxWidgetProxy(b.widgetName,f,e)};var b=d.originalVal=d.fn.val;d.fn.val=function(c){if("undefined"==typeof c){if(d(this).hasClass("jqx-widget")){var e=d(this).data().jqxWidget;if(e&&e.val)return e.val()}return this[0]&&
0<=this[0].tagName.toLowerCase().indexOf("angular")&&(e=d(this).find(".jqx-widget").data().jqxWidget)&&e.val?e.val():b.call(this)}return d(this).hasClass("jqx-widget")&&(e=d(this).data().jqxWidget)&&e.val||this[0]&&0<=this[0].tagName.toLowerCase().indexOf("angular")&&(e=d(this).find(".jqx-widget").data().jqxWidget)&&e.val?2!=arguments.length?e.val(c):e.val(c,arguments[1]):b.call(this,c)};d.fn.modal&&d.fn.modal.Constructor&&(d.fn.modal.Constructor.prototype.enforceFocus=function(){d(document).off("focusin.bs.modal").on("focusin.bs.modal",
    d.proxy(function(b){if(this.$element[0]!==b.target&&!this.$element.has(b.target).length){if(d(b.target).parents().hasClass("jqx-popup"))return!0;this.$element.trigger("focus")}},this))});d.fn.coord=function(b){var e,c={top:0,left:0},g=(e=this[0])&&e.ownerDocument;if(g){var h=g.documentElement;if(!d.contains(h,e))return c;c=e.getBoundingClientRect();e=d.isWindow(g)?g:9===g.nodeType?g.defaultView||g.parentWindow:!1;var k=g=0,l=navigator.userAgent.toLowerCase();if(-1!=l.indexOf("ipad")||-1!=l.indexOf("iphone"))g=
    2;1==b&&"static"!=document.body.style.position&&""!=document.body.style.position&&(b=d(document.body).coord(),g=-b.left,k=-b.top);return{top:k+c.top+(e.pageYOffset||h.scrollTop)-(h.clientTop||0),left:g+c.left+(e.pageXOffset||h.scrollLeft)-(h.clientLeft||0)}}};d.jqx.ripplers=[];d.jqx.ripple=function(b,e,f){e||(e=b);var c=d(b);c.append("<span class='ink'></span>");for(var h=c.find(".ink"),k=!1,l=0;l<d.jqx.ripplers.length;l++)if(d.jqx.ripplers[l].element[0]===b[0]){k=!0;break}k||d.jqx.ripplers.push({ink:h,
    element:b,hostElement:e,hostElementType:f});if("checkbox"===f||"radiobutton"===f)k=Math.max(c.outerWidth(),c.outerHeight()),h.css({height:k,width:k}),k=c.width()/2-h.width()/2,c=c.height()/2-h.height()/2,h.css({top:c+"px",left:k+"px"});if(1===d.jqx.ripplers.length)d(document).on("mouseup",function(b){d.jqx.ripple.mouseCaptured=!1;for(b=0;b<d.jqx.ripplers.length;b++){var e=d.jqx.ripplers[b];e.ink.removeClass("active");e.element.removeClass("active");"checkbox"!==f&&"radiobutton"!==f&&e.ink.hasClass("animate")&&
e.ink.removeClass("animate")}});e.off("mousedown.ripple");e.on("mousedown.ripple",function(c){var g=d(b);d.jqx.ripple.mouseCaptured=!0;setTimeout(function(){0==g.find(".ink").length&&g.append("<span class='ink'></span>");var h=g.find(".ink");h.removeClass("animate");if(!h.height()&&!h.width()){var k=Math.max(g.outerWidth(),g.outerHeight());h.css({height:k,width:k})}if("checkbox"===f||"radiobutton"===f){if(!("checkbox"===f&&e.jqxCheckBox("disabled")||"radiobutton"===f&&e.jqxRadioButton("disabled"))){k=
    g.width()/2-h.width()/2;var l=g.height()/2-h.height()/2;h.css({top:l+"px",left:k+"px"}).addClass("animate");h.on("animationend",function(){d.jqx.ripple.mouseCaptured&&(h.removeClass("animate"),h.addClass("active"),b.addClass("active"))})}}else k=c.pageX-g.offset().left-h.width()/2,l=c.pageY-g.offset().top-h.height()/2,h.css({top:l+"px",left:k+"px"}).addClass("animate")})})}})(jqxBaseFramework);
(function(d){function b(b){return function(e,c){"string"!==typeof e&&(c=e,e="*");var f=e.toLowerCase().split(t),g=0,h=f.length;if(d.isFunction(c))for(;g<h;g++){var k=f[g];(e=/^\+/.test(k))&&(k=k.substr(1)||"*");k=b[k]=b[k]||[];k[e?"unshift":"push"](c)}}}function c(b,e,f,d,g,h){g=g||e.dataTypes[0];h=h||{};h[g]=!0;g=b[g];for(var k=0,q=g?g.length:0,l=b===w;k<q&&(l||!u);k++){var u=g[k](e,f,d);"string"===typeof u&&(!l||h[u]?u=void 0:(e.dataTypes.unshift(u),u=c(b,e,f,d,u,h)))}!l&&u||h["*"]||(u=c(b,e,f,
    d,"*",h));return u}function e(b,e){var c,f,g=d.jqx.data.ajaxSettings.flatOptions||{};for(c in e)void 0!==e[c]&&((g[c]?b:f||(f={}))[c]=e[c]);f&&d.extend(!0,b,f)}function f(){try{return new window.XMLHttpRequest}catch(G){}}d.jqx.observableArray=function(b,e){"string"==typeof b&&(b=d.parseJSON(b));var c;if(!(c=!Object.defineProperty)){try{Object.defineProperty({},"x",{});var f=!0}catch(E){f=!1}c=!f}if(c){var g=Object.defineProperty;Object.defineProperty=function(b,e,c){if(g)try{return g(b,e,c)}catch(U){}if(b!==
    Object(b))throw TypeError("Object.defineProperty called on non-object");Object.prototype.__defineGetter__&&"get"in c&&Object.prototype.__defineGetter__.call(b,e,c.get);Object.prototype.__defineSetter__&&"set"in c&&Object.prototype.__defineSetter__.call(b,e,c.set);"value"in c?b[e]=c.value:b[e]||(b[e]=c);return b}}Array.prototype.forEach||(Array.prototype.forEach=function(b,e){if(void 0===this||null===this)throw TypeError();var c=Object(this),f=c.length>>>0;if("function"!==typeof b)throw TypeError();
    var d;for(d=0;d<f;d++)d in c&&b.call(e,c[d],d,c)});"function"!==typeof Object.getOwnPropertyNames&&(Object.getOwnPropertyNames=function(b){if(b!==Object(b))throw TypeError("Object.getOwnPropertyNames called on non-object");var e=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&e.push(c);return e});var h=this,k=[];h.notifier=null;h.name="observableArray";h.observing=!0;h.changes=[];h.observe=function(){h.observing=!0;1==arguments.length&&(e=arguments[0])};h.unobserve=function(){h.observing=
    !1};h.toArray=function(){return k.slice(0)};h.toJSON=function(b,e){function c(b){return'"'+b.replace(q,function(b){var e=l[b];return"string"===typeof e?e:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"'}function f(b){return 10>b?"0"+b:b}function d(b,e){switch(e){case "string":return c(b);case "number":case "float":case "integer":case "int":return isFinite(b)?b:"null";case "boolean":return b}return"null"}function g(e,h){h=h[e];var k=typeof h;h&&"object"===typeof h&&"function"===typeof h.toJSON&&
(h=h.toJSON(e),k=typeof h);if(/(number|float|int|integer|string|boolean)/.test(k)||!h&&"object"===k)return d(h,k);a:{e=h;switch(Object.prototype.toString.call(e)){case "[object Date]":var q=isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+'Z"':"null";break a;case "[object Array]":q=e.length;h=[];for(k=0;k<q;k++)h.push(g(k,e)||"null");q="["+h.join(",")+"]";break a}h=[];for(q in e)!Object.prototype.hasOwnProperty.call(e,
    q)||""!=q&&b&&-1===b.indexOf(q)||(k=g(q,e))&&h.push(c(q)+":"+k);q="{"+h.join(",")+"}"}return q}var h=k;e&&(h=e);var q=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return!b&&window.JSON&&"function"===typeof window.JSON.stringify?window.JSON.stringify(h):g("",{"":h})};h.defineIndexProperty=function(b){if(!(b in h)){var e=function(b,e,c,f){var g=
    b[e],l=g;c=function(){return l};var u=function(b){g=b;if(l!==g&&(b=l,l=g,"function"===typeof q)){var c=k.indexOf(f),u="",m=function(b,c){Object.getOwnPropertyNames(b).forEach(function(f){var g=d.type(b[f]);"array"==g||"object"==g?m(b[f],c+"."+f):e===f&&(u=c+"."+f)})};m(f,c);q({object:h,type:"update",path:u,index:c,name:e,newValue:g,oldValue:b})}return l=g};void 0!=b[e]&&"length"!=e&&(Object.defineProperty?Object.defineProperty(b,e,{get:c,set:u}):Object.prototype.__defineGetter__&&Object.prototype.__defineSetter__&&
    (Object.prototype.__defineGetter__.call(b,e,c),Object.prototype.__defineSetter__.call(b,e,u)))},c=function(b,f,g){var h=d.type(b);/(number|float|int|integer|string|boolean)/.test(h)||void 0!==b&&Object.getOwnPropertyNames(b).forEach(function(h){var k=d.type(b[h]);"array"==k||"object"==k?(e(b,h,f+"."+h,g),c(b[h],f+"."+h,g)):e(b,h,f+"."+h,g)})};Object.defineProperty(h,b,{configurable:!0,enumerable:!0,get:function(){return k[b]},set:function(e){var f=k[b];h.toJSON(null,f)!=h.toJSON(null,e)&&(k[b]=e,
    "function"===typeof q&&q({object:h,type:"update",path:b.toString(),index:b,name:"index",newValue:e,oldValue:f}),c(e,b,e))}});c(h[b],b,h[b])}};h.push=function(){for(var b,e=0,c=arguments.length;e<c;e++)b=k.length,k.push(arguments[e]),h.defineIndexProperty(b),"function"===typeof q&&q({object:h,type:"add",name:"length",index:b,newValue:k.length,oldValue:b});return k.length};h.pop=function(){if(~k.length){var b=k.length-1,e=k.pop();delete h[b];"function"===typeof q&&q({object:h,type:"delete",name:"length",
    index:b,newValue:k.length,oldValue:b});return e}};h.unshift=function(){for(var b=k.length,e=0,c=arguments.length;e<c;e++)k.splice(e,0,arguments[e]),h.defineIndexProperty(k.length-1);"function"===typeof q&&q({object:h,type:"add",index:0,name:"length",newValue:k.length,oldValue:b});return k.length};h.shift=function(){var b=k.length;if(~k.length){var e=k.shift();0===k.length&&delete h[b];"function"===typeof q&&q({object:h,type:"delete",index:b,name:"length",newValue:k.length,oldValue:b});return e}};
    h.slice=function(b,e,c){b=k.slice(b,e);return new d.jqx.observableArray(b,c)};h.splice=function(b,e,c){var f=[];b=~b?b:k.length-b;for(e=(null==e?k.length-b:e)||0;e--;){var g=k.splice(b,1)[0];f.push(g);delete h[k.length];"function"===typeof q&&q({object:h,type:"delete",index:b,name:"length",newValue:-1,oldValue:b})}g=2;for(var l=arguments.length;g<l;g++)k.splice(b,0,arguments[g]),this.defineIndexProperty(k.length-1),"function"===typeof q&&q({object:h,type:"add",index:b,name:"length",newValue:k.length-
            1,oldValue:b}),b++;return new d.jqx.observableArray(f,c)};Object.defineProperty(h,"length",{configurable:!1,enumerable:!0,get:function(){return k.length},set:function(b){var e=Number(b);if(0===e%1&&0<=e)e<k.length?h.splice(e):e>k.length&&h.push.apply(h,Array(e-k.length));else throw new RangeError("Invalid array length");return b}});d.jqx.observableArray.prototype.fromArray=function(b,e){return new d.jqx.observableArray(b,e)};d.jqx.observableArray.prototype.clone=function(){var b=new d.jqx.observableArray(k,
        e);b.observing=h.observing;b.changes=h.changes;b.notifier=h.notifier;return b};h.remove=function(b){if(0>b||b>=h.length)throw Error("Invalid index : "+b);if(h.hasOwnProperty(b)){var e=h[b];h[b]=void 0;k[b]=void 0;"function"===typeof q&&q({object:h,type:"delete",index:b,name:"index",newValue:void 0,oldValue:e});return!0}return!1};h.concat=function(b,e){b=k.concat(b);return new d.jqx.observableArray(b,e)};Object.getOwnPropertyNames(Array.prototype).forEach(function(b){b in h||Object.defineProperty(h,
        b,{configurable:!1,enumerable:!0,writeable:!1,value:function(){var e=h.observing;h.observing=!1;var c=k[b].apply(k,arguments);h.observing=e;return c}})});h.set=function(b,e){if("string"==d.type(b)&&1<b.split(".").length){for(var c=b.split("."),f=h,g=0;g<c.length;g++){if(0===g&&c[g]>=h.length)throw Error("Invalid Index: "+b);g<c.length-1?f=f[c[g]]:f[c[g]]=e}return!0}b>=h.length?h.push(e):h[b]=e;return!0};h.get=function(b){return h[b]};b instanceof Array&&h.push.apply(h,b);var q=function(){h.observing&&
    (arguments&&arguments[0]&&h.changes.push(arguments[0]),e&&e.apply(h,arguments),h.notifier&&h.notifier.apply(h,arguments))};return h};d.jqx.formatDate=function(b,e,c){return d.jqx.dataFormat.formatdate(b,e,c)};d.jqx.formatNumber=function(b,e,c){return d.jqx.dataFormat.formatnumber(b,e,c)};d.jqx.dataAdapter=function(b,e){void 0!=b&&(void 0!==b.dataFields&&(b.datafields=b.dataFields),void 0!==b.dataType&&(b.datatype=b.dataType),void 0!==b.localData&&(b.localdata=b.localData),void 0!==b.sortColumn&&(b.sortcolumn=
    b.sortColumn),void 0!==b.sortDirection&&(b.sortdirection=b.sortDirection),void 0!==b.sortColumns&&(b.sortcolumns=b.sortColumns),void 0!==b.sortDirections&&(b.sortdirections=b.sortDirections),void 0!==b.sortOrder&&(b.sortdirection=b.sortOrder),void 0!==b.formatData&&(b.formatdata=b.formatData),void 0!==b.processData&&(b.processdata=b.processData),void 0!==b.pageSize&&(b.pagesize=b.pageSize),void 0!==b.pageNum&&(b.pagenum=b.pageNum),void 0!==b.updateRow&&(b.updaterow=b.updateRow),void 0!==b.addRow&&
(b.addrow=b.addRow),void 0!==b.deleteRow&&(b.deleterow=b.deleteRow),void 0!==b.contentType&&(b.contenttype=b.contentType),void 0!=b.totalRecords&&(b.totalrecords=b.totalRecords),void 0!=b.loadError&&(b.loadError=b.loadError),void 0!=b.sortComparer&&(b.sortcomparer=b.sortComparer));this._source=b;this._options=e||{};void 0!=b.beforeLoadComplete&&(this._options.beforeLoadComplete=this._source.beforeLoadComplete);void 0!=b.downloadComplete&&(this._options.downloadComplete=this._source.downloadComplete);
    void 0!=b.loadComplete&&(this._options.loadComplete=this._source.loadComplete);void 0!=b.autoBind&&(this._options.downloadComplete=this._source.autoBind);void 0!=b.formatData&&(this._options.formatData=this._source.formatData);void 0!=b.loadError&&(this._options.loadError=this._source.loadError);void 0!=b.beforeSend&&(this._options.beforeSend=this._source.beforeSend);void 0!=b.contentType&&(this._options.contentType=this._source.contentType);void 0!=b.async&&(this._options.async=this._source.async);
    void 0!=b.loadServerData&&(this._options.loadServerData=this._source.loadServerData);void 0!=b.uniqueDataFields&&(this._options.uniqueDataFields=this._source.uniqueDataFields);this.records=[];this._downloadComplete=[];this._bindingUpdate=[];if(void 0!=b&&null!=b.localdata&&"function"==typeof b.localdata&&(e=b.localdata(),null!=e)){b._localdata=b.localdata;var c=this;b._localdata.subscribe&&(c._oldlocaldata=[],b._localdata.subscribe(function(b){var e=function(b){return d.isArray(b)?d.makeArray(e(d(b))):
        d.extend(!0,{},b)};if(0==c.suspendKO||void 0==c.suspendKO||0==c._oldlocaldata.length)c._oldlocaldata=e(b)},b._localdata,"beforeChange"),b._localdata.subscribe(function(e){if(0==c.suspendKO||void 0==c.suspendKO){var f="";c._oldrecords=c.records;0==c._oldlocaldata.length&&(b.localdata=b._localdata());0==c._oldlocaldata.length?f="change":e&&(c._oldlocaldata.length==e.length&&(f="update"),c._oldlocaldata.length>e.length&&(f="remove"),c._oldlocaldata.length<e.length&&(f="add"));c.dataBind(null,f)}},b._localdata,
        "change"),c._knockoutdatasource=!0);b.localdata=e}1==this._options.autoBind&&this.dataBind()};d.jqx.dataAdapter.prototype={getrecords:function(){return this.records},beginUpdate:function(){this.isUpdating=!0},endUpdate:function(b){this.isUpdating=!1;0!=b&&(this._changedrecords&&0<this._changedrecords.length?(this.callBindingUpdate("update"),this._changedrecords=[]):this.dataBind(null,""))},formatDate:function(b,e,c){return d.jqx.dataFormat.formatdate(b,e,c)},formatNumber:function(b,e,c){return d.jqx.dataFormat.formatnumber(b,
        e,c)},dataBind:function(b,e){if(1!=this.isUpdating){var c=this._source;if(c){c.generatedfields&&(c.datafields=null,c.generatedfields=null);d.jqx.dataFormat.datescache=[];null!=c.dataFields&&(c.datafields=c.dataFields);void 0==c.recordstartindex&&(c.recordstartindex=0);void 0==c.recordendindex&&(c.recordendindex=0);void 0==c.loadallrecords&&(c.loadallrecords=!0);void 0==c.root&&(c.root="");void 0==c.record&&(c.record="");void 0!=c.sort&&(this.sort=c.sort);this.filter=void 0!=c.filter?c.filter:null;
        void 0!=c.sortcolumn&&(this.sortcolumn=c.sortcolumn);void 0!=c.sortdirection&&(this.sortdirection=c.sortdirection);void 0!=c.sortcolumns&&(this.sortcolumns=c.sortcolumns);void 0!=c.sortdirections&&(this.sortdirections=c.sortdirections);void 0!=c.sortcomparer&&(this.sortcomparer=c.sortcomparer);this.records=[];var f=this._options||{};this.virtualmode=void 0!=f.virtualmode?f.virtualmode:!1;this.totalrecords=void 0!=f.totalrecords?f.totalrecords:0;this.pageable=void 0!=f.pageable?f.pageable:!1;this.pagesize=
            void 0!=f.pagesize?f.pagesize:0;this.pagenum=void 0!=f.pagenum?f.pagenum:0;this.cachedrecords=void 0!=f.cachedrecords?f.cachedrecords:[];this.originaldata=[];this.recordids=[];this.updaterow=void 0!=f.updaterow?f.updaterow:null;this.addrow=void 0!=f.addrow?f.addrow:null;this.deleterow=void 0!=f.deleterow?f.deleterow:null;this.cache=void 0!=f.cache?f.cache:!1;this.unboundmode=!1;void 0!=c.formatdata&&(f.formatData=c.formatdata);void 0!=c.data&&(void 0==f.data&&(f.data={}),d.extend(f.data,c.data));
        void 0!=c.mapChar&&(c.mapchar=c.mapChar);this.mapChar=void 0!=c.mapchar?c.mapchar?c.mapchar:">":f.mapChar?f.mapChar:">";if(f.unboundmode||c.unboundmode)this.unboundmode=f.unboundmode||c.unboundmode;void 0!=c.cache&&(this.cache=c.cache);if(this.koSubscriptions)for(b=0;b<this.koSubscriptions.length;b++)this.koSubscriptions[b].dispose();this.koSubscriptions=[];0>this.pagenum&&(this.pagenum=0);var g=this,h=c.datatype;if("csv"===c.datatype||"tab"===c.datatype||"tsv"===c.datatype||"text"==c.datatype)h=
            "text";b=void 0!=f.async?f.async:!0;void 0!=c.async&&(b=c.async);switch(h){default:if(void 0==c.localdata&&c.length){c.localdata=[];for(var k=0;k<c.length;k++)c.localdata[c.localdata.length]=c[k],c[k].uid=k}c.beforeprocessing&&d.isFunction(c.beforeprocessing)&&c.beforeprocessing(c.localdata);b=c.localdata.length;this.totalrecords=this.virtualmode?c.totalrecords||b:b;if(this.unboundmode){this.totalrecords=this.unboundmode?c.totalrecords||b:b;var q=c.datafields?c.datafields.length:0;if(0<q)for(k=0;k<
        this.totalrecords;k++){var l={};for(b=0;b<q;b++)l[c.datafields[b].name]="";l.uid=k;c.localdata[c.localdata.length]=l}}void 0==this.totalrecords&&(this.totalrecords=0);q=c.datafields?c.datafields.length:0;var u=function(b,e){for(var f={},h=0;h<e;h++){var k=c.datafields?c.datafields[h]:{},q="";if(void 0!=k&&null!=k){if(k.map){if(d.isFunction(k.map))q=k.map(b);else if(q=k.map.split(g.mapChar),0<q.length){for(var l=b,u=0;u<q.length;u++)l&&(l=l[q[u]]);q=l}else q=b[k.map];void 0!=q&&null!=q?q=q.toString():
            void 0==q&&null!=q&&(q="")}l=!1;""==q&&(l=!0,q=b[k.name],void 0!=q&&null!=q&&(c._localdata&&q.subscribe?q=q():"array"!=k.type&&"date"!==k.type&&(q=q.toString())));"[object Object]"==q&&k.map&&l&&(q="");q=g.getvaluebytype(q,k);void 0!=k.displayname?f[k.displayname]=q:f[k.name]=q}}return f};if(c._localdata)if(this._changedrecords=[],this.records=[],k=c._localdata(),d.each(k,function(b,f){if("string"===typeof f)g.records.push(f);else{var h={},k=0,l=this;d.each(this,function(e,f){f=null;var u="string",
            m=e;if(0<q){for(var p=!1,y=!1,t=0;t<q;t++){var r=c.datafields[t];if(void 0!=r&&r.name==e){p=!0;f=r.map;u=r.type;m=r.name;break}else if(void 0!=r&&r.map&&0<=r.map.indexOf(e)){p=!0;f=r.map;u=r.type;m=r.name;y=!0;r=l[e];if(null!=f)if(r=f.split(g.mapChar),0<r.length){for(var w=l,z=0;z<r.length;z++)w=w[r[z]];r=w}else r=l[f];"string"!=u&&(r=g.getvaluebytype(r,{type:u}));h[m]=r;void 0!=h[m]&&(k+=h[m].toString().length+h[m].toString().substr(0,1))}}if(!p||y)return!0}if(d.isFunction(l[e]))r=l[e](),"string"!=
        u&&(r=g.getvaluebytype(r,{type:u})),h[e]=r,l[e].subscribe&&(g.koSubscriptions[g.koSubscriptions.length]=l[e].subscribe(function(c){h[e]=c;g._changedrecords.push({index:b,oldrecord:h,record:h});if(!g.isUpdating)return g.callBindingUpdate("update"),g._changedrecords=[],!1}));else{r=l[e];if(null!=f)if(r=f.split(g.mapChar),0<r.length){w=l;for(z=0;z<r.length;z++)w=w[r[z]];r=w}else r=l[f];"string"!=u&&(r=g.getvaluebytype(r,{type:u}));h[m]=r;void 0!=h[m]&&(k+=h[m].toString().length+h[m].toString().substr(0,
            1))}});f=g.getid(c.id,l,b);h.uid=f;g.records.push(h);h._koindex=k;g._oldrecords&&(f=g.records.length-1,"update"==e&&g._oldrecords[f]._koindex!=k&&g._changedrecords.push({index:f,oldrecord:g._oldrecords[f],record:h}))}}),"add"==e)for(b=g.records.length,k=0;k<b;k++){l=g.records[k];for(var m=!1,p=0;p<g._oldrecords.length;p++)if(g._oldrecords[p]._koindex===l._koindex){m=!0;break}m||g._changedrecords.push({index:k,oldrecord:null,record:l,position:0!=k?"last":"first"})}else{if("remove"==e)for(b=g._oldrecords.length,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            k=0;k<b;k++)l=g._oldrecords[k],g.records[k]?g.records[k]._koindex!=l._koindex&&g._changedrecords.push({index:k,oldrecord:l,record:null}):g._changedrecords.push({index:k,oldrecord:l,record:null})}else if(d.isArray(c.localdata))0==q?(y=0,t=[],d.each(c.localdata,function(b,e){var f=Object(this);if("string"===typeof e)return g.records=c.localdata,!1;e=g.getid(c.id,f,b);"object"===typeof e&&(e=b);f.uid=e;if(0==b){for(var h in this)y++,b=d.type(this[h]),t.push({name:h,type:b});q=y;c.datafields=t;c.generatedfields=
            t}0<q?(f=u(f,q),f.uid=e,g.records[g.records.length]=f):g.records[g.records.length]=f})):d.each(c.localdata,function(b){var e=u(this,q),f=g.getid(c.id,e,b);"object"===typeof f&&(f=b);b=Object(e);b.uid=f;g.records[g.records.length]=b});else{this.records=[];var y=0,t=[];d.each(c.localdata,function(b){b=g.getid(c.id,this,b);if(0==q&&!("string"===typeof this||this instanceof String)){for(var e in this){y++;var f=d.type(this[e]);t.push({name:e,type:f})}q=y;c.datafields=t;c.generatedfields=t}0<q?(e=u(this,
            q),e.uid=b,g.records[g.records.length]=e):(this.uid=b,g.records[g.records.length]=this)})}this.originaldata=c.localdata;this.cachedrecords=this.records;this.addForeignValues(c);f.uniqueDataFields&&(this.cachedrecords=this.records=k=this.getUniqueRecords(this.records,f.uniqueDataFields));f.beforeLoadComplete&&(k=f.beforeLoadComplete(g.records,this.originaldata),void 0!=k&&(g.records=k,g.cachedrecords=k));f.autoSort&&f.autoSortField&&(k=Object.prototype.toString,Object.prototype.toString="function"==
        typeof field?field:function(){return this[f.autoSortField]},g.records.sort(function(b,e){void 0===b&&(b=null);void 0===e&&(e=null);if(null===b&&null===e)return 0;if(null===b&&null!==e)return 1;if(null!==b&&null===e)return-1;b=b.toString();e=e.toString();if(null===b&&null===e)return 0;if(null===b&&null!==e)return 1;if(null!==b&&null===e)return-1;if(d.jqx.dataFormat.isNumber(b)&&d.jqx.dataFormat.isNumber(e)||d.jqx.dataFormat.isDate(b)&&d.jqx.dataFormat.isDate(e))return b<e?-1:b>e?1:0;d.jqx.dataFormat.isNumber(b)||
        d.jqx.dataFormat.isNumber(e)||(b=String(b).toLowerCase(),e=String(e).toLowerCase());return b<e?-1:b>e?1:0}),Object.prototype.toString=k);g.loadedData=c.localdata;g.buildHierarchy();d.isFunction(f.loadComplete)&&f.loadComplete(c.localdata,g.records);break;case "json":case "jsonp":case "xml":case "xhtml":case "script":case "text":case "ics":if(null!=c.localdata&&!c.url){d.isFunction(c.beforeprocessing)&&c.beforeprocessing(c.localdata);"xml"===c.datatype?g.loadxml(c.localdata,c.localdata,c):"text"===
        h?g.loadtext(c.localdata,c):"ics"===h?g.loadics(c.localdata,c):g.loadjson(c.localdata,c.localdata,c);g.addForeignValues(c);f.uniqueDataFields&&(k=g.getUniqueRecords(g.records,f.uniqueDataFields),g.records=k,g.cachedrecords=k);f.beforeLoadComplete&&(k=f.beforeLoadComplete(g.records,this.originaldata),void 0!=k&&(g.records=k,g.cachedrecords=k));g.loadedData=c.localdata;g.buildHierarchy.call(g);d.isFunction(f.loadComplete)&&f.loadComplete(c.localdata,g.records);g.callBindingUpdate(e);return}l=void 0!=
        f.data?f.data:{};c.processdata&&c.processdata(l);d.isFunction(f.processData)&&f.processData(l);d.isFunction(f.formatData)&&(m=f.formatData(l),void 0!=m&&(l=m));m="application/x-www-form-urlencoded";f.contentType&&(m=f.contentType);p="GET";c.type&&(p=c.type);f.type&&(p=f.type);var r=h;"ics"==h&&(r="text");c.url&&0<c.url.length?d.isFunction(f.loadServerData)?g._requestData(l,c,f):this.xhr=d.jqx.data.ajax({dataType:r,cache:this.cache,type:p,url:c.url,async:b,timeout:c.timeout,contentType:m,data:l,success:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            e,k){if(d.isFunction(c.beforeprocessing)){var q=c.beforeprocessing(b,e,k);void 0!=q&&(b=q)}d.isFunction(f.downloadComplete)&&(q=f.downloadComplete(b,e,k),void 0!=q&&(b=q));null==b?(g.records=[],g.cachedrecords=[],g.originaldata=[],g.callDownloadComplete(),d.isFunction(f.loadComplete)&&f.loadComplete([])):(q=b,b.records&&(q=b.records),void 0!=b.totalrecords?c.totalrecords=b.totalrecords:void 0!=b.totalRecords&&(c.totalrecords=b.totalRecords),"xml"===c.datatype?g.loadxml(null,q,c):"text"===h?g.loadtext(q,
                c):"ics"===h?g.loadics(q,c):g.loadjson(null,q,c),g.addForeignValues(c),f.uniqueDataFields&&(q=g.getUniqueRecords(g.records,f.uniqueDataFields),g.records=q,g.cachedrecords=q),f.beforeLoadComplete&&(q=f.beforeLoadComplete(g.records,b),void 0!=q&&(g.records=q,g.cachedrecords=q)),g.loadedData=b,g.buildHierarchy.call(g),g.callDownloadComplete(),d.isFunction(f.loadComplete)&&f.loadComplete(b,e,k,g.records))},error:function(b,e,h){d.isFunction(c.loaderror)&&c.loaderror(b,e,h);d.isFunction(f.loadError)&&
            f.loadError(b,e,h);g.callDownloadComplete()},beforeSend:function(b,e){d.isFunction(f.beforeSend)&&f.beforeSend(b,e);d.isFunction(c.beforesend)&&c.beforesend(b,e)}}):(g.buildHierarchy([]),g.callDownloadComplete(),d.isFunction(f.loadComplete)&&(k||(k={}),f.loadComplete(k)))}this.callBindingUpdate(e)}}},buildHierarchy:function(b){var e=this._source,c=[];if(e.datafields){if(e.hierarchy&&!e.hierarchy.reservedNames)e.hierarchy.reservedNames={leaf:"leaf",parent:"parent",expanded:"expanded",checked:"checked",
        selected:"selected",level:"level",icon:"icon",data:"data"};else if(e.hierarchy){var f=e.hierarchy.reservedNames;f.leaf||(f.leaf="leaf");f.parent||(f.parent="parent");f.expanded||(f.expanded="expanded");f.checked||(f.checked="checked");f.selected||(f.selected="selected");f.level||(f.level="level");f.data||(f.data="data")}if(e.hierarchy){var d=this;f=e.hierarchy.reservedNames;if(e.hierarchy.root){if("xml"==e.dataType)return this.hierarchy=c=this.getRecordsHierarchy("uid","parentuid","records",null,
        b);this.hierarchy=this.records;var g=e.hierarchy.root;for(c=0;c<this.records.length;c++)if(b=this.records[c]){var h=function(b){if(e.hierarchy.record)b.records=b[g][e.hierarchy.record];else{var c=g.split(d.mapChar);if(1<c.length){for(var h=b,k=0;k<c.length;k++)void 0!=h&&(h=h[c[k]]);c=h}else c=b[g];b.records=c}if(null==b.records||b.records&&0==b.records.length)b[f.leaf]=!0};h(b);b[f.level]=0;var k=this.getid(e.id,b,c);b.uid=k;b[f.parent]=null;b[f.data]=b;void 0===b[f.expanded]&&(b[f.expanded]=!1);
        var q=function(b,c){if(c)for(var g=0;g<c.length;g++){var k=c[g];if(k){h(k);k[f.level]=b[f.level]+1;k[f.parent]=b;k[f.data]=k;var l=d.getid(e.id,k,g);k.uid=l==g&&null==e.id?b.uid+"_"+l:l;void 0===k[f.expanded]&&(k[f.expanded]=!1);q(k,k.records)}}else b.records=[]};q(b,b.records)}return this.hierarchy}if(e.hierarchy.keyDataField&&e.hierarchy.parentDataField)return this.hierarchy=c=this.getRecordsHierarchy(e.hierarchy.keyDataField.name,e.hierarchy.parentDataField.name,"records",null,b);if(e.hierarchy.groupingDataFields){k=
        [];for(c=0;c<e.hierarchy.groupingDataFields.length;c++)k.push(e.hierarchy.groupingDataFields[c].name);return this.hierarchy=c=this.getGroupedRecords(k,"records","label",null,"data",null,"parent",b)}}}},addRecord:function(b,e,c,f){var d=this,g=function(){return{leaf:"leaf",parent:"parent",expanded:"expanded",checked:"checked",selected:"selected",level:"level",icon:"icon",data:"data"}};if(void 0!=b)if(void 0!=c){if(0<this.hierarchy.length){var h=function(f){if(f)for(var k=0;k<f.length;k++){var q=f[k];
        if(q.uid==c)return f=d._source&&d._source.hierarchy?d._source.hierarchy.reservedNames:null,null==f&&(f=g()),b[f.parent]=q,b[f.level]=q[f.level]+1,q.records||(q.records=[]),q[f.leaf]=!1,"last"==e?q.records.push(b):"number"===typeof e&&isFinite(e)?q.records.splice(e,0,b):q.records.splice(0,0,b),!0;q.records&&h(q.records)}};h(this.hierarchy)}}else return this.hierarchy&&0<=this.hierarchy.length&&(this._source.hierarchy||f)?(f=d._source&&d._source.hierarchy?d._source.hierarchy.reservedNames:null,null==
    f&&(f=g()),b[f.level]=0,"last"==e?this.hierarchy.push(b):"number"===typeof e&&isFinite(e)?this.hierarchy.splice(e,0,b):this.hierarchy.splice(0,0,b)):"last"==e?this.records.push(b):"number"===typeof e&&isFinite(e)?this.records.splice(e,0,b):this.records.splice(0,0,b),!0;return!1},deleteRecord:function(b){var e=this;if(0<this.hierarchy.length){var c=function(f){if(f)for(var d=0;d<f.length;d++){var g=f[d];if(g.uid==b){f.splice(d,1);e.recordids[b]&&delete e.recordids[b];var h=function(b){for(var c=0;c<
    b.length;c++){for(var f=b[c].uid,d=0;d<e.records.length;d++)if(e.records[d].uid==f){e.records.splice(d,1);break}b[c].records&&h(b[c].records)}};g.records&&h(g.records);for(f=0;f<e.records.length;f++)if(g=e.records[f],g.uid==b){e.records.splice(f,1);break}return!0}g.records&&c(g.records)}};c(this.hierarchy)}else for(var f=0;f<this.records.length;f++)if(this.records[f].uid==b)return this.records.splice(f,1),!0;return!1},addForeignValues:function(b){for(var e=b.datafields?b.datafields.length:0,c=0;c<
    e;c++){var f=b.datafields[c];if(void 0!=f)if(void 0!=f.values){void 0==f.value&&(f.value=f.name);void 0==f.values.value&&(f.values.value=f.value);var d=[];if(this.pageable&&this.virtualmode){var g=this.pagenum*this.pagesize;var h=g+this.pagesize;h>this.totalrecords&&(h=this.totalrecords)}else this.virtualmode?(g=b.recordstartindex,h=b.recordendindex,h>this.totalrecords&&(h=this.totalrecords)):(g=0,h=this.records.length);for(;g<h;g++){var k=this.records[g],q=f.name,l=k[f.value];if(void 0!=d[l])k[q]=
        d[l];else for(var u=0;u<f.values.source.length;u++){var m=f.values.source[u],p=m[f.values.value];void 0==p&&(p=m.uid);if(p==l){u=m[f.values.name];k[q]=u;d[l]=u;break}}}}else if(void 0!=f.value)for(g=0;g<this.records.length;g++)k=this.records[g],k[f.name]=k[f.value]}},abort:function(){this.xhr&&4!=this.xhr.readyState&&(this.xhr.abort(),this.callDownloadComplete())},_requestData:function(b,e,c){var f=this;c.loadServerData(b,e,function(b){b.totalrecords&&(e.totalrecords=b.totalrecords,f.totalrecords=
        b.totalrecords);b.records&&(f.records=b.records,f.cachedrecords=b.records);f.addForeignValues(e);if(c.uniqueDataFields){var g=f.getUniqueRecords(f.records,c.uniqueDataFields);f.records=g;f.cachedrecords=g}c.beforeLoadComplete&&(g=c.beforeLoadComplete(f.records,b),void 0!=g&&(f.records=g,f.cachedrecords=g));for(g=0;g<f.records.length;g++){var h=f.records[g];void 0!=h&&void 0==h.uid&&(h.uid=f.getid(e.id,h,g))}f.buildHierarchy.call(f);d.isFunction(c.loadComplete)&&c.loadComplete(b);f.callDownloadComplete()})},
    getUniqueRecords:function(b,e){if(b&&e)for(var c=b.length,f=e.length,d=[],g=[],h=0;h<c;h++){var k=b[h],q="";if(void 0!=k){for(var l=0;l<f;l++)q+=k[e[l]]+"_";g[q]||(d[d.length]=k);g[q]=!0}}return d},getAggregatedData:function(b,e,c,f){var g=c;g||(g=this.records);var h={};c=[];var k=g.length;if(0!=k&&void 0!=k){for(var q=0;q<k;q++)for(var l=g[q],u=0;u<b.length;u++){var m=b[u],p=l[m.name];if(m.aggregates){h[m.name]=h[m.name]||{};c[m.name]=c[m.name]||0;c[m.name]++;var y=function(b){for(var e in b){var c=
        h[m.name][e];null==c&&(c=h[m.name][e]=0);d.isFunction(b[e])&&(c=b[e](c,p,m.name,l,f));h[m.name][e]=c}},r=parseFloat(p);(r=isNaN(r)?!1:!0)&&(p=parseFloat(p));"number"===typeof p&&isFinite(p)?d.each(m.aggregates,function(){var b=h[m.name][this];null==b&&(b=0,"min"==this&&(b=9999999999999),"max"==this&&(b=-9999999999999));if("sum"==this||"avg"==this||"stdev"==this||"stdevp"==this||"var"==this||"varp"==this)b+=parseFloat(p);else if("product"==this)b=0==q?parseFloat(p):b*parseFloat(p);else if("min"==this)b=
        Math.min(b,parseFloat(p));else if("max"==this)b=Math.max(b,parseFloat(p));else if("count"==this)b++;else if("object"==typeof this){y(this);return}h[m.name][this]=b}):d.each(m.aggregates,function(){if("min"==this||"max"==this||"count"==this||"product"==this||"sum"==this||"avg"==this||"stdev"==this||"stdevp"==this||"var"==this||"varp"==this){if(null===p)return!0;var b=h[m.name][this];null==b&&(b=0);h[m.name][this]=b;return!0}"object"==typeof this&&y(this)})}}for(u=0;u<b.length;u++)m=b[u],h[m.name]||
    (h[m.name]={},d.each(m.aggregates,function(b){h[m.name][this]=0})),void 0!=h[m.name].avg?(p=h[m.name].avg,r=c[m.name],h[m.name].avg=0===r||void 0==r?0:p/r):void 0!=h[m.name].count&&(h[m.name].count=k),(h[m.name].stdev||h[m.name].stdevp||h[m.name]["var"]||h[m.name].varp)&&d.each(m.aggregates,function(b){if("stdev"==this||"var"==this||"varp"==this||"stdevp"==this){for(var e=h[m.name][this]/k,c=b=0;c<k;c++){var f=g[c][m.name];b+=(f-e)*(f-e)}e="stdevp"==this||"varp"==this?k:k-1;0==e&&(e=1);if("var"==
        this||"varp"==this)h[m.name][this]=b/e;else if("stdevp"==this||"stdev"==this)h[m.name][this]=Math.sqrt(b/e)}}),m.formatStrings&&d.each(m.aggregates,function(b){if(b=m.formatStrings[b])if("min"==this||"max"==this||"count"==this||"product"==this||"sum"==this||"avg"==this||"stdev"==this||"stdevp"==this||"var"==this||"varp"==this){var c=h[m.name][this];h[m.name][this]=d.jqx.dataFormat.formatnumber(c,b,e)}else if("object"==typeof this)for(var f in this)c=h[m.name][f],h[m.name][f]=d.jqx.dataFormat.formatnumber(c,
        b,e)});return h}},bindDownloadComplete:function(b,e){this._downloadComplete[this._downloadComplete.length]={id:b,func:e}},unbindDownloadComplete:function(b){for(var e=0;e<this._downloadComplete.length;e++)if(this._downloadComplete[e].id==b){this._downloadComplete[e].func=null;this._downloadComplete.splice(e,1);break}},callDownloadComplete:function(){for(var b=0;b<this._downloadComplete.length;b++){var e=this._downloadComplete[b];null!=e.func&&e.func()}},setSource:function(b){this._source=b},generatekey:function(){var b=
        function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()},getGroupedRecords:function(b,e,c,f,g,h,k,q,l){l||(l=0);for(var u=[],m=0;m<b.length;m++)u[m]=this.generatekey();e||(e="items");c||(c="group");g||(g="record");k||(k="parentItem");void 0===h&&(h="value");var p=[],y=0,r=[],t=b.length;q||(q=this.records);for(var w=q.length,z=function(b){f&&d.each(f,function(){this.name&&this.map&&(b[this.map]=b[this.name])});return b},A=0;A<w;A++){var v=
        z(q[A]),G=[],C=0;for(m=0;m<t;m++){var H=v[b[m]];null!=H&&(G[C++]={value:H,hash:u[m]})}if(G.length!=t)break;m=null;C="";H=-1;for(var B=0;B<G.length;B++){H++;var N=G[B].value;C=C+"_"+G[B].hash+"_"+N;if(void 0!=r[C]&&null!=r[C])m=r[C];else{if(null==m){m={level:0};m[k]=null;m[c]=N;m[g]=v;m.expanded=void 0!==v.expanded?v.expanded:!1;h&&(m[h]=v[h]);m[e]=[];N=p.length+l;if(!this._source.id||"number"===typeof v.uid||isFinite(v.uid))N="Row"+N;m.uid=N;p[y++]=m}else{var D={level:m.level+1};D[k]=m;D[c]=N;D[e]=
        [];D[g]=v;D.expanded=void 0!==v.expanded?v.expanded:!1;h&&(D[h]=v[h]);D.uid=m.uid+"_"+m[e].length;m=m[e][m[e].length]=D}r[C]=m}}v&&(v.leaf=!0);null!=m?(null==this._source.id&&(void 0==v.uid?v.uid=m.uid+"_"+m[e].length:-1==v.uid.toString().indexOf(m.uid)&&(v.uid=m.uid+"_"+v.uid)),v[k]=m,v.level=m.level+1,m[e][m[e].length]=v):void 0==v.uid&&(v.uid=this.generatekey())}return p},getRecordsHierarchy:function(b,e,c,f,g){var h=[],k=this.records;g&&(k=g);if(0==this.records.length)return null;var q=null!=
    c?c:"items";c=[];g=k.length;for(var l=this._source&&this._source.hierarchy?this._source.hierarchy.reservedNames:null,u=function(b){f&&d.each(f,function(){this.name&&this.map&&(b[this.map]=b[this.name])});return b},m=0;m<g;m++){var p=d.extend({},k[m]),y=p[e],r=p[b];c[r]={parentid:y,item:p}}for(m=0;m<g;m++)if(p=d.extend({},k[m]),y=p[e],r=p[b],void 0!=c[y]){p={parentid:y,item:c[r].item};var t=c[y].item;t[q]||(t[q]=[]);var w=t[q].length,z=p.item;l?void 0==z[l.parent]&&(z[l.parent]=t):void 0==z.parent&&
        (z.parent=t);z=u(z);t[q][w]=z;c[y].item=t;c[r]=p}else z=c[r].item,l?void 0==z[l.parent]&&(z[l.parent]=null):void 0==z.parent&&(z.parent=null),z=u(z),l?z[l.level]=0:z.level=0,h[h.length]=z;if(0!=h.length){var A=function(b,e){for(var c=0;c<e.length;c++){l?e[c][l.level]=b:e[c].level=b;var f=e[c][q];f?0<f.length?A(b+1,f):l?e[c][l.leaf]=!0:e[c].leaf=!0:l?e[c][l.leaf]=!0:e[c].leaf=!0}};A(0,h)}return h},bindBindingUpdate:function(b,e){this._bindingUpdate[this._bindingUpdate.length]={id:b,func:e}},unbindBindingUpdate:function(b){for(var e=
        0;e<this._bindingUpdate.length;e++)if(this._bindingUpdate[e].id==b){this._bindingUpdate[e].func=null;this._bindingUpdate.splice(e,1);break}},callBindingUpdate:function(b){for(var e=0;e<this._bindingUpdate.length;e++){var c=this._bindingUpdate[e];null!=c.func&&c.func(b)}},getid:function(b,e,c){if(null!=b&&void 0!=b.name&&b.name){var f=d(e).attr(b.name);if(null!=f&&0<f.toString().length)return f;if(b.map)try{f=d(e).attr(b.map);if(null!=f&&0<f.toString().length)return f;if(0<d(b.map,e).length)return d(b.map,
        e).text();if(0<d(b.name,e).length)return d(b.name,e).text()}catch(J){return c}}else{if(0<d(b,e).length)return d(b,e).text();if(b&&0<b.toString().length){f=d(e).attr(b);if(null!=f&&0<f.toString().length)return d.trim(f).split(" ").join("").replace(/([ #;?%&,.+*~':"!^$[\]()=>|\/\\@])/g,"");f=b.split(this.mapChar);if(1<f.length){b=e;for(e=0;e<f.length;e++)void 0!=b&&(b=b[f[e]]);if(void 0!=b)return b}else if(void 0!=e[b])return e[b]}return c}},loadjson:function(b,e,c){"string"==typeof b&&(b=d.parseJSON(b));
        void 0==c.root&&(c.root="");void 0==c.record&&(c.record="");(b=b||e)||(b=[]);var f=this;if(""!=c.root){var g=c.root.split(f.mapChar);if(1<g.length){e=b;for(var h=0;h<g.length;h++)void 0!=e&&(e=e[g[h]]);b=e}else if(void 0!==b[c.root]?b=b[c.root]:b[0]&&void 0!==b[0][c.root]?b=b[0][c.root]:d.each(b,function(e){if(this==c.root)return b=this,!1;void 0!=this[c.root]&&(b=this[c.root])}),!b&&(g=c.root.split(f.mapChar),0<g.length)){e=b;for(h=0;h<g.length;h++)void 0!=e&&(e=e[g[h]]);b=e}}else if(!b.length)for(var k in b)if(d.isArray(b[k])){b=
            b[k];break}null!=b&&void 0==b.length&&(b=d.makeArray(b));if(null==b||void 0==b||"undefined"==b||void 0==b.length)throw Error("jqxDataAdapter: JSON Parse error! Invalid JSON. Please, check your JSON or your jqxDataAdapter initialization!");if(0==b.length)this.totalrecords=0;else{e=b.length;this.totalrecords=this.virtualmode?c.totalrecords||e:e;this.records=[];this.originaldata=[];var q=this.records,l=this.pageable?this.pagesize*this.pagenum:c.recordstartindex;this.recordids=[];c.loadallrecords&&(l=
            0,e=this.totalrecords);var u=0;this.virtualmode&&(u=l=this.pageable?this.pagesize*this.pagenum:c.recordstartindex,l=0,e=this.totalrecords);var m=c.datafields?c.datafields.length:0;if(0==m){g=b[0];h=[];for(k in g)h[h.length]={name:k};c.datafields=h;c.generatedfields=c.datafields;m=h.length}for(var p=k=l;p<e;p++){var y=b[p];if(void 0==y)break;if(c.record&&""!=c.record&&(y=y[c.record],void 0==y))continue;var r=this.getid(c.id,y,p);"object"===typeof r&&(r=p);if(!this.recordids[r]){this.recordids[r]=y;
            for(var t={},w=0;w<m;w++){var z=c.datafields[w];g="";if(void 0!=z&&null!=z){if(z.map){if(d.isFunction(z.map))g=z.map(y);else if(g=z.map.split(f.mapChar),0<g.length){var A=y;for(h=0;h<g.length;h++)void 0!=A&&(A=A[g[h]]);g=A}else g=y[z.map];void 0!=g&&null!=g?g=this.getvaluebytype(g,z):void 0==g&&null!=g&&(g="")}""!=g||z.map||(g=y[z.name],void 0==g&&null!=g&&(g=""),void 0!=z.value&&void 0!=g&&(h=g[z.value],void 0!=h&&(g=h)));g=this.getvaluebytype(g,z);void 0!=z.displayname?t[z.displayname]=g:t[z.name]=
                g;if("array"===z.type){var v=function(b){if(b)for(var e=0;e<b.length;e++){var g=b[e];if(g)for(var h=0;h<m;h++){var k=c.datafields[h],q="";if(void 0!=k&&null!=k){if(k.map){if(d.isFunction(k.map))q=k.map(g);else if(q=k.map.split(f.mapChar),0<q.length){for(var l=g,u=0;u<q.length;u++)void 0!=l&&(l=l[q[u]]);q=l}else q=g[k.map];void 0!=q&&null!=q?q=this.getvaluebytype(q,k):void 0==q&&null!=q&&(q="")}""!=q||k.map||(q=g[k.name],void 0==q&&null!=q&&(q=""),void 0!=k.value&&void 0!=q&&(l=q[k.value],void 0!=
            l&&(q=l)));q=this.getvaluebytype(q,k);void 0!=k.displayname?g[k.displayname]=q:g[k.name]=q;"array"===k.type&&v.call(this,q)}}}};v.call(this,g)}}}if(0>=c.recordendindex||l<c.recordendindex)q[u+k]=Object(t),q[u+k].uid=r,this.originaldata[u+k]=Object(q[p]),k++}}this.cachedrecords=this.records=q}},loadxml:function(b,e,c){"string"==typeof b&&(e=d(d.parseXML(b)),b=null);void 0==c.root&&(c.root="");void 0==c.record&&(c.record="");(b=d.jqx.browser.msie&&e?void 0!=e.xml?d(c.root+" "+c.record,d.parseXML(e.xml)):
        b||d(c.root+" "+c.record,e):b||d(c.root+" "+c.record,e))||(b=[]);e=b.length;if(0!=b.length){this.totalrecords=this.virtualmode?c.totalrecords||e:e;this.records=[];this.originaldata=[];var f=this.records,g=this.pageable?this.pagesize*this.pagenum:c.recordstartindex;this.recordids=[];c.loadallrecords&&(g=0,e=this.totalrecords);var h=0;this.virtualmode&&(h=g=this.pageable?this.pagesize*this.pagenum:c.recordstartindex,g=0,e=this.totalrecords);var k=c.datafields?c.datafields.length:0;if(0==k){k=b[0];var q=
        [],l;for(l in k)q[q.length]={name:l};c.datafields=q;c.generatedfields=c.datafields;k=q.length}var u=g;for(l=g;l<e;l++){q=b[l];if(void 0==q)break;var m=this.getid(c.id,q,l);if(!this.recordids[m]){this.recordids[m]=q;var p={},y=!1;c.hierarchy&&c.hierarchy.root&&(y=!0);for(var r=0;r<k;r++){var t=c.datafields[r],w="";if(void 0!=t&&null!=t){if(t.map)if(d.isFunction(t.map))w=t.map(q);else{var z=t.map.indexOf("[");if(0>z)if(w=d(t.map,q),1==w.length)w=w.text();else{z=[];for(var A=0;A<w.length;A++)z.push(d(w[A]).text());
        w=z;y&&0<z.length&&(w=z[0])}else w=t.map.substring(0,z-1),A=t.map.indexOf("]"),z=t.map.substring(z+1,A),w=d(w,q).attr(z),void 0==w&&(w=d(q).attr(z)),void 0==w&&(w="");""==w&&(w=d(q).attr(t.map),void 0==w&&(w=""))}if(""==w){w=d(t.name,q);if(1==w.length)w=w.text();else{z=[];for(A=0;A<w.length;A++)z.push(d(w[A]).text());w=z;y&&0<z.length&&(w=z[0])}""==w&&(w=d(q).attr(t.name),void 0==w&&(w=""));""==w&&q.nodeName&&q.nodeName==t.name&&q.firstChild&&(w=d(q.firstChild).text())}w=this.getvaluebytype(w,t);
        void 0!=t.displayname?p[t.displayname]=w:p[t.name]=w}}if(0>=c.recordendindex||g<c.recordendindex)f[h+u]=d.extend({},p),f[h+u].uid=m,this.originaldata[h+u]=d.extend({},f[l]),u++}}if(c.hierarchy&&c.hierarchy.root)for(l=g;l<e;l++)q=b[l],g=f[l],0<d(q).parent().length?(m=this.getid(c.id,d(q).parents(c.hierarchy.record+":first")),g.parentuid=m):g.parentuid=null;this.cachedrecords=this.records=f}},loadics:function(b,e){if(null!=b){e=b.split(e.rowDelimiter||this.rowDelimiter||"\n");var c=e.length;b=b.split("\r");
        1==c&&1<b.length&&(e=b,c=e.length);this.records=[];this.originaldata=[];b=this.records;this.recordids=[];for(var f=function(b){var e=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z)?$/.exec(b);if(!e)throw Error("Invalid UNTIL value: "+b);return new Date(Date.UTC(e[1],e[2]-1,e[3],e[5]||0,e[6]||0,e[7]||0))},d=0;d<c;d++){var g=e[d];if("BEGIN:VEVENT"==g)var h={};else 0<=g.indexOf("SUMMARY")?h.SUMMARY=g.substring(g.indexOf("SUMMARY")+8):0<=g.indexOf("LOCATION")?h.LOCATION=g.substring(g.indexOf("LOCATION")+
            9):0<=g.indexOf("DESCRIPTION")?h.DESCRIPTION=g.substring(g.indexOf("DESCRIPTION")+12):0<=g.indexOf("RRULE")?h.RRULE=g.substring(g.indexOf("RRULE")+6):0<=g.indexOf("EXDATE")?(g=g.substring(g.indexOf("EXDATE")+7),h.EXDATE=g):0<=g.indexOf("DTEND")?h.DTEND=f(g.substring(g.indexOf("DTEND")+6)):0<=g.indexOf("DTSTART")?h.DTSTART=f(g.substring(g.indexOf("DTSTART")+8)):0<=g.indexOf("UID")?h.uid=h.UID=g.substring(g.indexOf("UID")+4):0<=g.indexOf("STATUS")?h.STATUS=g.substring(g.indexOf("STATUS")+7):"END:VEVENT"==
            g&&b.push(h)}this.cachedrecords=this.records=b}},loadtext:function(b,e){if(null!=b){var c=b.split(e.rowDelimiter||this.rowDelimiter||"\n"),f=c.length;b=b.split("\r");1==f&&1<b.length&&(c=b,f=c.length);this.totalrecords=this.virtualmode?e.totalrecords||f:f;this.records=[];this.originaldata=[];b=this.records;var g=this.pageable?this.pagesize*this.pagenum:e.recordstartindex;this.recordids=[];e.loadallrecords&&(g=0,f=this.totalrecords);var h=0;this.virtualmode&&(h=g=this.pageable?this.pagesize*this.pagenum:
        e.recordstartindex,g=0,f=this.totalrecords);var k=e.datafields.length,q=e.columnDelimiter||this.columnDelimiter;for(q||(q="tab"===e.datatype||"tsv"===e.datatype?"\t":",");g<f;g++){var l=c[g],u=null;if(!this.recordids[u]){null==e.id&&(u=g,this.recordids[u]=l);for(var m={},p=c[g].split(q),y=0;y<k;y++)if(!(y>=p.length)){var r=e.datafields[y],t=p[y];r.map&&d.isFunction(r.map)&&(t=r.map(l));r.type&&(t=this.getvaluebytype(t,r));m[r.map||r.name||y.toString()]=t;null!=e.id&&e.id===r.name&&(u=t,this.recordids[u]=
        l)}null==u&&(u=g);b[h+g]=d.extend({},m);b[h+g].uid=u;this.originaldata[h+g]=d.extend({},b[g])}}this.cachedrecords=this.records=b}},getvaluebytype:function(b,e){var c=b;if(null==b)return b;if(d.isArray(b)&&"array"!=e.type){for(c=0;c<b.length;c++)b[c]=this.getvaluebytype(b[c],e);return b}if("date"==e.type)if("NaN"==b)b="";else{if(b&&b instanceof Date)return b;var f=new Date(b);"string"==typeof b&&e.format&&(e=d.jqx.dataFormat.parsedate(b,e.format),null!=e&&(f=e));b="NaN"==f.toString()||"Invalid Date"==
    f.toString()?d.jqx.dataFormat?d.jqx.dataFormat.tryparsedate(b):f:f;null==b&&(b=c)}else if("float"==e.type||"number"==e.type||"decimal"==e.type)"NaN"==b?b="":(b=parseFloat(b),isNaN(b)&&(b=c));else if("int"==e.type||"integer"==e.type)b=parseInt(b),isNaN(b)&&(b=c);else if("bool"==e.type||"boolean"==e.type)null!=b&&void 0!=b.toLowerCase&&("false"==b.toLowerCase()?b=!1:"true"==b.toLowerCase()&&(b=!0)),b=1==b?!0:0==b&&""!==b?!1:"";return b}};d.jqx.dataFormat={};d.extend(d.jqx.dataFormat,{regexTrim:/^\s+|\s+$/g,
    regexInfinity:/^[+-]?infinity$/i,regexHex:/^0x[a-f0-9]+$/i,regexParseFloat:/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/,toString:Object.prototype.toString,isBoolean:function(b){return"boolean"===typeof b},isObject:function(b){return b&&("object"===typeof b||d.isFunction(b))||!1},isDate:function(b){return b instanceof Date},arrayIndexOf:function(b,e){if(b.indexOf)return b.indexOf(e);for(var c=0,f=b.length;c<f;c++)if(b[c]===e)return c;return-1},isString:function(b){return"string"===typeof b},isNumber:function(b){return"number"===
        typeof b&&isFinite(b)},isNull:function(b){return null===b},isUndefined:function(b){return"undefined"===typeof b},isValue:function(b){return this.isObject(b)||this.isString(b)||this.isNumber(b)||this.isBoolean(b)},isEmpty:function(b){if(!this.isString(b)&&this.isValue(b))return!1;if(!this.isValue(b))return!0;b=d.trim(b).replace(/&nbsp;/ig,"").replace(/&#160;/ig,"");return""===b},startsWith:function(b,e){return 0===b.indexOf(e)},endsWith:function(b,e){return b.substr(b.length-e.length)===e},trim:function(b){return(b+
        "").replace(this.regexTrim,"")},isArray:function(b){return"[object Array]"===this.toString.call(b)},defaultcalendar:function(){return{"/":"/",":":":",firstDay:0,days:{names:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),namesAbbr:"Sun Mon Tue Wed Thu Fri Sat".split(" "),namesShort:"Su Mo Tu We Th Fr Sa".split(" ")},months:{names:"January February March April May June July August September October November December ".split(" "),namesAbbr:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec ".split(" ")},
        AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",ISO:"yyyy-MM-dd hh:mm:ss",ISO2:"yyyy-MM-dd HH:mm:ss",d1:"dd.MM.yyyy",d2:"dd-MM-yyyy",d3:"MM-dd-yyyy",zone1:"yyyy-MM-ddTHH:mm:ss-HH:mm",zone2:"yyyy-MM-ddTHH:mm:ss+HH:mm",custom:"yyyy-MM-ddTHH:mm:ss.fff",
            custom2:"yyyy-MM-dd HH:mm:ss.fff"},percentsymbol:"%",currencysymbol:"$",currencysymbolposition:"before",decimalseparator:".",thousandsseparator:","}},expandFormat:function(b,e){e=e||"F";b=b.patterns;var c=e.length;if(1===c){b=b[e];if(!b)throw"Invalid date format string '"+e+"'.";e=b}else 2===c&&"%"===e.charAt(0)&&(e=e.charAt(1));return e},getEra:function(b,e){if(!e||"string"===typeof b)return 0;for(var c=b.getTime(),f=0,d=e.length;f<d;f++)if(b=e[f].start,null===b||c>=b)return f;return 0},toUpperArray:function(b){for(var e=
        [],c=0,f=b.length;c<f;c++)e[c]=this.toUpper(b[c]);return e},getEraYear:function(b,e,c,f){b=b.getFullYear();!f&&e.eras&&(b-=e.eras[c].offset);return b},toUpper:function(b){return b?b.toUpperCase():""},getDayIndex:function(b,e,c){var f=b.days,d=b._upperDays;d||(b._upperDays=d=[this.toUpperArray(f.names),this.toUpperArray(f.namesAbbr),this.toUpperArray(f.namesShort)]);e=e.toUpperCase();c?(b=this.arrayIndexOf(d[1],e),-1===b&&(b=this.arrayIndexOf(d[2],e))):b=this.arrayIndexOf(d[0],e);return b},getMonthIndex:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             e,c){var f=b.months,d=b.monthsGenitive||b.months,g=b._upperMonths,h=b._upperMonthsGen;g||(b._upperMonths=g=[this.toUpperArray(f.names),this.toUpperArray(f.namesAbbr)],b._upperMonthsGen=h=[this.toUpperArray(d.names),this.toUpperArray(d.namesAbbr)]);e=this.toUpper(e);b=this.arrayIndexOf(c?g[1]:g[0],e);0>b&&(b=this.arrayIndexOf(c?h[1]:h[0],e));return b},appendPreOrPostMatch:function(b,e){for(var c=0,f=!1,d=0,g=b.length;d<g;d++){var h=b.charAt(d);switch(h){case "'":f?e.push("'"):c++;f=!1;break;case "\\":f&&
    e.push("\\");f=!f;break;default:e.push(h),f=!1}}return c},getTokenRegExp:function(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g},formatlink:function(b,e){var c="";e&&e.target&&(c="target="+e.target);return""!=c?"<a "+c+' href="'+b+'">'+b+"</a>":'<a href="'+b+'">'+b+"</a>"},formatemail:function(b){return'<a href="mailto:'+b+'">'+b+"</a>"},formatNumber:function(b,e,c){return this.formatnumber(b,e,c)},formatnumber:function(b,e,c){if(void 0==c||null==
        c||""==c)c=this.defaultcalendar();if(""===e||null===e)return b;this.isNumber(b)||(b*=1);var f;1<e.length&&(f=parseInt(e.slice(1),10));var d,g,h=e.charAt(0).toUpperCase();e=c.thousandsseparator;var k=c.decimalseparator;switch(h){case "D":case "d":case "F":case "f":break;case "N":case "n":f=0;break;case "C":case "c":"before"==c.currencysymbolposition?d=c.currencysymbol:g=c.currencysymbol;break;case "P":case "p":g=c.percentsymbol;break;default:throw"Bad number format specifier: "+h;}if(this.isNumber(b)){c=
        0>b;k=k?k:".";if(this.isNumber(f)){var q=f;f=Math.pow(10,q);b=(b*f).toFixed(0)/f+"";f=b.lastIndexOf(".");if(0<q)for(0>f?(b+=k,f=b.length-1):"."!==k&&(b=b.replace(".",k));b.length-1-f<q;)b+="0"}else b+="",f=b.lastIndexOf("."),0<f&&void 0==q&&"."!==k&&(b=b.replace(".",k));if(e){f=b.lastIndexOf(k);f=-1<f?f:b.length;q=b.substring(f);k=-1;for(h=f;0<h;h--)k++,0===k%3&&h!==f&&(!c||1<h)&&(q=e+q),q=b.charAt(h-1)+q;b=q}b=d?d+b:b;return g?b+g:b}return b},tryparsedate:function(b,e){if(void 0==e||null==e)e=this.defaultcalendar();
        if(""==b)return null;null==b||b.substring||(b=b.toString());if(null!=b&&"/Date("==b.substring(0,6)){e=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/;var c=new Date(+b.replace(/\/Date\((\d+)\)\//,"$1"));if("Invalid Date"==c){var f=b.match(/^\/Date\((\d+)([-+]\d\d)(\d\d)\)\/$/);c=null;f&&(c=new Date(1*f[1]+36E5*f[2]+6E4*f[3]))}if(null==c||"Invalid Date"==c||isNaN(c))if(b=e.exec(b)){var g=new Date(parseInt(b[1]));b[2]&&(e=parseInt(b[3]),"-"===b[2]&&(e=-e),b=g.getUTCMinutes(),g.setUTCMinutes(b-e));if(!isNaN(g.valueOf()))return g}return c}var h=
            e.patterns;for(q in h)if(c=this.parsedate(b,h[q],e))return"ISO"==q&&(e=this.parsedate(b,h.ISO2,e))?e:c;if(null!=b){g=[":","/","-"];c=!0;for(var k=0;k<g.length;k++)-1!=b.indexOf(g[k])&&(c=!1);if(c&&(c=new Number(b),!isNaN(c)))return new Date(c)}if("string"===d.type(b)){b=this.trim(b);var q=[":","/","-"," ",","];b=b.replace(/, /g,",");h="";var l=b;0<=b.indexOf(":")?(h=b.substring(b.indexOf(":")-2),h=this.trim(h),l=b.substring(0,b.indexOf(":")-2)):0<=b.toUpperCase().indexOf("AM")?(h=b.substring(b.toUpperCase().indexOf("AM")-
            2),h=this.trim(h),l=b.substring(0,b.toUpperCase().indexOf("AM")-2)):0<=b.toUpperCase().indexOf("PM")&&(h=b.substring(b.toUpperCase().indexOf("PM")-2),h=this.trim(h),l=b.substring(0,b.toUpperCase().indexOf("PM")-2));b=new Date;c=!1;if(l){for(f=0;f<q.length;f++)if(0<=l.indexOf(q[f])){g=l.split(q[f]);break}q=[];l=[];var u=[],m=null,p=null;for(f=0;f<g.length;f++){k=g[f];var y=this.parsedate(k,"d",e)||this.parsedate(k,"dd",e)||this.parsedate(k,"ddd",e)||this.parsedate(k,"dddd",e);if(y&&2>=k.length){m=
            f;q.push(y.getDate());break}}for(f=0;f<g.length;f++)if(k=g[f],(y=this.parsedate(k,"M",e)||this.parsedate(k,"MM",e)||this.parsedate(k,"MMM",e)||this.parsedate(k,"MMMM",e))&&(void 0==m||m!=f)&&(l.push(y.getMonth()),2<k.length)){p=f;break}for(f=0;f<g.length;f++)k=g[f],k=this.parsedate(k,"yyyy",e),!k||void 0!=m&&m==f||(void 0==p||p!=f)&&u.push(k.getFullYear());k=[];for(m=0;m<q.length;m++)for(f=0;f<l.length;f++)for(p=0;p<u.length;p++)g=new Date(u[p],l[f],q[m]),1970>u[p]&&g.setFullYear(u[p]),NaN!=g.getTime()&&
        k.push(g);0<k.length&&(b=k[0],c=!0)}h&&(g=0<=h.indexOf(":")?h.split(":"):h,e=this.parsedate(h,"h:mm tt",e)||this.parsedate(h,"h:mm:ss tt",e)||this.parsedate(h,"HH:mm:ss.fff",e)||this.parsedate(h,"HH:mm:ss.ff",e)||this.parsedate(h,"HH:mm:ss.tttt",e)||this.parsedate(h,"HH:mm:ss",e)||this.parsedate(h,"HH:mm",e)||this.parsedate(h,"HH",e),u=l=q=h=0,e&&NaN!=e.getTime()?(h=e.getHours(),q=e.getMinutes(),l=e.getSeconds(),u=e.getMilliseconds()):(1==g.length&&(h=parseInt(g[0])),2==g.length&&(h=parseInt(g[0]),
            q=parseInt(g[1])),3==g.length&&(h=parseInt(g[0]),q=parseInt(g[1]),0<=g[2].indexOf(".")?(l=parseInt(g[2].toString().split(".")[0]),u=parseInt(g[2].toString().split(".")[1])):l=parseInt(g[2])),4==g.length&&(h=parseInt(g[0]),q=parseInt(g[1]),l=parseInt(g[2]),u=parseInt(g[3]))),!b||isNaN(h)||isNaN(q)||isNaN(l)||isNaN(u)||(b.setHours(h,q,l,u),c=!0));if(c)return b}return null},getparseregexp:function(b,e){var c=b._parseRegExp;if(c){var f=c[e];if(f)return f}else b._parseRegExp=c={};f=this.expandFormat(b,
        e).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1");for(var d=["^"],g=[],h=0,k=0,q=this.getTokenRegExp(),l;null!==(l=q.exec(f));){var u=f.slice(h,l.index);h=q.lastIndex;k+=this.appendPreOrPostMatch(u,d);if(k%2)d.push(l[0]);else{u=l[0];var m=u.length;switch(u){case "dddd":case "ddd":case "MMMM":case "MMM":case "gg":case "g":u="(\\D+)";break;case "tt":case "t":u="(\\D*)";break;case "yyyy":case "fff":case "ff":case "f":u="(\\d{"+m+"})";break;case "dd":case "d":case "MM":case "M":case "yy":case "y":case "HH":case "H":case "hh":case "h":case "mm":case "m":case "ss":case "s":u=
        "(\\d\\d?)";break;case "zzz":u="([+-]?\\d\\d?:\\d{2})";break;case "zz":case "z":u="([+-]?\\d\\d?)";break;case "/":u="(\\"+b["/"]+")";break;default:throw"Invalid date format pattern '"+u+"'.";}u&&d.push(u);g.push(l[0])}}this.appendPreOrPostMatch(f.slice(h),d);d.push("$");b={regExp:d.join("").replace(/\s+/g,"\\s+"),groups:g};return c[e]=b},outOfRange:function(b,e,c){return b<e||b>c},expandYear:function(b,e){var c=new Date,f=this.getEra(c);if(100>e){var d=b.twoDigitYearMax;d="string"===typeof d?(new Date).getFullYear()%
        100+parseInt(d,10):d;b=this.getEraYear(c,b,f);e+=b-b%100;e>d&&(e-=100)}return e},parsedate:function(b,e,c){if(void 0==c||null==c)c=this.defaultcalendar();b=this.trim(b);e=this.getparseregexp(c,e);var f=(new RegExp(e.regExp)).exec(b);if(null===f)return null;var d=e.groups,g=e=b=null,h=null,k=null,q=0,l=0,u=0,m=0;var p=null;for(var y=!1,r=0,t=d.length;r<t;r++){var w=f[r+1];if(w){var z=d[r],A=z.length,C=parseInt(w,10);switch(z){case "dd":case "d":h=C;if(this.outOfRange(h,1,31))return null;break;case "MMM":case "MMMM":g=
        this.getMonthIndex(c,w,3===A);if(this.outOfRange(g,0,11))return null;break;case "M":case "MM":g=C-1;if(this.outOfRange(g,0,11))return null;break;case "y":case "yy":case "yyyy":e=4>A?this.expandYear(c,C):C;if(this.outOfRange(e,0,9999))return null;break;case "h":case "hh":q=C;12===q&&(q=0);if(this.outOfRange(q,0,11))return null;break;case "H":case "HH":q=C;if(this.outOfRange(q,0,23))return null;break;case "m":case "mm":l=C;if(this.outOfRange(l,0,59))return null;break;case "s":case "ss":u=C;if(this.outOfRange(u,
        0,59))return null;break;case "tt":case "t":y=c.PM&&(w===c.PM[0]||w===c.PM[1]||w===c.PM[2]);if(!y&&(!c.AM||w!==c.AM[0]&&w!==c.AM[1]&&w!==c.AM[2]))return null;break;case "f":case "ff":case "fff":m=C*Math.pow(10,3-A);if(this.outOfRange(m,0,999))return null;break;case "ddd":case "dddd":k=this.getDayIndex(c,w,3===A);if(this.outOfRange(k,0,6))return null;break;case "zzz":z=w.split(/:/);if(2!==z.length)return null;p=parseInt(z[0],10);if(this.outOfRange(p,-12,13))return null;z=parseInt(z[1],10);if(this.outOfRange(z,
        0,59))return null;p=60*p+(this.startsWith(w,"-")?-z:z);break;case "z":case "zz":p=C;if(this.outOfRange(p,-12,13))return null;p*=60;break;case "g":case "gg":if(!w||!c.eras)return null;w=this.trim(w.toLowerCase());z=0;for(A=c.eras.length;z<A;z++)if(w===c.eras[z].name.toLowerCase()){b=z;break}if(null===b)return null}}}f=new Date;r=c.convert;d=f.getFullYear();null===e?e=d:c.eras&&(e+=c.eras[b||0].offset);null===g&&(g=0);null===h&&(h=1);if(r){if(f=r.toGregorian(e,g,h),null===f)return null}else if(f.setFullYear(e,
        g,h),f.getDate()!==h||null!==k&&f.getDay()!==k)return null;y&&12>q&&(q+=12);f.setHours(q,l,u,m);null!==p&&(c=f.getMinutes()-(p+f.getTimezoneOffset()),f.setHours(f.getHours()+parseInt(c/60,10),c%60));return f},cleardatescache:function(){this.datescache=[]},formatDate:function(b,e,c){return this.formatdate(b,e,c)},formatdate:function(b,e,c){function f(b,e){b+="";return 1<e&&b.length<e?(b=u[e-2]+b,b.substr(b.length-e,e)):b}function d(b,e){if(y)return y[e];if(void 0!=b.getMonth)switch(e){case 0:return b.getFullYear();
        case 1:return b.getMonth();case 2:return b.getDate()}}if(void 0==c||null==c)c=this.defaultcalendar();if("string"===typeof b)return b;var g=b.toString()+"_"+e;if(this.datescache&&this.datescache[g]&&-1==e.indexOf("f"))return this.datescache[g];if(!e||!e.length||"i"===e){var h;return h=this.formatDate(b,c.patterns.F,c)}var k=c.eras,q="s"===e;e=this.expandFormat(c,e);h=[];for(var l,u=["0","00","000"],m=0,p=this.getTokenRegExp(),y;;){l=p.lastIndex;var r=p.exec(e);l=e.slice(l,r?r.index:e.length);m+=this.appendPreOrPostMatch(l,
        h);if(!r)break;if(m%2)h.push(r[0]);else switch(l=r[0],r=l.length,l){case "ddd":case "dddd":h.push((3===r?c.days.namesAbbr:c.days.names)[b.getDay()]);break;case "d":case "dd":h.push(f(d(b,2),r));break;case "MMM":case "MMMM":l=d(b,1);h.push(c.months[3===r?"namesAbbr":"names"][l]);break;case "M":case "MM":h.push(f(d(b,1)+1,r));break;case "y":case "yy":case "yyyy":l=this.getEraYear(b,c,this.getEra(b,k),q);4>r&&(l%=100);h.push(f(l,r));break;case "h":case "hh":l=b.getHours()%12;0===l&&(l=12);h.push(f(l,
        r));break;case "H":case "HH":h.push(f(b.getHours(),r));break;case "m":case "mm":h.push(f(b.getMinutes(),r));break;case "s":case "ss":h.push(f(b.getSeconds(),r));break;case "t":case "tt":l=12>b.getHours()?c.AM?c.AM[0]:" ":c.PM?c.PM[0]:" ";h.push(1===r?l.charAt(0):l);break;case "f":case "ff":case "fff":h.push(f(b.getMilliseconds(),3).substr(0,r));break;case "z":case "zz":l=b.getTimezoneOffset()/60;h.push((0>=l?"+":"-")+f(Math.floor(Math.abs(l)),r));break;case "zzz":l=b.getTimezoneOffset()/60;h.push((0>=
    l?"+":"-")+f(Math.floor(Math.abs(l)),2)+":"+f(Math.abs(b.getTimezoneOffset()%60),2));break;case "g":case "gg":c.eras&&h.push(c.eras[this.getEra(b,k)].name);break;case "/":h.push(c["/"]);break;default:throw"Invalid date format pattern '"+l+"'.";}}b=h.join("");this.datescache||(this.datescache=[]);return this.datescache[g]=b}});d.jqx.data={};var g=/#.*$/,h=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,k=/^(?:GET|HEAD)$/,l=/^\/\//,m=/\?/,p=/([?&])_=[^&]*/,r=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,t=/\s+/,
    w={},q={};try{var u=location.href}catch(G){u=document.createElement("a"),u.href="",u=u.href}var y=r.exec(u.toLowerCase())||[];d.extend(d.jqx.data,{ajaxSetup:function(b,c){c?e(b,d.jqx.data.ajaxSettings):(c=b,b=d.jqx.data.ajaxSettings);e(b,c);return b},ajaxSettings:{url:u,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(y[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",
            html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":!0,"text json":d.parseJSON,"text xml":d.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:b(w),ajaxTransport:b(q),ajax:function(b,e){function f(b,e,c,f){var g=e;if(2!==S){S=2;C&&clearTimeout(C);A=void 0;u=f||"";v.readyState=0<b?4:0;if(c){var h=D;f=v;var k,q,l=
        h.contents,m=h.dataTypes,p=h.responseFields;for(B in p)B in c&&(f[p[B]]=c[B]);for(;"*"===m[0];)m.shift(),void 0===k&&(k=h.mimeType||f.getResponseHeader("content-type"));if(k)for(B in l)if(l[B]&&l[B].test(k)){m.unshift(B);break}if(m[0]in c)var y=m[0];else{for(B in c){if(!m[0]||h.converters[B+" "+m[0]]){y=B;break}q||(q=B)}y=y||q}y?(y!==m[0]&&m.unshift(y),h=c[y]):h=void 0}if(200<=b&&300>b||304===b)if(D.ifModified&&((c=v.getResponseHeader("Last-Modified"))&&(d.lastModified[aa]=c),(c=v.getResponseHeader("Etag"))&&
    (d.etag[aa]=c)),304===b){g="notmodified";var r=!0}else{a:{var t=D;var w=h;var z;g=t.dataTypes.slice();k=g[0];var B={};y=0;t.dataFilter&&(w=t.dataFilter(w,t.dataType));if(g[1])for(V in t.converters)B[V.toLowerCase()]=t.converters[V];for(;c=g[++y];)if("*"!==c){if("*"!==k&&k!==c){var V=B[k+" "+c]||B["* "+c];if(!V)for(z in B)if(r=z.split(" "),r[1]===c&&(V=B[k+" "+r[0]]||B["* "+r[0]])){!0===V?V=B[z]:!0!==B[z]&&(c=r[0],g.splice(y--,0,c));break}if(!0!==V)if(V&&t["throws"])w=V(w);else try{w=V(w)}catch(Ha){r=
        {state:"parsererror",error:V?Ha:"No conversion from "+k+" to "+c};break a}}k=c}r={state:"success",data:w}}g=r.state;t=r.data;w=r.error;r=!w}else if(w=g,!g||b)g="error",0>b&&(b=0);v.status=b;v.statusText=(e||g)+"";r?H.resolveWith(G,[t,g,v]):H.rejectWith(G,[v,g,w]);v.statusCode(P);P=void 0;X&&K.trigger("ajax"+(r?"Success":"Error"),[v,D,r?t:w]);I.fireWith(G,[v,g]);X&&(K.trigger("ajaxComplete",[v,D]),--d.active||d.event.trigger("ajaxStop"))}}"object"===typeof b&&(e=b,b=void 0);e=e||{};var u,z,A,C,B,D=
        d.jqx.data.ajaxSetup({},e),G=D.context||D,K=G!==D&&(G.nodeType||G instanceof d)?d(G):d.event,H=d.Deferred(),I=d.Callbacks("once memory"),P=D.statusCode||{},Z={},ba={},S=0,da="canceled",v={readyState:0,setRequestHeader:function(b,e){if(!S){var c=b.toLowerCase();b=ba[c]=ba[c]||b;Z[b]=e}return this},getAllResponseHeaders:function(){return 2===S?u:null},getResponseHeader:function(b){var e;if(2===S){if(!z)for(z={};e=h.exec(u);)z[e[1].toLowerCase()]=e[2];e=z[b.toLowerCase()]}return void 0===e?null:e},overrideMimeType:function(b){S||
        (D.mimeType=b);return this},abort:function(b){b=b||da;A&&A.abort(b);f(0,b);return this}};H.promise(v);v.success=v.done;v.error=v.fail;v.complete=I.add;v.statusCode=function(b){if(b)if(2>S)for(e in b)P[e]=[P[e],b[e]];else{var e=b[v.status];v.always(e)}return this};D.url=((b||D.url)+"").replace(g,"").replace(l,y[1]+"//");D.dataTypes=d.trim(D.dataType||"*").toLowerCase().split(t);null==D.crossDomain&&(b=r.exec(D.url.toLowerCase()),D.crossDomain=!(!b||b[1]===y[1]&&b[2]===y[2]&&(b[3]||("http:"===b[1]?
        80:443))==(y[3]||("http:"===y[1]?80:443))));D.data&&D.processData&&"string"!==typeof D.data&&(D.data=d.param(D.data,D.traditional));c(w,D,e,v);if(2===S)return v;var X=D.global;D.type=D.type.toUpperCase();D.hasContent=!k.test(D.type);X&&0===d.active++&&d.event.trigger("ajaxStart");if(!D.hasContent){D.data&&(D.url+=(m.test(D.url)?"&":"?")+D.data,delete D.data);var aa=D.url;if(!1===D.cache){b=(new Date).getTime();var Y=D.url.replace(p,"$1_="+b);D.url=Y+(Y===D.url?(m.test(D.url)?"&":"?")+"_="+b:"")}}(D.data&&
        D.hasContent&&!1!==D.contentType||e.contentType)&&v.setRequestHeader("Content-Type",D.contentType);D.ifModified&&(aa=aa||D.url,d.lastModified[aa]&&v.setRequestHeader("If-Modified-Since",d.lastModified[aa]),d.etag[aa]&&v.setRequestHeader("If-None-Match",d.etag[aa]));v.setRequestHeader("Accept",D.dataTypes[0]&&D.accepts[D.dataTypes[0]]?D.accepts[D.dataTypes[0]]+("*"!==D.dataTypes[0]?", */*; q=0.01":""):D.accepts["*"]);for(B in D.headers)v.setRequestHeader(B,D.headers[B]);if(D.beforeSend&&(!1===D.beforeSend.call(G,
        v,D)||2===S))return v.abort();da="abort";for(B in{success:1,error:1,complete:1})v[B](D[B]);if(A=c(q,D,e,v)){v.readyState=1;X&&K.trigger("ajaxSend",[v,D]);D.async&&0<D.timeout&&(C=setTimeout(function(){v.abort("timeout")},D.timeout));try{S=1,A.send(Z,f)}catch(ha){if(2>S)f(-1,ha);else throw ha;}}else f(-1,"No Transport");return v},active:0,lastModified:{},etag:{}});var z=[],A=/\?/,C=/(=)\?(?=&|$)|\?\?/,B=(new Date).getTime();d.jqx.data.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var b=z.pop()||
        d.expando+"_"+B++;this[b]=!0;return b}});d.jqx.data.ajaxPrefilter("json jsonp",function(b,e,c){var f,g=b.data,h=b.url,k=!1!==b.jsonp,q=k&&C.test(h),l=k&&!q&&"string"===typeof g&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&C.test(g);if("jsonp"===b.dataTypes[0]||q||l){var u=b.jsonpCallback=d.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback;var m=window[u];q?b.url=h.replace(C,"$1"+u):l?b.data=g.replace(C,"$1"+u):k&&(b.url+=(A.test(h)?"&":"?")+b.jsonp+"="+u);b.converters["script json"]=
    function(){f||d.error(u+" was not called");return f[0]};b.dataTypes[0]="json";window[u]=function(){f=arguments};c.always(function(){window[u]=m;b[u]&&(b.jsonpCallback=e.jsonpCallback,z.push(u));f&&d.isFunction(m)&&m(f[0]);f=m=void 0});return"script"}});d.jqx.data.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(b){d.globalEval(b);return b}}});d.jqx.data.ajaxPrefilter("script",
    function(b){void 0===b.cache&&(b.cache=!1);b.crossDomain&&(b.type="GET",b.global=!1)});d.jqx.data.ajaxTransport("script",function(b){if(b.crossDomain){var e,c=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(f,d){e=document.createElement("script");e.async="async";b.scriptCharset&&(e.charset=b.scriptCharset);e.src=b.url;e.onload=e.onreadystatechange=function(b,f){if(f||!e.readyState||/loaded|complete/.test(e.readyState))e.onload=e.onreadystatechange=
        null,c&&e.parentNode&&c.removeChild(e),e=void 0,f||d(200,"success")};c.insertBefore(e,c.firstChild)},abort:function(){if(e)e.onload(0,1)}}}});var D,K=window.ActiveXObject?function(){for(var b in D)D[b](0,1)}:!1,I=0;d.jqx.data.ajaxSettings.xhr=window.ActiveXObject?function(){var b;if(!(b=!this.isLocal&&f()))a:{try{b=new window.ActiveXObject("Microsoft.XMLHTTP");break a}catch(H){}b=void 0}return b}:f;(function(b){d.extend(d.support,{ajax:!!b,cors:!!b&&"withCredentials"in b})})(d.jqx.data.ajaxSettings.xhr());
    d.support||(d.support={ajax:!0});d.support.ajax&&d.jqx.data.ajaxTransport(function(b){if(!b.crossDomain||d.support.cors){var e;return{send:function(c,f){var g,h=b.xhr();b.username?h.open(b.type,b.url,b.async,b.username,b.password):h.open(b.type,b.url,b.async);if(b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType);b.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");try{for(g in c)h.setRequestHeader(g,c[g])}catch(M){}h.send(b.hasContent&&
            b.data||null);e=function(c,d){var g;try{if(e&&(d||4===h.readyState))if(e=void 0,k&&(h.onreadystatechange=function(){},K&&delete D[k]),d)4!==h.readyState&&h.abort();else{var q=h.status;var l=h.getAllResponseHeaders();var u={};(g=h.responseXML)&&g.documentElement&&(u.xml=g);try{u.text=h.responseText}catch(Z){}try{var m=h.statusText}catch(Z){m=""}q||!b.isLocal||b.crossDomain?1223===q&&(q=204):q=u.text?200:404}}catch(Z){d||f(-1,Z)}u&&f(q,m,u,l)};if(b.async)if(4===h.readyState)setTimeout(e,0);else{var k=
            ++I;K&&(D||(D={},d(window).unload(K)),D[k]=e);h.onreadystatechange=e}else e()},abort:function(){e&&e(0,1)}}}});d.jqx.filter=function(){this.operator="and";var b="EMPTY NOT_EMPTY CONTAINS CONTAINS_CASE_SENSITIVE DOES_NOT_CONTAIN DOES_NOT_CONTAIN_CASE_SENSITIVE STARTS_WITH STARTS_WITH_CASE_SENSITIVE ENDS_WITH ENDS_WITH_CASE_SENSITIVE EQUAL EQUAL_CASE_SENSITIVE NULL NOT_NULL".split(" "),e="EQUAL NOT_EQUAL LESS_THAN LESS_THAN_OR_EQUAL GREATER_THAN GREATER_THAN_OR_EQUAL NULL NOT_NULL".split(" "),c="EQUAL NOT_EQUAL LESS_THAN LESS_THAN_OR_EQUAL GREATER_THAN GREATER_THAN_OR_EQUAL NULL NOT_NULL".split(" "),
        f=["EQUAL","NOT_EQUAL"],g=[],h=[];this.evaluate=function(b){for(var e=!0,c=0;c<g.length;c++){var f=g[c].evaluate(b);e=0==c?f:1==h[c]||"or"==h[c]?e||f:e&&f}return e};this.getfilterscount=function(){return g.length};this.setoperatorsbyfiltertype=function(d,g){switch(d){case "numericfilter":e=g;break;case "stringfilter":b=g;break;case "datefilter":c=g;break;case "booleanfilter":f=g}};this.getoperatorsbyfiltertype=function(d){var g=[];switch(d){case "numericfilter":g=e.slice(0);break;case "stringfilter":g=
        b.slice(0);break;case "datefilter":g=c.slice(0);break;case "booleanfilter":g=f.slice(0)}return g};var k=function(){var b=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return b()+"-"+b()+"-"+b()};this.createfilter=function(b,e,c,f,d,g){if(null==b||void 0==b)return null;switch(b){case "numericfilter":return new u(e,c.toUpperCase());case "stringfilter":return new q(e,c.toUpperCase());case "datefilter":return new m(e,c.toUpperCase(),d,g);case "booleanfilter":return new l(e,c.toUpperCase());
        case "custom":return new p(e,c.toUpperCase(),f)}throw Error("jqxGrid: There is no such filter type. The available filter types are: 'numericfilter', 'stringfilter', 'datefilter' and 'booleanfilter'");};this.getfilters=function(){for(var b=[],e=0;e<g.length;e++){var c={value:g[e].filtervalue,condition:g[e].comparisonoperator,operator:h[e],type:g[e].type};g[e].data&&(c.id=g[e].data);b[e]=c}return b};this.addfilter=function(b,e){g[g.length]=e;e.key=k();h[h.length]=b};this.removefilter=function(b){for(var e=
        0;e<g.length;e++)if(g[e].key==b.key){g.splice(e,1);h.splice(e,1);break}};this.getoperatorat=function(b){return void 0==b||null==b||0>b||b>g.length?null:h[b]};this.setoperatorat=function(b,e){if(void 0==b||null==b||0>b||b>g.length)return null;h[e]=e};this.getfilterat=function(b){return void 0==b||null==b||0>b||b>g.length?null:g[b]};this.setfilterat=function(b,e){if(void 0==b||null==b||0>b||b>g.length)return null;e.key=k();g[b]=e};this.clear=function(){g=[];h=[]};var q=function(b,e){this.filtervalue=
        b;this.comparisonoperator=e;this.type="stringfilter";this.evaluate=function(b){var e=this.filtervalue,c=this.comparisonoperator;if(null==b||void 0==b||""==b){if("NULL"==c)return!0;if("NOT_NULL"==c)return!1;if("EQUAL"==c&&b==e||"NOT_EQUAL"==c&&b!=e)return!0;if("EMPTY"!=c)return!1;if(""==b)return!0}var f="";try{f=b.toString()}catch(V){return!0}var g=function(b,e){switch(c){case "EQUAL":return d.jqx.string.equalsIgnoreCase(b,e);case "EQUAL_CASE_SENSITIVE":return d.jqx.string.equals(b,e);case "NOT_EQUAL":return!d.jqx.string.equalsIgnoreCase(b,
        e);case "NOT_EQUAL_CASE_SENSITIVE":return!d.jqx.string.equals(b,e);case "CONTAINS":return d.jqx.string.containsIgnoreCase(b,e);case "CONTAINS_CASE_SENSITIVE":return d.jqx.string.contains(b,e);case "DOES_NOT_CONTAIN":return!d.jqx.string.containsIgnoreCase(b,e);case "DOES_NOT_CONTAIN_CASE_SENSITIVE":return!d.jqx.string.contains(b,e);case "EMPTY":return""==b;case "NOT_EMPTY":return""!=b;case "NOT_NULL":return null!=b;case "STARTS_WITH":return d.jqx.string.startsWithIgnoreCase(b,e);case "ENDS_WITH":return d.jqx.string.endsWithIgnoreCase(b,
        e);case "ENDS_WITH_CASE_SENSITIVE":return d.jqx.string.endsWith(b,e);case "STARTS_WITH_CASE_SENSITIVE":return d.jqx.string.startsWith(b,e);default:return!1}},h=[];if(e&&e.indexO&&"NOT_EQUAL"!==c&&(0<=e.indexOf("|")||0<=e.indexOf(" AND ")||0<=e.indexOf(" OR ")||0<=e.indexOf(" and ")||0<=e.indexOf(" or "))){if(b=g(f,e))return b;var k=0<=e.indexOf(" AND ")?e.split(" AND "):[];b=0<=e.indexOf(" OR ")?e.split(" OR "):[];var q=0<=e.indexOf(" and ")?e.split(" and "):[],l=0<=e.indexOf(" or ")?e.split(" or "):
        [],u=0<=e.indexOf("|")?e.split("|"):[];if(0<u.length)for(var m=0;m<u.length;m++)u[m]=d.trim(u[m]);e=0<=e.indexOf(" ")?e.split(" "):[];if(0<e.length)for(m=0;m<e.length;m++)e[m]=d.trim(e[m]);k=k.concat(e);k=k.concat(q);b=b.concat(u);b=b.concat(l);if(0<k.length)for(m=0;m<k.length;m++)0<=!k[m].indexOf(" OR ")&&h.push(k[m]);if(0<b.length)for(m=0;m<b.length;m++)0<=!b[m].indexOf(" AND ")&&h.push(b[m]);e=void 0;for(q=0;q<h.length;q++)b=h[q],b=g(f,b),l=q<k.length?"and":"or",e=void 0==e?b:"or"==l?e||b:e&&b;
        return e}return g(f,e)}},l=function(b,e){this.filtervalue=b;this.comparisonoperator=e;this.type="booleanfilter";this.evaluate=function(b){var e=this.filtervalue,c=this.comparisonoperator;if(null==b||void 0==b)return"NULL"==c?!0:!1;switch(c){case "EQUAL":return b==e||b.toString()==e.toString();case "NOT_EQUAL":return b!=e&&b.toString()!=e.toString();default:return!1}}},u=function(b,e){this.filtervalue=b;this.comparisonoperator=e;this.type="numericfilter";this.evaluate=function(b){var e=this.filtervalue,
        c=this.comparisonoperator;if(null===b||void 0===b||""===b){if("NOT_NULL"==c)return!1;if("NULL"==c)return!0;switch(c){case "EQUAL":return b==e;case "NOT_EQUAL":return b!=e}return!1}if("NULL"==c)return!1;if("NOT_NULL"==c)return!0;var f=b;try{f=parseFloat(f)}catch(ka){if(""!=b.toString())return!1}var g=function(b,e){switch(c){case "EQUAL":return b==e;case "NOT_EQUAL":return b!=e;case "GREATER_THAN":return b>e;case "GREATER_THAN_OR_EQUAL":return b>=e;case "LESS_THAN":return b<e;case "LESS_THAN_OR_EQUAL":return b<=
        e;case "STARTS_WITH":return d.jqx.string.startsWithIgnoreCase(b.toString(),e.toString());case "ENDS_WITH":return d.jqx.string.endsWithIgnoreCase(b.toString(),e.toString());case "ENDS_WITH_CASE_SENSITIVE":return d.jqx.string.endsWith(b.toString(),e.toString());case "STARTS_WITH_CASE_SENSITIVE":return d.jqx.string.startsWith(b.toString(),e.toString());case "CONTAINS":return d.jqx.string.containsIgnoreCase(b.toString(),e.toString());case "CONTAINS_CASE_SENSITIVE":return d.jqx.string.contains(b.toString(),
        e.toString());case "DOES_NOT_CONTAIN":return!d.jqx.string.containsIgnoreCase(b.toString(),e.toString());case "DOES_NOT_CONTAIN_CASE_SENSITIVE":return!d.jqx.string.contains(b.toString(),e.toString());default:return!0}},h=[];e&&e.indexOf&&(e=e.replace("$",""));if(e.indexOf&&(0<=e.indexOf("|")||0<=e.indexOf(" AND ")||0<=e.indexOf(" OR ")||0<=e.indexOf(" and ")||0<=e.indexOf(" or "))){var k=g(f,e);if(k)return k;e=e.toString();var q=0<=e.indexOf(" AND ")?e.split(" AND "):[],l=0<=e.indexOf(" OR ")?e.split(" OR "):
        [];b=0<=e.indexOf(" and ")?e.split(" and "):[];var u=0<=e.indexOf(" or ")?e.split(" or "):[];q=q.concat(b);l=l.concat(u);e=0<=e.indexOf("|")?e.split("|"):[];if(0<e.length)for(b=0;b<e.length;b++)e[b]=d.trim(e[b]);l=l.concat(e);if(0<q.length)for(b=0;b<q.length;b++)0<=!q[b].indexOf(" OR ")&&h.push(q[b]);if(0<l.length)for(b=0;b<l.length;b++)0<=!l[b].indexOf(" AND ")&&h.push(l[b]);l=void 0;for(e=0;e<h.length;e++)(b=h[e])&&b.indexOf&&0<=b.indexOf("..")?(b=b.toString().split(".."),2==b.length&&(k=f>=b[0]&&
        f<=b[1])):k=g(f,b),b=e<q.length?"and":"or",l=void 0==l?k:"or"==b?l||k:l&&k;return l}return e&&e.indexOf&&0<=e.indexOf("..")&&(h=e.toString().split(".."),2==h.length)?f>=h[0]&&f<=h[1]:g(f,e)}},m=function(b,e,c,f){this.filtervalue=b;this.type="datefilter";var g=this;if(void 0!=c&&void 0!=f){var h=d.jqx.dataFormat.parsedate(b,c,f);null!=h?this.filterdate=h:(h=d.jqx.dataFormat.tryparsedate(b,f),null!=h&&(this.filterdate=h))}else h=new Date(b),this.filterdate="NaN"==h.toString()||"Invalid Date"==h.toString()?
        d.jqx.dataFormat.tryparsedate(b):h;this.filterdate||(h=new Date(b),this.filterdate="NaN"==h.toString()||"Invalid Date"==h.toString()?d.jqx.dataFormat.tryparsedate(b):h);this.comparisonoperator=e;this.evaluate=function(b){var e=this.filtervalue,h=this.comparisonoperator;if(null==b||void 0==b||""==b){if("NOT_NULL"==h)return!1;if("NULL"==h)return!0;switch(h){case "EQUAL":return b==e;case "NOT_EQUAL":return b!=e}return!1}if("NULL"==h)return!1;if("NOT_NULL"==h)return!0;var k=new Date;k.setFullYear(1900,
        0,1);k.setHours(12,0,0,0);try{var q=new Date(b);k=b="NaN"==q.toString()||"Invalid Date"==q.toString()?d.jqx.dataFormat.tryparsedate(b):q;var l=!1;if(void 0!=c&&void 0!=f&&(0<=c.indexOf("t")||0<=c.indexOf("T")||0<=c.indexOf(":")||0<=c.indexOf("f"))&&(l=!0,e&&-1==e.toString().indexOf(":"))){var u=d.jqx.dataFormat.tryparsedate(e.toString()+":00",f);null!=u&&(g.filterdate=u)}void 0!=c&&(0<=c.indexOf("hh")||0<=c.indexOf("t"))&&(l=!0);l||(k.setHours(0),k.setMinutes(0),k.setSeconds(0))}catch(Ba){if(""!=
        b.toString())return!1}if(null!=g.filterdate)e=g.filterdate;else if(e&&e.indexOf&&(-1!=e.indexOf(":")||!isNaN(parseInt(e)))){u=new Date(k);u.setHours(12,0,0,0);q=e.split(":");for(e=0;e<q.length;e++)0==e&&u.setHours(q[e]),1==e&&u.setMinutes(q[e]),2==e&&u.setSeconds(q[e]);e=u}l&&e&&e.setFullYear&&k&&k.getFullYear&&-1==c.indexOf("d")&&-1==c.indexOf("M")&&-1==c.indexOf("y")&&e.setFullYear(k.getFullYear(),k.getMonth(),k.getDate());l=function(b,e){null==b&&(b="");switch(h){case "EQUAL":return b.toString()==
        e.toString();case "NOT_EQUAL":return b.toString()!=e.toString();case "GREATER_THAN":return b>e;case "GREATER_THAN_OR_EQUAL":return b>=e;case "LESS_THAN":return b<e;case "LESS_THAN_OR_EQUAL":return b<=e;case "STARTS_WITH":return d.jqx.string.startsWithIgnoreCase(b.toString(),e.toString());case "ENDS_WITH":return d.jqx.string.endsWithIgnoreCase(b.toString(),e.toString());case "ENDS_WITH_CASE_SENSITIVE":return d.jqx.string.endsWith(b.toString(),e.toString());case "STARTS_WITH_CASE_SENSITIVE":return d.jqx.string.startsWith(b.toString(),
        e.toString());case "CONTAINS":return d.jqx.string.containsIgnoreCase(b.toString(),e.toString());case "CONTAINS_CASE_SENSITIVE":return d.jqx.string.contains(b.toString(),e.toString());case "DOES_NOT_CONTAIN":return!d.jqx.string.containsIgnoreCase(b.toString(),e.toString());case "DOES_NOT_CONTAIN_CASE_SENSITIVE":return!d.jqx.string.contains(b.toString(),e.toString());default:return!0}};q=[];if(e&&e.indexOf&&(0<=e.indexOf("|")||0<=e.indexOf(" AND ")||0<=e.indexOf(" OR ")||0<=e.indexOf(" and ")||0<=e.indexOf(" or "))){if(u=
        l(k,e))return u;var m=0<=e.indexOf(" AND ")?e.split(" AND "):[];b=0<=e.indexOf(" OR ")?e.split(" OR "):[];var p=0<=e.indexOf(" and ")?e.split(" and "):[],y=0<=e.indexOf(" or ")?e.split(" or "):[];m=m.concat(p);b=b.concat(y);p=0<=e.indexOf("|")?e.split("|"):[];if(0<p.length)for(e=0;e<p.length;e++)p[e]=d.trim(p[e]);b=b.concat(p);if(0<m.length)for(e=0;e<m.length;e++)0<=!m[e].indexOf(" OR ")&&q.push(m[e]);if(0<b.length)for(e=0;e<b.length;e++)0<=!b[e].indexOf(" AND ")&&q.push(b[e]);e=void 0;for(p=0;p<
    q.length;p++)(b=q[p])&&b.indexOf&&0<=b.indexOf("..")?(b=b.toString().split(".."),2==b.length&&(u=k>=b[0]&&k<=b[1])):u=l(k,b),b=p<m.length?"and":"or",e=void 0==e?u:"or"==b?e||u:e&&u;return e}return e&&e.indexOf&&0<=e.indexOf("..")&&(q=e.toString().split(".."),2==q.length)?k>=q[0]&&k<=q[1]:l(k,e)}},p=function(b,e,c){this.filtervalue=b;this.comparisonoperator=e;this.evaluate=function(b,e){return c(this.filtervalue,b,this.comparisonoperator)}}}})(jqxBaseFramework);
(function(d){d.jqx.cssroundedcorners=function(b){var c={all:"jqx-rc-all",top:"jqx-rc-t",bottom:"jqx-rc-b",left:"jqx-rc-l",right:"jqx-rc-r","top-right":"jqx-rc-tr","top-left":"jqx-rc-tl","bottom-right":"jqx-rc-br","bottom-left":"jqx-rc-bl"},e;for(e in c)if(c.hasOwnProperty(e)&&b==e)return c[e]};d.jqx.jqxWidget("jqxButton","",{});d.extend(d.jqx._jqxButton.prototype,{defineInstance:function(){var b={type:"",cursor:"arrow",roundedCorners:"all",disabled:!1,height:null,width:null,overrideTheme:!1,enableHover:!0,
        enableDefault:!0,enablePressed:!0,imgPosition:"center",imgSrc:"",imgWidth:16,imgHeight:16,value:null,textPosition:"",textImageRelation:"overlay",rtl:!1,_ariaDisabled:!1,_scrollAreaButton:!1,template:"default",aria:{"aria-disabled":{name:"disabled",type:"boolean"}}};if(this===d.jqx._jqxButton.prototype)return b;d.extend(!0,this,b);return b},_addImage:function(b){if("input"==this.element.nodeName.toLowerCase()||"button"==this.element.nodeName.toLowerCase()||"div"==this.element.nodeName.toLowerCase()){if(this._img)this._img.setAttribute("src",
        this.imgSrc),this._img.setAttribute("width",this.imgWidth),this._img.setAttribute("height",this.imgHeight),this._text.innerHTML=this.value;else{this.field=this.element;this.field.className&&(this._className=this.field.className);var c=this.field.title,e=null;this.field.getAttribute("value")?e=this.field.getAttribute("value"):"input"!=this.element.nodeName.toLowerCase()&&(e=this.element.innerHTML);this.value&&(e=this.value);b=this.field.id.length?this.field.id.replace(/[^\w]/g,"_")+"_"+b:d.jqx.utilities.createId()+
        "_"+b;var f=document.createElement("div");f.id=b;f.title=c;f.style.cssText=this.field.style.cssText;f.style.boxSizing="border-box";c=document.createElement("img");c.setAttribute("src",this.imgSrc);c.setAttribute("width",this.imgWidth);c.setAttribute("height",this.imgHeight);f.appendChild(c);this._img=c;c=document.createElement("span");e&&(this.value=c.innerHTML=e);f.appendChild(c);this._text=c;this.field.style.display="none";this.field.parentNode&&this.field.parentNode.insertBefore(f,this.field.nextSibling);
        e=this.host.data();this.host=d(f);this.host.data(e);this.element=f;this.element.id=this.field.id;this.field.id=b;b=new d(this.element);e=new d(this.field);this._className&&(b.addClass(this._className),e.removeClass(this._className));this.field.tabIndex&&(b=this.field.tabIndex,this.field.tabIndex=-1,this.element.tabIndex=b)}this._img.style.display=this.imgSrc?"inline":"none";this._text.style.display=this.value?"inline":"none";this._positionTextAndImage()}},_positionTextAndImage:function(){var b=this.element.offsetWidth,
        c=this.element.offsetHeight,e=this.imgWidth,f=this.imgHeight;""==this.imgSrc&&(f=e=0);var d=this._text.offsetWidth,h=this._text.offsetHeight,k=0,l=0;switch(this.textImageRelation){case "imageBeforeText":case "textBeforeImage":k=e+d+8+4+8;l=Math.max(f,h)+8+4+8;break;case "imageAboveText":case "textAboveImage":k=Math.max(e,d)+8;l=f+h+4+8+8;break;case "overlay":k=Math.max(e,d)+8,l=Math.max(f,h)+8}this.width||(this.element.style.width=k+"px",b=k);this.height||(this.element.style.height=l+"px",c=l);this._img.style.position=
        "absolute";this._text.style.position="absolute";this.element.style.position="relative";this.element.style.overflow="hidden";k={};l={};var m=function(b,e,c,f,d){e.width<f&&(e.width=f);e.height<d&&(e.height=d);switch(c){case "left":b.style.left=e.left+"px";b.style.top=e.top+e.height/2-d/2+"px";break;case "topLeft":b.style.left=e.left+"px";b.style.top=e.top+"px";break;case "bottomLeft":b.style.left=e.left+"px";b.style.top=e.top+e.height-d+"px";break;default:case "center":b.style.left=e.left+e.width/
        2-f/2+"px";b.style.top=e.top+e.height/2-d/2+"px";break;case "top":b.style.left=e.left+e.width/2-f/2+"px";b.style.top=e.top+"px";break;case "bottom":b.style.left=e.left+e.width/2-f/2+"px";b.style.top=e.top+e.height-d+"px";break;case "right":b.style.left=e.left+e.width-f+"px";b.style.top=e.top+e.height/2-d/2+"px";break;case "topRight":b.style.left=e.left+e.width-f+"px";b.style.top=e.top+"px";break;case "bottomRight":b.style.left=e.left+e.width-f+"px",b.style.top=e.top+e.height-d+"px"}},p=0,r=0,t=(b-
        p)/2,w=(c-r)/2,q=this._img,u=this._text,y=c-r,z=b-p;p+=4;r+=4;b=b-4-2;z=z-8-2;y=y-8-2;switch(this.textImageRelation){case "imageBeforeText":switch(this.imgPosition){case "left":case "topLeft":case "bottomLeft":l={left:p,top:r,width:p+e,height:y};k={left:p+e+4,top:r,width:z-e-4,height:y};break;case "center":case "top":case "bottom":l={left:t-d/2-e/2-2,top:r,width:e,height:y};k={left:l.left+e+4,top:r,width:b-l.left-e-4,height:y};break;case "right":case "topRight":case "bottomRight":l={left:b-d-e-4,
        top:r,width:e,height:y},k={left:l.left+e+4,top:r,width:b-l.left-e-4,height:y}}m(q,l,this.imgPosition,e,f);m(u,k,this.textPosition,d,h);break;case "textBeforeImage":switch(this.textPosition){case "left":case "topLeft":case "bottomLeft":k={left:p,top:r,width:p+d,height:y};l={left:p+d+4,top:r,width:z-d-4,height:y};break;case "center":case "top":case "bottom":k={left:t-d/2-e/2-2,top:r,width:d,height:y};l={left:k.left+d+4,top:r,width:b-k.left-d-4,height:y};break;case "right":case "topRight":case "bottomRight":k=
        {left:b-d-e-4,top:r,width:d,height:y},l={left:k.left+d+4,top:r,width:b-k.left-d-4,height:y}}m(q,l,this.imgPosition,e,f);m(u,k,this.textPosition,d,h);break;case "imageAboveText":switch(this.imgPosition){case "topRight":case "top":case "topLeft":l={left:p,top:r,width:z,height:f};k={left:p,top:r+f+4,width:z,height:y-f-4};break;case "left":case "center":case "right":l={left:p,top:w-f/2-h/2-2,width:z,height:f};k={left:p,top:l.top+4+f,width:z,height:y-l.top-4-f};break;case "bottomLeft":case "bottom":case "bottomRight":l=
        {left:p,top:c-f-h-4,width:z,height:f},k={left:p,top:l.top+4+f,width:z,height:h}}m(q,l,this.imgPosition,e,f);m(u,k,this.textPosition,d,h);break;case "textAboveImage":switch(this.textPosition){case "topRight":case "top":case "topLeft":k={left:p,top:r,width:z,height:h};l={left:p,top:r+h+4,width:z,height:y-h-4};break;case "left":case "center":case "right":k={left:p,top:w-f/2-h/2-2,width:z,height:h};l={left:p,top:k.top+4+h,width:z,height:y-k.top-4-h};break;case "bottomLeft":case "bottom":case "bottomRight":k=
        {left:p,top:c-f-h-4,width:z,height:h},l={left:p,top:k.top+4+h,width:z,height:f}}m(q,l,this.imgPosition,e,f);m(u,k,this.textPosition,d,h);break;default:k={left:p,top:r,width:z,height:y},l={left:p,top:r,width:z,height:y},m(q,l,this.imgPosition,e,f),m(u,k,this.textPosition,d,h)}},createInstance:function(b){var c=this;c._setSize();c.isMaterialized();c.buttonObj=new d(c.element);if(""!=c.imgSrc||""!=c.textPosition||c.element.value&&0<=c.element.value.indexOf("<")||null!=c.value)c.refresh(),c._addImage("jqxButton"),
        c.buttonObj=new d(c.element);c._ariaDisabled||c.element.setAttribute("role","button");""!==c.type&&c.element.setAttribute("type",c.type);c.overrideTheme||(c.buttonObj.addClass(c.toThemeProperty(d.jqx.cssroundedcorners(c.roundedCorners))),c.enableDefault&&c.buttonObj.addClass(c.toThemeProperty("jqx-button")),c.buttonObj.addClass(c.toThemeProperty("jqx-widget")));c.isTouchDevice=d.jqx.mobile.isTouchDevice();c._ariaDisabled||d.jqx.aria(this);"arrow"!=c.cursor&&(c.element.style.cursor=c.disabled?"arrow":
        c.cursor);b="mouseenter mouseleave mousedown focus blur";c._scrollAreaButton&&(b="mousedown");c.isTouchDevice&&(c.addHandler(c.host,d.jqx.mobile.getTouchEventName("touchstart"),function(b){c.isPressed=!0;c.refresh()}),c.addHandler(d(document),d.jqx.mobile.getTouchEventName("touchend")+"."+c.element.id,function(b){c.isPressed=!1;c.refresh()}));c.addHandler(c.host,b,function(b){switch(b.type){case "mouseenter":c.isTouchDevice||c.disabled||!c.enableHover||(c.isMouseOver=!0,c.refresh());break;case "mouseleave":c.isTouchDevice||
    c.disabled||!c.enableHover||(c.isMouseOver=!1,c.refresh());break;case "mousedown":c.disabled||(c.isPressed=!0,c.refresh());break;case "focus":c.disabled||(c.isFocused=!0,c.refresh());break;case "blur":c.disabled||(c.isFocused=!1,c.refresh())}});c.mouseupfunc=function(b){c.disabled||!c.isPressed&&!c.isMouseOver||(c.isPressed=!1,c.refresh())};c.addHandler(document,"mouseup.button"+c.element.id,c.mouseupfunc);try{""==document.referrer&&!window.frameElement||null==window.top||window.top==window.that||
    (b="",window.parent&&document.referrer&&(b=document.referrer),-1!=b.indexOf(document.location.host)&&window.top.document&&window.top.document.addEventListener("mouseup",c._topDocumentMouseupHandler))}catch(e){}c.propertyChangeMap.roundedCorners=function(b,c,g,h){b.buttonObj.removeClass(b.toThemeProperty(d.jqx.cssroundedcorners(g)));b.buttonObj.addClass(b.toThemeProperty(d.jqx.cssroundedcorners(h)))};c.propertyChangeMap.disabled=function(b,c,g,h){g!=h&&(b.refresh(),b.element.setAttribute("disabled",
        h),b.element.disabled=h,b.element.style.cursor=h?"default":b.cursor,d.jqx.aria(b,"aria-disabled",b.disabled))};c.propertyChangeMap.rtl=function(b,c,d,h){d!=h&&b.refresh()};c.propertyChangeMap.template=function(b,c,d,h){d!=h&&(b.buttonObj.removeClass(b.toThemeProperty("jqx-"+d)),b.refresh())};c.propertyChangeMap.theme=function(b,c,g,h){b.buttonObj.removeClass(b.element);g&&(b.buttonObj.removeClass("jqx-button-"+g),b.buttonObj.removeClass("jqx-widget-"+g),b.buttonObj.removeClass("jqx-fill-state-normal-"+
        g),b.buttonObj.removeClass(b.toThemeProperty(d.jqx.cssroundedcorners(b.roundedCorners))+"-"+g));b.enableDefault&&b.buttonObj.addClass(b.toThemeProperty("jqx-button"));b.buttonObj.addClass(b.toThemeProperty("jqx-widget"));b.overrideTheme||b.buttonObj.addClass(b.toThemeProperty(d.jqx.cssroundedcorners(b.roundedCorners)));b._oldCSSCurrent=null;b.refresh()};c.disabled&&(c.element.disabled=!0,c.element.setAttribute("disabled","true"))},resize:function(b,c){this.width=b;this.height=c;this._setSize()},val:function(b){var c=
        this.host.find("input");if(0<c.length){if(0==arguments.length||"object"==typeof b)return c.val();c.val(b);this.refresh();return c.val()}if(0==arguments.length||"object"==typeof b)return"button"==this.element.nodeName.toLowerCase()?d(this.element).text():this.element.value;0<arguments.length&&this._text?this._text.innerHTML=arguments[0]:(0<arguments.length&&"DIV"===this.element.nodeName&&(this.element.innerHTML=arguments[0],this.refresh()),this.element.value=arguments[0],"button"==this.element.nodeName.toLowerCase()&&
    d(this.element).html(arguments[0]));this.refresh()},_setSize:function(){var b=this.height,c=this.width;b&&(isNaN(b)||(b+="px"),this.element.style.height=b);c&&(isNaN(c)||(c+="px"),this.element.style.width=c)},_removeHandlers:function(){this.removeHandler(this.host,"selectstart");this.removeHandler(this.host,"click");this.removeHandler(this.host,"focus");this.removeHandler(this.host,"blur");this.removeHandler(this.host,"mouseenter");this.removeHandler(this.host,"mouseleave");this.removeHandler(this.host,
        "mousedown");this.removeHandler(d(document),"mouseup.button"+this.element.id,this.mouseupfunc);this.isTouchDevice&&(this.removeHandler(this.host,d.jqx.mobile.getTouchEventName("touchstart")),this.removeHandler(d(document),d.jqx.mobile.getTouchEventName("touchend")+"."+this.element.id));this.mouseupfunc=null;delete this.mouseupfunc},focus:function(){this.host.focus()},destroy:function(){this._removeHandlers();var b=d.data(this.element,"jqxButton");b&&delete b.instance;this.host.removeClass();this.host.removeData();
        this.host.remove();delete this.set;delete this.get;delete this.call;delete this.element;delete this.host},render:function(){this.refresh()},propertiesChangedHandler:function(b,c,e){e&&e.width&&e.height&&2==Object.keys(e).length&&(b._setSize(),b.refresh())},propertyChangedHandler:function(b,c,e,f){if(void 0!=this.isInitialized&&0!=this.isInitialized&&f!=e&&!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length)){"type"===c&&b.element.setAttribute("type",f);
        if("textImageRelation"==c||"textPosition"==c||"imgPosition"==c)b._img?b._positionTextAndImage():b._addImage("jqxButton");"imgSrc"!=c&&"imgWidth"!=c&&"imgHeight"!=c||b._addImage("jqxButton");"value"===c&&b.val(f);if("width"==c||"height"==c)b._setSize(),b.refresh()}},refresh:function(){if(!this.overrideTheme){var b=this.toThemeProperty("jqx-fill-state-focus"),c=this.toThemeProperty("jqx-fill-state-disabled"),e=this.toThemeProperty("jqx-fill-state-normal");this.enableDefault||(e="");var f=this.toThemeProperty("jqx-fill-state-hover"),
        d=this.toThemeProperty("jqx-fill-state-pressed"),h=this.toThemeProperty("jqx-fill-state-pressed");this.enablePressed||(d="");this.host&&((this.element.disabled=this.disabled)?(this._oldCSSCurrent&&this.buttonObj.removeClass(this._oldCSSCurrent),c=e+" "+c,"default"!==this.template&&""!==this.template&&(c+=" jqx-"+this.template,""!=this.theme&&(c+=" jqx-"+this.template+"-"+this.theme)),this.buttonObj.addClass(c),this._oldCSSCurrent=c):(c=this.isMouseOver&&!this.isTouchDevice?this.isPressed?h:f:this.isPressed?
        d:e,this.isFocused&&(c+=" "+b),"default"!==this.template&&""!==this.template&&(c+=" jqx-"+this.template,""!=this.theme&&(c+=" jqx-"+this.template+"-"+this.theme)),c!=this._oldCSSCurrent&&(this._oldCSSCurrent&&this.buttonObj.removeClass(this._oldCSSCurrent),this.buttonObj.addClass(c),this._oldCSSCurrent=c),this.rtl&&(this.buttonObj.addClass(this.toThemeProperty("jqx-rtl")),this.element.style.direction="rtl"),this.isMaterialized()&&this.host.addClass("buttonRipple")))}}});d.jqx.jqxWidget("jqxLinkButton",
    "",{});d.extend(d.jqx._jqxLinkButton.prototype,{defineInstance:function(){this.disabled=!1;this.width=this.height=null;this.rtl=!1;this.href=null},createInstance:function(b){var c=this;this.host.onselectstart=function(){return!1};this.host.attr("role","button");var e=this.height||this.element.offsetHeight,f=this.width||this.element.offsetWidth;this.href=this.element.getAttribute("href");this.target=this.element.getAttribute("target");this.content=this.host.text();this.element.innerHTML="";var g=document.createElement("input");
        g.type="button";g.className="jqx-wrapper "+this.toThemeProperty("jqx-reset");this._setSize(g,f,e);g.value=this.content;(new d(this.element)).addClass(this.toThemeProperty("jqx-link"));this.element.style.color="inherit";this.element.appendChild(g);this._setSize(g,f,e);b=void 0==b?{}:b[0]||{};d(g).jqxButton(b);this.wrapElement=g;this.disabled&&(this.element.disabled=!0);this.propertyChangeMap.disabled=function(b,e,c,f){b.element.disabled=f;b.wrapElement.jqxButton({disabled:f})};this.addHandler(d(g),
            "click",function(b){if(!this.disabled)c.onclick(b);return!1})},_setSize:function(b,c,e){e&&(isNaN(e)||(e+="px"),b.style.height=e);c&&(isNaN(c)||(c+="px"),b.style.width=c)},onclick:function(b){null!=this.target?window.open(this.href,this.target):window.location=this.href}});d.jqx.jqxWidget("jqxRepeatButton","jqxButton",{});d.extend(d.jqx._jqxRepeatButton.prototype,{defineInstance:function(){this.delay=50},createInstance:function(b){var c=this,e=d.jqx.mobile.isTouchDevice();b=e?"touchend."+this.base.element.id:
        "mouseup."+this.base.element.id;var f=e?"touchstart."+this.base.element.id:"mousedown."+this.base.element.id;this.addHandler(d(document),b,function(b){null!=c.timeout&&(clearTimeout(c.timeout),c.timeout=null,c.refresh());void 0!=c.timer&&(clearInterval(c.timer),c.timer=null,c.refresh())});this.addHandler(this.base.host,f,function(b){null!=c.timer&&clearInterval(c.timer);c.timeout=setTimeout(function(){clearInterval(c.timer);c.timer=setInterval(function(b){c.ontimer(b)},c.delay)},150)});this.mousemovefunc=
        function(b){e||0!=b.which||null==c.timer||(clearInterval(c.timer),c.timer=null)};this.addHandler(this.base.host,"mousemove",this.mousemovefunc)},destroy:function(){var b=d.jqx.mobile.isTouchDevice(),c=b?"touchend."+this.base.element.id:"mouseup."+this.base.element.id;b=b?"touchstart."+this.base.element.id:"mousedown."+this.base.element.id;this.removeHandler(this.base.host,"mousemove",this.mousemovefunc);this.removeHandler(this.base.host,b);this.removeHandler(d(document),c);this.timer=null;delete this.mousemovefunc;
        delete this.timer;(c=d.data(this.base.element,"jqxRepeatButton"))&&delete c.instance;d(this.base.element).removeData();this.base.destroy();delete this.base},stop:function(){clearInterval(this.timer);this.timer=null},ontimer:function(b){b=new d.Event("click");null!=this.base&&null!=this.base.host&&this.base.host.trigger(b)}});d.jqx.jqxWidget("jqxToggleButton","jqxButton",{});d.extend(d.jqx._jqxToggleButton.prototype,{defineInstance:function(){this.toggled=!1;this.uiToggle=!0;this.aria={"aria-checked":{name:"toggled",
            type:"boolean"},"aria-disabled":{name:"disabled",type:"boolean"}}},createInstance:function(b){var c=this;c.base.overrideTheme=!0;c.isTouchDevice=d.jqx.mobile.isTouchDevice();d.jqx.aria(this);c.propertyChangeMap.roundedCorners=function(b,c,g,h){b.base.buttonObj.removeClass(b.toThemeProperty(d.jqx.cssroundedcorners(g)));b.base.buttonObj.addClass(b.toThemeProperty(d.jqx.cssroundedcorners(h)))};c.propertyChangeMap.toggled=function(b,c,d,h){b.refresh()};c.propertyChangeMap.disabled=function(b,c,d,h){b.base.disabled=
        h;b.refresh()};c.addHandler(c.base.host,"click",function(b){!c.base.disabled&&c.uiToggle&&c.toggle()});c.isTouchDevice||(c.addHandler(c.base.host,"mouseenter",function(b){c.base.disabled||c.refresh()}),c.addHandler(c.base.host,"mouseleave",function(b){c.base.disabled||c.refresh()}));c.addHandler(c.base.host,"mousedown",function(b){c.base.disabled||c.refresh()});c.addHandler(d(document),"mouseup.togglebutton"+c.base.element.id,function(b){c.base.disabled||c.refresh()})},destroy:function(){this._removeHandlers();
        this.base.destroy()},_removeHandlers:function(){this.removeHandler(this.base.host,"click");this.removeHandler(this.base.host,"mouseenter");this.removeHandler(this.base.host,"mouseleave");this.removeHandler(this.base.host,"mousedown");this.removeHandler(d(document),"mouseup.togglebutton"+this.base.element.id)},toggle:function(){this.toggled=!this.toggled;this.refresh();d.jqx.aria(this,"aria-checked",this.toggled)},unCheck:function(){this.toggled=!1;this.refresh()},check:function(){this.toggled=!0;
        this.refresh()},refresh:function(){var b=this.base.toThemeProperty("jqx-fill-state-disabled"),c=this.base.toThemeProperty("jqx-fill-state-normal");this.base.enableDefault||(c="");var e=this.base.toThemeProperty("jqx-fill-state-hover"),f=this.base.toThemeProperty("jqx-fill-state-pressed"),d=this.base.toThemeProperty("jqx-fill-state-pressed");if(this.base.element.disabled=this.base.disabled)this.base.buttonObj.addClass(c+" "+b);else{var h=this.base.isMouseOver&&!this.isTouchDevice?this.base.isPressed||
    this.toggled?d:e:this.base.isPressed||this.toggled?f:c;"default"!==this.base.template&&""!==this.base.template&&(h+=" jqx-"+this.base.template,""!=this.base.theme&&(h+=" jqx-"+this.template+"-"+this.base.theme));this.base.buttonObj.hasClass(b)&&b!=h&&this.base.buttonObj.removeClass(b);this.base.buttonObj.hasClass(c)&&c!=h&&this.base.buttonObj.removeClass(c);this.base.buttonObj.hasClass(e)&&e!=h&&this.base.buttonObj.removeClass(e);this.base.buttonObj.hasClass(f)&&f!=h&&this.base.buttonObj.removeClass(f);
        this.base.buttonObj.hasClass(d)&&d!=h&&this.base.buttonObj.removeClass(d);this.base.buttonObj.hasClass(h)||this.base.buttonObj.addClass(h)}},_topDocumentMouseupHandler:function(b){this.isPressed=!1;this.refresh()}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxScrollBar","",{});d.extend(d.jqx._jqxScrollBar.prototype,{defineInstance:function(){var b={height:null,width:null,vertical:!1,min:0,max:1E3,value:0,step:10,largestep:50,thumbMinSize:10,thumbSize:0,thumbStep:"auto",roundedCorners:"all",showButtons:!0,disabled:!1,touchMode:"auto",touchModeStyle:"auto",thumbTouchSize:0,_triggervaluechanged:!0,rtl:!1,areaDownCapture:!1,areaUpCapture:!1,_initialLayout:!1,offset:0,reference:0,velocity:0,frame:0,timestamp:0,ticker:null,amplitude:0,
        target:0};if(this===d.jqx._jqxScrollBar.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(b){this.render()},render:function(){this._mouseup=new Date;var b=this;d.jqx.utilities&&"hidden"==d.jqx.utilities.scrollBarButtonsVisibility&&(this.showButtons=!1);b.WinJS?MSApp.execUnsafeLocalFunction(function(){b.host.html("<div id='jqxScrollOuterWrap' style='box-sizing: content-box; width:100%; height: 100%; align:left; border: 0px; valign:top; position: relative;'><div id='jqxScrollWrap' style='box-sizing: content-box; width:100%; height: 100%; left: 0px; top: 0px; align:left; valign:top; position: absolute;'><div id='jqxScrollBtnUp' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'><div></div></div><div id='jqxScrollAreaUp' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollThumb' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollAreaDown' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollBtnDown' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'><div></div></div></div></div>")}):
        this.element.innerHTML="<div id='jqxScrollOuterWrap' style='box-sizing: content-box; width:100%; height: 100%; align:left; border: 0px; valign:top; position: relative;'><div id='jqxScrollWrap' style='box-sizing: content-box; width:100%; height: 100%; left: 0px; top: 0px; align:left; valign:top; position: absolute;'><div id='jqxScrollBtnUp' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'><div></div></div><div id='jqxScrollAreaUp' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollThumb' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollAreaDown' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollBtnDown' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'><div></div></div></div></div>";
        void 0!=this.width&&0<parseInt(this.width)&&this.host.width(parseInt(this.width));void 0!=this.height&&0<parseInt(this.height)&&this.host.height(parseInt(this.height));this.isPercentage=!1;null!=this.width&&-1!=this.width.toString().indexOf("%")&&(this.host.width(this.width),this.isPercentage=!0);null!=this.height&&-1!=this.height.toString().indexOf("%")&&(this.host.height(this.height),this.isPercentage=!0);if(this.isPercentage){var c=this;d.jqx.utilities.resize(this.host,function(){c._arrange()},
            !1)}this.thumbCapture=!1;this.scrollOuterWrap=d(this.element.firstChild);this.scrollWrap=d(this.scrollOuterWrap[0].firstChild);this.btnUp=d(this.scrollWrap[0].firstChild);this.areaUp=d(this.btnUp[0].nextSibling);this.btnThumb=d(this.areaUp[0].nextSibling);this.arrowUp=d(this.btnUp[0].firstChild);this.areaDown=d(this.btnThumb[0].nextSibling);this.btnDown=d(this.areaDown[0].nextSibling);this.arrowDown=d(this.btnDown[0].firstChild);var e=this.element.id;this.btnUp[0].id="jqxScrollBtnUp"+e;this.btnDown[0].id=
            "jqxScrollBtnDown"+e;this.btnThumb[0].id="jqxScrollThumb"+e;this.areaUp[0].id="jqxScrollAreaUp"+e;this.areaDown[0].id="jqxScrollAreaDown"+e;this.scrollWrap[0].id="jqxScrollWrap"+e;this.scrollOuterWrap[0].id="jqxScrollOuterWrap"+e;if(!this.host.jqxRepeatButton)throw Error("jqxScrollBar: Missing reference to jqxbuttons.js.");this.btnUp.jqxRepeatButton({_ariaDisabled:!0,overrideTheme:!0,disabled:this.disabled});this.btnDown.jqxRepeatButton({_ariaDisabled:!0,overrideTheme:!0,disabled:this.disabled});
        this.btnDownInstance=d.data(this.btnDown[0],"jqxRepeatButton").instance;this.btnUpInstance=d.data(this.btnUp[0],"jqxRepeatButton").instance;this.areaUp.jqxRepeatButton({_scrollAreaButton:!0,_ariaDisabled:!0,overrideTheme:!0});this.areaDown.jqxRepeatButton({_scrollAreaButton:!0,_ariaDisabled:!0,overrideTheme:!0});this.btnThumb.jqxButton({_ariaDisabled:!0,overrideTheme:!0,disabled:this.disabled});this.propertyChangeMap.value=function(b,e,c,d){isNaN(d)||c!=d&&b.setPosition(parseFloat(d),!0)};this.propertyChangeMap.width=
            function(b,e,c,d){void 0!=b.width&&0<parseInt(b.width)&&(b.host.width(parseInt(b.width)),b._arrange())};this.propertyChangeMap.height=function(b,e,c,d){void 0!=b.height&&0<parseInt(b.height)&&(b.host.height(parseInt(b.height)),b._arrange())};this.propertyChangeMap.theme=function(b,e,c,d){b.setTheme()};this.propertyChangeMap.max=function(b,e,c,d){isNaN(d)||c==d||(b.max=parseInt(d),b.min>b.max&&(b.max=b.min+1),b._arrange(),b.setPosition(b.value))};this.propertyChangeMap.min=function(b,e,c,d){isNaN(d)||
        c==d||(b.min=parseInt(d),b.min>b.max&&(b.max=b.min+1),b._arrange(),b.setPosition(b.value))};this.propertyChangeMap.disabled=function(b,e,c,d){c!=d&&(d?b.host.addClass(b.toThemeProperty("jqx-fill-state-disabled")):b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")),b.btnUp.jqxRepeatButton("disabled",b.disabled),b.btnDown.jqxRepeatButton("disabled",b.disabled),b.btnThumb.jqxButton("disabled",b.disabled))};this.propertyChangeMap.touchMode=function(b,e,c,d){c!=d&&(b._updateTouchBehavior(),
            !0===d?(b.showButtons=!1,b.refresh()):!1===d&&(b.showButtons=!0,b.refresh()))};this.propertyChangeMap.rtl=function(b,e,c,d){c!=d&&b.refresh()};this.buttonDownCapture=this.buttonUpCapture=!1;this._updateTouchBehavior();this.setPosition(this.value);this._addHandlers();this.setTheme()},resize:function(b,c){this.width=b;this.height=c;this._arrange()},_updateTouchBehavior:function(){this.isTouchDevice=d.jqx.mobile.isTouchDevice();1==this.touchMode?(d.jqx.browser.msie&&9>d.jqx.browser.version||(this.isTouchDevice=
        !0,d.jqx.mobile.setMobileSimulator(this.btnThumb[0]),this._removeHandlers(),this._addHandlers()),this.setTheme()):0==this.touchMode&&(this.isTouchDevice=!1)},_addHandlers:function(){var b=this,c=!1;try{if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)this._touchSupport=c=!0}catch(f){}if(b.isTouchDevice||c)this.addHandler(this.btnThumb,d.jqx.mobile.getTouchEventName("touchend"),function(e){var c=b.vertical?b.toThemeProperty("jqx-scrollbar-thumb-state-pressed"):b.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal"),
        f=b.toThemeProperty("jqx-fill-state-pressed");b.btnThumb.removeClass(c);b.btnThumb.removeClass(f);b.disabled||b.handlemouseup(b,e);return!1}),this.addHandler(this.btnThumb,d.jqx.mobile.getTouchEventName("touchstart"),function(e){b.disabled||(1==b.touchMode?(e.clientX=e.originalEvent.clientX,e.clientY=e.originalEvent.clientY):e.originalEvent.touches&&e.originalEvent.touches.length?(e.clientX=e.originalEvent.touches[0].clientX,e.clientY=e.originalEvent.touches[0].clientY):(e.clientX=e.originalEvent.clientX,
        e.clientY=e.originalEvent.clientY),b.handlemousedown(e),e.preventDefault&&e.preventDefault())}),d.jqx.mobile.touchScroll(this.element,b.max,function(e,c,d,k,l){"visible"==b.host.css("visibility")&&(1==b.touchMode?(l.clientX=l.originalEvent.clientX,l.clientY=l.originalEvent.clientY):l.originalEvent.touches&&l.originalEvent.touches.length?(l.clientX=l.originalEvent.touches[0].clientX,l.clientY=l.originalEvent.touches[0].clientY):(l.clientX=l.originalEvent.clientX,l.clientY=l.originalEvent.clientY),
        e=b.vertical?b.toThemeProperty("jqx-scrollbar-thumb-state-pressed"):b.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal"),b.btnThumb.addClass(e),b.btnThumb.addClass(b.toThemeProperty("jqx-fill-state-pressed")),b.thumbCapture=!0,b.handlemousemove(l))},b.element.id,b.host,b.host);if(!this.isTouchDevice){try{""==document.referrer&&!window.frameElement||null==window.top||window.top==window.self||(c=null,window.parent&&document.referrer&&(c=document.referrer),c&&-1!=c.indexOf(document.location.host)&&
    (c=function(e){b.disabled||b.handlemouseup(b,e)},window.top.document.addEventListener?window.top.document.addEventListener("mouseup",c,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",c)))}catch(f){}this.addHandler(this.btnDown,"click mouseup mousedown",function(e){var c=b.step;Math.abs(b.max-b.min)<=c&&(c=1);b.rtl&&!b.vertical&&(c=-b.step);switch(e.type){case "click":b.buttonDownCapture&&!b.isTouchDevice?b.disabled||b.setPosition(b.value+c):!b.disabled&&b.isTouchDevice&&
        b.setPosition(b.value+c);break;case "mouseup":if(!b.btnDownInstance.base.disabled&&b.buttonDownCapture)return b.buttonDownCapture=!1,b.btnDown.removeClass(b.toThemeProperty("jqx-scrollbar-button-state-pressed")),b.btnDown.removeClass(b.toThemeProperty("jqx-fill-state-pressed")),b._removeArrowClasses("pressed","down"),b.handlemouseup(b,e),b.setPosition(b.value+c),!1;break;case "mousedown":if(!b.btnDownInstance.base.disabled)return b.buttonDownCapture=!0,b.btnDown.addClass(b.toThemeProperty("jqx-fill-state-pressed")),
        b.btnDown.addClass(b.toThemeProperty("jqx-scrollbar-button-state-pressed")),b._addArrowClasses("pressed","down"),!1}});this.addHandler(this.btnUp,"click mouseup mousedown",function(e){var c=b.step;Math.abs(b.max-b.min)<=c&&(c=1);b.rtl&&!b.vertical&&(c=-b.step);switch(e.type){case "click":b.buttonUpCapture&&!b.isTouchDevice?b.disabled||b.setPosition(b.value-c):!b.disabled&&b.isTouchDevice&&b.setPosition(b.value-c);break;case "mouseup":if(!b.btnUpInstance.base.disabled&&b.buttonUpCapture)return b.buttonUpCapture=
        !1,b.btnUp.removeClass(b.toThemeProperty("jqx-scrollbar-button-state-pressed")),b.btnUp.removeClass(b.toThemeProperty("jqx-fill-state-pressed")),b._removeArrowClasses("pressed","up"),b.handlemouseup(b,e),b.setPosition(b.value-c),!1;break;case "mousedown":if(!b.btnUpInstance.base.disabled)return b.buttonUpCapture=!0,b.btnUp.addClass(b.toThemeProperty("jqx-fill-state-pressed")),b.btnUp.addClass(b.toThemeProperty("jqx-scrollbar-button-state-pressed")),b._addArrowClasses("pressed","up"),!1}})}c="click";
        this.isTouchDevice&&(c=d.jqx.mobile.getTouchEventName("touchend"));this.addHandler(this.areaUp,c,function(e){if(!b.disabled)return e=b.largestep,b.rtl&&!b.vertical&&(e=-b.largestep),b.setPosition(b.value-e),!1});this.addHandler(this.areaDown,c,function(e){if(!b.disabled)return e=b.largestep,b.rtl&&!b.vertical&&(e=-b.largestep),b.setPosition(b.value+e),!1});this.addHandler(this.areaUp,"mousedown",function(e){if(!b.disabled)return b.areaUpCapture=!0,!1});this.addHandler(this.areaDown,"mousedown",function(e){if(!b.disabled)return b.areaDownCapture=
            !0,!1});this.addHandler(this.btnThumb,"mousedown dragstart",function(e){if("dragstart"===e.type)return!1;b.disabled||b.handlemousedown(e);e.preventDefault&&e.preventDefault()});this.addHandler(d(document),"mouseup."+this.element.id,function(e){b.disabled||b.handlemouseup(b,e)});if(!this.isTouchDevice&&(this.mousemoveFunc=function(e){b.disabled||b.handlemousemove(e)},this.addHandler(d(document),"mousemove."+this.element.id,this.mousemoveFunc),this.addHandler(d(document),"mouseleave."+this.element.id,
            function(e){b.disabled||b.handlemouseleave(e)}),this.addHandler(d(document),"mouseenter."+this.element.id,function(e){b.disabled||b.handlemouseenter(e)}),!b.disabled)){this.addHandler(this.btnUp,"mouseenter mouseleave",function(e){"mouseenter"===e.type?b.disabled||b.btnUpInstance.base.disabled||1==b.touchMode||(b.btnUp.addClass(b.toThemeProperty("jqx-scrollbar-button-state-hover")),b.btnUp.addClass(b.toThemeProperty("jqx-fill-state-hover")),b._addArrowClasses("hover","up")):b.disabled||b.btnUpInstance.base.disabled||
            1==b.touchMode||(b.btnUp.removeClass(b.toThemeProperty("jqx-scrollbar-button-state-hover")),b.btnUp.removeClass(b.toThemeProperty("jqx-fill-state-hover")),b._removeArrowClasses("hover","up"))});var e=b.toThemeProperty("jqx-scrollbar-thumb-state-hover");b.vertical||(e=b.toThemeProperty("jqx-scrollbar-thumb-state-hover-horizontal"));this.addHandler(this.btnThumb,"mouseenter mouseleave",function(c){"mouseenter"===c.type?b.disabled||1==b.touchMode||(b.btnThumb.addClass(e),b.btnThumb.addClass(b.toThemeProperty("jqx-fill-state-hover"))):
            b.disabled||1==b.touchMode||(b.btnThumb.removeClass(e),b.btnThumb.removeClass(b.toThemeProperty("jqx-fill-state-hover")))});this.addHandler(this.btnDown,"mouseenter mouseleave",function(e){"mouseenter"===e.type?b.disabled||b.btnDownInstance.base.disabled||1==b.touchMode||(b.btnDown.addClass(b.toThemeProperty("jqx-scrollbar-button-state-hover")),b.btnDown.addClass(b.toThemeProperty("jqx-fill-state-hover")),b._addArrowClasses("hover","down")):b.disabled||b.btnDownInstance.base.disabled||1==b.touchMode||
            (b.btnDown.removeClass(b.toThemeProperty("jqx-scrollbar-button-state-hover")),b.btnDown.removeClass(b.toThemeProperty("jqx-fill-state-hover")),b._removeArrowClasses("hover","down"))})}},destroy:function(){var b=this.btnUp,c=this.btnDown,e=this.btnThumb,f=this.areaUp,g=this.areaDown;this.arrowUp.remove();delete this.arrowUp;this.arrowDown.remove();delete this.arrowDown;g.removeClass();f.removeClass();c.removeClass();b.removeClass();e.removeClass();b.jqxRepeatButton("destroy");c.jqxRepeatButton("destroy");
        f.jqxRepeatButton("destroy");g.jqxRepeatButton("destroy");e.jqxButton("destroy");b=d.data(this.element,"jqxScrollBar");this._removeHandlers();this.scrollOuterWrap=this.areaDown=this.areaUp=this.scrollWrap=this.btnDown=this.btnUp=null;delete this.mousemoveFunc;delete this.btnDownInstance;delete this.btnUpInstance;delete this.scrollOuterWrap;delete this.scrollWrap;delete this.btnDown;delete this.areaDown;delete this.areaUp;delete this.btnDown;delete this.btnUp;delete this.btnThumb;delete this.propertyChangeMap.value;
        delete this.propertyChangeMap.min;delete this.propertyChangeMap.max;delete this.propertyChangeMap.touchMode;delete this.propertyChangeMap.disabled;delete this.propertyChangeMap.theme;delete this.propertyChangeMap;b&&delete b.instance;this.host.removeData();this.host.remove();delete this.host;delete this.set;delete this.get;delete this.call;delete this.element},_removeHandlers:function(){this.removeHandler(this.btnUp,"mouseenter");this.removeHandler(this.btnDown,"mouseenter");this.removeHandler(this.btnThumb,
        "mouseenter");this.removeHandler(this.btnUp,"mouseleave");this.removeHandler(this.btnDown,"mouseleave");this.removeHandler(this.btnThumb,"mouseleave");this.removeHandler(this.btnUp,"click");this.removeHandler(this.btnDown,"click");this.removeHandler(this.btnDown,"mouseup");this.removeHandler(this.btnUp,"mouseup");this.removeHandler(this.btnDown,"mousedown");this.removeHandler(this.btnUp,"mousedown");this.removeHandler(this.areaUp,"mousedown");this.removeHandler(this.areaDown,"mousedown");this.removeHandler(this.areaUp,
        "click");this.removeHandler(this.areaDown,"click");this.removeHandler(this.btnThumb,"mousedown");this.removeHandler(this.btnThumb,"dragstart");this.removeHandler(d(document),"mouseup."+this.element.id);this.mousemoveFunc?this.removeHandler(d(document),"mousemove."+this.element.id,this.mousemoveFunc):this.removeHandler(d(document),"mousemove."+this.element.id);this.removeHandler(d(document),"mouseleave."+this.element.id);this.removeHandler(d(document),"mouseenter."+this.element.id)},_addArrowClasses:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         c){"pressed"==b&&(b="selected");""!=b&&(b="-"+b);this.vertical?("up"!=c&&void 0!=c||this.arrowUp.addClass(this.toThemeProperty("jqx-icon-arrow-up"+b)),"down"!=c&&void 0!=c||this.arrowDown.addClass(this.toThemeProperty("jqx-icon-arrow-down"+b))):("up"!=c&&void 0!=c||this.arrowUp.addClass(this.toThemeProperty("jqx-icon-arrow-left"+b)),"down"!=c&&void 0!=c||this.arrowDown.addClass(this.toThemeProperty("jqx-icon-arrow-right"+b)))},_removeArrowClasses:function(b,c){"pressed"==b&&(b="selected");""!=b&&
    (b="-"+b);this.vertical?("up"!=c&&void 0!=c||this.arrowUp.removeClass(this.toThemeProperty("jqx-icon-arrow-up"+b)),"down"!=c&&void 0!=c||this.arrowDown.removeClass(this.toThemeProperty("jqx-icon-arrow-down"+b))):("up"!=c&&void 0!=c||this.arrowUp.removeClass(this.toThemeProperty("jqx-icon-arrow-left"+b)),"down"!=c&&void 0!=c||this.arrowDown.removeClass(this.toThemeProperty("jqx-icon-arrow-right"+b)))},setTheme:function(){var b=this.btnUp,c=this.btnDown,e=this.btnThumb,f=this.scrollWrap,g=this.arrowUp,
        h=this.arrowDown;this.scrollWrap[0].className=this.toThemeProperty("jqx-reset");this.scrollOuterWrap[0].className=this.toThemeProperty("jqx-reset");var k=this.toThemeProperty("jqx-reset");this.areaDown[0].className=k;this.areaUp[0].className=k;var l=this.toThemeProperty("jqx-scrollbar")+" "+this.toThemeProperty("jqx-widget")+" "+this.toThemeProperty("jqx-widget-content");this.host.addClass(l);this.isTouchDevice&&this.host.addClass(this.toThemeProperty("jqx-scrollbar-mobile"));c[0].className=this.toThemeProperty("jqx-scrollbar-button-state-normal");
        b[0].className=this.toThemeProperty("jqx-scrollbar-button-state-normal");this.vertical?(g[0].className=k+" "+this.toThemeProperty("jqx-icon-arrow-up"),h[0].className=k+" "+this.toThemeProperty("jqx-icon-arrow-down"),g=this.toThemeProperty("jqx-scrollbar-thumb-state-normal")):(g[0].className=k+" "+this.toThemeProperty("jqx-icon-arrow-left"),h[0].className=k+" "+this.toThemeProperty("jqx-icon-arrow-right"),g=this.toThemeProperty("jqx-scrollbar-thumb-state-normal-horizontal"));g+=" "+this.toThemeProperty("jqx-fill-state-normal");
        e[0].className=g;this.disabled?(f.addClass(this.toThemeProperty("jqx-fill-state-disabled")),f.removeClass(this.toThemeProperty("jqx-scrollbar-state-normal"))):(f.addClass(this.toThemeProperty("jqx-scrollbar-state-normal")),f.removeClass(this.toThemeProperty("jqx-fill-state-disabled")));"all"==this.roundedCorners?(this.host.addClass(this.toThemeProperty("jqx-rc-all")),this.vertical?(f=d.jqx.cssroundedcorners("top"),f=this.toThemeProperty(f),b.addClass(f),f=d.jqx.cssroundedcorners("bottom"),f=this.toThemeProperty(f),
            c.addClass(f)):(f=d.jqx.cssroundedcorners("left"),f=this.toThemeProperty(f),b.addClass(f),f=d.jqx.cssroundedcorners("right"),f=this.toThemeProperty(f),c.addClass(f))):(f=d.jqx.cssroundedcorners(this.roundedCorners),f=this.toThemeProperty(f),b.addClass(f),c.addClass(f));f=d.jqx.cssroundedcorners(this.roundedCorners);f=this.toThemeProperty(f);e.hasClass(f)||e.addClass(f);"none"===b.css("display")&&(this.showButtons=!1,this.touchModeStyle=!0,e.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-normal-touch")));
        this.isTouchDevice&&0!=this.touchModeStyle&&(this.showButtons=!1,e.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-normal-touch")))},isScrolling:function(){return void 0==this.thumbCapture||void 0==this.buttonDownCapture||void 0==this.buttonUpCapture||void 0==this.areaDownCapture||void 0==this.areaUpCapture?!1:this.thumbCapture||this.buttonDownCapture||this.buttonUpCapture||this.areaDownCapture||this.areaUpCapture},track:function(){var b=Date.now();var c=b-this.timestamp;this.timestamp=b;
        b=this.offset-this.frame;this.frame=this.offset;this.velocity=1E3*b/(1+c)*.2+.2*this.velocity},handlemousedown:function(b){function c(b){f.reference=parseInt(f.btnThumb[0].style.top);f.offset=parseInt(f.btnThumb[0].style.top);f.vertical||(f.reference=parseInt(f.btnThumb[0].style.left),f.offset=parseInt(f.btnThumb[0].style.left));f.velocity=f.amplitude=0;f.frame=f.offset;f.timestamp=Date.now();clearInterval(f.ticker);f.ticker=setInterval(function(){f.track()},100)}if(void 0==this.thumbCapture||0==
        this.thumbCapture){this.thumbCapture=!0;var e=this.btnThumb;null!=e&&(e.addClass(this.toThemeProperty("jqx-fill-state-pressed")),this.vertical?e.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-pressed")):e.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal")))}var f=this;this.thumbCapture&&d.jqx.scrollAnimation&&c(b);this.dragStartX=b.clientX;this.dragStartY=b.clientY;this.dragStartValue=this.value},toggleHover:function(b,c){},refresh:function(){this._arrange()},
    _setElementPosition:function(b,c,e){isNaN(c)||parseInt(b[0].style.left)==parseInt(c)||(b[0].style.left=c+"px");isNaN(e)||parseInt(b[0].style.top)==parseInt(e)||(b[0].style.top=e+"px")},_setElementTopPosition:function(b,c){isNaN(c)||(b[0].style.top=c+"px")},_setElementLeftPosition:function(b,c){isNaN(c)||(b[0].style.left=c+"px")},handlemouseleave:function(b){b=this.btnUp;var c=this.btnDown;if(this.buttonDownCapture||this.buttonUpCapture)b.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),
        c.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),this._removeArrowClasses("pressed");1==this.thumbCapture&&(b=this.btnThumb,c=this.vertical?this.toThemeProperty("jqx-scrollbar-thumb-state-pressed"):this.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal"),b.removeClass(c),b.removeClass(this.toThemeProperty("jqx-fill-state-pressed")))},handlemouseenter:function(b){b=this.btnUp;var c=this.btnDown;this.buttonUpCapture&&(b.addClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),
        b.addClass(this.toThemeProperty("jqx-fill-state-pressed")),this._addArrowClasses("pressed","up"));this.buttonDownCapture&&(c.addClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),c.addClass(this.toThemeProperty("jqx-fill-state-pressed")),this._addArrowClasses("pressed","down"));1==this.thumbCapture&&(b=this.btnThumb,this.vertical?b.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-pressed")):b.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal")),b.addClass(this.toThemeProperty("jqx-fill-state-pressed")))},
    handlemousemove:function(b){var c=this.btnUp,e=this.btnDown;if(null!=e&&null!=c){null!=c&&null!=e&&void 0!=this.buttonDownCapture&&void 0!=this.buttonUpCapture&&(this.buttonDownCapture&&0==b.which?(e.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),e.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),this._removeArrowClasses("pressed","down"),this.buttonDownCapture=!1):this.buttonUpCapture&&0==b.which&&(c.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),
        c.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),this._removeArrowClasses("pressed","up"),this.buttonUpCapture=!1));if(1!=this.thumbCapture)return!1;var f=this.btnThumb;if(0==b.which&&!this.isTouchDevice&&!this._touchSupport)return this.thumbCapture=!1,this._arrange(),b=this.vertical?this.toThemeProperty("jqx-scrollbar-thumb-state-pressed"):this.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal"),f.removeClass(b),f.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),
        !0;void 0!=b.preventDefault&&b.preventDefault();null!=b.originalEvent&&(b.originalEvent.mouseHandled=!0);void 0!=b.stopPropagation&&b.stopPropagation();var d=0;try{d=this.vertical?b.clientY-this.dragStartY:b.clientX-this.dragStartX;var h=this._btnAndThumbSize;this._btnAndThumbSize||(h=this.vertical?c.height()+e.height()+f.height():c.width()+e.width()+f.width());var k=(this.max-this.min)/(this.scrollBarSize-h);if("auto"==this.thumbStep)d*=k;else{d*=k;if(Math.abs(this.dragStartValue+d-this.value)>=
        parseInt(this.thumbStep)){var l=Math.round(parseInt(d)/this.thumbStep)*this.thumbStep;this.rtl&&!this.vertical?this.setPosition(this.dragStartValue-l):this.setPosition(this.dragStartValue+l)}return!1}l=d;this.rtl&&!this.vertical&&(l=-d);this.setPosition(this.dragStartValue+l);this.offset=parseInt(f[0].style.left);this.vertical&&(this.offset=parseInt(f[0].style.top))}catch(m){alert(m)}return!1}},handlemouseup:function(b,c){b=!1;if(this.thumbCapture){this.thumbCapture=!1;b=this.btnThumb;var e=this.vertical?
        this.toThemeProperty("jqx-scrollbar-thumb-state-pressed"):this.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal");b.removeClass(e);b.removeClass(this.toThemeProperty("jqx-fill-state-pressed"));b=!0;this._mouseup=new Date;if(d.jqx.scrollAnimation){var f=function(){if(g.amplitude){var b=Date.now()-g.timestamp;b=-g.amplitude*Math.exp(-b/325);if(.5<b||-.5>b){var e=(g.max-g.min)/(g.scrollBarSize-g._btnAndThumbSize);e=b=e*(g.target+b);g.rtl&&!g.vertical&&(e=-b);g.setPosition(g.dragStartValue+
        e);requestAnimationFrame(f)}else e=(g.max-g.min)/(g.scrollBarSize-g._btnAndThumbSize),e=b=e*(g.target+b),g.rtl&&!g.vertical&&(e=-b),g.setPosition(g.dragStartValue+e)}},g=this;clearInterval(this.ticker);if(25<this.velocity||-25>this.velocity)this.amplitude=.8*this.velocity,this.target=Math.round(this.offset+this.amplitude),this.target-=this.reference,this.timestamp=Date.now(),requestAnimationFrame(f)}}this.areaDownCapture=this.areaUpCapture=!1;if(this.buttonUpCapture||this.buttonDownCapture)b=this.btnUp,
        e=this.btnDown,this.buttonDownCapture=this.buttonUpCapture=!1,b.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),e.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),b.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),e.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),this._removeArrowClasses("pressed"),b=!0,this._mouseup=new Date;b&&(void 0!=c.preventDefault&&c.preventDefault(),null!=c.originalEvent&&(c.originalEvent.mouseHandled=!0),
    void 0!=c.stopPropagation&&c.stopPropagation())},setPosition:function(b,c){if(void 0==b||NaN==b)b=this.min;b>=this.max&&(b=this.max);b<this.min&&(b=this.min);if(this.value!==b||1==c){b==this.max&&(c=new d.Event("complete"),this.host.trigger(c));c=this.value;if(this._triggervaluechanged){var e=new d.Event("valueChanged");e.previousValue=this.value;e.currentValue=b}this.value=b;this._positionelements();this._triggervaluechanged&&this.host.trigger(e);this.valueChanged&&this.valueChanged({currentValue:this.value,
        previousvalue:c})}return b},val:function(b){a:{for(c in b)if(b.hasOwnProperty(c)){var c=!1;break a}c="number"==typeof b||"date"==typeof b||"boolean"==typeof b||"string"==typeof b?!1:!0}if(c||0==arguments.length)return this.value;this.setPosition(b);return b},_getThumbSize:function(b){var c=this.max-this.min,e=0;1<c?e=b/(c+b)*b:1==c?e=b-1:0==c&&(e=b);0<this.thumbSize&&(e=this.thumbSize);e<this.thumbMinSize&&(e=this.thumbMinSize);return Math.min(e,b)},_positionelements:function(){var b=this.areaUp,
        c=this.areaDown,e=this.btnThumb,f=this._height?this._height:this.host.height(),d=this._width?this._width:this.host.width(),h=this.vertical?d:f;this.showButtons||(h=0);var k=this.vertical?f:d;this.scrollBarSize=k;f=this._getThumbSize(k-2*h);f=Math.floor(f);f<this.thumbMinSize&&(f=this.thumbMinSize);this.btnSize=h+=2;var l=this._btnAndThumbSize;this._btnAndThumbSize||(l=this.vertical?2*this.btnSize+e.outerHeight():2*this.btnSize+e.outerWidth(),l=Math.round(l));d=(k-l)/(this.max-this.min)*(this.value-
        this.min);this.rtl&&!this.vertical&&(d=(k-l)/(this.max-this.min)*(this.max-this.value-this.min));d=Math.round(d);0>d&&(d=0);this.vertical?(k=k-d-l,0>k&&(k=0),c[0].style.height=k+"px",b[0].style.height=d+"px",this._setElementTopPosition(b,h),this._setElementTopPosition(e,h+d),this._setElementTopPosition(c,h+d+f)):(b[0].style.width=d+"px",c[0].style.width=0<=k-d-l?k-d-l+"px":"0px",this._setElementLeftPosition(b,h),this._setElementLeftPosition(e,h+d),this._setElementLeftPosition(c,2+h+d+f))},_arrange:function(){if(this._initialLayout)this._initialLayout=
        !1;else{if(this.min>this.max){var b=this.min;this.min=this.max;this.max=b}0>this.min&&(b=this.max-this.min,this.min=0,this.max=b);b=this.areaUp;var c=this.areaDown,e=this.btnUp,f=this.btnDown,d=this.btnThumb,h=this.scrollWrap,k=parseInt(this.element.style.height),l=parseInt(this.element.style.width);this.isPercentage&&(k=this.host.height(),l=this.host.width());isNaN(k)&&(k=0);isNaN(l)&&(l=0);this._width=l;this._height=k;var m=this.vertical?l:k;this.showButtons||(m=0);e[0].style.width=m+"px";e[0].style.height=
        m+"px";f[0].style.width=m+"px";f[0].style.height=m+"px";this.vertical?h[0].style.width=l+2+"px":h[0].style.height=k+2+"px";this._setElementPosition(e,0,0);e=m+2;this.vertical?this._setElementPosition(f,0,k-e):this._setElementPosition(f,l-e,0);var p=this.vertical?k:l;this.scrollBarSize=p;f=this._getThumbSize(p-2*e);f=Math.floor(f-2);f<this.thumbMinSize&&(f=this.thumbMinSize);h=!1;this.isTouchDevice&&0!=this.touchModeStyle&&(h=!0);this.vertical?(d[0].style.width=l+"px",d[0].style.height=f+"px",h&&0!==
    this.thumbTouchSize&&(d.css({width:this.thumbTouchSize+"px"}),d.css("margin-left",(this.host.width()-this.thumbTouchSize)/2))):(d[0].style.width=f+"px",d[0].style.height=k+"px",h&&0!==this.thumbTouchSize&&(d.css({height:this.thumbTouchSize+"px"}),d.css("margin-top",(this.host.height()-this.thumbTouchSize)/2)));if(NaN==k||10>k)k=10;if(NaN==l||10>l)l=10;this.btnSize=m;h=this.vertical?2*e+(2+parseInt(d[0].style.height)):2*e+(2+parseInt(d[0].style.width));this._btnAndThumbSize=h=Math.round(h);var r=(p-
        h)/(this.max-this.min)*(this.value-this.min);this.rtl&&!this.vertical&&(r=(p-h)/(this.max-this.min)*(this.max-this.value-this.min));r=Math.round(r);if(isNaN(r)||0>r||-Infinity===r||Infinity===r)r=0;if(this.vertical){k=p-r-h;0>k&&(k=0);c[0].style.height=k+"px";c[0].style.width=l+"px";b[0].style.height=r+"px";b[0].style.width=l+"px";k=parseInt(this.element.style.height);this.isPercentage&&(k=this.host.height());d[0].style.visibility="inherit";if(0>k-3*parseInt(m)||k<h)d[0].style.visibility="hidden";
        this._setElementPosition(b,0,e);this._setElementPosition(d,0,e+r);this._setElementPosition(c,0,e+r+f)}else{0<r&&(b[0].style.width=r+"px");0<k&&(b[0].style.height=k+"px");l=p-r-h;0>l&&(l=0);c[0].style.width=l+"px";c[0].style.height=k+"px";k=parseInt(this.element.style.width);this.isPercentage&&(k=this.host.width());d[0].style.visibility="inherit";if(0>k-3*parseInt(m)||k<h)d[0].style.visibility="hidden";this._setElementPosition(b,e,0);this._setElementPosition(d,e+r,0);this._setElementPosition(c,e+r+
        f,0)}}}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxMenu","",{});d.extend(d.jqx._jqxMenu.prototype,{defineInstance:function(){var b={items:[],mode:"horizontal",width:null,height:null,minimizeWidth:"auto",easing:"easeInOutSine",animationShowDuration:200,animationHideDuration:200,autoCloseInterval:0,animationHideDelay:100,animationShowDelay:10,menuElements:[],autoSizeMainItems:!1,autoCloseOnClick:!0,autoCloseOnMouseLeave:!0,enableRoundedCorners:!0,disabled:!1,autoOpenPopup:!0,enableHover:!0,autoOpen:!0,autoGenerate:!0,
        clickToOpen:!1,showTopLevelArrows:!1,touchMode:"auto",source:null,popupZIndex:1E3,rtl:!1,keyboardNavigation:!1,lockFocus:!1,title:"",events:"shown closed itemclick initialized open close".split(" ")};if(this===d.jqx._jqxMenu.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(b){var c=this;this.host.attr("role","menubar");d.jqx.utilities.resize(this.host,function(){c.refresh()},!1,"popup"!=this.mode);"auto"!=this.minimizeWidth&&null!=this.minimizeWidth&&this.width&&-1==this.width.toString().indexOf("%")&&
    d(window).resize(function(){c.refresh()});this.host.css("outline","none");this.source&&null!=this.source&&(b=this.loadItems(this.source),this.element.innerHTML=b);this._tmpHTML=this.element.innerHTML;this.element.innerHTML.indexOf("UL")&&(b=this.host.find("ul:first"),0<b.length&&this._createMenu(b[0]));this.host.data("autoclose",{});this._render();this._setSize();d.jqx.browser.msie&&8>d.jqx.browser.version&&this.host.attr("hideFocus",!0)},focus:function(){try{if("popup"===this.mode&&this.keyboardNavigation&&
    this.host.closest("div.jqx-menu-wrapper").focus(),this.keyboardNavigation){this.host.focus();var b=this,c=function(){if(d.jqx.isHidden(d(b.items[0].element))){var e=b._nextVisibleItem(b.items[0],0);e&&(d(e.element).addClass(b.toThemeProperty("jqx-fill-state-focus")),b.activeItem=e)}else d(b.items[0].element).addClass(b.toThemeProperty("jqx-fill-state-focus")),b.activeItem=b.items[0]};this.activeItem?d.jqx.isHidden(d(this.activeItem.element))?(d(this.activeItem.element).removeClass(this.toThemeProperty("jqx-fill-state-focus")),
        c()):d(this.activeItem.element).addClass(this.toThemeProperty("jqx-fill-state-focus")):c()}}catch(e){}},loadItems:function(b,c){if(null!=b){if(0==b.length)return"";var e=this;this.items=[];var f='<ul class="jqx-menu-ul">';c&&(f='<ul class="jqx-menu-ul" style="width:'+c+';">');d.map(b,function(b){if(void 0==b)return null;f+=e._parseItem(b)});return f+="</ul>"}},_parseItem:function(b){if(void 0==b)return null;var c=b.label;!b.label&&b.html&&(c=b.html);c||(c="Item");"string"===typeof b&&(c=b);var e=
        !1;void 0!=b.disabled&&b.disabled&&(e=!0);var f="<li";e&&(f+=' item-disabled="true" ');b.label&&!b.html&&(f+=' item-label="'+c+'" ');null!=b.value&&(f+=' item-value="'+b.value+'" ');void 0!=b.id&&(f+=' id="'+b.id+'" ');f+=">"+c;b.items&&(f=b.subMenuWidth?f+this.loadItems(b.items,b.subMenuWidth):f+this.loadItems(b.items));return f+"</li>"},_setSize:function(){null!=this.width&&-1!=this.width.toString().indexOf("%")?this.host.width(this.width):null!=this.width&&-1!=this.width.toString().indexOf("px")?
        this.host.width(this.width):void 0==this.width||isNaN(this.width)||this.host.width(this.width);null!=this.height&&-1!=this.height.toString().indexOf("%")?this.host.height(this.height):null!=this.height&&-1!=this.height.toString().indexOf("px")?this.host.height(this.height):void 0==this.height||isNaN(this.height)||this.host.height(this.height);null===this.height&&this.host.height("auto");if(null!=this.minimizeWidth&&"popup"!=this.mode){var b=d(window).width();if(!d.jqx.response){var c=!1;navigator.userAgent.match(/Windows|Linux|MacOS/)&&
    (0<=navigator.userAgent.indexOf("Windows Phone")||0<=navigator.userAgent.indexOf("WPDesktop")||0<=navigator.userAgent.indexOf("IEMobile")||0<=navigator.userAgent.indexOf("ZuneWP7")||(c=!0));var e=this.minimizeWidth;if(c&&"auto"==this.minimizeWidth)return}if("auto"==this.minimizeWidth&&d.jqx.response){if(b=new d.jqx.response,"Phone"==b.device.type||"Tablet"==b.device.type)this.minimized||this.minimize()}else b<e&&!this.minimized?this.minimize():this.minimized&&b>=e&&this.restore()}},minimize:function(){if(!this.minimized){var b=
        this;this.host.addClass(this.toThemeProperty("jqx-menu-minimized"));this.minimized=!0;this._tmpMode=this.mode;this.mode="simple";var c=this.host.closest("div.jqx-menu-wrapper");c.remove();d("#menuWrapper"+this.element.id).remove();d.each(this.items,function(){d(this.element);d(this.subMenuElement).closest("div.jqx-menu-popup").remove()});if(this.source){var e=this.loadItems(this.source);this.element.innerHTML=e;this._tmpHTML=this.element.innerHTML}this.element.innerHTML=this._tmpHTML;this.element.innerHTML.indexOf("UL")&&
    (e=this.host.find("ul:first"),0<e.length&&this._createMenu(e[0]));this._render();e=this.host.find("ul:first");e.wrap('<div class="jqx-menu-wrapper" style="z-index:'+this.popupZIndex+'; padding: 0px; display: none; margin: 0px; height: auto; width: auto; position: absolute; top: 0; left: 0; display: block; visibility: visible;"></div>');c=e.closest("div.jqx-menu-wrapper");c[0].id="menuWrapper"+this.element.id;c.detach();c.appendTo(d(document.body));c.addClass(this.toThemeProperty("jqx-widget"));c.addClass(this.toThemeProperty("jqx-menu"));
        c.addClass(this.toThemeProperty("jqx-menu-minimized"));c.addClass(this.toThemeProperty("jqx-widget-header"));e.children().hide();c.hide();c.find("ul").addClass(this.toThemeProperty("jqx-menu-ul-minimized"));this.minimizedItem=d("<div></div>");this.minimizedItem.addClass(this.toThemeProperty("jqx-item"));this.minimizedItem.addClass(this.toThemeProperty("jqx-menu-item-top"));this.addHandler(c,"keydown",function(e){return b.handleKeyDown(e)});this.minimizedItem.addClass(this.toThemeProperty("jqx-menu-minimized-button"));
        this.minimizedItem.prependTo(this.host);this.titleElement=d("<div>"+this.title+"</div>");this.titleElement.addClass(this.toThemeProperty("jqx-item"));this.titleElement.addClass(this.toThemeProperty("jqx-menu-title"));this.titleElement.prependTo(this.host);d("<div style='clear:both;'></div>").insertAfter(this.minimizedItem);b.minimizedHidden=!0;var f=function(e){b.minimizedHidden=!0;b.minimizedItem.show();e=!1;"right"==b.minimizedItem.css("float")&&(e=!0);c.animate({left:e?b.host.coord().left+b.host.width()+
                c.width():-c.outerWidth(),opacity:0},b.animationHideDuration,function(){c.find("ul:first").children().hide();c.hide()})},g=function(e){if(b.minimizedHidden){c.find("ul:first").children().show();b.minimizedHidden=!1;c.show();c.css("opacity",0);c.css("left",-c.outerWidth());var d=!1,g=c.width();"right"==b.minimizedItem.css("float")&&(c.css("left",b.host.coord().left+b.host.width()+g),d=!0);c.css("top",b.host.coord().top+b.host.height());c.animate({left:d?b.host.coord().left+b.host.width()-g:b.host.coord().left,
            opacity:.95},b.animationShowDuration,function(){})}else f(e);b._raiseEvent("2",{type:"mouse",item:b.minimizedItem[0],event:e});b._setSize()};this.addHandler(d(window),"orientationchange.jqxmenu"+this.element.id,function(e){setTimeout(function(){if(!b.minimizedHidden){c.width();var e=!1;var f=c.width();"right"==b.minimizedItem.css("float")&&(e=!0);c.css("top",b.host.coord().top+b.host.height());c.css({left:e?b.host.coord().left+b.host.width()-f:b.host.coord().left})}},25)});this.addHandler(this.minimizedItem,
            "click",function(b){g(b)})}},restore:function(){if(this.minimized){this.host.find("ul").removeClass(this.toThemeProperty("jqx-menu-ul-minimized"));this.host.removeClass(this.toThemeProperty("jqx-menu-minimized"));this.minimized=!1;this.mode=this._tmpMode;this.minimizedItem&&this.minimizedItem.remove();d("#menuWrapper"+this.element.id).remove();if(this.source){var b=this.loadItems(this.source);this._tmpHTML=this.element.innerHTML=b}this.element.innerHTML=this._tmpHTML;this.element.innerHTML.indexOf("UL")&&
    (b=this.host.find("ul:first"),0<b.length&&this._createMenu(b[0]));this._setSize();this._render()}},isTouchDevice:function(){if(void 0!=this._isTouchDevice)return this._isTouchDevice;var b=d.jqx.mobile.isTouchDevice();1==this.touchMode?b=!0:0==this.touchMode&&(b=!1);b&&(this.host.addClass(this.toThemeProperty("jqx-touch")),d(".jqx-menu-item").addClass(this.toThemeProperty("jqx-touch")));return this._isTouchDevice=b},refresh:function(b){b||this._setSize()},resize:function(b,c){this.width=b;this.height=
        c;this.refresh()},_closeAll:function(b){var c=null!=b?b.data:this;d.each(c.items,function(){1==this.hasItems&&this.isOpen&&c._closeItem(c,this)});"popup"==c.mode&&null!=b&&(c._isRightClick(b)||c.close())},closeItem:function(b){if(null==b)return!1;var c=document.getElementById(b),e=this;d.each(e.items,function(){1==this.isOpen&&this.element==c&&e._closeItem(e,this)});return!0},openItem:function(b){if(null==b)return!1;var c=document.getElementById(b),e=this;d.each(e.items,function(){0==this.isOpen&&
    this.element==c&&(e._openItem(e,this),this.parentId&&e.openItem(this.parentId))});return!0},_getClosedSubMenuOffset:function(b){var c=d(b.subMenuElement),e=-c.outerHeight(),f=-c.outerWidth(),g=0==b.level&&"horizontal"==this.mode;g?f=0:e=0;switch(b.openVerticalDirection){case "up":case "center":e=c.outerHeight()}switch(b.openHorizontalDirection){case this._getDir("left"):f=g?0:c.outerWidth();break;case "center":f=g?0:c.outerWidth()}return{left:f,top:e}},_closeItem:function(b,c,e,f){if(null==b||null==
        c)return!1;var g=d(c.subMenuElement),h=0==c.level&&"horizontal"==this.mode,k=this._getClosedSubMenuOffset(c),l=k.top,m=k.left;d(c.element);var p=g.closest("div.jqx-menu-popup");if(null!=p){k=b.animationHideDelay;1==f&&(k=0);g.data("timer")&&null!=g.data("timer").show&&(clearTimeout(g.data("timer").show),g.data("timer").show=null);var r=function(){c.isOpen=!1;h?g.stop().animate({top:l},b.animationHideDuration,function(){d(c.element).removeClass(b.toThemeProperty("jqx-fill-state-pressed"));d(c.element).removeClass(b.toThemeProperty("jqx-menu-item-top-selected"));
        d(c.element).removeClass(b.toThemeProperty("jqx-rc-b-expanded"));p.removeClass(b.toThemeProperty("jqx-rc-t-expanded"));var e=d(c.arrow);0<e.length&&b.showTopLevelArrows&&(e.removeClass(),"down"==c.openVerticalDirection?(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-down")),e.addClass(b.toThemeProperty("jqx-icon-arrow-down"))):(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-up")),e.addClass(b.toThemeProperty("jqx-icon-arrow-up"))));d.jqx.aria(d(c.element),"aria-expanded",!1);p.css({display:"none"});
        0==b.animationHideDuration&&g.css({top:l});b._raiseEvent("1",c)}):g.stop().animate({left:m},b.animationHideDuration,function(){0==b.animationHideDuration&&g.css({left:m});if(0<c.level){d(c.element).removeClass(b.toThemeProperty("jqx-fill-state-pressed"));d(c.element).removeClass(b.toThemeProperty("jqx-menu-item-selected"));var e=d(c.arrow);0<e.length&&(e.removeClass(),"left"!=c.openHorizontalDirection?(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-"+b._getDir("right"))),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+
        b._getDir("right")))):(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-"+b._getDir("left"))),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+b._getDir("left")))))}else d(c.element).removeClass(b.toThemeProperty("jqx-fill-state-pressed")),d(c.element).removeClass(b.toThemeProperty("jqx-menu-item-top-selected")),e=d(c.arrow),0<e.length&&(e.removeClass(),"left"!=c.openHorizontalDirection?(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-top-"+b._getDir("right"))),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+
        b._getDir("right")))):(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-top-"+b._getDir("left"))),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+b._getDir("left")))));d.jqx.aria(d(c.element),"aria-expanded",!1);p.css({display:"none"});b._raiseEvent("1",c)})};0<k?g.data("timer")&&(g.data("timer").hide=setTimeout(function(){r()},k)):r();void 0!=e&&e&&(e=g.children(),d.each(e,function(){b.menuElements[this.id]&&b.menuElements[this.id].isOpen&&(d(b.menuElements[this.id].subMenuElement),b._closeItem(b,
        b.menuElements[this.id],!0,!0))}))}},getSubItems:function(b,c){if(null==b)return!1;var e=this,f=[];null!=c&&d.extend(f,c);b=d(this.menuElements[b].subMenuElement).find(".jqx-menu-item");d.each(b,function(){f[this.id]=e.menuElements[this.id];var b=e.getSubItems(this.id,f);d.extend(f,b)});return f},disable:function(b,c){if(null!=b&&this.menuElements[b]){b=this.menuElements[b];b.disabled=c;var e=d(b.element);b.element.disabled=c;d.each(e.children(),function(){this.disabled=c});c?(e.addClass(this.toThemeProperty("jqx-menu-item-disabled")),
        e.addClass(this.toThemeProperty("jqx-fill-state-disabled"))):(e.removeClass(this.toThemeProperty("jqx-menu-item-disabled")),e.removeClass(this.toThemeProperty("jqx-fill-state-disabled")))}},getItem:function(b){return this.menuElements[b]?this.menuElements[b]:null},disableItem:function(b){this.disable(b,!0)},hideItem:function(b){this.menuElements[b]&&d(this.menuElements[b].element).hide()},showItem:function(b){this.menuElements[b]&&d(this.menuElements[b].element).show()},enableItem:function(b){this.disable(b,
        !1)},_setItemProperty:function(b,c,e){null!=b&&this.menuElements[b]&&(b=this.menuElements[b],b[c]&&(b[c]=e))},setItemOpenDirection:function(b,c,e){if(null!=b){var f=d.jqx.browser.msie&&8>d.jqx.browser.version;if(this.menuElements[b]){b=this.menuElements[b];if(null!=c&&(b.openHorizontalDirection=c,b.hasItems&&0<b.level&&(c=d(b.element),void 0!=c))){var g=d(b.arrow);null==b.arrow&&(g=d('<span id="arrow'+c[0].id+'"></span>'),f?g.appendTo(c):g.prependTo(c),b.arrow=g[0]);g.removeClass();"left"==b.openHorizontalDirection?
        (g.addClass(this.toThemeProperty("jqx-menu-item-arrow-"+this._getDir("left"))),g.addClass(this.toThemeProperty("jqx-icon-arrow-"+this._getDir("left")))):(g.addClass(this.toThemeProperty("jqx-menu-item-arrow-"+this._getDir("right"))),g.addClass(this.toThemeProperty("jqx-icon-arrow-"+this._getDir("right"))));g.css("visibility","inherit");f?(g.css("display","inline-block"),g.css("float","none")):(g.css("display","block"),g.css("float","right"))}null!=e&&(b.openVerticalDirection=e,g=d(b.arrow),c=d(b.element),
    this.showTopLevelArrows&&void 0!=c&&(null==b.arrow&&(g=d('<span id="arrow'+c[0].id+'"></span>'),f?g.appendTo(c):g.prependTo(c),b.arrow=g[0]),g.removeClass(),"down"==b.openVerticalDirection?(g.addClass(this.toThemeProperty("jqx-menu-item-arrow-down")),g.addClass(this.toThemeProperty("jqx-icon-arrow-down"))):(g.addClass(this.toThemeProperty("jqx-menu-item-arrow-up")),g.addClass(this.toThemeProperty("jqx-icon-arrow-up"))),g.css("visibility","inherit"),f?(g.css("display","inline-block"),g.css("float",
        "none")):(g.css("display","block"),g.css("float","right"))))}}},_getSiblings:function(b){for(var c=[],e=0,f=0;f<this.items.length;f++)this.items[f]!=b&&this.items[f].parentId==b.parentId&&this.items[f].hasItems&&(c[e++]=this.items[f]);return c},_openItem:function(b,c,e){if(null==b||null==c||c.isOpen||c.disabled||b.disabled)return!1;var f=b.popupZIndex;void 0!=e&&(f=e);e=b.animationHideDuration;b.animationHideDuration=0;b._closeItem(b,c,!0,!0);b.animationHideDuration=e;d(c.element).focus();e=[5,5];
        var g=d(c.subMenuElement);null!=g&&g.stop();g.data("timer")&&null!=g.data("timer").hide&&clearTimeout(g.data("timer").hide);var h=g.closest("div.jqx-menu-popup"),k=d(c.element),l=0==c.level?this._getOffset(c.element):k.position();if(0<c.level&&this.hasTransform){var m=parseInt(k.coord().top)-parseInt(this._getOffset(c.element).top);l.top+=m}0==c.level&&"popup"==this.mode&&(l=k.coord());var p=0==c.level&&"horizontal"==this.mode;m=p?l.left:null!=this.menuElements[c.parentId]&&null!=this.menuElements[c.parentId].subMenuElement?
            parseInt(d(d(this.menuElements[c.parentId].subMenuElement).closest("div.jqx-menu-popup")).outerWidth())-e[0]:parseInt(g.outerWidth());h.css({visibility:"visible",display:"block",left:m,top:p?l.top+k.outerHeight():l.top,zIndex:f});g.css("display","block");"horizontal"!=this.mode&&0==c.level?(m=this._getOffset(this.element),h.css("left",-1+m.left+this.host.outerWidth()),g.css("left",-g.outerWidth())):(m=this._getClosedSubMenuOffset(c),g.css("left",m.left),g.css("top",m.top));h.css({height:parseInt(g.outerHeight())+
                parseInt(e[1])+"px"});var r=0,t=0;switch(c.openVerticalDirection){case "up":p?(g.css("top",g.outerHeight()),r=e[1],m=parseInt(g.parent().css("padding-bottom")),isNaN(m)&&(m=0),0<m&&h.addClass(this.toThemeProperty("jqx-menu-popup-clear")),g.css("top",g.outerHeight()-m),h.css({display:"block",top:l.top-h.outerHeight(),zIndex:f})):(r=e[1],g.css("top",g.outerHeight()),h.css({display:"block",top:l.top-h.outerHeight()+e[1]+k.outerHeight(),zIndex:f}));break;case "center":p?(g.css("top",0),h.css({display:"block",
            top:l.top-h.outerHeight()/2+e[1],zIndex:f})):(g.css("top",0),h.css({display:"block",top:l.top+k.outerHeight()/2-h.outerHeight()/2+e[1],zIndex:f}))}switch(c.openHorizontalDirection){case this._getDir("left"):p?h.css({left:l.left-(h.outerWidth()-k.outerWidth()-e[0])}):(t=0,g.css("left",h.outerWidth()),h.css({left:l.left-h.outerWidth()+2*c.level}));break;case "center":p?h.css({left:l.left-(h.outerWidth()/2-k.outerWidth()/2-e[0]/2)}):(h.css({left:l.left-(h.outerWidth()/2-k.outerWidth()/2-e[0]/2)}),g.css("left",
            h.outerWidth()))}if(p){if(parseInt(g.css("top"))==r){c.isOpen=!0;return}}else if(parseInt(g.css("left"))==t){1==c.isOpen;return}d.each(b._getSiblings(c),function(){b._closeItem(b,this,!0,!0)});f=d.data(b.element,"animationHideDelay");b.animationHideDelay=f;0<this.autoCloseInterval&&(null!=this.host.data("autoclose")&&null!=this.host.data("autoclose").close&&clearTimeout(this.host.data("autoclose").close),null!=this.host.data("autoclose")&&(this.host.data("autoclose").close=setTimeout(function(){b._closeAll()},
            this.autoCloseInterval)));g.data("timer")&&(g.data("timer").show=setTimeout(function(){if(null!=h)if(p){g.stop();g.css("left",t);k.addClass(b.toThemeProperty("jqx-fill-state-pressed"));k.addClass(b.toThemeProperty("jqx-menu-item-top-selected"));"down"==c.openVerticalDirection?(d(c.element).addClass(b.toThemeProperty("jqx-rc-b-expanded")),h.addClass(b.toThemeProperty("jqx-rc-t-expanded"))):(d(c.element).addClass(b.toThemeProperty("jqx-rc-t-expanded")),h.addClass(b.toThemeProperty("jqx-rc-b-expanded")));
                var e=d(c.arrow);0<e.length&&b.showTopLevelArrows&&(e.removeClass(),"down"==c.openVerticalDirection?(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-down-selected")),e.addClass(b.toThemeProperty("jqx-icon-arrow-down"))):(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-up-selected")),e.addClass(b.toThemeProperty("jqx-icon-arrow-up"))));0==b.animationShowDuration?(g.css({top:r}),c.isOpen=!0,b._raiseEvent("0",c),d.jqx.aria(d(c.element),"aria-expanded",!0)):g.animate({top:r},b.animationShowDuration,
                b.easing,function(){c.isOpen=!0;d.jqx.aria(d(c.element),"aria-expanded",!0);b._raiseEvent("0",c)})}else g.stop(),g.css("top",r),0<c.level?(k.addClass(b.toThemeProperty("jqx-fill-state-pressed")),k.addClass(b.toThemeProperty("jqx-menu-item-selected"))):(k.addClass(b.toThemeProperty("jqx-fill-state-pressed")),k.addClass(b.toThemeProperty("jqx-menu-item-top-selected"))),e=d(c.arrow),0<e.length&&(e.removeClass(),"left"!=c.openHorizontalDirection?(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-"+b._getDir("right")+
            "-selected")),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+b._getDir("right")))):(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-"+b._getDir("left")+"-selected")),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+b._getDir("left"))))),0==b.animationShowDuration?(g.css({left:t}),b._raiseEvent("0",c),c.isOpen=!0,d.jqx.aria(d(c.element),"aria-expanded",!0)):g.animate({left:t},b.animationShowDuration,b.easing,function(){b._raiseEvent("0",c);c.isOpen=!0;d.jqx.aria(d(c.element),"aria-expanded",!0)})},
            this.animationShowDelay))},_getDir:function(b){switch(b){case "left":return this.rtl?"right":"left";case "right":return this.rtl?"left":"right"}return"left"},_applyOrientation:function(b,c){var e=this,f=0;e.host.removeClass(e.toThemeProperty("jqx-menu-horizontal"));e.host.removeClass(e.toThemeProperty("jqx-menu-vertical"));e.host.removeClass(e.toThemeProperty("jqx-menu"));e.host.removeClass(e.toThemeProperty("jqx-widget"));e.host.addClass(e.toThemeProperty("jqx-widget"));e.host.addClass(e.toThemeProperty("jqx-menu"));
        void 0!=b&&void 0!=c&&"popup"==c?0<e.host.parent().length&&0<e.host.parent().parent().length&&e.host.parent().parent()[0]==document.body&&(b=d.data(document.body,"jqxMenuOldHost"+e.element.id),null!=b&&(c=e.host.closest("div.jqx-menu-wrapper"),c.remove(),c.appendTo(b),e.host.css("display","block"),e.host.css("visibility","visible"),c.css("display","block"),c.css("visibility","visible"))):void 0==b&&void 0==c&&d.data(document.body,"jqxMenuOldHost"+e.element.id,e.host.parent()[0]);e.autoOpenPopup?"popup"==
        e.mode?(e.addHandler(d(document),"contextmenu."+e.element.id,function(b){return!1}),e.addHandler(d(document),"mousedown.menu"+e.element.id,function(b){e._openContextMenu(b)})):(e.removeHandler(d(document),"contextmenu."+e.element.id),e.removeHandler(d(document),"mousedown.menu"+e.element.id)):(e.removeHandler(d(document),"contextmenu."+e.element.id),e.removeHandler(d(document),"mousedown.menu"+e.element.id),e.addHandler(d(document),"contextmenu."+e.element.id,function(b){if(b.target&&b.target.className.indexOf&&
            0<=b.target.className.indexOf("jqx-menu"))return!1}));e.rtl&&e.host.addClass(e.toThemeProperty("jqx-rtl"));switch(e.mode){case "horizontal":e.host.addClass(e.toThemeProperty("jqx-widget-header"));e.host.addClass(e.toThemeProperty("jqx-menu-horizontal"));d.each(e.items,function(){var b=d(this.element),c=d(this.arrow);c.removeClass();this.hasItems&&0<this.level&&(c=d('<span style="border: none; background-color: transparent;" id="arrow'+b[0].id+'"></span>'),c.prependTo(b),c.css("float",e._getDir("right")),
            c.addClass(e.toThemeProperty("jqx-menu-item-arrow-"+e._getDir("right"))),c.addClass(e.toThemeProperty("jqx-icon-arrow-"+e._getDir("right"))),this.arrow=c[0]);if(0==this.level){d(this.element).css("float",e._getDir("left"));if(!this.ignoretheme&&this.hasItems&&e.showTopLevelArrows){c=d('<span style="border: none; background-color: transparent;" id="arrow'+b[0].id+'"></span>');var k=d.jqx.browser.msie&&8>d.jqx.browser.version;null==this.arrow?k?c.appendTo(b):c.prependTo(b):c=d(this.arrow);"down"==this.openVerticalDirection?
            (c.addClass(e.toThemeProperty("jqx-menu-item-arrow-down")),c.addClass(e.toThemeProperty("jqx-icon-arrow-down"))):(c.addClass(e.toThemeProperty("jqx-menu-item-arrow-up")),c.addClass(e.toThemeProperty("jqx-icon-arrow-up")));c.css("visibility","inherit");k?c.css("display","inline-block"):(c.css("display","block"),c.css("float","right"));this.arrow=c[0]}else this.ignoretheme||!this.hasItems||e.showTopLevelArrows||null==this.arrow||(c=d(this.arrow),c.remove(),this.arrow=null);f=Math.max(f,b.height())}});
            break;case "vertical":case "popup":case "simple":e.host.addClass(e.toThemeProperty("jqx-menu-vertical")),d.each(e.items,function(){var b=d(this.element);if(this.hasItems&&!this.ignoretheme){this.arrow&&d(this.arrow).remove();if("simple"==e.mode)return!0;var c=d('<span style="border: none; background-color: transparent;" id="arrow'+b[0].id+'"></span>');c.prependTo(b);c.css("float","right");0==this.level?c.addClass(e.toThemeProperty("jqx-menu-item-arrow-top-"+e._getDir("right"))):c.addClass(e.toThemeProperty("jqx-menu-item-arrow-"+
            e._getDir("right")));c.addClass(e.toThemeProperty("jqx-icon-arrow-"+e._getDir("right")));this.arrow=c[0]}b.css("float","none")}),"popup"==e.mode?(e.host.addClass(e.toThemeProperty("jqx-widget-content")),e.host.wrap('<div tabindex=0 class="jqx-menu-wrapper" style="z-index:'+e.popupZIndex+'; border: none; background-color: transparent; padding: 0px; margin: 0px; position: absolute; top: 0; left: 0; display: block; visibility: visible;"></div>'),c=e.host.closest("div.jqx-menu-wrapper"),e.host.addClass(e.toThemeProperty("jqx-popup")),
            c[0].id="menuWrapper"+e.element.id,c.appendTo(d(document.body)),e.addHandler(c,"keydown",function(b){return e.handleKeyDown(b)})):e.host.addClass(e.toThemeProperty("jqx-widget-header")),"popup"==e.mode&&(b=e.host.height(),e.host.css("position","absolute"),e.host.css("top","0"),e.host.css("left","0"),"simple"!=e.mode&&(e.host.height(b),e.host.css("display","none")))}b=e.isTouchDevice();e.autoCloseOnClick&&(e.removeHandler(d(document),"mousedown.menu"+e.element.id,e._closeAfterClick),e.addHandler(d(document),
            "mousedown.menu"+e.element.id,e._closeAfterClick,e),b&&(e.removeHandler(d(document),d.jqx.mobile.getTouchEventName("touchstart")+".menu"+e.element.id,e._closeAfterClick,e),e.addHandler(d(document),d.jqx.mobile.getTouchEventName("touchstart")+".menu"+e.element.id,e._closeAfterClick,e)))},_getBodyOffset:function(){var b=0,c=0;"0px"!=d("body").css("border-top-width")&&(b=parseInt(d("body").css("border-top-width")),isNaN(b)&&(b=0));"0px"!=d("body").css("border-left-width")&&(c=parseInt(d("body").css("border-left-width")),
    isNaN(c)&&(c=0));return{left:c,top:b}},_getOffset:function(b){var c=d.jqx.mobile.isSafariMobileBrowser(),e=d(b).coord(!0),f=e.top;e=e.left;"0px"!=d("body").css("border-top-width")&&(f=parseInt(f)+this._getBodyOffset().top);"0px"!=d("body").css("border-left-width")&&(e=parseInt(e)+this._getBodyOffset().left);var g=d.jqx.mobile.isWindowsPhone(),h=d.jqx.mobile.isTouchDevice();return this.hasTransform||null!=c&&c||g||h?{left:d.jqx.mobile.getLeftPos(b),top:d.jqx.mobile.getTopPos(b)}:{left:e,top:f}},_isRightClick:function(b){var c;
        b||(b=window.event);b.which?c=3==b.which:b.button&&(c=2==b.button);return c},_openContextMenu:function(b){this._isRightClick(b)&&this.open(parseInt(b.clientX)+5,parseInt(b.clientY)+5)},close:function(){var b=this;d.data(this.element,"contextMenuOpened"+this.element.id)&&(d.each(b.items,function(){this.hasItems&&b._closeItem(b,this)}),d.each(b.items,function(){1==this.isOpen&&d(this.subMenuElement).closest("div.jqx-menu-popup").hide(this.animationHideDuration)}),this.host.hide(this.animationHideDuration),
        d.data(b.element,"contextMenuOpened"+this.element.id,!1),b._raiseEvent("1",b),b._raiseEvent("5"))},open:function(b,c){if("popup"==this.mode){var e=0;"block"==this.host.css("display")&&(this.close(),e=this.animationHideDuration);var f=this;if(void 0==b||null==b)b=0;if(void 0==c||null==c)c=0;setTimeout(function(){f.host.show(f.animationShowDuration);f.host.css("visibility","visible");d.data(f.element,"contextMenuOpened"+f.element.id,!0);f._raiseEvent("0",f);f._raiseEvent("4",{left:b,top:c});f.host.css("z-index",
        f.popupZIndex);void 0!=b&&void 0!=c&&f.host.css({left:b,top:c});f.focus()},e)}},_renderHover:function(b,c,e){var f=this;c.ignoretheme||(this.addHandler(b,"mouseenter",function(){f.hoveredItem=c;c.disabled||c.separator||!f.enableHover||f.disabled||(0<c.level?(b.addClass(f.toThemeProperty("jqx-fill-state-hover")),b.addClass(f.toThemeProperty("jqx-menu-item-hover"))):(b.addClass(f.toThemeProperty("jqx-fill-state-hover")),b.addClass(f.toThemeProperty("jqx-menu-item-top-hover"))))}),this.addHandler(b,
        "mouseleave",function(){c.disabled||c.separator||!f.enableHover||f.disabled||(0<c.level?(b.removeClass(f.toThemeProperty("jqx-fill-state-hover")),b.removeClass(f.toThemeProperty("jqx-menu-item-hover"))):(b.removeClass(f.toThemeProperty("jqx-fill-state-hover")),b.removeClass(f.toThemeProperty("jqx-menu-item-top-hover"))))}))},_closeAfterClick:function(b){var c=null!=b?b.data:this,e=!1;c.autoCloseOnClick&&(d.each(d(b.target).parents(),function(){if(this.className.indexOf&&-1!=this.className.indexOf("jqx-menu"))return e=
        !0,!1}),e||(b.data=c,c._closeAll(b)))},_autoSizeHorizontalMenuItems:function(){var b=this;if(b.autoSizeMainItems&&"horizontal"==this.mode){var c=this.maxHeight;parseInt(c)>parseInt(this.host.height())&&(c=parseInt(this.host.height()));c=parseInt(this.host.height());d.each(this.items,function(){var e=d(this.element);if(0==this.level&&0<c){var f=0<e.children().length?parseInt(e.children().height()):e.height(),g=b.host.find("ul:first"),h=parseInt(g.css("padding-top"));g=parseInt(g.css("margin-top"));
        h=c-2*(g+h);g=parseInt(h)/2-f/2;f=parseInt(g);g=parseInt(g);e.css("padding-top",f);e.css("padding-bottom",g);parseInt(e.outerHeight())>h&&e.css("padding-top",f-1)}})}d.each(this.items,function(){d(this.element);if(this.hasItems&&0<this.level&&this.arrow){var b=d(this.arrow),c=d(this.element).height();15<c&&b.css("margin-top",(c-15)/2)}})},_nextVisibleItem:function(b,c){if(null==b||void 0==b)return null;for(;null!=b;)if(b=b.nextItem,this._isVisible(b)&&!b.disabled&&"separator"!==b.type&&(this.minimized||
        void 0==c||!b||b.level==c))return b;return null},_prevVisibleItem:function(b,c){if(null==b||void 0==b)return null;for(;null!=b;)if(b=b.prevItem,this._isVisible(b)&&!b.disabled&&"separator"!==b.type&&(this.minimized||void 0==c||!b||b.level==c))return b;return null},_parentItem:function(b){if(null==b||void 0==b)return null;var c=b.parentElement;if(!c)return null;var e=null;d.each(this.items,function(){if(this.element==c)return e=this,!1});return e},_isElementVisible:function(b){return null==b?!1:"none"!=
    d(b).css("display")&&"hidden"!=d(b).css("visibility")?!0:!1},_isVisible:function(b){if(null==b||void 0==b||!this._isElementVisible(b.element))return!1;b=this._parentItem(b);if(null==b||this.minimized)return!0;if(null!=b)if(this._isElementVisible(b.element)&&(b.isOpen||this.minimized))for(;null!=b;){if(b=this._parentItem(b),null!=b&&!this._isElementVisible(b.element)||null!=b&&!b.isOpen)return!1}else return!1;return!0},_render:function(b,c){this.disabled&&(this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled")),
        this.host.addClass(this.toThemeProperty("jqx-menu-disabled")));void 0==this.host.attr("tabindex")&&this.host.attr("tabindex",0);var e=this.popupZIndex,f=[5,5],g=this;d.data(g.element,"animationHideDelay",g.animationHideDelay);var h=this.isTouchDevice(),k=h&&(d.jqx.mobile.isWindowsPhone()||0<=navigator.userAgent.indexOf("Touch"));-1!=navigator.platform.toLowerCase().indexOf("win")&&(0<=navigator.userAgent.indexOf("Windows Phone")||0<=navigator.userAgent.indexOf("WPDesktop")||0<=navigator.userAgent.indexOf("IEMobile")||
    0<=navigator.userAgent.indexOf("ZuneWP7")?this.touchDevice=!0:0<=navigator.userAgent.indexOf("Touch")&&("MSPointerDown"in window||d.jqx.mobile.isWindowsPhone()||0<=navigator.userAgent.indexOf("ARM"))&&(k=!0,g.clickToOpen=!0,g.autoCloseOnClick=!1,g.enableHover=!1));d.data(document.body,"menuel",this);this.hasTransform=d.jqx.utilities.hasTransform(this.host);this._applyOrientation(b,c);this.removeHandler(this.host,"blur");this.removeHandler(this.host,"focus");this.addHandler(this.host,"blur",function(b){!g.keyboardNavigation||
    !g.activeItem||"popup"===g.mode&&document.activeElement&&0<=document.activeElement.className.indexOf("jqx-menu-wrapper")||(d(g.activeItem.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=null)});this.addHandler(this.host,"focus",function(b){g.keyboardNavigation&&!g.activeItem&&(g.hoveredItem?(d(g.hoveredItem.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=g.hoveredItem):(b=function(){if(d.jqx.isHidden(d(g.items[0].element))){var b=g._nextVisibleItem(g.items[0],
        0);b&&(d(b.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=b)}else d(g.items[0].element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=g.items[0]},g.activeItem?d.jqx.isHidden(d(g.activeItem.element))?(d(g.activeItem.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),b()):d(g.activeItem.element).addClass(g.toThemeProperty("jqx-fill-state-focus")):b()))});this.removeHandler(this.host,"keydown.menu"+this.element.id);g.handleKeyDown=function(b){if(g.keyboardNavigation){if("input"===
        b.target.nodeName.toLowerCase())return!0;var e=null,c=null;d.each(g.items,function(){if(this.disabled)return!0;0<=this.element.className.indexOf("pressed")&&(c=this);if(0<=this.element.className.indexOf("focus"))return e=this,!1});if(!e&&c)return e=c,!1;if(!e)return d(g.items[0].element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=g.items[0],e=g.activeItem,!1;if(27==b.keyCode&&(b.data=g,g._closeAll(b),e))for(var f=e;null!=f;)f.parentItem||(d(g.activeItem.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),
        g.activeItem=f,d(g.activeItem.element).addClass(g.toThemeProperty("jqx-fill-state-focus"))),f=f.parentItem;if(13==b.keyCode&&e){g._raiseEvent("2",{item:e.element,event:b,type:"keyboard"});var h=null!=e.anchor?d(e.anchor):null;null!=h&&0<h.length&&(f=h.attr("href"),h=h.attr("target"),null!=f&&(null!=h?window.open(f,h):window.location=f));b.preventDefault();b.stopPropagation();d(e.element).focus()}h=function(b){if(null==b)return[];for(var e=[],c=0,f=0;f<g.items.length;f++)g.items[f].parentId==b.parentId&&
    (e[c++]=g.items[f]);return e};var k="";switch(b.keyCode){case 40:k="down";break;case 38:k="up";break;case 39:k="right";break;case 37:k="left"}e&&"left"===e.openHorizontalDirection&&"left"===k&&(k="right");e&&"left"===e.openHorizontalDirection&&"right"===k&&(k="left");e&&"top"===e.openVerticalDirection&&"top"===k&&(k="bottom");e&&"top"===e.openVerticalDirection&&"bottom"===k&&(k="top");g.rtl&&("right"===k?k="left":"left"===k&&(k="right"));if("right"===k&&!g.minimized){if(b.altKey&&(0!=e.level&&e.hasItems||
        "horizontal"!=g.mode))g._openItem(g,e);else{var q=g._nextVisibleItem(e,0),l=g._nextVisibleItem(e);f=h(l);q||(q=l);q&&(q.parentId===e.parentId&&0==q.level&&"horizontal"==g.mode||l.id==f[0].id&&0!=l.level)&&(l.id==f[0].id&&(0!=e.level||0==e.level&&"horizontal"!=g.mode)&&(q=l),d(q.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=q)}b.preventDefault();b.stopPropagation()}"left"!==k||g.minimized||(b.altKey&&(0!=
        e.level&&"horizontal"!==g.mode||1<e.level&&"horizontal"===g.mode||1==e.level&&e.hasItems&&"horizontal"===g.mode)?e.hasItems?g._closeItem(g,e):e.parentItem&&(g._closeItem(g,e.parentItem),d(e.parentItem.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=e.parentItem):(q=g._prevVisibleItem(e,0),f=e.parentItem,q&&q.parentId===e.parentId&&0==q.level&&"horizontal"==g.mode?(d(q.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),
        d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=q):f&&0==f.level&&"horizontal"==g.mode||!f||f.level!=e.level-1||(d(f.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=f)),b.preventDefault(),b.stopPropagation());if("down"===k)b.altKey?(0==e.level&&e.hasItems&&g._openItem(g,e),g.minimized&&g.minimizedHidden&&g.minimizedItem.trigger("click")):(q=g._nextVisibleItem(e,e.level),f=
        h(q),g.minimized&&q?(d(q.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=q):(!q||q.parentId!==e.parentId&&(q.id!=f[0].id||"horizontal"!=g.mode)||0==q.level&&"horizontal"==g.mode||(d(q.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=q),"horizontal"===g.mode&&0===e.level&&e.isOpen&&e.hasItems&&(q=g._nextVisibleItem(e),
        d(q.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=q))),b.preventDefault(),b.stopPropagation();else if("up"===k){if(b.altKey)e.parentItem&&0==e.parentItem.level?(g._closeItem(g,e.parentItem),d(e.parentItem.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=e.parentItem):null===e.parentItem&&0===e.level&&"horizontal"===
        g.mode&&g._closeItem(g,e),g.minimized&&(g.minimizedHidden||g.minimizedItem.trigger("click"));else if(q=g._prevVisibleItem(e,e.level),f=h(e),g.minimized&&q)d(q.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=q;else if(q&&(q.parentId===e.parentId||q.id==e.parentId&&0==q.level&&"horizontal"==g.mode)){if(0!=q.level||"horizontal"!==g.mode||0!==e.level)d(q.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),
        d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=q}else e&&e.id==f[0].id&&e.parentItem&&0===e.parentItem.level&&"horizontal"===g.mode&&(q=e.parentItem,d(q.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=q);b.preventDefault();b.stopPropagation()}if(9==b.keyCode)if(q=b.shiftKey?g._prevVisibleItem(e):g._nextVisibleItem(e))d(q.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),
        d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=q,b.preventDefault(),b.stopPropagation();else if(g.lockFocus){f=[];for(k=h=0;k<g.items.length;k++)g.items[k]!=e&&g.items[k].parentId==e.parentId&&(f[h++]=g.items[k]);0<f.length&&(b.shiftKey?(d(f[f.length-1].element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=f[f.length-1]):(d(f[0].element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=f[0]),d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")));
        b.preventDefault();b.stopPropagation()}else e&&(d(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=null)}else return!0};this.addHandler(this.host,"keydown.menu"+this.element.id,function(b){g.handleKeyDown(b)});g.enableRoundedCorners&&this.host.addClass(g.toThemeProperty("jqx-rc-all"));d.each(this.items,function(){var b=this,c=d(b.element);c.attr("role","menuitem");g.enableRoundedCorners&&c.addClass(g.toThemeProperty("jqx-rc-all"));g.removeHandler(c,"click");g.addHandler(c,
        "click",function(e){if(!b.disabled&&!g.disabled&&(g.keyboardNavigation&&(g.activeItem&&d(g.activeItem.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=b,d(b.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.minimized&&e.stopPropagation()),g._raiseEvent("2",{type:"mouse",item:b.element,event:e}),g.autoOpen?g.autoCloseOnClick&&!h&&!g.clickToOpen&&b.closeOnClick&&(e.data=g,g._closeAll(e)):0<b.level&&g.autoCloseOnClick&&!h&&!g.clickToOpen&&(e.data=g,g._closeAll(e)),
        h&&g.autoCloseOnClick&&(e.data=g,b.hasItems||g._closeAll(e)),"A"!=e.target.tagName&&"a"!=e.target.tagName)){var c=null!=b.anchor?d(b.anchor):null;null!=c&&0<c.length&&(e=c.attr("href"),c=c.attr("target"),null!=e&&(null!=c?window.open(e,c):window.location=e))}});g.removeHandler(c,"mouseenter");g.removeHandler(c,"mouseleave");k||"simple"==g.mode||g._renderHover(c,b,h);if(null!=b.subMenuElement){var p=d(b.subMenuElement);if("simple"==g.mode)return p.show(),!0;p.wrap('<div class="jqx-menu-popup '+g.toThemeProperty("jqx-menu-popup")+
        '" style="border: none; background-color: transparent; z-index:'+e+'; padding: 0px; margin: 0px; position: absolute; top: 0; left: 0; display: block; visibility: hidden;"><div style="background-color: transparent; border: none; position:absolute; overflow:hidden; left: 0; top: 0; right: 0; width: 100%; height: 100%;"></div></div>');p.css({overflow:"hidden",position:"absolute",left:0,display:"inherit",top:-p.outerHeight()});p.data("timer",{});0<b.level?p.css("left",-p.outerWidth()):"horizontal"==g.mode&&
        p.css("left",0);e++;var r=d(b.subMenuElement).closest("div.jqx-menu-popup").css({width:parseInt(d(b.subMenuElement).outerWidth())+parseInt(f[0])+"px",height:parseInt(d(b.subMenuElement).outerHeight())+parseInt(f[1])+"px"}),t=c.closest("div.jqx-menu-popup");if(0<t.length){var w=p.css("margin-left"),q=p.css("margin-right"),u=p.css("padding-left"),y=p.css("padding-right");r.appendTo(t)}else w=p.css("margin-left"),q=p.css("margin-right"),u=p.css("padding-left"),y=p.css("padding-right"),r.appendTo(d(document.body));
        p.css("margin-left",w);p.css("margin-right",q);p.css("padding-left",u);p.css("padding-right",y);if(g.clickToOpen)g.removeHandler(c,"mousedown"),g.addHandler(c,"mousedown",function(e){clearTimeout(p.data("timer").hide);null!=p&&p.stop();0!=b.level||b.isOpen||(e.data=g,g._closeAll(e));b.isOpen?g._closeItem(g,b,!0):g._openItem(g,b)});else{if(h||k)g.removeHandler(c,d.jqx.mobile.getTouchEventName("touchstart")),g.addHandler(c,d.jqx.mobile.getTouchEventName("touchstart"),function(e){clearTimeout(p.data("timer").hide);
            null!=p&&p.stop();0!=b.level||b.isOpen||"popup"==g.mode||(e.data=g,g._closeAll(e));b.isOpen?g._closeItem(g,b,!0):g._openItem(g,b);return!1});k||(g.addHandler(c,"mouseenter",function(){(g.autoOpen||0<b.level&&!g.autoOpen)&&clearTimeout(p.data("timer").hide);if(!b.parentId||0==b.parentId||!g.menuElements[b.parentId]||g.menuElements[b.parentId].isOpen)return(g.autoOpen||0<b.level&&!g.autoOpen)&&g._openItem(g,b),!1}),g.addHandler(c,"mousedown",function(){g.autoOpen||0!=b.level||(clearTimeout(p.data("timer").hide),
        null!=p&&p.stop(),b.isOpen?g._closeItem(g,b,!0):g._openItem(g,b))}),g.addHandler(c,"mouseleave",function(e){if(g.autoCloseOnMouseLeave){clearTimeout(p.data("timer").hide);var c=d(b.subMenuElement),f=parseInt(e.pageX);e=parseInt(e.pageY);var h=parseInt(c.coord().left),k=parseInt(c.coord().top),q=parseInt(c.outerWidth());c=parseInt(c.outerHeight());var l=!0;h-5<=f&&f<=h+q+5&&k<=e&&e<=k+c&&(l=!1);l&&g._closeItem(g,b,!0)}}),g.removeHandler(r,"mouseenter"),g.addHandler(r,"mouseenter",function(){clearTimeout(p.data("timer").hide)}),
            g.removeHandler(r,"mouseleave"),g.addHandler(r,"mouseleave",function(e){g.autoCloseOnMouseLeave&&(clearTimeout(p.data("timer").hide),clearTimeout(p.data("timer").show),null!=p&&p.stop(),g._closeItem(g,b,!0))}))}}});"simple"==this.mode&&this._renderSimpleMode();this._autoSizeHorizontalMenuItems();this._raiseEvent("3",this)},_renderSimpleMode:function(){this.host.show()},createID:function(){var b=Math.random()+"";b=b.replace(".","");for(b=("99"+b)/1;this.items[b];)b=Math.random()+"",b=b.replace(".",
        ""),b/=1;return"menuItem"+b},_createMenu:function(b,c){if(null!=b){void 0==c&&(c=!0);null==c&&(c=!0);d(b).addClass("jqx-menu-ul");b=d(b).find("li");var e=0;this.itemMapping=[];for(var f=0;f<b.length;f++){var g=b[f],h=d(g);if(-1!=g.className.indexOf("jqx-menu")||0!=this.autoGenerate){var k=g.id;k||(k=this.createID());c&&(g.id=k,this.items[e]=new d.jqx._jqxMenu.jqxMenuItem,this.menuElements[k]=this.items[e]);e+=1;var l=0,m=this;h.children().each(function(){c||(this.className="",m.autoGenerate&&(d(m.items[e-
    1].subMenuElement)[0].className="",m.minimized||d(m.items[e-1].subMenuElement).addClass(m.toThemeProperty("jqx-widget-content")),d(m.items[e-1].subMenuElement).addClass(m.toThemeProperty("jqx-menu-dropdown")),d(m.items[e-1].subMenuElement).addClass(m.toThemeProperty("jqx-popup"))));if(-1!=this.className.indexOf("jqx-menu-dropdown"))return c&&(m.items[e-1].subMenuElement=this),!1;if(m.autoGenerate&&("ul"==this.tagName||"UL"==this.tagName))return c&&(m.items[e-1].subMenuElement=this),this.className=
        "",m.minimized||d(this).addClass(m.toThemeProperty("jqx-widget-content")),d(this).addClass(m.toThemeProperty("jqx-menu-dropdown")),d(this).addClass(m.toThemeProperty("jqx-popup")),d(this).attr("role","menu"),m.rtl?d(this).addClass(m.toThemeProperty("jqx-rc-l")):d(this).addClass(m.toThemeProperty("jqx-rc-r")),d(this).addClass(m.toThemeProperty("jqx-rc-b")),!1});h.parents().each(function(){if(-1!=this.className.indexOf("jqx-menu-item")||m.autoGenerate&&("li"==this.tagName||"LI"==this.tagName))return l=
        this.id,!1});var p=!1,r=g.getAttribute("type"),t=g.getAttribute("ignoretheme")||g.getAttribute("data-ignoretheme");if(t){if("true"==t||1==t)t=!0}else t=!1;r?"separator"==r&&(p=!0):r=g.type;p||(r=l?"sub":"top");var w=this.items[e-1];c&&(w.id=k,w.parentId=l,w.type=r,w.separator=p,w.element=b[f],k=h.children("a"),w.disabled="true"==g.getAttribute("item-disabled")?!0:!1,w.level=h.parents("li").length,w.anchor=0<k.length?k:null,w.anchor&&d(w.anchor).attr("tabindex",-1));w.ignoretheme=t;g=this.menuElements[l];
        null!=g&&(g.ignoretheme&&(t=w.ignoretheme=g.ignoretheme),w.parentItem=g,w.parentElement=g.element);this.autoGenerate&&("separator"==r?(h.removeClass(),h.addClass(this.toThemeProperty("jqx-menu-item-separator")),h.attr("role","separator")):t||(0<=h[0].className.indexOf("jqx-grid-menu-item-touch")?h[0].className=this.toThemeProperty("jqx-grid-menu-item-touch"):h[0].className="",this.rtl&&h.addClass(this.toThemeProperty("jqx-rtl")),0<w.level&&!m.minimized?(h.addClass(this.toThemeProperty("jqx-item")),
            h.addClass(this.toThemeProperty("jqx-menu-item"))):(h.addClass(this.toThemeProperty("jqx-item")),h.addClass(this.toThemeProperty("jqx-menu-item-top")))));w.disabled&&(h.addClass(m.toThemeProperty("jqx-menu-item-disabled")),h.addClass(m.toThemeProperty("jqx-fill-state-disabled")));this.itemMapping[f]={element:b[f],item:w};this.itemMapping["id"+b[f].id]=this.itemMapping[f];c&&!t&&(w.hasItems=0<h.find("li").length,w.hasItems&&w.element&&(d.jqx.aria(d(w.element),"aria-haspopup",!0),w.subMenuElement.id||
        (w.subMenuElement.id=d.jqx.utilities.createId()),d.jqx.aria(d(w.element),"aria-owns",w.subMenuElement.id)))}}for(f=0;f<b.length;f++)if(w=b[f],this.itemMapping["id"+w.id]&&(w=this.itemMapping["id"+w.id].item))w.prevItem=null,w.nextItem=null,0<f&&this.itemMapping["id"+b[f-1].id]&&(w.prevItem=this.itemMapping["id"+b[f-1].id].item),f<b.length-1&&this.itemMapping["id"+b[f+1].id]&&(w.nextItem=this.itemMapping["id"+b[f+1].id].item)}},destroy:function(){var b=this;d.jqx.utilities.resize(b.host,null,!0);var c=
        b.host.closest("div.jqx-menu-wrapper");b.removeHandler(c,"keydown");c.remove();b.removeHandler(d("#menuWrapper"+b.element.id),"keydown");d("#menuWrapper"+b.element.id).remove();b.removeHandler(b.host,"keydown");b.removeHandler(b.host,"focus");b.removeHandler(b.host,"blur");b.removeHandler(d(document),"mousedown.menu"+b.element.id,b._closeAfterClick);b.removeHandler(d(document),"mouseup.menu"+b.element.id,b._closeAfterClick);b.removeHandler(d(document),"contextmenu."+b.element.id);b.removeHandler(b.host,
        "contextmenu."+b.element.id);d.data(document.body,"jqxMenuOldHost"+b.element.id,null);b.isTouchDevice()&&b.removeHandler(d(document),d.jqx.mobile.getTouchEventName("touchstart")+".menu"+b.element.id,b._closeAfterClick,this);d(window).off&&d(window).off("resize.menu"+b.element.id);d.each(b.items,function(){var e=d(this.element);b.removeHandler(e,"click");b.removeHandler(e,"selectstart");b.removeHandler(e,"mouseenter");b.removeHandler(e,"mouseleave");b.removeHandler(e,"mousedown");b.removeHandler(e,
        "mouseleave");d(this.subMenuElement).closest("div.jqx-menu-popup").remove();delete this.subMenuElement;delete this.element});d.data(document.body,"menuel",null);delete b.menuElements;b.items=[];delete b.items;(c=d.data(b.element,"jqxMenu"))&&delete c.instance;b.host.removeClass();b.host.remove();delete b.host;delete b.element},_raiseEvent:function(b,c){void 0==c&&(c={owner:null});var e=this.events[b],f=c;f.owner=this;e=new d.Event(e);"2"==b&&(f=c.item,f.owner=this,f.clickType=c.type,d.extend(e,c.event),
        e.type="itemclick");e.owner=this;e.args=f;return this.host.trigger(e)},propertiesChangedHandler:function(b,c,e){e.width&&e.height&&2==Object.keys(e).length&&(b._setSize(),"popup"===b.mode&&(this.host.closest("div.jqx-menu-wrapper")[c](e),d("#"+this.host[0].id)[c](e)))},propertyChangedHandler:function(b,c,e,f){if(void 0!=this.isInitialized&&0!=this.isInitialized&&!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length)&&("disabled"==c&&(b.disabled?(b.host.addClass(b.toThemeProperty("jqx-fill-state-disabled")),
        b.host.addClass(b.toThemeProperty("jqx-menu-disabled"))):(b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")),b.host.removeClass(b.toThemeProperty("jqx-menu-disabled")))),f!=e))if("touchMode"==c&&(this._isTouchDevice=null,b._render(f,e)),"width"===c||"height"===c)b._setSize(),"popup"===b.mode&&(this.host.closest("div.jqx-menu-wrapper")[c](f),d("#"+this.host[0].id)[c](f));else{if("source"==c&&null!=b.source){var g=b.loadItems(b.source);b.element.innerHTML=g;g=b.host.find("ul:first");0<
    g.length&&(b.refresh(),b._createMenu(g[0]),b._render())}"autoCloseOnClick"==c?0==f?b.removeHandler(d(document),"mousedown.menu"+this.element.id,b._closeAll):b.addHandler(d(document),"mousedown.menu"+this.element.id,b,b._closeAll):"mode"==c||"width"==c||"height"==c||"showTopLevelArrows"==c?(b.refresh(),"mode"==c?b._render(f,e):b._applyOrientation()):"theme"==c&&d.jqx.utilities.setTheme(e,f,b.host)}}})})(jqxBaseFramework);
(function(d){d.jqx._jqxMenu.jqxMenuItem=function(b,c,e){return{id:b,parentId:c,parentItem:null,anchor:null,type:e,disabled:!1,level:0,isOpen:!1,hasItems:!1,element:null,subMenuElement:null,arrow:null,openHorizontalDirection:"right",openVerticalDirection:"down",closeOnClick:!0}}})(jqxBaseFramework);
(function(d){function b(b,c){this.owner=b;this.displayfield=this.datafield=null;this.text="";this.createfilterpanel=null;this.editable=this.hideable=this.sortable=!0;this.adaptivehidden=this.hidden=!1;this.groupable=!0;this.checkchange=this.cellsrenderer=this.renderer=null;this.threestatecheckbox=!1;this.columntype=this.buttonclick=null;this.cellsformat="";this.cellsalign=this.align="left";this.width="auto";this.minwidth=25;this.maxwidth="auto";this.pinned=!1;this.visibleindex=-1;this.filterable=
    !0;this.filter=null;this.filteritems=[];this.resizable=!0;this.validation=this.geteditorvalue=this.destroyeditor=this.destroywidget=this.initwidget=this.createwidget=this.createeditor=this.initeditor=null;this.cellclassname=this.classname="";this.aggregatesrenderer=this.aggregates=this.cellvaluechanging=this.cellbeginedit=this.cellendedit=null;this.menu=!0;this.createfilterwidget=null;this.filtertype="default";this.rendered=this.filtercondition=null;this.exportable=!0;this.exporting=!1;this.clipboard=
    this.nullable=this.draggable=!0;this.selectable=!1;this._applyStyle=function(){this.hovered?(this.style.headerBackgroundHoveredColor&&(this.element.style.backgroundColor=this.style.headerBackgroundHoveredColor),this.style.headerHoveredColor&&(this.element.style.color=this.style.headerHoveredColor)):this.selected?(this.style.headerBackgroundSelectedColor&&(this.element.style.backgroundColor=this.style.headerBackgroundSelectedColor),this.style.headerSelectedColor&&(this.element.style.color=this.style.headerSelectedColor)):
    (this.element.style.backgroundColor=this.style.headerBackgroundColor?this.style.headerBackgroundColor:"",this.element.style.color=this.style.headerColor?this.style.headerColor:"")};this._applyCellStyle=function(b){var e=!1;if(b.length)for(e=0;e<b.length;e++)this._applyCellStyle(b[e]);else{if(this.style.backgroundColor||this.style.color||this.style.hoveredColor||this.style.hoveredColor||this.style.backgroundSelectedColor||this.style.selectedColor)e=!0;e&&(0<=b.className.indexOf("hover")?(this.style.backgroundHoveredColor&&
(b.style.backgroundColor=this.style.backgroundHoveredColor),this.style.hoveredColor&&(b.style.color=this.style.hoveredColor)):0<=b.className.indexOf("selected")?(this.style.backgroundSelectedColor&&(b.style.backgroundColor=this.style.backgroundSelectedColor),this.style.selectedColor&&(b.style.color=this.style.selectedColor)):(this.style.backgroundColor&&(b.style.backgroundColor=this.style.backgroundColor),this.style.color&&(b.style.color=this.style.color)))}};this.style={headerBackgroundColor:"",
    headerColor:"",headerBackgroundHoveredColor:"",headerHoveredColor:"",headerBackgroundSelectedColor:"",headerSelectedColor:"",backgroundColor:"",color:"",backgroundHoveredColor:"",hoveredColor:"",backgroundSelectedColor:"",selectedColor:""};this.enabletooltips=!0;this.columngroup=null;this.filterdelay=800;this.destroyeverpresentrowwidget=this.validateeverpresentrowwidgetvalue=this.initeverpresentrowwidget=this.createeverpresentrowwidget=this.geteverpresentrowwidgetvalue=this.reseteverpresentrowwidgetvalue=
    null;this.getcolumnproperties=function(){return{nullable:this.nullable,sortable:this.sortable,hideable:this.hideable,hidden:this.hidden,groupable:this.groupable,width:this.width,align:this.align,editable:this.editable,minwidth:this.minwidth,maxwidth:this.maxwidth,resizable:this.resizable,datafield:this.datafield,text:this.text,exportable:this.exportable,cellsalign:this.cellsalign,pinned:this.pinned,cellsformat:this.cellsformat,columntype:this.columntype,classname:this.classname,cellclassname:this.cellclassname,
    menu:this.menu}};this.setproperty=function(b,e){if(this[b]){var c=this[b];this[b]=e;this.owner._columnPropertyChanged(this,b,e,c)}else this[b.toLowerCase()]&&(c=this[b.toLowerCase()],this[b.toLowerCase()]=e,this.owner._columnPropertyChanged(this,b.toLowerCase(),e,c))};this._initfields=function(e){if(null!=e){var c=this.that;d.jqx.hasProperty(e,"dataField")&&(this.datafield=d.jqx.get(e,"dataField"));d.jqx.hasProperty(e,"selectable")&&(this.selectable=d.jqx.get(e,"selectable"));d.jqx.hasProperty(e,
    "displayField")?this.displayfield=d.jqx.get(e,"displayField"):this.displayfield=this.datafield;d.jqx.hasProperty(e,"enableTooltips")&&(this.enabletooltips=d.jqx.get(e,"enableTooltips"));d.jqx.hasProperty(e,"text")?this.text=d.jqx.get(e,"text"):this.text=this.displayfield;d.jqx.hasProperty(e,"style")&&(this.style=d.jqx.get(e,"style"));d.jqx.hasProperty(e,"createfilterpanel")&&(this.createfilterpanel=d.jqx.get(e,"createfilterpanel"));d.jqx.hasProperty(e,"sortable")&&(this.sortable=d.jqx.get(e,"sortable"));
    d.jqx.hasProperty(e,"hideable")&&(this.hideable=d.jqx.get(e,"hideable"));d.jqx.hasProperty(e,"hidden")&&(this.hidden=d.jqx.get(e,"hidden"));d.jqx.hasProperty(e,"adaptivehidden")&&(this.adaptivehidden=d.jqx.get(e,"adaptivehidden"));d.jqx.hasProperty(e,"groupable")&&(this.groupable=d.jqx.get(e,"groupable"));d.jqx.hasProperty(e,"renderer")&&(this.renderer=d.jqx.get(e,"renderer"));d.jqx.hasProperty(e,"align")&&(this.align=d.jqx.get(e,"align"));d.jqx.hasProperty(e,"cellsAlign")&&(this.cellsalign=d.jqx.get(e,
        "cellsAlign"));d.jqx.hasProperty(e,"clipboard")&&(this.clipboard=d.jqx.get(e,"clipboard"));d.jqx.hasProperty(e,"cellsFormat")&&(this.cellsformat=d.jqx.get(e,"cellsFormat"));d.jqx.hasProperty(e,"width")&&(this.width=d.jqx.get(e,"width"));d.jqx.hasProperty(e,"minWidth")&&(this.minwidth=parseInt(d.jqx.get(e,"minWidth")),isNaN(this.minwidth)&&(this.minwidth=25));d.jqx.hasProperty(e,"maxWidth")&&(this.maxwidth=parseInt(d.jqx.get(e,"maxWidth")),isNaN(this.maxwidth)&&(this.maxwidth="auto"));d.jqx.hasProperty(e,
        "cellsRenderer")?this.cellsrenderer=d.jqx.get(e,"cellsRenderer"):e.cellsRenderer&&(this.cellsrenderer=e.cellsRenderer);d.jqx.hasProperty(e,"columnType")&&(this.columntype=d.jqx.get(e,"columnType"));d.jqx.hasProperty(e,"checkChange")&&(this.checkchange=d.jqx.get(e,"checkChange"));d.jqx.hasProperty(e,"buttonClick")?this.buttonclick=d.jqx.get(e,"buttonClick"):e.buttonClick&&(this.buttonclick=e.buttonClick);d.jqx.hasProperty(e,"pinned")&&(this.pinned=d.jqx.get(e,"pinned"));d.jqx.hasProperty(e,"visibleIndex")&&
    (this.visibleindex=d.jqx.get(e,"visibleIndex"));d.jqx.hasProperty(e,"filterable")&&(this.filterable=d.jqx.get(e,"filterable"));d.jqx.hasProperty(e,"filter")&&(this.filter=d.jqx.get(e,"filter"));d.jqx.hasProperty(e,"resizable")&&(this.resizable=d.jqx.get(e,"resizable"));d.jqx.hasProperty(e,"editable")&&(this.editable=d.jqx.get(e,"editable"));d.jqx.hasProperty(e,"initEditor")?this.initeditor=d.jqx.get(e,"initEditor"):e.initEditor&&(this.initeditor=e.initEditor);d.jqx.hasProperty(e,"createEditor")?this.createeditor=
        d.jqx.get(e,"createEditor"):e.createEditor&&(this.createeditor=e.createEditor);d.jqx.hasProperty(e,"initWidget")?this.initwidget=d.jqx.get(e,"initWidget"):e.initWidget&&(this.initwidget=e.initWidget);d.jqx.hasProperty(e,"createWidget")?this.createwidget=d.jqx.get(e,"createWidget"):e.createWidget&&(this.createwidget=e.createWidget);d.jqx.hasProperty(e,"destroyWidget")?this.destroywidget=d.jqx.get(e,"destroyWidget"):e.destroyWidget&&(this.destroywidget=e.destroyWidget);d.jqx.hasProperty(e,"reseteverpresentrowwidgetvalue")||
    d.jqx.hasFunction(e,"reseteverpresentrowwidgetvalue")?this.reseteverpresentrowwidgetvalue=d.jqx.get(e,"reseteverpresentrowwidgetvalue"):e.resetEverPresentRowWidgetValue&&(this.reseteverpresentrowwidgetvalue=e.resetEverPresentRowWidgetValue);d.jqx.hasProperty(e,"geteverpresentrowwidgetvalue")||d.jqx.hasFunction(e,"geteverpresentrowwidgetvalue")?this.geteverpresentrowwidgetvalue=d.jqx.get(e,"geteverpresentrowwidgetvalue"):e.getEverPresentRowWidgetValue&&(this.geteverpresentrowwidgetvalue=e.getEverPresentRowWidgetValue);
    d.jqx.hasProperty(e,"createeverpresentrowwidget")||d.jqx.hasFunction(e,"createeverpresentrowwidget")?this.createeverpresentrowwidget=d.jqx.get(e,"createeverpresentrowwidget"):e.createEverPresentRowWidget&&(this.createeverpresentrowwidget=e.createEverPresentRowWidget);d.jqx.hasProperty(e,"initeverpresentrowwidget")||d.jqx.hasFunction(e,"initeverpresentrowwidget")?this.initeverpresentrowwidget=d.jqx.get(e,"initeverpresentrowwidget"):e.initEverPresentRowWidget&&(this.initeverpresentrowwidget=e.initEverPresentRowWidget);
    d.jqx.hasProperty(e,"validateeverpresentrowwidgetvalue")?this.validateeverpresentrowwidgetvalue=d.jqx.get(e,"validateeverpresentrowwidgetvalue"):e.validateEverPresentRowWidgetValue&&(this.validateeverpresentrowwidgetvalue=e.validateEverPresentRowWidgetValue);d.jqx.hasProperty(e,"destroyeverpresentrowwidget")||d.jqx.hasFunction(e,"destroyeverpresentrowwidget")?this.destroyeverpresentrowwidget=d.jqx.get(e,"destroyeverpresentrowwidget"):e.destroyEverPresentRowWidget&&(this.destroyEverPresentRowWidget=
        e.destroyEverPresentRowWidget);d.jqx.hasProperty(e,"destroyEditor")?this.destroyeditor=d.jqx.get(e,"destroyEditor"):e.destroyEditor&&(this.destroyeditor=e.destroyEditor);d.jqx.hasProperty(e,"getEditorValue")?this.geteditorvalue=d.jqx.get(e,"getEditorValue"):e.getEditorValue&&(this.geteditorvalue=e.getEditorValue);d.jqx.hasProperty(e,"validation")?this.validation=d.jqx.get(e,"validation"):e.validation&&(this.validation=e.validation);d.jqx.hasProperty(e,"cellBeginEdit")?this.cellbeginedit=d.jqx.get(e,
        "cellBeginEdit"):e.cellBeginEdit&&(this.cellbeginedit=e.cellBeginEdit);d.jqx.hasProperty(e,"cellEndEdit")?this.cellendedit=d.jqx.get(e,"cellEndEdit"):e.cellEndEdit&&(this.cellendedit=e.cellEndEdit);d.jqx.hasProperty(e,"className")&&(this.classname=d.jqx.get(e,"className"));d.jqx.hasProperty(e,"cellClassName")?this.cellclassname=d.jqx.get(e,"cellClassName"):e.cellClassName&&(this.cellclassname=e.cellClassName);d.jqx.hasProperty(e,"menu")&&(this.menu=d.jqx.get(e,"menu"));d.jqx.hasProperty(e,"aggregates")&&
    (this.aggregates=d.jqx.get(e,"aggregates"));d.jqx.hasProperty(e,"aggregatesRenderer")&&(this.aggregatesrenderer=d.jqx.get(e,"aggregatesRenderer"));d.jqx.hasProperty(e,"createFilterWidget")&&(this.createfilterwidget=d.jqx.get(e,"createFilterWidget"));d.jqx.hasProperty(e,"filterType")&&(this.filtertype=d.jqx.get(e,"filterType"));d.jqx.hasProperty(e,"filterDelay")&&(this.filterdelay=d.jqx.get(e,"filterDelay"));d.jqx.hasProperty(e,"rendered")&&(this.rendered=d.jqx.get(e,"rendered"));d.jqx.hasProperty(e,
        "exportable")&&(this.exportable=d.jqx.get(e,"exportable"));d.jqx.hasProperty(e,"filterItems")&&(this.filteritems=d.jqx.get(e,"filterItems"));d.jqx.hasProperty(e,"cellValueChanging")&&(this.cellvaluechanging=d.jqx.get(e,"cellValueChanging"));d.jqx.hasProperty(e,"draggable")&&(this.draggable=d.jqx.get(e,"draggable"));d.jqx.hasProperty(e,"filterCondition")&&(this.filtercondition=d.jqx.get(e,"filterCondition"));d.jqx.hasProperty(e,"threeStateCheckbox")&&(this.threestatecheckbox=d.jqx.get(e,"threeStateCheckbox"));
    d.jqx.hasProperty(e,"nullable")&&(this.nullable=d.jqx.get(e,"nullable"));d.jqx.hasProperty(e,"columnGroup")&&(this.columngroup=d.jqx.get(e,"columnGroup"));if(!e instanceof String&&"string"!=typeof e)for(var f in e)if(!c.hasOwnProperty(f)&&!c.hasOwnProperty(f.toLowerCase()))throw b.host.remove(),Error("jqxGrid: Invalid property name - "+f+".");}};this._initfields(c);return this}function c(b,c){this.setdata=function(b){null!=b&&(this.bounddata=b,this.boundindex=b.boundindex,this.visibleindex=b.visibleindex,
    this.group=b.group,this.parentbounddata=b.parentItem,this.uniqueid=b.uniqueid,this.level=b.level)};this.setdata(c);this.parentrow=null;this.subrows=[];this.owner=b;this.height=25;this.hidden=!1;this.rowdetails=null;this.rowdetailsheight=100;this.rowdetailshidden=!0;this.top=-1;this.setrowinfo=function(b){this.hidden=b.hidden;this.rowdetails=b.rowdetails;this.rowdetailsheight=b.rowdetailsheight;this.rowdetailshidden=!b.showdetails;this.height=b.height};return this}d.jqx.jqxWidget("jqxGrid","",{});
    d.extend(d.jqx._jqxGrid.prototype,{defineInstance:function(){var b={adaptive:!1,adaptivewidth:600,disabled:!1,width:600,height:400,pagerheight:40,groupsheaderheight:34,pagesize:10,pagesizeoptions:["5","10","20"],rowsheight:32,columnsheight:32,filterrowheight:36,groupindentwidth:30,rowdetails:!1,enablerowdetailsindent:!0,enablemousewheel:!0,initrowdetails:null,layoutrowdetails:null,editable:!1,editmode:"selectedcell",pageable:!1,pagermode:"default",pagerbuttonscount:5,groupable:!1,sortable:!1,sortmode:"one",
            filterable:!1,filtermode:"default",autoshowfiltericon:!0,showfiltercolumnbackground:!0,showpinnedcolumnbackground:!0,showsortcolumnbackground:!0,altrows:!1,altstart:1,altstep:1,showrowdetailscolumn:!0,showrowlines:!0,showcolumnlines:!0,showcolumnheaderlines:!0,showtoolbar:!1,toolbarheight:36,showstatusbar:!1,statusbarheight:36,enableellipsis:!0,groups:[],groupsrenderer:null,groupcolumnrenderer:null,groupsexpandedbydefault:!1,pagerrenderer:null,touchmode:"auto",columns:[],selectedrowindex:-1,selectedrowindexes:[],
            selectedcells:[],autobind:!0,selectedcell:null,tableZIndex:79,headerZIndex:29,updatefilterconditions:null,showgroupaggregates:!1,showaggregates:!1,showfilterrow:!1,showeverpresentrow:!1,everpresentrowposition:"top",everpresentrowactions:"add reset",everpresentrowactionsmode:"buttons",everpresentrowheight:30,autorowheight:!1,autokoupdates:!0,handlekeyboardnavigation:null,showsortmenuitems:!0,showfiltermenuitems:!0,showgroupmenuitems:!0,enablebrowserselection:!1,enablekeyboarddelete:!0,clipboard:!0,
            clipboardbegin:null,clipboardend:null,copytoclipboardwithheaders:!1,copytoclipboardhiddencolumns:!1,ready:null,updatefilterpanel:null,autogeneratecolumns:!1,rowdetailstemplate:null,scrollfeedback:null,rendertoolbar:null,renderstatusbar:null,rendered:null,multipleselectionbegins:null,columngroups:null,cellhover:null,source:{beforeprocessing:null,beforesend:null,loaderror:null,localdata:null,data:null,datatype:"array",datafields:[],url:"",root:"",record:"",id:"",totalrecords:0,recordstartindex:0,recordendindex:0,
                loadallrecords:!0,sortcolumn:null,sortdirection:null,sort:null,filter:null,sortcomparer:null},filter:null,dataview:null,updatedelay:null,autoheight:!1,autowidth:!1,showheader:!0,showgroupsheader:!0,closeablegroups:!0,scrollbarsize:d.jqx.utilities.scrollBarSize,touchscrollbarsize:d.jqx.utilities.touchScrollBarSize,scrollbarautoshow:d.jqx.utilities.scrollBarAutoShow,virtualmode:!1,sort:null,columnsmenu:!0,columnsresize:!1,columnsautoresize:!0,columnsreorder:!1,columnsmenuwidth:16,autoshowcolumnsmenubutton:!0,
            showcolumnsactionbutton:!1,popupwidth:"auto",popupheight:"auto",columnmenuopening:null,columnmenuclosing:null,sorttogglestates:2,rendergridrows:null,enableanimations:!0,enablecolumnsvirtualization:!0,enabletooltips:!1,selectionmode:"singlerow",enablehover:!0,loadingerrormessage:"The data is still loading. When the data binding is completed, the Grid raises the 'bindingcomplete' event. Call this function in the 'bindingcomplete' event handler.",verticalscrollbarstep:30,verticalscrollbarlargestep:400,
            horizontalscrollbarstep:10,horizontalscrollbarlargestep:50,keyboardnavigation:!0,keyboardmenunavigation:!0,touchModeStyle:"auto",autoshowloadelement:!0,showdefaultloadelement:!0,showemptyrow:!0,autosavestate:!1,autoloadstate:!1,_updating:!1,_pagescache:[],_pageviews:[],_cellscache:[],_rowdetailscache:[],_rowdetailselementscache:[],_requiresupdate:!1,_hasOpenedMenu:!1,scrollmode:"physical",deferreddatafields:null,localization:null,rtl:!1,menuitemsarray:[],charting:{appendTo:null,colorScheme:"scheme02",
                dialog:{header:"Data Visualization",height:400,width:400,position:"center",enabled:!0},ready:null,formatSettings:{}},events:"initialized rowClick rowSelect rowUnselect groupExpand groupCollapse sort columnClick cellClick pageChanged pageSizeChanged bindingComplete groupsChanged filter columnResized cellSelect cellUnselect cellBeginEdit cellEndEdit cellValueChanged rowExpand rowCollapse rowDoubleClick cellDoubleClick columnReordered pageChanging".split(" ")};if(this===d.jqx._jqxGrid.prototype)return b;
            d.extend(!0,this,b);return b},createInstance:function(b){this.that=this;this.pagesize=parseInt(this.pagesize);this.toolbarheight=parseInt(this.toolbarheight);this.columnsheight=parseInt(this.columnsheight);this.filterrowheight=parseInt(this.filterrowheight);this.statusbarheight=parseInt(this.statusbarheight);this.groupsheaderheight=parseInt(this.groupsheaderheight);this.detailsVisibility=[];this.savedArgs=b&&0<b.length?b[0]:null;b="<div class='jqx-clear jqx-border-reset jqx-overflow-hidden jqx-max-size jqx-position-relative'><div tabindex='1' class='jqx-clear jqx-max-size jqx-position-relative jqx-overflow-hidden jqx-background-reset' id='wrapper"+
            this.element.id+"'><div class='jqx-clear jqx-position-absolute' id='toolbar' style='visibility: hidden;'></div><div class='jqx-clear jqx-position-absolute' id='groupsheader' style='visibility: hidden;'></div><div class='jqx-clear jqx-overflow-hidden jqx-position-absolute jqx-border-reset jqx-background-reset' id='content"+this.element.id+"'></div><div class='jqx-clear jqx-position-absolute' id='verticalScrollBar"+this.element.id+"'></div><div class='jqx-clear jqx-position-absolute' id='horizontalScrollBar"+
            this.element.id+"'></div><div class='jqx-clear jqx-position-absolute jqx-border-reset' id='bottomRight'></div><div class='jqx-clear jqx-position-absolute' id='addrow'></div><div class='jqx-clear jqx-position-absolute' id='statusbar'></div><div class='jqx-clear jqx-position-absolute' id='pager' style='z-index: 20;'></div></div></div>";this.element.innerHTML="";if(this.source){if(!this.source.dataBind){if(!d.jqx.dataAdapter)throw Error("jqxGrid: Missing reference to jqxdata.js");this.source=new d.jqx.dataAdapter(this.source)}var e=
            this.source._source.datafields;e&&0<e.length&&(this.editmode=this.editmode.toLowerCase(),this.selectionmode=this.selectionmode.toLowerCase())}this.host.attr("role","grid");this.host.attr("align","left");this.element.innerHTML=b;this.host.addClass(this.toTP("jqx-grid"));this.host.addClass(this.toTP("jqx-reset"));this.host.addClass(this.toTP("jqx-rc-all"));this.host.addClass(this.toTP("jqx-widget"));this.host.addClass(this.toTP("jqx-widget-content"));this.wrapper=this.host.find("#wrapper"+this.element.id);
            this.content=this.host.find("#content"+this.element.id);this.content.addClass(this.toTP("jqx-reset"));b=this.host.find("#verticalScrollBar"+this.element.id);e=this.host.find("#horizontalScrollBar"+this.element.id);this.bottomRight=this.host.find("#bottomRight").addClass(this.toTP("jqx-grid-bottomright jqx-scrollbar-state-normal"));if(!b.jqxScrollBar)throw Error("jqxGrid: Missing reference to jqxscrollbar.js");this.editors=[];this.vScrollBar=b.jqxScrollBar({vertical:!0,rtl:this.rtl,touchMode:this.touchmode,
                step:this.verticalscrollbarstep,largestep:this.verticalscrollbarlargestep,theme:this.theme,_triggervaluechanged:!1});this.hScrollBar=e.jqxScrollBar({vertical:!1,rtl:this.rtl,touchMode:this.touchmode,step:this.horizontalscrollbarstep,largestep:this.horizontalscrollbarlargestep,theme:this.theme,_triggervaluechanged:!1});this.addnewrow=this.host.find("#addrow");this.addnewrow[0].id="addrow"+this.element.id;this.addnewrow.addClass(this.toTP("jqx-widget-header"));this.pager=this.host.find("#pager");this.pager[0].id=
                "pager"+this.element.id;this.toolbar=this.host.find("#toolbar");this.toolbar[0].id="toolbar"+this.element.id;this.toolbar.addClass(this.toTP("jqx-grid-toolbar"));this.toolbar.addClass(this.toTP("jqx-widget-header"));this.statusbar=this.host.find("#statusbar");this.statusbar[0].id="statusbar"+this.element.id;this.statusbar.addClass(this.toTP("jqx-grid-statusbar"));this.statusbar.addClass(this.toTP("jqx-widget-header"));this.pager.addClass(this.toTP("jqx-grid-pager"));this.pager.addClass(this.toTP("jqx-widget-header"));
            this.groupsheader=this.host.find("#groupsheader");this.groupsheader.addClass(this.toTP("jqx-grid-groups-header"));this.groupsheader.addClass(this.toTP("jqx-widget-header"));this.groupsheader[0].id="groupsheader"+this.element.id;this.vScrollBar.css("visibility","hidden");this.hScrollBar.css("visibility","hidden");this.vScrollInstance=d.data(this.vScrollBar[0],"jqxScrollBar").instance;this.hScrollInstance=d.data(this.hScrollBar[0],"jqxScrollBar").instance;this.gridtable=null;this.isNestedGrid=this.host.parent()?
                299==this.host.parent().css("z-index"):!1;this.touchdevice=this.isTouchDevice();this.localizestrings&&(this.localizestrings(),null!=this.localization&&this.localizestrings(this.localization,!1));this.rowdetailstemplate&&"function"!==typeof this.rowdetailstemplate&&(void 0==this.rowdetailstemplate.rowdetails&&(this.rowdetailstemplate.rowdetails="<div></div>"),void 0==this.rowdetailstemplate.rowdetailsheight&&(this.rowdetailstemplate.rowdetailsheight=200),void 0==this.rowdetailstemplate.rowdetailshidden&&
            (this.rowdetailstemplate.rowdetailshidden=!0));if(this.showfilterrow&&!this.filterable)throw Error('jqxGrid: "showfilterrow" requires setting the "filterable" property to true!');if(!this.autorowheight||this.autoheight||this.pageable){if(this.virtualmode&&null==this.rendergridrows)throw Error('jqxGrid: "virtualmode" requires setting the "rendergridrows"!');if(this.virtualmode&&!this.pageable&&this.groupable)throw Error('jqxGrid: "grouping" in "virtualmode" without paging is not supported!');if(!this._testmodules()){this._builddataloadelement();
                (this._cachedcolumns=this.columns)&&this.columns.length>this.headerZIndex&&(this.headerZIndex=this.columns.length+100);if(this.theme&&0<=this.theme.indexOf("material")){e=d("<span>Test</span>");b=d("<span>Test</span>");e.addClass(this.toTP("jqx-grid-row-cell"));b.addClass(this.toTP("jqx-grid-column-header-cell"));this.host.append(e);this.host.append(b);var c=e.outerHeight(),h=b.outerHeight();c>this.rowsheight&&(this._cellheight=this.rowsheight=c);h>this.columnsheight&&(this._columnHeight=this.columnsheight=
                    h);e.remove();b.remove()}31!=this.rowsheight&&this._measureElement("cell");(32!=this.columnsheight||this.columngroups)&&this._measureElement("column");if(this.source&&(e=this.source.datafields,null==e&&this.source._source&&(e=this.source._source.datafields),e))for(c=0;c<this.columns.length;c++)if((b=this.columns[c])&&b.cellsformat&&2<b.cellsformat.length)for(h=0;h<e.length;h++)if(e[h].name==b.datafield&&!e[h].format){e[h].format=b.cellsformat;break}this.databind(this.source);this.showtoolbar&&this.toolbar.css("visibility",
                    "inherit");this.showstatusbar&&this.statusbar.css("visibility","inherit");this._arrange();this.pageable&&this._initpager&&this._initpager();this.tableheight=null;var k=this.that,l=function(){k.content&&(k.content[0].scrollTop=0,k.content[0].scrollLeft=0);k.gridcontent&&(k.gridcontent[0].scrollLeft=0,k.gridcontent[0].scrollTop=0)};this.addHandler(this.content,"mousedown",function(){l()});this.addHandler(this.content,"scroll",function(b){l();return!1});this.showfilterrow||(this.showstatusbar||this.showtoolbar||
                this.host.addClass("jqx-disableselect"),this.content.addClass("jqx-disableselect"));this.enablebrowserselection&&(this.content.removeClass("jqx-disableselect"),this.host.removeClass("jqx-disableselect"));this._resizeWindow();this.disabled&&this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));this.hasTransform=d.jqx.utilities.hasTransform(this.host);"logical"==this.scrollmode&&(this.vScrollInstance.thumbStep=this.rowsheight,this.vScrollInstance.step=this.rowsheight);d.jqx.isHidden(this.host)||
                (this.filterable||this.groupable||this.sortable)&&this._initmenu()}}else throw Error('jqxGrid: "autorowheight" requires setting the "autoheight" or "pageable" property to true!');},_resizeWindow:function(){var b=this.that;if(null!=this.width&&-1!=this.width.toString().indexOf("%")||null!=this.height&&-1!=this.height.toString().indexOf("%")){this._updatesizeonwindowresize=!0;d.jqx.utilities.resize(this.host,function(e){var c=d(window).width(),f=d(window).height(),g=b.host.width(),h=b.host.height();
            if(b.pageable){var r=b.host.find(".jqx-grid-pager-input");350>c?r.hide():r.show()}b.autoheight&&(b._lastHostWidth=f);if(b._lastHostWidth!=g||b._lastHostHeight!=h){if(b.touchdevice&&b.editcell&&"orientationchange"!==e)return;b._updatesize(b._lastHostWidth!=g,b._lastHostHeight!=h)}b._lastWidth=c;b._lastHeight=f;b._lastHostWidth=g;b._lastHostHeight=h});var c=b.host.width(),g=b.host.height();b._lastHostWidth=c;b._lastHostHeight=g}},_builddataloadelement:function(){this.dataloadelement&&this.dataloadelement.remove();
            this.dataloadelement=d('<div style="overflow: hidden; position: absolute;"></div>');if(this.showdefaultloadelement){var b=d('<div style="z-index: 99; margin-left: -66px; left: 50%; top: 50%; margin-top: -24px; position: relative; width: 100px; height: 33px; padding: 5px; font-family: verdana; font-size: 12px; color: #767676; border-color: #898989; border-width: 1px; border-style: solid; background: #f6f6f6; border-collapse: collapse;"><div style="float: left;"><div style="float: left; overflow: hidden; width: 32px; height: 32px;" class="jqx-grid-load"/><span style="margin-top: 10px; float: left; display: block; margin-left: 5px;" >'+
                this.gridlocalization.loadtext+"</span></div></div>");b.addClass(this.toTP("jqx-rc-all"));this.dataloadelement.addClass(this.toTP("jqx-rc-all"));b.addClass(this.toTP("jqx-fill-state-normal"));this.dataloadelement.append(b)}else this.dataloadelement.addClass(this.toTP("jqx-grid-load"));this.dataloadelement.width(this.host.width());this.dataloadelement.height(this.host.height());this.wrapper.prepend(this.dataloadelement)},_measureElement:function(b){var e=d("<span style='visibility: hidden; white-space: nowrap;'>measure Text</span>");
            e.addClass(this.toTP("jqx-widget"));d(document.body).append(e);"cell"==b?this._cellheight=e.height():this._columnheight=e.height();e.remove()},_measureMenuElement:function(){var b=d("<span style='visibility: hidden; white-space: nowrap;'>measure Text</span>");b.addClass(this.toTP("jqx-widget"));b.addClass(this.toTP("jqx-menu"));b.addClass(this.toTP("jqx-menu-item-top"));b.addClass(this.toTP("jqx-fill-state-normal"));this.isTouchDevice()&&b.addClass(this.toTP("jqx-grid-menu-item-touch"));d(document.body).append(b);
            var c=b.outerHeight();b.remove();return c},_measureElementWidth:function(b){b=d("<span style='visibility: hidden; white-space: nowrap;'>"+b+"</span>");b.addClass(this.toTP("jqx-widget"));b.addClass(this.toTP("jqx-grid"));b.addClass(this.toTP("jqx-grid-column-header"));b.addClass(this.toTP("jqx-widget-header"));d(document.body).append(b);var e=b.outerWidth()+20;b.remove();return e},_getBodyOffset:function(){var b=0,c=0;"0px"!=d("body").css("border-top-width")&&(b=parseInt(d("body").css("border-top-width")),
        isNaN(b)&&(b=0));"0px"!=d("body").css("border-left-width")&&(c=parseInt(d("body").css("border-left-width")),isNaN(c)&&(c=0));return{left:c,top:b}},_testmodules:function(){var b="",c=this.that,g=function(){""!=b.length&&(b+=",")};this.columnsmenu&&!this.host.jqxMenu&&(this.sortable||this.groupable||this.filterable)&&(g(),b+=" jqxmenu.js");this.host.jqxScrollBar||(g(),b+=" jqxscrollbar.js");this.host.jqxButton||(g(),b+=" jqxbuttons.js");d.jqx.dataAdapter||(g(),b+=" jqxdata.js");this.pageable&&!this.gotopage&&
        (g(),b+="jqxgrid.pager.js");this.filterable&&!this.applyfilters&&(g(),b+=" jqxgrid.filter.js");this.groupable&&!this._initgroupsheader&&(g(),b+=" jqxgrid.grouping.js");this.columnsresize&&!this.autoresizecolumns&&(g(),b+=" jqxgrid.columnsresize.js");this.columnsreorder&&!this.setcolumnindex&&(g(),b+=" jqxgrid.columnsreorder.js");this.sortable&&!this.sortby&&(g(),b+=" jqxgrid.sort.js");this.editable&&!this.begincelledit&&(g(),b+=" jqxgrid.edit.js");this.showaggregates&&!this.getcolumnaggregateddata&&
        (g(),b+=" jqxgrid.aggregates.js");this.keyboardnavigation&&!this.selectrow&&(g(),b+=" jqxgrid.selection.js");if(""!=b||this.editable||this.filterable||this.pageable){var h=[],k=function(e){switch(e){case "checkbox":c.host.jqxCheckBox||h.checkbox||(h.checkbox=!0,g(),b+=" jqxcheckbox.js");break;case "numberinput":c.host.jqxNumberInput||h.numberinput||(h.numberinput=!0,g(),b+=" jqxnumberinput.js");break;case "datetimeinput":c.host.jqxDateTimeInput||h.datetimeinput?c.host.jqxCalendar||h.calendar||(g(),
            b+=" jqxcalendar.js"):(g(),h.datetimeinput=!0,b+=" jqxdatetimeinput.js(requires: jqxcalendar.js)");break;case "combobox":c.host.jqxComboBox||h.combobox?c.host.jqxListBox||h.listbox||(g(),h.listbox=!0,b+=" jqxlistbox.js"):(g(),h.combobox=!0,b+=" jqxcombobox.js(requires: jqxlistbox.js)");break;case "dropdownlist":c.host.jqxDropDownList||h.dropdownlist?c.host.jqxListBox||h.listbox||(g(),h.listbox=!0,b+=" jqxlistbox.js"):(g(),h.dropdownlist=!0,b+=" jqxdropdownlist.js(requires: jqxlistbox.js)")}};(this.filterable||
            this.pageable)&&k("dropdownlist");for(var l=0;l<this.columns.length;l++)if(void 0!=this.columns[l]){var m=this.columns[l].columntype;k(m);this.filterable&&this.showfilterrow&&(m=this.columns[l].filtertype,"checkedlist"!=m&&"bool"!=m||k("checkbox"),"date"==m&&k("datetimeinput"))}if(""!=b)throw Error("jqxGrid: Missing references to the following module(s): "+b);}return!1},focus:function(){try{this.wrapper.focus();var b=this.that;setTimeout(function(){b.wrapper.focus()},25);this.focused=!0}catch(f){}},
        hiddenParent:function(){return d.jqx.isHidden(this.host)},resize:function(b,c){this.width=b;this.height=c;this._updatesize(!0,!0)},_updatesize:function(b,c){if(!this._loading){var e=this.that;e._newmax=null;var f=e.host.width(),k=e.host.height();e._oldWidth||(e._oldWidth=f);e._oldHeight||(e._oldHeight=k);e._resizeTimer&&clearTimeout(e._resizeTimer);e.resizingGrid=!0;if(!d.jqx.isHidden(e.host)){e.editcell&&(e.endcelledit(e.editcell.row,e.editcell.column,!0,!0),e._oldselectedcell=null);if(k!=e._oldHeight||
            1==c){var l=e.groupable&&0<e.groups.length,m=e.vScrollBar.css("visibility");if(!e.autoheight){e.virtualmode&&(e._pageviews=[]);if(l||e.rowdetails||e.pageable){e._arrange();e.prerenderrequired=!0;k=Math.round(e.host.height())+2*e.rowsheight;e._gettableheight();l=Math.round(k/e.rowsheight);var p=Math.max(e.dataview.totalrows,e.dataview.totalrecords);e.pageable&&(p=e.pagesize,e.pagesize>Math.max(e.dataview.totalrows,e.dataview.totalrecords)&&e.autoheight?p=Math.max(e.dataview.totalrows,e.dataview.totalrecords):
            e.autoheight||e.dataview.totalrows<e.pagesize&&(p=Math.max(e.dataview.totalrows,e.dataview.totalrecords)));e._getpagesize();!e.pageable&&e.autoheight&&(l=p);e.virtualsizeinfo&&(e.virtualsizeinfo.visiblerecords=l);e.rendergridcontent(!0,!1);e._renderrows(e.virtualsizeinfo)}else e._arrange(),e.virtualsizeinfo=e._calculatevirtualheight(),k=Math.round(e.host.height())+2*e.rowsheight,parseInt(k)>=parseInt(e._oldHeight)&&(e.prerenderrequired=!0),e._renderrows(e.virtualsizeinfo),e.rtl&&(e._updatecolumnwidths(),
        e.table&&e.table.width(e.columnsheader.width()),e._updatecellwidths());m!=e.vScrollBar.css("visibility")&&(e.vScrollInstance.setPosition(0),e._arrange(),e._updatecolumnwidths(),e.table&&e.table.width(e.columnsheader.width()),e._updatecellwidths())}}if(f!=e._oldWidth||1==b){m=!1;if(e.editcell&&e.editcell.editor)switch(e.editcell.columntype){case "dropdownlist":if(m=e.editcell.editor.jqxDropDownList("isOpened")||e.editcell.editor.jqxDropDownList("isanimating")&&!e.editcell.editor.jqxDropDownList("ishiding")){e.editcell.editor.jqxDropDownList({openDelay:0});
            e.editcell.editor.jqxDropDownList("open");e.editcell.editor.jqxDropDownList({openDelay:250});return}break;case "combobox":if(m=e.editcell.editor.jqxComboBox("isOpened")||e.editcell.editor.jqxComboBox("isanimating")&&!e.editcell.editor.jqxComboBox("ishiding")){e.editcell.editor.jqxComboBox({openDelay:0});e.editcell.editor.jqxComboBox("open");e.editcell.editor.jqxComboBox({openDelay:250});return}break;case "datetimeinput":if(m){e.editcell.editor.jqxDateTimeInput("isOpened")||e.editcell.editor.jqxDateTimeInput("isanimating")&&
        e.editcell.editor.jqxDateTimeInput("ishiding");e.editcell.editor.jqxDateTimeInput({openDelay:0});e.editcell.editor.jqxDateTimeInput("open");e.editcell.editor.jqxDateTimeInput({openDelay:250});return}}m=e.hScrollBar.css("visibility");e._arrange();e._updatecolumnwidths();e.table&&e.table.width(e.columnsheader.width());e._updatecellwidths();0==b&&e._oldWidth>f||c&&0!=e.dataview.rows.length||e._renderrows(e.virtualsizeinfo);m!=e.hScrollBar.css("visibility")&&e.hScrollInstance.setPosition(0)}e._oldWidth=
            f;e._oldHeight=k;e.resizingGrid=!1}}},getTouches:function(b){return d.jqx.mobile.getTouches(b)},_updateTouchScrolling:function(){var b=this.that;if(b.isTouchDevice()){b.scrollmode="logical";b.vScrollInstance.thumbStep=b.rowsheight;var c=d.jqx.mobile.getTouchEventName("touchstart"),g=d.jqx.mobile.getTouchEventName("touchend"),h=d.jqx.mobile.getTouchEventName("touchmove");b.enablehover=!1;b.gridcontent&&(b.removeHandler(b.gridcontent,c+".touchScroll"),b.removeHandler(b.gridcontent,h+".touchScroll"),
            b.removeHandler(b.gridcontent,g+".touchScroll"),b.removeHandler(b.gridcontent,"touchcancel.touchScroll"),d.jqx.mobile.touchScroll(b.gridcontent[0],b.vScrollInstance.max,function(e,c){null!=c&&"visible"==b.vScrollBar.css("visibility")&&b.vScrollInstance.setPosition(c);null!=e&&"visible"==b.hScrollBar.css("visibility")&&b.hScrollInstance.setPosition(e);b.vScrollInstance.thumbCapture=!0;b._lastScroll=new Date},this.element.id,this.hScrollBar,this.vScrollBar),b._overlayElement&&(b.removeHandler(b._overlayElement,
            c+".touchScroll"),b.removeHandler(b._overlayElement,h+".touchScroll"),b.removeHandler(b._overlayElement,g+".touchScroll"),b.removeHandler(b._overlayElement,"touchcancel.touchScroll"),d.jqx.mobile.touchScroll(b._overlayElement[0],b.vScrollInstance.max,function(e,c){null!=c&&"visible"==b.vScrollBar.css("visibility")&&b.vScrollInstance.setPosition(c);null!=e&&"visible"==b.hScrollBar.css("visibility")&&b.hScrollInstance.setPosition(e);b.vScrollInstance.thumbCapture=!0;b._lastScroll=new Date},this.element.id,
            this.hScrollBar,this.vScrollBar),this.addHandler(this.host,c,function(){b.editcell?b._overlayElement.css("visibility","hidden"):b._overlayElement.css("visibility","visible")}),this.addHandler(this.host,g,function(){b.editcell?b._overlayElement.css("visibility","hidden"):b._overlayElement.css("visibility","visible")})))}},_rendercelltexts:function(){},isTouchDevice:function(){if(void 0!=this.touchDevice)return this.touchDevice;var b=d.jqx.mobile.isTouchDevice();this.touchDevice=b;if(1==this.touchmode){if(d.jqx.browser.msie&&
            9>d.jqx.browser.version)return this.enablehover=!1;b=!0;d.jqx.mobile.setMobileSimulator(this.element);this.touchDevice=b}else 0==this.touchmode&&(b=!1);b&&0!=this.touchModeStyle&&(this.touchDevice=!0,this.host.addClass(this.toThemeProperty("jqx-touch")),this.host.find("jqx-widget-content").addClass(this.toThemeProperty("jqx-touch")),this.host.find("jqx-widget-header").addClass(this.toThemeProperty("jqx-touch")),this.scrollbarsize=this.touchscrollbarsize);return b},toTP:function(b){return this.toThemeProperty(b)},
        localizestrings:function(b,c){this._cellscache=[];d.jqx.dataFormat&&d.jqx.dataFormat.cleardatescache();if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);if(null!=b){for(var e in b)e.toLowerCase()!==e&&(b[e.toLowerCase()]=b[e]);b.okstring&&(this.gridlocalization.okstring=b.okstring);b.cancelstring&&(this.gridlocalization.cancelstring=b.cancelstring);b.pagergotopagestring&&(this.gridlocalization.pagergotopagestring=b.pagergotopagestring);b.pagershowrowsstring&&(this.gridlocalization.pagershowrowsstring=
            b.pagershowrowsstring);b.pagerrangestring&&(this.gridlocalization.pagerrangestring=b.pagerrangestring);b.pagernextbuttonstring&&(this.gridlocalization.pagernextbuttonstring=b.pagernextbuttonstring);b.pagerpreviousbuttonstring&&(this.gridlocalization.pagerpreviousbuttonstring=b.pagerpreviousbuttonstring);b.pagerfirstbuttonstring&&(this.gridlocalization.pagerfirstbuttonstring=b.pagerfirstbuttonstring);b.pagerlastbuttonstring&&(this.gridlocalization.pagerlastbuttonstring=b.pagerlastbuttonstring);b.groupsheaderstring&&
        (this.gridlocalization.groupsheaderstring=b.groupsheaderstring);b.sortascendingstring&&(this.gridlocalization.sortascendingstring=b.sortascendingstring);b.sortdescendingstring&&(this.gridlocalization.sortdescendingstring=b.sortdescendingstring);b.sortremovestring&&(this.gridlocalization.sortremovestring=b.sortremovestring);b.groupbystring&&(this.gridlocalization.groupbystring=b.groupbystring);b.groupremovestring&&(this.gridlocalization.groupremovestring=b.groupremovestring);b.firstDay&&(this.gridlocalization.firstDay=
            b.firstDay);b.days&&(this.gridlocalization.days=b.days);b.months&&(this.gridlocalization.months=b.months);b.AM&&(this.gridlocalization.AM=b.AM);b.PM&&(this.gridlocalization.PM=b.PM);b.patterns&&(this.gridlocalization.patterns=b.patterns);b.percentsymbol&&(this.gridlocalization.percentsymbol=b.percentsymbol);b.currencysymbol&&(this.gridlocalization.currencysymbol=b.currencysymbol);b.currencysymbolposition&&(this.gridlocalization.currencysymbolposition=b.currencysymbolposition);void 0!=b.decimalseparator&&
        (this.gridlocalization.decimalseparator=b.decimalseparator);void 0!=b.thousandsseparator&&(this.gridlocalization.thousandsseparator=b.thousandsseparator);b.filterclearstring&&(this.gridlocalization.filterclearstring=b.filterclearstring);b.filterstring&&(this.gridlocalization.filterstring=b.filterstring);b.filtershowrowstring&&(this.gridlocalization.filtershowrowstring=b.filtershowrowstring);b.filtershowrowdatestring&&(this.gridlocalization.filtershowrowdatestring=b.filtershowrowdatestring);b.filterselectallstring&&
        (this.gridlocalization.filterselectallstring=b.filterselectallstring);b.filterchoosestring&&(this.gridlocalization.filterchoosestring=b.filterchoosestring);b.filterorconditionstring&&(this.gridlocalization.filterorconditionstring=b.filterorconditionstring);b.filterandconditionstring&&(this.gridlocalization.filterandconditionstring=b.filterandconditionstring);b.filterstringcomparisonoperators&&(this.gridlocalization.filterstringcomparisonoperators=b.filterstringcomparisonoperators);b.filternumericcomparisonoperators&&
        (this.gridlocalization.filternumericcomparisonoperators=b.filternumericcomparisonoperators);b.filterdatecomparisonoperators&&(this.gridlocalization.filterdatecomparisonoperators=b.filterdatecomparisonoperators);b.filterbooleancomparisonoperators&&(this.gridlocalization.filterbooleancomparisonoperators=b.filterbooleancomparisonoperators);b.emptydatastring&&(this.gridlocalization.emptydatastring=b.emptydatastring);b.filterselectstring&&(this.gridlocalization.filterselectstring=b.filterselectstring);
            b.todaystring&&(this.gridlocalization.todaystring=b.todaystring);b.clearstring&&(this.gridlocalization.clearstring=b.clearstring);b.validationstring&&(this.gridlocalization.validationstring=b.validationstring);b.loadtext&&(this.gridlocalization.loadtext=b.loadtext);b.addrowstring&&(this.gridlocalization.addrowstring=b.addrowstring);b.udpaterowstring&&(this.gridlocalization.udpaterowstring=b.udpaterowstring);b.deleterowstring&&(this.gridlocalization.deleterowstring=b.deleterowstring);b.resetrowstring&&
            (this.gridlocalization.resetrowstring=b.resetrowstring);b.everpresentrowplaceholder&&(this.gridlocalization.everpresentrowplaceholder=b.everpresentrowplaceholder);if(!1!==c){this._initpager&&this._initpager();this._initgroupsheader&&this._initgroupsheader();this._initmenu&&this._initmenu();this._builddataloadelement();d(this.dataloadelement).css("visibility","hidden");d(this.dataloadelement).css("display","none");if(this.filterable&&this.showfilterrow&&this._updatefilterrow){for(e in this._filterrowcache)d(this._filterrowcache[e]).remove();
                this._filterrowcache=[];this._updatefilterrow()}this.showaggregates&&this.refresheaggregates&&this.refresheaggregates();this._renderrows(this.virtualsizeinfo)}}else this.gridlocalization={"/":"/",":":":",firstDay:0,days:{names:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),namesAbbr:"Sun Mon Tue Wed Thu Fri Sat".split(" "),namesShort:"Su Mo Tu We Th Fr Sa".split(" ")},months:{names:"January February March April May June July August September October November December ".split(" "),
                namesAbbr:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec ".split(" ")},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",ISO:"yyyy-MM-dd hh:mm:ss",ISO2:"yyyy-MM-dd HH:mm:ss",d1:"dd.MM.yyyy",d2:"dd-MM-yyyy",d3:"dd-MMMM-yyyy",d4:"dd-MM-yy",d5:"H:mm",
                d6:"HH:mm",d7:"HH:mm tt",d8:"dd/MMMM/yyyy",d9:"MMMM-dd",d10:"MM-dd",d11:"MM-dd-yyyy"},percentsymbol:"%",currencysymbol:"$",currencysymbolposition:"before",decimalseparator:".",thousandsseparator:",",pagergotopagestring:"Go to page:",pagershowrowsstring:"Show rows:",pagerrangestring:" of ",pagerpreviousbuttonstring:"previous",pagernextbuttonstring:"next",pagerfirstbuttonstring:"first",pagerlastbuttonstring:"last",groupsheaderstring:"Drag a column and drop it here to group by that column",sortascendingstring:"Sort Ascending",
            sortdescendingstring:"Sort Descending",sortremovestring:"Remove Sort",groupbystring:"Group By this column",groupremovestring:"Remove from groups",filterclearstring:"Clear",filterstring:"Filter",filtershowrowstring:"Show rows where:",filtershowrowdatestring:"Show rows where date:",filterorconditionstring:"Or",filterandconditionstring:"And",filterselectallstring:"(Select All)",filterchoosestring:"Please Choose:",filterstringcomparisonoperators:"empty;not empty;contains;contains(match case);does not contain;does not contain(match case);starts with;starts with(match case);ends with;ends with(match case);equal;equal(match case);null;not null".split(";"),
            filternumericcomparisonoperators:"equal;not equal;less than;less than or equal;greater than;greater than or equal;null;not null".split(";"),filterdatecomparisonoperators:"equal;not equal;less than;less than or equal;greater than;greater than or equal;null;not null".split(";"),filterbooleancomparisonoperators:["equal","not equal"],validationstring:"Entered value is not valid",emptydatastring:"No data to display",filterselectstring:"Select Filter",loadtext:"Loading...",clearstring:"Clear",todaystring:"Today",
            addrowstring:"Add",udpaterowstring:"Update",deleterowstring:"Delete",resetrowstring:"Reset",everpresentrowplaceholder:"Enter ",okstring:"Ok",cancelstring:"Cancel"}},_getmenudefaultheight:function(){var b=0;this.sortable&&this._togglesort&&this.showsortmenuitems&&(b=3);this.groupable&&this._initgroupsheader&&this.showgroupmenuitems&&(b+=2);var c=this._measureMenuElement();b=b*c+9;this.filterable&&!this.showfilterrow&&this.showfiltermenuitems&&(b+=194,d.jqx.browser.msie&&8>d.jqx.browser.version&&(b+=
            20));return b},_initmenu:function(){var b=this.that;if(this.host.jqxMenu){if(this.gridmenu){if(this._hasOpenedMenu)return;this.filterable&&this._destroyfilterpanel&&this._destroyfilterpanel();this.removeHandler(this.gridmenu,"keydown");this.removeHandler(this.gridmenu,"closed");this.removeHandler(this.gridmenu,"itemclick");this.gridmenu.jqxMenu("destroy");this.gridmenu.removeData();this.gridmenu.remove()}this.menuitemsarray=[];var c="";this.isTouchDevice()&&(c="jqx-grid-menu-item-touch");this.gridmenu=
            d('<div tabindex=0 id="gridmenu'+this.element.id+'" style="z-index: 99;"></div>');this.host.append(this.gridmenu);var g=d("<ul></ul>"),h=d('<li class="'+c+'"><div class="jqx-grid-sortasc-icon"></div>'+this.gridlocalization.sortascendingstring+"</li>"),k=d('<li class="'+c+'"><div class="jqx-grid-sortdesc-icon"></div>'+this.gridlocalization.sortdescendingstring+"</li>"),l=d('<li class="'+c+'"><div class="jqx-grid-sortremove-icon"></div>'+this.gridlocalization.sortremovestring+"</li>"),m=d('<li class="'+
            c+'"><div class="jqx-grid-groupby-icon"></div>'+this.gridlocalization.groupbystring+"</li>"),p=d('<li class="'+c+'"><div class="jqx-grid-groupby-icon"></div>'+this.gridlocalization.groupremovestring+"</li>"),r=d('<li type="separator"></li>'),t=d('<li class="filter '+c+'" style="height: 194px;" ignoretheme="true"><div class="filter"></div></li>');c=this.gridlocalization.sortascendingstring.length;var w=this.gridlocalization.sortascendingstring;this.gridlocalization.sortdescendingstring.length>c&&(c=
            this.gridlocalization.sortdescendingstring.length,w=this.gridlocalization.sortdescendingstring);this.gridlocalization.sortremovestring.length>c&&(c=this.gridlocalization.sortremovestring.length,w=this.gridlocalization.sortremovestring);this.groupable&&this._initgroupsheader&&this.showgroupmenuitems&&(this.gridlocalization.groupbystring.length>c&&(c=this.gridlocalization.groupbystring.length,w=this.gridlocalization.groupbystring),this.gridlocalization.groupremovestring.length>c&&(c=this.gridlocalization.groupremovestring.length,
            w=this.gridlocalization.groupremovestring));c=200;w=d.trim(w).replace(/&nbsp;/ig,"").replace(/&#160;/ig,"");w=d("<span>"+w+"</span>");w.addClass(this.toThemeProperty("jqx-menu-item"));this.host.append(w);c=w.outerWidth()+60;w.remove();w=0;this.sortable&&this._togglesort&&this.showsortmenuitems&&(g.append(h),this.menuitemsarray[0]=h[0],g.append(k),this.menuitemsarray[1]=k[0],g.append(l),this.menuitemsarray[2]=l[0],w=3);this.groupable&&this._initgroupsheader&&this.showgroupmenuitems&&(g.append(m),this.menuitemsarray[3]=
            m[0],g.append(p),this.menuitemsarray[4]=p[0],w+=2);var q=this._measureMenuElement();w=w*q+9;q=!0;if(this.filterable&&!this.showfilterrow&&this.showfiltermenuitems)if(this._initfilterpanel)this.menuitemsarray[5]=t[0],this.menuitemsarray[6]=t[0],g.append(r),g.append(t),w+=194,d.jqx.browser.msie&&8>d.jqx.browser.version&&(w+=20),this.isTouchDevice()&&(w+=30),r=d(t).find("div:first"),this.excelfilterpanel=d("<div></div>"),this.filterpanel=r,this.filtermenu=d(t),c+=20,this.adaptive&&this.element.offsetWidth<
        this.adaptivewidth&&(c=this.element.offsetWidth-50),this._initfilterpanel(this,r,"",c),this._initfilterpanel(this,this.excelfilterpanel,"",c,!0),q=!1,this.removeHandler(d(document),"click.menu"+b.element.id,b._closemenuafterclick,b),this.addHandler(d(document),"click.menu"+b.element.id,b._closemenuafterclick,b);else throw Error("jqxGrid: Missing reference to jqxgrid.filter.js.");this.gridmenu.append(g);d.jqx.browser.msie&&8>d.jqx.browser.version&&this.filterable&&(d("#listBoxfilter1"+this.element.id).css("z-index",
            49),d("#listBoxfilter2"+this.element.id).css("z-index",49),d("#listBoxfilter3"+this.element.id).css("z-index",49),d("#gridmenu"+this.element.id).css("z-index",50),this.addHandler(d("#gridmenu"+this.element.id),"initialized",function(){d("#menuWrappergridmenu"+b.element.id).css("z-index",49)}));void 0==this.menuitemsarray[0]&&(w=65);this.removeHandler(d(window),"orientationchange.jqxgrid"+this.element.id);this.removeHandler(d(window),"orientationchanged.jqxgrid"+this.element.id);this.addHandler(d(window),
            "orientationchange.jqxgrid"+this.element.id,function(){b.gridmenu.jqxMenu("close")});this.addHandler(d(window),"orientationchanged.jqxgrid"+this.element.id,function(){b.gridmenu.jqxMenu("close")});this.removeHandler(this.gridmenu,"keydown");this.addHandler(this.gridmenu,"keydown",function(e){var c=d(b.gridmenu.find(".jqx-item")).toArray(),f=function(b){for(var e=c.indexOf(b)-1;0<=e;e--)if(!(0<=c[e].className.indexOf("disabled")))return c[e];return b},g=function(b){for(var e=c.indexOf(b)+1;e<c.length;e++)if(!(0<=
            c[e].className.indexOf("disabled")))return c[e];return b},h=function(){var b=c[c.length-1];return 0<=b.className.indexOf("disabled")?f(b):b},k=function(){for(var b=0;b<c.length;b++)if(c[b].active)return c[b];return null},q=function(b){d(c).removeClass("jqx-fill-state-focus");for(var e=0;e<c.length;e++)c[e].active=!1;b&&(d(b).addClass("jqx-fill-state-focus"),b.active=!0)};k()||b.filterable||(c[0].active=!0);if(b.keyboardmenunavigation&&b.keyboardnavigation&&(40===e.keyCode?(k=k(),q(g(k))):38===e.keyCode&&
            (k=k(),q(f(k))),9===e.keyCode)){if(!k()){if(e.shiftKey)if(document.activeElement===d.find("#filter1"+b.element.id)[0]){var l=h();q(l);d(d.find("#filter1"+b.element.id)).removeClass("jqx-fill-state-focus");b.gridmenu.focus();e.stopPropagation();e.preventDefault()}else document.activeElement===d.find("#filter1"+b.element.id+"ex")[0]&&(l=h(),q(l),d(d.find("#filter1"+b.element.id)+"ex").removeClass("jqx-fill-state-focus"),b.gridmenu.focus(),e.stopPropagation(),e.preventDefault());return!0}e.shiftKey?
            (k=k(),q(f(k))):(k=k(),k===h()&&b.filterable&&!b.showfilterrow?(q(null),0<d(d.find("#filter1"+b.element.id)).length?d(d.find("#filter1"+b.element.id)).jqxDropDownList("focus"):0<d(d.find("#filter1"+b.element.id+"ex")).length&&d(d.find("#filter1"+b.element.id+"ex")).jqxListBox("focus")):q(g(k)));e.stopPropagation();e.preventDefault()}if(27==e.keyCode)b.gridmenu.jqxMenu("close");else if(13==e.keyCode){c=b.gridmenu.find(".jqx-item");if(k=k())d(k).trigger("click"),q(null);else if(b._buildfilter&&b.filterable&&
            !b.showfilterrow){if(0<d.find("#filter1"+b.element.id).length){l="block"==d(d.find("#filter1"+b.element.id)).jqxDropDownList("container").css("display");var u="block"==d(d.find("#filter2"+b.element.id)).jqxDropDownList("container").css("display"),m="block"==d(d.find("#filter3"+b.element.id)).jqxDropDownList("container").css("display")}e=d(d.find("#filterclearbutton"+b.element.id)).hasClass("jqx-fill-state-focus");q=d(d.find("#filterbutton"+b.element.id)).hasClass("jqx-fill-state-focus");e?(l=d.data(document.body,
            "contextmenu"+b.element.id).column,b._clearfilter(b,b.element,l),b.gridmenu.jqxMenu("close")):!q||l||u||m||(l=d.data(document.body,"contextmenu"+b.element.id).column,b.gridmenu.jqxMenu("close"),b._buildfilter(b,t,l))}l=0<b.selectedcells.length||0<b.selectedrowindexes.length;b.clearselection();if(u=b.getdisplayrows()[0])u=b.getboundindex(u),0<=b.selectionmode.indexOf("cell")?l&&b.selectcell(u,b.columns.records[0].displayfield):l&&b.selectrow(u)}});"auto"!=this.popupwidth&&(c=this.popupwidth);this.gridmenu.jqxMenu({popupZIndex:1E3,
            width:c,height:w,autoCloseOnClick:q,autoOpenPopup:!1,mode:"popup",theme:this.theme,animationShowDuration:0,animationHideDuration:0,animationShowDelay:0});r=document.querySelectorAll(".jqx-menu-wrapper");this.gridmenu.parent().attr("tabindex",r.length-1);this.filterable&&this.gridmenu.jqxMenu("_setItemProperty",t[0].id,"closeOnClick",!1);if(this.rtl){var u=this.that;d.each(g.find("li"),function(){d(this).addClass(u.toTP("jqx-rtl"))});g=function(b){b=b.find("div");b.css("float","right");b.css("margin-left",
            "4px");b.css("margin-right","-4px")};g(l);g(k);g(h);g(m);g(p)}this._handlemenueevents()}else this.columnsmenu=!1},_arrangemenu:function(){this.gridmenu||this._initmenu();var b=this.gridlocalization.sortascendingstring.length,c=this.gridlocalization.sortascendingstring;this.gridlocalization.sortdescendingstring.length>b&&(b=this.gridlocalization.sortdescendingstring.length,c=this.gridlocalization.sortdescendingstring);this.gridlocalization.sortremovestring.length>b&&(b=this.gridlocalization.sortremovestring.length,
            c=this.gridlocalization.sortremovestring);this.groupable&&this._initgroupsheader&&(this.gridlocalization.groupbystring.length>b&&(b=this.gridlocalization.groupbystring.length,c=this.gridlocalization.groupbystring),this.gridlocalization.groupremovestring.length>b&&(c=this.gridlocalization.groupremovestring));c=d.trim(c).replace(/&nbsp;/ig,"").replace(/&#160;/ig,"");c=d("<span>"+c+"</span>");c.addClass(this.toThemeProperty("jqx-menu-item"));this.host.append(c);b=c.outerWidth()+60;c.remove();c=0;this.sortable&&
        this._togglesort&&this.showsortmenuitems&&(c=3);this.groupable&&this._initgroupsheader&&this.showgroupmenuitems&&(c+=2);var g=this._measureMenuElement();c=c*g+9;this.filterable&&this.showfiltermenuitems&&this._initfilterpanel&&(c+=194,b+=20,d.jqx.browser.msie&&8>d.jqx.browser.version&&(c+=20),this.isTouchDevice()&&(c+=30));void 0==this.menuitemsarray[0]&&(c=65);"auto"!=this.popupwidth&&(b=this.popupwidth);"auto"!=this.popupheight&&(c=this.popupheight);this.gridmenu.jqxMenu({width:b,height:c})},_closemenuafterclick:function(b){var e=
            null!=b?b.data:this,c=!1;if(void 0==b.target||void 0!=b.target&&void 0==b.target.className.indexOf)e.gridmenu.jqxMenu("close");else if(-1==b.target.className.indexOf("filter")||-1!=b.target.className.indexOf("jqx-grid-cell-filter"))if(-1!=b.target.className.indexOf("jqx-grid-cell"))e.gridmenu.jqxMenu("close");else if(!e._hasOpenedMenu||!d(b.target).ischildof(e.gridmenu)){e.host.coord();var h=e.gridmenu.coord(),k=b.pageX,l=b.pageY;d.each(d(b.target).parents(),function(){if(null!=this.id&&this.id.indexOf&&
            -1!=this.id.indexOf("filter")||this.className.indexOf&&-1!=this.className.indexOf("filter")&&-1==this.className.indexOf("jqx-grid-cell-filter"))return c=!0,!1;if(this.className.indexOf&&-1!=this.className.indexOf("jqx-grid-cell")||this.className.indexOf&&-1!=this.className.indexOf("jqx-grid-column"))return e.gridmenu.jqxMenu("close"),!1});if(!c){try{if("default"===e.filtermode){var m=d(d.find("#filter1"+e.element.id)).jqxDropDownList("listBox").vScrollInstance._mouseup,p=new Date;if(100>p-m)return;
            var r=d(d.find("#filter3"+e.element.id)).jqxDropDownList("listBox").vScrollInstance._mouseup;if(100>p-r||"block"==d(d.find("#filter3"+e.element.id)).jqxDropDownList("container").css("display")||"block"==d(d.find("#filter1"+e.element.id)).jqxDropDownList("container").css("display")||"block"==d(d.find("#filter2"+e.element.id)).jqxDropDownList("container").css("display")||e._hasdatefilter&&"div"==d(".filtertext1"+e.element.id)[0].nodeName.toLowerCase()&&("block"==d(".filtertext1"+e.element.id).jqxDateTimeInput("container").css("display")||
                "block"==d(".filtertext2"+e.element.id).jqxDateTimeInput("container").css("display")))return}else{m=d(d.find("#filter1"+e.element.id)).data().jqxListBox.instance.vScrollInstance._mouseup;p=new Date;if(100>p-m)return;r=d(d.find("#filter1"+e.element.id)).data().jqxListBox.instance.hScrollInstance._mouseup;if(100>p-r)return}}catch(t){}if(!(k>=h.left&&k<=h.left+e.gridmenu.width()&&l>=h.top&&l<=h.top+e.gridmenu.height())){b=!1;if(e.columnmenuclosing&&((b=d.data(document.body,"contextmenu"+e.element.id))||
        (b={column:{displayfield:null}}),b=e.columnmenuclosing(e.gridmenu,b.column.displayfield,d(e.gridmenu).height()),!1===b))return;e.gridmenu.jqxMenu("close")}}}},_handlemenueevents:function(){var b=this.that;this.removeHandler(this.gridmenu,"closed");this.addHandler(this.gridmenu,"closed",function(e){b._closemenu()});this.removeHandler(this.gridmenu,"itemclick");this.addHandler(this.gridmenu,"itemclick",function(e){var c=e.args;for(e=0;e<b.menuitemsarray.length;e++)if(c==b.menuitemsarray[e]){if(void 0!=
            d(c).attr("ignoretheme"))break;c=d.data(document.body,"contextmenu"+b.element.id);var f=c.column;b.filterable&&b.gridmenu.jqxMenu("close");var k=f.displayfield;null==k&&(k=f.datafield);if(null!=c)switch(e){case 0:b.sortby(k,"ascending",null);break;case 1:b.sortby(k,"descending",null);break;case 2:b.sortby(k,null,null);break;case 3:b.addgroup(k);break;case 4:b.removegroup(k);break;case 5:e=d(b.menuitemsarray[6]),d(e).css("display","block")}break}})},getdatainformation:function(){var b=this.dataview.totalrecords;
            this.summaryrows&&(b+=this.summaryrows.length);return{rowscount:b,sortinformation:this.getsortinformation(),paginginformation:this.getpaginginformation()}},getsortinformation:function(){return{sortcolumns:this.getsortcolumns?this.getsortcolumns():[],sortcolumn:this.sortcolumn,sortdirection:this.sortdirection}},getpaginginformation:function(){return{pagenum:this.dataview.pagenum,pagesize:this.pagesize,pagescount:Math.ceil(this.dataview.totalrecords/this.pagesize)}},_updaterowsproperties:function(){this._updatehiddenrows();
            this._updaterowheights();this._updaterowdetails()},_updatehiddenrows:function(){var b=this.that;this.hiddens=[];d.each(this.hiddenboundrows,function(e){void 0!=this.index&&(e=b.getrowvisibleindex(e),b.hiddens[e]=this.hidden)})},_updaterowheights:function(){var b=this.that;this.heights=[];d.each(this.heightboundrows,function(e){void 0!=this.index&&(e=b.getrowvisibleindex(e),b.heights[e]=this.height)})},_updaterowdetails:function(){var b=this.that;this.details=[];d.each(this.detailboundrows,function(e){void 0!=
        this.index&&(e=b.getrowvisibleindex(e),b.details[e]=this.details)})},_getmenuitembyindex:function(b){return void 0==b?null:this.menuitemsarray[b]},openmenu:function(b){if(!this._openingmenu){this._openingmenu=!0;this.closemenu();var e=this.getcolumn(b);if(!e.menu)return!1;this.gridmenu||this._initmenu();var c=e.columnsmenu;d(e.element).trigger("mouseenter");this.menuOwner=e;var h=this;for(e=0;e<h.columns.records.length;e++)h.columns.records[e].datafield!=b&&d(h.columns.records[e].element).trigger("mouseleave");
            setTimeout(function(){"block"==d(c)[0].style.display&&d(c).trigger("click");h._openingmenu=!1},200)}},closemenu:function(){this._closemenu()},_closemenu:function(){if(this._hasOpenedMenu){var b=!1;if(this.columnmenuclosing){var c=d.data(document.body,"contextmenu"+this.element.id);c||(c={column:{displayfield:null}});b=this.columnmenuclosing(this.gridmenu,c.column.displayfield,d(this.gridmenu).height());if(!1===b)return}null!=this.gridmenu&&this.gridmenu.jqxMenu("close");c=d.data(document.body,"contextmenu"+
            this.element.id);null!=c&&this.autoshowcolumnsmenubutton&&(this.enableanimations?(d(c.columnsmenu).animate({"margin-left":0},"fast",function(){d(c.columnsmenu).css("display","none")}),b=this.rtl?0:-32,c.column.iconscontainer.animate({"margin-left":b},"fast")):(d(c.columnsmenu).css("display","none"),b=this.rtl?0:-32,c.column.iconscontainer.css("margin-left",b)),d.data(document.body,"contextmenu"+this.element.id,null));this._hasOpenedMenu=!1;this.menuOwner=null;var g=this._getmenuitembyindex(5);if(g){b=
            d(g).find("#filter1"+this.element.id);var h=d(g).find("#filter2"+this.element.id);g=d(g).find("#filter3"+this.element.id);0<b.length&&"default"===this.filtermode&&(b.jqxDropDownList("hideListBox"),0<h.length&&h.jqxDropDownList("hideListBox"),0<g.length&&g.jqxDropDownList("hideListBox"))}this.focus()}},scrolloffset:function(b,c){null!=b&&null!=c&&void 0!=b&&void 0!=c&&(this.vScrollBar.jqxScrollBar("setPosition",b),this.hScrollBar.jqxScrollBar("setPosition",c))},scrollleft:function(b){null!=b&&void 0!=
        b&&"hidden"!=this.hScrollBar.css("visibility")&&this.hScrollBar.jqxScrollBar("setPosition",b)},scrolltop:function(b){null!=b&&void 0!=b&&"hidden"!=this.vScrollBar.css("visibility")&&this.vScrollBar.jqxScrollBar("setPosition",b)},beginupdate:function(b,c){this._updating=!0;this._datachanged=!1;!0===b&&(this._batchupdate=!0);!0===c&&(this._stopbindings=!0)},endupdate:function(){this.resumeupdate()},resumeupdate:function(){this._updating=!1;if(this._batchupdate)this._datachanged=this._batchupdate=!1,
            this._stopbindings?this.updatebounddata():this.render();else if(this._stopbindings)this.updatebounddata("data");else{if(1==this._datachanged){var b=this.vScrollInstance.value;this.render(!0,!0,!1);this._datachanged=!1;0!=b&&b<this.vScrollInstance.max&&this.scrolltop(b)}else this.rendergridcontent(!0),this._renderrows(this.virtualsizeinfo);this.showaggregates&&this.renderaggregates&&this.renderaggregates();this._updatecolumnwidths();this._updatecellwidths();this._renderrows(this.virtualsizeinfo)}},
        updating:function(){return this._updating},showloadelement:function(){this.renderloadelement&&this.dataloadelement.html(this.renderloadelement());this.dataloadelement.width(this.host.width());this.dataloadelement.height(this.host.height());d(this.dataloadelement).css("visibility","visible");d(this.dataloadelement).css("display","block")},hideloadelement:function(){d(this.dataloadelement).css("visibility","hidden");d(this.dataloadelement).css("display","none")},_updatefocusedfilter:function(){var b=
            this.that;b.focusedfilter&&(b.focusedfilter.focus(),setTimeout(function(){b.focusedfilter.focus();if("input"==b.focusedfilter[0].nodeName.toLowerCase()){var e=b.focusedfilter.val().length;try{if("selectionStart"in b.focusedfilter[0])b.focusedfilter[0].setSelectionRange(e,e);else{var c=b.focusedfilter[0].createTextRange();c.collapse(!0);c.moveEnd("character",e);c.moveStart("character",e);c.select()}}catch(h){}}},50))},databind:function(b,c){if(!0!==this.loadingstate&&!0!==this._stopbindings){var e=
            window;"block"==this.host.css("display")&&(this.autoshowloadelement?(d(this.dataloadelement).css("visibility","visible"),d(this.dataloadelement).css("display","block"),this.dataloadelement.width(this.host.width()),this.dataloadelement.height(this.host.height()),this._hideemptyrow()):(d(this.dataloadelement).css("visibility","hidden"),d(this.dataloadelement).css("display","none")));!this._initgroupsheader&&0<this.groups.length&&(this.groups=[]);var f=this.that;null==b&&(b={});b.recordstartindex||(b.recordstartindex=
            0);b.recordendindex||(b.recordendindex=0);if(void 0==b.loadallrecords||null==b.loadallrecords)b.loadallrecords=!0;if(void 0==b.sortcomparer||null==b.sortcomparer)b.sortcomparer=null;if(void 0==b.filter||null==b.filter)b.filter=null;if(void 0==b.sort||null==b.sort)b.sort=null;if(void 0==b.data||null==b.data)b.data=null;var k=null;null!=b&&(k=void 0!=b._source?b._source.url:b.url);this.dataview=this.dataview||new d.jqx.dataview;d.jqx.dataview.sort&&d.extend(this.dataview,new d.jqx.dataview.sort);d.jqx.dataview.grouping&&
        d.extend(this.dataview,new d.jqx.dataview.grouping);this.dataview.suspendupdate();this.dataview.pageable=this.pageable;this.dataview.groupable=this.groupable;this.dataview.groups=this.groups;this.dataview.virtualmode=this.virtualmode;this.dataview.grid=this;this.dataview._clearcaches();!this.pageable&&this.virtualmode&&(this.loadondemand=!0);if(!f.initializedcall){if(b._source&&this.sortable&&(void 0!=b._source.sortcolumn&&(this.sortcolumn=b._source.sortcolumn,this.source.sortcolumn=this.sortcolumn,
            this.dataview.sortfield=b._source.sortcolumn,b._source.sortcolumn=null),void 0!=b._source.sortdirection)){var l=this.dataview.sortfielddirection=b._source.sortdirection,m="a"==l||"asc"==l||"ascending"==l||1==l?!0:!1;this.sortdirection=null!=l?{ascending:m,descending:!m}:{ascending:!1,descending:!1}}this.pageable&&b._source&&(void 0!=b._source.pagenum&&(this.dataview.pagenum=b._source.pagenum),void 0!=b._source.pagesize?(this.pagesize=b._source.pagesize,this.dataview.pagesize=b._source.pagesize):(this.dataview.pagesize=
            b._source.pagesize,void 0==this.dataview.pagesize&&(this.dataview.pagesize=this.pagesize)));this.sortable&&(b.sortcolumn&&(this.dataview.sortfield=b.sortcolumn),b.sortdirection&&(this.dataview.sortfielddirection=b.sortdirection));this.filterable&&this.columns&&d.each(this.columns,function(){this.filter&&f.dataview.addfilter(this.datafield,this.filter)})}this._loading=!0;this.dataview.update=function(b){!f.pageable&&f.virtualmode&&(f.loadondemand=!0);f._loading=!1;f.dataview.isupdating()&&f.dataview.resumeupdate(!1);
            if(f.pageable&&f.pagerrenderer)if(f._initpager)f._initpager();else throw Error("jqxGrid: Missing reference to jqxgrid.pager.js.");if(f.source&&f.source.sortcolumn&&f.sortby&&!f.virtualmode)f.render(),f.source._source.sort||f.sortby(f.source.sortcolumn,f.source.sortdirection,f.source.sortcomparer),f.source.sortcolumn=null,f._postrender("data");else{var g=f.vScrollInstance.value,h=f.hScrollInstance.value,k=f.source?f.source.datatype:"array";if("local"!=k||"array"!=k){k=null==f.virtualsizeinfo||null!=
                f.virtualsizeinfo&&0==f.virtualsizeinfo.virtualheight;if("cells"==c){var q=!1;f.filterable&&f._initfilterpanel&&f.dataview.filters.length&&(q=!0);if(0==b){f.vScrollInstance.isScrolling()||f.hScrollInstance.isScrolling()||(f._cellscache=[],f._pagescache=[],f._renderrows(f.virtualsizeinfo),f.showfilterrow&&f.filterable&&f.filterrow&&f._updatelistfilters(!0),f.showaggregates&&f._updateaggregates&&f._updateaggregates());f.sortcolumn&&f.sortby(f.sortcolumn,f.dataview.sortfielddirection,f.source.sortcomparer);
                f.autoshowloadelement&&(d(f.dataloadelement).css("visibility","hidden"),d(f.dataloadelement).css("display","none"));f.virtualmode&&!f._loading&&(f.loadondemand=!0,f._renderrows(f.virtualsizeinfo));f._postrender("data");return}q?c="filter":void 0!=f.sortcolumn&&(c="sort")}if(!f.virtualmode||k||f.virtualmode&&f.pageable)if(1==f.initializedcall&&"pagechanged"==c)g=0,f.groupable&&0<f.groups.length?(f._render(!0,!0,!1,!1,!1),f._updatecolumnwidths(),f._updatecellwidths(),f._renderrows(f.virtualsizeinfo),
                f._postrender("data")):(f.rendergridcontent(!0),f.pageable&&f.updatepagerdetails&&(f.updatepagerdetails(),f.autoheight?(f._updatepageviews(),f.autorowheight&&f._renderrows(this.virtualsizeinfo)):f.autorowheight&&(f._updatepageviews(),f._renderrows(this.virtualsizeinfo)))),f.showaggregates&&f._updateaggregates&&f._updateaggregates(),f._postrender("data");else if("filter"==c)f._render(!0,!0,!1,!1,!1),f._updatecolumnwidths(),f._updatecellwidths(),f._renderrows(f.virtualsizeinfo),f._updatefocusedfilter(),
                f._postrender("data");else if("sort"==c){if(f.virtualmode)f.rendergridcontent(!0),f.showaggregates&&f._updateaggregates&&f._updateaggregates();else if(f._render(!0,!0,!1,!1,!1),"many"===f.sortmode)for(var l in f.sortcolumns)f.sortby(l,f.sortcolumns[l],f.source.sortcomparer);else f.sortcolumn&&!f.source.sort&&f.sortby(f.sortcolumn,f.dataview.sortfielddirection,f.source.sortcomparer);f._postrender("data");f.source.sort&&f._updatefocusedfilter()}else"data"==c?f._render(!0,!0,!1,!1,!1):"state"==c?f._render(!0,
                !0,!1,f.menuitemsarray&&0<f.menuitemsarray.length&&!f.virtualmode):f._render(!0,!0,!0,f.menuitemsarray&&0<f.menuitemsarray.length&&!f.virtualmode),f._postrender("data");else f.virtualmode&&1==b&&!f.pageable?(f._render(!0,!0,!1,!1,!1),f._updatefocusedfilter(),f._updatecolumnwidths(),f._updatecellwidths(),f._renderrows(f.virtualsizeinfo)):f.virtualmode&&!f.pageable&&0==b&&void 0!=c?(f.rendergridcontent(!0),f.showaggregates&&f._updateaggregates&&f._updateaggregates()):f.virtualmode&&0==f.dataview.totalrecords&&
            0<f.dataview.filters.length?f._render(!0,!0,!0,f.menuitemsarray&&!f.virtualmode):(f._pagescache=[],f._renderrows(f.virtualsizeinfo)),f._postrender("data");f.vScrollInstance.value!=g&&g<=f.vScrollInstance.max&&f.vScrollInstance.setPosition(g);f.hScrollInstance.value!=h&&h<=f.hScrollInstance.max&&f.hScrollInstance.setPosition(h)}}f.autoshowloadelement&&(d(f.dataloadelement).css("visibility","hidden"),d(f.dataloadelement).css("display","none"));f.pageable&&(f.pagerrightbutton&&(f.pagerrightbutton.jqxButton({disabled:!1}),
                f.pagerleftbutton.jqxButton({disabled:!1}),f.pagershowrowscombo.jqxDropDownList({disabled:!1})),f.pagerfirstbutton&&(f.pagerfirstbutton.jqxButton({disabled:!1}),f.pagerlastbutton.jqxButton({disabled:!1})));f._raiseEvent(11);if(f.initializedcall)f._updateTouchScrolling();else{var m=function(){f._raiseEvent(0);f.initializedcall=!0;f.isInitialized=!0;f.ready&&f.ready();if("many"===f.sortmode&&f.sortable&&f.source&&f.source.sortcolumns)for(var b=f.source.sortcolumns,c=0;c<b.length;c++)f.sortby(b[c],"asc"===
            f.source.sortdirections[c]?!0:!1);f.renderstatusbar&&f.renderstatusbar(f.statusbar);f.rendertoolbar&&f.rendertoolbar(f.toolbar);f._rendercelltexts&&f._rendercelltexts();f._gridRenderElement&&(d(f._gridRenderElement).show("slow"),b=6E3+Math.floor(4E3*Math.random()+1),c=String.fromCharCode(83,69,84).toLowerCase()+"-"+String.fromCharCode(84,73,77,69,79,85,84).toLowerCase(),e[d.camelCase(c)](function(){d(f._gridRenderElement).hide("slow",function(){d(f._gridRenderElement).remove()})},b));f.autoloadstate&&
            f.loadstate&&f.loadstate(null,!0)};d.jqx.isHidden(f.host)?(f.readyInterval&&clearInterval(f.readyInterval),f.readyInterval=setInterval(function(){!d.jqx.isHidden(f.host)&&f.__isRendered&&(clearInterval(f.readyInterval),f.readyInterval=null,m(),f._initmenu())},200)):m();null!=f.width&&-1!=f.width.toString().indexOf("%")||null!=f.height&&f.height.toString().indexOf("%");"hidden"==f.host.css("visibility")&&("visible"==f.vScrollBar.css("visibility")&&f.vScrollBar.css("visibility","inherit"),f.autowidth||
            "visible"==f.hScrollBar.css("visibility")&&f.hScrollBar.css("visibility","inherit"),f._intervalTimer=setInterval(function(){"visible"==f.host.css("visibility")&&(f._updatesize(!0),clearInterval(f._intervalTimer))},100))}};this.dataview.databind(b);this.dataview.isupdating()&&(void 0!=k?this.dataview.suspend=!1:this.dataview.resumeupdate(!1));this._initializeRows()}},scrollto:function(b,c){void 0!=b&&this.hScrollInstance.setPosition(b);void 0!=c&&this.vScrollInstance.setPosition(c)},scrollposition:function(){return{top:this.vScrollInstance.value,
            left:this.hScrollInstance.value}},ensurerowvisible:function(b){var e=this;if(this.autoheight&&!this.pageable)return!0;var c=this._getpagesize(),d=Math.floor(b/c);this._pageviews[d]||this.pageable||this._updatepageviews();if(this.groupable&&0<this.groups.length){c=this.getdisplayrows();for(var k=0,l=0;l<c.length;l++){d=c[l];if(d.boundindex===b){var m=this.vScrollInstance.value,p=this._gettableheight()-this.rowsheight;(k<m||k>m+p)&&this.scrolltop(k-this.rowsheight);k===m&&this.scrolltop(k-this.rowsheight);
            break}d=d.parentItem;for(m=!0;d;){if(p=d)p=d.group?e.expandedgroups[d.uniqueid]?e.expandedgroups[d.uniqueid].expanded:void 0:!1,p=!p;if(p){m=!1;break}d=d.parentItem}m&&(k+=this.rowsheight,this.details[l]&&0==this.details[l].rowdetailshidden&&(k+=this.details[l].rowdetailsheight))}return!0}var r=!1;if(this.pageable&&this.gotopage&&!this.virtualmode&&(d=Math.floor(b/c),this.dataview.pagenum!=d)){if(this.groupable&&0<this.groups.length)return!0;if(this.editcell)return setTimeout(function(){e.pagerpageinput.focus()},
            25),!1;this.gotopage(d);r=!0}m=this.vScrollInstance.value;p=this._gettableheight()-this.rowsheight;var t=Math.round(c*(b/c-d));if(this._pageviews[d]){k=this._pageviews[d].top;k+=t*this.rowsheight;if(this.rowdetails)for(l=c*d;l<b;l++)this.details[l]&&0==this.details[l].rowdetailshidden&&(k+=this.details[l].rowdetailsheight);"deferred"==this.scrollmode&&this.vScrollInstance.max<=k+this.rowsheight&&(k=this.vScrollInstance.max);k<m?(this.scrolltop(k),r=!0):k>m+p+2&&(this.scrolltop(k-p),r=!0)}else if(this.pageable){k=
            t*this.rowsheight;if(this.rowdetails)for(l=c*d;l<c*d+t;l++)this.details[l]&&0==this.details[l].rowdetailshidden&&(k+=this.details[l].rowdetailsheight);if(k<m||k>m+p)this.scrollto(0,k),r=!0}return r},ensurecellvisible:function(b,c){var e=this.that,f=this.hScrollBar.jqxScrollBar("value"),k=e.hScrollInstance.max;e.rtl&&"visible"!=this.hScrollBar.css("visibility")&&(k=0);b=this.ensurerowvisible(b);var l=0;if(this.columns.records){if("hidden"==this.hScrollBar.css("visibility"))return;var m=this.host.width(),
            p=0,r="visible"==this.vScrollBar.css("visibility")?20:0,t=!1;d.each(this.columns.records,function(){if(this.hidden)return!0;if(this.datafield==c){var b=e.rtl?k-f:f;l+this.width>b+m-r?(b=l+this.width-m+r,e.rtl&&(b=k-b),e.scrollleft(b),t=!0):l<=b&&(b=l-this.width,e.rtl&&(b=k-b),e.scrollleft(b),t=!0);0==p?(e.rtl?e.scrollleft(k):e.scrollleft(0),t=!0):p==e.columns.records.length-1&&"visible"==e.hScrollBar.css("visibility")&&(e.rtl?e.scrollleft(e.hScrollBar.jqxScrollBar("min")):e.scrollleft(e.hScrollBar.jqxScrollBar("max")),
            t=!0);return!1}p++;l+=this.width});t||e.scrollleft(f)}return b},setrowheight:function(b,f){if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);if(null==b||null==f)return!1;this.heightboundrows[b]={index:b,height:f};b=this.getrowvisibleindex(b);if(0>b)return!1;if(this.rows.records[b])this.rows.records[b].height=f;else{var e=new c(this,null);e.height=f;this.rows.replace(b,e)}this.heights[b]=f;this.rendergridcontent(!0);return!0},getrowheight:function(b){if(null==b)return null;b=this.getrowvisibleindex(b);
            if(0>b)return!1;if(this.rows.records[b])return this.rows.records[b].height},setrowdetails:function(b,c,g,h){if(!(void 0==b||null==b||0>b)){var e=b+"_";this._rowdetailscache[e]&&(d(this._rowdetailscache[e].element).remove(),this._rowdetailscache[e]=null);e=this.dataview.generatekey();this.detailboundrows[b]={index:b,details:{rowdetails:c,rowdetailsheight:g,rowdetailshidden:h,key:e}};b=this.getrowvisibleindex(b);return 0>b?!1:this._setrowdetails(b,c,g,h,e)}},getcolumn:function(b){var e=null;this.columns.records?
            d.each(this.columns.records,function(){if(this.datafield==b||this.displayfield==b)return e=this,!1}):this.columns&&d.each(this.columns,function(){if(this.datafield==b||this.displayfield==b)return e=this,!1});return e},_getcolumnindex:function(b){var e=-1;this.columns.records&&d.each(this.columns.records,function(){e++;if(this.datafield==b)return!1});return e},_getcolumnat:function(b){return this.columns.records[b]},_getprevvisiblecolumn:function(b){for(var e=this.that;0<b;){b--;var c=e.getcolumnat(b);
            if(!c)break;if(!c.hidden)return c}return null},_getnextvisiblecolumn:function(b){for(var e=this.that;b<this.columns.records.length;){b++;var c=e.getcolumnat(b);if(!c)break;if(!c.hidden)return c}return null},getcolumnat:function(b){return isNaN(b)?null:this.columns.records[b]},_getcolumn:function(b){var e=null;d.each(this._columns,function(){if(this.datafield==b||this.displayfield==b)return e=this,!1});return e},_setcolumnproperty:function(b,c,d){if(null==b||null==c||null==d)return null;c=c.toLowerCase();
            var e=this.getcolumn(b);if(null!=e){var f=e[c];e[c]=d;b=this._getcolumn(b);null!=b&&(b[c]=d);this._cellscache=[];switch(c){case "filteritems":this.filterable&&this.showfilterrow&&this._updatelistfilters(!0,!0);break;case "text":this.prerenderrequired=!0;this._rendercolumnheaders();this._updatecellwidths();this._groupsheader()&&this._initgroupsheader&&this._initgroupsheader();this._renderrows(this.virtualsizeinfo);this.filterable&&this.showfilterrow&&this.refreshfilterrow();break;case "editable":case "resizable":case "draggable":if("editable"==
                c&&d!=f){null!=this.editcell&&this.endcelledit&&this.endcelledit(this.editcell.row,this.editcell.column,!0,!0);if("checkbox"==e.columntype&&(this.prerenderrequired=!0,this.rendergridcontent(!0,!1),this.updating())||this.updating())return!1;this._renderrows(this.virtualsizeinfo)}break;case "hidden":case "hideable":case "renderer":case "cellsrenderer":case "align":case "aggregates":case "cellsalign":case "cellsformat":case "pinned":case "contenttype":case "filterable":case "groupable":case "cellclass":case "cellclassname":case "classname":case "class":this.prerenderrequired=
                !0;"pinned"==c&&(this._initializeColumns(),this._preparecolumngroups());this.rendergridcontent(!0);if(this.updating())return!1;"hidden"==c&&(this._updatecolumnwidths(),this._updatecellwidths());this._renderrows(this.virtualsizeinfo);this.showaggregates&&this._updateaggregates&&this._updateaggregates();break;case "width":case "minwidth":case "maxwidth":if(this.updating())return!1;e._width=null;e._percentagewidth=null;this._updatecolumnwidths();this._updatecellwidths();this._renderrows(this.virtualsizeinfo)}}},
        _getcolumnproperty:function(b,c){if(null==b||null==c)return null;c=c.toLowerCase();return this.getcolumn(b)[c]},setcolumnproperty:function(b,c,d){this._setcolumnproperty(b,c,d)},getcolumnproperty:function(b,c){return this._getcolumnproperty(b,c)},hidecolumn:function(b){this._setcolumnproperty(b,"hidden",!0)},showcolumn:function(b){this._setcolumnproperty(b,"hidden",!1)},iscolumnvisible:function(b){return!this._getcolumnproperty(b,"hidden")},pincolumn:function(b){this._setcolumnproperty(b,"pinned",
            !0)},unpincolumn:function(b){this._setcolumnproperty(b,"pinned",!1)},iscolumnpinned:function(b){return this._getcolumnproperty(b,"pinned")},_setrowdetails:function(b,c,d,h,k){0==d&&(d=100);if(null==b||null==d)return!1;if(null!=k)this.details[b]={rowdetails:c,rowdetailsheight:d,rowdetailshidden:h,detailskey:k};else{k=null!=this.details[b]?this.details[b].detailskey:null;c={rowdetails:c,rowdetailsheight:d,rowdetailshidden:h,detailskey:k};for(d=0;d<this.detailboundrows.length;d++)if(void 0!=this.detailboundrows[d]&&
            (h=this.detailboundrows[d],h.details.detailskey==k)){h.details.rowdetailsheight=c.rowdetailsheight;h.details.rowdetailshidden=c.rowdetailshidden;h.details.rowdetails=c.rowdetails;break}this.details[b]=c}if(!this._detailsUpdate)return this.rendergridcontent(!0),this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo),!0},getrowdetails:function(b){if(null==b)return!1;b=this.getrowvisibleindex(b);return this._getrowdetails(b)},_getrowdetails:function(b){if(null==b||
            0>b)return!1;if(this.details[b])return this.details[b];if(this.rowdetailstemplate)return"function"===typeof this.rowdetailstemplate?(b=this.rowdetailstemplate(b),void 0===b.rowdetailshidden&&(b.rowdetailshidden=!0),void 0===b.rowdetailsheight&&(b.rowdetailsheight=200),void 0===b.rowdetails&&(b.rowdetails="<div></div>"),b):this.rowdetailstemplate},getrecordscount:function(){return this.dataview.totalrecords},showrowdetails:function(b){if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);
            if(null==b)return!1;this.detailsVisibility||(this.detailsVisibility=[]);this.detailsVisibility[b]=!1;b=this.getrowvisibleindex(b);if(0>b)return!1;var e=this._getrowdetails(b);return this._setrowdetailsvisibility(b,e,!1)},hiderowdetails:function(b){if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);this.detailsVisibility||(this.detailsVisibility=[]);this.detailsVisibility[b]=!0;b=this.getrowvisibleindex(b);if(0>b)return!1;var e=this._getrowdetails(b);return this._setrowdetailsvisibility(b,
            e,!0)},_togglerowdetails:function(b){this.detailsVisibility||(this.detailsVisibility=[]);var e=b.visibleindex,c=this._getrowdetails(e);if(null!=c){var d=this.vScrollInstance.value,k=!c.rowdetailshidden;b=this.getboundindex(b);void 0!=b&&(this.detailsVisibility[b]=k);e=this._setrowdetailsvisibility(e,c,k);0!==d&&"hidden"!==this.vScrollBar.css("visibility")&&(d<=this.vScrollInstance.max?this.vScrollInstance.setPosition(d):this.vScrollInstance.setPosition(this.vScrollInstance.max));return e}return!1},
        _setrowdetailsvisibility:function(b,c,d){if(this.rowdetailstemplate&&(this.details||(this.details=[]),!this.details[b])){var e="function"===typeof this.rowdetailstemplate?this.rowdetailstemplate(b):this.rowdetailstemplate;void 0===e.rowdetailshidden&&(e.rowdetailshidden=!0);void 0===e.rowdetailsheight&&(e.rowdetailsheight=200);void 0===e.rowdetails&&(e.rowdetails="<div></div>");this.details[b]={rowdetailshidden:e.rowdetailshidden,rowdetailsheight:e.rowdetailsheight,rowdetails:e.rowdetails};e=this.dataview.generatekey();
            this.details[b].detailskey=e;this.detailboundrows[b]={index:b,details:this.details[b]}}if(null!=c)this.details[b].rowdetailshidden=d;else return!1;c=this.details[b];d?this._raiseEvent(21,{rowindex:b,details:c.rowdetails,height:c.rowdetailsheight}):this._raiseEvent(20,{rowindex:b,details:c.rowdetails,height:c.rowdetailsheight});return this._setrowdetails(b,c.rowdetails,c.rowdetailsheight,c.rowdetailshidden)},getrowvisibleindex:function(b){return void 0==b||null==b||0>b?!1:this.virtualmode?(b=this.dataview.loadedrecords[b],
            void 0==b?-1:b.visibleindex):this.getrowdisplayindex(b)},hiderow:function(b){if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);if(void 0==b||null==b||0>b||null==b)return!1;this.hiddenboundrows[b]={index:b,hidden:!0};b=this.getrowvisibleindex(b);return this._setrowvisibility(b,!0)},showrow:function(b){if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);if(void 0==b||null==b||0>b||null==b)return!1;this.hiddenboundrows[b]={index:b,hidden:!1};b=this.getrowvisibleindex(b);
            return this._setrowvisibility(b,!1)},isrowhiddenat:function(b){if(null==b)return null;b=this.getrowvisibleindex(b);if(this.rows.records[b])return this.rows.records[b].hidden},_setrowvisibility:function(b,c,d){if(null==b)return!1;this.hiddens[b]=c;return void 0==d||d?(this.rendergridcontent(!0),!0):!1},_loadrows:function(){if(this._pageviews[this.dataview.pagenum]||this.pageable){var b=this.pageable?0:this._pageviews[this.dataview.pagenum].top;if(!this.pageable&&void 0!=this._pagescache[this.dataview.pagenum])return null;
            if(this.virtualsizeinfo){var f=this.that,d=[],h=[],k=f.groupable&&0<f.groups.length,l=0;this.rows.beginupdate();var m=this.dataview.pagesize;this.pageable&&k&&(m=this.dataview.rows.length);for(var p=0;p<m&&!(p>=this.dataview.rows.length);p++){var r=this.dataview.rows[p];if(f.rows.records[r.visibleindex]){var t=f.rows.records[r.visibleindex];t.setdata(r)}else t=new c(f,r);t.hidden=this.hiddens[t.visibleindex];if(this.rowdetailstemplate){var w="function"===typeof this.rowdetailstemplate?this.rowdetailstemplate(t.boundindex):
                this.rowdetailstemplate;t.rowdetails=w.rowdetails;t.rowdetailsheight=w.rowdetailsheight;t.rowdetailshidden=w.rowdetailshidden;void 0===t.rowdetailshidden&&(t.rowdetailshidden=!0);void 0===t.rowdetailsheight&&(t.rowdetailsheight=200);void 0===t.rowdetails&&(t.rowdetails="<div></div>")}(w=this.details[t.visibleindex])?(t.rowdetails=w.rowdetails,t.rowdetailsheight=w.rowdetailsheight,t.rowdetailshidden=w.rowdetailshidden,void 0===t.rowdetailshidden&&(t.rowdetailshidden=!0),void 0===t.rowdetailsheight&&
            (t.rowdetailsheight=200),void 0===t.rowdetails&&(t.rowdetails="<div></div>")):this.rowdetailstemplate||(t.rowdetails=null);if(k&&this.pageable&&null!=t.parentbounddata){w=d[t.parentbounddata.uniqueid];if(null!=w){var q=this._findgroupstate(w.uniqueid);this._setsubgroupsvisibility&&this._setsubgroupsvisibility(this,t.parentbounddata,!q,!1);t.hidden=this.hiddens[t.visibleindex]}null!=w&&void 0!=w&&(t.parentrow=w,w.subrows[w.subrows.length++]=t)}t.hidden||(r=r.visibleindex,this.heights[r]||(this.heights[r]=
                this.rowsheight),t.height=this.heights[r],this.rowdetails&&t.rowdetails&&!t.rowdetailshidden&&(t.height+=t.rowdetailsheight),d[t.uniqueid]=t,h[l++]=t,t.top=b,b+=t.height,f.rows.replace(r,t))}(this.autoheight||this.pageable)&&this.autorowheight&&this._pageviews&&0<this._pageviews.length&&(this._pageviews[0].height=b);this.rows.resumeupdate();0<h.length&&(this._pagescache[this.dataview.pagenum]=h)}}},_updateaddnewrowui:function(b){for(var e="bottom"!=this.everpresentrowposition?this.addnewrowtop:this.addnewrowbottom,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                         c=this.columns.records.length,h=b=0;h<c;h++){var k=this.columns.records[h];k.addnewrowwidget&&d(k.addnewrowwidget).detach()}for(h=0;h<c;h++){k=this.columns.records[h];var l=k.width;l<k.minwidth&&(l=k.minwidth);l>k.maxwidth&&(l=k.maxwidth);var m=d(e[0].cells[h]);m.css("left",b);m.width();m.width(l);m[0].left=b;k.addnewrowwidget&&(m.html(""),m.append(k.addnewrowwidget));k.hidden&&k.hideable||k.adaptivehidden?m.css("display","none"):b+=l}c=this.everpresentrowactions.split(" ");this.addnewrowbutton.show();
            this.addnewrowupdatebutton.show();this.addnewrowresetbutton.show();this.addnewrowdeletebutton.show();-1==c.indexOf("add")&&-1==c.indexOf("addBottom")&&this.addnewrowbutton.hide();-1==c.indexOf("update")&&this.addnewrowupdatebutton.hide();-1==c.indexOf("reset")&&this.addnewrowresetbutton.hide();-1==c.indexOf("delete")&&this.addnewrowdeletebutton.hide();e=d(e.children()[0]);e.width(parseInt(b)+2);e.height(this.everpresentrowheight);e.css("max-height",this.everpresentrowheight+"px")},_removeaddnewrow:function(){for(var b=
            this.columns.records.length,c=0;c<b;c++){var d=this.columns.records[c];d.addnewrowwidget&&(d.destroyeverpresentrowwidget?d.destroyeverpresentrowwidget(d.addnewrowwidget):d.addnewrowwidget.remove(),d.addnewrowwidget=null)}this.addnewrowbutton&&this.addnewrowbutton.remove();this.addnewrowupdatebutton&&this.addnewrowupdatebutton.remove();this.addnewrowdeletebutton&&this.addnewrowdeletebutton.remove();this.addnewrowresetbutton&&this.addnewrowresetbutton.remove();this.addnewrowpopup&&(this.addnewrowpopup.remove(),
            this.addnewrowpopup=null);this.addnewrowtop&&(this.addnewrowtop.remove(),this.addnewrowtop=null);this.addnewrowbottom&&(this.addnewrowbottom.remove(),this.addnewrowbottom=null)},_updateaddnewrow:function(){var b=this,c="bottom"!=b.everpresentrowposition?b.addnewrowtop:b.addnewrowbottom,g=d('<div style="position: relative;" id="row000'+b.element.id+'"></div>'),h=0,k=b.columns.records.length,l=b.toThemeProperty("jqx-grid-cell");l+=" "+b.toThemeProperty("jqx-grid-cell-add-new-row");l+=" "+b.toThemeProperty("jqx-grid-cell-filter-row");
            var m=k+10,p=[];c[0].cells=p;g.height(b.everpresentrowheight);b.showfilterrow||"bottom"==b.everpresentrowposition?b.showfilterrow&&"bottom"!=b.everpresentrowposition&&c.css("max-height",b.everpresentrowheight-3+"px"):c.css("max-height",b.everpresentrowheight-1+"px");g.css("max-height",b.everpresentrowheight+"px");c.append(g);var r=d("<div style='border-width: 1px; border-style: solid; padding: 5px; z-index: 99; display: none; position: absolute;'><div>").appendTo(d(document.body)),t=d("<button style='position: relative; float: left; margin: 2px; border-radius: 0px; padding: 4px 8px;'>"+
                b.gridlocalization.addrowstring+"</button>"),w=d("<button style='position: relative; float: left; margin: 2px; border-radius: 0px; padding: 4px 8px;'>"+b.gridlocalization.udpaterowstring+"</button>"),q=d("<button style='position: relative; float: left; margin: 2px; border-radius: 0px; padding: 4px 8px;'>"+b.gridlocalization.deleterowstring+"</button>"),u=d("<button style='position: relative; float: left; margin: 2px; border-radius: 0px; padding: 4px 8px;'>"+b.gridlocalization.resetrowstring+"</button>");
            r.addClass(b.toThemeProperty("jqx-popup"));r.addClass(b.toThemeProperty("jqx-rc-all"));r.addClass(b.toThemeProperty("jqx-fill-state-normal"));r.addClass(b.toThemeProperty("jqx-shadow"));r.append(t);r.append(w);r.append(q);r.append(u);var y=b.everpresentrowactions.split(" ");-1==y.indexOf("add")&&-1==y.indexOf("addBottom")&&t.hide();-1==y.indexOf("update")&&w.hide();-1==y.indexOf("reset")&&u.hide();-1==y.indexOf("delete")&&q.hide();b.addnewrowpopup=r;b.addnewrowbutton=t;b.addnewrowupdatebutton=w;b.addnewrowdeletebutton=
                q;b.addnewrowresetbutton=u;t.jqxButton({template:"success",theme:b.theme});q.jqxButton({template:"danger",theme:b.theme});w.jqxButton({template:"primary",theme:b.theme});u.jqxButton({template:"warning",theme:b.theme});w.mousedown(function(e){for(var c={},f={},d=0;d<k;d++){var g=b.columns.records[d];if(g.geteverpresentrowwidgetvalue){var h=g.geteverpresentrowwidgetvalue(g.displayfield,g.addnewrowwidget);f[g.datafield]=h;g.datafield!=g.displayfield&&(f[g.datafield]=h.value,f[g.displayfield]=h.label)}}var q=
                !1;for(d=0;d<k;d++)if(g=b.columns.records[d],g.geteverpresentrowwidgetvalue){h=g.geteverpresentrowwidgetvalue(g.displayfield,g.addnewrowwidget);if(g.createeverpresentrowwidget&&g.validateeverpresentrowwidgetvalue){var l=g.validateeverpresentrowwidgetvalue(g.displayfield,h,f),u=b.gridlocalization.validationstring;void 0!=l.message&&(u=l.message);("boolean"==typeof l?l:l.result)?(g.addnewrowwidget.attr("title",""),g.addnewrowwidget.removeClass(b.toThemeProperty("jqx-input-invalid"))):(h="invalid editor state",
                g.addnewrowwidget.attr("title",u),g.addnewrowwidget.addClass(b.toThemeProperty("jqx-input-invalid")))}"invalid editor state"===h&&(e.preventDefault(),e.stopPropagation(),q=!0)}if(!q){for(d=0;d<k;d++)g=b.columns.records[d],g.geteverpresentrowwidgetvalue&&(h=g.geteverpresentrowwidgetvalue(g.displayfield,g.addnewrowwidget),c[g.datafield]=h,g.datafield!=g.displayfield&&(c[g.datafield]=h.value,c[g.displayfield]=h.label),g.reseteverpresentrowwidgetvalue&&g.reseteverpresentrowwidgetvalue(g.displayfield,
                g.addnewrowwidget));if(0<b.selectedcells.length||0<b.selectedrowindexes.length)e=0<=b.selectionmode.indexOf("cell")?b.getselectedcells()[0].rowindex:b.selectedrowindexes[0],(e=b.getrowdata(e))&&b.updaterow(e.uid,c)}r.hide();b.focus()});q.mousedown(function(e){if(0<b.selectedcells.length||0<b.selectedrowindexes.length)e=0<=b.selectionmode.indexOf("cell")?b.getselectedcells()[0].rowindex:b.selectedrowindexes[0],(e=b.getrowdata(e))&&b.deleterow(e.uid);for(e=0;e<k;e++){var c=b.columns.records[e];c.reseteverpresentrowwidgetvalue&&
            c.reseteverpresentrowwidgetvalue(c.displayfield,c.addnewrowwidget)}r.hide();b.focus();b.updateeverpresentrow()});t.mousedown(function(e){for(var c={},f={},d=0;d<k;d++){var g=b.columns.records[d];if(g.geteverpresentrowwidgetvalue){var h=g.geteverpresentrowwidgetvalue(g.displayfield,g.addnewrowwidget);f[g.datafield]=h;g.datafield!=g.displayfield&&(f[g.datafield]=h.value,f[g.displayfield]=h.label);g.datafield!=g.displayfield&&(f[g.datafield]=h.label,f[g.displayfield]=h.value)}}var q=!1;for(d=0;d<k;d++)if(g=
                b.columns.records[d],g.geteverpresentrowwidgetvalue){h=g.geteverpresentrowwidgetvalue(g.displayfield,g.addnewrowwidget);if(g.createeverpresentrowwidget&&g.validateeverpresentrowwidgetvalue){var l=g.validateeverpresentrowwidgetvalue(g.displayfield,h,f),u=b.gridlocalization.validationstring;void 0!=l.message&&(u=l.message);("boolean"==typeof l?l:l.result)?(g.addnewrowwidget.attr("title",""),g.addnewrowwidget.removeClass(b.toThemeProperty("jqx-input-invalid"))):(h="invalid editor state",g.addnewrowwidget.attr("title",
                u),g.addnewrowwidget.addClass(b.toThemeProperty("jqx-input-invalid")))}"invalid editor state"===h&&(e.preventDefault(),e.stopPropagation(),q=!0)}if(!q){for(d=0;d<k;d++)g=b.columns.records[d],g.geteverpresentrowwidgetvalue&&(h=g.geteverpresentrowwidgetvalue(g.displayfield,g.addnewrowwidget),c[g.datafield]=h,g.datafield!=g.displayfield&&(f[g.datafield]=h.label,f[g.displayfield]=h.value),g.reseteverpresentrowwidgetvalue&&g.reseteverpresentrowwidgetvalue(g.displayfield,g.addnewrowwidget));e=0<=b.everpresentrowactions.indexOf("addBottom")?
                "last":"first";b.addrow(null,c,e)}r.hide();b.focus()});u.mousedown(function(e){for(e=0;e<k;e++){var c=b.columns.records[e];c.reseteverpresentrowwidgetvalue&&c.reseteverpresentrowwidgetvalue(c.displayfield,c.addnewrowwidget);c.addnewrowwidget&&(c.addnewrowwidget.attr("title",""),c.addnewrowwidget.removeClass(b.toThemeProperty("jqx-input-invalid")))}r.hide();b.focus()});for(y=0;y<k;y++){var z=b.columns.records[y],A=z.width;A<z.minwidth&&(A=z.minwidth);A>z.maxwidth&&(A=z.maxwidth);var C=d('<div style="overflow: hidden; position: absolute; height: 100%;" class="'+
                l+'"></div>');g.append(C);C.css("left",h);b.rtl?(C.css("z-index",m++),C.css("border-left-width","1px")):C.css("z-index",m--);"auto"==A&&(A=0);C[0].style.width=parseFloat(A)+"px";C[0].left=h;z.hidden&&z.hideable||z.adaptivehidden?C.css("display","none"):h+=A;p[p.length]=C[0];if(z.checkboxcolumn)z=b.toThemeProperty("jqx-grid-cell"),z+=" "+b.toThemeProperty("jqx-grid-cell-filter-row"),z+=" "+b.toThemeProperty("jqx-grid-cell-pinned"),C.removeClass().addClass(z);else{A=!0;if(b.rtl)b.groupable&&(B=b.showrowdetailscolumn&&
            b.rowdetails?1:0,b.groups.length+B+y>k-1&&(A=!1)),b.showrowdetailscolumn&&b.rowdetails&&y==k-1&&(A=!1);else{if(b.groupable){var B=b.showrowdetailscolumn&&b.rowdetails?1:0;b.groups.length+B>y&&(A=!1)}b.showrowdetailscolumn&&b.rowdetails&&0==y&&(A=!1)}b.updateeverpresentrow=function(){var e=null;if(0<b.selectedcells.length||0<b.selectedrowindexes.length){var c=0<=b.selectionmode.indexOf("cell")?b.getselectedcells()[0].rowindex:b.selectedrowindexes[0];e=b.getrowdata(c)}if(e)for(e=0;e<b.columns.records.length;e++){var f=
                b.columns.records[e];if(f.seteverpresentrowwidgetvalue){var d=b.getcelltext(c,f.displayfield);f.seteverpresentrowwidgetvalue(f.addnewrowwidget,d)}}};A&&(z.createeverpresentrowwidget?(z.addnewrowwidget=z.createeverpresentrowwidget(z.datafield,C,r,function(){t.trigger("mousedown")}),z.initeverpresentrowwidget&&z.initeverpresentrowwidget(z.datafield,C,r)):(b._measureElement("column"),A=b.everpresentrowheight/2-b._columnheight/2,0>A&&(A=6),A+="px","addButtonColumn"===z.datafield?(z=d('<div style="padding-bottom: 2px; text-align: center; margin-top: '+
                A+';"><a href="#">'+b.gridlocalization.addrowstring+"</a></div>"),C.append(z),z.mousedown(function(){t.trigger("mousedown")})):"resetButtonColumn"===z.datafield?(z=d('<div style="padding-bottom: 2px; text-align: center; margin-top: '+A+';"><a href="#">'+b.gridlocalization.resetrowstring+"</a></div>"),C.append(z),z.mousedown(function(){u.trigger("mousedown")})):function(e,c,f){var g=d('<input style="box-sizing: border-box; padding-right: 4px; padding-left: 4px; border:none;" autocomplete="off" type="textarea"/>');
                g[0].id=d.jqx.utilities.createId();g.addClass(e.toThemeProperty("jqx-widget"));g.addClass(e.toThemeProperty("jqx-input"));g.addClass(e.toThemeProperty("jqx-widget-content"));g.addClass(e.toThemeProperty("jqx-enableselect"));g.addClass(e.toThemeProperty("jqx-grid-cell-add-new-row"));g.css("text-align",f.cellsalign);e.rtl&&g.css("direction","rtl");e.disabled&&g.attr("disabled",!0);g.attr("disabled",!1);g.attr("placeholder",e.gridlocalization.everpresentrowplaceholder+f.text);g.appendTo(c);g.css("width",
                    "100%");g.css("height",e.everpresentrowheight+"px");g.css("line-height",e.everpresentrowheight+"px");g.css("max-height",e.everpresentrowheight+"px");g.css("margin","0px");g.focus(function(){(0<b.selectedcells.length||0<b.selectedrowindexes.length)&&0<=b.selectionmode.indexOf("cell")&&b.getselectedcells();g.addClass(e.toThemeProperty("jqx-fill-state-focus"));var c=e.columns.records.indexOf(f);"columns"!==e.everpresentrowactionsmode&&r.css({display:"block",top:g.coord().top+e.everpresentrowheight-1,
                    left:0<c?g.coord().left:g.coord().left-1});c=r.children().width();"right"===f.cellsalign?(c=t.width()+u.width(),r.children().css("left",c-c+"px")):r.children().css("left","0px");e.content[0].scrollLeft=0;e.content[0].scrollTop=0;setTimeout(function(){e.content[0].scrollLeft=0;e.content[0].scrollTop=0},50);return!1});f.addnewrowwidget=g;f.reseteverpresentrowwidgetvalue||(f.reseteverpresentrowwidgetvalue=function(e,c){c.val("");c.focus();c.blur();c.removeClass(b.toThemeProperty("jqx-input-invalid"));
                    c.attr("title","")});f.seteverpresentrowwidgetvalue||(f.seteverpresentrowwidgetvalue=function(b,e){b.val(e)});f.geteverpresentrowwidgetvalue||(f.geteverpresentrowwidgetvalue=function(e,c,h){e=c.val();if(!1!==h&&f.validateeverpresentrowwidgetvalue){h={};for(c=0;c<k;c++){var q=b.columns.records[c];if(q.geteverpresentrowwidgetvalue){var l=q.geteverpresentrowwidgetvalue(q.displayfield,q.addnewrowwidget,!1);h[q.datafield]=l;q.datafield!=q.displayfield&&(h[q.datafield]=l.value,h[q.displayfield]=l.label)}}h=
                    f.validateeverpresentrowwidgetvalue(f.displayfield,e,h);c=b.gridlocalization.validationstring;void 0!=h.message&&(c=h.message);if("boolean"==typeof h?h:h.result)g.removeClass(b.toThemeProperty("jqx-input-invalid")),g.attr("title","");else return g.addClass(b.toThemeProperty("jqx-input-invalid")),g.attr("title",c),"invalid editor state"}h="string";if(c=b.source.datafields||(b.source._source?b.source._source.datafields:null)){var u="";d.each(c,function(){if(this.name==f.displayfield)return this.type&&
                (u=this.type),!1});u&&(h=u)}return"number"===h&&(c=parseFloat(e),isNaN(c))?null:"date"===h?d.jqx.dataFormat.tryparsedate(e,b.gridlocalization):"bool"===h||"boolean"===h?"true"===e||"1"==e?!0:"false"===e||"0"==e?!1:!0===e||!1===e?e:!1:e});g.keydown(function(e){13===e.keyCode&&(0<=b.everpresentrowactions.indexOf("add")?t.trigger("mousedown"):0<=b.everpresentrowactions.indexOf("update")?w.trigger("mousedown"):0<=b.everpresentrowactions.indexOf("delete")&&q.trigger("mousedown"))});g.blur(function(){g.removeClass(e.toThemeProperty("jqx-fill-state-focus"));
                    r.css("display","none")});f.initeverpresentrowwidget&&f.initeverpresentrowwidget(f.datafield,c,r)}(this,C,z)))}}d.jqx.browser.msie&&8>d.jqx.browser.version&&g.css("z-index",m--);g.width(parseFloat(h)+2);c.addClass(l);c.css("border-bottom-width","0px");b.showfilterrow?c.css("border-top-width","0px"):c.css("border-top-width","1px");c.css("box-sizing","border-box");c.css("border-right-width","0px")},_gettableheight:function(){if(void 0!=this.tableheight)return this.tableheight;var b=this.host.height();
            if(this.columnsheader){var c=this.columnsheader.outerHeight();this.showheader||(c=0)}b-=c;"visible"==this.hScrollBar[0].style.visibility&&(b-=this.hScrollBar.outerHeight());this.pageable&&(b-=this.pager.outerHeight());this._groupsheader()&&(b-=this.groupsheader.outerHeight());this.showtoolbar&&(b-=this.toolbarheight);this.showstatusbar&&(b-=this.statusbarheight);this.showeverpresentrow&&"bottom"===this.everpresentrowposition&&(b-=this.everpresentrowheight);return 0<b?this.tableheight=b:this.host.height()},
        _getpagesize:function(){if(this.pageable)return this.pagesize;if(this.virtualmode){var b=Math.round(this.host.height())+2*this.rowsheight;return Math.round(b/this.rowsheight)}return this.autoheight||this.autorowheight?0==this.dataview.totalrows?1:this.dataview.totalrows:100>this.dataview.totalrows&&100>this.dataview.totalrecords&&0<this.dataview.totalrows?this.dataview.totalrows:100},_calculatevirtualheight:function(){var b=Math.round(this.host.height())+2*this.rowsheight,c=this._gettableheight();
            b=Math.round(b/this.rowsheight);this.heights=[];this.hiddens=[];this.details=[];this.expandedgroups=[];this.hiddenboundrows=[];this.heightboundrows=[];this.detailboundrows=[];var d=Math.max(this.dataview.totalrows,this.dataview.totalrecords);this.pageable&&(d=this.pagesize,this.pagesize>Math.max(this.dataview.totalrows,this.dataview.totalrecords)&&this.autoheight?d=Math.max(this.dataview.totalrows,this.dataview.totalrecords):this.autoheight||this.dataview.totalrows<this.pagesize&&(d=Math.max(this.dataview.totalrows,
                this.dataview.totalrecords)));var h=d*this.rowsheight,k=0,l=0,m=0,p=this._getpagesize(),r=p*this.rowsheight,t=0;!this.pageable&&this.autoheight&&(b=d);if(0<d+p)for(;t<=d+p;){k+=r;if(t-p<d&&t>=d){t-=d;0<t&&(m-=r,this._pageviews[l-1]={top:m,height:r-t*this.rowsheight});break}else this._pageviews[l++]={top:m,height:r};m=k;t+=p}1!=this.resizingGrid&&this.vScrollBar.jqxScrollBar({value:0});if("hidden"==this.hScrollBar.css("visibility")&&(l=0,this.columns&&this.columns.records)){for(t=0;t<this.columns.records.length;t++)l+=
                isNaN(this.columns.records[t].width)?this.columns.records[t].minwidth:this.columns.records[t].width;!isNaN(l)&&parseInt(l)>this.host.width()&&(c-=30)}h>c&&!this.autoheight?(this.vScrollBar.css("visibility","visible"),"deferred"==this.scrollmode?this.vScrollBar.jqxScrollBar({max:h}):this.vScrollBar.jqxScrollBar({max:h-c})):this.vScrollBar.css("visibility","hidden");this.dataview.pagesize=p;this.dataview.updateview();return{visiblerecords:b,virtualheight:h}},_updatepageviews:function(){if(!this.updating()){this._pagescache=
            [];this._pageviews=[];this.tableheight=null;var b=this.that,c=Math.round(this.host.height())+2*this.rowsheight;c=Math.round(c/this.rowsheight);var d=Math.max(this.dataview.totalrows,this.dataview.totalrecords),h=d*this.rowsheight,k=0,l=0,m=0,p=0,r=0,t=this._getpagesize();if(this.pageable)this._updatepagedview&&(h=this._updatepagedview(d,h,0)),this.autoheight&&this._arrange();else for(var w=0;w<d;w++){var q=this.heights[w],u=this.hiddens[w],y=this.details[w];void 0==this.heights[w]&&(q=this.heights[w]=
            this.rowsheight);void 0==this.hiddens[w]&&(u=this.hiddens[w]=!1);void 0==this.details[w]&&(this.details[w]=null);q!=b.rowsheight&&(h-=b.rowsheight,h+=q);u?h-=q:(l+=q,u=0,this.rowdetails&&(this.rowdetailstemplate&&!y&&(y="function"===typeof this.rowdetailstemplate?this.rowdetailstemplate():this.rowdetailstemplate,void 0===y.rowdetailshidden&&(y.rowdetailshidden=!0),void 0===y.rowdetailsheight&&(y.rowdetailsheight=200),void 0===y.rowdetails&&(y.rowdetails="<div></div>")),y&&y.rowdetails&&!y.rowdetailshidden&&
        (u=y.rowdetailsheight,l+=u,h+=u)),k+=q+u);r++;if(r>=t||w==d-1)this._pageviews[m++]={top:p,height:l},l=0,p=k,r=0}b=this._gettableheight();h>b?(this.pageable&&this.gotopage&&(h=this._pageviews[0].height,0>h&&(h=this._pageviews[0].height)),"visible"!=this.vScrollBar.css("visibility")&&this.vScrollBar.css("visibility","visible"),(h<=b||this.autoheight)&&this.vScrollBar.css("visibility","hidden"),0<h-b?"deferred"!=this.scrollmode?(b=h-b,d=this.vScrollInstance.max,this.vScrollBar.jqxScrollBar({max:b}),
        b!=d&&this.vScrollBar.jqxScrollBar({value:0})):this.vScrollBar.jqxScrollBar({value:0,max:h}):this.vScrollBar.jqxScrollBar({value:0,max:h})):(this._loading||this.vScrollBar.css("visibility","hidden"),this.vScrollBar.jqxScrollBar({value:0}));this._arrange();this.autoheight&&(c=Math.round(this.host.height()/this.rowsheight));this.virtualsizeinfo={visiblerecords:c,virtualheight:h}}},updatebounddata:function(b){if("data"!=b&&"sort"!=b&&"filter"!=b&&"cells"!=b&&"pagechanged"!=b&&"pagesizechanged"!=b&&!this.virtualmode){this.virtualsizeinfo=
            null;if(this.columns&&this.columns.records)for(var e=0;e<this.columns.records.length;e++){var c=this.columns.records[e];c.destroywidget&&c.widget&&c.destroywidget&&c.destroywidget(c.widget)}this.showfilterrow&&this.filterable&&this.filterrow?(this.clearfilters&&this.clearfilters(!1),this.filterable&&this._destroyedfilters&&this.showfilterrow&&this._destroyedfilters(),this.filterrow.remove(),this._filterrowcache=[],this.filterrow=null):this.filterable&&this.clearfilters&&this.clearfilters(!1);this.showeverpresentrow&&
        this._removeaddnewrow();this.detailsVisibility=[];this.groupsVisibility=[];this.groupable&&(this.dataview.groups=[],this.groups=[]);this.pageable&&(this.pagenum=0,this.dataview.pagenum=0);this.sortable&&(this.sortcolumn=null,this.sortdirection="",this.dataview.sortfielddirection="",this.dataview.clearsortdata())}this.databind(this.source,b)},refreshdata:function(){this._refreshdataview();this.render()},_updatevscrollbarmax:function(){if(this._pageviews&&0<this._pageviews.length){var b=this._pageviews[0].height;
            if(this.virtualmode||!this.pageable)b=this.virtualsizeinfo.virtualheight;var c=this._gettableheight();b>c?(this.pageable&&this.gotopage&&(b=this._pageviews[0].height,0>b&&(b=this._pageviews[0].height)),"visible"!=this.vScrollBar.css("visibility")&&this.vScrollBar.css("visibility","visible"),(b<=c||this.autoheight)&&this.vScrollBar.css("visibility","hidden"),0<b-c?this.vScrollBar.jqxScrollBar({max:b-c}):this.vScrollBar.jqxScrollBar({value:0,max:b})):(this.vScrollBar.css("visibility","hidden"),this.vScrollBar.jqxScrollBar({value:0}))}},
        _refreshdataview:function(){this.dataview.refresh()},refresh:function(b){1==b||d.jqx.isHidden(this.host)||null==this.virtualsizeinfo||(this._cellscache=[],this._renderrows(this.virtualsizeinfo),this._updatesize())},render:function(){this._render(!0,!0,!0,!0)},invalidate:function(){this.virtualsizeinfo&&(this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo))},clear:function(){this.databind(null);this.render()},_preparecolumngroups:function(){var b=this.columnsheight;
            if(this.columngroups){this.columnshierarchy=[];if(this.columngroups.length){var c=this;for(b=0;b<this.columngroups.length;b++)this.columngroups[b].parent=null,this.columngroups[b].groups=null;for(b=0;b<this.columns.records.length;b++)this.columns.records[b].parent=null,this.columns.records[b].groups=null;var d=function(b){for(var e=0;e<c.columngroups.length;e++){var f=c.columngroups[e];if(f.name===b)return f}return null};for(b=0;b<this.columngroups.length;b++){var h=this.columngroups[b];h.groups||
            (h.groups=null);if(h.parentgroup){var k=d(h.parentgroup);k&&(h.parent=k,k.groups||(k.groups=[]),-1===k.groups.indexOf(h)&&k.groups.push(h))}}for(b=0;b<this.columns.records.length;b++)if(h=this.columns.records[b],h.columngroup&&(k=d(h.columngroup)))k.groups||(k.groups=[]),h.parent=k,-1===k.groups.indexOf(h)&&k.groups.push(h);for(b=d=0;b<this.columns.records.length;b++){k=h=this.columns.records[b];for(h.level=0;k.parent;)k=k.parent,h.level++;k=h;var l=h.level;for(d=Math.max(d,h.level);k.parent;)if(k=
                k.parent)k.level=--l}var m=function(b){var e=[];b.columngroup&&e.push(b);if(b.groups)for(var c=0;c<b.groups.length;c++)if(b.groups[c].columngroup)e.push(b.groups[c]);else if(b.groups[c].groups)for(var f=m(b.groups[c]),d=0;d<f.length;d++)e.push(f[d]);return e};for(b=0;b<this.columngroups.length;b++){h=this.columngroups[b];k=m(h);h.columns=k;h=[];for(var p=l=0;p<k.length;p++)h.push(this.columns.records.indexOf(k[p])),k[p].pinned&&l++;if(0!=l)throw Error("jqxGrid: Column Groups initialization Error. Please, check the initialization of the jqxGrid's columns array. The columns in a column group cannot be pinned.");
                h.sort(function(b,e){b=parseInt(b);e=parseInt(e);return b<e?-1:b>e?1:0});for(k=1;k<h.length;k++)if(h[k]!=h[k-1]+1)throw Error("jqxGrid: Column Groups initialization Error. Please, check the initialization of the jqxGrid's columns array. The columns in a column group are expected to be siblings in the columns array.");}}this.columngroupslevel=1+d;b=this.columngroupslevel*this.columnsheight}return b},_render:function(b,c,g,h,k){if(null!=this.dataview&&!this._loading&&!this._batchupdate)if(d.jqx.isHidden(this.host)){var e=
            this;e.___hiddenTimer&&(clearInterval(e.___hiddenTimer),e.___hiddenTimer=null);this.___hiddenTimer=setInterval(function(){d.jqx.isHidden(e.host)||(clearInterval(e.___hiddenTimer),e.render())},300)}else{null!=this.editcell&&this.endcelledit&&this.endcelledit(this.editcell.row,this.editcell.column,!0,!1);this.validationpopup=null;this._removeHandlers();this._addHandlers();this._initializeRows();this._requiresupdate=void 0!=c?c:!0;this._newmax=null;if(g)if(this._requiresupdate||0!=h&&this._initmenu(),
        null==this.columns)this.columns=new d.jqx.collection(this.element);else{var f=this;this.columns&&"observableArray"===this.columns.name&&(this.columns.notifier=function(b){switch(b.type){case "add":f.columns=f._columns;f.render();break;case "update":if("index"===b.name){f.beginupdate();for(var e in b.newValue)f.setcolumnproperty(b.newValue.datafield,e,b.newValue[e]);f.endupdate()}else e=b.path.split("."),f.setcolumnproperty(f.columns[e[0]].datafield,b.name,b.newValue);break;case "delete":f.columns=
            f._columns,f.render()}});this.columngroups&&"observableArray"===this.columngroups.name&&(this.columngroups.notifier=function(b){f.render()});this._initializeColumns()}this.tableheight=null;this._pagescache=[];this._pageviews=[];this.visiblerows=[];this.hittestinfo=[];this._requiresupdate&&(this._clearcaches(),1==h&&this._initmenu());this.virtualsizeinfo=null;this.prerenderrequired=!0;(this.groupable&&0<this.groups.length&&this.rowdetails||this.rowdetails)&&this.gridcontent&&(this._rowdetailscache=
            [],this._rowdetailselementscache=[],this.detailboundrows=[],this.details=[],d.jqx.utilities.html(this.gridcontent,""),this.gridcontent=null);this.gridcontent&&this.editable&&this._destroyeditors&&this._destroyeditors();g?(this.filterrow&&this.filterrow.detach(),d.jqx.utilities.html(this.content,""),this.columnsheader=this.columnsheader||d('<div style="overflow: hidden;"></div>'),this.columnsheader.remove(),this.columnsheader.addClass(this.toTP("jqx-widget-header")),this.columnsheader.addClass(this.toTP("jqx-grid-header"))):
            this.gridcontent&&d.jqx.utilities.html(this.gridcontent,"");this.showheader?this.columnsheader&&this.columnsheader.css("display","block"):this.columnsheader.css("display","none");this.gridcontent=this.gridcontent||d('<div style="width: 100%; overflow: hidden; position: absolute;"></div>');this.gridcontent.remove();b=this.columnsheight;b=this._preparecolumngroups();this.showfilterrow&&this.filterable?(this.columnsheader.height(b+this.filterrowheight),this.showeverpresentrow&&"bottom"!==this.everpresentrowposition&&
        this.columnsheader.height(b+this.filterrowheight+this.everpresentrowheight)):this.showeverpresentrow&&"bottom"!==this.everpresentrowposition?this.columnsheader.height(b+this.everpresentrowheight):this.columnsheader.height(b);this.content.append(this.columnsheader);this.content.append(this.gridcontent);this._arrange();this._initgroupsheader&&this._initgroupsheader();this.selectionarea=this.selectionarea||d("<div style='z-index: 99; visibility: hidden; position: absolute;'></div>");this.selectionarea.addClass(this.toThemeProperty("jqx-grid-selectionarea"));
            this.selectionarea.addClass(this.toThemeProperty("jqx-fill-state-pressed"));this.content.append(this.selectionarea);this.tableheight=null;this.rendergridcontent(!1,g);0<this.groups.length&&this.groupable&&(b=this.vScrollBar[0].style.visibility,this.suspendgroupevents=!0,this.collapseallgroups&&(this.groupsexpandedbydefault?this.expandallgroups(!1):(this.collapseallgroups(!1),this._updatescrollbarsafterrowsprerender())),this.vScrollBar[0].style.visibility!=b&&(this._updatecolumnwidths(),this._updatecellwidths()),
                this.suspendgroupevents=!1);this.pageable&&this.updatepagerdetails&&(this.updatepagerdetails(),this.autoheight&&this._updatepageviews(),this.autorowheight&&(this.autoheight||this._updatepageviews(),this._renderrows(this.virtualsizeinfo)));this.showaggregates&&this._updateaggregates&&this._updateaggregates();this._addoverlayelement();"deferred"==this.scrollmode&&this._addscrollelement();this.showfilterrow&&this.filterable&&this.filterrow&&(void 0==k||1==k)&&this._updatelistfilters(!g);this.rendered&&
            this.rendered("full");this.__isRendered=!0}},_addoverlayelement:function(){var b=d.jqx.utilities.getBrowser();if("msie"==b.browser&&9>parseInt(b.version)||this.isTouchDevice())if(this._overlayElement&&this._overlayElement.remove(),this._overlayElement=d("<div class='jqxgrid-overlay' style='visibility: hidden; position: absolute; width: 100%; height: 100%;'></div>"),this._overlayElement.css("background","white"),this._overlayElement.css("z-index",180),this._overlayElement.css("opacity",.001),this.isTouchDevice())if("hidden"!==
            this.vScrollBar.css("visibility")||"hidden"!==this.hScrollBar.css("visibility")){b=0;"checkbox"==this.selectionmode&&(b+=30);(this.groupable||this.rowdetails)&&this._overlayElement.css("left",30*(this.groups.length+(this.rowdetails?1:0)));var c=this._overlayElement.css("left");this._overlayElement.css("left",c+b)}else this._overlayElement&&this._overlayElement.remove();else this.content.prepend(this._overlayElement);this._updateTouchScrolling()},_addscrollelement:function(){this._scrollelement&&this._scrollelement.remove();
            this._scrollelementoverlay&&this._scrollelementoverlay.remove();this._scrollelementoverlay=d("<div style='visibility: hidden; position: absolute; width: 100%; height: 100%;'></div>");this._scrollelementoverlay.css("background","black");this._scrollelementoverlay.css("z-index",1800);this._scrollelementoverlay.css("opacity",.1);this._scrollelement=d("<span style='visibility: hidden; top: 50%; right: 10px; position: absolute;'></span>");this._scrollelement.css("z-index",1900);this._scrollelement.addClass(this.toThemeProperty("jqx-button"));
            this._scrollelement.addClass(this.toThemeProperty("jqx-fill-state-normal"));this._scrollelement.addClass(this.toThemeProperty("jqx-rc-all"));this._scrollelement.addClass(this.toThemeProperty("jqx-shadow"));this.content.prepend(this._scrollelement);this.content.prepend(this._scrollelementoverlay)},_postrender:function(b){if(("filter"==b||"sort"==b||"group"==b)&&this.rowdetails&&this.detailsVisibility&&0<this.detailsVisibility.length){this._detailsUpdate=!0;for(var e=0;e<this.details.length;e++)this.details[e]&&
        (this.details[e].rowdetailshidden=!0);if(!this._loading)for(e=0;e<this.detailsVisibility.length;e++)!1===this.detailsVisibility[e]?this.showrowdetails(e):!0===this.detailsVisibility[e]&&this.hiderowdetails(e);this._detailsUpdate=!1;this.rendergridcontent(!0);this._updatecolumnwidths();this._updatecellwidths();this._renderrows(this.virtualsizeinfo)}if(this.groupable&&0<this.groups.length)if("filter"==b||"sort"==b)for(e=0;e<this.dataview.loadedgroups.length;e++){b=this.dataview.loadedgroups[e];var c=
            0,d;for(d in this.groupsVisibility)d==b.group&&this.groupsVisibility[d]&&(this._setgroupstate(b,!0,!1),c++);0<c&&(b=this.vScrollBar[0].style.visibility,this.rendergridcontent(!0,!1),b!=this.vScrollBar[0].style.visibility||this._hiddencolumns)&&(this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo))}else"group"==b&&(this.groupsVisibility=[])},rendergridcontent:function(b,c){if(this.updating())return!1;if(void 0==b||null==b)b=!1;this._requiresupdate=b;var e=this.prerenderrequired;
            this.prerenderrequired&&this._arrange();b=this.that;if(null==c||void 0==c)c=!0;this.tableheight=null;b.virtualsizeinfo=b.virtualsizeinfo||b._calculatevirtualheight();b.pageable&&!b.autoheight&&b.dataview.totalrows<b.pagesize&&(b._requiresupdate=!0);c?b._rendercolumnheaders():(this._rendersortcolumn&&this._rendersortcolumn(),this._renderfiltercolumn&&this._renderfiltercolumn());b._renderrows(b.virtualsizeinfo);this.gridcontent&&(0!=this.gridcontent[0].scrollTop&&(this.gridcontent[0].scrollTop=0),0!=
            this.gridcontent[0].scrollLeft&&(this.gridcontent[0].scrollLeft=0));e&&(c=this.tableheight,this._arrange(),c!=this.tableheight&&this.autoheight&&b._renderrows(b.virtualsizeinfo));this.rtl&&this._renderhorizontalscroll();this.autosavestate&&null!=this.initializedcall&&this.savestate&&this.savestate();if(this.adaptive&&this.element.offsetWidth<=this.adaptivewidth){var f=0,k=b.element.offsetWidth-2;d.each(this.columns.records,function(b,e){f+=this.width;if("adaptive"===this.columntype)return!0;f>=k&&
            (this.adaptivehidden=!0)});this._updatecolumnwidths();this._updatecellwidths();this._renderrows(this.virtualsizeinfo)}return!0},_updatecolumnwidths:function(){var b=this.host.width(),c=b,g="";if(void 0!=this.columns&&void 0!=this.columns.records){var h=this.that,k=this.rowdetails&&this.showrowdetailscolumn?(1+this.groups.length)*this.groupindentwidth:this.groups.length*this.groupindentwidth,l=0;if(this.adaptive&&this.element.offsetWidth<=this.adaptivewidth){var m=1;d.each(this.columns.records,function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       e){this.adaptivehidden&&m++});var p=0<this.vScrollBar[0].offsetWidth?this.vScrollBar[0].offsetWidth+4:0;"hidden"==this.vScrollBar.css("visibility")&&(p=0);l=(this.element.offsetWidth-32-p)/(this.columns.records.length-m)}d.each(this.columns.records,function(e,f){if(!(this.hidden&&this.hideable||this.adaptivehidden))if(-1!=this.width.toString().indexOf("%")||void 0!=this._percentagewidth){e="hidden"==h.vScrollBar[0].style.visibility?0:h.scrollbarsize+5;if(h.scrollbarautoshow||0==h.scrollbarsize)e=
            0;var d=c;f=parseFloat(this.width)*d/100;e+=k;void 0!=this._percentagewidth&&(f=parseFloat(this._percentagewidth)*(d-e)/100);f<this.minwidth&&"auto"!=this.minwidth&&(f=this.minwidth);f>this.maxwidth&&"auto"!=this.maxwidth&&(f=this.maxwidth);b-=f}else"auto"==this.width||this._width?g+=this.text:b-=this.width});p=this._gettableheight();if(!this.autoheight&&this.virtualsizeinfo&&this.virtualsizeinfo.virtualheight>p)if(this.groupable&&0<this.groups.length)if(this.dataview&&this.dataview.loadedrootgroups&&
            !this.groupsexpandedbydefault){var r=this.dataview.loadedrootgroups.length*this.rowsheight;if(this.pageable)for(var t=0;t<this.dataview.rows.length;t++)this.dataview.rows[t].group&&0===this.dataview.rows[t].level&&(r+=this.rowsheight);r>p?(b-=this.scrollbarsize+5,c-=this.scrollbarsize+5):"visible"==this.vScrollBar.css("visibility")&&(b-=this.scrollbarsize+5,c-=this.scrollbarsize+5)}else b-=this.scrollbarsize+5,c-=this.scrollbarsize+5;else"hidden"!=this.vScrollBar.css("visibility")&&0<this.scrollbarsize&&
        (b-=this.scrollbarsize+5,c-=this.scrollbarsize+5);k=this.rowdetails&&this.showrowdetailscolumn?(1+this.groups.length)*this.groupindentwidth:this.groups.length*this.groupindentwidth;c-=k;if(this.columnsheader&&(p=this.columnsheader.find("#columntable"+this.element.id),0!=p.length)){var w=0,q=0;d.each(this.columns.records,function(e,f){f=d(this.element);this.hidden||this.adaptivehidden||"none"!==this.element.style.display||(this.element.style.display="block");this.adaptivehidden&&(this.element.style.display=
            "none");var k=!1,u=this.width;if(-1!=this.width.toString().indexOf("%")||void 0!=this._percentagewidth)u=void 0!=this._percentagewidth?parseFloat(this._percentagewidth)*c/100:parseFloat(this.width)*c/100,k=!0;0<l&&"adaptive"!==this.columntype?(f.width(l),this.adaptivewidth=l):"auto"==this.width||this._width||k?k?(u<this.minwidth&&"auto"!=this.minwidth&&(this.width=u=this.minwidth),u>this.maxwidth&&"auto"!=this.maxwidth&&(this.width=u=this.maxwidth),parseInt(f[0].style.width)!=u&&(f.width(u),this.width=
            u)):(k=Math.floor(this.text.length/g.length*b),q+=k,3>b-q&&b!=q&&.01<b-q?1===b-q?k++:k+=2:e==h.columns.records.length-1&&q<b&&(k+=b-q),isNaN(k)&&(k=this.minwidth),isNaN(k)&&(k=this.minwidth),Infinity==k&&(k=0),0>k&&(e=d("<span>"+this.text+"</span>"),d(document.body).append(e),k=10+e.width(),e.remove()),k<this.minwidth&&(k=this.minwidth),k>this.maxwidth&&(k=this.maxwidth),this._width="auto",this.width=k,f.width(this.width)):parseInt(f[0].style.width)!=this.width&&f.width(this.width);parseInt(f[0].style.left)!=
        w&&f.css("left",w);this.hidden&&this.hideable||this.adaptivehidden||(w=0<l&&"adaptive"!==this.columntype?w+l:w+this.width);this._requirewidthupdate=!0});this.columnsheader.width(2+w);p.width(this.columnsheader.width());this.columnsheader[0].style.visibility=0==w?"hidden":"inherit";this._resizecolumngroups();this.showfilterrow&&this.filterrow&&(this.filterrow.width(this.columnsheader.width()),this._updatefilterrowui());this.showeverpresentrow&&("bottom"!==this.everpresentrowposition?this.addnewrowtop.width(this.columnsheader.width()):
            this.addnewrowbottom.width(this.columnsheader.width()),this._updateaddnewrowui());this.autowidth&&this._arrange()}}},_rendercolumnheaders:function(){var b=this.that;if(this.prerenderrequired){this._columnsbydatafield=[];this.columnsheader.find("#columntable"+this.element.id).remove();var c=d('<div id="columntable'+this.element.id+'" style="height: 100%; position: relative;"></div>');c[0].cells=[];var g=0,h=0,k="",l=this.host.width(),m=l,p=[],r=[],t=this.rowdetails&&this.showrowdetailscolumn?(1+this.groups.length)*
            this.groupindentwidth:this.groups.length*this.groupindentwidth;d.each(this.columns.records,function(e,c){this.hidden&&this.hideable||this.adaptivehidden||("auto"==this.width||this._width?k+=this.text:this.width<this.minwidth&&"auto"!=this.minwidth?l-=this.minwidth:this.width>this.maxwidth&&"auto"!=this.maxwidth?l-=this.maxwidth:-1!=this.width.toString().indexOf("%")?(e="hidden"==b.vScrollBar[0].style.visibility?0:b.scrollbarsize+5,e+=t,c=parseFloat(this.width)*(m-e)/100,c<this.minwidth&&"auto"!=this.minwidth&&
        (c=this.minwidth),c>this.maxwidth&&"auto"!=this.maxwidth&&(c=this.maxwidth),l-=c):("string"==typeof this.width&&(this.width=parseInt(this.width)),l-=this.width));this.pinned||this.grouped||this.checkboxcolumn?(b._haspinned&&(this.pinned=!0),p[p.length]=this):r[r.length]=this});if(this.rtl){var w=0;p.reverse();for(q=this.columns.records.length-1;q>=this.columns.records.length-p.length;q--)this.columns.replace(q,p[w++]);for(w=0;w<r.length;w++)this.columns.replace(w,r[w])}else{for(var q=0;q<p.length;q++)this.columns.replace(q,
            p[q]);for(w=0;w<r.length;w++)this.columns.replace(p.length+w,r[w])}var u=this.headerZIndex,y=b.groupable?b.groups.length:0;this.rowdetails&&this.showrowdetailscolumn&&y++;var z=b.columnsheader.height();this.showfilterrow&&(z=this.columngroups?z-this.filterrowheight:this.columnsheight);this.showeverpresentrow&&"bottom"!==this.everpresentrowposition&&(z=this.columngroups?z-this.everpresentrowheight:this.columnsheight);w=this._gettableheight();if(this.virtualsizeinfo&&this.virtualsizeinfo.virtualheight>
            w&&!this.scrollbarautoshow)if(this.groupable&&0<this.groups.length)if(this.dataview&&this.dataview.loadedrootgroups&&!this.groupsexpandedbydefault){q=0;if(!this.pageable)q=this.dataview.loadedrootgroups.length*this.rowsheight;else if(this.pageable)for(var A=0;A<this.dataview.rows.length;A++)this.dataview.rows[A].group&&0===this.dataview.rows[A].level&&(q+=this.rowsheight);q>w&&(l-=this.scrollbarsize+5,m-=this.scrollbarsize+5)}else l-=this.scrollbarsize+5,m-=this.scrollbarsize+5;else!this.autoheight&&
        0<this.scrollbarsize&&(l-=this.scrollbarsize+5,m-=this.scrollbarsize+5);m-=t;var C=function(e,c){e=b.columngroupslevel*b.columnsheight;return e-=c.level*b.columnsheight},B=document.createDocumentFragment(),D=0;d.each(this.columns.records,function(e,f){this.height=b.columnsheight;b.columngroups&&b.columngroups.length&&(z=this.height=C(this.datafield,this));f=b.toTP("jqx-grid-column-header")+" "+b.toTP("jqx-widget-header");b.rtl&&(f+=" "+b.toTP("jqx-grid-column-header-rtl"));var q=b.rtl?150+u+1:150+
            u-1,p=b.rtl?u++:u--,r=d('<div role="columnheader" style="z-index: '+p+';position: absolute; height: 100%;" class="'+f+'"><div style="height: 100%; width: 100%;"></div></div>');b.columngroups&&(r[0].style.height=z+"px",r[0].style.bottom="0px",this.pinned&&(r[0].style.zIndex=q));this.uielement=r;""!=this.classname&&this.classname&&r.addClass(this.classname);f=this.width;q=!1;null===this.width&&(this.width="auto");if(-1!=this.width.toString().indexOf("%")||void 0!=this._percentagewidth)f=void 0!=this._percentagewidth?
            parseFloat(this._percentagewidth)*m/100:parseFloat(this.width)*m/100,q=!0;if("auto"==this.width||this._width||q)if(q){f<this.minwidth&&"auto"!=this.minwidth&&(f=this.minwidth);f>this.maxwidth&&"auto"!=this.maxwidth&&(f=this.maxwidth);if(void 0==this._percentagewidth||-1!=this.width.toString().indexOf("%"))this._percentagewidth=this.width;r.width(f);this.width=f}else this.hidden||this.adaptivehidden||(f=Math.floor(this.text.length/k.length*l),D+=f,3>l-D&&l!=D&&.01<l-D?1===l-D?f++:f+=2:e==b.columns.records.length-
            1&&D<l&&(f+=l-D),isNaN(f)&&(f=this.minwidth),0>f&&(q=d("<span>"+this.text+"</span>"),d(document.body).append(q),f=10+q.width(),q.remove()),f<this.minwidth&&(f=this.minwidth),f>this.maxwidth&&(f=this.maxwidth),this._width="auto",f=this.width=f,r.width(this.width));else f<this.minwidth&&"auto"!=this.minwidth&&(this.width=f=this.minwidth),f>this.maxwidth&&"auto"!=this.maxwidth&&(this.width=f=this.maxwidth),r[0].style.width=parseInt(f)+"px";(this.hidden&&this.hideable||this.adaptivehidden)&&r.css("display",
            "none");var t=d(r.children()[0]);q=b.rtl?b.toTP("jqx-grid-column-menubutton")+" "+b.toTP("jqx-grid-column-menubutton-rtl"):b.toTP("jqx-grid-column-menubutton");q+=" "+b.toTP("jqx-icon-arrow-down");q=d('<div style="height: '+z+'px; display: none; left: 100%; top: 0%; position: absolute;"><div class="'+q+'" style="width: 100%; height:100%;"></div></div>');b.enableanimations||q.css("margin-left",-16);b.rtl&&q.css("left","0px");this.columnsmenu=q[0];c[0].cells[e]=r[0];q[0].style.width=parseInt(b.columnsmenuwidth)+
            "px";p=b.columnsmenu;var w=!1,A=!1,K=b.groupable&&0<y&&g<y||b.rowdetails&&g<y;b.rtl&&(K=b.groupable&&0<y&&g<y||b.rowdetails&&g<y,K&=e>b.columns.records.length-1-y);if(K)g++,p&=0,this.editable=this.sortable=!1,A=!0;else{var I=null!=this.renderer?this.renderer(this.text,this.align,z):b._rendercolumnheader(this.text,this.align,z,b);null==I&&(I=b._rendercolumnheader(this.text,this.align,z,b));null!=this.renderer&&(I=d(I));p&=1;w=!0}b.WinJS?MSApp.execUnsafeLocalFunction(function(){t.append(d(I))}):this.renderer?
            t.append(d(I)):I&&(t[0].innerHTML=I);if(null!=I){var E=d('<div class="iconscontainer" style="height: '+z+'px; margin-left: -32px; display: block; position: absolute; left: 100%; top: 0%; width: 32px;"><div class="filtericon '+b.toTP("jqx-widget-header")+'" style="height: '+z+'px; float: right; display: none; width: 16px;"><div class="'+b.toTP("jqx-grid-column-filterbutton")+'" style="width: 100%; height:100%;"></div></div><div class="sortasc '+b.toTP("jqx-widget-header")+'" style="height: '+z+'px; float: right; display: none; width: 16px;"><div class="'+
            b.toTP("jqx-grid-column-sortascbutton")+" "+b.toTP("jqx-icon-arrow-up")+'" style="width: 100%; height:100%;"></div></div><div class="sortdesc '+b.toTP("jqx-widget-header")+'" style="height: '+z+'px; float: right; display: none; width: 16px;"><div class="'+b.toTP("jqx-grid-column-sortdescbutton")+" "+b.toTP("jqx-icon-arrow-down")+'" style="width: 100%; height:100%;"></div></div><div class="sorticon '+b.toTP("jqx-widget-header")+'" style="height: '+z+'px; float: right; visibility: hidden; width: 16px;"><div class="'+
            b.toTP("jqx-grid-column-sorticon")+" "+b.toTP("jqx-icon-arrow-down")+'" style="width: 100%; height:100%;"></div></div></div>');q.addClass(b.toTP("jqx-widget-header"));t.append(E);e=E.children();this.sorticon=e[3];this.sortasc=e[1];this.sortdesc=e[2];this.filtericon=e[0];this.iconscontainer=E;b.rtl&&(E.css("margin-left","0px"),E.css("left","0px"),d(this.sorticon).css("float","left"),d(this.sortasc).css("float","left"),d(this.filtericon).css("float","left"),d(this.sortdesc).css("float","left"));!b.autoshowfiltericon&&
        this.filterable&&d(this.filtericon).css("display","block")}this.element=r[0];p&&(b._handlecolumnsmenu(b,t,r,q,this),this.menu||q.hide());B.appendChild(r[0]);if(b.groupable&&w)if(r[0].id=b.dataview.generatekey(),b._handlecolumnstogroupsdragdrop)b._handlecolumnstogroupsdragdrop(this,r);else throw Error("jqxGrid: Missing reference to jqxgrid.grouping.js.");b.columnsreorder&&this.draggable&&b._handlecolumnsdragreorder&&b._handlecolumnsdragreorder(this,r);var F=this;F._applyStyle();b.addHandler(r,"mouseenter",
            function(b){F.hovered=!0;F._applyStyle()});b.addHandler(r,"mouseleave",function(b){F.hovered=!1;F._applyStyle()});var R=function(e,c,f){if(e.selectable){var d=b.getrows();void 0===e.selected&&(e.selected=!1);c.shiftKey&&void 0!==b._clickedcolumn||(b._clickedcolumn=e);if(c.shiftKey&&b._clickedcolumn&&void 0===f){var g=b.columns.records.indexOf(b._clickedcolumn);f=b.columns.records.indexOf(e);e=Math.min(g,f);f=Math.max(g,f);b.clearselection();for(g=e;g<=f;g++)R(b.columns.records[g],c,!0);b._renderrows(this.virtualsizeinfo)}else{f?
            e.selected=!0:(c.ctrlKey||b.clearselection(),e.selected=!e.selected);for(g=0;g<d.length;g++)b._applycellselection(d[g].boundindex,e.displayfield,e.selected,!1);e.selected?e.element.setAttribute("selected",""):e.element.removeAttribute("selected");e._applyStyle();void 0===f&&b._renderrows(this.virtualsizeinfo)}}};b.addHandler(r,"click",function(e){if(F.checkboxcolumn)return!0;if(0<b.sorttogglestates&&b._togglesort&&!b._loading){if(b.suspendClick)return!0;b._togglesort(F)}R(F,e);e.preventDefault();
            b._raiseEvent(7,{column:F.getcolumnproperties(),datafield:F.datafield,originalEvent:e})});if(F.resizable&&b.columnsresize&&!A){var U=!1;e="mousemove";b.isTouchDevice()&&!0!==b.touchmode&&(U=!0,e=d.jqx.mobile.getTouchEventName("touchstart"));b.addHandler(r,e,function(e){var c=parseInt(e.pageX),f=parseInt(r.coord().left);b.hasTransform&&(f=d.jqx.utilities.getOffset(r).left);if(b.resizing)return!0;if(b._handlecolumnsresize){if(U)return c=b.getTouches(e)[0].pageX,c>=f+F.width-40?(b.resizablecolumn={columnelement:r,
            column:F},r.css("cursor","col-resize")):(r.css("cursor",""),b.resizablecolumn=null),!0;e=F.width;b.rtl&&(e=0);if(c>=f+e-5){if(c<=f+e+5)return b.resizablecolumn={columnelement:r,column:F},r.css("cursor","col-resize"),!1;r.css("cursor","")}else r.css("cursor",""),c<f+e-5&&(F._animating||F._menuvisible||r.mouseenter());b.resizablecolumn=null}})}r.css("left",h);this.hidden&&this.hideable||this.adaptivehidden||(h+=f);F.rendered&&F.rendered(d(t[0].firstChild),F.align,z)&&null!=E&&E.hide();if(F.checkboxcolumn){E&&
        E.hide();if(!b.host.jqxCheckBox)throw Error("jqxGrid: Missing reference to jqxcheckbox.js");t.html('<div style="cursor: pointer; margin-left: 3px; top: 50%; margin-top: -9px; position: relative;"></div>');var W=t.find("div:first");W.jqxCheckBox({_canFocus:!1,disabled:b.disabled,disabledContainer:!0,theme:b.theme,enableContainerClick:!1,animationShowDelay:0,animationHideDelay:0});W.addClass(b.toThemeProperty("jqx-checkbox"));F.checkboxelement=W;E=W.data().jqxCheckBox.instance;b._checkboxcolumn=F;E.updated=
            function(e,c,f){b._checkboxcolumnupdating=!0;b.disabled&&(W.jqxCheckBox({disabled:b.disabled}),c=f);c?b.selectallrows():b.unselectallrows();b._checkboxcolumnupdating=!1}}});0<h?this.columnsheader.width(2+h):this.columnsheader.width(h);c[0].appendChild(B);this.columnsrow=c;b.columnsheader.append(c);this.showfilterrow&&this._updatefilterrow&&(this.columngroups?c.height(this.columngroupslevel*this.columnsheight):c.height(this.columnsheight),this.filterrow||(w=d("<div style='position: relative !important; '></div>"),
            w[0].id="filterrow."+this.element.id,w.height(this.filterrowheight),this.filterrow=w),this.filterrow.width(2+h),this.columnsheader.append(this.filterrow),this._updatefilterrow());this.showeverpresentrow&&"bottom"!==this.everpresentrowposition?(this.columngroups?c.height(this.columngroupslevel*this.columnsheight):c.height(this.columnsheight),this.addnewrowtop||(w=d("<div style='position: relative !important; z-index:"+this.headerZIndex+";'></div>"),w[0].id="addnewrowtop."+this.element.id,w.height(this.everpresentrowheight),
            this.addnewrowtop=w),this.addnewrowtop.width(2+h),"topAboveFilterRow"==this.everpresentrowposition?this.filterrow?this.addnewrowtop.insertBefore(this.filterrow):this.columnsheader.append(this.addnewrowtop):this.columnsheader.append(this.addnewrowtop),this._updateaddnewrow()):this.showeverpresentrow&&"bottom"===this.everpresentrowposition&&(this.addnewrowbottom||(w=d("<div style='position: relative !important; z-index:"+this.headerZIndex+";'></div>"),w[0].id="addnewrowbottom."+this.element.id,w.height(this.everpresentrowheight),
            this.addnewrowbottom=w),this.addnewrowbottom.width(2+h),this.addnewrow.append(this.addnewrowbottom),this._updateaddnewrow());c[0].style.visibility=0==h?"hidden":"inherit";c.width(h);this._handlecolumnsdragdrop&&this._handlecolumnsdragdrop();this._handlecolumnsreorder&&this._handlecolumnsreorder();this._rendersortcolumn&&this._rendersortcolumn();this._renderfiltercolumn&&this._renderfiltercolumn();this._handlecolumnsresize&&this._handlecolumnsresize();this.columngroups&&this._rendercolumngroups();
            this._updatecheckboxselection&&this._updatecheckboxselection()}else this._rendersortcolumn&&this._rendersortcolumn(),this._renderfiltercolumn&&this._renderfiltercolumn(),this.showfilterrow&&this.filterrow&&(this.filterrow.width(this.columnsheader.width()),this._updatefilterrowui()),this.showeverpresentrow&&("bottom"!==this.everpresentrowposition?this.addnewrowtop.width(this.columnsheader.width()):this.addnewrowbottom.width(this.columnsheader.width()),this._updateaddnewrowui())},_rendercolumngroups:function(){if(this.columngroups){for(var b=
            0,c=0;c<this.columns.records.length;c++)this.columns.records[c].pinned&&b++;b=this.headerZIndex-b+this.columns.records.length;c=this.that;var g=c.toTP("jqx-grid-column-header")+" "+c.toTP("jqx-grid-columngroup-header")+" "+c.toTP("jqx-widget-header");c.rtl&&(g+=" "+c.toTP("jqx-grid-columngroup-header-rtl"));var h=this.columnsheader.find("#columntable"+this.element.id);h.find("jqx-grid-columngroup-header").remove();for(var k=0;k<this.columngroupslevel-1;k++)for(c=0;c<this.columngroups.length;c++){var l=
            this.columngroups[c],m=l.level;if(m===k){m*=this.columnsheight;var p=99999;if(l.groups){var r=function(b){for(var e=0,c=0;c<b.groups.length;c++){var f=b.groups[c];f.groups?e+=r(f):f.hidden||(e+=f.width,p=Math.min(parseFloat(f.element.style.left),p))}return e};l.width=r(l);l.left=p;var t=this.columnsheight,w=b--;w=d('<div role="columnheader" style="z-index: '+w+';position: absolute;" class="'+g+'"></div>');var q=d(this._rendercolumnheader(l.text,l.align,this.columnsheight,this));if(l.renderer){q=d("<div style='height: 100%; width: 100%;'></div>");
            var u=l.renderer(l.text,l.align,t);q.html(u)}w.append(q);w[0].style.left=p+"px";0===p&&(w[0].style.borderLeftColor="transparent");this.showcolumnheaderlines||(w[0].style.borderRightColor="transparent",w[0].style.borderBottomColor="transparent",w[0].style.boxShadow="none");w[0].style.top=m+"px";w[0].style.height=t+"px";w[0].style.width=-1+l.width+"px";h.append(w);l.element=w;l.rendered&&l.rendered(q,l.align,t)}}}}},_resizecolumngroups:function(){if(this.columngroups)for(var b=0;b<this.columngroups.length;b++){var c=
            this.columngroups[b],d=c.level*this.columnsheight,h=99999;if(c.groups){var k=function(b){for(var e=0,c=0;c<b.groups.length;c++){var f=b.groups[c];f.groups?e+=k(f):f.hidden||(e+=f.width,h=Math.min(parseFloat(f.element.style.left),h))}return e};c.width=k(c);c.left=h;var l=this.columnsheight,m=c.element;m[0].style.left=h+"px";m[0].style.top=d+"px";m[0].style.height=l+"px";m[0].style.width=-1+c.width+"px"}}},_handlecolumnsmenu:function(b,c,g,h,k){b.dragmousedown=null;h[0].id=b.dataview.generatekey();
            c.append(h);g[0].columnsmenu=h[0];k.element=g[0];var e=this.columnsmenuwidth+1,f=function(){if(!k.menu)return!1;if(!b.resizing){if(k._menuvisible&&b._hasOpenedMenu)return!1;k._animating=!0;if(b.menuitemsarray&&0<b.menuitemsarray.length)if(b.enableanimations)h.css("display","block"),h.stop(),k.iconscontainer.stop(),b.rtl?(h.css("margin-left",-e),h.animate({"margin-left":"0px"},"fast",function(){h.css("display","block");k._animating=!1;k._menuvisible=!0})):(h.css("margin-left","0px"),h.animate({"margin-left":-e},
                "fast",function(){h.css("display","block");k._animating=!1;k._menuvisible=!0})),c=b.rtl?e:-(32+e),k.iconscontainer.animate({"margin-left":c},"fast");else{h.css("display","block");var c=b.rtl?16:-48;k.iconscontainer.css("margin-left",c+"px");k._animating=!1;k._menuvisible=!0}}};c="mouseenter";b.isTouchDevice()&&(c="touchstart");b.addHandler(g,c,function(e){e=parseInt(e.pageX);var c=b.columnsresize&&k.resizable?3:0,h=parseInt(g.coord().left);b.hasTransform&&(h=d.jqx.utilities.getOffset(g).left);var l=
                k.width;b.rtl&&(l=0);if(0!=c&&e>=h+l-c&&e<=h+l+c)return!1;e=b.vScrollInstance.isScrolling();k.menu&&b.autoshowcolumnsmenubutton&&!e&&!b.disabled&&f()});b.autoshowcolumnsmenubutton||(h.css("display","block"),k.iconscontainer.css("margin-left",(b.rtl?16:-48)+"px"),b.rtl?h.css({"margin-left":"0px"}):h.css({"margin-left":-e}));b.addHandler(g,"mouseleave",function(c){b.menuitemsarray&&0<b.menuitemsarray.length&&k.menu&&(c=d.data(document.body,"contextmenu"+b.element.id),void 0!=c&&h[0].id==c.columnsmenu.id||
            !b.autoshowcolumnsmenubutton||(b.enableanimations?(b.rtl?h.css("margin-left","0px"):h.css("margin-left",-e),h.stop(),k.iconscontainer.stop(),b.rtl?h.animate({"margin-left":-e},"fast",function(){h.css("display","none");k._menuvisible=!1}):h.animate({"margin-left":0},"fast",function(){h.css("display","none");k._menuvisible=!1}),c=b.rtl?0:-32,k.iconscontainer.animate({"margin-left":c},"fast")):(h.css("display","none"),c=b.rtl?0:-32,k.iconscontainer.css("margin-left",c+"px"),k._menuvisible=!1)))});var p=
                !0,r="";c=d(k.filtericon);b.addHandler(h,"mousedown",function(e){b.gridmenu||b._initmenu();p=!d.data(b.gridmenu[0],"contextMenuOpened"+b.gridmenu[0].id);r=d.data(document.body,"contextmenu"+b.element.id);null!=r&&(r=r.column.datafield)});b.addHandler(c,"mousedown",function(e){b.gridmenu||b._initmenu();p=!d.data(b.gridmenu[0],"contextMenuOpened"+b.gridmenu[0].id);r=d.data(document.body,"contextmenu"+b.element.id);null!=r&&(r=r.column.datafield)});var t=function(){if(!k.menu)return!1;b.gridmenu||b._initmenu();
                if(b.disabled)return!1;for(var e=0;e<b.columns.records.length;e++)b.columns.records[e].datafield!=k.datafield&&(b.columns.records[e]._menuvisible=!1);e=h.coord(!0);var c=h.height();if(!p&&(p=!0,r==k.datafield))return b._closemenu(),!1;var f=b.host.coord(!0);b.hasTransform&&(f=d.jqx.utilities.getOffset(b.host),e=d.jqx.utilities.getOffset(h));f.left+b.host.width()>parseInt(e.left)+b.gridmenu.width()?b.gridmenu.jqxMenu("open",e.left,e.top+c):b.gridmenu.jqxMenu("open",h.width()+e.left-b.gridmenu.width(),
                    e.top+c);100>b.gridmenu.width()&&b._arrangemenu();if(b.adaptive&&b.element.offsetWidth<b.adaptivewidth){b.gridmenu.jqxMenu("close");b.gridmenu.jqxMenu("open",f.left,e.top+c);for(e=c=0;e<b.columns.records.length;e++)f=b.columns.records[e],f.hidden||f.adaptivehidden||"adaptive"===f.columntype||(c+=f.adaptivewidth);b.gridmenu.width(c);b.gridmenu.height(b.content.height())}(!b.filterable||b.filterable&&b.showfilterrow)&&setTimeout(function(){b.gridmenu.focus();for(var e=b.gridmenu.find(".jqx-item"),c=
                    0;c<e.length;c++)e[c].active&&(e[c].active=!1);c=e[0];0<=e[0].className.indexOf("disabled")&&(c=e[1]);d(e).removeClass("jqx-fill-state-focus");d(c).addClass("jqx-fill-state-focus");c.active=!0},225);b._hasOpenedMenu=!0;c=b._getmenuitembyindex(0);f=b._getmenuitembyindex(1);var g=b._getmenuitembyindex(2),l=b._getmenuitembyindex(3),m=b._getmenuitembyindex(4);e=b._getmenuitembyindex(5);if(null!=c&&null!=f&&null!=g){var t=k.sortable&&b.sortable;b.gridmenu.jqxMenu("disable",c.id,!t);b.gridmenu.jqxMenu("disable",
                    f.id,!t);b.gridmenu.jqxMenu("disable",g.id,!t);void 0!=k.displayfield&&(b.sortcolumn==k.displayfield?(g=b.getsortinformation(),t&&(g.sortdirection.ascending?b.gridmenu.jqxMenu("disable",c.id,!0):b.gridmenu.jqxMenu("disable",f.id,!0))):b.gridmenu.jqxMenu("disable",g.id,!0))}null!=l&&null!=m&&(b.groupable&&k.groupable?b.groups&&-1!=b.groups.indexOf(k.datafield)?(b.gridmenu.jqxMenu("disable",l.id,!0),b.gridmenu.jqxMenu("disable",m.id,!1)):(b.gridmenu.jqxMenu("disable",l.id,!1),b.gridmenu.jqxMenu("disable",
                    m.id,!0)):(b.gridmenu.jqxMenu("disable",m.id,!0),b.gridmenu.jqxMenu("disable",l.id,!0)));null!=e&&(b.menuOwner=k,b._updatefilterpanel(b,e,k),c=0,b.sortable&&b._togglesort&&b.showsortmenuitems&&(c+=3),b.groupable&&b.addgroup&&b.showgroupmenuitems&&(c+=2),f=33*c+6,f=b._measureMenuElement(),f=c*f+14,d.jqx.browser.msie&&8>d.jqx.browser.version&&(f+=20,d(e).height(194)),b.isTouchDevice()&&(f+=10),b.filterable&&b.showfiltermenuitems&&(k.filterable?(b.gridmenu.height(f+194),d(e).css("display","block")):
                    (b.gridmenu.height(f),d(e).css("display","none"))));b.columnmenuopening&&!1===b.columnmenuopening(b.gridmenu,k.displayfield,b.gridmenu.height())&&setTimeout(function(){b._closemenu()});d.data(document.body,"contextmenu"+b.element.id,{column:k,columnsmenu:h[0]})};b.addHandler(c,"click",function(e){if(!k.menu)return!1;b.showfilterrow||("block"!=h[0].style.display&&g.trigger("mouseenter"),setTimeout(function(){"block"!=h[0].style.display&&g.trigger("mouseenter");t()},200));return!1});b.addHandler(h,
                "click",function(b){if(!k.menu)return!1;t();return!1});b.isTouchDevice()&&b.addHandler(h,d.jqx.mobile.getTouchEventName("touchstart"),function(e){if(!k.menu)return!1;b._hasOpenedMenu?b._closemenu():t();return!1})},_removecolumnhandlers:function(b){var e=this.that,c=d(b.element);0<c.length&&(e.removeHandler(c,"mouseenter"),e.removeHandler(c,"mouseleave"),b=d(b.filtericon),e.removeHandler(b,"mousedown"),e.removeHandler(b,"click"),e.removeHandler(c,"click"),e.removeHandler(c,"mousemove"),e.columnsreorder&&
        (e.removeHandler(c,"mousedown.drag"),e.removeHandler(c,"mousemove.drag")),e.removeHandler(c,"dragstart"),c[0].columnsmenu&&(c=d(c[0].columnsmenu),e.removeHandler(c,"click"),e.removeHandler(c,"mousedown"),e.removeHandler(c,d.jqx.mobile.getTouchEventName("touchstart"))))},_rendercolumnheader:function(b,c,d,h){return this.enableellipsis?"left"==c?'<div style="padding-bottom: 2px; overflow: hidden; text-overflow: ellipsis; text-align: '+c+"; margin-left: 4px; margin-right: 2px; line-height: "+d+'px;"><span style="text-overflow: ellipsis; cursor: default;">'+
            b+"</span></div>":'<div style="padding-bottom: 2px; overflow: hidden; text-overflow: ellipsis; text-align: '+c+"; margin-left: 2px; margin-right: 4px; line-height: "+d+'px;"><span style="text-overflow: ellipsis; cursor: default;">'+b+"</span></div>":"center"==c||"middle"==c?'<div style="padding-bottom: 2px; text-align: center; line-height: '+d+'px;"><a href="#">'+b+"</a></div>":'<a style="line-height: '+d+"px; float: "+c+';" href="#">'+b+"</a>"},_renderrows:function(b,c,g){var e=this.that;(this.pageable||
            this.groupable)&&(this.autoheight||this.autorowheight)&&null!=this.table&&null!=this.table[0].rows&&this.table[0].rows.length<this.dataview.rows.length&&(e.prerenderrequired=!0);this.pageable||!this.autoheight&&!this.autorowheight||!this.virtualmode&&!this.unboundmode||(g=this.source.totalrecords,isNaN(g)||null==this.table||null==this.table[0].rows||this.table[0].rows.length==g||(e.prerenderrequired=!0));(this.autoheight||this.autorowheight)&&!e.prerenderrequired&&this.table&&this.table[0].rows&&
        (this.table[0].rows.length<this.dataview.records.length&&(this.pageable&&this.table[0].rows.length<this.dataview.pagesize?e.prerenderrequired=!0:this.pageable||(e.prerenderrequired=!0)),this.table[0].rows.length<this.dataview.cachedrecords.length&&(this.pageable&&this.table[0].rows.length<this.dataview.pagesize?e.prerenderrequired=!0:this.pageable||(e.prerenderrequired=!0)));e._prerenderrows(b);e._requiresupdate&&(e._requiresupdate=!1,e._updatepageviews());var f=function(){e._loading||(e.WinJS?MSApp.execUnsafeLocalFunction(function(){e._rendervisualrows()}):
            e._rendervisualrows(),e.virtualmode&&e.showaggregates&&e._updateaggregates&&e.refreshaggregates())};b=d.jqx.browser.msie&&10>d.jqx.browser.version;if(this.virtualmode)g=function(){if(e.rendergridrows){var b=e._startboundindex;void 0==b&&(b=0);var f=b+1+e.dataview.pagesize;if(null!=b&&null!=f){var d=e.source._source?!0:!1;if((d?e.source._source.recordstartindex:e.source.recordstartindex)!=b||1==c){if(d){if(f>=e.source._source.totalrecords&&(f=e.source._source.totalrecords,b=f-e.dataview.pagesize-1,
        0>b&&(b=0),e.source._source.recordendindex==f&&e.source._source.recordstartindex==b))return;e.source._source.recordstartindex=b;e.source._source.recordendindex=f}else e.source.recordstartindex=b,e.source.recordendindex=f;e.updatebounddata("cells")}}}},this.loadondemand&&(f(),g(),this.loadondemand=!1),g=void 0==this._browser?this._isIE10():this._browser,this.editable&&this.editcell&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()?f():this.autoheight?f():g||b||navigator&&-1!=
        navigator.userAgent.indexOf("Safari")?(null!=this._scrolltimer&&clearTimeout(this._scrolltimer),this._scrolltimer=setTimeout(function(){f()},5)):f();else{if("deferred"==this.scrollmode&&(this.hScrollInstance.isScrolling()||this.vScrollInstance.isScrolling())){null!=this._scrolltimer&&clearInterval(this._scrolltimer);var l=this._getfirstvisualrow();null!=l&&(b=function(b){if(null==l)return"";b="<table>";var c=e.deferreddatafields;null==c&&0<e.columns.records.length&&(c=[],c.push(e.columns.records[0].displayfield));
            for(var f=0;f<c.length;f++){var g=e._getcolumnbydatafield(c[f]);if(g){var h=e._getcellvalue(g,l);""!=g.cellsformat&&d.jqx.dataFormat&&(d.jqx.dataFormat.isDate(h)?h=d.jqx.dataFormat.formatdate(h,g.cellsformat,e.gridlocalization):d.jqx.dataFormat.isNumber(h)&&(h=d.jqx.dataFormat.formatnumber(h,g.cellsformat,e.gridlocalization)));b+="<tr><td>"+h+"</td></tr>"}}return b+"</table>"},b=this.scrollfeedback?this.scrollfeedback(l.bounddata):b(l.bounddata),b!=this._scrollelementcontent&&(this._scrollelementcontent=
            this._scrollelement[0].innerHTML=b));this._scrollelement.css("visibility","visible");this._scrollelementoverlay.css("visibility","visible");this._scrollelement.css("margin-top",-this._scrollelement.height()/2);this._scrolltimer=setInterval(function(){e.hScrollInstance.isScrolling()||e.vScrollInstance.isScrolling()||(f(),e._scrollelement.css("visibility","hidden"),e._scrollelementoverlay.css("visibility","hidden"),clearInterval(e._scrolltimer),l&&e.ensurerowvisible(l.visibleindex))},100);return}navigator&&
        -1==navigator.userAgent.indexOf("Chrome")&&-1!=navigator.userAgent.indexOf("Safari")&&(this._updatedelay=1);void 0!=this.touchDevice&&1==this.touchDevice&&(this._updatedelay=5);if((g=void 0==this._browser?this._isIE10():this._browser)||b)this._updatedelay=5;if(g&&this.hScrollInstance.isScrolling()){f();return}d.jqx.browser.mozilla&&0==this._updatedelay&&(this.vScrollInstance.isScrolling()||this.hScrollInstance.isScrolling())&&(this._updatedelay=0);this.isTouchDevice()&&(this._updatedelay=0);null!=
        this.updatedelay&&(this._updatedelay=this.updatedelay);0==this._updatedelay?f():(b=this._jqxgridrendertimer,null!=b&&clearTimeout(b),this.vScrollInstance.isScrolling()||this.hScrollInstance.isScrolling()?(this._updatedelay?b=setTimeout(function(){f()},this._updatedelay):(b=null,f()),this._jqxgridrendertimer=b):(this._jqxgridrendertimer=b,f()))}if(e.autorowheight&&!e.autoheight&&0<this._pageviews.length){g=this._gettableheight();b=this._pageviews[0].height;if(b>g)if(this.pageable&&this.gotopage&&(b=
            this._pageviews[0].height,0>b&&(b=this._pageviews[0].height)),"visible"!=this.vScrollBar.css("visibility")&&this.vScrollBar.css("visibility","visible"),(b<=g||this.autoheight)&&this.vScrollBar.css("visibility","hidden"),0<b-g){if("deferred"!=this.scrollmode){g=b-g;var m=this.vScrollInstance.max;this.vScrollBar.jqxScrollBar({max:g});Math.round(g)!=Math.round(m)&&this.vScrollBar.jqxScrollBar("value")>g&&this.vScrollBar.jqxScrollBar({value:0})}}else this.vScrollBar.jqxScrollBar({value:0,max:b});else this._loading||
        this.vScrollBar.css("visibility","hidden"),this.vScrollBar.jqxScrollBar({value:0});this._arrange();this.virtualsizeinfo&&(this.virtualsizeinfo.virtualheight=b)}},scrolling:function(){var b=this.vScrollInstance.isScrolling(),c=this.hScrollInstance.isScrolling();return{vertical:b,horizontal:c}},_renderhorizontalscroll:function(){var b=this.hScrollInstance,c=b.value;"hidden"===this.hScrollBar.css("visibility")&&(c=b.value=0);var d=parseInt(c);if(null!=this.table){var h=this.table[0].rows.length,k=this.columnsrow,
            l=this.groupable&&0<this.groups.length?this.groups.length:0,m=this.columns.records.length-l,p=this.columns.records,r=0==this.dataview.rows.length;this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(d=b.max-d);if(r&&!this._haspinned){for(b=0;b<h;b++){r=this.table[0].rows[b];for(var t=0;t<l+m;t++){var w=r.cells[t];if(void 0!=w){var q=p[t];q.pinned&&(w.style.marginLeft=d+"px",0==b&&(w=k[0].cells[t],w.style.marginLeft=d+"px"))}}}this.table[0].style.marginLeft=-d+"px";k[0].style.marginLeft=-d+"px"}else if(this._haspinned||
            void 0==this._haspinned){for(b=0;b<h;b++)for(r=this.table[0].rows[b],t=0;t<l+m;t++)if(w=r.cells[t],void 0!=w&&(q=p[t],q.pinned&&(0!=d||""!=w.style.marginLeft))){var u=q=null,y=null;this.showeverpresentrow&&this.addnewrowtop&&this.addnewrowtop[0].cells&&(y=this.addnewrowtop[0].cells[t]);this.showfilterrow&&this.filterrow&&this.filterrow[0].cells&&(u=this.filterrow[0].cells[t]);this.showaggregates&&this.statusbar[0].cells&&(q=this.statusbar[0].cells[t]);this.rtl?(w.style.marginLeft=-parseInt(c)+"px",
        0==b&&(w=k[0].cells[t],w.style.marginLeft=-parseInt(c)+"px",q&&(q.style.marginLeft=-parseInt(c)+"px"),u&&(u.style.marginLeft=-parseInt(c)+"px"),y&&(y.style.marginLeft=-parseInt(c)+"px"))):(w.style.marginLeft=d+"px",0==b&&(w=k[0].cells[t],w.style.marginLeft=d+"px",q&&(q.style.marginLeft=d+"px"),u&&(u.style.marginLeft=d+"px"),y&&(y.style.marginLeft=d+"px")))}this.table[0].style.marginLeft=-d+"px";k[0].style.marginLeft=-d+"px"}else 0==this._haspinned&&(this.table[0].style.marginLeft=-d+"px",k[0].style.marginLeft=
            -d+"px");this.showaggregates&&this.statusbar[0].cells&&(c=0,this.rtl&&"hidden"!=this.vScrollBar.css("visibility")&&"hidden"!=this.hScrollBar.css("visibility")&&(c=2+parseInt(this.hScrollBar.css("left"))),this.statusbar[0].style.marginLeft=-d+c+"px");this.showfilterrow&&this.filterrow&&this.filterrow[0].cells&&(this.filterrow[0].style.marginLeft=-d+"px");this.showeverpresentrow&&this.addnewrowtop&&this.addnewrowtop[0].cells&&(this.addnewrowtop[0].style.marginLeft=-d+"px")}},_updaterowdetailsvisibility:function(){if(this.rowdetails)for(var b=
            0;b<this._rowdetailselementscache.length;b++)d(this._rowdetailselementscache[b]).css("display","none")},_getvisualcolumnsindexes:function(b,c,d,h,k,l){if(this.rowdetails||this.rtl||this.editcell||this.width&&0<=this.width.toString().indexOf("%")||this.exporting)return{start:0,end:d+h};var e=0,f=-1,g=d+h,t=!1;if(this.autorowheight)return{start:0,end:d+h};if(!k)for(k=0;k<d+h;k++)if(t||this.columns.records[k].pinned&&l&&(t=!0),this.columns.records[k].hidden||this.columns.records[k].adaptivehidden||(e+=
            this.columns.records[k].width),e>=b&&-1==f&&(f=k),e>c+b){g=k;break}g++;g>d+h&&(g=d+h);if(-1==f||t)f=0;return{start:f,end:g}},_getvirtualcolumnsindexes:function(b,c,d,h,k){if(this.rtl||this.editcell||this.exporting)return{start:0,end:d+h};var e=0,f=-1,g=d+h;if(this.autorowheight)return{start:0,end:d+h};if(!k)for(k=0;k<d+h;k++)if(this.columns.records[k].hidden||this.columns.records[k].adaptivehidden||(e+=this.columns.records[k].width),e>=b&&-1==f&&(f=k),e>c+b){g=k;break}g++;g>d+h&&(g=d+h);-1==f&&(f=
            0);return{start:f,end:g}},_getfirstvisualrow:function(){var b=parseInt(this.vScrollInstance.value);0==this._pagescache.length&&(this.dataview.updateview(),this._loadrows());"visible"!=this.vScrollBar[0].style.visibility&&(b=0);if(!this.pageable){var c=this._findvisiblerow(b,this._pageviews);if(-1==c)return null;c!=this.dataview.pagenum?(this.dataview.pagenum=c,this.dataview.updateview(),this._loadrows()):this._pagescache[this.dataview.pagenum]||this._loadrows()}b=this._findvisiblerow(b,this._pagescache[this.dataview.pagenum]);
            if((c=this._pagescache[this.dataview.pagenum])&&c[0])return c[b]},_rendervisualrows:function(){if(this.virtualsizeinfo){var b=this.vScrollInstance,c=this.hScrollInstance,g=c.value,h=parseInt(b.value),k=parseInt(g),l=this._gettableheight(),m=void 0!=this._hostwidth?this._hostwidth:this.host.width();"visible"==this.hScrollBar[0].style.visibility&&(l+=29);"deferred"==this.scrollmode&&0!=this._newmax&&h>this._newmax&&null!=this._newmax&&(h=this._newmax);var p=b.isScrolling()||c.isScrolling()||this._keydown,
            r=this.groupable&&0<this.groups.length;this.visiblerows=[];this.hittestinfo=[];this.editcell&&void 0==this.editrow&&this._hidecelleditor(!1);void 0!=this.editrow&&this._hideeditors();this.virtualmode&&!this.pageable&&(this._pagescache=[]);0==this._pagescache.length&&(this.dataview.updateview(),this._loadrows());"hidden"==this.vScrollBar[0].style.visibility&&(h=0);if(!this.pageable){c=this._findvisiblerow(h,this._pageviews);if(-1==c){this._clearvisualrows();this._renderemptyrow();this._updaterowdetailsvisibility();
            return}c!=this.dataview.pagenum?(this.dataview.pagenum=c,this.dataview.updateview(),this._loadrows()):this._pagescache[this.dataview.pagenum]||this._loadrows()}var t=this.groupable&&0<this.groups.length?this.groups.length:0;if(this.columns.records){var w=this.columns.records.length-t;c=this._findvisiblerow(h,this._pagescache[this.dataview.pagenum]);var q=this._pagescache[this.dataview.pagenum],u=c;0>u&&(u=0);var y=0,z=0,A=0,C=0,B=this.virtualsizeinfo.visiblerecords,D=this.groupable?this.groups.length:
            0,K=this.toTP("jqx-grid-cell")+" "+this.toTP("jqx-item");this.rtl&&(K+=" "+this.toTP("jqx-grid-cell-rtl"));(this.autoheight||this.autorowheight)&&this.pageable&&(!this.groupable||this.groupable&&0===this.groups.length)&&(B=this.dataview.pagesize);r&&(K=" "+this.toTP("jqx-grid-group-cell"));this.isTouchDevice()&&(K+=" "+this.toTP("jqx-touch"));this.autorowheight&&(K+=" jqx-grid-cell-wrap");var I=this.rowsheight,G=this._rendercell;g=this._getvisualcolumnsindexes(k,m,t,w,r,!0);c=g.start;g=g.end;var H=
            this._getvirtualcolumnsindexes(k,m,t,w,r),N=H.start,Q=H.end;(this.autoheight||this.pageable)&&this.autorowheight&&this._pageviews[0]&&(this._oldpageviewheight=this._pageviews[0].height);this.autorowheight&&(u=0);if(0<=u){this._updaterowdetailsvisibility();this._startboundindex=null!=q?q[u].bounddata.boundindex:0;this._startvisibleindex=null!=q?q[u].bounddata.visibleindex:0;var J=this.table[0].rows;if(10<this.columns.records.length&&this.enablecolumnsvirtualization)for(var O=function(b){return b.parentNode&&
        "#document-fragment"!=b.parentNode.nodeName?!0:!1},L=0;L<J.length;L++){H=J[L];for(var M=0;M<N;M++){var E=M;if(!this.columns.records[E].pinned&&null!=this.columns.records[E].datafield){var F=H.cells[E];O(F)&&F.parentNode.removeChild(F);var R=this.columns.records[E].element;this.columns.records[E]._rendered=!1;O(R)&&this.columnsrow[0].removeChild(R);this.filterrow&&O(this.filterrow[0].cells[E])&&this.columns.records[E].filterable&&this.filterrow[0].cells[E].parentNode.removeChild(this.filterrow[0].cells[E])}}for(M=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Q;M<this.columns.records.length;M++)E=M,this.columns.records[E].pinned||null==this.columns.records[E].datafield||(F=H.cells[E],O(F)&&F.parentNode.removeChild(F),R=this.columns.records[E].element,this.columns.records[E]._rendered=!1,O(R)&&this.columnsrow[0].removeChild(R),this.filterrow&&O(this.filterrow[0].cells[E])&&this.columns.records[E].filterable&&this.filterrow[0].cells[E].parentNode.removeChild(this.filterrow[0].cells[E]));for(M=N;M<Q;M++)E=M,F=H.cells[E],O(F)||H.appendChild(F),R=this.columns.records[E].element,
            this.columns.records[E]._rendered=!0,R.selectable&&(F.removeAttribute("selected"),R.selected&&F.setAttribute("selected","")),O(R)||this.columnsrow[0].appendChild(R),this.filterrow&&!O(this.filterrow[0].cells[E])&&this.columns.records[E].filterable&&this.filterrow[0].firstChild.appendChild(this.filterrow[0].cells[E])}for(L=0;L<B&&z<B;L++){J=void 0!=q?q[u+L]:null;this.virtualmode&&L>=this.source.totalrecords&&(J=null);if(null==J){u=-L;if(this._pagescache[this.dataview.pagenum+1])q=this._pagescache[this.dataview.pagenum+
        1],this.dataview.pagenum++;else{H=this._pageviews.length;do if(this.dataview.pagenum<this._pageviews.length-1)this.dataview.pagenum++,q=void 0,0<this._pageviews[this.dataview.pagenum].height&&(this.dataview.updateview(),this._loadrows(),q=this._pagescache[this.dataview.pagenum]);else{q=void 0;break}while(void 0==q&&this.dataview.pagenum<H)}void 0!=q&&(J=q[u+L])}if(null!=J){if(J.hidden)continue;this._endboundindex=this._startboundindex+L;this._endvisibleindex=this._startvisibleindex+L;0==L&&(H=Math.abs(h-
            J.top),this.table[0].style.top=-H+"px",C=-H);H=this.table[0].rows[z];if(!H)continue;parseInt(H.style.height)!=J.height&&(H.style.height=parseInt(J.height)+"px");A+=J.height;N=this.rowdetails&&J.rowdetails;Q=!J.rowdetailshidden;N&&Q&&(H.style.height=parseInt(J.height-J.rowdetailsheight)+"px",B++);O=this._isrowselected(!0,J);for(M=c;M<g;M++)E=M,this._rendervisualcell(G,K,O,N,Q,r,D,H,J,E,z,p);void 0!=J.group&&this._rendergroup&&this._rendergroup(D,H,J,t,w,z,m);if(this.autorowheight&&(this.autoheight||
            this.pageable)){I=this.rowsheight;for(M=c;M<g;M++)this.editable&&this.editcell&&this.editcell.column==this.columns.records[M].datafield&&this.editcell.row==this.getboundindex(J)&&this.editcell.editor?I=Math.max(I,this.editcell.editor.height()):H.cells[M].firstChild&&(I=Math.max(I,8+parseInt(H.cells[M].firstChild.offsetHeight)));H.style.height=parseInt(I)+"px";this.heights[this._startboundindex+L]=I;N&&Q&&(I+=J.rowdetailsheight);J.height=I}this.visiblerows[this.visiblerows.length]=J;this.hittestinfo[this.hittestinfo.length]=
            {row:J,visualrow:H,details:!1};N&&Q&&(z++,H=this.table[0].rows[z],this._renderrowdetails(K,H,J,t,w,z),this.visiblerows[this.visiblerows.length]=J,this.hittestinfo[this.hittestinfo.length]={row:J,visualrow:H,details:!0});if(!this.autorowheight&&A+C>=l)break}else this._clearvisualrow(k,r,z,t,w),A+y+C<=l&&(y+=I);z++}this._horizontalvalue=k;0<y&&"visible"==this.vScrollBar[0].style.visibility&&(parseInt(this.table.css("top")),k=this._pageviews[this._pageviews.length-1],h=b.max,l=k.top+k.height-l,"visible"==
        this.hScrollBar.css("visibility")&&(l+=this.scrollbarsize+20),h!=l&&!this.autorowheight&&0<=l&&("deferred"!=this.scrollmode?(b.max=l,b.setPosition(b.max)):this._newmax!=l&&(this._newmax=l,this._rendervisualrows())))}if((this.autoheight||this.pageable)&&this.autorowheight){this._pagescache=[];for(L=l=b=0;L<this.visiblerows.length;L++)for(h=this.visiblerows[L],h.top=b,b+=h.height,l+=h.height,N=this.rowdetails&&h.rowdetails,Q=!h.rowdetailshidden,H=this.table[0].rows[L],N&&Q&&L++,M=c;M<g;M++)k=this.columns.records[M],
        k.hidden||k.adaptivehidden||k.cellsrenderer||(m=H.cells[M],p=0,m.firstChild?(p=(h.height-parseInt(m.firstChild.offsetHeight)-8)/2,N&&Q&&(p=(h.height-h.rowdetailsheight-d(m.firstChild).height()-8)/2)):p=(h.height-parseInt(d(m).height())-8)/2,0<=p&&(p=parseInt(p)+4,!m.firstChild||-1!=m.firstChild.className.indexOf("jqx-grid-groups-row")||"checkbox"==k.columntype||"button"==k.columntype||this.editable&&this.editcell&&this.editcell.column==k.datafield&&this.editcell.row==this.getboundindex(h)||(m.firstChild.style.marginTop=
            p+"px")));this._pageviews[0]&&(this._pageviews[0].height=l);this._arrange()}this._renderemptyrow();this.toCompile&&0<this.toCompile.length&&d.each(this.toCompile,function(b,e){if(this.compiled)return!0;b=this.cell;if(!b)return!0;d.jqx.angularCompile&&d.jqx.angularCompile(b,"<div>"+this.value+"</div>");this.compiled=!0})}}},_hideemptyrow:function(){if(this.showemptyrow&&this.table&&this.table[0].rows){var b=this.table[0].rows[0];if(b)for(var c=!1,g=0;g<b.cells.length;g++){var h=d(b.cells[g]);"none"==
        h.css("display")||c||h.width()!=this.host.width()&&h.text()!=this.gridlocalization.emptydatastring||(h[0].checkbox=null,h[0].button=null,c=!0,h[0].innerHTML="")}}},_renderemptyrow:function(){if(!this._loading&&0==this.dataview.records.length&&this.showemptyrow){var b=!1,c=this.toTP("jqx-grid-cell");if(this.table&&0<this.table.length&&this.table[0].rows&&0<this.table[0].rows.length){var g=this.table[0].rows[0];this.table[0].style.top="0px";for(var h=0;h<g.cells.length;h++){var k=d(g.cells[h]);if("none"!=
            k.css("display")&&!b){k[0].checkbox=null;k[0].button=null;k[0].className=c;b=!0;k[0].innerHTML="";var l=d("<span style='white-space: nowrap; float: left; margin-left: 50%; position: relative;'></span>");l.text(this.gridlocalization.emptydatastring);k.append(l);var m=0;this.oldhscroll||(m=parseInt(this.table[0].style.marginLeft),this.rtl&&(k.css("z-index",999),k.css("overflow","visible")));l.css("left",-m-l.width()/2);l.css("top",this._gettableheight()/2-l.height()/2);d.jqx.browser.msie&&8>d.jqx.browser.version&&
        (l.css("margin-left","0px"),l.css("left",this.host.width()/2-l.width()/2));l=Math.abs(parseInt(this.table[0].style.top));isNaN(l)&&(l=0);d(g).height(this._gettableheight()+l);k.css("margin-left","0px");k.width(this.host.width());this.table.width()<this.host.width()&&this.table.width(this.host.width())}k.addClass(this.toThemeProperty("jqx-grid-empty-cell"))}}}},_clearvisualrows:function(){var b=this.virtualsizeinfo.visiblerecords,c=parseInt(this.hScrollInstance.value),d=this.groupable&&0<this.groups.length;
            if(this.columns.records)for(var h=0;h<b;h++)this._clearvisualrow(c,d,h,0,this.columns.records.length)},_iscellselected:function(b,c,d){var e=!1,f=0;this.virtualmode&&this.pageable&&this.groupable&&0<this.groups.length&&(f=this.dataview.pagesize*this.dataview.pagenum);if(0<this.groups.length&&this.pageable&&this.groupable){b=this.getrowboundindexbyid(c.bounddata.uid);if(-1!=b){for(var g in this.selectedcells)g==b+"_"+d&&(e=!0);return e}return!1}if(b&&null!=c.bounddata)if("singlerow"!=this.selectionmode)if(0<
            this.dataview.filters.length)if(this.virtualmode||void 0==c.bounddata.dataindex)for(g in this.selectedcells)g==f+c.bounddata.boundindex+"_"+d&&(e=!0);else for(g in this.selectedcells)g==f+c.bounddata.dataindex+"_"+d&&(e=!0);else for(g in this.selectedcells){if(g==f+c.bounddata.boundindex+"_"+d){e=!0;break}}else if(0<this.dataview.filters.length)if(!this.virtualmode&&void 0!=c.bounddata.dataindex)for(g in this.selectedcells){if(g==f+c.bounddata.dataindex+"_"+d){e=!0;break}}else for(g in this.selectedcells){if(g==
            f+c.bounddata.boundindex+"_"+d){e=!0;break}}else for(g in this.selectedcells)if(g==f+c.bounddata.boundindex==this.selectedrowindex){e=!0;break}return e},_isrowselected:function(b,c){var e=!1,f=0;this.virtualmode&&this.pageable&&this.groupable&&0<this.groups.length&&(f=this.dataview.pagesize*this.dataview.pagenum);if(this.groupable&&0<this.groups.length&&this.pageable){b=this.getrowboundindexbyid(c.bounddata.uid);if(void 0==b||-1==b)return!1;-1!=this.selectedrowindexes.indexOf(b)&&(e=!0);e||(e=b==
            this.selectedrowindex&&-1!=this.selectedrowindex);return e}b&&null!=c.bounddata&&("singlerow"!=this.selectionmode?0<this.dataview.filters.length?this.virtualmode||void 0==c.bounddata.dataindex?-1!=this.selectedrowindexes.indexOf(f+c.bounddata.boundindex)&&(e=!0):-1!=this.selectedrowindexes.indexOf(f+c.bounddata.dataindex)&&(e=!0):-1!=this.selectedrowindexes.indexOf(f+c.bounddata.boundindex)&&(e=!0):0<this.dataview.filters.length?this.virtualmode||void 0==c.bounddata.dataindex?-1!=this.selectedrowindexes.indexOf(f+
            c.bounddata.boundindex)&&(e=!0):-1!=this.selectedrowindexes.indexOf(f+c.bounddata.dataindex)&&(e=!0):f+c.bounddata.boundindex==this.selectedrowindex&&(e=!0));return e},_rendervisualcell:function(b,c,g,h,k,l,m,p,r,t,w,q){var e=this.columns.records[t];if(e.hidden||e.adaptivehidden)w=p.cells[t],w.innerHTML="";else{var f=this._getcellvalue(e,r);w=p.cells[t];-1!=this.selectionmode.indexOf("cell")&&(g=0<this.dataview.filters.length?this.selectedcells[r.bounddata.dataindex+"_"+e.datafield]?!0:!1:this.selectedcells[r.boundindex+
        "_"+e.datafield]?!0:!1,this.editcell&&this.editcell.row===r.boundindex&&this.editcell.column===e.datafield&&"checkbox"!==e.columntype&&(g=!1),this.virtualmode||this.groupable&&0<this.groups.length&&this.pageable)&&(g=this._iscellselected(!0,r,e.datafield));if(""!=e.cellclassname&&e.cellclassname)if("string"==typeof e.cellclassname)c+=" "+e.cellclassname;else{var z=e.cellclassname(this.getboundindex(r),e.datafield,f,r.bounddata);z&&(c+=" "+z)}z=this.showsortcolumnbackground&&this.sortcolumn&&e.displayfield==
            this.sortcolumn;if("many"===this.sortmode&&this.showsortcolumnbackground)for(var A=this.getsortcolumns(),C=0;C<A.length;C++)e.displayfield===A[C].dataField&&(z=!0);z&&(c+=" "+this.toTP("jqx-grid-cell-sort"));e.filter&&this.showfiltercolumnbackground&&(c+=" "+this.toTP("jqx-grid-cell-filter"));r.bounddata.totalsrow&&(c+=" "+this.toTP("jqx-grid-cell-pinned"));if(e.pinned&&this.showpinnedcolumnbackground||e.grouped)l?r.bounddata.totalsrow||(c+=" "+this.toTP("jqx-grid-cell-pinned")):c+=" "+this.toTP("jqx-grid-cell-pinned");
            this.altrows&&void 0==r.group&&(A=r.visibleindex,A>=this.altstart&&0==(this.altstart+A)%(1+this.altstep)&&(c=z?c+(" "+this.toTP("jqx-grid-cell-sort-alt")):c+(" "+this.toTP("jqx-grid-cell-alt")),e.filter&&this.showfiltercolumnbackground&&(c+=" "+this.toTP("jqx-grid-cell-filter-alt")),e.pinned&&this.showpinnedcolumnbackground&&(c+=" "+this.toTP("jqx-grid-cell-pinned-alt"))));if(t<=m){if(l||this.rowdetails||this.pageable&&this.virtualmode)z=d(w),A=this.columns.records[t].width,w.style.width!=parseInt(A)+
            "px"&&z.width(A)}else(l||this.rowdetails)&&this._hiddencolumns&&(z=d(w),A=this.columns.records[t].width,parseInt(w.style.width)!=A&&z.width(A));if(this.rowdetails&&h&&(k&&!l?c+=" "+this.toTP("jqx-grid-details-cell"):l&&(c+=" "+this.toTP("jqx-grid-group-details-cell")),this.showrowdetailscolumn))if(!this.rtl){if(void 0==r.group&&t==m&&!r.bounddata.totalsrow){b=this.toThemeProperty("jqx-icon-arrow-down");k?c+=" "+this.toTP("jqx-grid-group-expand"):(c+=" "+this.toTP("jqx-grid-group-collapse"),b=this.toThemeProperty("jqx-icon-arrow-right"));
                c+=" "+b;w.title="";w.innerHTML="";w.className!=c&&(w.className=c);return}}else if(void 0==r.group&&t==p.cells.length-m-1){b=this.toThemeProperty("jqx-icon-arrow-down");k?c+=" "+this.toTP("jqx-grid-group-expand-rtl"):(c+=" "+this.toTP("jqx-grid-group-collapse-rtl"),b=this.toThemeProperty("jqx-icon-arrow-left"));c+=" "+b;w.title="";w.innerHTML="";w.className!=c&&(w.className=c);return}g&&t>=m&&(c+=" "+this.toTP("jqx-grid-cell-selected"),c+=" "+this.toTP("jqx-fill-state-pressed"));w.className!=c&&(w.className=
                c);e._applyCellStyle(w);void 0!=r.group?(w.title="",w.innerHTML=""):b(this,e,r,f,w,q)}},_rendercell:function(b,c,g,h,k,l){var e=h+"_"+c.visibleindex;if("number"==c.columntype||null!=c.cellsrenderer)e=g.uniqueid+"_"+c.visibleindex;"number"==c.columntype&&(h=g.visibleindex);"adaptive"===c.columntype&&(h="...");c._applyCellStyle(k);k.style.borderBottomColor=b.showrowlines?"":"transparent";b.showcolumnheaderlines?(c.element.style.borderRightColor="",c.element.style.boxShadow=""):(c.element.style.borderRightColor=
            "transparent",c.element.style.boxShadow="none");k.style.borderRightColor=b.showcolumnlines?"":"transparent";if(b.editcell&&void 0==b.editrow)if("selectedrow"==b.editmode&&c.editable&&b.editable){if(b.editcell.row==b.getboundindex(g)&&b._showcelleditor){b.hScrollInstance.isScrolling()||b.vScrollInstance.isScrolling()?b._showcelleditor(b.editcell.row,c,k,!1,!1):b._showcelleditor(b.editcell.row,c,k,b.editcell.init);k.className+=" "+b.toTP("jqx-grid-cell-edit");return}}else if(b.editcell.row==b.getboundindex(g)&&
            b.editcell.column==c.datafield&&(b.editcell.element=k,b.editcell.editing&&b._showcelleditor)){b.hScrollInstance.isScrolling()||b.vScrollInstance.isScrolling()?b._showcelleditor(b.editcell.row,c,b.editcell.element,b.editcell.init,!1):b._showcelleditor(b.editcell.row,c,b.editcell.element,b.editcell.init);k.className+=" "+b.toTP("jqx-grid-cell-edit");return}var f=b._defaultcellsrenderer(h,c),r=b._cellscache[e];if(r){if("checkbox"==c.columntype){if(b.host.jqxCheckBox){""===h&&(h=null);e=0==k.innerHTML.toString().length;
            !k.checkbox||b.groupable||e?b._rendercheckboxcell(b,k,c,g,h):(k.checkboxrow=b.getboundindex(g),""==h&&(h=!1),"1"==h&&(h=!0),"0"==h&&(h=!1),1==h&&(h=!0),0==h&&(h=!1),"true"==h&&(h=!0),"false"==h&&(h=!1),null!=h||c.threestatecheckbox||(h=!1),c.checkboxcolumn&&(h=!1,0<b.dataview.filters.length&&!b.virtualmode&&void 0!=g.bounddata.dataindex?-1!=b.selectedrowindexes.indexOf(g.bounddata.dataindex)&&(h=!0):-1!=b.selectedrowindexes.indexOf(g.bounddata.boundindex)&&(h=!0)),b.disabled||(k.checkboxinstance?
                k.checkboxinstance._setState(h):k.checkbox.jqxCheckBox("_setState",h)));null!=c.cellsrenderer&&(b=c.cellsrenderer(b.getboundindex(g),c.datafield,h,f,c.getcolumnproperties(),g.bounddata),void 0!=b&&(k.innerHTML=b));return}}else if("button"==c.columntype){if(b.host.jqxButton){""==h&&(h=!1);null!=c.cellsrenderer&&(h=c.cellsrenderer(b.getboundindex(g),c.datafield,h,f,c.getcolumnproperties(),g.bounddata));""==k.innerHTML&&(k.buttonrow=b.getboundindex(g),k.button=null,b._renderbuttoncell(b,k,c,g,h));k.button&&
        !b.groupable?(k.buttonrow=b.getboundindex(g),k.button.val(h)):b._renderbuttoncell(b,k,c,g,h);return}}else if(("progressbar"==c.columntype||"rating"===c.columntype)&&b.host.jqxButton){""==h&&(h=!1);null!=c.cellsrenderer&&(h=c.cellsrenderer(b.getboundindex(g),c.datafield,h,f,c.getcolumnproperties(),g.bounddata));""==k.innerHTML&&(k.progressrow=b.getboundindex(g),k.progress=null,b._renderprogresscell(b,k,c,g,h));k.progress&&!b.groupable?(k.progressrow=b.getboundindex(g),k.progress.val(h)):b._renderprogresscell(b,
            k,c,g,h);return}if(c.createwidget)if(""==k.innerHTML&&(k.widgetrow=b.getboundindex(g),k.widget=null,c.widget=null,b._renderwidgetcell(b,k,c,g,h)),k.widget&&!b.groupable)if(k.widgetrow=b.getboundindex(g),c.initwidget)c.initwidget(b.getboundindex(g),c.datafield,h,k.firstChild);else throw Error("jqxGrid: 'initwidget' column function is not implemented. Please, implement 'initwidget'");else b._renderwidgetcell(b,k,c,g,h);else{var t=r.element;null!=c.cellsrenderer||k.childNodes&&0==k.childNodes.length||
        b.groupable||b.rowdetails?k.innerHTML!=t&&(k.innerHTML=t):0<=k.innerHTML.indexOf("editor")?k.innerHTML=t:l?(h=t.indexOf(">"),f=t.indexOf("</"),f=t.substring(h+1,f),h=k.childNodes[0],0<=f.indexOf(">")?k.innerHTML=t:h.childNodes[0]?f!=h.childNodes[0].nodeValue&&(0<=f.indexOf("&")?k.innerHTML=t:h.childNodes[0].nodeValue=f):(t=document.createTextNode(f),h.appendChild(t))):k.innerHTML!=t&&(k.innerHTML=t);b.enabletooltips&&c.enabletooltips&&(k.title=r.title)}}else if("checkbox"==c.columntype)b._rendercheckboxcell(b,
            k,c,g,h),b._cellscache[e]={element:"",title:h},b.enabletooltips&&c.enabletooltips&&(k.title=""+h);else if("button"==c.columntype)null!=c.cellsrenderer&&(h=c.cellsrenderer(b.getboundindex(g),c.datafield,h,f,c.getcolumnproperties(),g.bounddata)),b._renderbuttoncell(b,k,c,g,h),b._cellscache[e]={element:"",title:h},b.enabletooltips&&c.enabletooltips&&(k.title=""+h);else if("progressbar"==c.columntype||"rating"===c.columntype)null!=c.cellsrenderer&&(h=c.cellsrenderer(b.getboundindex(g),c.datafield,h,f,
            c.getcolumnproperties(),g.bounddata)),b._renderprogresscell(b,k,c,g,h),b._cellscache[e]={element:"",title:h},b.enabletooltips&&c.enabletooltips&&(k.title=""+h);else if("number"==c.columntype&&(h=g.visibleindex),c.createwidget)null!=c.cellsrenderer&&(h=c.cellsrenderer(b.getboundindex(g),c.datafield,h,f,c.getcolumnproperties(),g.bounddata)),b._renderwidgetcell(b,k,c,g,h),b._cellscache[e]={element:"",title:h},b.enabletooltips&&c.enabletooltips&&(k.title=h);else{if(null!=c.cellsrenderer){if((t=c.cellsrenderer(b.getboundindex(g),
            c.datafield,h,f,c.getcolumnproperties(),g.bounddata))&&(0<=t.indexOf("<jqx-")||0<=t.indexOf(" ng-"))){b.toCompile&&b.toCompile.push({cell:k,value:t,row:b.getboundindex(g)});return}}else t=f;null==t&&(t=f);r=h;b.enabletooltips&&c.enabletooltips&&(""!=c.cellsformat&&d.jqx.dataFormat&&(d.jqx.dataFormat.isDate(h)?r=d.jqx.dataFormat.formatdate(r,c.cellsformat,b.gridlocalization):d.jqx.dataFormat.isNumber(h)&&(r=d.jqx.dataFormat.formatnumber(r,c.cellsformat,b.gridlocalization))),k.title=r);b.WinJS?d(k).html(t):
            (g=k.innerHTML,0<=g.indexOf("editor")||null!=c.cellsrenderer||b.groupable||b.virtualmode?k.innerHTML=t:0<g.length?(h=t.indexOf(">"),f=t.indexOf("</"),f=t.substring(h+1,f),h=k.childNodes[0],0<=f.indexOf(">")?k.innerHTML=t:h.childNodes[0]?f!=h.childNodes[0].nodeValue&&(0<=f.indexOf("&")||0<=g.indexOf("span")?k.innerHTML=t:h.childNodes[0].nodeValue=f):(t=document.createTextNode(f),h.appendChild(t))):g!=t&&(k.innerHTML=t));b._cellscache[e]={element:k.innerHTML,title:r};return!0}},_isIE10:function(){if(void 0==
            this._browser){var b=d.jqx.utilities.getBrowser();"msie"==b.browser&&9<parseInt(b.version)?this._browser=!0:(this._browser=!1,"msie"==b.browser&&(b="Browser CodeName: "+navigator.appCodeName,b+="Browser Name: "+navigator.appName,b+="Browser Version: "+navigator.appVersion,b+="Platform: "+navigator.platform,b+="User-agent header: "+navigator.userAgent,-1!=b.indexOf("Zune 4.7")&&(this._browser=!0)))}return this._browser},_renderinlinecell:function(b,c,g,h,k){d(c);c.innerHTML='<div style="position: absolute;"></div>'},
        _rendercheckboxcell:function(b,c,g,h,k){if(b.host.jqxCheckBox){var e=d(c);""===k&&(k=g.threestatecheckbox?null:!1);null!==k||g.threestatecheckbox||(k=!1);"1"==k&&(k=!0);"0"==k&&(k=!1);1==k&&(k=!0);0==k&&(k=!1);"true"==k&&(k=!0);"false"==k&&(k=!1);if(g.checkboxcolumn){k=!1;var f=this.getboundindex(h);-1!=this.selectedrowindexes.indexOf(f)&&(k=!0)}0==e.find(".jqx-checkbox").length?(c.innerHTML='<div style="position: absolute; top: 50%; left: 50%; margin-top: -9px; margin-left: -12px;"></div>',d(c.firstChild).jqxCheckBox({disabled:b.disabled,
            _canFocus:!1,hasInput:!1,hasThreeStates:g.threestatecheckbox,enableContainerClick:!1,animationShowDelay:0,animationHideDelay:0,locked:!0,theme:b.theme,checked:k}),this.enabletooltips&&g.enabletooltips&&(c.title=""+k),this.editable&&g.editable&&d(c.firstChild).jqxCheckBox({locked:!1}),g.checkboxcolumn&&d(c.firstChild).jqxCheckBox({locked:!1}),c.checkbox=d(c.firstChild),c.checkboxinstance=c.checkbox.data().jqxCheckBox.instance,c.checkboxrow=this.getboundindex(h),d.data(c.firstChild,"jqxCheckBox").instance.updated=
            function(e,f,h){if(b.disabled){f=h;e=b.table[0].rows.length;for(var k=b._getcolumnindex(g.datafield),q=0;q<e;q++){var l=b.table[0].rows[q].cells[k].firstChild;l&&d(l).jqxCheckBox({disabled:b.disabled})}}if(g.editable&&!b.disabled){if(e=b.table[0].rows.length,k=b._getcolumnindex(g.datafield),void 0==b.editrow)if(g.cellbeginedit&&0==g.cellbeginedit(c.checkboxrow,g.datafield,g.columntype,!f))b.setcellvalue(c.checkboxrow,g.datafield,!f,!0);else{g.cellvaluechanging&&(q=g.cellvaluechanging(c.checkboxrow,
                g.datafield,g.columntype,h,f),void 0!=q&&(f=q));if("selectedrow"!==b.editmode)for(q=0;q<e;q++)(l=b.table[0].rows[q].cells[k].firstChild)&&d(l).jqxCheckBox("destroy");b.editcell&&0==b.editcell.validated?b.setcellvalue(c.checkboxrow,g.datafield,!f,!0):"selectedrow"!==b.editmode||null==b.editcell?(e=b.getrowdata(c.checkboxrow),b._raiseEvent(17,{rowindex:c.checkboxrow,row:e,datafield:g.datafield,value:h,columntype:g.columntype}),b.setcellvalue(c.checkboxrow,g.datafield,f,!0),b._raiseEvent(18,{rowindex:c.checkboxrow,
                row:e,datafield:g.datafield,oldvalue:h,value:f,columntype:g.columntype})):b.setcellvalue(c.checkboxrow,g.datafield,f,!1,!1);g.cellendedit&&g.cellendedit(c.checkboxrow,g.datafield,g.columntype,f)}}else g.checkboxcolumn&&(b.editcell&&b.endcelledit(b.editcell.row,b.editcell.column,!1,!0),b.disabled||(f?b.selectrow(c.checkboxrow):b.unselectrow(c.checkboxrow),b.autosavestate&&b.savestate&&b.savestate()))}):(c.checkboxrow=this.getboundindex(h),d(c.firstChild).jqxCheckBox("_setState",k,!(this.editable&&
            g.editable)&&!g.checkboxcolumn))}},_renderwidgetcell:function(b,c,g,h,k){0==d(c).find(".jqx-grid-widget").length?(c.innerHTML='<div class="jqx-grid-widget" style="opacity: 0.99; position: absolute; width: 100%; height:100%; top: 0%; left: 0%; padding: 0px;"></div>',g.createwidget(h,g.datafield,k,c.firstChild),d(c.firstChild).attr("hideFocus","true"),d(c.firstChild).children().addClass("jqx-grid-widget"),c.widget=d(c.firstChild),c.widgetrow=b.getboundindex(h),g.widget=d(c.firstChild)):(g.initwidget(b.getboundindex(h),
            g.datafield,k,c.firstChild),c.widgetrow=b.getboundindex(h),d(c.firstChild).val(k))},_renderprogresscell:function(b,c,g,h,k){var e=d(c);if("rating"===g.columntype){b._linkadded||(h=document.createElement("link"),h.rel="stylesheet",h.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css",document.head.appendChild(h),b._linkadded=!0);g.ratingmax||(g.ratingmax=5);b="";for(h=0;h<g.ratingmax;h++)b=k>=h+1?b+'<span style="color: rgba(255, 165, 0, 1);" class="fa fa-star checked"></span>':
            b+'<span style="color: rgba(255, 165, 0, .3);" class="fa fa-star"></span>';g=g.cellsalign;"right"===g&&(g="flex-end");c.innerHTML='<div style="display: flex; width: 100%; height: 100%; justify-content: '+g+'; padding: 5px; box-sizing: border-box; font-size: 16px; align-items: center;">'+b+"</div>"}else""==k&&(k=!1),0==e.find(".jqx-progress").length?(c.innerHTML='<progress class="jqx-progress" max="100" style="opacity: 0.99; position: absolute; top: 10%; left: 10%; width:80%; height:80%; padding: 0px;"/>',
            d(c.firstChild).val(k),c.progress=d(c.firstChild),c.progressrow=b.getboundindex(h)):(c.progressrow=b.getboundindex(h),d(c.firstChild).val(k))},_renderbuttoncell:function(b,c,g,h,k){if(b.host.jqxButton){var e=d(c);""==k&&(k=!1);0==e.find(".jqx-button").length?(c.innerHTML='<input type="button" style="opacity: 0.99; position: absolute; top: 0%; left: 0%; padding: 0px; margin-top: 2px; margin-left: 2px;"/>',d(c.firstChild).val(k),d(c.firstChild).attr("hideFocus","true"),d(c.firstChild).jqxButton({disabled:b.disabled,
            theme:b.theme,height:b.rowsheight-4,width:g.width-4}),c.button=d(c.firstChild),c.buttonrow=b.getboundindex(h),this.isTouchDevice()?(h=d.jqx.mobile.getTouchEventName("touchend"),b.addHandler(d(c.firstChild),h,function(b){g.buttonclick&&g.buttonclick(c.buttonrow,b)})):b.addHandler(d(c.firstChild),"click",function(b){g.buttonclick&&g.buttonclick(c.buttonrow,b)})):(c.buttonrow=b.getboundindex(h),d(c.firstChild).val(k))}},_clearvisualrow:function(b,c,g,h,k){var e=this.toTP("jqx-grid-cell");c&&(e=" "+this.toTP("jqx-grid-group-cell"));
            e+=" "+this.toTP("jqx-grid-cleared-cell");c=this.table[0].rows;for(var f=0;f<h+k;f++)if(c[g]){var p=c[g].cells[f];p.className!=e&&(p.className=e);var r=this.columns.records[f];this._horizontalvalue==b||r.pinned||1!=this.oldhscroll||(p.style.marginLeft=-b+"px");var t=r.width;r.adaptivewidth&&(t=r.adaptivewidth);t<r.minwidth&&(t=r.minwidth);t>r.maxwidth&&(t=r.maxwidth);parseInt(p.style.width)!=t&&("auto"!=t?d(p)[0].style.width=t+"px":d(p)[0].style.width=t);""!=p.title&&(p.title="");""!=p.innerHTML&&
            (p.innerHTML="")}c[g]&&parseInt(c[g].style.height)!=this.rowsheight&&(c[g].style.height=parseInt(this.rowsheight)+"px")},_findgroupstate:function(b){b=this._findgroup(b);return null==b?!1:b.expanded},_findgroup:function(b){return this.expandedgroups[b]?this.expandedgroups[b]:null},_clearcaches:function(){this._columnsbydatafield=[];this._pagescache=[];this._pageviews=[];this._cellscache=[];this.heights=[];this.hiddens=[];this.hiddenboundrows=[];this.heightboundrows=[];this.detailboundrows=[];this.details=
            [];this.expandedgroups=[];this._rowdetailscache=[];this._rowdetailselementscache=[];d.jqx.dataFormat&&d.jqx.dataFormat.cleardatescache();this.tableheight=null},_getColumnText:function(b){void 0==this._columnsbydatafield&&(this._columnsbydatafield=[]);if(this._columnsbydatafield[b])return this._columnsbydatafield[b];var e=b,c=null;d.each(this.columns.records,function(){if(this.datafield==b||this.displayfield==b)return e=this.text,c=this,!1});this._columnsbydatafield[b]={label:e,column:c};return this._columnsbydatafield[b]},
        _getcolumnbydatafield:function(b){void 0==this.__columnsbydatafield&&(this.__columnsbydatafield=[]);if(this.__columnsbydatafield[b])return this.__columnsbydatafield[b];var e=null;d.each(this.columns.records,function(){if(this.datafield==b||this.displayfield==b)return e=this,!1});this.__columnsbydatafield[b]=e;return this.__columnsbydatafield[b]},isscrollingvertically:function(){return this.vScrollBar.jqxScrollBar("isScrolling")},_renderrowdetails:function(b,c,g,h,k,l){if(void 0!=c){var e=d(c);l=this.rowdetails&&
        this.showrowdetailscolumn?(1+this.groups.length)*this.groupindentwidth:this.groups.length*this.groupindentwidth;if(this.groupable&&0<this.groups.length)for(var f=0;f<=k;f++){var r=d(c.cells[f]);r[0].innerHTML="";r[0].className="jqx-grid-details-cell"}r=d(c.cells[0]);if("none"==r[0].style.display){r=c.cells[0];for(f=2;void 0!=r&&"none"==r.style.display&&10>f;)r=c.cells[0+f-1],f++;r=d(r)}if(this.rtl)for(;h<k;h++)c.cells[h].innerHTML="",c.cells[h].className="jqx-grid-details-cell";r.css("width","100%");
            e.height(g.rowdetailsheight);r[0].className=b;b=this.getboundindex(g);k=b+"_";this._rowdetailscache[k]?(c=this._rowdetailscache[k].html,this.initrowdetails?this._rowdetailscache[k].element&&(c=this._rowdetailscache[k].element,r=r.coord(),h=this.gridcontent.coord(),g=parseInt(r.top)-parseInt(h.top),r=parseInt(r.left)-parseInt(h.left),this.rtl&&(r=0),d(c).css("top",g),d(c).css("left",r),d(c).css("display","block"),d(c).width(this.host.width()-l),this.layoutrowdetails&&this.layoutrowdetails(b,c,this.element,
                this.getrowdata(b))):r[0].innerHTML=c):(r[0].innerHTML="",this.enablerowdetailsindent||(l=0),h='<div class="jqx-enableselect" role="rowgroup" style="border: none; overflow: hidden; width: 100%; height: 100%; margin-left: '+l+'px;">'+g.rowdetails+"</div>",this.rtl&&(h='<div class="jqx-enableselect" role="rowgroup" style="border: none; overflow: hidden; width: 100%; height: 100%; margin-left: 0px; margin-right: '+l+'px;">'+g.rowdetails+"</div>"),this._rowdetailscache[k]={id:c.id,html:h},this.initrowdetails?
                (c=d(h)[0],d(this.gridcontent).prepend(d(c)),d(c).css("position","absolute"),d(c).width(this.host.width()-l),d(c).height(r.height()),r.coord(),d(c).css("z-index",1799),this.isTouchDevice()&&d(c).css("z-index",1999),d(c).addClass(this.toThemeProperty("jqx-widget-content")),r=r.coord(),h=this.gridcontent.coord(),g=parseInt(r.top)-parseInt(h.top),r=parseInt(r.left)-parseInt(h.left),d(c).css("top",g),d(c).css("left",r),this.content[0].scrollTop=0,this.content[0].scrollLeft=0,l=d(d(c).children()[0]),""!=
                l[0].id&&(l[0].id+=b),this.initrowdetails(b,c,this.element,this.getrowdata(b)),this._rowdetailscache[k].element=c,this._rowdetailselementscache[b]=c):r[0].innerHTML=h)}},_defaultcellsrenderer:function(b,c){""!=c.cellsformat&&d.jqx.dataFormat&&(d.jqx.dataFormat.isDate(b)?b=d.jqx.dataFormat.formatdate(b,c.cellsformat,this.gridlocalization):d.jqx.dataFormat.isNumber(b)&&(b=d.jqx.dataFormat.formatnumber(b,c.cellsformat,this.gridlocalization)));var e="8px";31!=this.rowsheight&&(e=this.rowsheight/2-this._cellheight/
            2,0>e&&(e=4),e+="px");if(this.enableellipsis){if("center"==c.cellsalign||"middle"==c.cellsalign)return'<div class="jqx-grid-cell-middle-align" style="margin-top: '+e+';">'+b+"</div>";if("left"==c.cellsalign)return'<div class="jqx-grid-cell-left-align" style="margin-top: '+e+';">'+b+"</div>";if("right"==c.cellsalign)return'<div class="jqx-grid-cell-right-align" style="margin-top: '+e+';">'+b+"</div>"}return"center"==c.cellsalign||"middle"==c.cellsalign?'<div style="text-align: center; margin-top: '+
            e+';">'+b+"</div>":'<span style="margin-left: 4px; margin-right: 2px; margin-top: '+e+"; float: "+c.cellsalign+';">'+b+"</span>"},getcelltext:function(b,c){if(null==b||null==c)return null;b=this.getcellvalue(b,c);(c=this.getcolumn(c))&&""!=c.cellsformat&&d.jqx.dataFormat&&(d.jqx.dataFormat.isDate(b)?b=d.jqx.dataFormat.formatdate(b,c.cellsformat,this.gridlocalization):d.jqx.dataFormat.isNumber(b)&&(b=d.jqx.dataFormat.formatnumber(b,c.cellsformat,this.gridlocalization)));return b},getcelltextbyid:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         c){if(null==b||null==c)return null;b=this.getcellvaluebyid(b,c);(c=this.getcolumn(c))&&""!=c.cellsformat&&d.jqx.dataFormat&&(d.jqx.dataFormat.isDate(b)?b=d.jqx.dataFormat.formatdate(b,c.cellsformat,this.gridlocalization):d.jqx.dataFormat.isNumber(b)&&(b=d.jqx.dataFormat.formatnumber(b,c.cellsformat,this.gridlocalization)));return b},_getcellvalue:function(b,c){var e=c.bounddata[b.datafield];null!=b.displayfield&&(e=c.bounddata[b.displayfield]);null==e&&(e="");return e},getcell:function(b,c){if(null==
            b||null==c)return null;var e=parseInt(b),f=b,d="";isNaN(e)||(f=this.getrowdata(e));null!=f&&(d=f[c]);return this._getcellresult(d,b,c)},getrenderedcell:function(b,c){if(null==b||null==c)return null;var e=parseInt(b),f=b,d="";isNaN(e)||(f=this.getrenderedrowdata(e));null!=f&&(d=f[c]);return this._getcellresult(d,b,c)},_getcellresult:function(b,c,d){var e=this.getcolumn(d);if(null==e||void 0==e)return null;var f=e.getcolumnproperties();e=f.hidden;var g=f.width,m=f.pinned,p=f.cellsalign;f=f.cellsformat;
            var r=this.getrowheight(c);return 0==r?null:{value:b,row:c,column:d,datafield:d,width:g,height:r,hidden:e,pinned:m,align:p,format:f}},setcellvaluebyid:function(b,c,d,h,k){b=this.getrowboundindexbyid(b);return this.setcellvalue(b,c,d,h,k)},getcellvaluebyid:function(b,c){b=this.getrowboundindexbyid(b);return this.getcellvalue(b,c)},setcellvalue:function(b,c,g,h,k){if(null==b||null==c)return!1;var e=parseInt(b),f=b;isNaN(e)||(f=this.getrowdata(e));var p=!1;this.filterable&&this._initfilterpanel&&this.dataview.filters.length&&
        (p=!0);this.virtualmode&&(this._pagescache=[]);this.sortcache&&(this.sortcache={});var r="",t="";if(null!=f&&f[c]!==g){if(null===f[c]&&""===g)return;var w=this._getcolumnbydatafield(c),q="string";this.source||(this.source=new d.jqx.dataAdapter({}));var u=this.source.datafields||(this.source._source?this.source._source.datafields:null);if(u){var y="";d.each(u,function(){if(this.name==w.displayfield)return this.type&&(y=this.type),!1});y&&(q=y);t=f[w.displayfield]}r=f[c];if(!w.nullable||null!=g&&""!==
            g&&w.nullable&&void 0===g.label)if(d.jqx.dataFormat.isNumber(r)||"number"==q||"float"==q||"int"==q||"decimal"==q&&"date"!=q?(this.gridlocalization&&","==this.gridlocalization.decimalseparator&&g&&g.indexOf&&0<=g.indexOf(",")&&(g=g.replace(",",".")),g=new Number(g),g=parseFloat(g),isNaN(g)&&(g=0)):!d.jqx.dataFormat.isDate(r)&&"date"!=q||""==g||(u=new Date(g),"Invalid Date"!=u&&null!=u?g=u:"Invalid Date"==u&&(g=u=new Date)),f[c]===g){this._updating||0==h||this._renderrows(this.virtualsizeinfo);return}u=
            this.source&&this.source._source.localdata&&"observableArray"===this.source._source.localdata.name;f[c]=g;if(u){var z=this.source._source.localdata;z._updating||(z._updating=!0,z[b][c]=g,z._updating=!1)}q=this.getrenderedrowdata(e,!0);if(!q)return;q[c]=g;null!=g&&null!=g.label&&(w=this._getcolumnbydatafield(c),f[w.displayfield]=g.label,q[w.displayfield]=g.label,f[c]=g.value,q[c]=g.value,u&&!z._updating&&(z._updating=!0,z[b][c]=g.value,z[b][w.displayfield]=g.label,z._updating=!1));p&&void 0!=f.dataindex&&
        (this.dataview.cachedrecords[f.dataindex][c]=g,null!=g&&void 0!=g.label&&(this.dataview.cachedrecords[f.dataindex][c]=g.value,this.dataview.cachedrecords[f.dataindex][w.displayfield]=g.label))}else return this._updating||0==h||this._renderrows(this.virtualsizeinfo),!1;if(this.source&&this.source._knockoutdatasource&&!this._updateFromAdapter&&this.autokoupdates&&this.source._source._localdata){z=e;p&&void 0!=f.dataindex&&(z=f.dataindex);z=this.source._source._localdata()[z];this.source.suspendKO=!0;
            if(z[c]&&z[c].subscribe)if(null!=g&&null!=g.label)z[w.displayfield](g.label),z[c](g.value);else z[c](g);else{u=this.source._source.datafields;var A=null;u&&d.each(u,function(){if(this.name==c)return A=this.map,!1});if(null==A)null!=g&&null!=g.label?(z[c]=g.value,z[w.displayfield]=g.label):z[c]=g;else if(u=A.split(this.source.mapChar),0<u.length){q=z;for(var C=0;C<u.length-1;C++)q=q[u[C]];q[u[u.length-1]]=g}this.source._source._localdata.replace(z,d.extend({},z))}this.source.suspendKO=!1}if(this.sortcolumn&&
            this.dataview.sortby&&!this._updating)if(z=this.getsortinformation(),this.sortcolumn==c&&"many"!==this.sortmode)this.dataview.clearsortdata(),this.dataview.sortby(z.sortcolumn,z.sortdirection.ascending);else{if("many"===this.sortmode)for(z=this.getsortcolumns(),this.dataview.clearsortdata(),this.sortby(null),u=0;u<z.length;u++)this.sortby(z[u].dataField,z[u].ascending)}else this._updating||this.dataview.sortby&&this.dataview.sortcache[c]&&(this.dataview.sortcache[c]=null);this._cellscache=[];this._pagescache=
            [];if(this.source.updaterow&&(void 0==k||1==k)){k=!1;var B=this.that;z=function(e){0==e&&(B.setcellvalue(b,c,r,!0,!1),r!=t&&B.setcellvalue(b,B.getcolumn(c).displayfield,t,!0,!1))};try{var D=this.getrowid(e);k=this.source.updaterow(D,f,z);void 0==k&&(k=!0)}catch(K){k=!1;B.setcellvalue(b,c,r,!0,!1);r!=t&&B.setcellvalue(b,B.getcolumn(c).displayfield,t,!0,!1);return}}e=this.vScrollInstance.value;this._updating&&1!=h&&(h=!1);if(1==h||void 0==h)if(B=this.that,h=function(){B.pageable&&B.updatepagerdetails&&
        (B.updatepagerdetails(),(B.autoheight||B.autorowheight)&&B._updatepageviews())},f=this.groupable&&0<this.groups.length,p&&!f){if(this.autoheight||this.autorowheight)this.prerenderrequired=!0;this.dataview.refresh();this.rendergridcontent(!0,!1);h();this._renderrows(this.virtualsizeinfo)}else if(this.sortcolumn&&!f){if(this.autoheight||this.autorowheight)this.prerenderrequired=!0;this.dataview.reloaddata();this.rendergridcontent(!0,!1);h();this._renderrows(this.virtualsizeinfo)}else if(this.groupable&&
            0<this.groups.length){if(this.autoheight||this.autorowheight)this.prerenderrequired=!0;this.pageable?-1!=this.groups.indexOf(c)?(this._pagescache=[],this._cellscache=[],this.dataview.refresh(),this._render(!0,!0,!1,!1)):(this._pagescache=[],this._cellscache=[],this.dataview.updateview(),this._renderrows(this.virtualsizeinfo)):(this._pagescache=[],this._cellscache=[],this.dataview.updateview(),this._renderrows(this.virtualsizeinfo))}else this.dataview.updateview(),this._renderrows(this.virtualsizeinfo);
            this.vScrollInstance.setPosition(e);this.showaggregates&&this._updatecolumnsaggregates&&this._updatecolumnsaggregates();this.showfilterrow&&this.filterable&&this.filterrow&&(p=this.getcolumn(c).filtertype,"list"!=p&&"checkedlist"!=p||this._updatelistfilters(!0));this._raiseEvent(19,{rowindex:b,datafield:c,newvalue:g,value:g,oldvalue:r});return!0},getcellvalue:function(b,c){if(null==b||null==c)return null;var e=parseInt(b);isNaN(e)||(b=this.getrowdata(e));return null!=b?b[c]:null},getrows:function(){var b=
            this.dataview.records.length;if(this.virtualmode){for(var c=[],g=0;g<this.dataview.records.length;g++)(b=this.dataview.records[g])&&c.push(b);void 0===this.dataview.records.length&&d.each(this.dataview.records,function(){this&&c.push(this)});g=0;this.pageable&&(g=this.dataview.pagenum*this.dataview.pagesize);return c.length>this.source._source.totalrecords-g?c.slice(0,this.source._source.totalrecords-g):c}if(this.dataview.sortdata){c=[];for(g=0;g<b;g++){var h={};h=d.extend({},this.dataview.sortdata[g].value);
            c[g]=h}return c}return this.dataview.records},getrowboundindexbyid:function(b){var c=this.dataview.recordsbyid["id"+b];if(c&&c.boundindex)return this.getboundindex(c);c=this.getboundrows();for(var e=0;e<c.length;e++)if(c[e]&&c[e].uid==b)return e;return-1},getrowdatabyid:function(b){var c=this.dataview.recordsbyid["id"+b];if(c)return c;b=this.getrowboundindexbyid(b);return this.getboundrows()[b]},getrowdata:function(b){void 0==b&&(b=0);return this.virtualmode?this.dataview.records[b]:this.getboundrows()[b]},
        getrenderedrowdata:function(b,c){void 0==b&&(b=0);if(this.virtualmode){var e=this.getrowvisibleindex(b);return e=this.dataview.loadedrecords[e]}e=this.getrowvisibleindex(b);return 0<=e?(this.groupable&&0<this.groups.length?e=this.dataview.loadedrecords[e]:(e=this.dataview.loadedrecords[e],!this.pageable||void 0!=c&&0!=c||(e=this.dataview.loadedrecords[this.dataview.pagesize*this.dataview.pagenum+b])),e):null},getboundrows:function(){return this.dataview.cachedrecords},getrowdisplayindex:function(b){for(var c=
            this.getdisplayrows(),e=0;e<c.length;e++)if(c[e])if(void 0!==c[e].dataindex){if(c[e].dataindex==b)return c[e].visibleindex}else if(c[e].boundindex==b)return c[e].visibleindex;return-1},getboundindex:function(b){var c=b.boundindex;this.groupable&&0<this.groups.length&&this.pageable&&b.bounddata&&(c=this.getrowboundindexbyid(b.bounddata.uid));0<this.dataview.filters.length&&(b.bounddata?void 0!==b.bounddata.dataindex&&(c=b.bounddata.dataindex):void 0!==b.dataindex&&(c=b.dataindex));return c},getrowboundindex:function(b){return(b=
            this.getdisplayrows()[b])?void 0!==b.dataindex?b.dataindex:b.boundindex:-1},getdisplayrows:function(){return this.dataview.loadedrecords},getloadedrows:function(){return this.getdisplayrows()},getvisiblerowdata:function(b){var c=this.getvisiblerows();return c?c[b]:null},getloadedrowdata:function(b){var c=this.getloadedrows();return c?c[b]:null},getvisiblerows:function(){if(this.virtualmode)return this.dataview.loadedrecords;if(this.pageable){for(var b=[],c=0;c<this.dataview.pagesize;c++){var d=this.dataview.loadedrecords[c+
        this.dataview.pagesize*this.dataview.pagenum];if(void 0==d)break;b.push(d)}return b}if(void 0!=this._startboundindex&&void 0!=this._endboundindex){b=[];for(c=this._startvisibleindex;c<=this._endvisibleindex;c++){d=this.dataview.loadedrecords[c];if(void 0==d)break;b.push(d)}return b}return this.dataview.loadedrecords},getrowid:function(b){void 0==b&&(b=0);if(this.virtualmode){var c=this.getrowvisibleindex(b);if(c=this.dataview.loadedrecords[c])return c.uid}else if(c=0<this.dataview.filters.length,
        0<=b&&b<this.dataview.bounditems.length&&!c&&(c=this.getrowvisibleindex(b),c=this.dataview.loadedrecords[c])||0<this.dataview.filters.length&&(c=this.getboundrows()[b])&&null!=c.uid)return c.uid;return null},_updateGridData:function(b){var c=!1;this.filterable&&this._initfilterpanel&&this.dataview.filters.length&&(c=!0);c?(this.dataview.refresh(),"updaterow"==b?(this._render(!0,!0,!1,!1,!1),this.invalidate()):this.render()):this.sortcolumn||this.groupable&&0<this.groups.length?(this.dataview.reloaddata(),
            this.render()):("updaterow"===b&&(this.dataview.refresh(),this.virtualmode||this._render(!0,!0,!1,!1,!1)),this._cellscache=[],this._pagescache=[],this._renderrows(this.virtualsizeinfo));this.showfilterrow&&this.filterable&&this.filterrow&&this._updatelistfilters(!0)},updaterow:function(b,c,g){if(void 0!=b&&void 0!=c){var e=this.that,f=!1;e._datachanged=!0;var l=function(b,c,e){if(b._loading)throw Error("jqxGrid: "+b.loadingerrormessage);var f=!1;d.isArray(c)?(d.each(c,function(c,d){f=b.dataview.updaterow(this,
            e[c],!1)}),b._cellscache=[],b._pagescache=[],b.dataview.refresh()):f=b.dataview.updaterow(c,e);var h=b.vScrollInstance.value;void 0!=g&&1!=g||void 0!=b._updating&&0!=b._updating||b._updateGridData("updaterow");b.showaggregates&&b._updatecolumnsaggregates&&b._updatecolumnsaggregates();if(b.source&&b.source._knockoutdatasource&&!b._updateFromAdapter&&b.autokoupdates&&b.source._source._localdata){var k=b.dataview.recordsbyid["id"+c],l=b.dataview.records.indexOf(k);l=b.source._source._localdata()[l];
            b.source.suspendKO=!0;b.source._source._localdata.replace(l,d.extend({},k));b.source.suspendKO=!1}b.source&&b.source._source.localdata&&"observableArray"===b.source._source.localdata.name&&!b.source._source.localdata._updating&&(b.source._source.localdata._updating=!0,c=b.getrowboundindexbyid(c),b.source._source.localdata.set(c,e),b.source._source.localdata._updating=!1);b.vScrollInstance.setPosition(h);return f};if(this.source.updaterow){var m=function(d){1==d||void 0==d?l(e,b,c):f=!1};try{f=this.source.updaterow(b,
            c,m),void 0==f&&(f=!0)}catch(p){f=!1}}else f=l(e,b,c);return f}return!1},deleterow:function(b,c){if(void 0!=b){this._datachanged=!0;var e=!1,f=this.that,k=this.getrowboundindexbyid(b),l=[];if(void 0!=k&&(0<=this.selectedrowindexes.indexOf(k)&&this.selectedrowindexes.splice(this.selectedrowindexes.indexOf(k),1),this.selectedrowindex==k&&(this.selectedrowindex=-1),!this.virtualmode)){if(0<=f.selectionmode.indexOf("row"))d.each(this.selectedrowindexes,function(){var b=f.getrowid(this);l.push(b)}),this.selectedrowindexes=
            [],this.selectedrowindex=-1;else if(0<=f.selectionmode.indexOf("cell"))for(var m in f.selectedcells){var p=f.selectedcells[m],r=f.getrowid(p.rowindex);p.rowid=r}this._rendervisualrows()}var t=function(b,e){if(b._loading)throw Error("jqxGrid: "+b.loadingerrormessage);var f=!1,g=b.vScrollInstance.value;d.isArray(e)?(d.each(e,function(){f=b.dataview.deleterow(this,!1)}),b._cellscache=[],b._pagescache=[],b.dataview.refresh()):f=b.dataview.deleterow(e);if(!b.virtualmode)if(0<=b.selectionmode.indexOf("row"))d.each(l,
            function(){var c=b.getrowboundindexbyid(this);-1!=c&&b.selectrow(c,!1)});else{e=[];for(var h in b.selectedcells){var q=b.selectedcells[h],m=b.getrowboundindexbyid(q.rowid);-1!=m&&(q.rowindex=m,e[m+"_"+q.datafield]=q)}b.selectedcells=e}void 0!=b._updating&&0!=b._updating||void 0!=c&&1!=c||setTimeout(function(){b._render(!0,!0,!1,!1);"visible"!=b.vScrollBar.css("visibility")&&(b._arrange(),b._updatecolumnwidths(),b._updatecellwidths(),b._renderrows(b.virtualsizeinfo))});b.source&&b.source._knockoutdatasource&&
        !b._updateFromAdapter&&b.autokoupdates&&b.source._source._localdata&&(b.source.suspendKO=!0,b.source._source._localdata.pop(),b.source.suspendKO=!1);b.source&&b.source._source.localdata&&"observableArray"===b.source._source.localdata.name&&!b.source._source.localdata._updating&&(b.source._source.localdata._updating=!0,b.source._source.localdata.splice(k,1),b.source._source.localdata._updating=!1);b.dataview.sortby&&"many"!==b.sortmode&&(h=b.getsortinformation(),h.sortcolumn&&(b.dataview.clearsortdata(),
            b.dataview.sortby(h.sortcolumn,h.sortdirection?h.sortdirection.ascending:null)));b.vScrollInstance.setPosition(g);return f};if(this.source.deleterow){m=function(c){1!=c&&void 0!=c||t(f,b)};try{this.source.deleterow(b,m),void 0==e&&(e=!0)}catch(w){e=!1}}else e=t(f,b);return e}return!1},addrow:function(b,c,g){if(void 0!=c){this._datachanged=!0;void 0==g&&(g="last");var e=!1,f=this.that;if(null==b){var l=this.dataview.filters&&0<this.dataview.filters.length?this.dataview.cachedrecords.length:this.dataview.totalrecords;
            if(d.isArray(c)){var m=[];d.each(c,function(b,e){b=f.dataview.getid(f.dataview.source.id,c[b],l+b);m.push(b)});b=m}else for(b=this.dataview.getid(this.dataview.source.id,c,l);null!=this.dataview.recordsbyid["id"+b];)b++}var p=function(b,c,e,f){if(b._loading)throw Error("jqxGrid: "+b.loadingerrormessage);var g=b.vScrollInstance.value,h=!1;d.isArray(e)?(d.each(e,function(e,d){void 0!=this.dataindex&&delete this.dataindex;d=null;null!=c&&null!=c[e]&&(d=c[e]);h=b.dataview.addrow(d,this,f,!1)}),b._cellscache=
            [],b._pagescache=[],b.dataview.refresh()):(void 0!=e&&void 0!=e.dataindex&&delete e.dataindex,h=b.dataview.addrow(c,e,f));if(void 0==b._updating||0==b._updating)b._render(!0,!0,!1,!1),b.invalidate();b.source&&b.source._knockoutdatasource&&!b._updateFromAdapter&&b.autokoupdates&&b.source._source._localdata&&(b.source.suspendKO=!0,b.source._source._localdata.push(e),b.source.suspendKO=!1);if(b.source&&b.source._source.localdata&&"observableArray"===b.source._source.localdata.name&&!b.source._source.localdata._updating){b.source._source.localdata._updating=
            !0;var k=b.getrowboundindexbyid(c);b.source._source.localdata.set(k,e);b.source._source.localdata._updating=!1}"deferred"!=b.scrollmode?b.vScrollInstance.setPosition(g):b.vScrollInstance.setPosition(0);return h};if(this.source&&this.source.addrow){var r=function(e,d){if(1==e||void 0==e)void 0!=d&&(b=d),p(f,b,c,g)};try{e=this.source.addrow(b,c,g,r),void 0==e&&(e=!0)}catch(t){e=!1}if(0==e)return!1}else p(this,b,c,g);return e}return!1},_findvisiblerow:function(b,c){void 0==b&&(b=parseInt(this.vScrollInstance.value));
            var e=0;if(void 0==c||null==c)c=this.rows.records;for(var f=c.length;e<=f;){var d=parseInt((e+f)/2),l=c[d];if(void 0==l)break;if(l.top>b&&l.top+l.height>b)f=d-1;else if(l.top<b&&l.top+l.height<b)e=d+1;else return d}return-1},_updatecellwidths:function(){var b=this.virtualsizeinfo;if(b){var c=this.that;if(void 0!=c.gridcontent){void 0==c.table&&(c.table=c.gridcontent.find("#contenttable"+c.element.id));var d=c.groupable&&0<c.groups.length,h=0;b=b.visiblerecords;c.pageable&&(c.autoheight||c.autorowheight)&&
        (b=c.dataview.pagesize,c.groupable&&(c.dataview.updateview(),b=c.dataview.rows.length));c.groupable||c.pageable||!c.autoheight&&!c.autorowheight||(b=c.dataview.totalrecords);c.rowdetails&&(b+=c.dataview.pagesize);if(c.columns.records){for(var k=c.columns.records.length,l=c.table[0].rows,m=0;m<b;m++){var p=l[m];if(!p)break;p=p.cells;for(var r=0,t=0;t<k;t++){var w=c.columns.records[t],q=w.width;w.adaptivewidth&&(q=w.adaptivewidth);var u=p[t];parseInt(u.style.left)!=r&&(u.style.left=r+"px");parseInt(u.style.width)!=
        q&&(u.style.width=q+"px");w.hidden&&w.hideable||w.adaptivehidden?u.style.display="none":r+=parseFloat(q)}0==h&&(c.table.width(parseFloat(r)+2),h=r)}c.showaggregates&&c._updateaggregates&&c._updateaggregates();c.showfilterrow&&c.filterable&&c._updatefilterrowui&&c._updatefilterrowui();c.showeverpresentrow&&c._updateaddnewrowui();c._updatescrollbarsafterrowsprerender();d&&c._renderrows(c.virtualsizeinfo)}}}},_updatescrollbarsafterrowsprerender:function(){var b=this.that,c=b.hScrollBar[0].style.visibility,
            d=0,h=b.vScrollBar[0].style.visibility;"visible"==h&&(d=b.scrollbarsize+3);0==b.scrollbarsize&&(d=0);b.scrollbarautoshow&&(d=0);var k=b.element.style.width;k=0<=k.toString().indexOf("%")?b.host.width():parseInt(k);parseInt(b.table[0].style.width)-2>k-d?("visible"!=c&&(b.autowidth||(b.hScrollBar[0].style.visibility="visible"),b._arrange()),"visible"==h?"deferred"==b.scrollmode||b.virtualmode?b._updatevscrollbarmax():b.virtualsizeinfo&&(h=b.virtualsizeinfo.virtualheight-b._gettableheight(),!isNaN(h)&&
        0<h&&("hidden"!=c?b.vScrollBar.jqxScrollBar("max",h+b.scrollbarsize+4):b.vScrollBar.jqxScrollBar("max",h))):d=-2,b.hScrollBar.jqxScrollBar("max",d+b.table.width()-b.host.width())):"hidden"!=c&&(b.hScrollBar.css("visibility","hidden"),b._arrange());b._renderhorizontalscroll()},_hascolumnstyle:function(){if(void 0!==this._hascolumnstyles)return this._hascolumnstyles;this._hascolumnstyles=!1;for(var b=0;b<this.columns.records.length;b++){var c=this.columns.records[b];if(c.style.headerBackgroundColor||
            c.style.headerColor||c.style.headerBackgroundHoveredColor||c.style.headerHoveredColor||c.style.headerBackgroundSelectedColor||c.style.headerSelectedColor||c.style.backgroundColor||c.style.color||c.style.backgroundHoveredColor||c.style.hoveredColor||c.style.backgroundSelectedColor||c.style.selectedColor)return this._hascolumnstyles=!0}return!1},_prerenderrows:function(b){var c=this.that;if(1==c.prerenderrequired&&(c.prerenderrequired=!1,c.editable&&c._destroyeditors&&c._destroyeditors(),void 0!=c.gridcontent)){c.gridcontent.find("#contenttable"+
            c.element.id).remove();null!=c.table&&(c.table.remove(),c.table=null);c.table=d('<div id="contenttable'+c.element.id+'" style="overflow: hidden; position: relative;"></div>');c.gridcontent.addClass(c.toTP("jqx-grid-content"));c.gridcontent.addClass(c.toTP("jqx-widget-content"));c.gridcontent.append(c.table);var e=c.groupable&&0<c.groups.length,h=0;c.table[0].rows=[];var k=c.toTP("jqx-grid-cell");e&&(k=" "+c.toTP("jqx-grid-group-cell"));b=b.visiblerecords;c.pageable&&(c.autoheight||c.autorowheight)&&
        (b=c.dataview.pagesize,c.groupable&&(c.dataview.updateview(),b=c.dataview.rows.length,b<c.dataview.pagesize&&(b=c.dataview.pagesize)));c.pageable||!c.autoheight&&!c.autorowheight||(b=c.dataview.totalrecords);c.groupable&&0<c.groups.length&&(c.autoheight||c.autorowheight)&&!c.pageable&&(b=c.dataview.rows.length);c.rowdetails&&(b=c.autoheight||c.autorowheight?b+c.dataview.pagesize:b+b);if(c.columns.records){e=c.columns.records.length;d.jqx.browser.msie&&8<d.jqx.browser.version&&c.table.css("opacity",
            "0.99");-1!=navigator.userAgent.indexOf("Safari")&&c.table.css("opacity","0.99");var l=d.jqx.browser.msie&&8>d.jqx.browser.version;l&&c.host.attr("hideFocus","true");var m=c.tableZIndex;b*e>m&&(m=b*e);c.isTouchDevice();var p="";c._hiddencolumns=!1;for(var r=5+c.columns.records.length,t=0;t<b;t++){var w='<div role="row" style="position: relative; height:'+c.rowsheight+'px;" id="row'+t+c.element.id+'">';l&&(w='<div role="row" style="position: relative; z-index: '+m+"; height:"+c.rowsheight+'px;" id="row'+
            t+c.element.id+'">',m--);for(var q=0,u=0;u<e;u++){var y=c.columns.records[u],z=y.width;z<y.minwidth&&(z=y.minwidth);z>y.maxwidth&&(z=y.maxwidth);if(c.rtl){var A='<div columnindex="'+u+'" role="gridcell" style="left: '+q+"px; z-index: "+(m-e+2*u)+"; width:"+z+"px;";m--}else A='<div columnindex="'+u+'" role="gridcell" style="left: '+q+"px; z-index: "+m--+"; width:"+z+"px;";y.hidden&&y.hideable||y.adaptivehidden?(A+="display: none;",c._hiddencolumns=!0,m++):q+=z;0===t&&0===u&&(A+='" tabindex="'+r+'"');
            A+='" class="'+k+'">';y=this._defaultcellsrenderer("",y);A+=y;A+="</div>";w+=A}0==h&&(c.table.width(parseInt(q)+2),h=q);w+="</div>";p+=w}c.WinJS?MSApp.execUnsafeLocalFunction(function(){c.table.html(p)}):c.table[0].innerHTML=p;c.table[0].rows=[];h=c.table.children();for(t=0;t<b;t++)for(l=h[t],c.table[0].rows.push(l),l.cells=[],r=d(l).children(),u=0;u<e;u++)l.cells.push(r[u]);if(0==b){q=0;c.showemptyrow&&(w=d('<div style="position: relative;" id="row0'+c.element.id+'"></div>'),c.table.append(w),w.height(c.rowsheight),
            c.table[0].rows[0]=w[0],c.table[0].rows[0].cells=[]);for(u=0;u<e;u++)y=c.columns.records[u],z=y.width,c.showemptyrow&&(A=d('<div style="position: absolute; height: 100%; left: '+q+"px; z-index: "+m--+"; width:"+z+'px;" class="'+k+'"></div>'),A.height(c.rowsheight),w.append(A),c.table[0].rows[0].cells[u]=A[0]),z<y.minwidth&&(z=y.minwidth),z>y.maxwidth&&(z=y.maxwidth),y.hidden&&y.hideable||y.adaptivehidden||(q+=z);c.table.width(parseInt(q)+2);h=q}c._updatescrollbarsafterrowsprerender();c.rendered&&
        c.rendered("rows");c.toCompile=[];c._addoverlayelement()}}},_groupsheader:function(){return this.groupable&&this.showgroupsheader},_arrange:function(){var b=null,c=null;this.tableheight=null;var d=this.that,h=!1,k=!1;null!=d.width&&-1!=d.width.toString().indexOf("px")?b=d.width:void 0==d.width||isNaN(d.width)||(b=d.width);null!=d.width&&-1!=d.width.toString().indexOf("%")&&(b=d.width,h=!0);d.scrollbarautoshow&&(d.vScrollBar[0].style.display="none",d.hScrollBar[0].style.display="none",d.vScrollBar[0].style.zIndex=
            d.tableZIndex+d.headerZIndex,d.hScrollBar[0].style.zIndex=d.tableZIndex+d.headerZIndex);if(d.autowidth){for(var l=b=0;l<d.columns.records.length;l++){var m=d.columns.records[l].width;"auto"==m&&(m=d._measureElementWidth(d.columns.records[l].text));b+=m}"hidden"!=d.vScrollBar.css("visibility")&&(b+=d.scrollbarsize+4);d.width=b}null!=d.height&&-1!=d.height.toString().indexOf("px")?c=d.height:void 0==d.height||isNaN(d.height)||(c=d.height);null!=d.height&&-1!=d.height.toString().indexOf("%")&&(c=d.height,
            k=!0);l=function(){var b=0,c=d.showheader?null!=d.columnsheader?d.columnsheader.height()+2:0:0;b+=c;d.pageable&&(b+=d.pagerheight);d._groupsheader()&&(b+=d.groupsheaderheight);d.showtoolbar&&(b+=d.toolbarheight);d.showstatusbar&&(b+=d.statusbarheight);d.showeverpresentrow&&"bottom"===d.everpresentrowposition&&(b+=d.everpresentrowheight);"visible"==d.hScrollBar[0].style.visibility&&(b+=15);return b};d.autoheight&&d.virtualsizeinfo?d.pageable&&d.gotopage?(c=0+(d._pageviews[0]?d._pageviews[0].height:
            0),c+=l(),d.showemptyrow&&0==d.dataview.totalrecords&&(c+=d.rowsheight)):(c=d.host.height()-d._gettableheight(),0<d._pageviews.length?(c=c+d._pageviews[d._pageviews.length-1].height+d._pageviews[d._pageviews.length-1].top,d.vScrollBar[0].style.visibility="hidden"):(c=l(),d.showemptyrow&&(c+=d.rowsheight))):d.autoheight&&(c=d.dataview.totalrecords*d.rowsheight,d.pageable&&d.gotopage&&(c=d.pagesize*d.rowsheight),d._loading&&(c=250,d.dataloadelement.height(c)),c+=l(),1E4<c&&(c=1E4));null!=b?(b=parseInt(b),
            h?d.element.style.width=d.width:d.element.style.width!=parseInt(d.width)+"px"&&(d.element.style.width=parseInt(d.width)+"px"),h&&(b=d.host.width(),2>=b&&(b=600,d.host.width(b)),d._oldWidth||(d._oldWidth=b))):d.host.width(250);null!=c?(this.autoheight&&(c+=2),k||(c=parseInt(c)),k?d.element.style.height=d.height:d.element.style.height!=parseInt(c)+"px"&&(d.element.style.height=parseInt(c)+"px"),k&&!d.autoheight&&(c=d.host.height(),0==c&&(c=400,d.host.height(c)),d._oldHeight||(d._oldHeight=c))):d.host.height(250);
            d.autoheight&&(d.tableheight=null,d._gettableheight());h=0;d.showtoolbar?(d.toolbar.width(b),d.toolbar.height(d.toolbarheight-1),d.toolbar.css("top",0),h+=d.toolbarheight,c-=parseInt(d.toolbarheight)):d.toolbar[0].style.height="0px";d.showstatusbar?(d.showaggregates?d.statusbar.width(d.table?Math.max(b,d.table.width()):b):d.statusbar.width(b),d.statusbar.height(d.statusbarheight)):d.statusbar[0].style.height="0px";d.showeverpresentrow&&"bottom"===d.everpresentrowposition?(d.addnewrow.width(b),d.addnewrow.height(d.everpresentrowheight)):
                d.addnewrow[0].style.height="0px";d._groupsheader()?(d.groupsheader.width(b),d.groupsheader.height(d.groupsheaderheight),d.groupsheader.css("top",h),k=d.groupsheader.height()+1,h+=k,c>k&&(c-=parseInt(k))):(d.groupsheader[0].style.width!=b+"px"&&(d.groupsheader[0].style.width=parseInt(b)+"px"),d.groupsheader[0].style.height="0px",d.groupsheader[0].style.top!=h+"px"&&d.groupsheader.css("top",h),k=d.showgroupsheader&&d.groupable?d.groupsheaderheight:0,d.content[0].style.top!=h+k+"px"&&d.content.css("top",
                h+d.groupsheaderheight));var p=d.scrollbarsize;isNaN(p)&&(p=parseInt(p),p=isNaN(p)?"17px":p+"px");p=parseInt(p);m=2;k=0;"visible"==d.vScrollBar[0].style.visibility&&(k=p+4);"visible"==d.hScrollBar[0].style.visibility&&(m=p+4+2);0==p&&(m=k=0);l=0;d.pageable&&(l=d.pagerheight,m+=d.pagerheight);d.showstatusbar&&(m+=d.statusbarheight,l+=d.statusbarheight);d.showeverpresentrow&&"bottom"===d.everpresentrowposition&&(m+=d.everpresentrowheight,l+=d.everpresentrowheight);d.hScrollBar[0].style.height!=p+"px"&&
            (d.hScrollBar[0].style.height=parseInt(p)+"px");d.hScrollBar[0].style.top==h+c-4-p-l+"px"&&"0px"==d.hScrollBar[0].style.left||d.hScrollBar.css({top:h+c-4-p-l+"px",left:"0px"});var r=d.hScrollBar[0].style.width,t=!1,w=!1;0==k?r!=b-2+"px"&&(d.hScrollBar.width(b-2),t=!0):r!=b-p-4+"px"&&(d.hScrollBar.width(b-p-4+"px"),t=!0);d.autoheight||(d.vScrollBar[0].style.width!=p+"px"&&(d.vScrollBar.width(p),w=!0),d.vScrollBar[0].style.height!=parseInt(c)-m+"px"&&(d.vScrollBar.height(parseInt(c)-m+"px"),w=!0),d.vScrollBar[0].style.left==
            parseInt(b)-parseInt(p)-4+"px"&&d.vScrollBar[0].style.top==h+"px"||d.vScrollBar.css({left:parseInt(b)-parseInt(p)-4+"px",top:h}));d.rtl&&(d.vScrollBar.css({left:"0px",top:h}),"hidden"!=d.vScrollBar.css("visibility")&&d.hScrollBar.css({left:p+2}));r=d.vScrollInstance;r.disabled=d.disabled;d.autoheight||w&&r.refresh();w=d.hScrollInstance;w.disabled=d.disabled;t&&w.refresh();d.autowidth&&(d.hScrollBar[0].style.visibility="hidden");d.statusbarheight=parseInt(d.statusbarheight);d.toolbarheight=parseInt(d.toolbarheight);
            t=function(b){if("visible"==b.vScrollBar[0].style.visibility&&"visible"==b.hScrollBar[0].style.visibility){b.bottomRight[0].style.visibility="visible";b.bottomRight.css({left:1+parseInt(b.vScrollBar.css("left")),top:parseInt(b.hScrollBar.css("top"))});b.rtl&&b.bottomRight.css("left","0px");b.bottomRight.width(parseInt(p)+3);b.bottomRight.height(parseInt(p)+4);var c=b.showeverpresentrow&&"bottom"==b.everpresentrowposition?b.everpresentrowheight:0;0<c&&!b.showaggregates&&(b.bottomRight.css("z-index",
                99),b.bottomRight.height(parseInt(p)+4+c),b.bottomRight.css({top:parseInt(b.hScrollBar.css("top"))-c}));b.showaggregates&&(b.bottomRight.css("z-index",99),b.bottomRight.height(parseInt(p)+4+b.statusbarheight+c),b.bottomRight.css({top:parseInt(b.hScrollBar.css("top"))-b.statusbarheight-c}))}else b.bottomRight[0].style.visibility="hidden"};t(this);d.content[0].style.width!=b-k+"px"&&d.content.width(b-k);d.content[0].style.height!=c-m+3+"px"&&d.content.height(c-m+3);d.scrollbarautoshow&&(d.content[0].style.width!=
            b+"px"&&d.content.width(b),d.content[0].style.height!=c+"px"&&d.content.height(c));d.content[0].style.top!=h+"px"&&d.content.css("top",h);d.rtl&&(d.content.css("left",k),d.scrollbarautoshow&&d.content.css("left","0px"),d.table&&(m=d.table.width(),m<b-k&&d.content.css("left",b-m)));d.showstatusbar&&(d.statusbar.css("top",h+c-d.statusbarheight-(d.pageable?d.pagerheight:0)),d.showaggregates&&("visible"==d.hScrollBar.css("visibility")&&(d.hScrollBar.css({top:h+c-4-p-l+d.statusbarheight+"px"}),d.statusbar.css("top",
                1+h+c-p-5-d.statusbarheight-(d.pageable?d.pagerheight:0))),t(this)),d.rtl&&("visible"!=d.hScrollBar.css("visibility")?d.statusbar.css("left",d.content.css("left")):d.statusbar.css("left","0px")));d.showeverpresentrow&&"bottom"===d.everpresentrowposition&&(d.addnewrow.css("top",h+c-(d.showstatusbar?d.statusbarheight:0)-(d.pageable?d.pagerheight:0)-d.everpresentrowheight),d.rtl&&("visible"!=d.hScrollBar.css("visibility")?d.addnewrow.css("left",d.content.css("left")):d.addnewrow.css("left","0px")));
            d.pageable?(d.pager.width(b),d.pager.height(d.pagerheight),d.pager.css("top",h+c-d.pagerheight-1)):d.pager[0].style.height="0px";null!=d.table&&(h=-2,"visible"==d.vScrollBar[0].style.visibility&&(h=d.scrollbarsize+3),"visible"==d.hScrollBar[0].style.visibility&&(h=h+d.table.width()-d.host.width(),0<=h&&d.hScrollBar.jqxScrollBar("max",h),"visible"==d.hScrollBar[0].style.visibility&&0==h&&(d.hScrollBar[0].style.visibility="hidden",d._arrange())));b!=parseInt(d.dataloadelement[0].style.width)&&(d.dataloadelement[0].style.width=
                d.element.style.width);c!=parseInt(d.dataloadelement[0].style.height)&&(d.dataloadelement[0].style.height=d.element.style.height);this.pagergotoinput&&(this.pagergotoinput.offset().top!==this.pagergoto.offset().top?(this.pagergotoinput.css("visibility","hidden"),this.pagergoto.css("visibility","hidden")):(this.pagergotoinput.css("visibility","inherit"),this.pagergoto.css("visibility","inherit")));d._hostwidth=b},destroy:function(){delete d.jqx.dataFormat.datescache;delete this.gridlocalization;d.jqx.utilities.resize(this.host,
            null,!0);(""!=document.referrer||window.frameElement)&&null!=window.top&&window.top!=window.self&&this.removeHandler(d(window.top.document),"mouseup.grid"+this.element.id);if(this.table&&this.table[0]){for(var b=this.table[0].rows.length,c=0;c<b;c++){for(var g=this.table[0].rows[c],h=g.cells.length,k=0;k<h;k++)d(g.cells[k]).remove(),g.cells[k]=null,delete g.cells[k];g.cells=null;g.cells&&delete g.cells;d(this.table[0].rows[c]).remove();this.table[0].rows[c]=null}try{delete this.table[0].rows}catch(l){}this.table.remove();
            delete this.table}if(this.columns&&this.columns.records){for(c=0;c<this.columns.records.length;c++)b=this.columns.records[c],b.addnewrowwidget&&b.destroyeverpresentrowwidget&&b.destroyeverpresentrowwidget(b.addnewrowwidget),b.destroywidget&&b.destroywidget&&b.destroywidget(b.widget),this._removecolumnhandlers(this.columns.records[c]),b.element&&(d(b.element).remove(),d(b.sortasc).remove(),d(b.sortdesc).remove(),d(b.filtericon).remove(),d(b.menu).remove(),b.element=null,b.uielement=null,b.sortasc=
            null,b.sortdesc=null,b.filtericon=null,b.menu=null,delete b.element,delete b.uielement,delete b.sortasc,delete b.sortdesc,delete b.filtericon,delete b.menu,delete this.columnsrow[0].cells[c]);try{delete this.columnsrow[0].cells}catch(l){}delete this.columnsrow}d.removeData(document.body,"contextmenu"+this.element.id);this.host.jqxDropDownList&&this._destroyfilterpanel&&this._destroyfilterpanel();this.editable&&this._destroyeditors&&this._destroyeditors();this.filterable&&this._destroyedfilters&&this.showfilterrow&&
        this._destroyedfilters();this.host.jqxMenu&&this.gridmenu&&(this.removeHandler(d(document),"click.menu"+this.element.id),this.removeHandler(this.gridmenu,"keydown"),this.removeHandler(this.gridmenu,"closed"),this.removeHandler(this.gridmenu,"itemclick"),this.gridmenu.jqxMenu("destroy"),this.gridmenu=null);this.pagershowrowscombo&&(this.pagershowrowscombo.jqxDropDownList("destroy"),this.pagershowrowscombo=null);this.pagerrightbutton&&(this.removeHandler(this.pagerrightbutton,"mousedown"),this.removeHandler(this.pagerrightbutton,
            "mouseup"),this.removeHandler(this.pagerrightbutton,"click"),this.pagerrightbutton.jqxButton("destroy"),this.pagerrightbutton=null);this.pagerleftbutton&&(this.removeHandler(this.pagerleftbutton,"mousedown"),this.removeHandler(this.pagerleftbutton,"mouseup"),this.removeHandler(this.pagerleftbutton,"click"),this.pagerleftbutton.jqxButton("destroy"),this.removeHandler(d(document),"mouseup.pagerbuttons"+this.element.id),this.pagerleftbutton=null);this.removeHandler(d(document),"selectstart."+this.element.id);
            this.removeHandler(d(document),"mousedown.resize"+this.element.id);this.removeHandler(d(document),"mouseup.resize"+this.element.id);this.removeHandler(d(document),"mousemove.resize"+this.element.id);this.isTouchDevice()&&(c=d.jqx.mobile.getTouchEventName("touchmove")+".resize"+this.element.id,b=d.jqx.mobile.getTouchEventName("touchstart")+".resize"+this.element.id,g=d.jqx.mobile.getTouchEventName("touchend")+".resize"+this.element.id,this.removeHandler(d(document),c),this.removeHandler(d(document),
                b),this.removeHandler(d(document),g));this.removeHandler(d(document),"mousedown.reorder"+this.element.id);this.removeHandler(d(document),"mouseup.reorder"+this.element.id);this.removeHandler(d(document),"mousemove.reorder"+this.element.id);this.isTouchDevice()&&(c=d.jqx.mobile.getTouchEventName("touchmove")+".reorder"+this.element.id,b=d.jqx.mobile.getTouchEventName("touchstart")+".reorder"+this.element.id,g=d.jqx.mobile.getTouchEventName("touchend")+".reorder"+this.element.id,this.removeHandler(d(document),
                c),this.removeHandler(d(document),b),this.removeHandler(d(document),g));this.removeHandler(d(window),"resize."+this.element.id);this.resizeline&&this.resizeline.remove();this.resizestartline&&this.resizestartline.remove();this.groupable&&(c="mousemove.grouping"+this.element.id,b="mousedown.grouping"+this.element.id,g="mouseup.grouping"+this.element.id,this.removeHandler(d(document),c),this.removeHandler(d(document),b),this.removeHandler(d(document),g));this.columnsreorder&&(c="mousemove.reorder"+
                this.element.id,b="mousedown.reorder"+this.element.id,g="mouseup.reorder"+this.element.id,this.removeHandler(d(document),c),this.removeHandler(d(document),b),this.removeHandler(d(document),g),delete this.columnsbounds);this.content&&(this.removeHandler(this.content,"mousedown"),this.removeHandler(this.content,"scroll"));this._removeHandlers();this.hScrollInstance.destroy();this.vScrollInstance.destroy();this.hScrollBar.remove();this.vScrollBar.remove();this._clearcaches();delete this.hScrollInstance;
            delete this.vScrollInstance;delete this.visiblerows;delete this.hittestinfo;delete this.rows;delete this.columns;delete this.columnsbydatafield;delete this.pagescache;delete this.pageviews;delete this.cellscache;delete this.heights;delete this.hiddens;delete this.hiddenboundrows;delete this.heightboundrows;delete this.detailboundrows;delete this.details;delete this.expandedgroups;delete this._rowdetailscache;delete this._rowdetailselementscache;delete this.columnsmenu;this.columnsheader&&(this.columnsheader.remove(),
                delete this.columnsheader);this.selectionarea&&(this.selectionarea.remove(),delete this.selectionarea);if(this.menuitemsarray&&this.menuitemsarray.length)for(b=this.menuitemsarray.length,c=0;c<b;c++)d(this.menuitemsarray[c]).remove();delete this.menuitemsarray;this.dataview._clearcaches();this.content.removeClass();this.content.remove();this.content=null;delete this.content;this.hScrollBar=this.vScrollBar=null;delete this.hScrollBar;delete this.hScrollBar;this.gridcontent&&(this.gridcontent.remove(),
                delete this.gridcontent);this.gridmenu&&(this.gridmenu=null,delete this.gridmenu);delete this._mousemovefunc;delete this._mousewheelfunc;this.dataview.destroy();delete this.dataview;this.bottomRight.remove();delete this.bottomRight;this.wrapper.remove();delete this.wrapper;this.pagerdiv&&(this.pagerdiv.remove(),delete this.pagerdiv);this.pagerpageinput&&(this.pagerpageinput.remove(),delete this.pagerpageinput);this.pagergoto&&(this.pagergoto.remove(),delete this.pagergoto);this.pagershowrows&&(this.pagershowrows.remove(),
                delete this.pagershowrows);this.pagerfirstbutton&&(this.pagerfirstbutton.remove(),delete this.pagerfirstbutton);this.pagerlastbutton&&(this.pagerlastbutton.remove(),delete this.pagerlastbutton);this.pagerbuttons&&(this.pagerbuttons.remove(),delete this.pagerbuttons);this.pagerdetails&&(this.pagerdetails.remove(),delete this.pagerdetails);this.pagergotoinput&&(this.pagergotoinput.remove(),delete this.pagergotoinput);this.pager.remove();delete this.pager;this.groupsheader.remove();delete this.groupsheader;
            this.dataloadelement.remove();delete this.dataloadelement;this.toolbar.remove();delete this.toolbar;this.statusbar.remove();delete this.statusbar;this.host.removeData();this.host.removeClass();this.host.remove();this.host=null;delete this.host;delete this.element;delete this.set;delete this.get;delete this.that;delete this.call},_initializeColumns:function(){var c=this.source?this.source.datafields:null;null==c&&this.source&&this.source._source&&(c=this.source._source.datafields);var f=c?0<c.length:
            !1;if(this.autogeneratecolumns){var g=[];if(c)d.each(c,function(){g.push({datafield:this.name,text:this.text||this.name,cellsformat:this.format||""})});else if(0<this.source.records.length){c=this.source.records[0];for(var h in c)"uid"!=h&&(c={width:100,datafield:h,text:h},g.push(c))}this.columns=g}if(this.columns&&this.columns.records)for(h=0;h<this.columns.records.length;h++)this._removecolumnhandlers(this.columns.records[h]);var k=this.that,l=new d.jqx.collection(this.element),m=0;this._haspinned=
            !1;this._columns?this.columns=this._columns:this._columns=this.columns;this.groupable&&d.each(this.groups,function(c){c=new b(k,this);c.visibleindex=m++;c.width=k.groupindentwidth;l.add(c);c.grouped=!0;c.filterable=!1;c.sortable=!1;c.editable=!1;c.resizable=!1;c.draggable=!1});this.rowdetails&&this.showrowdetailscolumn&&(c=new b(k,this),c.visibleindex=m++,c.width=k.groupindentwidth,c.pinned=!0,c.editable=!1,c.filterable=!1,c.draggable=!1,c.groupable=!1,c.resizable=!1,l.add(c),k._haspinned=!0);"checkbox"==
        this.selectionmode&&(c=new b(k,null),c.visibleindex=m++,c.width=k.groupindentwidth,c.checkboxcolumn=!0,c.editable=!1,c.columntype="checkbox",c.groupable=!1,c.draggable=!1,c.filterable=!1,c.resizable=!1,c.datafield="_checkboxcolumn",l.add(c));var p=[];d.each(this.columns,function(c){if(void 0!=k.columns[c]){var e=new b(k,this);e.visibleindex=m++;void 0!=this.dataField&&(this.datafield=this.dataField);this.pinned&&(k._haspinned=!0);!k.showeverpresentrow||"addButtonColumn"!==this.datafield&&"resetButtonColumn"!==
        this.datafield&&"updateButtonColumn"!==this.datafield&&"deleteButtonColumn"!==this.datafield||(e.editable=!1,e.groupable=!1,e.draggable=!1,e.filterable=!1,e.resizable=!1,e.menu=!1);if(null==this.datafield)k.source&&k.source._source&&"array"==k.source._source.datatype&&(f||(k.source._source.datafields||(k.source._source.datafields=[]),k.source._source.datafields.push({name:c.toString()})),this.datafield=c.toString(),this.displayfield=c.toString(),e.datafield=this.datafield,e.displayfield=this.displayfield);
        else{if(p[this.datafield])throw Error("jqxGrid: Invalid column 'datafield' setting. jqxGrid's columns should be initialized with unique data fields.");p[this.datafield]=!0}l.add(e)}});this.adaptive&&(c=new b(k,null),c.visibleindex=m++,c.width=k.groupindentwidth,c.editable=!1,c.columntype="adaptive",c.cellsalign="center",c.groupable=!1,c.draggable=!1,c.menu=!1,c.sortable=!1,c.filterable=!1,c.resizable=!1,c.datafield="_adaptivecolumn",l.add(c));this.rtl&&l.records.reverse();this.columns=l},_initializeRows:function(){var b=
            new d.jqx.collection(this.element);this.rows&&this.rows.clear();this.rows=b},_raiseEvent:function(b,c){void 0==c&&(c={owner:null});if(!1!==this._trigger){var e=this.events[b];this._camelCase||(e=e.toLowerCase());if((2==b||15==b)&&this.showeverpresentrow&&(0<=this.everpresentrowactions.indexOf("delete")||0<=this.everpresentrowactions.indexOf("update"))){if(this.updateeverpresentrow)var f=this;setTimeout(function(){f.updateeverpresentrow()},50)}c.owner=this;e=new d.Event(e);e.owner=this;e.args=c;b=
            this.host.trigger(e);c=e.args;return b}},wheel:function(b,c){if(c.autoheight&&"visible"!=c.hScrollBar.css("visibility"))return b.returnValue=!0;var e=0;b||(b=window.event);b.originalEvent&&b.originalEvent.wheelDelta&&(b.wheelDelta=b.originalEvent.wheelDelta);b.wheelDelta?e=b.wheelDelta/120:b.detail&&(e=-b.detail/3);if(e){if(c=c._handleDelta(e))b.preventDefault&&b.preventDefault(),null!=b.originalEvent&&(b.originalEvent.mouseHandled=!0),void 0!=b.stopPropagation&&b.stopPropagation();return c?(c=!1,
            b.returnValue=c):!1}b.preventDefault&&b.preventDefault();b.returnValue=!1},_handleDelta:function(b){if("hidden"!=this.vScrollBar.css("visibility")){var c=this.vScrollInstance.value;0>b?this.scrollDown():this.scrollUp();b=this.vScrollInstance.value;if(c!=b)return!0}else if("hidden"!=this.hScrollBar.css("visibility")&&(c=this.hScrollInstance.value,0<b?this.hScrollInstance.value>2*this.horizontalscrollbarstep?this.hScrollInstance.setPosition(this.hScrollInstance.value-2*this.horizontalscrollbarstep):
            this.hScrollInstance.setPosition(0):this.hScrollInstance.value<this.hScrollInstance.max?this.hScrollInstance.setPosition(this.hScrollInstance.value+2*this.horizontalscrollbarstep):this.hScrollInstance.setPosition(this.hScrollInstance.max),b=this.hScrollInstance.value,c!=b))return this._activeFilterElement&&this._activeFilterElement.jqxDropDownList("close"),!0;return!1},scrollDown:function(){if("hidden"!=this.vScrollBar.css("visibility")){var b=this.vScrollInstance;b.value+this.rowsheight<=b.max?b.setPosition(parseInt(b.value)+
            this.rowsheight):b.setPosition(b.max)}},scrollUp:function(){if("hidden"!=this.vScrollBar.css("visibility")){var b=this.vScrollInstance;b.value-this.rowsheight>=b.min?b.setPosition(parseInt(b.value)-this.rowsheight):b.setPosition(b.min)}},_removeHandlers:function(){var b=this.that;b.removeHandler(d(window),"orientationchange.jqxgrid"+b.element.id);b.removeHandler(d(window),"orientationchanged.jqxgrid"+b.element.id);b.removeHandler(b.vScrollBar,"valueChanged");b.removeHandler(b.hScrollBar,"valueChanged");
            b.vScrollInstance.valueChanged=null;b.hScrollInstance.valueChanged=null;var c="mousedown.jqxgrid";b.isTouchDevice()&&(c=d.jqx.mobile.getTouchEventName("touchend"));b.removeHandler(b.host,"dblclick.jqxgrid");b.removeHandler(b.host,c);b.removeHandler(b.content,"mousemove",b._mousemovefunc);b.removeHandler(b.host,"mouseleave.jqxgrid");b.removeHandler(b.content,"mouseenter");b.removeHandler(b.content,"mouseleave");b.removeHandler(b.content,"mousedown");b.removeHandler(b.content,"scroll");b.removeHandler(b.content,
                "selectstart."+b.element.id);b.removeHandler(b.host,"dragstart."+b.element.id);b.removeHandler(b.host,"keydown.edit"+b.element.id);b.removeHandler(d(document),"keydown.edit"+b.element.id);b.removeHandler(d(document),"keyup.edit"+b.element.id);b._mousemovedocumentfunc&&b.removeHandler(d(document),"mousemove.selection"+b.element.id,b._mousemovedocumentfunc);b.removeHandler(d(document),"mouseup.selection"+b.element.id);b._mousewheelfunc&&b.removeHandler(b.host,"mousewheel",b._mousewheelfunc);b.editable&&
            b.removeHandler(d(document),"mousedown.gridedit"+b.element.id);b.host.off&&(b.content.off("mousemove"),b.host.off("mousewheel"))},_addHandlers:function(){var b=this.that,c=b.isTouchDevice();c||b.addHandler(b.host,"dragstart."+b.element.id,function(b){return!1});b.scrollbarautoshow&&(b.addHandler(b.host,"mouseenter.gridscroll"+b.element.id,function(c){b.vScrollBar.fadeIn("fast");b.hScrollBar.fadeIn("fast")}),b.addHandler(b.host,"mouseleave.gridscroll"+b.element.id,function(c){b.vScrollInstance.isScrolling()||
        b.hScrollInstance.isScrolling()||(b.vScrollBar.fadeOut("fast"),b.hScrollBar.fadeOut("fast"))}));b.editable&&b.addHandler(d(document),"mousedown.gridedit"+b.element.id,function(c){if(b.editable&&b.begincelledit&&b.editcell&&!b.vScrollInstance.isScrolling()&&!b.vScrollInstance.isScrolling()){var e=b.host.coord(),d=b.host.width(),f=b.host.height(),g=!1,h=!1;if(c.pageY<e.top||c.pageY>e.top+f)h=g=!0;if(c.pageX<e.left||c.pageX>e.left+d)g=!0;if(g){if(b.editcell&&b.editcell.editor)switch(b.editcell.columntype){case "datetimeinput":if(b.editcell.editor.jqxDateTimeInput&&
            b.editcell.editor.jqxDateTimeInput("container")&&"block"==b.editcell.editor.jqxDateTimeInput("container")[0].style.display)if(e=b.editcell.editor.jqxDateTimeInput("container").coord().top,d=b.editcell.editor.jqxDateTimeInput("container").coord().top+b.editcell.editor.jqxDateTimeInput("container").height(),h&&(c.pageY<e||c.pageY>d))b.editcell.editor.jqxDateTimeInput("close");else return;break;case "combobox":if(b.editcell.editor.jqxComboBox&&b.editcell.editor.jqxComboBox("container")&&"block"==b.editcell.editor.jqxComboBox("container")[0].style.display)if(e=
            b.editcell.editor.jqxComboBox("container").coord().top,d=b.editcell.editor.jqxComboBox("container").coord().top+b.editcell.editor.jqxComboBox("container").height(),h&&(c.pageY<e||c.pageY>d))b.editcell.editor.jqxComboBox("close");else return;break;case "dropdownlist":if(b.editcell.editor.jqxDropDownList&&b.editcell.editor.jqxDropDownList("container")&&"block"==b.editcell.editor.jqxDropDownList("container")[0].style.display)if(e=b.editcell.editor.jqxDropDownList("container").coord().top,d=b.editcell.editor.jqxDropDownList("container").coord().top+
            b.editcell.editor.jqxDropDownList("container").height(),h&&(c.pageY<e||c.pageY>d))b.editcell.editor.jqxDropDownList("close");else return;break;case "template":case "custom":for(e=["jqxDropDownList","jqxComboBox","jqxDropDownButton","jqxDateTimeInput"],d=0;d<e.length;d++){f=e[d];g=b.editcell.editor.data();if(g[f]&&g[f].instance.container&&"block"==g[f].instance.container[0].style.display){f=g[f].instance;g=f.container.coord().top;var t=f.container.coord().top+f.container.height();h&&(c.pageY<g||c.pageY>
            t)?(f.close(),f=!0):f=!1}else f=void 0;if(0==f)return}}b.endcelledit(b.editcell.row,b.editcell.column,!1,!0);b._oldselectedcell=null}}});b.vScrollInstance.valueChanged=function(e){b.virtualsizeinfo&&(b._closemenu(),b._renderrows(b.virtualsizeinfo),b.currentScrollValue=e.currentValue,b.pageable||b.groupable||!b.dataview.virtualmode||(b.loadondemandupdate&&clearTimeout(b.loadondemandupdate),b.loadondemandupdate=setTimeout(function(){b.loadondemand=!0;b._renderrows(b.virtualsizeinfo)},100)),c&&(b._lastScroll=
            new Date))};b.hScrollInstance.valueChanged=function(e){if(b.virtualsizeinfo){b._closemenu();var f=function(){b._renderhorizontalscroll();b._renderrows(b.virtualsizeinfo);b.editcell&&!b.editrow&&b._showcelleditor&&b.editcell.editing&&(b.hScrollInstance.isScrolling()||b._showcelleditor(b.editcell.row,b.getcolumn(b.editcell.column),b.editcell.element,b.editcell.init))};c?f():(void 0==b._browser&&b._isIE10(),navigator&&-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")?
            (b._hScrollTimer&&clearTimeout(b._hScrollTimer),b._hScrollTimer=setTimeout(function(){f()},1)):d.jqx.browser.msie?(b._hScrollTimer&&clearTimeout(b._hScrollTimer),b._hScrollTimer=setTimeout(function(){f()},.01)):f());c&&(b._lastScroll=new Date)}};b._mousewheelfunc=b._mousewheelfunc||function(c){if(!b.editcell&&b.enablemousewheel)return b.wheel(c,b),!1};b.removeHandler(b.host,"mousewheel",b._mousewheelfunc);b.addHandler(b.host,"mousewheel",b._mousewheelfunc);var g="mousedown.jqxgrid";c&&(g=d.jqx.mobile.getTouchEventName("touchend"));
            b.addHandler(b.host,g,function(c){if(b.isTouchDevice()&&(b._newScroll=new Date,500>b._newScroll-b._lastScroll||d(c.target).ischildof(b.vScrollBar)||d(c.target).ischildof(b.hScrollBar)))return!1;b._mousedown=new Date;var e=b._handlemousedown(c,b);b.isNestedGrid&&(b.resizablecolumn||b.columnsreorder||c.stopPropagation());b._lastmousedown=new Date;return e});c||(b.addHandler(b.host,"dblclick.jqxgrid",function(c){b.editable&&b.begincelledit&&"dblclick"==b.editmode?b._handledblclick(c,b):d.jqx.browser.msie&&
                9>d.jqx.browser.version&&b._handlemousedown(c,b);b.mousecaptured=!1;b._lastmousedown=new Date;return!0}),b._mousemovefunc=function(c){if(b._handlemousemove)return b._handlemousemove(c,b)},b.addHandler(b.content,"mousemove",b._mousemovefunc),b._handlemousemoveselection&&(b._mousemovedocumentfunc=function(c){if(b._handlemousemoveselection)return b._handlemousemoveselection(c,b)},b.addHandler(d(document),"mousemove.selection"+b.element.id,b._mousemovedocumentfunc)),b.addHandler(d(document),"mouseup.selection"+
                b.element.id,function(c){b._handlemouseupselection&&b._handlemouseupselection(c,b)}));try{""==document.referrer&&!window.frameElement||null==window.top||window.top==window.self||(g=null,window.parent&&document.referrer&&(g=document.referrer),g&&-1!=g.indexOf(document.location.host)&&b.addHandler(d(window.top.document),"mouseup.grid"+b.element.id,function(c){if(b._handlemouseupselection)try{b._handlemouseupselection(c,b)}catch(k){}}))}catch(h){}b.focused=!1;c||(b.addHandler(b.content,"mouseenter",
                function(c){b.focused=!0;b.wrapper&&(b.wrapper.attr("tabindex",1),b.content.attr("tabindex",2));b._overlayElement&&(b.vScrollInstance.isScrolling()||b.hScrollInstance.isScrolling()?b._overlayElement[0].style.visibility="visible":b._overlayElement[0].style.visibility="hidden")}),b.addHandler(b.content,"mouseleave",function(c){b._handlemousemove&&b.enablehover&&b._clearhoverstyle();b._overlayElement&&(b._overlayElement[0].style.visibility="hidden");b.focused=!1}),(b.groupable||b.columnsreorder)&&b.addHandler(d(document),
                "selectstart."+b.element.id,function(c){if(!0===b.__drag)return!1}),b.addHandler(b.content,"selectstart."+b.element.id,function(c){if(b.enablebrowserselection||b.showfilterrow&&d(c.target).ischildof(b.filterrow)||b.showeverpresentrow&&(d(c.target).ischildof(b.addnewrow)||b.addnewrowtop&&d(c.target).ischildof(b.addnewrowtop))||c.target.className&&0<=c.target.className.indexOf("jqx-grid-widget"))return!0;if(!b.editcell)return!1;c.stopPropagation&&c.stopPropagation()}),b.addHandler(d(document),"keyup.edit"+
                b.element.id,function(c){b._keydown=!1}),b.addHandler(d(document),"keydown.edit"+b.element.id,function(c){if(b.adaptiveview)return!0;b._keydown=!b.editcell;var e=c.charCode?c.charCode:c.keyCode?c.keyCode:0;20===e&&(b._capsLock=b._capsLock?!1:!0);if(b.handlekeyboardnavigation&&(b.focused||c.target===b.element||d(c.target).ischildof(b.host))&&1==b.handlekeyboardnavigation(c))return!1;b.editable&&b.editcell&&(13==e||27==e||9==e||32==e)&&b._handleeditkeydown&&(f=b._handleeditkeydown(c,b));27==e&&(b.mousecaptured=
                !1,"visible"==b.selectionarea.css("visibility")&&b.selectionarea.css("visibility","hidden"));if(d.jqx.browser.msie&&12>d.jqx.browser.version&&b.focused&&!b.isNestedGrid){if(13==e&&0==f)return f;var f=!0;!b.editcell&&b.editable&&"programmatic"!=b.editmode&&b._handleeditkeydown&&(f=b._handleeditkeydown(c,b));if(f&&b.keyboardnavigation&&b._handlekeydown)return f=b._handlekeydown(c,b),f||(c.preventDefault&&c.preventDefault(),void 0!=c.stopPropagation&&c.stopPropagation()),f}return!0}),b.addHandler(b.host,
                "keyup.edit"+b.element.id,function(c){if(b.adaptiveview)return!0;if(9===c.keyCode&&!d(document.activeElement).ischildof(b.filterrow)&&!d(document.activeElement).ischildof(b.pager))switch(b.selectionmode){case "singlecell":case "multiplecells":case "multiplecellsextended":case "multiplecellsadvanced":null===b.getselectedcell()&&b.selectcell(0,b.columns.records[0].displayfield);break;default:-1===b.getselectedrowindex()&&b.selectrow(0)}}),b.addHandler(b.host,"keydown.edit"+b.element.id,function(c){var e=
                !0;if(b.adaptiveview)return!0;if(b.handlekeyboardnavigation&&1==b.handlekeyboardnavigation(c))return!1;b.editable&&"programmatic"!=b.editmode&&b._handleeditkeydown&&(e=b._handleeditkeydown(c,b),b.isNestedGrid&&c.stopPropagation());if(!b.editcell&&c.altKey&&!d(document.activeElement).ischildof(b.filterrow)&&!d(document.activeElement).ischildof(b.pager))if(40===c.keyCode){var f=b.getselectedcell();f&&b.openmenu(f.column)}else 38===c.keyCode&&b._closemenu();d.jqx.browser.msie&&8>d.jqx.browser.version?
                b.isNestedGrid&&e&&b.keyboardnavigation&&b._handlekeydown&&(e=b._handlekeydown(c,b),c.stopPropagation()):e&&b.keyboardnavigation&&b._handlekeydown&&(e=b._handlekeydown(c,b),b.isNestedGrid&&c.stopPropagation());e||(c.preventDefault&&c.preventDefault(),void 0!=c.stopPropagation&&c.stopPropagation());e&&b.selectedcells&&0<b.selectedcells.length&&9===c.keyCode&&c.shiftKey&&b.table&&b.table[0].rows&&0<b.table[0].rows.length&&(d(document.activeElement).ischildof(b.filterrow)||d(document.activeElement).ischildof(b.pager)||
                b.table[0].rows[0].cells[0].focus());return e}))},_hittestrow:function(b,c){if(null!=this.vScrollInstance&&null!=this.hScrollInstance){void 0==c&&0==c;var e=this.hScrollInstance;b=this.vScrollInstance.value;"visible"!=this.vScrollBar.css("visibility")&&(b=0);e=e.value;"visible"!=this.hScrollBar.css("visibility")&&(e=0);"deferred"==this.scrollmode&&null!=this._newmax&&b>this._newmax&&(b=this._newmax);var f=parseInt(b)+c;parseInt(e);if(null!=this.visiblerows&&0!=this.visiblerows.length){b=!1;e=this._findvisiblerow(f,
            this.visiblerows);if(0<=e){var k=this.visiblerows[e];f=!k.rowdetailshidden;if(this.rowdetails&&k.rowdetails){var l=this.visiblerows[e-1];l==k&&(k=l,e--);f&&(f=d(this.hittestinfo[e].visualrow).position().top+parseInt(this.table.css("top")),l=d(this.hittestinfo[e].visualrow).height(),c>=f&&c<=f+l||(e++,k=this.visiblerows[e],b=!0))}}return{index:e,row:k,details:b}}}},getcellatposition:function(b,c){var e=this.that,f=this.showheader?this.columnsheader.height()+2:0,k=this._groupsheader()?this.groupsheader.height():
            0;k+=this.showtoolbar?this.toolbarheight:0;var l=this.host.coord();this.hasTransform&&(l=d.jqx.utilities.getOffset(this.host));var m=b-l.left;b=c-f-l.top-k;f=this._hittestrow(m,b);c=f.row;f=this.table[0].rows[f.index];if(this.dataview&&0==this.dataview.records.length){c=this.table[0].rows;for(k=l=0;k<c.length;k++){if(b>=l&&b<l+this.rowsheight){f=c[k];break}l+=this.rowsheight}c={boundindex:k}}if(null==f)return!0;l=this.hScrollInstance.value;var p=0;for(k=0;k<f.cells.length;k++){var r=parseInt(d(this.columnsrow[0].cells[k]).css("left"));
            b=r-l;e.columns.records[k].pinned&&(b=r);if(!e.columns.records[k].hidden&&!e.columns.records[k].adaptivehidden&&b+d(this.columnsrow[0].cells[k]).width()>=m&&m>=b){p=k;break}}return null!=c?(e=this._getcolumnat(p),{row:this.getboundindex(c),column:e.datafield,value:this.getcellvalue(this.getboundindex(c),e.datafield)}):null},_handlemousedown:function(b,c){if(null==b.target||c.disabled||d(b.target).ischildof(this.columnsheader)||d(b.target).ischildof(this.hScrollBar)||d(b.target).ischildof(this.vScrollBar)||
            b.target===c.bottomRight[0])return!0;var e;b.which?e=3==b.which:b.button&&(e=2==b.button);var f;b.which?f=2==b.which:b.button&&(f=1==b.button);if(f||this.adaptiveview&&(d(b.target).ischildof(d(this.adaptiveview))||b.target==this.adaptiveview)||this.showstatusbar&&(d(b.target).ischildof(this.statusbar)||b.target==this.statusbar[0])||this.showtoolbar&&(d(b.target).ischildof(this.toolbar)||b.target==this.toolbar[0])||this.pageable&&(d(b.target).ischildof(this.pager)||b.target==this.pager[0])||!this.columnsheader||
            !this.editcell&&this.pageable&&d(b.target).ischildof(this.pager))return!0;f=this.showheader?this.columnsheader.height()+2:0;var k=this._groupsheader()?this.groupsheader.height():0;k+=this.showtoolbar?this.toolbarheight:0;var l=this.host.coord();if(this.hasTransform){l=d.jqx.utilities.getOffset(this.host);var m=this._getBodyOffset();l.left-=m.left;l.top-=m.top}var p=parseInt(b.pageX);m=parseInt(b.pageY);if(this.isTouchDevice()){var r=c.getTouches(b)[0];p=parseInt(r.pageX);m=parseInt(r.pageY);1==c.touchmode&&
        void 0!=r._pageX&&(p=parseInt(r._pageX),m=parseInt(r._pageY))}r=p-l.left;m=m-f-l.top-k;if(this.pageable&&!this.autoheight&&this.gotopage&&(f=this.pager.coord().top-l.top-k-f,m>f))return;if((l=this._hittestrow(r,m))&&!l.details){f=l.row;m=l.index;var t=b.target.className,w=this.table[0].rows[m];if(null==w)return c.editable&&c.begincelledit&&c.editcell&&c.endcelledit(c.editcell.row,c.editcell.column,!1,!0),!0;c.mousecaptured=!0;c.mousecaptureposition={left:b.pageX,top:b.pageY-k,clickedrow:w};k=this.hScrollInstance;
            var q=k.value;this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(q=k.max-k.value);var u=-1,y=this.groupable?this.groups.length:0;this.rtl&&("hidden"!=this.vScrollBar[0].style.visibility&&(q-=this.scrollbarsize+4),"hidden"==this.hScrollBar[0].style.visibility&&(q=-parseInt(this.content.css("left"))));for(var z=0;z<w.cells.length;z++)if(k=parseInt(d(this.columnsrow[0].cells[z]).css("left")),p=k-q,c.columns.records[z].pinned&&!c.rtl&&(p=k),k=this._getcolumnat(z),null==k||!k.hidden)if(null==k||!k.adaptivehidden)if(k=
                p+d(this.columnsrow[0].cells[z]).width(),k>=r&&r>=p){u=z;c.mousecaptureposition.clickedcell=z;break}if(this.rtl&&this._haspinned)for(z=w.cells.length-1;0<=z&&c.columns.records[z].pinned;z--)if(p=k=d(this.columnsrow[0].cells[z]).coord().left-this.host.coord().left,k=this._getcolumnat(z),null==k||!k.hidden)if(null==k||!k.adaptivehidden)if(k=p+d(this.columnsrow[0].cells[z]).width(),k>=r&&r>=p){u=z;c.mousecaptureposition.clickedcell=z;break}if(null!=f&&0<=u){this._raiseEvent(1,{rowindex:this.getboundindex(f),
                visibleindex:f.visibleindex,row:f,group:f.group,rightclick:e,originalEvent:b});k=this._getcolumnat(u);r=this.getcellvalue(this.getboundindex(f),k.datafield);this.editable&&this.editcell&&(this._currentEditableColumn=u,k.datafield==this.editcell.column&&this.getboundindex(f)==this.editcell.row&&(this.mousecaptured=!1));if("adaptive"===k.columntype){var A=document.createElement("div"),C=document.createElement("div");e=document.createElement("a");k=document.createElement("a");l=document.createElement("div");
                var B=this.getrowdata(this.getboundindex(f));e.href="#";k.href="#";A.style.zIndex=99999;A.style.position="absolute";A.style.left="0px";A.style.top="0px";A.style.width="100%";A.style.height="100%";A.className="jqx-adaptive-view jqx-widget-content";l.style.position="relative";l.style.top="100%";l.style.textAlign="center";l.style.marginTop="-40px";C.style.position="absolute";C.style.left="0px";C.style.top="0px";C.style.width="100%";C.style.height="100%";this.theme&&(A.className="jqx-widget-content jqx-widget-content-"+
                    this.theme);f=document.createElement("span");f.className="jqx-icon-close";this.theme&&(f.className="jqx-icon-close jqx-widget-close-"+this.theme);f.style.zIndex=99;f.style.position="absolute";f.style.right="10px";f.style.top="10px";f.style.width="16px";f.style.height="16px";A.appendChild(C);A.appendChild(f);e.innerHTML=this.gridlocalization.okstring;k.innerHTML=this.gridlocalization.cancelstring;e.addEventListener("mousedown",function(b){for(var e={},d=c.adaptiveview.querySelectorAll("input"),f=0;f<
                d.length;f++){var g=d[f].value,h=d[f].getAttribute("data-column");e[h]=g}c.updaterow(B.uid,e);A.parentNode.removeChild(A);c.adaptiveview=null;b.stopPropagation();return!1});k.addEventListener("mousedown",function(){A.parentNode.removeChild(A);c.adaptiveview=null;b.stopPropagation();return!1});this.editable&&(l.appendChild(e),l.appendChild(k),A.appendChild(l));e="<table class='jqx-adaptive-table'><tr>";for(z=m=0;z<this.columns.records.length;z++)k=this.columns.records[z],"adaptive"!==k.columntype&&
                (0<z&&0===m%2&&(e+="</tr><tr>"),l=B[k.displayfield],""!=k.cellsformat&&d.jqx.dataFormat&&(d.jqx.dataFormat.isDate(l)?l=d.jqx.dataFormat.formatdate(l,k.cellsformat,this.gridlocalization):d.jqx.dataFormat.isNumber(l)&&(l=d.jqx.dataFormat.formatnumber(l,k.cellsformat,this.gridlocalization))),r=this.filterable?'<div datafield="'+k.datafield+'" class="'+c.toTP("jqx-grid-column-filterbutton")+'" style="position: relative; top: 4px; display: inline-block; width: 16px; height:16px;"></div>':"",e=this.editable?
                    k.editable?e+("<td>"+r+k.text+": <input data-column='"+k.displayfield+"' value='"+l+"'/></td>"):e+("<td>"+r+k.text+": <input data-column='"+k.displayfield+"' readonly value='"+l+"'/></td>"):e+("<td>"+r+k.text+": "+l+"</td>"),m++);C.innerHTML=e+"</tr></table>";f.addEventListener("mousedown",function(b){A.parentNode.removeChild(A);c.adaptiveview=null});this.wrapper[0].appendChild(A);this.adaptiveview=A;d(this.adaptiveview).find(".jqx-grid-column-filterbutton").on("click",function(){var b=this.getAttribute("datafield"),
                    e=this.offsetTop;c.openmenu(b);setTimeout(function(){c.gridmenu.css("top",30+e);c.gridmenu.css("left",25);c.gridmenu.css("z-index",99999);c.gridmenu.parent().css("z-index",99999)},300)});return}this._raiseEvent(8,{rowindex:this.getboundindex(f),column:k?k.getcolumnproperties():null,row:f,visibleindex:f.visibleindex,datafield:k?k.datafield:null,columnindex:u,value:r,rightclick:e,originalEvent:b});if(k.createwidget)return!0;if(this.isTouchDevice())if("checkbox"==k.columntype&&this.editable&&this._overlayElement){if(!this.editcell)return this._overlayElement.css("visibility",
                "hidden"),this.editcell=this.getcell(m,k.datafield),!0}else if("button"==k.columntype&&this._overlayElement)return k.buttonclick&&k.buttonclick(w.cells[u].buttonrow,b),!0;m=!1;if(null!=this._lastmousedown&&300>this._mousedown-this._lastmousedown&&this._clickedrowindex==this.getboundindex(f)&&(this._raiseEvent(22,{rowindex:this.getboundindex(f),row:f,visibleindex:f.visibleindex,group:f.group,rightclick:e,originalEvent:b}),this._clickedcolumn==k.datafield&&this._raiseEvent(23,{rowindex:this.getboundindex(f),
                row:f,visibleindex:f.visibleindex,column:k?k.getcolumnproperties():null,datafield:k?k.datafield:null,columnindex:u,value:r,rightclick:e,originalEvent:b}),m=!0,this._clickedrowindex=-1,this._clickedcolumn=null,b.isPropagationStopped&&b.isPropagationStopped()))return!1;if(e)return!0;m||(this._clickedrowindex=this.getboundindex(f),this._clickedcolumn=k.datafield);e=d.jqx.utilities.getBrowser();"msie"==e.browser&&7>=parseInt(e.version)&&(0==u&&this.rowdetails&&(t="jqx-grid-group-collapse"),0<y&&u<=y&&
            (t="jqx-grid-group-collapse"));if(-1!=t.indexOf("jqx-grid-group-expand")||-1!=t.indexOf("jqx-grid-group-collapse"))this.rtl?0<y&&u>w.cells.length-y-1&&this._togglegroupstate?this._togglegroupstate(f.bounddata,!0):u==w.cells.length-1-y&&this.rowdetails&&this.showrowdetailscolumn&&(this._togglerowdetails(f.bounddata,!0),this.gridcontent[0].scrollTop=0,this.gridcontent[0].scrollLeft=0):0<y&&u<y&&this._togglegroupstate?this._togglegroupstate(f.bounddata,!0):u==y&&this.rowdetails&&this.showrowdetailscolumn&&
                (this._togglerowdetails(f.bounddata,!0),this.gridcontent[0].scrollTop=0,this.gridcontent[0].scrollLeft=0);else if(-1!=f.boundindex){r=this.selectedrowindexes.slice(0);e=!1;if("none"!=c.selectionmode&&"checkbox"!=c.selectionmode&&this._selectrowwithmouse){"multiplecellsadvanced"!=c.selectionmode&&"multiplecellsextended"!=c.selectionmode&&"multiplerowsextended"!=c.selectionmode&&"multiplerowsadvanced"!=c.selectionmode||b.ctrlKey||b.shiftKey||b.metaKey||(c.selectedrowindexes=[],c.selectedcells=[]);C=
                !1;m=this.getboundindex(f);if(c._oldselectedrow===m||"none"===c.selectionmode)C=!0;if(-1==c.selectionmode.indexOf("cell")){if("singlerow"!=c.selectionmode||c.selectedrowindex!=m&&"singlerow"==c.selectionmode)this._applyrowselection(m,!0,!1,null,k.datafield),this._selectrowwithmouse(c,l,r,k.datafield,b.ctrlKey||b.metaKey,b.shiftKey)}else null!=k.datafield&&(this._selectrowwithmouse(c,l,r,k.datafield,b.ctrlKey||b.metaKey,b.shiftKey),b.shiftKey||this._applycellselection(m,k.datafield,!0,!1));c._oldselectedcell&&
            c._oldselectedcell.datafield==c.selectedcell.datafield&&c._oldselectedcell.rowindex==c.selectedcell.rowindex&&(e=!0);c._oldselectedcell=c.selectedcell;c._oldselectedrow=m}c.autosavestate&&c.savestate&&c.savestate();if(c.editable&&c.begincelledit&&"programmatic"!=c.editmode){if(b.isPropagationStopped&&b.isPropagationStopped())return!1;"selectedrow"==c.editmode?C&&!c.editcell?"checkbox"!==k.columntype&&(this._currentEditableColumn=u,c.beginrowedit(this.getboundindex(f))):c.editcell&&!C&&"none"!=c.selectionmode&&
                c.endrowedit(c.editcell.row):(m=this.getboundindex(f),C="click"==c.editmode||e&&"selectedcell"==c.editmode,-1==c.selectionmode.indexOf("cell")&&"dblclick"!=c.editmode&&(C=!0),C&&void 0!=f.boundindex&&k.editable&&(c.begincelledit(this.getboundindex(f),k.datafield,k.defaulteditorvalue),-1!=c.selectionmode.indexOf("cell")&&c._applycellselection(m,k.datafield,!1,!1)),-1!=c.selectionmode.indexOf("cell")&&"selectedcell"==c.editmode&&!e&&c.editcell&&c.endcelledit(c.editcell.row,c.editcell.column,!1,!0),
            "dblclick"!=c.editmode||e||!c.editcell||c.editcell.row==m&&k.datafield==c.editcell.column||c.endcelledit(c.editcell.row,c.editcell.column,!1,!0))}}}return!0}},_columnPropertyChanged:function(b,c,d,h){},_rowPropertyChanged:function(b,c,d,h){},_serializeObject:function(b){if(null==b)return"";var c="";d.each(b,function(b){0<b&&(c+=", ");c+="[";b=0;for(var e in this)0<b&&(c+=", "),c+="{"+e+":"+this[e]+"}",b++;c+="]"});return c},isbindingcompleted:function(){return!this._loading},propertiesChangedHandler:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              c,d){d.width&&d.height&&2==Object.keys(d).length&&(b._updatesize(!0,!0),b._resizeWindow(),b.virtualmode&&!b._loading?b.vScrollInstance.setPosition(0):setTimeout(function(){b._renderrows(b.virtualsizeinfo)},100))},propertyChangedHandler:function(b,c,g,h){if(void 0!=this.isInitialized&&0!=this.isInitialized&&!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length))switch(c=c.toLowerCase(),c){case "editable":case "showcolumnheaderlines":case "showcolumnlines":case "showrowlines":b.refresh();
            break;case "everpresentrowactionsmode":g!=h&&(b._removeaddnewrow(),b.render());break;case "everpresentrowactions":b._updateaddnewrowui();break;case "showeverpresentrow":case "everpresentrowposition":case "everpresentrowheight":g!=h&&(b._removeaddnewrow(),b.render());break;case "rtl":b.content.css("left","");b.columns=b._columns;b._filterrowcache=[];b.vScrollBar.jqxScrollBar({rtl:h});b.hScrollBar.jqxScrollBar({rtl:h});b._initpager&&b._initpager();b._initgroupsheader&&b._initgroupsheader();b.render();
            break;case "enablebrowserselection":b.showfilterrow||(b.showstatusbar||b.showtoolbar||b.host.addClass("jqx-disableselect"),b.content.addClass("jqx-disableselect"));b.enablebrowserselection&&(b.content.removeClass("jqx-disableselect"),b.host.removeClass("jqx-disableselect"));break;case "columnsheight":(32!=b.columnsheight||b.columngroups)&&b._measureElement("column");b._render(!0,!0,!0,!1,!1);break;case "rowsheight":h!=g&&(31!=b.rowsheight&&b._measureElement("cell"),b.virtualsizeinfo=null,b.rendergridcontent(!0,
            !1),b.refresh());break;case "scrollMode":b.vScrollInstance.thumbStep=b.rowsheight;break;case "showdefaultloadelement":b._builddataloadelement();break;case "showfiltermenuitems":case "showsortmenuitems":case "showgroupmenuitems":case "filtermode":b._initmenu();break;case "touchmode":g!=h&&(b._removeHandlers(),b.touchDevice=null,b.vScrollBar.jqxScrollBar({touchMode:h}),b.hScrollBar.jqxScrollBar({touchMode:h}),b._updateTouchScrolling(),b._arrange(),b._updatecolumnwidths(),b._updatecellwidths(),b._addHandlers());
            break;case "autoshowcolumnsmenubutton":g!=h&&b._rendercolumnheaders();break;case "rendergridrows":g!=h&&b.updatebounddata();break;case "editmode":g!=h&&(b._removeHandlers(),b._addHandlers());break;case "source":b.updatebounddata();b.virtualmode&&!b._loading&&(b.loadondemand=!0,b._renderrows(b.virtualsizeinfo));break;case "horizontalscrollbarstep":case "verticalscrollbarstep":case "horizontalscrollbarlargestep":case "verticalscrollbarlargestep":this.vScrollBar.jqxScrollBar({step:this.verticalscrollbarstep,
            largestep:this.verticalscrollbarlargestep});this.hScrollBar.jqxScrollBar({step:this.horizontalscrollbarstep,largestep:this.horizontalscrollbarlargestep});break;case "closeablegroups":b._initgroupsheader&&b._initgroupsheader();break;case "showgroupsheader":g!=h&&(b._arrange(),b._initgroupsheader&&b._initgroupsheader(),b._renderrows(b.virtualsizeinfo));break;case "theme":h!=g&&(d.jqx.utilities.setTheme(g,h,b.host),b.gridmenu&&b.gridmenu.jqxMenu({theme:h}),b.pageable&&b._updatepagertheme(),b.filterable&&
        b._updatefilterrowui(!0),b.showeverpresentrow&&b._updateaddnewrowui(!0));break;case "showtoolbar":case "toolbarheight":g!=h&&(b._arrange(),b.refresh());break;case "showstatusbar":g!=h&&(b.statusbar&&(h?b.statusbar.show():b.statusbar.hide()),b._arrange(),b.refresh());break;case "statusbarheight":g!=h&&(b._arrange(),b.refresh());break;case "filterable":case "showfilterrow":g!=h&&b.render();break;case "autoshowfiltericon":case "showfiltercolumnbackground":case "showpinnedcolumnbackground":case "showsortcolumnbackground":g!=
        h&&b.rendergridcontent();break;case "showrowdetailscolumn":g!=h&&b.render();break;case "scrollbarsize":g!=h&&(d.jqx.utilities.scrollBarSize=h,b._arrange());break;case "width":case "height":g!=h&&(b._updatesize(!0,!0),b._resizeWindow(),b.virtualmode&&!b._loading?b.vScrollInstance.setPosition(0):setTimeout(function(){b._renderrows(b.virtualsizeinfo)},100));break;case "altrows":case "altstart":case "altstep":g!=h&&b._renderrows(b.virtualsizeinfo);break;case "groupsheaderheight":g!=h&&(b._arrange(),b._initgroupsheader&&
        b._initgroupsheader());break;case "pagerheight":g!=h&&b._initpager();break;case "selectedrowindex":b.selectrow(h);break;case "selectionmode":g!=h&&("none"==h&&(b.selectedrowindexes=[],b.selectedcells=[],b.selectedrowindex=-1),b._renderrows(b.virtualsizeinfo),"checkbox"==h&&b._render(!1,!1,!0,!1,!1));break;case "showheader":h?b.columnsheader.css("display","block"):b.columnsheader.css("display","none");break;case "virtualmode":g!=h&&(b.dataview.virtualmode=b.virtualmode,b.dataview.refresh(!1),b._render(!1,
            !1,!1));break;case "columnsmenu":g!=h&&b.render();break;case "columngroups":b._render(!0,!0,!0,!1,!1);break;case "columns":b.columns&&b.columns.length>b.headerZIndex&&(b.headerZIndex=b.columns.length+100);if(b._serializeObject(b._cachedcolumns)!==b._serializeObject(h)){var e=!1;b.filterable&&g&&g.records&&d.each(g.records,function(){this.filter&&(e=!0);b.dataview.removefilter(this.displayfield,this.filter)});b._columns=null;b._filterrowcache=[];b.render();e&&b.applyfilters();b._cachedcolumns=b.columns;
            b.removesort&&b.removesort()}else b[c]=g;break;case "autoheight":g!=h&&b._render(!1,!1,!0);break;case "pagermode":case "pagerbuttonscount":g!=h&&b._initpager&&(b.pagershowrowscombo&&(b.pagershowrowscombo.jqxDropDownList("destroy"),b.pagershowrowscombo=null),b.pagerrightbutton&&(b.removeHandler(b.pagerrightbutton,"mousedown"),b.removeHandler(b.pagerrightbutton,"mouseup"),b.removeHandler(b.pagerrightbutton,"click"),b.pagerrightbutton.jqxButton("destroy"),b.pagerrightbutton=null),b.pagerleftbutton&&
        (b.removeHandler(b.pagerleftbutton,"mousedown"),b.removeHandler(b.pagerleftbutton,"mouseup"),b.removeHandler(b.pagerleftbutton,"click"),b.pagerleftbutton.jqxButton("destroy"),b.removeHandler(d(document),"mouseup.pagerbuttons"+b.element.id),b.pagerleftbutton=null),b.pagerdiv.remove(),b._initpager());break;case "pagesizeoptions":case "pageable":case "pagesize":if(g!=h){if(b._loading)throw Error("jqxGrid: "+b.loadingerrormessage);if(b.host.jqxDropDownList&&b.host.jqxListBox){if(b._initpager){if("pageable"!=
            c&&"pagermode"!=c&&"string"==typeof h)throw g="The expected value type is: Int.","pagesize"!=c&&(g="The expected value type is: Array of Int values."),Error("Invalid Value for: "+c+". "+g);b.dataview.pageable=b.pageable;b.dataview.pagenum=0;b.dataview.pagesize=b._getpagesize();b.virtualmode&&b.updatebounddata();b.dataview.refresh(!0);b._initpager();"pagesizeoptions"==c&&null!=h&&0<h.length&&(b.pagesize=parseInt(h[0]),b.dataview.pagesize=parseInt(h[0]),b.prerenderrequired=!0,b._requiresupdate=!0,b.dataview.pagenum=
            -1,b.gotopage(0))}b._render(!1,!1,!1)}else b._testmodules()}break;case "groups":b._serializeObject(g)!==b._serializeObject(h)&&(b.dataview.groups=h,b._refreshdataview(),b._render(!0,!0,!0,!1));break;case "groupable":g!=h&&(b.dataview.groupable=b.groupable,b.dataview.pagenum=0,b.dataview.refresh(!1),b._render(!1,!1,!0));break;case "renderstatusbar":null!=h&&b.renderstatusbar(b.statusbar);break;case "rendertoolbar":null!=h&&b.rendertoolbar(b.toolbar);break;case "disabled":h?b.host.addClass(b.toThemeProperty("jqx-fill-state-disabled")):
            b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")),d.jqx.aria(b,"aria-disabled",b.disabled),b.pageable&&(b.pagerrightbutton&&(b.pagerrightbutton.jqxButton({disabled:h}),b.pagerleftbutton.jqxButton({disabled:h}),b.pagershowrowscombo.jqxDropDownList({disabled:h}),b.pagergotoinput.attr("disabled",h)),b.pagerfirstbutton&&(b.pagerfirstbutton.jqxButton({disabled:h}),b.pagerlastbutton.jqxButton({disabled:h}))),b.vScrollBar.jqxScrollBar({disabled:h}),b.hScrollBar.jqxScrollBar({disabled:h}),
        b.filterable&&b.showfilterrow&&b._updatefilterrowui(!0),b.showeverpresentrow&&b._updateaddnewrowui(!0)}}});d.jqx.collection=function(b){this.records=[];this.owner=b;this.updating=!1;this.beginupdate=function(){this.updating=!0};this.resumeupdate=function(){this.updating=!1};this._raiseEvent=function(b){};this.clear=function(){this.records=[]};this.replace=function(b,c){this.records[b]=c;this.updating||this._raiseEvent({type:"replace",element:c})};this.isempty=function(b){return void 0==this.records[b]?
        !0:!1};this.initialize=function(b){1>b&&(b=1);this.records[b-1]=-1};this.length=function(){return this.records.length};this.indexOf=function(b){return this.records.indexOf(b)};this.add=function(b){if(null==b)return!1;this.records[this.records.length]=b;this.updating||this._raiseEvent({type:"add",element:b});return!0};this.insertAt=function(b,c){return null==b||void 0==b||null==c?!1:0<=b?b<this.records.length?(this.records.splice(b,0,c),this.updating||this._raiseEvent({type:"insert",index:b,element:c}),
        !0):this.add(c):!1};this.remove=function(b){if(null==b||void 0==b)return!1;var c=this.records.indexOf(b);return-1!=c?(this.records.splice(c,1),this.updating||this._raiseEvent({type:"remove",element:b}),!0):!1};this.removeAt=function(b){if(null==b||void 0==b||0>b)return!1;if(b<this.records.length){var c=this.records[b];this.records.splice(b,1);this.updating||this._raiseEvent({type:"removeAt",index:b,element:c});return!0}return!1};return this};d.jqx.dataview=function(){this.self=this;this.aggregates=
        !1;this.grid=null;this.uniqueId="id";this.records=[];this.rows=[];this.columns=[];this.groups=[];this.filters=[];this.update=this.updated=null;this.suspend=!1;this.totalrecords=this.totalrows=this.pagenum=this.pagesize=0;this.groupable=!0;this.loadedrecords=[];this.loadedrootgroups=[];this.loadedgroups=[];this.loadedgroupsByKey=[];this.virtualmode=!0;this._cachegrouppages=[];this.source=null;this.changedrecords=[];this.rowschangecallback=null;this.that=this;this.destroy=function(){delete this.self;
        delete this.grid;delete this.uniqueId;delete this.records;delete this.rows;delete this.columns;delete this.groups;delete this.filters;delete this.updated;delete this.update;delete this.suspend;delete this.pagesize;delete this.pagenum;delete this.totalrows;delete this.totalrecords;delete this.groupable;delete this.loadedrecords;delete this.loadedrootgroups;delete this.loadedgroups;delete this.loadedgroupsByKey;delete this.virtualmode;delete this._cachegrouppages;delete this.source;delete this.changedrecords;
        delete this.rowschangecallback;delete this.that};this.suspendupdate=function(){this.suspend=!0};this.isupdating=function(){return this.suspend};this.resumeupdate=function(b){this.suspend=!1;void 0==b&&(b=!0);this.refresh(b)};this.getrecords=function(){return this.records};this.clearrecords=function(){this.recordids=[]};this.databind=function(b,c){c=b._source?!0:!1;var e=null;this.grid&&(this.aggregates=this.grid.showgroupaggregates);c?(e=b,b=b._source):e=new d.jqx.dataAdapter(b,{autoBind:!1});var f=
        function(c){c.totalrecords=e.totalrecords;if(c.virtualmode){var f={startindex:c.pagenum*c.pagesize,endindex:c.pagenum*c.pagesize+c.pagesize};void 0!=b.recordstartindex&&(f.startindex=parseInt(b.recordstartindex));void 0!=b.recordendindex?f.endindex=parseInt(b.recordendindex):c.grid.pageable||(f.endindex=f.startindex+100,c.grid.autoheight&&(f.endindex=f.startindex+c.totalrecords));b.recordendindex||(c.grid.pageable?f={startindex:c.pagenum*c.pagesize,endindex:c.pagenum*c.pagesize+c.pagesize}:(f.endindex=
            f.startindex+100,c.grid.autoheight&&(f.endindex=f.startindex+c.totalrecords)));f.data=e.records;if(c.grid.rendergridrows&&0<c.totalrecords){var g=0;b.records=c.grid.rendergridrows(f);b.records.length&&(g=b.records.length);if(b.records&&!b.records[f.startindex]){var h=[],k=f.startindex;d.each(b.records,function(){h[k]=this;k++;g++});b.records=h}0==g&&b.records&&d.each(b.records,function(){g++});if(0<g&&g<f.endindex-f.startindex&&!c.grid.groupable)for(var q=b.records[0],l=0;l<f.endindex-f.startindex-
        g;l++){var u={},m;for(m in q)u[m]="";b.records.push&&b.records.push(u)}}b.records&&0!=c.totalrecords||(b.records=[]);c.originaldata=b.records;c.records=b.records;c.cachedrecords=b.records}else c.originaldata=e.originaldata,c.records=e.records,c.recordids=e.recordids,c.cachedrecords=e.cachedrecords};e.recordids=[];e.records=[];e.cachedrecords=[];e.originaldata=[];e._options.virtualmode=this.virtualmode;e._options.totalrecords=this.totalrecords;e._options.originaldata=this.originaldata;e._options.recordids=
        this.recordids;e._options.cachedrecords=[];e._options.pagenum=this.pagenum;e._options.pageable=this.pageable;void 0!=b.type&&(e._options.type=b.type);void 0!=b.formatdata&&(e._options.formatData=b.formatdata);void 0!=b.contenttype&&(e._options.contentType=b.contenttype);void 0!=b.async&&(e._options.async=b.async);void 0!=b.updaterow&&(e._options.updaterow=b.updaterow);void 0!=b.addrow&&(e._options.addrow=b.addrow);void 0!=b.deleterow&&(e._options.deleterow=b.deleterow);0==this.pagesize&&(this.pagesize=
        10);e._options.pagesize=this.pagesize;this.source=b;var k=this.that;switch(b.datatype){default:null==b.localdata&&(b.localdata=[]);null!=b.localdata&&(e.unbindBindingUpdate(k.grid.element.id),(!k.grid.autobind&&k.grid.isInitialized||k.grid.autobind)&&e.dataBind(),c=function(c){if(void 0!=c&&""!=c){if(e._changedrecords[0]){var g=[];d.each(e._changedrecords,function(b){var d=this.index,f=this.record;k.grid._updateFromAdapter=!0;switch(c){case "update":d=k.grid.getrowid(d);b==e._changedrecords.length-
    1?k.grid.updaterow(d,f):k.grid.updaterow(d,f,!1);k.grid._updateFromAdapter=!1;break;case "add":k.grid.addrow(null,f);k.grid._updateFromAdapter=!1;break;case "remove":d=k.grid.getrowid(d),g.push(d)}});0<g.length&&(k.grid.deleterow(g,!1),k.grid._updateFromAdapter=!1)}if("update"==c)return}var h=k.totalrecords;f(k,c);null===b.localdata.notifier&&"observableArray"==b.localdata.name&&(b.localdata.notifier=function(c){if(!k._updating){k._updating=!0;var f=k.grid.getrowid(c.index);switch(c.type){case "add":var g=
        d.extend({},c.object[c.index]);f=e.getid(b.id,g,c.index);0===c.index?k.grid.addrow(f,g,"first"):k.grid.addrow(f,g);break;case "delete":k.grid.deleterow(f);break;case "update":c.path&&1<c.path.split(".").length?(g=c.path.split("."),k.grid.setcellvalue(c.index,g[g.length-1],c.newValue)):(g=d.extend({},c.object[c.index]),k.grid.updaterow(f,g))}k._updating=!1}});"updateData"==c?(k.refresh(),k.grid._updateGridData()):(b.recordstartindex&&k.virtualmode?k.updateview(b.recordstartindex,b.recordstartindex+
        k.pagesize):k.refresh(),k.update(h!=k.totalrecords))},c(),e.bindBindingUpdate(k.grid.element.id,c));break;case "json":case "jsonp":case "xml":case "xhtml":case "script":case "text":case "csv":case "tab":if(null!=b.localdata)e.unbindBindingUpdate(k.grid.element.id),(!k.grid.autobind&&k.grid.isInitialized||k.grid.autobind)&&e.dataBind(),c=function(c){var e=k.totalrecords;f(k);"updateData"==c?(k.refresh(),k.grid._updateGridData()):(b.recordstartindex&&k.virtualmode?k.updateview(b.recordstartindex,b.recordstartindex+
        k.pagesize):k.refresh(),k.update(e!=k.totalrecords))},c(),e.bindBindingUpdate(k.grid.element.id,c);else{var l=[],m=0;c={};for(var p=0;p<k.filters.length;p++){var r=k.filters[p].datafield,t=k.filters[p].filter;if(t.getfilters){var w=t.getfilters();c[r+"operator"]=t.operator;for(t=0;t<w.length;t++){w[t].datafield=r;var q=w[t].value;if("datefilter"==w[t].type)if(w[t].value&&w[t].value.toLocaleString){var u=k.grid.getcolumn(w[t].datafield);u&&u.cellsformat?(u=k.grid.source.formatDate(w[t].value,u.cellsformat,
        k.grid.gridlocalization),c["filtervalue"+m]=u?u:w[t].value.toLocaleString()):c["filtervalue"+m]=q.toString()}else c["filtervalue"+m]=q.toString();else c["filtervalue"+m]=q.toString(),w[t].data&&(c["filterid"+m]=w[t].data.toString()),w[t].id&&(c["filterid"+m]=w[t].id.toString());c["filtercondition"+m]=w[t].condition;c["filteroperator"+m]=w[t].operator;c["filterdatafield"+m]=r;u={label:q.toString()};w[t].data&&(u.value=w[t].data.toString());u.value=w[t].id?w[t].id.toString():q.toString();u.condition=
        w[t].condition;u.operator=0==w[t].operator?"and":"or";u.field=r;u.type=w[t].type;q=!1;if(0<l.length)for(var y=0;y<l.length;y++){var z=l[y];if(z.field==r){z.filters.push(u);q=!0;break}}q||(l.push({field:r,filters:[]}),l[l.length-1].filters.push(u));m++}}}c.filterGroups=l;c.filterscount=m;c.groupscount=k.groups.length;for(p=0;p<k.groups.length;p++)c["group"+p]=k.groups[p];void 0==b.recordstartindex&&(b.recordstartindex=0);if(void 0==b.recordendindex||0==b.recordendindex)k.grid.height&&-1==k.grid.height.toString().indexOf("%")?
        (b.recordendindex=parseInt(k.grid.height)/k.grid.rowsheight,b.recordendindex+=2):b.recordendindex=d(window).height()/k.grid.rowsheight,b.recordendindex=parseInt(b.recordendindex),k.pageable&&(b.recordendindex=k.pagesize);k.pageable&&(b.recordstartindex=k.pagenum*k.pagesize,b.recordendindex=(k.pagenum+1)*k.pagesize);d.extend(c,{sortdatafield:k.sortfield,sortorder:k.sortfielddirection,pagenum:k.pagenum,pagesize:k.grid.pagesize,recordstartindex:b.recordstartindex,recordendindex:b.recordendindex});(l=
        e._options.data)?d.extend(e._options.data,c):(b.data&&d.extend(c,b.data),e._options.data=c);c=function(){var c=function(){var c=k.totalrecords;f(k);b.recordstartindex&&k.virtualmode?k.updateview(b.recordstartindex,b.recordstartindex+k.pagesize):k.refresh();k.update(c!=k.totalrecords)};if(d.jqx.browser.msie&&9>d.jqx.browser.version)try{c()}catch(C){}else c()};e.unbindDownloadComplete(k.grid.element.id);e.bindDownloadComplete(k.grid.element.id,c);!k.grid.autobind&&k.grid.isInitialized||k.grid.autobind?
        e.dataBind():k.grid.isInitialized||k.grid.autobind||c();e._options.data=l}}};this.getid=function(b,c,g){return 0<d(b,c).length?d(b,c).text():b&&0<b.toString().length&&(b=d(c).attr(b),null!=b&&0<b.toString().length)?b:g};this.getvaluebytype=function(b,c){var e=b;"date"==c.type?(c=new Date(b),b="NaN"==c.toString()||"Invalid Date"==c.toString()?d.jqx.dataFormat?d.jqx.dataFormat.tryparsedate(b):c:c,null==b&&(b=e)):"float"==c.type?(b=parseFloat(b),isNaN(b)&&(b=e)):"int"==c.type?(b=parseInt(b),isNaN(b)&&
    (b=e)):"bool"==c.type&&(null!=b&&("false"==b.toLowerCase()?b=!1:"true"==b.toLowerCase()&&(b=!0)),b=1==b?!0:0==b?!1:"");return b};this.setpaging=function(b){void 0!=b.pageSize&&(this.pagesize=b.pageSize);void 0!=b.pageNum&&(this.pagenum=Math.min(b.pageNum,Math.ceil(this.totalrows/this.pagesize)));this.refresh()};this.getpagingdetails=function(){return{pageSize:this.pagesize,pageNum:this.pagenum,totalrows:this.totalrows}};this._clearcaches=function(){this.sortcache={};this.sortdata=null;this.changedrecords=
        [];this.records=[];this.rows=[];this.cacheddata=[];this.originaldata=[];this.bounditems=[];this.loadedrecords=[];this.loadedrootgroups=[];this.loadedgroups=[];this.loadedgroupsByKey=[];this._cachegrouppages=[];this.recordsbyid=[];this.cachedrecords=[];this.recordids=[]};this.addfilter=function(b,c){for(var e=-1,d=0;d<this.filters.length;d++)if(this.filters[d].datafield==b){e=d;break}-1==e?this.filters[this.filters.length]={filter:c,datafield:b}:this.filters[e]={filter:c,datafield:b}};this.removefilter=
        function(b){for(var c=0;c<this.filters.length;c++)if(this.filters[c].datafield==b){this.filters.splice(c,1);break}};this.getItemFromIndex=function(b){return this.records[b]};this.updaterow=function(b,c,d){if(!(this.filters&&0<this.filters.length&&!this.virtualmode||void 0==c)&&void 0!=b){c.uid=b;c[this.source.id]||(c[this.source.id]=c.uid);var e=this.recordsbyid["id"+b],f=this.records.indexOf(e);if(-1==f)return!1;this.records[f]=c;this.cachedrecords&&(this.cachedrecords[f]=c);1!=d&&void 0!=d||this.refresh();
        this.changedrecords[c.uid]={Type:"Update",OldData:e,Data:c};return!0}if(this.filters&&0<this.filters.length){var g=this.cachedrecords;e=null;f=-1;for(var m=0;m<g.length;m++)if(g[m].uid==b){e=g[m];f=m;break}if(e){b=this.that;for(var p in c)b.cachedrecords[f][p]=c[p];1!=d&&void 0!=d||this.refresh();return!0}}return!1};this.addrow=function(b,c,g,h){if(void 0!=c){d.isEmptyObject(c)&&this.source&&this.source.datafields&&d.each(this.source.datafields,function(){var b="";"number"==this.type&&(b=null);"date"==
    this.type&&(b=null);if("bool"==this.type||"boolean"==this.type)b=!1;c[this.name]=b});if(!b||this.recordsbyid["id"+b])for(c.uid=this.getid(this.source.id,c,this.totalrecords),b=this.recordsbyid["id"+c.uid];null!=b;)b=Math.floor(1E4*Math.random()).toString(),c.uid=b,b=this.recordsbyid["id"+b];else c.uid=b;c[this.source.id]||void 0==this.source.id||(c[this.source.id]=c.uid);c.boundindex=this.records.length;"last"==g?this.records.push(c):"number"===typeof g&&isFinite(g)?this.records.splice(g,0,c):this.records.splice(0,
        0,c);this.filters&&0<this.filters.length&&("last"==g?this.cachedrecords.push(c):"number"===typeof g&&isFinite(g)?this.cachedrecords.splice(g,0,c):this.cachedrecords.splice(0,0,c));this.totalrecords++;this.virtualmode&&(this.source.totalrecords=this.totalrecords);1!=h&&void 0!=h||this.refresh();this.changedrecords[c.uid]={Type:"New",Data:c};return!0}return!1};this.deleterow=function(b,c){if(void 0!=b){var e=this.filters&&0<this.filters.length;if(this.recordsbyid["id"+b]&&!e){e=this.recordsbyid["id"+
    b];var d=this.records.indexOf(e);if(this.grid&&this.grid.sortable&&"many"==this.grid.sortmode)for(var f=0;f<this.records.length;f++)if(this.records[f].boundindex===e.boundindex){d=f;break}this.changedrecords[b]={Type:"Delete",Data:this.records[d]};this.records.splice(d,1);this.totalrecords--;this.virtualmode&&(this.source.totalrecords=this.totalrecords);1!=c&&void 0!=c||this.refresh();return!0}if(this.filters&&0<this.filters.length){var l=this.cachedrecords;e=null;d=-1;for(f=0;f<l.length;f++)if(l[f].uid==
        b){e=l[f];d=f;break}if(e){this.cachedrecords.splice(d,1);if(1==c||void 0==c)this.totalrecords=0,this.records=this.cachedrecords,this.refresh();return!0}}}return!1};this.reload=function(b,c,g,h,k,l,m){var e=this.that;k=[];var f=c.length,t=0;this.columns=[];this.bounditems=[];this.loadedrecords=[];this.loadedrootgroups=[];this.loadedgroups=[];this.loadedgroupsByKey=[];this._cachegrouppages=[];this.recordsbyid={};0==this.totalrecords&&(Object.size=function(b){var c=0,e;for(e in b)b.hasOwnProperty(e)&&
    c++;return c},this.totalrecords=Object.size(b),d.each(this.records,function(b){var c=0;d.each(this,function(b,d){e.columns[c++]=b});return!1}));if(this.virtualmode){if(this.pageable){this.updateview();return}l=0;if(this.groupable)m=this.totalrecords;else{this.updateview();return}}else l=0,m=this.totalrecords;if(this.groupable&&0<this.groups.length&&this.loadgrouprecords){var w=l;w=this.loadgrouprecords(0,l,m,g,0,h,c,f,k)}else t=this.loadflatrecords(l,m,g,0,h,c,f,k);0<f&&c.splice(0,f-0);this.totalrows=
        0<this.groups.length&&this.groupable?w:t;return k};this.loadflatrecords=function(b,c,g,h,k,l,m,p){var e=this.that,f=g=b;c=Math.min(c,this.totalrecords);for(var w=null!=this.sortdata,q=w?this.sortdata:this.records;b<c;b++){var u={};if(w)u=d.extend({},q[b].value),y=u[e.uniqueId],u.boundindex=q[b].index,void 0==u.uid&&(u.uid=e.getid(e.source.id,u,u.boundindex)),e.recordsbyid["id"+u.uid]=q[b].value,e.loadedrecords[g]=u,u.uniqueid=e.generatekey(),e.bounditems[u.boundindex]=u;else{u=Object(q[b]);var y=
        u[e.uniqueId];u.boundindex=g;e.loadedrecords[g]=u;void 0==u.uid&&(u.uid=e.getid(e.source.id,u,g));e.recordsbyid["id"+u.uid]=q[b];u.uniqueid=e.generatekey();e.bounditems[this.bounditems.length]=u}if(h>=m||y!=l[h][e.uniqueId]||k&&k[y])p[p.length]=h;l[h]=u;h++;u.visibleindex=f;f++;g++}if(e.grid.summaryrows){var z=g;d.each(e.grid.summaryrows,function(){var b=d.extend({},this);b.boundindex=c++;e.loadedrecords[z]=b;b.uniqueid=e.generatekey();e.bounditems[e.bounditems.length]=b;l[h]=b;h++;b.visibleindex=
        f;f++;z++})}return f};this.updateview=function(b,c){var e=this.that,d=this.pagesize*this.pagenum,f=0,l=[],m=this.filters,p=this.updated,r=l.length;if(this.pageable){if(this.virtualmode)if(!this.groupable||0==this.groups.length)this.loadflatrecords(this.pagesize*this.pagenum,this.pagesize*(1+this.pagenum),m,f,p,l,r,[]),this.totalrows=l.length;else if(this.groupable&&0<this.groups.length&&this.loadgrouprecords){if(void 0!=this._cachegrouppages[this.pagenum+"_"+this.pagesize]){this.rows=this._cachegrouppages[this.pagenum+
    "_"+this.pagesize];this.totalrows=this.rows.length;return}e=this.pagesize*(1+this.pagenum);e>this.totalrecords&&(e=this.totalrecords);this.loadgrouprecords(0,this.pagesize*this.pagenum,e,m,f,p,l,r,[]);this._cachegrouppages[this.pagenum+"_"+this.pagesize]=this.rows;this.totalrows=this.rows.length;return}}else if(this.virtualmode&&(!this.groupable||0==this.groups.length)){var t=this.pagesize;0==t&&(t=Math.min(100,this.totalrecords));null!=b&&null!=c?this.loadflatrecords(b,c,m,f,p,l,r,[]):this.loadflatrecords(this.pagesize*
        this.pagenum,this.pagesize*(1+this.pagenum),m,f,p,l,r,[]);this.totalrows=this.loadedrecords.length;this.rows=l;if(l.length>=t)return}if(this.groupable&&this.pageable&&0<this.groups.length&&this._updategroupsinpage)l=this._updategroupsinpage(e,m,d,f,r,this.pagesize*this.pagenum,this.pagesize*(1+this.pagenum));else for(m=this.pagesize*this.pagenum;m<this.pagesize*(1+this.pagenum);m++)if(p=m<this.loadedrecords.length?this.loadedrecords[m]:null,null!=p){if(!this.pagesize||d>=this.pagesize*this.pagenum&&
        d<=this.pagesize*(this.pagenum+1))l[f]=p,f++;d++}if((0==l.length||l.length<this.pagesize)&&!this.pageable&&this.virtualmode)for(d=f=l.length,m=this.pagesize*this.pagenum;m<this.pagesize*(1+this.pagenum)-d;m++)p={},p.boundindex=m+d,p.visibleindex=m+d,p.uniqueid=e.generatekey(),p.empty=!0,e.bounditems[m+d]=p,l[f]=p,f++;this.rows=l};this.generatekey=function(){var b=function(){return 16*(1+Math.random())|0};return""+b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()};this.reloaddata=function(){this.reload(this.records,
        this.rows,this.filter,this.updated,!0)};this.refresh=function(b){if(!this.suspend){void 0==b&&(b=!0);var c=this.rows.length,e=this.totalrows;if(0<this.filters.length&&!this.virtualmode){var h=this.cachedrecords.length,k=[];this.totalrecords=0;var l=this.cachedrecords;this._dataIndexToBoundIndex=[];var m=this.filters.length;if(null!=this.source&&void 0!=this.source.filter&&void 0!=this.source.localdata){var p=this.source.filter(this.filters,l,h);void 0==p&&(p=[]);for(var r=0;r<h;r++){var t=l[r],w=
        0<=p.indexOf(t);w?(k[k.length]=d.extend({dataindex:r},t),this._dataIndexToBoundIndex[r]={boundindex:k.length-1}):this._dataIndexToBoundIndex[r]=null}this.records=k}else if(null==this.source.filter||void 0==this.source.filter){for(r=0;r<h;r++){t=l[r];w=void 0;for(var q=0;q<m;q++){p=this.filters[q].filter;var u=t[this.filters[q].datafield],y=p.evaluate(u);this.grid.filter&&(u=this.grid.filter(u,t,this.filters[q].datafield,p,y),void 0!==u&&(y=u));w=void 0==w?y:"or"==p.operator?w||y:w&&y}w?(k[k.length]=
        d.extend({dataindex:r},t),this._dataIndexToBoundIndex[r]={boundindex:k.length-1}):this._dataIndexToBoundIndex[r]=null}this.records=k}if(this.sortdata)if(this.grid&&"many"!==this.grid.sortmode){if(h=this.sortfield,this.sortcache[h]){this.sortdata=null;c=this.sortcache[h].direction;this.sortcache[h]=null;this.sortby(this.sortfield,c);return}}else{c=this.grid.getsortcolumns();for(e=0;e<c.length;e++)b=c[e],h=b.dataField,this.grid.sortby(h,b.ascending,null);return}}else if(0==this.filters.length&&!this.virtualmode&&
        this.cachedrecords&&(this.totalrecords=0,this.records=l=this.cachedrecords,this.sortdata))if(this.grid&&"many"!==this.grid.sortmode){if(h=this.sortfield,this.sortcache[h]){this.sortdata=null;c=this.sortcache[h].direction;this.sortcache[h]=null;this.sortby(this.sortfield,c);return}}else{c=this.grid.getsortcolumns();for(e=0;e<c.length;e++)b=c[e],h=b.dataField,this.grid.sortby(h,b.ascending,null);return}b=this.reload(this.records,this.rows,this.filter,this.updated,b);this.updated=null;null!=this.rowschangecallback&&
    (h=this.rows,e!=this.totalrows&&this.rowschangecallback({type:"PagingChanged",data:this.getpagingdetails()}),c!=h.length&&this.rowschangecallback({type:"RowsCountChanged",data:{previous:c,current:h.length}}),(0<b.length||c!=h.length)&&this.rowschangecallback({type:"RowsChanged",data:{previous:c,current:h.length,diff:b}}))}};return this}})(jqxBaseFramework);
(function(d){d.extend(d.jqx._jqxGrid.prototype,{selectallrows:function(){this._trigger=!1;var b=this.virtualmode?this.dataview.totalrecords:this.dataview.loadedrecords.length;this.selectedrowindexes=[];for(var c=this.dataview.loadedrecords,e=0;e<b;e++){var d=c[e];d?(d=this.getboundindex(d),void 0!=d&&(this.selectedrowindexes[e]=d)):this.selectedrowindexes[e]=e}"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!0});
        this._renderrows(this.virtualsizeinfo);this._trigger=!0;"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},unselectallrows:function(){this._trigger=!1;this.selectedrowindexes=[];"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1});this._renderrows(this.virtualsizeinfo);this._trigger=!0;"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},
    selectrow:function(b,c){"none"!==this.selectionmode&&(this._applyrowselection(b,!0,c),!1!==c&&this._updatecheckboxselection())},_updatecheckboxselection:function(){if("checkbox"==this.selectionmode){var b=this.getrows();if(b&&this._checkboxcolumn)if(0===b.length)this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1});else{b=b.length;this.groupable&&(b=this.dataview.loadedrecords.length);this.virtualmode&&(b=this.source._source.totalrecords);var c=this.selectedrowindexes.length;c===b?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!0}):
        0===c?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1}):this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:null})}}},unselectrow:function(b,c){this._applyrowselection(b,!1,c);!1!==c&&this._updatecheckboxselection()},selectcell:function(b,c){this._applycellselection(b,c,!0)},unselectcell:function(b,c){this._applycellselection(b,c,!1)},clearselection:function(b,c){this._trigger=!1;this.selectedrowindex=-1;this._oldselectedcell=null;if(!1!==c)for(c=0;c<this.selectedrowindexes.length;c++)this._raiseEvent(3,
        {rowindex:this.selectedrowindexes[c]});this.selectedrowindexes=[];this.selectedcells=[];this.selectedcell=null;"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1});for(c=0;c<this.columns.records.length;c++)this.columns.records[c].selected=!1,this.columns.records[c]._applyStyle();!1===b?this._trigger=!0:(this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(3,{rowindex:this.selectedrowindexes}))},
    getselectedrowindex:function(){if(-1==this.selectedrowindex||void 0==this.selectedrowindex)for(;0<this.selectedrowindexes.length;)return this.selectedrowindexes[0];return this.selectedrowindex},getselectedrowindexes:function(){return this.selectedrowindexes},getselectedcell:function(){if(!this.selectedcell)return null;var b=this.selectedcell;b.row=this.selectedcell.rowindex;b.column=this.selectedcell.datafield;b.value=this.getcellvalue(b.row,b.column);return b},getselectedcells:function(){var b=[],
        c;for(c in this.selectedcells)b[b.length]=this.selectedcells[c];return b},getselection:function(){return{cells:this.getselectedcells(),rows:this.getselectedrowindexes()}},_getcellsforcopypaste:function(){var b=[];if(-1==this.selectionmode.indexOf("cell"))for(var c=this.selectedrowindexes,e=0;e<c.length;e++)for(var d=c[e],g=0;g<this.columns.records.length;g++)"_checkboxcolumn"!==this.columns.records[g].datafield&&b.push({rowindex:d,datafield:this.columns.records[g].datafield});return b},deleteselection:function(){var b=
        this.getselectedcells();-1==this.selectionmode.indexOf("cell")&&(b=this._getcellsforcopypaste());if(null!=b&&0<b.length){for(var c=0;c<b.length;c++){var e=b[c],d=this.getcolumn(e.datafield),g=this.getcellvalue(e.rowindex,e.datafield);if(d&&""!==g){var h=null;"checkbox"==d.columntype&&(d.threestatecheckbox||(h=!1));this._raiseEvent(17,{rowindex:e.rowindex,datafield:e.datafield,value:g});c==b.length-1?this.setcellvalue(e.rowindex,e.datafield,h,!0):this.setcellvalue(e.rowindex,e.datafield,h,!1);d.displayfield!=
    d.datafield&&this.setcellvalue(e.rowindex,d.displayfield,h,!0);this._raiseEvent(18,{rowindex:e.rowindex,datafield:e.datafield,oldvalue:g,value:h})}}this.dataview.updateview();this._renderrows(this.virtualsizeinfo)}},copyselection:function(){var b="",c=this;this.clipboardselection={};this.logicalclipboardselection={};this._clipboardselection=[];var e=c.getselectedcells();-1==this.selectionmode.indexOf("cell")&&(e=this._getcellsforcopypaste());var f=[];if(null!=e&&0<e.length){for(var g=999999999999999,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           h=-1,k=0;k<e.length;k++){var l=e[k],m=c.getcolumn(l.datafield);if(null!=m&&m.clipboard&&(!m.hidden||this.copytoclipboardhiddencolumns)){-1==f.indexOf(m.text)&&f.push(m.text);var p=c.getcelltext(l.rowindex,m.displayfield),r=this.getrowdisplayindex(l.rowindex);this.clipboardselection[r]||(this.clipboardselection[r]={});this.clipboardselection[r][m.displayfield]=p;this.logicalclipboardselection[r]||(this.logicalclipboardselection[r]={});this.logicalclipboardselection[r][m.displayfield]=p;m.displayfield!=
    m.datafield&&(this.logicalclipboardselection[r][m.datafield]=c.getcellvalue(l.rowindex,m.datafield));g=Math.min(g,r);h=Math.max(h,r)}}e=[];for(k=g;k<=h;k++)this.logicalclipboardselection[k]&&(l=d.extend({},this.logicalclipboardselection[k]),e.push(l));this.logicalclipboardselection=e;if(this.copytoclipboardwithheaders){for(e=0;e<f.length;e++)0<e&&(b+="\t"),b+=f[e];b+="\r\n"}for(k=g;k<=h;k++){var t=0;this._clipboardselection[this._clipboardselection.length]=[];void 0!=this.clipboardselection[k]&&(d.each(this.clipboardselection[k],
        function(e,d){0<t&&(b+="\t");e=d;null==d&&(e="");c._clipboardselection[c._clipboardselection.length-1][t]=e;t++;b+=e}),k<h&&(b+="\r\n"))}}return this.clipboardselectedtext=b},pasteselection:function(){var b=this.getselectedcells();this._oldselectedcell=null;-1==this.selectionmode.indexOf("cell")&&(b=this._getcellsforcopypaste());if(null!=b&&0<b.length){var c=this.getrowdisplayindex(b[0].rowindex),e=this._getcolumnindex(b[0].datafield);this.selectedrowindexes=[];this.selectedcells=[];var d=0,g=[];
        this.copytoclipboardwithheaders&&this._clipboardselection.splice(0,1);for(var h=0;h<this._clipboardselection.length;h++){d+=this._clipboardselection[h].length;g[h]=[];for(var k=0;k<this._clipboardselection[h].length;k++){var l=this._clipboardselection[h][k];g[h].push(l)}}if(d<b.length){c=[];for(h=0;h<b.length;h++)d=b[h],c[d.rowindex]||(c[d.rowindex]=[]),c[d.rowindex].push(d);var m=e=0;for(h=0;h<c.length;h++)if(c[h]){for(k=0;k<c[h].length;k++){d=c[h][k];b=d.rowindex;var p=this.getcolumn(d.datafield);
            if("_checkboxcolumn"!==p.datafield&&!p.hidden){l="";void 0==g[e][m]&&(m=0);l=g[e][m];m++;if(p.cellsformat&&(-1!=p.cellsformat.indexOf("p")||-1!=p.cellsformat.indexOf("c")||-1!=p.cellsformat.indexOf("n")||-1!=p.cellsformat.indexOf("f"))){-1<l.indexOf(this.gridlocalization.currencysymbol)&&(l=l.replace(this.gridlocalization.currencysymbol,""));var r=function(b,c,e){var d=b;if(c==e)return b;for(b=d.indexOf(c);-1!=b;)d=d.replace(c,e),b=d.indexOf(c);return d};l=r(l,this.gridlocalization.thousandsseparator,
                "");l=l.replace(this.gridlocalization.decimalseparator,".");-1<l.indexOf(this.gridlocalization.percentsymbol)&&(l=l.replace(this.gridlocalization.percentsymbol,""));r="";for(var t=0;t<l.length;t++){var w=l.substring(t,t+1);"-"===w&&(r+="-");"."===w&&(r+=".");null!=w.match(/^[0-9]+$/)&&(r+=w)}l=r;l=l.replace(/ /g,"");l=new Number(l);isNaN(l)&&(l="")}this._raiseEvent(17,{rowindex:b,datafield:d.datafield,value:l});this.setcellvalue(b,p.displayfield,l,!1);p.displayfield!=p.datafield&&this.logicalclipboardselection&&
            this.logicalclipboardselection[b]&&(r=this.logicalclipboardselection[b][p.datafield],void 0!=r&&this.setcellvalue(b,p.datafield,r,!1));this._raiseEvent(18,{rowindex:b,datafield:d.datafield,oldvalue:this.getcellvalue(d.rowindex,d.datafield),value:l});this._applycellselection(b,d.datafield,!0,!1)}}e++;m=0;g[e]||(e=0)}}else{if(!this._clipboardselection)return;for(g=0;g<this._clipboardselection.length;g++)for(h=0;h<this._clipboardselection[g].length;h++)if((p=this.getcolumnat(e+h))&&"_checkboxcolumn"!==
            p.datafield&&!p.hidden&&(b=this.getrowboundindex(c+g),d=this.getcell(b,p.datafield),l=null,l=this._clipboardselection[g][h],null!=l)){if(p.cellsformat&&(-1!=p.cellsformat.indexOf("p")||-1!=p.cellsformat.indexOf("c")||-1!=p.cellsformat.indexOf("n")||-1!=p.cellsformat.indexOf("f"))){-1<l.indexOf(this.gridlocalization.currencysymbol)&&(l=l.replace(this.gridlocalization.currencysymbol,""));r=function(b,c,e){var d=b;if(c==e)return b;for(b=d.indexOf(c);-1!=b;)d=d.replace(c,e),b=d.indexOf(c);return d};l=
            r(l,this.gridlocalization.thousandsseparator,"");l=l.replace(this.gridlocalization.decimalseparator,".");-1<l.indexOf(this.gridlocalization.percentsymbol)&&(l=l.replace(this.gridlocalization.percentsymbol,""));r="";for(t=0;t<l.length;t++)w=l.substring(t,t+1),"-"===w&&(r+="-"),"."===w&&(r+="."),null!=w.match(/^[0-9]+$/)&&(r+=w);l=r;l=l.replace(/ /g,"");l=new Number(l);isNaN(l)&&(l="")}this._raiseEvent(17,{rowindex:b,datafield:d.datafield,value:l});this.setcellvalue(b,p.displayfield,l,!1);p.displayfield!=
        p.datafield&&this.logicalclipboardselection&&(r=this.logicalclipboardselection[g][p.datafield],void 0!=r&&this.setcellvalue(b,p.datafield,r,!1));this._raiseEvent(18,{rowindex:b,datafield:d.datafield,oldvalue:this.getcellvalue(d.rowindex,d.datafield),value:l});this._applycellselection(b,d.datafield,!0,!1)}}"checkbox"==this.selectionmode&&this._updatecheckboxselection();this.dataview.updateview();this._renderrows(this.virtualsizeinfo)}this.clipboardend&&this.clipboardend("paste")},_applyrowselection:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        c,e,d,g){if(null==b)return!1;g=this.selectedrowindex;"singlerow"==this.selectionmode&&(c?this._raiseEvent(2,{rowindex:b,row:this.getrowdata(b)}):this._raiseEvent(3,{rowindex:b,row:this.getrowdata(b)}),this._raiseEvent(3,{rowindex:g}),this.selectedrowindexes=[],this.selectedcells=[]);1==d&&(this.selectedrowindexes=[]);0<this.dataview.filters.length&&((d=this.getrowdata(b))&&void 0!==d.dataindex?b=d.dataindex:d&&void 0===d.dataindex&&void 0!=d.uid&&(b=this.getrowboundindexbyid(d.uid)));d=this.selectedrowindexes.indexOf(b);
        if(c)this.selectedrowindex=b,-1==d?(this.selectedrowindexes.push(b),"singlerow"!=this.selectionmode&&this._raiseEvent(2,{rowindex:b,row:this.getrowdata(b)})):"multiplerows"==this.selectionmode&&(this.selectedrowindexes.splice(d,1),this._raiseEvent(3,{rowindex:this.selectedrowindex,row:this.getrowdata(b)}),this.selectedrowindex=0<this.selectedrowindexes.length?this.selectedrowindexes[this.selectedrowindexes.length-1]:-1);else if(0<=d||"singlerow"==this.selectionmode||"multiplerowsextended"==this.selectionmode||
            "multiplerowsadvanced"==this.selectionmode)c=this.selectedrowindexes[d],this.selectedrowindexes.splice(d,1),this._raiseEvent(3,{rowindex:c,row:this.getrowdata(b)}),this.selectedrowindex=-1;(void 0==e||e)&&this._rendervisualrows();return!0},_applycellselection:function(b,c,e,d){if(null==b||null==c)return!1;if("singlecell"==this.selectionmode){var f=this.selectedcell;null!=f&&this._raiseEvent(16,{rowindex:f.rowindex,datafield:f.datafield});this.selectedcells=[]}if("multiplecellsextended"==this.selectionmode||
        "multiplecellsadvanced"==this.selectionmode)f=this.selectedcell,null!=f&&this._raiseEvent(16,{rowindex:f.rowindex,datafield:f.datafield});f=b+"_"+c;if(0<this.dataview.filters.length){var h=this.getrowdata(b);h&&void 0!==h.dataindex?(b=h.dataindex,f=b+"_"+c):h&&void 0===h.dataindex&&h.uid&&(b=this.getrowboundindexbyid(h.uid),f=b+"_"+c)}b={rowindex:b,datafield:c};if(e)if(this.selectedcell=b,!this.selectedcells[f])this.selectedcells[f]=b,this.selectedcells.length++,this._raiseEvent(15,b);else{if("multiplecells"==
        this.selectionmode||"multiplecellsextended"==this.selectionmode||"multiplecellsadvanced"==this.selectionmode)delete this.selectedcells[f],0<this.selectedcells.length&&this.selectedcells.length--,this._raiseEvent(16,b)}else delete this.selectedcells[f],0<this.selectedcells.length&&this.selectedcells.length--,this._raiseEvent(16,b);(void 0==d||d)&&this._rendervisualrows();return!0},_getcellindex:function(b){var c=-1;d.each(this.selectedcells,function(){c++;if(this[b])return!1});return c},_clearhoverstyle:function(){if(void 0!=
        this.hoveredrow&&-1!=this.hoveredrow&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()){var b=this.table.find(".jqx-grid-cell-hover");0<b.length&&(b.removeClass(this.toTP("jqx-grid-cell-hover")),b.removeClass(this.toTP("jqx-fill-state-hover")));for(var c=0;c<b.length;c++){var e=b[c].getAttribute("columnindex");e&&(e=this.columns.records[parseInt(e)])&&e._applyCellStyle(b[c])}this.hoveredrow=-1}},_clearselectstyle:function(){for(var b=this.table[0].rows.length,c=this.table[0].rows,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    e=this.toTP("jqx-grid-cell-selected"),f=this.toTP("jqx-fill-state-pressed"),g=this.toTP("jqx-grid-cell-hover"),h=this.toTP("jqx-fill-state-hover"),k=0;k<b;k++){var l=c[k],m=l.cells.length;l=l.cells;for(var p=0;p<m;p++){var r=l[p],t=d(r);-1!=r.className.indexOf("jqx-grid-cell-selected")&&(t.removeClass(e),t.removeClass(f));-1!=r.className.indexOf("jqx-grid-cell-hover")&&(t.removeClass(g),t.removeClass(h));(t=r.getAttribute("columnindex"))&&(t=this.columns.records[parseInt(t)])&&t._applyCellStyle(r)}}},
    _selectpath:function(b,c){var e=this._lastClickedCell?Math.min(this._lastClickedCell.row,b):0,d=this._lastClickedCell?Math.max(this._lastClickedCell.row,b):0;if(e<=d){b=this._getcolumnindex(this._lastClickedCell.column);var g=this._getcolumnindex(c);c=Math.min(b,g);g=Math.max(b,g);this.selectedcells=[];for(var h=this.dataview.loadedrecords;e<=d;e++)for(var k=c;k<=g;k++)b=h[e],this._applycellselection(this.getboundindex(b),this._getcolumnat(k).datafield,!0,!1);this._rendervisualrows()}},_selectrowpath:function(b){if("multiplerowsextended"==
        this.selectionmode){var c=this._lastClickedCell?Math.min(this._lastClickedCell.row,b):0;b=this._lastClickedCell?Math.max(this._lastClickedCell.row,b):0;if(c<=b){for(this.selectedrowindexes=[];c<=b;c++){var e=this.getrowboundindex(c);this._applyrowselection(e,!0,!1)}this._rendervisualrows()}}},_selectrowwithmouse:function(b,c,e,d,g,h){var f=c.row;if(void 0!=f&&(c=c.index,void 0!=this.hittestinfo[c])){for(var l=0;l<this.columns.records.length;l++){var m=this.columns.records[l];m.selected=!1;m.element&&
    m.element.removeAttribute("selected");m._applyStyle()}l=this.hittestinfo[c].visualrow;if(!this.hittestinfo[c].details&&!f.group){if("multiplerows"==this.selectionmode||"multiplecells"==this.selectionmode||"checkbox"==this.selectionmode||-1!=this.selectionmode.indexOf("multiple")&&(1==h||1==g)){m=this.getboundindex(f);if(0<this.dataview.filters.length){var p=this.getrowdata(m);p&&(m=p.dataindex,void 0==m&&(m=this.getboundindex(f)))}m=-1!=e.indexOf(m);e=this.getboundindex(f)+"_"+d;if(-1!=this.selectionmode.indexOf("cell"))g=
        void 0!=this.selectedcells[e],void 0!=this.selectedcells[e]&&g?this._selectcellwithstyle(b,!1,c,d,l):this._selectcellwithstyle(b,!0,c,d,l),h&&void 0==this._lastClickedCell&&(b=this.getselectedcells())&&0<b.length&&(this._lastClickedCell={row:b[0].rowindex,column:b[0].datafield}),h&&this._lastClickedCell&&(this._selectpath(f.visibleindex,d),this.mousecaptured=!1,"visible"==this.selectionarea.css("visibility")&&this.selectionarea.css("visibility","hidden"));else if(m?g?this._applyrowselection(this.getboundindex(f),
        !1):this._selectrowwithstyle(b,l,!1,d):this._selectrowwithstyle(b,l,!0,d),h&&void 0==this._lastClickedCell&&(b=this.getselectedrowindexes())&&0<b.length&&(this._lastClickedCell={row:b[0],column:d}),h&&this._lastClickedCell){this.selectedrowindexes=[];b=this._lastClickedCell?Math.max(this._lastClickedCell.row,f.visibleindex):0;g=this.dataview.loadedrecords;for(c=this._lastClickedCell?Math.min(this._lastClickedCell.row,f.visibleindex):0;c<=b;c++)(f=g[c])&&this._applyrowselection(this.getboundindex(f),
        !0,!1,!1);this._rendervisualrows()}}else this._clearselectstyle(),this._selectrowwithstyle(b,l,!0,d),-1!=this.selectionmode.indexOf("cell")&&this._selectcellwithstyle(b,!0,c,d,l);h||(this._lastClickedCell={row:f.visibleindex,column:d})}}},_selectcellwithstyle:function(b,c,e,f,g){b=d(g.cells[b._getcolumnindex(f)]);b.removeClass(this.toTP("jqx-grid-cell-hover"));b.removeClass(this.toTP("jqx-fill-state-hover"));c?(b.addClass(this.toTP("jqx-grid-cell-selected")),b.addClass(this.toTP("jqx-fill-state-pressed"))):
        (b.removeClass(this.toTP("jqx-grid-cell-selected")),b.removeClass(this.toTP("jqx-fill-state-pressed")));this.getcolumn(f)._applyCellStyle(b)},_selectrowwithstyle:function(b,c,e,f){var g=c.cells.length,h=0;b.rowdetails&&b.showrowdetailscolumn?this.rtl?g=g-1-this.groups.length:h=1+this.groups.length:this.groupable&&(this.rtl?g-=this.groups.length:h=this.groups.length);for(;h<g;h++){var k=c.cells[h];e?(d(k).removeClass(this.toTP("jqx-grid-cell-hover")),d(k).removeClass(this.toTP("jqx-fill-state-hover")),
    -1==b.selectionmode.indexOf("cell")&&(d(k).addClass(this.toTP("jqx-grid-cell-selected")),d(k).addClass(this.toTP("jqx-fill-state-pressed")))):(d(k).removeClass(this.toTP("jqx-grid-cell-hover")),d(k).removeClass(this.toTP("jqx-grid-cell-selected")),d(k).removeClass(this.toTP("jqx-fill-state-hover")),d(k).removeClass(this.toTP("jqx-fill-state-pressed")));(f=k.getAttribute("columnindex"))&&(f=this.columns.records[parseInt(f)])&&f._applyCellStyle(k)}},_handlemousemoveselection:function(b,c){if(c.hScrollInstance.isScrolling()||
        c.vScrollInstance.isScrolling())return!1;if(("multiplerowsextended"==c.selectionmode||"multiplecellsextended"==c.selectionmode||"multiplecellsadvanced"==c.selectionmode)&&c.mousecaptured){if(c.multipleselectionbegins&&!1===c.multipleselectionbegins(b))return!0;var e=this.showheader?this.columnsheader.height()+2:0,f=this._groupsheader()?this.groupsheader.height():0,g=this.showtoolbar?this.toolbar.height():0;f+=g;g=this.host.coord();if(this.hasTransform){g=d.jqx.utilities.getOffset(this.host);var h=
        this._getBodyOffset();g.left-=h.left;g.top-=h.top}"0px"===this.host.css("border-top-width")&&(f-=2);var k=b.pageX;h=b.pageY-f;if(3<Math.abs(this.mousecaptureposition.left-k)||3<Math.abs(this.mousecaptureposition.top-h)){parseInt(this.columnsheader.coord().top);this.hasTransform&&d.jqx.utilities.getOffset(this.columnsheader);k<g.left&&(k=g.left);k>g.left+this.host.width()&&(k=g.left+this.host.width());e=g.top+e;h<e&&(h=e+5);var l=parseInt(Math.min(c.mousecaptureposition.left,k));e=-5+parseInt(Math.min(c.mousecaptureposition.top,
        h));var m=parseFloat(Math.abs(c.mousecaptureposition.left-k)),p=parseInt(Math.abs(c.mousecaptureposition.top-h));l-=g.left;e-=g.top;this.selectionarea.css("visibility","visible");if("multiplecellsadvanced"==c.selectionmode){k=l;var r=k+m,t=c.hScrollInstance;h=t.value;this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(h=t.max-t.value);var w=c.table[0].rows[0],q=0,u=t=c.mousecaptureposition.clickedcell;q=!1;var y=0,z=w.cells.length;c.mousecaptureposition.left<=b.pageX&&(y=t);for(var A=!1;y<z;y++){var C=
        parseFloat(d(this.columnsrow[0].cells[y]).css("left")),B=C-h;if(c.columns.records[y].pinned&&!c.columns.records[y].hidden)if(y==t&&(A=!0),C+=d(this.columnsrow[0].cells[y]).width(),c.mousecaptureposition.left>b.pageX){if(C>=k&&k>=B){u=y;q=!0;break}}else{if(C>=r&&r>=B){u=y;q=!0;break}}else{if(A){q=!0;u--;break}C=this._getcolumnat(y);if(!(null!=C&&C.hidden||c.groupable&&0<c.groups.length&&y<c.groups.length))if(C=B+d(this.columnsrow[0].cells[y]).width(),c.mousecaptureposition.left>b.pageX){if(C>=k&&k>=
        B){u=y;q=!0;break}}else if(C>=r&&r>=B){u=y;q=!0;break}}}if(!q)if(c.mousecaptureposition.left>b.pageX)d.each(this.columns.records,function(b,e){if(c.groupable&&0<c.groups.length&&b<c.groups.length)return!0;if(!this.pinned&&!this.hidden)return u=b,!1});else if(!c.groupable||c.groupable&&0< !c.groups.length)u=w.cells.length-1;y=t;t=Math.min(t,u);u=Math.max(y,u);e=e+5+f;c.table[0].rows.indexOf(c.mousecaptureposition.clickedrow);r=0;k=b=-1;for(y=w=0;y<c.table[0].rows.length;y++){z=d(c.table[0].rows[y]);
        0==y&&(w=z.coord().top);B=z.height();C=w-g.top;if(-1==b&&C+B>=e){q=!1;for(var D=0;D<c.groups.length;D++){var K=z[0].cells[D].className;if(-1!=K.indexOf("jqx-grid-group-collapse")||-1!=K.indexOf("jqx-grid-group-expand")){q=!0;break}}if(q)continue;b=y}w+=B;if(c.groupable&&0<c.groups.length){q=!1;for(D=0;D<c.groups.length;D++)if(K=z[0].cells[D].className,-1!=K.indexOf("jqx-grid-group-collapse")||-1!=K.indexOf("jqx-grid-group-expand")){q=!0;break}if(q)continue;q=0;for(D=c.groups.length;D<z[0].cells.length;D++)""==
        d(z[0].cells[D]).html()&&q++;if(q==z[0].cells.length-c.groups.length)continue}-1!=b&&(r+=B);if(C+B>e+p){k=y;break}}if(-1!=b&&(e=d(c.table[0].rows[b]).coord().top-g.top-f-2,f=0,this.filterable&&this.showfilterrow&&(f=this.filterrowheight),0>parseFloat(c.table[0].style.top)&&e<this.rowsheight+f&&(e-=parseFloat(c.table[0].style.top),r+=parseFloat(c.table[0].style.top)),p=r,g=d(this.columnsrow[0].cells[t]),f=d(this.columnsrow[0].cells[u]),l=parseFloat(g.css("left")),m=parseFloat(f.css("left"))-parseFloat(l)+
        f.width()-2,l-=h,A&&(l+=h),c.editcell&&c.editable&&c.endcelledit&&(t!=u||b!=k))){if(0==c.editcell.validated)return;c.endcelledit(c.editcell.row,c.editcell.column,!0,!0)}}this.selectionarea.width(m);this.selectionarea.height(p);this.selectionarea.css("left",l);this.selectionarea.css("top",e)}}},_handlemouseupselection:function(b,c){if(this.selectionarea){if("visible"!=this.selectionarea[0].style.visibility)return c.mousecaptured=!1,!0;if(c.mousecaptured&&("multiplerowsextended"==c.selectionmode||"multiplerowsadvanced"==
        c.selectionmode||"multiplecellsextended"==c.selectionmode||"multiplecellsadvanced"==c.selectionmode)&&(c.mousecaptured=!1,"visible"==this.selectionarea.css("visibility"))){this.selectionarea.css("visibility","hidden");var e=this.showheader?this.columnsheader.height()+2:0,f=this._groupsheader()?this.groupsheader.height():0;"0px"===this.host.css("border-top-width")&&(f-=2);var g=this.showtoolbar?this.toolbar.height():0;f+=g;var h=this.selectionarea.coord(),k=this.host.coord();this.hasTransform&&(k=
        d.jqx.utilities.getOffset(this.host),h=d.jqx.utilities.getOffset(this.selectionarea));"0px"===this.host.css("border-top-width")&&(f-=2);g=h.left-k.left;var l=e=h.top-e-k.top-f;f=g+this.selectionarea.width();var m=[];h=[];if("multiplerowsextended"==c.selectionmode){for(;e<l+this.selectionarea.height();){var p=this._hittestrow(g,e);k=p.row;var r=p.index;-1==r||h[r]||(h[r]=!0,m[m.length]=p);e+=20}l=0;d.each(m,function(){var e=this.row;"none"!=c.selectionmode&&c._selectrowwithmouse&&(b.ctrlKey||b.metaKey?
        c._applyrowselection(c.getboundindex(e),!0,!1,!1):0==l?c._applyrowselection(c.getboundindex(e),!0,!1,!0):c._applyrowselection(c.getboundindex(e),!0,!1,!1),l++)})}else{"multiplecellsadvanced"==c.selectionmode&&(e+=2);k=c.hScrollInstance;m=k.value;this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(m=k.max-k.value),"hidden"!=this.vScrollBar[0].style.visibility&&(m-=this.scrollbarsize+4));var t=c.table[0].rows[0],w=c.selectionarea.height();!b.ctrlKey&&!b.metaKey&&0<w&&(c.selectedcells=[]);for(;e<
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             l+w;){if(p=c._hittestrow(g,e))if(k=p.row,r=p.index,-1!=r&&!h[r])for(h[r]=!0,p=0;p<t.cells.length;p++){r=parseFloat(d(c.columnsrow[0].cells[p]).css("left"))-m;var q=r+d(c.columnsrow[0].cells[p]).width();(g>=r&&g<=q||f>=r&&f<=q||r>=g&&r<=f)&&c._applycellselection(c.getboundindex(k),c._getcolumnat(p).datafield,!0,!1)}e+=5}}c.autosavestate&&c.savestate&&c.savestate();c._renderrows(c.virtualsizeinfo)}}},selectprevcell:function(b,c){c=this._getcolumnindex(c);c=this._getprevvisiblecolumn(c);null!=c&&(this.clearselection(),
        this.selectcell(b,c.datafield))},selectnextcell:function(b,c){c=this._getcolumnindex(c);c=this._getnextvisiblecolumn(c);null!=c&&(this.clearselection(),this.selectcell(b,c.datafield))},_getfirstvisiblecolumn:function(){for(var b=this.columns.records.length,c=0;c<b;c++){var e=this.columns.records[c];if(!e.hidden&&null!=e.datafield)return e}return null},_getlastvisiblecolumn:function(){for(var b=this.columns.records.length-1;0<=b;b--){var c=this.columns.records[b];if(!c.hidden&&null!=c.datafield)return c}return null},
    _handlekeydown:function(b,c){if(c.disabled)return!1;var e=b.charCode?b.charCode:b.keyCode?b.keyCode:0;if(c.editcell&&"multiplecellsadvanced"!=c.selectionmode)return!0;if(c.editcell&&"multiplecellsadvanced"==c.selectionmode)if(33<=e&&40>=e){if(b.altKey||void 0!=c._cancelkeydown&&0!=c._cancelkeydown)return c._cancelkeydown=!1,!0;if("selectedrow"!==c.editmode){if(c.endcelledit(c.editcell.row,c.editcell.column,!1,!0),c._cancelkeydown=!1,c.editcell&&!c.editcell.validated)return c._rendervisualrows(),c.endcelledit(c.editcell.row,
        c.editcell.column,!1,!0),!1}else return!0}else return!0;if("none"==c.selectionmode||c.showfilterrow&&c.filterable&&this.filterrow&&d(b.target).ischildof(c.filterrow)||c.showeverpresentrow&&(c.addnewrowtop&&d(b.target).ischildof(c.addnewrowtop)||c.addnewrowbottom&&d(b.target).ischildof(c.addnewrowbottom))||b.target.className&&0<=b.target.className.indexOf("jqx-grid-widget")||c.pageable&&d(b.target).ischildof(this.pager)||this.showtoolbar&&d(b.target).ischildof(this.toolbar)||this.showstatusbar&&d(b.target).ischildof(this.statusbar))return!0;
        var f=!1;if(b.altKey)return!0;if((b.ctrlKey||b.metaKey)&&this.clipboard){var g=String.fromCharCode(e).toLowerCase();if(this.clipboardbegin){var h=null;"c"==g?h=this.clipboardbegin("copy",this.copyselection()):"x"==g?h=this.clipboardbegin("cut",this.copyselection()):"v"==g&&(h=this.clipboardbegin("paste"));if(!1===h)return!1}if("c"==g||"x"==g){h=this.copyselection();"c"==g&&this.clipboardend&&this.clipboardend("copy");"x"==g&&this.clipboardend&&this.clipboardend("cut");if(window.clipboardData)window.clipboardData.setData("Text",
            h);else{var k=d('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');k.val(h);d("body").append(k);k.select();setTimeout(function(){document.designMode="off";k.select();k.remove();c.focus()},100)}if("c"==g&&d.jqx.browser.msie)return!1;if("c"==g)return!0}else if("v"==g){var l=d('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');d("body").append(l);l.select();var m=this;setTimeout(function(){m._clipboardselection=[];var b=l.val();0==b.length&&window.clipboardData&&
        (l.val(window.clipboardData.getData("Text")),b=l.val());b=b.split("\n");for(var c=0;c<b.length;c++)if(0<b[c].split("\t").length){var e=b[c].split("\t");(1!=e.length||c!=b.length-1||""!=e[0])&&0<e.length&&m._clipboardselection.push(e)}m.pasteselection();l.remove();m.focus()},100);return!0}if("x"==g)return this.deleteselection(),this.host.focus(),!1}g=Math.round(c._gettableheight());var p=Math.round(g/c.rowsheight),r=c.getdatainformation();switch(c.selectionmode){case "singlecell":case "multiplecells":case "multiplecellsextended":case "multiplecellsadvanced":h=
            c.getselectedcell();null===h&&c.selectcell(0,c.columns.records[0].displayfield);if(null!=h){g=this.getrowvisibleindex(h.rowindex);var t=h.datafield,w=c._getcolumnindex(t),q=function(e,d,g,h){var k=function(e,d){var k=c.dataview.loadedrecords[e];if(c.groupable&&0<c.groups.length){var q=e;"up"==h&&q++;"down"==h&&q--;k=c.getdisplayrows()[q];for(var l=1,u=!0;u&&300>l;){u=!1;"down"==h?k=c.getdisplayrows()[q+l]:"up"==h&&(k=c.getdisplayrows()[q-l]);if(!k)break;k&&k.group&&(u=!0);for(var m=k.parentItem;m;){var p;
            if(p=m)p=m.group?c.expandedgroups[m.uniqueid]?c.expandedgroups[m.uniqueid].expanded:void 0:!1,p=!p;p&&(u=!0);m=m.parentItem}if(!u)break;l++}300==l&&(k=null);if(c.pageable&&(q=!1,k)){for(l=0;l<c.dataview.rows.length;l++)c.dataview.rows[l].boundindex==k.boundindex&&(q=!0);q||(k=null)}}else if(c.pageable&&(q=!1,k)){for(l=0;l<c.dataview.rows.length;l++)c.dataview.rows[l].boundindex==k.boundindex&&(q=!0);q||(c.pagerpageinput&&9===b.keyCode&&k.boundindex>c.dataview.rows[c.dataview.rows.length-1].boundindex&&
        (c.pagerpageinput.focus(),b.preventDefault()),c.ensurerowvisible(k))}return void 0!=k&&null!=d?((g||void 0==g)&&c.clearselection(),k=c.getboundindex(k),c.selectcell(k,d),c._oldselectedcell=c.selectedcell,f=!0,c.groupable?c.ensurecellvisible(k,d):c.ensurecellvisible(e,d),!0):!1};k(e,d)||c.groupable||(c.ensurecellvisible(e,d),k(e,d),c.virtualmode&&c.host.focus());c.groupable&&0<c.groups.length||(b.shiftKey&&9!=b.keyCode?"multiplecellsextended"!=c.selectionmode&&"multiplecellsadvanced"!=c.selectionmode||
            !c._lastClickedCell||(c._selectpath(e,d),e=c.getboundindex(c.dataview.loadedrecords[e]),c.selectedcell={rowindex:e,datafield:d}):b.shiftKey||(c._lastClickedCell={row:e,column:d}))},u=b.shiftKey&&"singlecell"!=c.selectionmode&&"multiplecells"!=c.selectionmode;h=function(){c.pageable?q(c.dataview.pagenum*c.dataview.pagesize,t,!u):q(0,t,!u)};var y=function(){var b=r.rowscount-1;c.pageable&&(b=c.dataview.pagenum*c.dataview.pagesize+c.dataview.rows.length-1);q(b,t,!u)},z=9==e&&!b.shiftKey,A=9==e&&b.shiftKey;
            if(c.rtl){var C=z;z=A;A=C}if(z||A)u=!1;if((z||A)&&document.activeElement&&document.activeElement.className&&0<=document.activeElement.className.indexOf("jqx-grid-cell-add-new-row"))return!0;if((C=b.ctrlKey||b.metaKey)&&37==e)p=c._getfirstvisiblecolumn(w),null!=p&&q(g,p.datafield);else if(C&&39==e)p=c._getlastvisiblecolumn(w),null!=p&&q(g,p.datafield);else if(39==e||z)p=c._getnextvisiblecolumn(w),null!=p?q(g,p.datafield,!u):z?(p=c._getfirstvisiblecolumn(),e=40,t=p.displayfield):f=!0;else if(37==e||
                A)p=c._getprevvisiblecolumn(w),null!=p?q(g,p.datafield,!u):A?(p=c._getlastvisiblecolumn(),e=38,t=p.displayfield):f=!0;else if(36==e)h();else if(35==e)y();else if(33==e)if(0<=g-p){var B=g-p;q(B,t,!u);c.pageable&&c.virtualmode&&(c.gotoprevpage(),setTimeout(function(){q(B,t,!u)},25))}else h();else 34==e&&(r.rowscount>g+p?(B=g+p,q(B,t,!u),c.pageable&&c.virtualmode&&(c.gotonextpage(),setTimeout(function(){q(B,t,!u)},25))):y());38==e&&(C?h():0<g?q(g-1,t,!u,"up"):f=!1);40==e&&(C?y():r.rowscount>g+1||c.groupable&&
            0<c.groups.length?q(g+1,t,!u,"down"):f=!0)}break;case "singlerow":case "multiplerows":case "multiplerowsextended":case "multiplerowsadvanced":g=c.getselectedrowindex();if(null==g||-1==g)return!0;g=this.getrowvisibleindex(g);var D=function(d,g,h){var k=function(b){var e=c.dataview.loadedrecords[b];if(c.groupable&&0<c.groups.length){"up"==h&&b++;"down"==h&&b--;e=c.getdisplayrows()[b];for(var d=1,k=!0;k&&300>d;){k=!1;"down"==h?e=c.getdisplayrows()[b+d]:"up"==h&&(e=c.getdisplayrows()[b-d]);if(!e)break;
            e&&e.group&&(k=!0);for(var q=e.parentItem;q;){var l;if(l=q)l=q.group?c.expandedgroups[q.uniqueid]?c.expandedgroups[q.uniqueid].expanded:void 0:!1,l=!l;l&&(k=!0);q=q.parentItem}if(!k)break;d++}300==d&&(e=null);if(c.pageable&&(d=!1,e)){for(k=0;k<c.dataview.rows.length;k++)c.dataview.rows[k].boundindex==e.boundindex&&(d=!0);d||(e=null)}}return void 0!=e?(e=c.getboundindex(e),d=c.selectedrowindex,(g||void 0==g)&&c.clearselection(),c.selectedrowindex=d,c.selectrow(e,!1),(c.groupable?c.ensurerowvisible(e):
            c.ensurerowvisible(b))&&!c.autoheight&&!c.groupable||c._rendervisualrows(),f=!0):!1};k(d)||c.groupable||(c.ensurerowvisible(d),k(d,g),c.virtualmode&&setTimeout(function(){k(d,g)},25),c.virtualmode&&c.host.focus());c.groupable&&0<c.groups.length||(b.shiftKey&&9!=e?"multiplerowsextended"==c.selectionmode&&c._lastClickedCell&&(c._selectrowpath(d),c.selectedrowindex=c.getrowboundindex(d)):b.shiftKey||(c._lastClickedCell={row:d},c.selectedrowindex=c.getrowboundindex(d)))};u=b.shiftKey&&"singlerow"!=c.selectionmode&&
            "multiplerows"!=c.selectionmode;h=function(){c.pageable?D(c.dataview.pagenum*c.dataview.pagesize,!u):D(0,!u)};y=function(){var b=r.rowscount-1;c.pageable&&(b=c.dataview.pagenum*c.dataview.pagesize+c.dataview.rows.length-1);D(b,!u)};C=b.ctrlKey||b.metaKey;36==e||C&&38==e?h():35==e||C&&40==e?y():33==e?0<=g-p?(B=g-p,D(B,!u,"up"),c.pageable&&c.virtualmode&&(c.gotoprevpage(),setTimeout(function(){D(B,!u)},25))):h():34==e?r.rowscount>g+p?(B=g+p,D(B,!u,"down"),c.pageable&&c.virtualmode&&(c.gotonextpage(),
            setTimeout(function(){D(B,!u)},25))):y():38==e?0<g?D(g-1,!u,"up"):f=!0:40==e&&(r.rowscount>g+1||c.groupable&&0<c.groups.length?D(g+1,!u,"down"):f=!0)}return f?(c.autosavestate&&c.savestate&&c.savestate(),!1):!0},_handlemousemove:function(b,c){if(!c.vScrollInstance.isScrolling()&&!c.hScrollInstance.isScrolling()){if(c.enablehover||"multiplerows"==c.selectionmode){var e=this.showheader?this.columnsheader.height()+2:0;var f=this._groupsheader()?this.groupsheader.height():0;f+=this.showtoolbar?this.toolbarheight:
        0;var g=this.host.coord();if(this.hasTransform){g=d.jqx.utilities.getOffset(this.host);var h=this._getBodyOffset();g.left-=h.left;g.top-=h.top}h=b.pageX-g.left;e=b.pageY-e-g.top-f}if("multiplerowsextended"!=c.selectionmode&&"multiplecellsextended"!=c.selectionmode&&"multiplecellsadvanced"!=c.selectionmode||1!=c.mousecaptured)if(c.enablehover){if(!(c.disabled||this.vScrollInstance.isScrolling()||this.hScrollInstance.isScrolling())&&(e=this._hittestrow(h,e))){var k=e.row;e=e.index;if(-1==this.hoveredrow||
        -1==e||this.hoveredrow!=e||-1!=this.selectionmode.indexOf("cell")||"checkbox"==this.selectionmode)if(this._clearhoverstyle(),-1!=e&&void 0!=k&&(f=this.hittestinfo[e].visualrow,!(null==f||this.hittestinfo[e].details||b.clientX>d(f).width()+d(f).coord().left))){var l=0;g=f.cells.length;c.rowdetails&&c.showrowdetailscolumn?this.rtl?g=g-1-this.groups.length:l=1+this.groups.length:this.groupable&&(this.rtl?g-=this.groups.length:l=this.groups.length);if(0!=f.cells.length&&(c=f.cells[l].className,!(k.group||
        0<=this.selectionmode.indexOf("row")&&-1!=c.indexOf("jqx-grid-cell-selected"))))if(this.hoveredrow=e,-1!=this.selectionmode.indexOf("cell")||"checkbox"==this.selectionmode){c=-1;var m=this.hScrollInstance;k=m.value;for(this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(k=m.max-m.value);l<g;l++)if(m=parseInt(d(this.columnsrow[0].cells[l]).css("left"))-k,this.columns.records[l].pinned&&!this.rtl&&(m=parseInt(d(this.columnsrow[0].cells[l]).css("left"))),m+d(this.columnsrow[0].cells[l]).width()>=
    h&&h>=m){c=l;break}if(-1!=c){h=f.cells[c];this.cellhover&&this.cellhover(h,b.pageX,b.pageY);if(-1==h.className.indexOf("jqx-grid-cell-selected")&&this.editcell&&(k=this._getcolumnat(c))&&this.editcell.row==e&&this.editcell.column==k.datafield)return;d(h).addClass(this.toTP("jqx-grid-cell-hover"));d(h).addClass(this.toTP("jqx-fill-state-hover"));k=this._getcolumnat(c);k._applyCellStyle(h)}}else for(;l<g;l++)h=f.cells[l],d(h).addClass(this.toTP("jqx-grid-cell-hover")),d(h).addClass(this.toTP("jqx-fill-state-hover")),
    this.cellhover&&this.cellhover(h,b.pageX,b.pageY),k=this._getcolumnat(l),k._applyCellStyle(h)}}}else return!0}}})})(jqxBaseFramework);
(function(d){d.jqx.dataview.grouping=function(){this.loadgrouprecords=function(b,c,e,f,g,h,k,l,m){var p=b;p=[];for(var r=0;r<this.groups.length;r++)p[r]=this.generatekey();f=[];var t=0,w=[],q=c,u=c,y=this.groups.length;this.loadedrecords=[];this.bounditems=[];this.loadedrecords=[];this.loadedrootgroups=[];this.loadedgroups=[];this.loadedgroupsByKey=[];this.sortedgroups=[];var z=null!=this.sortdata,A=z?this.sortdata:this.records;if(this.pageable){var C=[],B=0;A[c]||(d.each(A,function(b,e){C[c+b++]=
    this}),A=C)}if(this.virtualmode){C=[];for(q=B=0;q<e-c;q++)A[q]?C[c+B++]=A[q]:A[c+B]&&(C[c+B]=A[c+B],B++);q=0;A=C}for(B=c;B<e;B++){var D={};D=z?d.extend({},A[B].value):d.extend({},A[B]);var K=D[this.uniqueId];if(g>=l||K!=k[g][this.uniqueId]||h&&h[K])m[m.length]=g;K=[];var I=0;for(r=0;r<y;r++){var G=this.groups[r];G=D[G];null==G&&(G="");K[I++]={value:G,hash:p[r]}}if(K.length!=y)break;G=null;r="";I=-1;for(var H=0;H<K.length;H++){I++;var N=K[H].value;r=r+"_"+K[H].hash+"_"+N;if(void 0!=w[r]&&null!=w[r])G=
    w[r];else{if(null==G)G={group:N,subItems:[],subGroups:[],level:0},f[t++]=G,G.uniqueid=this.generatekey(),this.loadedgroupsByKey[N]=G;else{var Q={group:N,subItems:[],subGroups:[],parentItem:G,level:G.level+1};this.loadedgroupsByKey[G.uniqueid+"_"+N]=Q;Q.uniqueid=this.generatekey();G=G.subGroups[G.subGroups.length++]=Q}w[r]=G}}null!=G?(void 0==D.uid&&(D.uid=this.getid(this.source.id,D,q)),z?(D.boundindex=A[B].index,this.recordsbyid["id"+D.uid]=A[B].value):(D.boundindex=q,this.recordsbyid["id"+D.uid]=
    A[B]),this.bounditems[D.boundindex]=D,this.sortedgroups[q]=D,D.uniqueid=this.generatekey(),D.parentItem=G,D.level=G.level+1,G.subItems[G.subItems.length++]=D):(void 0==D.uid&&(D.uid=this.getid(this.source.id,D,q)),z?(D.boundindex=A[B].index,this.recordsbyid["id"+D.uid]=A[B].value):(D.boundindex=q,this.recordsbyid["id"+D.uid]=A[B]),this.sortedgroups[q]=D,this.bounditems[D.boundindex]=D,D.uniqueid=this.generatekey());g++;q++;u++}var J=function(c,e,d){for(var f=0;f<e.subItems.length;f++)e.subItems[f].visibleindex=
    b+d,c.rows[d]=e.subItems[f],c.loadedrecords[d]=e.subItems[f],d++;return d},O=function(c,e,d){var f=1,g=c.grid.columns.records?c.grid.columns.records:c.grid.columns;if(1==c.aggregates)for(var h=0;h<g.length;h++)g[h].aggregates&&(f=Math.max(f,g[h].aggregates.length));for(var k in e.subGroups)h=e.subGroups[k],h.subGroups&&(c.loadedgroups[c.loadedgroups.length]=h,h.visibleindex=b+d,c.rows[d]=h,c.loadedrecords[d]=h,d++,0<h.subGroups.length?d=O(c,h,d):0<h.subItems.length&&(d=J(c,h,d)));0<e.subItems.length&&
(d=J(c,e,d));(function(e){if(1==c.aggregates)for(var h=function(f){var h=e,k={},q=function(b){for(var e=0;e<g.length;e++)if(g[e].aggregates)for(var d=c.grid.getcolumnaggregateddata(g[e].datafield,g[e].aggregates,!0,b),h=0;h<g[e].aggregates.length;h++)if(g[e].aggregates[f]){var q=g[e],l=g[e].aggregates[f],u=l;u=c.grid._getaggregatename(u);var m=u+":"+d[l];k[q.datafield]=d[l]?m:u+":"+d[u]}};if(null!=h)if(k.level=h.level,k.visibleindex=b+d,k.uniqueid=c.generatekey(),c.rows[d]=k,c.loadedrecords[d++]=
    k,k.totalsrow=!0,0<e.subItems.length){h=e.subItems[e.subItems.length-1];k.parentItem=h.parentItem;k.parentItem.subItems&&(k.parentItem.subItems[k.parentItem.subItems.length]=k);var l=[],u=function(){for(var b=0;b<e.subItems.length;b++)e.subItems[b].totalsrow||(l[l.length]=e.subItems[b])};u(e);q(l)}else 0<e.subGroups.length&&(h=e.subGroups[e.subGroups.length-1],k.level=h.level,k.parentItem=e,e.subGroups[e.subGroups.length]=k,l=[],u=function(b){if(!b.totalsrow){for(var c=0;c<b.subItems.length;c++)b.subItems[c].totalsrow||
(l[l.length]=b.subItems[c]);for(c=0;c<b.subGroups.length;c++)u(b.subGroups[c])}},u(e),q(l))},k=0;k<f;k++)h(k)})(e);return d};e=f.length;this.loadedgroups=[];this.rows=[];for(q=p=0;q<e;q++)G=f[q],this.loadedrootgroups[q]=G,this.loadedgroups[this.loadedgroups.length]=G,G.visibleindex=b+p,this.rows[p]=G,this.loadedrecords[p]=G,p++,p=O(this,G,p);return p};this._updategroupsinpage=function(b,c,e,f,g,h,k){var l=[];if(this.groupable&&0<this.groups.length){c=0;g=[];for(var m=[],p=0;p<b.groups.length;p++)m[p]=
    b.generatekey();var r=0,t=[],w=0;k>this.totalrecords&&(k=this.totalrecords);for(;h<k;h++){var q=d.extend({},b.sortedgroups[h]);if(!b.pagesize||e>=b.pagesize*b.pagenum&&e<b.pagesize*(b.pagenum+1)){var u=[],y=0;for(p=0;p<b.groups.length;p++){var z=b.groups[p];z=q[z];null==z&&(z="");u[y++]={value:z,hash:m[p]}}if(u.length!=b.groups.length)break;p=null;y="";z=-1;for(var A=0;A<u.length;A++){z++;var C=u[A].value;y=y+"_"+u[A].hash+"_"+C;if(void 0!=g[y]&&null!=g[y])p=g[y];else{if(null==p)p={group:C,subItems:[],
    subGroups:[],level:0},t[w++]=p,C=b.loadedgroupsByKey[C],void 0!=C&&(p.visibleindex=C.visibleindex,p.uniqueid=C.uniqueid);else{var B={group:C,subItems:[],subGroups:[],parentItem:p,level:p.level+1};C=b.loadedgroupsByKey[p.uniqueid+"_"+C];B.visibleindex=C.visibleindex;B.uniqueid=C.uniqueid;p=p.subGroups[p.subGroups.length++]=B}g[y]=p}}null!=p&&(q.parentItem=p,q.level=p.level+1,p.subItems[p.subItems.length++]=q);f++}r++;e++}var D=function(b,c,e){for(b=0;b<c.subItems.length;b++)l[e]=d.extend({},c.subItems[b]),
    e++;return e},K=function(b){for(var c in b.subGroups){var e=b.subGroups[c];if(e.subGroups&&(0<e.subGroups.length&&K(e)||0<e.subItems.length))return!0}return 0<b.subItems.length?!0:!1},I=function(b,c,e){var d=1,f=b.grid.columns.records?b.grid.columns.records:b.grid.columns;if(1==b.aggregates)for(var g=0;g<f.length;g++)f[g].aggregates&&(d=Math.max(d,f[g].aggregates.length));for(var h in c.subGroups)g=c.subGroups[h],g.subGroups&&K(g)&&(l[e]=g,e++,0<g.subGroups.length?e=I(b,g,e):0<g.subItems.length&&
    (e=D(b,g,e)));0<c.subItems.length&&(e=D(b,c,e));(function(c){if(1==b.aggregates)for(var g=function(d){var g=c,h={},k=function(c){for(var e=0;e<f.length;e++)if(f[e].aggregates)for(var g=b.grid.getcolumnaggregateddata(f[e].datafield,f[e].aggregates,!0,c),k=0;k<f[e].aggregates.length;k++)if(f[e].aggregates[d]){var q=f[e],l=f[e].aggregates[d],u=l;u=b.grid._getaggregatename(u);h[q.datafield]=u+":"+g[l]}};if(null!=g)if(h.level=g.level,h.visibleindex=e,h.uniqueid=b.generatekey(),l[e]=h,b.loadedrecords[e++]=
    h,h.totalsrow=!0,0<c.subItems.length){g=c.subItems[c.subItems.length-1];h.parentItem=g.parentItem;h.parentItem.subItems&&(h.parentItem.subItems[h.parentItem.subItems.length]=h);var q=[],u=function(){for(var b=0;b<c.subItems.length;b++)c.subItems[b].totalsrow||(q[q.length]=c.subItems[b])};u(c);k(q)}else 0<c.subGroups.length&&(g=c.subGroups[c.subGroups.length-1],h.level=g.level,h.parentItem=c,c.subGroups[c.subGroups.length]=h,q=[],u=function(b){if(!b.totalsrow){for(var c=0;c<b.subItems.length;c++)b.subItems[c].totalsrow||
(q[q.length]=b.subItems[c]);for(c=0;c<b.subGroups.length;c++)u(b.subGroups[c])}},u(c),k(q))},h=0;h<d;h++)g(h)})(c);return e};for(r=0;r<t.length;r++)z=t[r],K(z)&&(l[c]=z,c++,c=I(this,z,c))}return l}};d.extend(d.jqx._jqxGrid.prototype,{_initgroupsheader:function(){this.groupsheader.css("visibility","hidden");if(this._groupsheader()){this.groupsheader.css("visibility","inherit");var b=this,c=this.gridlocalization.groupsheaderstring;this.groupsheaderdiv=this.groupsheaderdiv||d('<div style="width: 100%; position: relative;"></div>');
        this.groupsheaderdiv.height(this.groupsheaderheight);this.groupsheaderdiv.css("top",0);this.groupsheader.append(this.groupsheaderdiv);this.groupheadersbounds=[];var e=this.groups.length;this.groupsheaderdiv.children().remove();this.groupsheaderdiv[0].innerHTML="";var f=[];0<e?d.each(this.groups,function(c){var g=this,k=b._getColumnText(this).label;k=b._rendergroupcolumn(k,g);k.addClass(b.toThemeProperty("jqx-grid-group-column"));b.groupsheaderdiv.append(k);if(b.closeablegroups){var l=d(k.find(".jqx-icon-close"));
            b.isTouchDevice()&&!0!==b.touchmode?b.addHandler(l,"touchstart",function(){b.removegroupat(c);return!1}):b.addHandler(l,"click",function(){b.removegroupat(c);return!1})}b.sortable&&b.addHandler(k,"click",function(){var c=b.getcolumn(g);null!=c&&b._togglesort(c);return!1});f[f.length]=k;b._handlegroupstocolumnsdragdrop(this,k);c<e-1&&(k=k.height(),l=d('<div style="float: left; position: relative;"></div>'),b.rtl&&l.css("float","right"),l.width(b.groupindentwidth/3),l.height(1),l.css("top",k/2),l.addClass(b.toThemeProperty("jqx-grid-group-column-line")),
            b.groupsheaderdiv.append(l))}):(c=d('<div style="position: relative;">'+c+"</div>"),this.groupsheaderdiv.append(c),this.rtl&&c.addClass(this.toThemeProperty("jqx-rtl")));this._groupheaders=f;this._updategroupheadersbounds()}},_updategroupheadersbounds:function(){var b=this,c=this.groupsheaderdiv.children().outerHeight();c=(this.groupsheader.height()-c)/2;this.groupsheaderdiv.css("top",c);this.rtl?(this.groupsheaderdiv.css("left",""),this.groupsheaderdiv.css("right",c)):(this.groupsheaderdiv.css("left",
        c),this.groupsheaderdiv.css("right",""));this.rtl&&this._groupheaders.reverse();d.each(this._groupheaders,function(c){var e=this.coord();b.groupheadersbounds[c]={left:e.left,top:e.top,width:this.outerWidth(),height:this.outerHeight(),index:c}})},addgroup:function(b){b&&(this.groups!==this.dataview.groups&&(this.dataview.groups=this.groups),this.groups[this.groups.length]=b,this.refreshgroups(),this._raiseEvent(12,{type:"Add",index:this.groups[this.groups.length],groups:this.groups}))},insertgroup:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       c){void 0!=b&&null!=b&&0<=b&&b<=this.groups.length&&c&&(this.groups!==this.dataview.groups&&(this.dataview.groups=this.groups),this.groups.splice(b,0,c.toString()),this.refreshgroups(),this._raiseEvent(12,{type:"Insert",index:b,groups:this.groups}))},refreshgroups:function(){this._refreshdataview();this._render(!0,!0,!0,!1);this._postrender("group")},_insertaftergroup:function(b,c){b=this._getGroupIndexByDataField(b);this.insertgroup(b+1,c)},_insertbeforegroup:function(b,c){b=this._getGroupIndexByDataField(b);
        this.insertgroup(b,c)},removegroupat:function(b){return 0<=b&&null!=b&&void 0!=b?(this.groups!==this.dataview.groups&&(this.dataview.groups=this.groups),this.groups.splice(b,1),this.refreshgroups(),this.virtualmode&&this.updatebounddata(),this._raiseEvent(12,{type:"Remove",index:b,groups:this.groups}),!0):!1},cleargroups:function(){this.groups=[];this.dataview.groups=this.groups;this.refreshgroups();this._raiseEvent(12,{type:"Clear",index:-1,groups:this.groups});return!0},removegroup:function(b){if(null==
        b)return!1;b=this.groups.indexOf(b.toString());return this.removegroupat(b)},getrootgroupscount:function(){return this.dataview.loadedrootgroups.length},collapsegroup:function(b){if(0<=b&&-1===b.toString().indexOf("."))return this._setrootgroupstate(b,!1);var c=b.toString().split("."),e=null;this.groupsVisibility||(this.groupsVisibility=[]);for(var d=0;d<c.length;d++)if(b=parseInt(c[d]),0==d)e=this.dataview.loadedrootgroups[b],this.groupsVisibility[e.group]=null;else if(b=e.subGroups[b])e=b,d==c.length-
    1&&(this._setgroupstate(e,!1,!0),this.groupsVisibility[e.group]=null)},expandgroup:function(b){if(0<=b&&-1===b.toString().indexOf("."))return this._setrootgroupstate(b,!0);for(var c=b.toString().split("."),e=null,d=0;d<c.length;d++)if(b=parseInt(c[d]),0==d)e=this.dataview.loadedrootgroups[b],this._setrootgroupstate(b,!0),this.groupsVisibility||(this.groupsVisibility=[]),this.groupsVisibility[e.group]=e;else if(b=e.subGroups[b])e=b,this._setgroupstate(e,!0,!0),this.groupsVisibility||(this.groupsVisibility=
        []),this.groupsVisibility[e.group]=e},collapseallgroups:function(b){this._setbatchgroupstate(!1,b)},expandallgroups:function(b){this._setbatchgroupstate(!0,b)},isgroupexpanded:function(b){b=this.dataview.loadedrootgroups[b];return null==b?null:this.expandedgroups[b.uniqueid].expanded},jsonParser:function(){function b(b,c,e){var f=!1,k=!!c,q=[],l=[b],p=[b],r=[e?"~":"[Circular]"],t=b,w=1,I,G;k&&(G="object"===typeof c?function(b,e){return""!==b&&0>m.call(c,b)?void 0:e}:c);return function(b,c){k&&(c=
        G.call(this,b,c));f?(t!==this&&(I=w-m.call(l,this)-1,w-=I,l.splice(w,l.length),q.splice(w-1,q.length),t=this),"object"===typeof c&&c?(0>m.call(l,c)&&l.push(t=c),w=l.length,I=m.call(p,c),0>I?(I=p.push(c)-1,e?(q.push((""+b).replace(h,d)),r[I]="~"+q.join("~")):r[I]=r[0]):c=r[I]):"string"===typeof c&&e&&(c=c.replace(d,g).replace("~",d))):f=!0;return c}}function c(b){return function(c,f){var h="string"===typeof f;if(h&&"~"===f.charAt(0))return new p(f.slice(1));""===c&&(f=e(f,f,{}));h&&(f=f.replace(l,
        "$1~").replace(g,d));return b?b.call(this,c,f):f}}function e(b,c,d){if(c instanceof Array)for(var f=0,g=c.length;f<g;f++)c[f]=e(b,c[f],d);else if(c instanceof p)if(c.length)if(d.hasOwnProperty(c))c=d[c];else{f=c.split("~");g=0;for(var h=f.length;g<h;b=b[f[g++].replace(k,"~")]);c=d[c]=b}else c=b;else if(c instanceof Object)for(f in c)c.hasOwnProperty(f)&&(c[f]=e(b,c[f],d));return c}var d="\\x"+("0"+(126).toString(16)).slice(-2),g="\\"+d,h=new RegExp(d,"g"),k=new RegExp(g,"g"),l=new RegExp("(?:^|([^\\\\]))"+
        g),m=[].indexOf||function(b){for(var c=this.length;c--&&this[c]!==b;);return c},p=String,r={stringify:function(c,e,d,f){return r.parser.stringify(c,b(c,e,!f),d)},parse:function(b,e){return r.parser.parse(b,c(e))},parser:JSON};return r},getgroup:function(b){b=this.dataview.loadedrootgroups[b];if(null==b)return null;var c=this.expandedgroups[b.uniqueid].expanded,e=b.group,f=b.level,g=[];this._getsubgroups(g,b);var h=this;c={group:e,level:f,expanded:c,subgroups:g};if(b.subItems){var k=[];d.each(b.subItems,
        function(){k[k.length]=h.getrowdata(this.boundindex)});0<k.length&&(c.subrows=k)}b=this.jsonParser().stringify(b);b=b.replace(/subItems/ig,"subrows");b=b.replace(/subGroups/ig,"subgroups");return c=this.jsonParser().parse(b)},getrootgroups:function(){for(var b=this.dataview.loadedrootgroups.length,c=[],e=0;e<b;e++)c[e]=this.getgroup(e);return c},_getsubgroups:function(b,c){var e=this,f;for(f in c.subGroups){var g=c.subGroups[f];b[b.length]={group:g.group,level:g.level,expanded:e.expandedgroups[g.uniqueid].expanded};
        if(g.subItems){var h=[];d.each(g.subItems,function(){h[h.length]=e.getrowdata(this.boundindex)});b[b.length-1].subrows=h}g.subGroups&&e._getsubgroups([],g)}return b},_setbatchgroupstate:function(b,c){for(var e in this.dataview.loadedrootgroups)this._setrootgroupstate(e,b,!1,!0);if(0==c)return this._requiresupdate=!0,this._renderrows(this.virtualsizeinfo),!0;b=this.vScrollBar[0].style.visibility;this.rendergridcontent(!0,!1);if(b!=this.vScrollBar[0].style.visibility||this._hiddencolumns)this._updatecolumnwidths(),
        this._updatecellwidths(),this._renderrows(this.virtualsizeinfo);return!0},_setrootgroupstate:function(b,c,e,d){if(void 0==b||null==b||0>b||!this.groupable||0==this.groups.length)return!1;e=void 0!=e?e:!0;if(0<=b&&b<this.dataview.loadedrootgroups.length){var f=this.dataview.loadedrootgroups[b];if(this.pageable){f=[];for(var h=0;h<this.dataview.rows.length;h++)null!=this.dataview.rows[h].group&&0===this.dataview.rows[h].level&&f.push(this.dataview.rows[h]);f=f[b];if(!f)return}return this._setgroupstate(f,
        c,e,d)}return!1},_togglegroupstate:function(b,c){if(null==b||void 0==b)return!1;var e=this.vScrollInstance.value,d=this.expandedgroups[b.uniqueid];d=void 0==d?!1:d.expanded;d=!d;this.groupsVisibility||(this.groupsVisibility=[]);this.groupsVisibility[b.group]=d?b:null;b=this._setgroupstate(b,d,c);this._newmax=null;0!==e&&"hidden"!==this.vScrollBar.css("visibility")&&(e<=this.vScrollInstance.max?this.vScrollInstance.setPosition(e):this.vScrollInstance.setPosition(this.vScrollInstance.max));return b},
    _setgroupstate:function(b,c,e,d){if(null==b||void 0==b)return!1;var f=!1;this.editable&&this.editcell&&this.endcelledit(this.editcell.row,this.editcell.column,!1,!1);var h=this.expandedgroups[b.uniqueid];void 0==h&&(h={expanded:!1},f=!0);h.expanded!=c&&(f=!0);if(f){this.expandedgroups[b.uniqueid]={expanded:c,group:b};this._setsubgroupsvisibility(this,b,!c,d);e&&(e=this.vScrollBar[0].style.visibility,this.rendergridcontent(!0,!1),e!=this.vScrollBar[0].style.visibility||this._hiddencolumns)&&(this._updatecolumnwidths(),
        this._updatecellwidths(),this._renderrows(this.virtualsizeinfo));if(void 0==this.suspendgroupevents||0==this.suspendgroupevents)c?this._raiseEvent(4,{group:b.group,parentgroup:b.parentItem?b.parentItem.group:null,level:b.level,visibleindex:b.visibleindex}):this._raiseEvent(5,{group:b.group,parentgroup:b.parentItem?b.parentItem.group:null,level:b.level,visibleindex:b.visibleindex});return!0}return!1},_setgroupitemsvisibility:function(b,c,e){for(var d=0;d<c.subItems.length;d++)b._setrowvisibility(c.subItems[d].visibleindex,
        e,!1)},_setsubgroupsvisibility:function(b,c,e,d){if(null!=c.parentItem){if(this.hiddens[c.parentItem.visibleindex])return}else if(null==c.parentItem&&this.hiddens[c.visibleindex])return;for(var f in c.subGroups){var h=c.subGroups[f];e||b._setrowvisibility(h.visibleindex,e,!1);var k=!e;d?this.expandedgroups[h.uniqueid]={expanded:k,group:h}:k=void 0==b.expandedgroups[h.uniqueid]?!1:b.expandedgroups[h.uniqueid].expanded;h.subGroups&&(0<h.subGroups.length?b._setsubgroupsvisibility(b,h,!k||e,d):0<h.subItems.length&&
        b._setgroupitemsvisibility(b,h,!k||e));e&&b._setrowvisibility(h.visibleindex,e,!1)}c.subItems&&0<c.subItems.length&&b._setgroupitemsvisibility(b,c,e)},_handlecolumnsdragdrop:function(){var b=this,c=-1,e=!1;if(b.groupable){var f="mousemove.grouping"+this.element.id,g="mouseup.grouping"+this.element.id,h=!1;this.isTouchDevice()&&!0!==this.touchmode&&(h=!0,f=d.jqx.mobile.getTouchEventName("touchmove")+".grouping"+this.element.id,d.jqx.mobile.getTouchEventName("touchstart"),g=d.jqx.mobile.getTouchEventName("touchend")+
        ".grouping"+this.element.id);this.removeHandler(d(document),f);this.addHandler(d(document),f,function(f){if(!b.showgroupsheader)return!0;if(null!=b.dragcolumn){var g=parseInt(f.pageX),k=parseInt(f.pageY);h&&(k=b.getTouches(f)[0],g=parseInt(k.pageX),k=parseInt(k.pageY));var p=b.host.coord(),r=parseInt(p.left);p=parseInt(p.top);if(void 0==b.dragmousedownoffset||null==b.dragmousedownoffset)b.dragmousedownoffset={left:0,top:0};var t=parseInt(g)-parseInt(b.dragmousedownoffset.left),w=parseInt(k)-parseInt(b.dragmousedownoffset.top);
        b.dragcolumn.css({left:t+"px",top:w+"px"});e=!1;g>=r&&g<=r+b.host.width()&&k>=p&&k<=p+b.host.height()&&(e=!0);c=-1;e?(b.dragcolumnicon.removeClass(b.toThemeProperty("jqx-grid-dragcancel-icon")),b.dragcolumnicon.addClass(b.toThemeProperty("jqx-grid-drag-icon")),r=b.groupsheader.coord(),p=r.top+b.groupsheader.height(),t=(t=d.data(b.dragcolumn[0],"datarecord"))?b.groups.indexOf(t.toString()):-1,t=-1==t||1<b.groups.length&&-1<t,null!=b.dropline&&(k>=r.top&&k<=p?t&&(c=b._handlegroupdroplines(g)):b.dropline.fadeOut("slow"))):
            (null!=b.dropline&&b.dropline.fadeOut("slow"),b.dragcolumnicon.removeClass(b.toThemeProperty("jqx-grid-drag-icon")),b.dragcolumnicon.addClass(b.toThemeProperty("jqx-grid-dragcancel-icon")));if(h)return f.preventDefault(),f.stopPropagation(),!1}},{passive:!1});this.removeHandler(d(document),g);this.addHandler(d(document),g,function(f){if(!b.showgroupsheader)return!0;b.__drag=!1;d(document.body).removeClass("jqx-disableselect");parseInt(f.pageX);var g=parseInt(f.pageY);h&&(f=b.getTouches(f)[0],parseInt(f.pageX),
        g=parseInt(f.pageY));f=b.host.coord();parseInt(f.left);var k=parseInt(f.top),p=b.groupsheader.height();b.showtoolbar&&(k+=b.toolbarheight);b.dragstarted=!1;b.dragmousedown=null;null!=b.dragcolumn&&(f=d.data(b.dragcolumn[0],"datarecord"),b.dragcolumn.remove(),b.dragcolumn=null,null!=f&&(b.getcolumn(f).groupable&&e&&(-1!=c?(g=c.index,k=b.groups[g],p=b._getGroupIndexByDataField(f),p!=g&&(void 0!=p&&0<=p&&b.groups.splice(p,1),"before"==c.position?b.rtl?b._insertaftergroup(k,f):b._insertbeforegroup(k,
        f):b.rtl?b._insertbeforegroup(k,f):b._insertaftergroup(k,f))):0==b.groups.length?g>k&&g<=k+p&&b.addgroup(f):g>k+p&&(p=b._getGroupIndexByDataField(f),b.removegroupat(p))),null!=b.dropline&&(b.dropline.remove(),b.dropline=null)))})}},_getGroupIndexByDataField:function(b){for(var c=0;c<this.groups.length;c++)if(this.groups[c]==b)return c;return-1},_isColumnInGroups:function(b){for(var c=0;c<this.groups.length;c++)if(this.groups[c]==b)return!0;return!1},_handlegroupdroplines:function(b){var c=this,e=
        -1;d.each(c.groupheadersbounds,function(d){if(b<=this.left+this.width/2){var f=this.left-3;0<d&&(f=this.left-1-c.groupindentwidth/6);c.dropline.css("left",f);c.dropline.css("top",this.top);c.dropline.height(this.height);c.dropline.fadeIn("slow");e={index:d,position:"before"};c.rtl&&(e={index:c.groupheadersbounds.length-1-d,position:"before"});return!1}b>=this.left+this.width/2&&(c.dropline.css("left",1+this.left+this.width),c.dropline.css("top",this.top),c.dropline.height(this.height),c.dropline.fadeIn("slow"),
        e={index:d,position:"after"},c.rtl&&(e={index:c.groupheadersbounds.length-1-d,position:"after"}))});return e},_handlegroupstocolumnsdragdrop:function(b,c){this.dragmousedownoffset=this.dragmousedown=null;this.dragstarted=!1;this.dragcolumn=null;var e=this,f,g="mousedown",h="mousemove",k=!1;this.isTouchDevice()&&!0!==this.touchmode&&(k=!0,g=d.jqx.mobile.getTouchEventName("touchstart"),h=d.jqx.mobile.getTouchEventName("touchmove"));this.addHandler(c,"dragstart",function(b){return!1});this.addHandler(c,
        g,function(b){if(!e.showgroupsheader)return!0;var c=b.pageX,f=b.pageY;e.__drag=!0;e.dragmousedown={left:c,top:f};k&&(f=e.getTouches(b)[0],c=f.pageX,f=f.pageY,e.dragmousedown={left:c,top:f},b.preventDefault&&b.preventDefault());b=d(b.target).coord();e.dragmousedownoffset={left:parseInt(c)-parseInt(b.left),top:parseInt(f-b.top)}});this.addHandler(c,h,function(g){if(!e.showgroupsheader)return!0;if(e.dragmousedown){f={left:g.pageX,top:g.pageY};if(k){var h=e.getTouches(g)[0];f={left:h.pageX,top:h.pageY}}!e.dragstarted&&
    null==e.dragcolumn&&(h=Math.abs(f.top-e.dragmousedown.top),3<Math.abs(f.left-e.dragmousedown.left)||3<h)&&(e._createdragcolumn(c,f,!0),d(document.body).addClass("jqx-disableselect"),d.data(e.dragcolumn[0],"datarecord",b),g.preventDefault&&g.preventDefault())}},{passive:!1})},_createdragcolumn:function(b,c,e){this.dragcolumn=d("<div></div>");var f=b.clone();this.dragcolumn.css("z-index",999999);f.css("border-width","1px");f.css("opacity","0.4");var g=d(f.find("."+this.toThemeProperty("jqx-grid-column-menubutton")));
        0<g.length&&g.css("display","none");g=d(f.find(".jqx-icon-close"));0<g.length&&g.css("display","none");this.dragcolumnicon=d('<div style="z-index: 9999; position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -7px;"></div>');this.dragcolumnicon.addClass(this.toThemeProperty("jqx-grid-drag-icon"));this.dragcolumn.css("float","left");this.dragcolumn.css("position","absolute");this.host.coord();f.width(b.width()+16);this.dragcolumn.append(f);this.dragcolumn.height(b.height());this.dragcolumn.width(f.width());
        this.dragcolumn.append(this.dragcolumnicon);d(document.body).append(this.dragcolumn);f.css("margin-left",0);f.css("left",0);f.css("top",0);this.dragcolumn.css("left",c.left+this.dragmousedown.left);this.dragcolumn.css("top",c.top+this.dragmousedown.top);void 0!=e&&e&&(this.dropline=d('<div style="display: none; position: absolute;"></div>'),this.dropline.width(2),this.dropline.addClass(this.toThemeProperty("jqx-grid-group-drag-line")),d(document.body).append(this.dropline))},iscolumngroupable:function(b){return this._getcolumnproperty(b,
        "groupable")},_handlecolumnstogroupsdragdrop:function(b,c){this.dragmousedownoffset=this.dragmousedown=null;this.dragstarted=!1;this.dragcolumn=null;var e=this,f=!1;this.isTouchDevice()&&!0!==this.touchmode&&(f=!0);var g="mousedown.drag";var h="mousemove.drag";f?(g=d.jqx.mobile.getTouchEventName("touchstart")+".drag",h=d.jqx.mobile.getTouchEventName("touchmove")+".drag"):this.addHandler(c,"dragstart",function(b){return!1});this.addHandler(c,g,function(g){if(!e.showgroupsheader)return!0;e.__drag=!0;
        if(e._isColumnInGroups(b.displayfield))return c.css("cursor"),!0;if(0==b.groupable)return!0;var h=g.pageX,k=g.pageY;f&&(k=e.getTouches(g)[0],h=k.pageX,k=k.pageY);e.dragmousedown={left:h,top:k};f&&g.preventDefault&&g.preventDefault();g=d(g.target).coord();e.dragmousedownoffset={left:parseInt(h)-parseInt(g.left),top:parseInt(k-g.top)}});this.addHandler(c,h,function(g){if(!e.showgroupsheader)return!0;if(e._isColumnInGroups(b.displayfield))return c.css("cursor"),!0;if(e.dragmousedown){var k=g.pageX,m=
        g.pageY;f&&(m=e.getTouches(g)[0],k=m.pageX,m=m.pageY);h={left:k,top:m};!e.dragstarted&&null==e.dragcolumn&&(k=Math.abs(h.top-e.dragmousedown.top),3<Math.abs(h.left-e.dragmousedown.left)||3<k)&&(e._createdragcolumn(c,h,!0),d.data(e.dragcolumn[0],"datarecord",b.displayfield),g.preventDefault&&g.preventDefault())}})},_rendergroupcolumn:function(b,c){var e=d('<div style="float: left; position: relative;"></div>');this.rtl&&e.css("float","right");null!=this.groupcolumnrenderer&&(e[0].innerHTML=this.groupcolumnrenderer(b),
        e.addClass(this.toThemeProperty("jqx-grid-group-column")),e.addClass(this.toThemeProperty("jqx-fill-state-normal")));if(this.closeablegroups){""==e[0].innerHTML&&(e[0].innerHTML='<a style="float: left;" href="#">'+b+"</a>");this.rtl&&(e[0].innerHTML='<a style="float: right;" href="#">'+b+"</a>");b=this.rtl?"left":"right";var f='<div style="float: '+b+'; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
        this.toThemeProperty("jqx-icon-close")+'"></div></div>';d.jqx.browser.msie&&8>d.jqx.browser.version&&(f='<div style="float: left; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>');this.rtl&&(f='<div style="float: '+b+'; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
        this.toThemeProperty("jqx-icon-close")+'"></div></div>',d.jqx.browser.msie&&8>d.jqx.browser.version&&(f='<div style="float: left; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>'));e[0].innerHTML+=f}else""==e[0].innerHTML&&(e[0].innerHTML='<a href="#">'+b+"</a>");this.sortable&&(b=d('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
        this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),f=d('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'),this.closeablegroups&&(b=d('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -32px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
        this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),f=d('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -32px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>')),this.rtl&&(b=d('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 0px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
        this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),f=d('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 0px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'),this.closeablegroups&&(b=d('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
        this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),f=d('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'))),b.css("display","none"),f.css("display","none"),d.jqx.browser.msie&&8>d.jqx.browser.version&&(b.css("float","left"),f.css("float","left")),e.append(b),
        e.append(f),d.data(document.body,"groupsortelements"+c,{sortasc:b,sortdesc:f}));e.addClass(this.toThemeProperty("jqx-fill-state-normal"));e.addClass(this.toThemeProperty("jqx-grid-group-column"));return e},_rendergroup:function(b,c,e,f,g,h,k){f=c.cells[e.level];this.rtl&&(f=c.cells[c.cells.length-1-e.level]);var l=this._findgroupstate(e.uniqueid);if(0<e.bounddata.subGroups.length||0<e.bounddata.subItems.length)g=this.rtl?"-rtl":"",h=this.toThemeProperty("jqx-icon-arrow-right"),g&&(h=this.toThemeProperty("jqx-icon-arrow-left")),
        f.className=l?f.className+(" "+this.toThemeProperty("jqx-grid-group-expand"+g)+" "+this.toThemeProperty("jqx-icon-arrow-down")):f.className+(" "+this.toThemeProperty("jqx-grid-group-collapse"+g)+" "+h);g=this._getColumnText(this.groups[e.level]).label;f=this.groupindentwidth;var m=this.rowdetails&&this.showrowdetailscolumn?(1+b)*f:b*f,p=k-m;h=e.level+1;this.rtl&&(h=0);b=c.cells[h];for(m=2;void 0!=b&&"none"==b.style.display&&m<c.cells.length-1;)b=c.cells[h+m-1],m++;h=d(b);if(b){b.style.width=parseInt(p)+
        "px";-1!=b.className.indexOf("jqx-grid-cell-filter")&&h.removeClass(this.toThemeProperty("jqx-grid-cell-filter"));-1!=b.className.indexOf("jqx-grid-cell-sort")&&h.removeClass(this.toThemeProperty("jqx-grid-cell-sort"));-1!=b.className.indexOf("jqx-grid-cell-pinned")&&h.removeClass(this.toThemeProperty("jqx-grid-cell-pinned"));if(null!=this.groupsrenderer)if(p={group:e.group,level:e.level,parent:e.bounddata.parentItem,subGroups:e.bounddata.subGroups,subItems:e.bounddata.subItems,groupcolumn:this._getColumnText(this.groups[e.level]).column},
        l=this.groupsrenderer(g+": "+e.group,e.group,l,p))b.innerHTML=l;else{l=0<e.bounddata.subItems.length?e.bounddata.subItems.length:e.bounddata.subGroups.length;if(this.showgroupaggregates)for(p=0<e.bounddata.subItems.length?e.bounddata.subItems:e.bounddata.subGroups,m=l=0;m<p.length;m++)p[m].totalsrow||l++;b.innerHTML='<div class="'+this.toThemeProperty("jqx-grid-groups-row")+'" style="position: absolute;"><span>'+g+': </span><span class="'+this.toThemeProperty("jqx-grid-groups-row-details")+'">'+e.group+
        " ("+l+")</span></div>"}else{var r=this._getcolumnbydatafield(this.groups[e.level]),t=e.group;if(null!=r){r.cellsformat&&d.jqx.dataFormat&&(d.jqx.dataFormat.isDate(t)?t=d.jqx.dataFormat.formatdate(t,r.cellsformat,this.gridlocalization):d.jqx.dataFormat.isNumber(t)&&(t=d.jqx.dataFormat.formatnumber(t,r.cellsformat,this.gridlocalization)));l=0<e.bounddata.subItems.length?e.bounddata.subItems.length:e.bounddata.subGroups.length;if(this.showgroupaggregates)for(p=0<e.bounddata.subItems.length?e.bounddata.subItems:
        e.bounddata.subGroups,m=l=0;m<p.length;m++)p[m].totalsrow||l++;b.innerHTML='<div class="'+this.toThemeProperty("jqx-grid-groups-row")+'" style="position: absolute;"><span>'+g+': </span><span class="'+this.toThemeProperty("jqx-grid-groups-row-details")+'">'+t+" ("+l+")</span></div>"}else throw Error("jqxGrid: Unable to find '"+this.groups[e.level]+"' group in the Grid's columns collection.");}this.rtl&&(r||(r=this._getcolumnbydatafield(this.groups[e.level])),g="hidden"==this.hScrollBar.css("visibility")?
        0:this.hScrollInstance.max-this.hScrollInstance.value,l="hidden"==this.vScrollBar.css("visibility")?0:this.scrollbarsize+6,m=this.rowdetails&&this.showrowdetailscolumn?(2+e.level)*f:(1+e.level)*f,b.style.width=k+parseInt(g)-m-l+"px",h.addClass(this.toThemeProperty("jqx-rtl")),f=d(c.cells[c.cells.length-1]).css("z-index"),h.css("z-index",f),f=h.find("div"),p=f.width(),f.css("left","100%"),c=null!=this.columns.records[c.cells.length-2-e.level]?this.columns.records[c.cells.length-2-e.level].pinned:!1,
    this.table.width()<k&&(k=this.table.width(),"hidden"!=this.vScrollBar.css("visibility")&&(k+=this.vScrollBar.outerWidth())),r.pinned||c?(this.rowdetails&&this.showrowdetailscolumn&&(k+=30),f.css("margin-left",-p),b.style.width=k+g-m-l+"px"):(g="hidden"==this.hScrollBar.css("visibility")?0:this.hScrollInstance.max,b.style.width=k+g-m-l+"px",p=f.width(),f.css("margin-left",-p)))}}})})(jqxBaseFramework);
(function(d){d.extend(d.jqx._jqxGrid.prototype,{autoresizecolumns:function(b,c){"cells"!=b&&"all"!=b&&"column"!=b&&(b="all");var e=this.that,f=this.getrows();this.pageable&&(f=this.dataview.rows,this.groupable&&(f=this.dataview.records));c=void 0==c?0:parseInt(c);var g=f.length;if(void 0==g&&void 0!=f){var h=[];d.each(f,function(b){h.push(this)});f=h;g=f.length}var k=d("<span></span>");k.addClass(this.toThemeProperty("jqx-widget"));k.addClass(this.toThemeProperty("jqx-grid-cell"));d(document.body).append(k);
        var l=[],m=[],p=[],r=[],t=e.host.width();"hidden"!=e.vScrollBar[0].style.visibility&&(t-=this.scrollbarsize+5);0>t&&(t=0);for(var w=0;w<g;w++){var q=f[w];for(t=0;t<this.columns.records.length;t++){var u=this.columns.records[t];if(!(u.hidden||0<this.groups.length&&t<=this.groups.length-1)){void 0==m[u.displayfield]&&(m[u.displayfield]=0);void 0==p[u.displayfield]&&(p[u.displayfield]="");var y=q[u.displayfield];""!=u.cellsformat?d.jqx.dataFormat&&(d.jqx.dataFormat.isDate(y)?y=d.jqx.dataFormat.formatdate(y,
            u.cellsformat,this.gridlocalization):d.jqx.dataFormat.isNumber(y)&&(y=d.jqx.dataFormat.formatnumber(y,u.cellsformat,this.gridlocalization))):u.cellsrenderer&&(l=e._defaultcellsrenderer(y,u),l=u.cellsrenderer(w,u.datafield,y,l,u.getcolumnproperties(),q),void 0!=l&&(y=d(l).text()));if((void 0==b||"cells"==b||"all"==b)&&null!=y){l=y.toString().length;var z=y.toString();z=z.replace(/[^A-Z]/g,"").length;l>m[u.displayfield]&&(m[u.displayfield]=l,p[u.displayfield]=y,r[u.displayfield]=z);if(0<l&&l>=z){var A=
            20*z+15*(l-z),C=20*r[u.displayfield]+15*(m[u.displayfield]-r[u.displayfield]);A>C&&0<A&&0<C&&(m[u.displayfield]=l,p[u.displayfield]=y,r[u.displayfield]=z)}}if("column"==b||"all"==b)u.text.toString().length>m[u.displayfield]&&(p[u.displayfield]=u.text,m[u.displayfield]=u.text.length,z=u.text.toString(),z=z.replace(/[^A-Z]/g,"").length,r[u.displayfield]=z),y=u.text,l=y.toString().length,z=y.toString(),z=z.replace(/[^A-Z]/g,"").length,0<l&&l>=z&&(A=20*z+15*(l-z),C=20*r[u.displayfield]+15*(m[u.displayfield]-
            r[u.displayfield]),A>C&&0<A&&0<C&&(m[u.displayfield]=l,p[u.displayfield]=y,r[u.displayfield]=z))}}}if(this.columns.records){for(t=0;t<this.columns.records.length;t++)if(u=this.columns.records[t],u.displayfield&&(void 0==p[u.displayfield]&&(p[u.displayfield]=u.text),0<=k[0].className.indexOf("jqx-grid-column-header")&&k.removeClass(this.toThemeProperty("jqx-grid-column-header")),p[u.displayfield]==u.text&&k.addClass(this.toThemeProperty("jqx-grid-column-header")),k[0].innerHTML=p[u.displayfield].toString(),
            b=k.outerWidth()+10,0<k.children().length&&(b=k.children().outerWidth()+10),d.jqx.browser.msie&&8>d.jqx.browser.version&&(b+=10),this.filterable&&this.showfilterrow&&(b+=5),b+=c,b>u.maxwidth&&(b=u.maxwidth),void 0!=u._width&&(u.__width=u._width),u._width=null,"auto"==u.maxwidth||b<=u.maxwidth))e=u.width,b<u.minwidth&&(b=u.minwidth),u.width=b,void 0!=u._percentagewidth&&(u._percentagewidth=null),this._raiseEvent(14,{columntext:u.text,column:u.getcolumnproperties(),datafield:u.datafield,displayfield:u.displayfield,
            oldwidth:e,newwidth:b});k.remove();this._updatecolumnwidths();this._updatecellwidths();this._renderrows(this.virtualsizeinfo);for(t=0;t<this.columns.records.length;t++)u=this.columns.records[t],void 0!=u.__width&&(u._width=u.__width)}},autoresizecolumn:function(b,c,e){"cells"!=c&&"all"!=c&&"column"!=c&&(c="all");if(void 0==b)return!1;var f=this.getrows();this.pageable&&(f=this.dataview.rows,this.groupable&&(f=this.dataview.records));var g=this.getcolumn(b);if(void 0==g)return!1;e=void 0==e?0:parseInt(e);
        var h=f.length,k=d("<span></span>");k.addClass(this.toThemeProperty("jqx-widget"));k.addClass(this.toThemeProperty("jqx-grid-cell"));d(document.body).append(k);var l=0,m="",p=0;this.that.host.width();if(void 0==c||"cells"==c||"all"==c)for(var r=0;r<h;r++){var t=f[r][g.displayfield];if(""!=g.cellsformat)d.jqx.dataFormat&&(d.jqx.dataFormat.isDate(t)?t=d.jqx.dataFormat.formatdate(t,g.cellsformat,this.gridlocalization):d.jqx.dataFormat.isNumber(t)&&(t=d.jqx.dataFormat.formatnumber(t,g.cellsformat,this.gridlocalization)));
        else if(g.cellsrenderer){var w=g.cellsrenderer(r,g,t);void 0!=w&&(t=d(w).text())}if(null!=t){w=t.toString().length;var q=t.toString();q=q.replace(/[^A-Z]/g,"").length;w>l&&(l=w,m=t,p=q);if(0<w&&w>=q){var u=20*q+15*(w-q),y=20*p+15*(l-p);u>y&&0<u&&0<y&&(l=w,m=t,p=q)}}}if("column"==c||"all"==c)g.text.toString().length>l&&(m=g.text),t=g.text.toString(),w=t.toString().length,q=t.toString(),q=q.replace(/[^A-Z]/g,"").length,0<w&&w>=q&&(u=20*q+15*(w-q),y=20*p+15*(l-p),u>y&&0<u&&0<y&&(m=t));void 0==m&&(m=
            g.text);k[0].innerHTML=m;m==g.text&&k.addClass(this.toThemeProperty("jqx-grid-column-header"));c=k.outerWidth()+10;d.jqx.browser.msie&&8>d.jqx.browser.version&&(c+=5);this.filterable&&this.showfilterrow&&(c+=5);c+=e;k.remove();c>g.maxwidth&&(c=g.maxwidth);if("auto"==g.maxwidth||c<=g.maxwidth)e=g.width,c<g.minwidth&&(c=g.minwidth),g.width=c,void 0!=g._width&&(g.__width=g._width),g._width=null,void 0!=g._percentagewidth&&(g._percentagewidth=null),this._updatecolumnwidths(),this._updatecellwidths(),
            this._raiseEvent(14,{columntext:g.text,column:g.getcolumnproperties(),datafield:b,displayfield:g.displayfield,oldwidth:e,newwidth:c}),this._renderrows(this.virtualsizeinfo),void 0!=g._width&&(g._width=g.__width)},_handlecolumnsresize:function(){var b=this.that;if(this.columnsresize){var c=!1;b.isTouchDevice()&&!0!==b.touchmode&&(c=!0);var e="mousemove.resize"+this.element.id,f="mousedown.resize"+this.element.id,g="mouseup.resize"+this.element.id;c&&(e=d.jqx.mobile.getTouchEventName("touchmove")+".resize"+
        this.element.id,f=d.jqx.mobile.getTouchEventName("touchstart")+".resize"+this.element.id,g=d.jqx.mobile.getTouchEventName("touchend")+".resize"+this.element.id);this.removeHandler(d(document),e);this.addHandler(d(document),e,function(e){if(null!=d.data(document.body,"contextmenu"+b.element.id)&&b.autoshowcolumnsmenubutton)return!0;if(null!=b.resizablecolumn&&!b.disabled&&b.resizing&&null!=b.resizeline){var f=b.host.coord(),g=parseInt(b.resizestartline.coord().left),h=g-b._startcolumnwidth,k=b.resizablecolumn.column.minwidth;
        k="auto"==k?0:parseInt(k);var t=b.resizablecolumn.column.maxwidth;t="auto"==t?0:parseInt(t);var w=e.pageX;c&&(w=b.getTouches(e)[0].pageX);h+=k;k=0<t?g+t:0;g=0==t?!0:b._startcolumnwidth+w-g<t?!0:!1;b.rtl&&(g=!0);if(g)if(!b.rtl){if(w>=f.left&&w>=h&&(0!=k&&e.pageX<k?b.resizeline.css("left",w):0==k&&b.resizeline.css("left",w),c))return!1}else if(w>=f.left&&w<=f.left+b.host.width()&&(b.resizeline.css("left",w),c))return!1}if(!c&&null!=b.resizablecolumn)return!1});this.removeHandler(d(document),f);this.addHandler(d(document),
        f,function(c){if(null!=d.data(document.body,"contextmenu"+b.element.id)&&b.autoshowcolumnsmenubutton)return!0;if(null!=b.resizablecolumn&&!b.disabled){var e=b.resizablecolumn.columnelement;if(e.coord().top+e.height()+5<c.pageY)b.resizablecolumn=null;else if(e.coord().top-5>c.pageY)b.resizablecolumn=null;else{b._startcolumnwidth=b.resizablecolumn.column.width;b.resizablecolumn.column._width=null;d(document.body).addClass("jqx-disableselect");d(document.body).addClass("jqx-position-reset");b.host.addClass("jqx-disableselect");
            b.content.addClass("jqx-disableselect");b._mouseDownResize=new Date;b.resizing=!0;if(b._lastmouseDownResize&&b.columnsautoresize&&300>b._lastmouseDownResize-b._mouseDownResize&&-500<b._lastmouseDownResize-b._mouseDownResize&&(e=b.resizablecolumn.column,e.resizable)){var f=b.hScrollBar[0].style.visibility;b._resizecolumn=null;b.resizeline.hide();b.resizestartline.hide();b.resizebackground.remove();b.resizablecolumn=null;b.columndragstarted=!1;b.dragmousedown=null;b.__drag=!1;b.autoresizecolumn(e.displayfield,
                "all");f!=b.hScrollBar[0].style.visibility&&b.hScrollInstance.setPosition(0);b.rtl&&b._arrange();b.autosavestate&&b.savestate&&b.savestate();c.stopPropagation();b.suspendClick=!0;setTimeout(function(){b.suspendClick=!1},100);return!1}b._lastmouseDownResize=new Date;b._resizecolumn=b.resizablecolumn.column;b.resizeline=b.resizeline||d('<div style="position: absolute;"></div>');b.resizestartline=b.resizestartline||d('<div style="position: absolute;"></div>');b.resizebackground=b.resizebackground||d('<div style="position: absolute; left: 0; top: 0; background: #000;"></div>');
            b.resizebackground.css("opacity",.01);b.resizebackground.css("cursor","col-resize");b.resizeline.css("cursor","col-resize");b.resizestartline.css("cursor","col-resize");b.resizeline.addClass(b.toThemeProperty("jqx-grid-column-resizeline"));b.resizestartline.addClass(b.toThemeProperty("jqx-grid-column-resizestartline"));d(document.body).append(b.resizeline);d(document.body).append(b.resizestartline);d(document.body).append(b.resizebackground);var g=b.resizablecolumn.columnelement.coord();b.resizebackground.css("left",
                b.host.coord().left);b.resizebackground.css("top",b.host.coord().top);b.resizebackground.width(b.host.width());b.resizebackground.height(b.host.height());b.resizebackground.css("z-index",9999);c=function(c){b.rtl?c.css("left",parseInt(g.left)):c.css("left",parseInt(g.left)+b._startcolumnwidth);var e=b._groupsheader()?b.groupsheader.height():0;e=e+(b.showtoolbar?b.toolbarheight:0)+(b.showstatusbar?b.statusbarheight:0);var d=0;b.pageable&&(d=b.pagerheight);var f="visible"==b.hScrollBar.css("visibility")?
                17:0;c.css("top",parseInt(g.top));c.css("z-index",99999);b.columngroups?c.height(b.host.height()+b.resizablecolumn.columnelement.height()-d-e-f-b.columngroupslevel*b.columnsheight):c.height(b.host.height()-d-e-f);b.enableanimations?c.show("fast"):c.show()};c(b.resizeline);c(b.resizestartline);b.dragmousedown=null}}});var h=function(){d(document.body).removeClass("jqx-disableselect");d(document.body).removeClass("jqx-position-reset");if(b.showfilterrow||b.showstatusbar||b.showtoolbar||b.enablebrowserselection)b.host.removeClass("jqx-disableselect"),
        b.content.removeClass("jqx-disableselect");if(b.resizing)if(b._mouseUpResize=new Date,200>b._mouseUpResize-b._mouseDownResize)b.resizing=!1,null!=b._resizecolumn&&null!=b.resizeline&&"block"==b.resizeline.css("display")&&(b._resizecolumn=null,b.resizeline.hide(),b.resizestartline.hide(),b.resizebackground.remove());else if(b.resizing=!1,!b.disabled){var c=b.host.width();"hidden"!=b.vScrollBar[0].style.visibility&&(c-=20);0>c&&(c=0);if(null!=b._resizecolumn&&null!=b.resizeline&&"block"==b.resizeline.css("display")){var e=
        parseInt(b.resizeline.css("left")),f=parseInt(b.resizestartline.css("left")),g=b._startcolumnwidth+e-f;b.rtl&&(g=b._startcolumnwidth-e+f);e=b._resizecolumn.width;b._closemenu();g<b._resizecolumn.minwidth&&(g=b._resizecolumn.minwidth);b._resizecolumn.width=g;void 0!=b._resizecolumn._percentagewidth&&(b._resizecolumn._percentagewidth=g/c*100);for(c=0;c<b._columns.length;c++)if(b._columns[c].datafield===b._resizecolumn.datafield){b._columns[c].width=b._resizecolumn.width;b._columns[c].width<b._resizecolumn.minwidth&&
    (b._columns[c].width=b._resizecolumn.minwidth);break}c=b.hScrollBar[0].style.visibility;b._updatecolumnwidths();b._updatecellwidths();b._raiseEvent(14,{columntext:b._resizecolumn.text,column:b._resizecolumn.getcolumnproperties(),datafield:b._resizecolumn.datafield,oldwidth:e,newwidth:g});b._renderrows(b.virtualsizeinfo);b.autosavestate&&b.savestate&&b.savestate();c!=b.hScrollBar[0].style.visibility&&b.hScrollInstance.setPosition(0);b.rtl&&b._arrange();b._resizecolumn=null;b.resizeline.hide();b.resizestartline.hide();
        b.resizebackground.remove()}b.resizablecolumn=null}};try{if(""!=document.referrer||window.frameElement)e=null,null!=window.top&&window.top!=window.self&&window.parent&&document.referrer&&(e=document.referrer),e&&-1!=e.indexOf(document.location.host)&&(e=function(b){h()},window.top.document.addEventListener?window.top.document.addEventListener("mouseup",e,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",e))}catch(k){}this.removeHandler(d(document),g);this.addHandler(d(document),
        g,function(c){if(null!=d.data(document.body,"contextmenu"+b.element.id)&&b.autoshowcolumnsmenubutton)return!0;h()})}}})})(jqxBaseFramework);
(function(d){d.jqx.dataview.sort=function(){this.sortby=function(b,c,e){var f=Object.prototype.toString;if(null==c&&(this.sortdata=null,"many"!==this.grid.sortmode?this.sortcache={}:this.sortcache[b]&&delete this.sortcache[b],this.grid._pagescache=[],this.grid._cellscache=[],"many"!==this.grid.sortmode)){this.refresh();return}"many"===this.grid.sortmode&&(this.grid._pagescache=[],this.grid._cellscache=[]);null!=c&&(c="a"==c||"asc"==c||"ascending"==c||1==c?!0:!1);var g=b;this.sortfield=b;this.sortfielddirection=
    c?"asc":"desc";null==c&&(this.sortfielddirection=null);void 0==this.sortcache&&(this.sortcache={});this.sortdata=[];var h=[],k=!1;"constructor"==g&&(g="");if(!this.virtualmode&&null!=this.sortcache[g]&&"many"!==this.grid.sortmode){var l=this.sortcache[g];h=l._sortdata;l.direction==c?h.reverse():(!l.direction&&c&&h.reverse(),k=!0);h.length<this.totalrecords&&(this.sortcache={},k=!1,h=[])}Object.prototype.toString="function"==typeof b?b:function(){return this[b]};var m=this.records,p="";this.source.datafields&&
d.each(this.source.datafields,function(){if(this.name==b)return this.type&&(p=this.type),!1});if(0==h.length)if(m.length)for(var r=m.length,t=0;t<r;t++)l=m[t],null!=l&&h.push({sortkey:l.toString(),value:l,index:t});else{t=!1;for(r in m){l=m[r];if(void 0==l){t=!0;break}h.push({sortkey:l.toString(),value:l,index:r})}t&&d.each(m,function(b,c){h.push({sortkey:c.toString(),value:c,index:b})})}if(!k)if(null==e){this._sortcolumntype=p;var w=this;h.sort(function(b,c){return w._compare(b,c,p)})}else h.sort(e);
    c||h.reverse();Object.prototype.toString=f;this.sortdata=h;null!==c&&(this.sortcache[g]={_sortdata:h,direction:c,dataType:this._sortcolumntype,dataField:g});if("many"===this.grid.sortmode){c=[];e=[];f=[];for(var q in this.sortcache)"data"!==q&&(l=this.sortcache[q],c.push(l.dataField),e.push(l.direction?"asc":"desc"),f.push(l.dataType));if(0<c.length)m=this.multiSort(m,c,e,f),h=[],d.each(m,function(b,c){h.push({sortkey:g,value:c,index:c.boundindex})}),this.sortdata=h;else{this.sortcache={};this.sortdata=
        null;this.refresh();return}}this.reload(this.records,this.rows,this.filters,this.updated,!0)};this.multiSort=function(b,c,e,f,g){if(0!==b.length){for(var h=[],k=0;k<b.length;k++){var l=d.extend({},b[k]);h.push(l)}k=!1;h&&h.constructor&&"ObservableArray"===h.constructor.name&&(k=!0);if((!(h&&h instanceof Array&&0!==h.length&&c)||c instanceof Array&&0===c.length)&&!k)throw Error("sort: Missing or Invalid arguments!");"string"===typeof c&&(c=[c]);var m=[],p=[];void 0===e&&(e=[]);b=function(b,c){switch(c||
typeof b){default:var e=(new Intl.Collator).compare;break;case "date":case "time":case "datetime":case "number":case "int":case "float":e=function(b,c){return b-c};break;case "boolean":e=function(b,c){return b===c?0:!1===b?-1:1};break;case "object":b instanceof Date&&(e=function(b,c){return b.getTime()-c.getTime()})}return e};for(k=0;k<c.length;k++)m[k]=void 0===e[k]||"asc"===e[k]||"ascending"===e[k]?1:-1,p[k]=b(h[0][c[k]],f[k]);if(g)g(h,c,e,p);else return h.sort(function(b,e){for(var d=0;d<c.length;d++){var f=
    p[d](b[c[d]],e[c[d]]);if(0===f){if(c[d+1])continue;else if(void 0!==b._index)return(b._index-e._index)*m[d];return 0}return f*m[d]}if(0===c.length)return b.boundIndex<e.boundIndex?-1:b.boundIndex>e.boundIndex?1:0}),h}};this.clearsortdata=function(){this.sortcache={};this.sortdata=null};this._compare=function(b,c,e){b=b.sortkey;c=c.sortkey;void 0===b&&(b=null);void 0===c&&(c=null);if(null===b&&null===c)return 0;if(null===b&&null!==c)return-1;if(null!==b&&null===c)return 1;if(d.jqx.dataFormat)if(e&&
    ""!=e)switch(e){case "string":case "text":b=String(b).toLowerCase(),c=String(c).toLowerCase()}else{if(d.jqx.dataFormat.isNumber(b)&&d.jqx.dataFormat.isNumber(c)||d.jqx.dataFormat.isDate(b)&&d.jqx.dataFormat.isDate(c))return b<c?-1:b>c?1:0;d.jqx.dataFormat.isNumber(b)||d.jqx.dataFormat.isNumber(c)||(b=String(b).toLowerCase(),c=String(c).toLowerCase())}return b<c?-1:b>c?1:0};this._equals=function(b,c){return 0===this._compare(b,c)}};d.extend(d.jqx._jqxGrid.prototype,{_rendersortcolumn:function(){var b=
        this.that,c=this.getsortcolumn();if("many"===this.sortmode){this.__columnsbydatafield=[];var e=this.getsortcolumns();d.each(this.columns.records,function(b,c){d(this.sortasc).hide();d(this.sortdesc).hide();d(this.sorticon).css("visibility","hidden");this.element.removeAttribute("sort")});if(0<e.length)for(var f=0;f<e.length;f++){var g=e[f],h=this._getcolumnbydatafield(g.dataField);h.element.setAttribute("sort",!0);b.isMaterialized()||b.isModern()?(d(h.sorticon).show(),d(h.sorticon).css("visibility",
        "inherit"),d(h.sorticon).removeClass("ascending"),d(h.sorticon).removeClass("descending"),g.ascending?d(h.sorticon).addClass("ascending"):d(h.sorticon).addClass("descending")):g.ascending?(d(h.sortasc).show(),d(h.sortdesc).hide()):!1===g.ascending&&(d(h.sortasc).hide(),d(h.sortdesc).show())}}else this.sortdirection&&(e=function(c,e){(c=b.getcolumn(c))&&(e.ascending?d.jqx.aria(c.element,"aria-sort","ascending"):e.descending?d.jqx.aria(c.element,"aria-sort","descending"):d.jqx.aria(c.element,"aria-sort",
        "none"))},this._oldsortinfo&&this._oldsortinfo.column&&e(this._oldsortinfo.column,{ascending:!1,descending:!1}),e(c,this.sortdirection)),this._oldsortinfo={column:c,direction:this.sortdirection},this.sortdirection&&d.each(this.columns.records,function(e,f){e=d.data(document.body,"groupsortelements"+this.displayfield);null==c||this.displayfield!=c?(d(this.sortasc).hide(),d(this.sortdesc).hide(),d(this.sorticon).css("visibility","hidden"),d(this.sorticon).removeClass("ascending"),d(this.sorticon).removeClass("descending"),
        this.element.removeAttribute("sort"),null!=e&&(e.sortasc.hide(),e.sortdesc.hide())):(b.isMaterialized()||b.isModern()?(d(this.sortasc).hide(),d(this.sortdesc).hide(),d(this.sorticon).show(),d(this.sorticon).css("visibility","inherit"),null!=e&&(e.sortasc.hide(),e.sortdesc.show()),d(this.sorticon).removeClass("ascending"),d(this.sorticon).removeClass("descending"),b.sortdirection.ascending?d(this.sorticon).addClass("ascending"):d(this.sorticon).addClass("descending")):b.sortdirection.ascending?(d(this.sortasc).show(),
        d(this.sortdesc).hide(),null!=e&&(e.sortasc.show(),e.sortdesc.hide())):(d(this.sortasc).hide(),d(this.sortdesc).show(),null!=e&&(e.sortasc.hide(),e.sortdesc.show())),this.element.setAttribute("sort",!0))})},getsortcolumns:function(){var b=[];for(e in this.dataview.sortcache)"data"!==e&&b.push({dataField:e,ascending:this.dataview.sortcache[e].direction});if(0===b.length)for(var c in this.sortcolumns){var e=this.sortcolumns[c];null!==e&&b.push({dataField:c,ascending:e})}return b},getsortcolumn:function(){return void 0!=
    this.sortcolumn?this.sortcolumn:null},removesort:function(){this.sortby(null);if("many"===this.sortmode)for(var b in this.sortcolumns)this.sortby(b,null)},sortby:function(b,c,e,d,g){if(this._loading&&!1!==g)throw Error("jqxGrid: "+this.loadingerrormessage);null==b&&(c=null,b=this.sortcolumn);if(void 0!=b){g=this.that;void 0==e&&g.source&&null!=g.source.sortcomparer&&(e=g.source.sortcomparer);void 0===c&&(c=!0);var f="a"==c||"asc"==c||"ascending"==c||1==c?!0:!1;g.sortdirection=null!=c?{ascending:f,
        descending:!f}:{ascending:!1,descending:!1};g.sortcolumn=null!=c?b:null;g.sortcolumns||(g.sortcolumns=[]);g.sortcolumns[b]=c;if(g.source&&(g.source.sort||g.virtualmode)){if(g.dataview.sortfield=b,g.dataview.sortfielddirection=null==c?"":f?"asc":"desc",g.source.sort&&!this._loading){g.source.sort(b,c,g.sortcolumns);g._raiseEvent(6,{sortinformation:g.getsortinformation()});return}}else g.dataview.sortby(b,c,e);!1!==d&&(g.groupable&&0<g.groups.length?(g._render(!0,!1,!1),g._updategroupheadersbounds&&
    g.showgroupsheader&&g._updategroupheadersbounds()):(g.pageable&&g.dataview.updateview(),g._updaterowsproperties(),g.rendergridcontent(!0)),g._postrender("sort"),g._raiseEvent(6,{sortinformation:g.getsortinformation()}))}},_togglesort:function(b){var c=this.that;if(!this.disabled)if("many"===this.sortmode){if(b.sortable&&c.sortable){for(var e=c.getsortcolumns(),d=0;d<e.length;d++){var g=e[d];if(b.displayfield===g.dataField){e=g.ascending;e=1<c.sorttogglestates?1==e?!1:null:!e;c.sortby(b.displayfield,
        e,null);return}}c.sortby(b.displayfield,!0,null)}}else b.sortable&&c.sortable&&(e=c.getsortinformation(),null!=e.sortcolumn&&e.sortcolumn==b.displayfield?(e=e.sortdirection.ascending,e=1<c.sorttogglestates?1==e?!1:null:!e):e=!0,c.sortby(b.displayfield,e,null))}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxToolBar","",{});d.extend(d.jqx._jqxToolBar.prototype,{defineInstance:function(){var b={width:"100%",minWidth:null,maxWidth:null,height:35,tools:"",initTools:null,minimizeWidth:200,disabled:!1,rtl:!1,events:["open","close"]};if(this===d.jqx._jqxToolBar.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(){if("none"===this.host.css("display")||!1===document.body.contains(this.element))this._initiallyHidden=!0;this._toolToWidgetMapping={button:"jqxButton",
        toggleButton:"jqxToggleButton",dropdownlist:"jqxDropDownList",combobox:"jqxComboBox",input:"jqxInput"};this._toolChanges=[];this.render()},render:function(){var b=!0;this.element.innerHTML="";0<this.element.className.length&&this._removeClass(this.element,this.toThemeProperty("jqx-widget jqx-fill-state-normal jqx-rc-all jqx-toolbar jqx-fill-state-disabled"));this._setSize();this._destroyTools(!1);this._toolWidgets&&(b=!1,d(this._minimizeButton).remove(),d(this._minimizePopup).remove());this._appendMinimizeButton();
        this._addClasses();this._initiallyHidden||this._createTools();!0===this.disabled&&(this.element.className+=" "+this.toThemeProperty("jqx-fill-state-disabled"),this._disableTools(!0));this._initiallyHidden||this._minimize();this._removeHandlers();this._addHandlers();!1===b&&0<this._toolChanges.length&&this._restoreChanges()},refresh:function(b){!0!==b&&this.render()},getTools:function(){return this._toolWidgets},destroy:function(){this._removeHandlers();this._destroyTools();this.host.remove()},_destroyTools:function(b){!1!==
    b&&(b=!0);if(this._toolWidgets)for(var c=this._toolWidgets.length-1;0<=c;c--)this._destroyTool(c,b,!0)},_destroyTool:function(b,c,e){b=parseInt(b,10);var f=this._toolWidgets[b];if(f){var g=f.type,h=f.tool,k=f.menuTool;if("custom"!==g){if(h[this._toolToWidgetMapping[g]]("destroy"),k)k[this._toolToWidgetMapping[g]]("destroy")}else h.remove(),k&&k.remove();f.menuSeparator&&d(f.menuSeparator).remove();this._toolWidgets.splice(b,1);this._checkType(g)&&this._refreshButtonGroups();!0!==e&&this._minimize();
        !1!==c&&this._toolChanges.push({action:"destroyTool",index:b})}},destroyTool:function(b){this._destroyTool(b,!0)},addTool:function(b,c,e,d){var f="first"===c?0:this._toolWidgets.length;if(this._toolWidgets[f-1]){var h=this._toolWidgets[f-1].tool;var k=this._toolWidgets[f-1].separatorAfterWidget?"|":this._toolWidgets[f-1].type}if(!0===e)var l="|";else this._toolWidgets[f+1]&&(l=this._toolWidgets[f+1].type);f=this._initializeTool(f,b,h,k,l,d,!1);"first"===c?this._toolWidgets.splice(0,0,f):this._toolWidgets.push(f);
        this._removeHandlers();this._addHandlers();this._checkType(b)&&this._refreshButtonGroups();"first"!==c&&0<this._minimizedTools?this._minimizeTool(!0):this._minimize();this._toolChanges.push({action:"addTool",type:b,position:c,separator:e,initCallback:d})},_disableTools:function(b){for(var c=0;c<this._toolWidgets.length;c++)this.disableTool(c,b)},disableTool:function(b,c){b=parseInt(b,10);var e=this._toolWidgets[b];if(e){var d=e.type;"custom"!==d&&(e.tool[this._toolToWidgetMapping[d]]({disabled:c}),
        e.menuTool[this._toolToWidgetMapping[d]]({disabled:c}));this._toolChanges.push({action:"disableTool",index:b,disable:c})}},propertyChangedHandler:function(b,c,e,f){if("initTools"!==c&&f!==e)switch(c){case "theme":""!==e&&(b._removeClass(b.element,b.toThemeProperty("jqx-widget-"+e+" jqx-fill-state-normal-"+e+" jqx-rc-all-"+e+" jqx-toolbar-"+e)),b._removeClass(b._minimizePopup,"jqx-popup-"+e+" jqx-fill-state-normal-"+e+" jqx-rc-b-"+e+" jqx-toolbar-minimized-popup-"+e));b._addClasses();b._minimizePopup.className+=
        " "+b.toThemeProperty("jqx-popup jqx-fill-state-normal jqx-rc-b jqx-toolbar-minimized-popup");for(var g=0;g<b._toolWidgets.length;g++)c=b._toolWidgets[g],"custom"!==c.type&&(c.menuTool&&(c.menuSeparator&&(""!==e&&b._removeClass(c.menuSeparator,"jqx-fill-state-pressed-"+e+" jqx-toolbar-minimized-popup-separator-"+e),c.menuSeparator.className+=" jqx-fill-state-pressed-"+f+" jqx-toolbar-minimized-popup-separator-"+f),c.menuTool[b._toolToWidgetMapping[b._toolWidgets[g].type]]({theme:f})),c.tool[b._toolToWidgetMapping[b._toolWidgets[g].type]]({theme:f}));
        d.jqx.utilities.setTheme(e,f,b.host);break;case "width":b.element.style.width=b._toPx(f);b._minimize();break;case "minWidth":b.element.style.minWidth=b._toPx(f);b._minimize();break;case "maxWidth":b.element.style.maxWidth=b._toPx(f);b._minimize();break;case "height":c=!1;b.element.style.height=b._toPx(f);if("string"===typeof f&&-1!==f.indexOf("%")){if("string"===typeof e&&-1!==e.indexOf("%")){b.host.trigger("resize");break}c=!0}else g=parseInt(f,10),g-=b._getComputedStyle(b.element,"paddingTop")+
        b._getComputedStyle(b.element,"paddingBottom")+b._getComputedStyle(b.element,"borderTopWidth")+b._getComputedStyle(b.element,"borderBottomWidth");for(f=0;f<b._toolWidgets.length;f++){e=b._toolWidgets[f];var h=e.type;if("button"===h||"toggleButton"===h||"repeatButton"===h||"linkButton"===h)e.tool[0].style.height=c?"100%":b._toPx(g),e.menuTool&&(e.menuTool[0].style.height=c?"100%":b._toPx(g));else if("dropdownlist"===h||"combobox"===h||"input"===h)if(e.tool[b._toolToWidgetMapping[h]]({height:c?"100%":
            g-2}),e.menuTool)e.menuTool[b._toolToWidgetMapping[h]]({height:c?"100%":g-2})}break;case "tools":b._removeHandlers();b._destroyTools();b._createTools();b._addHandlers();b._minimize();break;case "minimizeWidth":!0===b._isOpen?(g=b._getComputedStyle(b._minimizePopup,"left")-(f-e),b._minimizePopup.style.width=b._toPx(f),b._minimizePopup.style.left=b._toPx(g)):b._minimizePopup.style.width=b._toPx(f);break;case "rtl":b.render();break;case "disabled":!0===f?(b.element.className+=" "+b.toThemeProperty("jqx-fill-state-disabled"),
        b._disableTools(!0)):(b._removeClass(b.element,b.toThemeProperty("jqx-fill-state-disabled")),b._disableTools(!1))}},_raiseEvent:function(b,c){void 0===c&&(c={owner:null});b=this.events[b];c.owner=this;b=new d.Event(b);b.owner=this;b.args=c;b.preventDefault&&b.preventDefault();return this.host.trigger(b)},_addClasses:function(){var b="jqx-widget jqx-fill-state-normal jqx-rc-all jqx-toolbar";!0===this.rtl&&(b+=" jqx-toolbar-rtl");this.element.className+=" "+this.toThemeProperty(b)},_checkType:function(b){return"button"===
    b||"toggleButton"===b||"repeatButton"===b||"linkButton"===b?!0:!1},_refreshButtonGroups:function(){function b(b,e,f,g,h,k){var q=b.tool[0];b=b.menuTool[0];var l={add:"",remove:""};l[e]+=" jqx-toolbar-tool-inner-button";l[f]+=" jqx-rc-all";l[g]+=" jqx-rc-l";l[h]+=" jqx-rc-r";""!==l.add&&(q.className+=" "+c.toThemeProperty(d.trim(l.add)),b&&(b.className+=" "+c.toThemeProperty(d.trim(l.add))));""!==l.remove&&(c._removeClass(q,c.toThemeProperty(d.trim(l.remove))),b&&c._removeClass(b,c.toThemeProperty(d.trim(l.remove))));
        q.style.borderLeftWidth=k+"px";b&&(b.style.borderLeftWidth=k+"px")}for(var c=this,e=0;e<c._toolWidgets.length;e++){var f=c._toolWidgets[e];if(c._checkType(f.type)){var g,h,k=f.tool,l=f.menuTool;0<e&&(g=c._toolWidgets[e-1].separatorAfterWidget?"|":c._toolWidgets[e-1]);f.separatorAfterWidget?h="|":e<c._toolWidgets.length-1&&(h=c._toolWidgets[e+1]);var m=g&&c._checkType(g.type),p=!1===f.separatorAfterWidget&&h&&c._checkType(h.type);m||p?!m&&p?b(f,"remove","remove","add","remove",1):m&&p?b(f,"add","remove",
        "remove","remove",0):m&&!p&&b(f,"remove","remove","remove","add",0):b(f,"remove","add","remove","remove",1);m=c.rtl?"rtl":"ltr";p?(c._removeClass(k[0],c.toThemeProperty("jqx-toolbar-tool-separator-"+m)),c._removeClass(k[0],c.toThemeProperty("jqx-toolbar-tool-no-separator-"+m)),l&&(c._removeClass(l[0],c.toThemeProperty("jqx-toolbar-tool-separator-"+m)),c._removeClass(l[0],c.toThemeProperty("jqx-toolbar-tool-no-separator-"+m)))):f.separatorAfterWidget?(c._removeClass(k[0],c.toThemeProperty("jqx-toolbar-tool-no-separator-"+
        m)),k[0].className+=" "+c.toThemeProperty("jqx-toolbar-tool-separator-"+m),l&&(c._removeClass(l[0],c.toThemeProperty("jqx-toolbar-tool-no-separator-"+m)),l[0].className+=" "+c.toThemeProperty("jqx-toolbar-tool-separator-"+m))):(c._removeClass(k[0],c.toThemeProperty("jqx-toolbar-tool-separator-"+m)),k[0].className+=" "+c.toThemeProperty("jqx-toolbar-tool-no-separator-"+m),l&&(c._removeClass(l[0],c.toThemeProperty("jqx-toolbar-tool-separator-"+m)),l[0].className+=" "+c.toThemeProperty("jqx-toolbar-tool-no-separator-"+
        m)))}}},_addHandlers:function(){var b=this,c=b.element.id;d.jqx.utilities.resize(b.host,function(){b._initiallyHidden?(b._createTools(),b._minimize(),b._initiallyHidden=!1):(!0===b._isOpen&&(b._minimizePopup.style.display="none",b._isOpen=!1,b._raiseEvent("1")),b._minimize())});b.addHandler(document,"click.jqxToolbar"+c,function(){!0===b._isOpen&&b._openMinimizePopup()});b.addHandler(b._minimizeButton,"click.jqxToolbar"+c,function(c){c.stopPropagation();b._openMinimizePopup()});b.addHandler(d(".jqx-popup"),
        "click.jqxToolbar"+c,function(b){-1===b.target.className.indexOf("jqx-window-content")&&b.stopPropagation()})},_removeHandlers:function(){var b=this.element.id;this.removeHandler(document,"click.jqxToolbar"+b);this.removeHandler(this._minimizeButton,"click.jqxToolbar"+b);this.removeHandler(d(".jqx-popup"),"click.jqxToolbar"+b)},_setSize:function(){var b=this.element.style;b.width=this._toPx(this.width);b.height=this._toPx(this.height);this.minWidth&&(b.minWidth=this._toPx(this.minWidth));this.maxWidth&&
    (b.maxWidth=this._toPx(this.maxWidth))},_createTools:function(){var b=this.tools.split(" "),c=d.trim(this.tools.replace(/\|/g,""));c=c.replace(/\s+/g," ");c=c.split(" ");this._toolWidgets=[];for(var e=0,f=0;f<c.length;f++){c[f]!==b[f+e]&&e++;var g=f+e;if(this._toolWidgets[f-1])var h=this._toolWidgets[f-1].tool;var k=b[g];if(""===k)return!0;g=this._initializeTool(f,k,h,b[g-1],b[g+1],this.initTools,!0);this._toolWidgets.push(g)}this._minimizePopup.style.display="none";this._minimizePopup.style.visibility=
        "visible"},_initializeTool:function(b,c,e,d,g,h,k){var f=this._initializeWidget(c,m,f,e);var m=f.tool;f=f.menuTool;e=m[0];var p="jqx-toolbar-tool",r=f[0],t,w=!0;!0===this.rtl&&(p+=" jqx-toolbar-tool-rtl");if(this.initTools){var q=!0===k?this.initTools(c,b,m,!1):h(c,m,!1);if(!q||!1!==q.minimizable&&!1!==q.menuTool)!0===k?this.initTools(c,b,f,!0):h(c,f,!0),f&&(t="jqx-toolbar-tool-minimized");else{if("custom"!==c)f[this._toolToWidgetMapping[c]]("destroy");else f.remove();!1===q.minimizable&&(w=!1);f=
        !1}}b=!1;f&&(r.style.display="none");h=this.rtl?"rtl":"ltr";k=["button","toggleButton","repeatButton","linkButton"];q={button:"jqxButton",toggleButton:"jqxToggleButton",repeatButton:"jqxRepeatButton",linkButton:"jqxRepeatButton"};if("|"===g){if(b=!0,p+=" jqx-toolbar-tool-separator-"+h,f&&(t+=" jqx-toolbar-tool-separator-"+h),f){var u=document.createElement("div");u.className=this.toThemeProperty("jqx-fill-state-pressed jqx-toolbar-minimized-popup-separator");this._minimizePopup.appendChild(u)}}else if(-1===
        k.indexOf(c)||-1!==k.indexOf(c)&&-1===k.indexOf(g))p+=" jqx-toolbar-tool-no-separator-"+h,f&&(t+=" jqx-toolbar-tool-no-separator-"+h);if(-1===k.indexOf(d)&&-1!==k.indexOf(c)&&-1!==k.indexOf(g))if(!1===this.rtl){if(m[q[c]]({roundedCorners:"left"}),f)f[q[c]]({roundedCorners:"left"})}else m[q[c]]({roundedCorners:"left"}),e.style.borderLeftWidth="0px",f&&(f[q[c]]({roundedCorners:"left"}),r.style.borderLeftWidth="0px");else if(-1!==k.indexOf(d)&&-1!==k.indexOf(c)&&-1!==k.indexOf(g))p+=" jqx-toolbar-tool-inner-button",
        e.style.borderLeftWidth="0px",f&&(t+=" jqx-toolbar-tool-inner-button",r.style.borderLeftWidth="0px");else if(-1!==k.indexOf(d)&&-1!==k.indexOf(c)&&-1===k.indexOf(g))if(!1===this.rtl)m[q[c]]({roundedCorners:"right"}),e.style.borderLeftWidth="0px",f&&(f[q[c]]({roundedCorners:"right"}),r.style.borderLeftWidth="0px");else if(m[q[c]]({roundedCorners:"left"}),f)f[q[c]]({roundedCorners:"left"});e.className+=" "+this.toThemeProperty(p);f&&(r.className+=" "+this.toThemeProperty(t));return{type:c,tool:m,separatorAfterWidget:b,
        minimizable:w,minimized:!1,menuTool:f,menuSeparator:u}},_initializeWidget:function(b,c,e,f){var g=this._toolToWidgetMapping[b],h=!1;if("string"===typeof this.height&&-1!==this.height.indexOf("%"))h=!0;else{var k=window.getComputedStyle?window.getComputedStyle(this.element):this.element.currentStyle;k=this.element.offsetHeight-(parseInt(k.paddingTop,10)+parseInt(k.paddingBottom,10)+parseInt(k.borderTopWidth,10)+parseInt(k.borderBottomWidth,10))}if("custom"!==b&&void 0===this.host[g])throw b=this._toolToWidgetMapping[b].toLowerCase(),
        Error("jqxToolBar: Missing reference to "+b+".js");switch(b){case "button":case "toggleButton":c=document.createElement("button");e=document.createElement("button");var l={theme:this.theme,height:h?"100%":k,disabled:this.disabled,rtl:this.rtl};break;case "dropdownlist":case "combobox":c=document.createElement("div");e=document.createElement("div");l={theme:this.theme,autoDropDownHeight:!0,height:h?"100%":k-2,disabled:this.disabled,rtl:this.rtl};break;case "input":c=document.createElement("input");
        c.setAttribute("type","text");e=document.createElement("input");e.setAttribute("type","text");l={theme:this.theme,height:h?"100%":k-2,disabled:this.disabled,rtl:this.rtl};break;case "custom":c=document.createElement("div"),e=document.createElement("div")}h=this.host.children();k=d(this._minimizePopup).children();f||1===h.length&&0===k.length?(this.element.appendChild(c),this._minimizePopup.appendChild(e)):(this.element.insertBefore(c,h[1]),this._minimizePopup.insertBefore(e,k[0]));c=d(c);e=d(e);"custom"!==
    b&&(c[g](l),e[g](l));return{tool:c,menuTool:e}},_appendMinimizeButton:function(){this._minimizedTools=0;var b=document.createElement("div"),c="jqx-menu-minimized-button jqx-toolbar-minimized-button",e=document.createElement("div"),d="jqx-popup jqx-fill-state-normal jqx-rc-b jqx-toolbar-minimized-popup";e.setAttribute("id",this.element.id+"Popup");!0===this.rtl&&(c+=" jqx-toolbar-minimized-button-rtl",d+=" jqx-toolbar-minimized-popup-rtl");b.className=this.toThemeProperty(c);e.className=this.toThemeProperty(d);
        this.element.appendChild(b);document.body.appendChild(e);this._isOpen=!1;e.style.width=this._toPx(this.minimizeWidth);this._minimizeButton=b;this._minimizePopup=e},_openMinimizePopup:function(){var b=this;if(!1===b._isOpen){var c=b.host.offset(),e=c.left;!1===b.rtl&&(e+=b.element.offsetWidth-parseInt(b.minimizeWidth,10)-(b._getComputedStyle(b._minimizePopup,"paddingLeft")+b._getComputedStyle(b._minimizePopup,"paddingRight")+b._getComputedStyle(b._minimizePopup,"borderLeftWidth")+b._getComputedStyle(b._minimizePopup,
        "borderRightWidth")));c=c.top+b.element.offsetHeight-1;b._minimizePopup.style.left=e+"px";b._minimizePopup.style.top=c+"px";d(b._minimizePopup).slideDown("fast",function(){b._isOpen=!0;b._raiseEvent("0")})}else d(b._minimizePopup).slideUp("fast"),b._isOpen=!1,b._raiseEvent("1")},_minimize:function(){var b=0;0<this._minimizedTools&&(b=this._minimizeButton.offsetWidth+this._getComputedStyle(this._minimizeButton,"marginLeft"));b=this.element.offsetWidth-this._getComputedStyle(this.element,"paddingLeft")-
        this._getComputedStyle(this.element,"paddingRight")-b-10;if(!(0>b)){for(var c=0,e,f=0;f<this._toolWidgets.length;f++){var g=this._toolWidgets[f].tool;!1===this._toolWidgets[f].minimized?(g=g[0].offsetWidth+this._getComputedStyle(g[0],"marginLeft")+this._getComputedStyle(g[0],"marginRight"),c+=g):void 0===e&&(g=g[0].cloneNode(!0),g.style.visibility="hidden",g.style.display="block",g.style.position="absolute",document.body.appendChild(g),e=g.offsetWidth+this._getComputedStyle(g,"marginLeft")+this._getComputedStyle(g,
        "marginRight"),d(g).remove())}c>b?(this._minimizeTool(!0),this._minimize()):void 0!==e&&c+e<b&&(this._minimizeTool(!1),this._minimize())}},_minimizeTool:function(b){if(!0===b)for(var c=this._toolWidgets.length-1;0<=c;c--){if(b=this._toolWidgets[c],!1!==b.minimizable&&!1===b.minimized){var e=this._getToolValue(b.tool,b.type);b.tool[0].style.display="none";b.menuTool&&(b.menuTool[0].style.display="block",this._setToolValue(e,b.menuTool,b.type));b.menuSeparator&&(b.menuSeparator.style.display="block");
        this._toolWidgets[c].minimized=!0;this._minimizedTools++;1===this._minimizedTools&&(this._minimizeButton.style.display="block");break}}else for(c=0;c<this._toolWidgets.length;c++)if(b=this._toolWidgets[c],!0===b.minimized){b.menuTool&&(e=this._getToolValue(b.menuTool,b.type),b.menuTool[0].style.display="none");b.menuSeparator&&(b.menuSeparator.style.display="none");b.tool.show();b.menuTool&&this._setToolValue(e,b.tool,b.type);this._toolWidgets[c].minimized=!1;this._minimizedTools--;0===this._minimizedTools&&
    (this._minimizeButton.style.display="none");break}},_getToolValue:function(b,c){switch(c){case "button":case "custom":var e=void 0;break;case "toggleButton":c=-1!==b[0].className.indexOf("jqx-fill-state-pressed");e={text:b[0].innerHTML,toggled:c};break;case "dropdownlist":case "combobox":c=this._toolToWidgetMapping[c];e=b[c]("checkboxes")?b[c]("val"):b[c]("getSelectedIndex");break;case "input":e=b.val()}return e},_setToolValue:function(b,c,e){if(void 0!==b)switch(e){case "toggleButton":c[0].innerHTML=
        b.text;-1!==c[0].className.indexOf("jqx-fill-state-pressed")!==b.toggled&&c.jqxToggleButton("toggle");break;case "dropdownlist":case "combobox":e=this._toolToWidgetMapping[e];if(c[e]("checkboxes")){if(c[e]("uncheckAll"),""!==b){b=b.split(",");for(var d=0;d<b.length;d++)c[e]("checkItem",b[d])}}else c[e]("selectIndex",b);break;case "input":c.val(b)}},_restoreChanges:function(){var b=this;d.each(b._toolChanges,function(c,e){"addTool"===e.action?b.addTool(e.type,e.position,e.separator,e.initCallback):
        "destroyTool"===e.action?b._destroyTool(e.index):"disableTool"===e.action&&b.disableTool(e.index,e.disable)})},_removeClass:function(b,c){d(b).removeClass(c)},_toPx:function(b){return"number"===typeof b?b+"px":b},_getComputedStyle:function(b,c){if(window.getComputedStyle)var e=window.getComputedStyle(b);else b.currentStyle&&(e=b.currentStyle);return"string"===typeof e[c]&&-1===e[c].indexOf("px")?0:parseInt(e[c],10)}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxTooltip","",{});d.extend(d.jqx._jqxTooltip.prototype,{defineInstance:function(){var b={width:"auto",height:"auto",position:"default",enableBrowserBoundsDetection:!0,content:"",left:0,top:0,absolutePositionX:0,absolutePositionY:0,trigger:"hover",showDelay:100,autoHide:!0,autoHideDelay:3E3,closeOnClick:!0,disabled:!1,animationShowDelay:200,animationHideDelay:"fast",showArrow:!0,name:"",opacity:.9,rtl:!1,_isOpen:!1,selector:null,opening:null,value:null,_eventsMap:{mousedown:d.jqx.mobile.getTouchEventName("touchstart"),
            mouseup:d.jqx.mobile.getTouchEventName("touchend")},events:["open","close","opening","closing"]};if(this===d.jqx._jqxTooltip.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(){this._isTouchDevice=d.jqx.mobile.isTouchDevice();var b=d.data(document.body,"_tooltipIDArray"+this.name);b?this.IDArray=b:(this.IDArray=[],d.data(document.body,"_tooltipIDArray"+this.name,this.IDArray));b="jqxtooltip"+this._generatekey();this.IDArray.push({tooltipID:b,tooltipHost:this.host});var c=document.createElement("div");
        c.setAttribute("id",b);c.innerHTML='<div id="'+b+'Main"><div id="'+b+'Text"></div></div><div id="'+b+'Arrow"></div>';d.jqx.browser.msie&&(c.className=this.toThemeProperty("jqx-noshadow"));document.body.appendChild(c);this._tooltip=c;this._tooltipHelper=d(c);this._tooltipHelper.initAnimate&&this._tooltipHelper.initAnimate();c.style.visibility="hidden";c.style.display="none";c.style.opacity=0;c.style.zIndex=99999;this._arrow=c=document.getElementById(b+"Arrow");!1===this.showArrow&&(c.style.visibility=
            "hidden",c.style.display="none");this._main=document.getElementById(b+"Main");this._text=document.getElementById(b+"Text");this._setTheme();this._setSize();this._setContent();!1===this.disabled&&(this._trigger(),!0===this.closeOnClick&&this._clickHide())},open:function(){arguments&&arguments.length&&2===arguments.length&&(this.position="absolute",this.left=arguments[0],this.top=arguments[1],this.absolutePositionX=arguments[0],this.absolutePositionY=arguments[1]);if(!1===this.disabled&&"removed"!==
        this._id())if("mouse"===this.position||"mouseenter"===this.position){var b=this.position;this.position="default";this._raiseEvent("2");this._setPosition();this._animateShow();this.position=b}else this._raiseEvent("2"),this._setPosition(),this._animateShow()},close:function(b){var c=this,e=d.jqx.browser.msie&&9>d.jqx.browser.version;"object"===typeof b&&d.isEmptyObject(b)&&(b=this.animationHideDelay);var f=parseFloat(c._tooltip.style.opacity),g=function(){clearTimeout(c.autoHideTimeout);c._raiseEvent("3");
        c._tooltipHelper.animate({opacity:0},b,function(){c._tooltip.style.visibility="hidden";c._tooltip.style.display="none";c._raiseEvent("1");c._isOpen=!1})};!1===this._isOpen&&0!==f?g():!0===this._isOpen&&(!e&&f===this.opacity||e)&&g()},destroy:function(){var b=this.IDArray.length;this._removeHandlers();this._tooltipHelper.remove();for(var c=0;c<b;c++)if(this.IDArray[c].tooltipHost===this.host){this.IDArray.splice(c,1);break}this.host.removeData("jqxTooltip")},refresh:function(b){if(!0!==b){var c=this;
        this.rtl&&(c._text.className+=" "+c.toThemeProperty("jqx-rtl"),c._text.style.direction="rtl");b=parseFloat(c._tooltip.style.opacity);"removed"!==this._id()&&(!0===this.disabled&&!0===this._isOpen&&b===this.opacity&&(clearTimeout(this.autoHideTimeout),this._tooltipHelper.animate({opacity:0},this.animationHideDelay,function(){c._tooltip.style.visibility="hidden";c._tooltip.style.display="none";c._isOpen=!1})),this._setTheme(),this._setContent(),this._setSize(),"mouse"!==this.position&&"mouseenter"!==
        this.position&&this._setPosition(),this._removeHandlers(),!1===this.disabled&&(this._trigger(),!0===this.closeOnClick&&this._clickHide()))}},propertyChangedHandler:function(b,c,e,d){"content"===c&&(this.changeContentFlag=!0);b.refresh()},_raiseEvent:function(b,c){b=new d.Event(this.events[b]);b.owner=this;b.args=c;try{var e=this.host.trigger(b)}catch(f){}return e},_generatekey:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)+(65536*(1+Math.random())|0).toString(16).substring(1)},
    _id:function(){for(var b,c=this.IDArray.length,e=0;e<c;e++)if(this.IDArray[e].tooltipHost===this.host){b=this.IDArray[e].tooltipID;b="#"+b;break}void 0===b&&(b="removed");return b},_setPosition:function(b){var c=this,e=c._tooltip;if(!1===this._isOpen&&0===parseFloat(e.style.opacity)||!0===this.changeContentFlag)if(b||"mouse"!==this.position&&"mouseenter"!==this.position){e.style.display="block";this.changeContentFlag=!1;this.documentTop=document.documentElement.scrollTop;this.documentLeft=document.documentElement.scrollLeft;
        this.windowWidth=window.innerWidth;this.windowHeight=window.innerHeight;this.hostWidth=c.element.offsetWidth;this.hostHeight=c.element.offsetHeight;this.tooltipWidth=e.offsetWidth;this.tooltipHeight=e.offsetHeight;this.hostOffset=this.host.offset();this.tooltipOffset=c._tooltipHelper.offset();this.defaultOffset=30;this.offsetHorizontal=parseInt(this.left,10);this.offsetVertical=parseInt(this.top,10);e=c._arrow;var f=d(e),g=c._main,h=d(g),k=g.offsetWidth,l=g.offsetHeight;this.arrowSize=5;this.tooltipMainOffset=
            h.offset();this.tooltipArrowOffset={};switch(this.position){case "top":this.tooltipOffset.left=this.hostOffset.left+this.hostWidth/2-this.tooltipWidth/2+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top-this.tooltipHeight-this.arrowSize+this.offsetVertical;this._detectBrowserBounds();this.tooltipMainOffset=h.offset();c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-t-b");e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+
            "px 0px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+(k/2-this.arrowSize);this.tooltipArrowOffset.top=this.tooltipMainOffset.top+l;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "bottom":this.tooltipOffset.left=this.hostOffset.left+this.hostWidth/2-this.tooltipWidth/2+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top+this.hostHeight+this.arrowSize+this.offsetVertical;this._detectBrowserBounds();this.tooltipMainOffset=h.offset();
            c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-t-b");e.style.borderWidth="0 "+this.arrowSize+"px "+this.arrowSize+"px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+(k/2-this.arrowSize);this.tooltipArrowOffset.top=this.tooltipMainOffset.top-this.arrowSize;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "left":g=window.getComputedStyle?window.getComputedStyle(g):g.currentStyle;this.tooltipOffset.left=
            this.hostOffset.left-this.tooltipWidth-this.arrowSize+this.offsetHorizontal-(parseInt(g.borderLeftWidth,10)+parseInt(g.borderRightWidth,10));this.tooltipOffset.top=this.hostOffset.top+this.hostHeight/2-this.tooltipHeight/2+this.offsetVertical;this._detectBrowserBounds();c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-t-b"));e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-l-r");e.style.borderWidth=this.arrowSize+"px 0px "+this.arrowSize+"px "+this.arrowSize+"px";this.tooltipMainOffset=
            h.offset();this.tooltipArrowOffset.left=this.tooltipMainOffset.left+k;this.tooltipArrowOffset.top=this.tooltipMainOffset.top+l/2-this.arrowSize;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "right":this.tooltipOffset.left=this.hostOffset.left+this.hostWidth+this.arrowSize+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top+this.hostHeight/2-this.tooltipHeight/2+this.offsetVertical;this.tooltipOffset.top=parseInt(this.tooltipOffset.top,10);this._detectBrowserBounds();
            this.tooltipMainOffset=h.offset();c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-t-b"));e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-l-r");e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+"px "+this.arrowSize+"px 0px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left-this.arrowSize;this.tooltipArrowOffset.top=this.tooltipMainOffset.top+g.offsetHeight/2-this.arrowSize;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "top-left":this.tooltipOffset.left=
            this.hostOffset.left+this.defaultOffset-this.tooltipWidth+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top-this.tooltipHeight-this.arrowSize+this.offsetVertical;this._detectBrowserBounds();this.tooltipMainOffset=h.offset();c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-t-b");e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+"px  0px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+k-6*this.arrowSize;
            this.tooltipArrowOffset.top=this.tooltipMainOffset.top+l;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "bottom-left":this.tooltipOffset.left=this.hostOffset.left+this.defaultOffset-this.tooltipWidth+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top+this.hostHeight+this.arrowSize+this.offsetVertical;this._detectBrowserBounds();this.tooltipMainOffset=h.offset();c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-t-b");
            e.style.borderWidth="0 "+this.arrowSize+"px "+this.arrowSize+"px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+k-6*this.arrowSize;this.tooltipArrowOffset.top=this.tooltipMainOffset.top-this.arrowSize;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "top-right":this.tooltipOffset.left=this.hostOffset.left+this.hostWidth-this.defaultOffset+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top-this.tooltipHeight-this.arrowSize+this.offsetVertical;
            this._detectBrowserBounds();this.tooltipMainOffset=h.offset();c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-t-b");e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+"px  0px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+4*this.arrowSize;this.tooltipArrowOffset.top=this.tooltipMainOffset.top+l;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "bottom-right":this.tooltipOffset.left=
            this.hostOffset.left+this.hostWidth-this.defaultOffset+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top+this.hostHeight+this.arrowSize+this.offsetVertical;this._detectBrowserBounds();this.tooltipMainOffset=h.offset();c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-t-b");e.style.borderWidth="0 "+this.arrowSize+"px "+this.arrowSize+"px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+4*this.arrowSize;this.tooltipArrowOffset.top=
            this.tooltipMainOffset.top-this.arrowSize;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "absolute":c._tooltipHelper.offset({top:this.absolutePositionY,left:this.absolutePositionX});e.style.borderWidth="0px";break;case "mouse":if(!1===this._isTouchDevice)switch(this.trigger){case "hover":this.mouseHoverTimeout&&clearTimeout(this.mouseHoverTimeout);this.mouseHoverTimeout=setTimeout(function(){c.tooltipOffset.left=b.pageX+10;c.tooltipOffset.top=b.pageY+10;c._detectBrowserBounds()},
            this.showDelay);break;case "click":this.tooltipOffset.left=b.pageX+10,this.tooltipOffset.top=b.pageY+10,this._detectBrowserBounds()}else{f=b.pageX;h=b.pageY;if(b.originalEvent){var m;b.originalEvent.touches&&b.originalEvent.touches.length?m=b.originalEvent.touches[0]:b.originalEvent.changedTouches&&b.originalEvent.changedTouches.length&&(m=b.originalEvent.changedTouches[0]);void 0!==m&&(f=m.pageX,h=m.pageY)}this.tooltipOffset.left=f+10;this.tooltipOffset.top=h+10;this._detectBrowserBounds()}e.style.borderWidth=
            "0px";break;case "mouseenter":m=b.pageY;var p=b.pageX;m<this.hostOffset.top+10&&m>this.hostOffset.top-10?(this.tooltipOffset.left=p-this.tooltipWidth/2,this.tooltipOffset.top=this.hostOffset.top-this.tooltipHeight-this.arrowSize,this._detectBrowserBounds(),this.tooltipMainOffset=h.offset(),c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-l-r")),e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-t-b"),e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+"px  0px",this.tooltipArrowOffset.left=
            this.tooltipMainOffset.left+(k/2-this.arrowSize),this.tooltipArrowOffset.top=this.tooltipMainOffset.top+l,f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left})):m<this.hostOffset.top+this.hostHeight+10&&m>this.hostOffset.top+this.hostHeight-10?(this.tooltipOffset.left=p-this.tooltipWidth/2,this.tooltipOffset.top=this.hostOffset.top+this.hostHeight+this.arrowSize,this._detectBrowserBounds(),this.tooltipMainOffset=h.offset(),c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-l-r")),
            e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-t-b"),e.style.borderWidth="0 "+this.arrowSize+"px "+this.arrowSize+"px",this.tooltipArrowOffset.left=this.tooltipMainOffset.left+(k/2-this.arrowSize),this.tooltipArrowOffset.top=this.tooltipMainOffset.top-this.arrowSize,f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left})):p<this.hostOffset.left+10&&p>this.hostOffset.left-10?(g=window.getComputedStyle?window.getComputedStyle(g):g.currentStyle,this.tooltipOffset.left=this.hostOffset.left-
            this.tooltipWidth-this.arrowSize-(parseInt(g.borderLeftWidth,10)+parseInt(g.borderRightWidth,10)),this.tooltipOffset.top=m-this.tooltipHeight/2,this._detectBrowserBounds(),this.tooltipMainOffset=h.offset(),c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-t-b")),e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-l-r"),e.style.borderWidth=this.arrowSize+"px 0px "+this.arrowSize+"px "+this.arrowSize+"px",this.tooltipMainOffset=h.offset(),this.tooltipArrowOffset.left=this.tooltipMainOffset.left+
            k,this.tooltipArrowOffset.top=this.tooltipMainOffset.top+l/2-this.arrowSize,f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left})):p<this.hostOffset.left+this.hostWidth+10&&p>this.hostOffset.left+this.hostWidth-10&&(this.tooltipOffset.left=this.hostOffset.left+this.hostWidth+this.arrowSize,this.tooltipOffset.top=m-this.tooltipHeight/2,this._detectBrowserBounds(),this.tooltipMainOffset=h.offset(),c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-t-b")),e.className+=" "+
            c.toThemeProperty("jqx-tooltip-arrow-l-r"),e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+"px "+this.arrowSize+"px 0px",this.tooltipMainOffset=h.offset(),this.tooltipArrowOffset.left=this.tooltipMainOffset.left-this.arrowSize,this.tooltipArrowOffset.top=this.tooltipMainOffset.top+l/2-this.arrowSize,f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left}));break;case "default":this.tooltipOffset.left=this.hostOffset.left+this.hostWidth-this.defaultOffset,this.tooltipOffset.top=
            this.hostOffset.top+this.hostHeight+this.arrowSize,this._detectBrowserBounds(),this.tooltipMainOffset=h.offset(),c._removeClass(e,c.toThemeProperty("jqx-tooltip-arrow-l-r")),e.className+=" "+c.toThemeProperty("jqx-tooltip-arrow-t-b"),e.style.borderWidth="0 "+this.arrowSize+"px "+this.arrowSize+"px",this.tooltipArrowOffset.left=this.tooltipMainOffset.left+4*this.arrowSize,this.tooltipArrowOffset.top=this.tooltipMainOffset.top-this.arrowSize,f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left})}}},
    _setContent:function(){this._text.innerHTML=this.content},opened:function(){return this._isOpen&&"block"==this.host.css("display")&&"visible"==this.host.css("visibility")},_animateShow:function(){this._closeAll();clearTimeout(this.autoHideTimeout);var b=parseFloat(this._tooltip.style.opacity);if(!1===this._isOpen&&0===b){var c=this;c._tooltip.style.visibility="visible";c._tooltip.style.display="block";c._tooltip.style.opacity=0;this.opening&&!1===this.opening(this)||c._tooltipHelper.animate({opacity:this.opacity},
        this.animationShowDelay,function(){c._raiseEvent("0");c._isOpen=!0;c.openedTooltip=c;d.data(document.body,"_openedTooltip"+c.name,c);c.autoHideTimeout&&clearTimeout(c.autoHideTimeout);0<c.autoHideDelay&&!0===c.autoHide&&(c.autoHideTimeout=setTimeout(function(){c._autoHide()},c.autoHideDelay))})}},_trigger:function(){if("removed"!==this._id()){var b=this,c=this.host;this.selector&&(c=d("#"+this.selector));if(!1===this._isTouchDevice)switch(this.trigger){case "hover":"mouse"===this.position?(this.addHandler(c,
        "mousemove.tooltip",function(c){1===b._enterFlag&&(b._raiseEvent("2"),b._setPosition(c),clearTimeout(b.hoverShowTimeout),b.hoverShowTimeout=setTimeout(function(){b._animateShow();b._enterFlag=0},b.showDelay))}),this.addHandler(c,"mouseenter.tooltip",function(){0!==b._leaveFlag&&(b._enterFlag=1)}),this.addHandler(c,"mouseleave.tooltip",function(c){b._leaveFlag=1;clearTimeout(b.hoverShowTimeout);var e=b._tooltipHelper.offset(),d=b._tooltip.offsetWidth,h=b._tooltip.offsetHeight;(parseInt(c.pageX,10)<
        parseInt(e.left,10)||parseInt(c.pageX,10)>parseInt(e.left,10)+d)&&b.close();(parseInt(c.pageY,10)<parseInt(e.top,10)||parseInt(c.pageY,10)>parseInt(e.top,10)+h)&&b.close()}),this.addHandler(b._tooltipHelper,"mouseleave.tooltip",function(c){b._checkBoundariesAuto(c);0!==b._clickFlag&&0!==b._autoFlag?b._leaveFlag=0:(b._leaveFlag=1,b.close())})):(this.addHandler(c,"mouseenter.tooltip",function(c){clearTimeout(b.hoverShowTimeout);b.hoverShowTimeout=setTimeout(function(){b._raiseEvent("2");b._setPosition(c);
        b._animateShow()},b.showDelay)}),this.addHandler(c,"mouseleave.tooltip",function(c){b._leaveFlag=1;clearTimeout(b.hoverShowTimeout);if(b.autoHide){var e=c.pageX;c=c.pageY;var d=b._tooltipHelper.offset(),h=d.left;d=d.top;var k=b._tooltip.offsetWidth,l=b._tooltip.offsetHeight;(parseInt(e,10)<parseInt(h,10)||parseInt(e,10)>parseInt(h,10)+k||parseInt(c,10)<parseInt(d,10)||parseInt(c,10)>parseInt(d,10)+l)&&b.close()}}),this.addHandler(b._tooltipHelper,"mouseleave.tooltip",function(c){b._checkBoundariesAuto(c);
        0!==b._clickFlag&&0!==b._autoFlag?b._leaveFlag=0:(b._leaveFlag=1,b.autoHide&&b.close())}));break;case "click":this.addHandler(c,"click.tooltip",function(c){"mouseenter"===b.position&&(b.position="mouse");b._raiseEvent("2");b._setPosition(c);b._animateShow()})}else"none"!==this.trigger&&this.addHandler(c,"touchstart.tooltip",function(c){"mouseenter"===b.position&&(b.position="mouse");b._raiseEvent("2");b._setPosition(c);b._animateShow()})}},_autoHide:function(){var b=this,c=parseFloat(b._tooltip.style.opacity);
        !0===this.autoHide&&!0===this._isOpen&&c>=this.opacity&&(b._raiseEvent("3"),b._tooltipHelper.animate({opacity:0},b.animationHideDelay,function(){b._tooltip.style.visibility="hidden";b._tooltip.style.display="none";b._raiseEvent("1");b._isOpen=!1}))},_clickHide:function(){var b=this;this.addHandler(b._tooltipHelper,"click.tooltip",function(c){b._checkBoundariesClick(c);b.close()})},_setSize:function(){this._tooltip.style.width=this._toPx(this.width);this._tooltip.style.height=this._toPx(this.height)},
    resize:function(){this._setSize()},_setTheme:function(){-1===this._tooltip.className.indexOf("jqx-tooltip")&&(this._tooltip.className+=" "+this.toThemeProperty("jqx-tooltip jqx-popup"),this._main.className+=" "+this.toThemeProperty("jqx-widget jqx-fill-state-normal jqx-tooltip-main"),this._text.className+=" "+this.toThemeProperty("jqx-widget jqx-fill-state-normal jqx-tooltip-text"),this._arrow&&(this._arrow.className+=" "+this.toThemeProperty("jqx-widget jqx-fill-state-normal jqx-tooltip-arrow")))},
    _initialPosition:function(){var b=this.position;this.position="default";this._setPosition();this.position=b},_detectBrowserBounds:function(){var b=this._tooltipHelper;this.enableBrowserBoundsDetection?this.tooltipOffset.top<this.documentTop&&0>this.tooltipOffset.left?b.offset({top:this.documentTop,left:this.documentLeft}):this.tooltipOffset.top<this.documentTop&&this.tooltipOffset.left+this.tooltipWidth>this.windowWidth+this.documentLeft?b.offset({top:this.documentTop,left:this.windowWidth+this.documentLeft-
            this.tooltipWidth}):this.tooltipOffset.top<this.documentTop?b.offset({top:this.documentTop,left:this.tooltipOffset.left}):this.tooltipOffset.top+this.tooltipHeight>this.windowHeight+this.documentTop&&0>this.tooltipOffset.left?b.offset({top:this.windowHeight+this.documentTop-this.tooltipHeight,left:this.documentLeft}):this.tooltipOffset.top+this.tooltipHeight>this.windowHeight+this.documentTop&&this.tooltipOffset.left+this.tooltipWidth>this.windowWidth+this.documentLeft?b.offset({top:this.windowHeight+
            this.documentTop-this.tooltipHeight,left:this.windowWidth+this.documentLeft-this.tooltipWidth}):this.tooltipOffset.top+this.tooltipHeight>this.windowHeight+this.documentTop?b.offset({top:this.windowHeight+this.documentTop-this.tooltipHeight,left:this.tooltipOffset.left}):0>this.tooltipOffset.left?b.offset({top:this.tooltipOffset.top,left:this.documentLeft}):this.tooltipOffset.left+this.tooltipWidth>this.windowWidth+this.documentLeft?b.offset({top:this.tooltipOffset.top,left:this.windowWidth+this.documentLeft-
            this.tooltipWidth}):b.offset({top:this.tooltipOffset.top,left:this.tooltipOffset.left}):b.offset({top:this.tooltipOffset.top,left:this.tooltipOffset.left})},_checkBoundaries:function(b){return b.pageX>=this.hostOffset.left&&b.pageX<=this.hostOffset.left+this.hostWidth&&b.pageY>=this.hostOffset.top&&b.pageY<=this.hostOffset.top+this.hostHeight?!0:!1},_checkBoundariesClick:function(b){this._checkBoundaries(b)?this._clickFlag=1:this._clickFlag=0},_checkBoundariesAuto:function(b){this._checkBoundaries(b)?
        this._autoFlag=1:this._autoFlag=0},_removeHandlers:function(){this.removeHandler(this.host,"mouseenter.tooltip");this.removeHandler(this.host,"mousemove.tooltip");this.removeHandler(this.host,"mouseleave.tooltip");this.removeHandler(this.host,"click.tooltip");this.removeHandler(this.host,"touchstart.tooltip");this.removeHandler(this._tooltipHelper,"click.tooltip");this.removeHandler(this._tooltipHelper,"mouseleave.tooltip")},_closeAll:function(){for(var b=0;b<this.IDArray.length;b++){var c=document.getElementById(this.IDArray[b].tooltipID);
        c!==this._tooltip&&(c.style.opacity=0,c.style.visibility="hidden",c.style.display="none",this._isOpen=!1)}},_toPx:function(b){return"number"===typeof b?b+"px":b},_removeClass:function(b,c){d(b).removeClass(c)}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxCheckBox","",{});d.extend(d.jqx._jqxCheckBox.prototype,{defineInstance:function(){var b={animationShowDelay:300,animationHideDelay:300,width:null,height:null,boxSize:"16px",checked:!1,hasThreeStates:!1,disabled:!1,enableContainerClick:!0,locked:!1,groupName:"",keyboardCheck:!0,enableHover:!0,hasInput:!0,rtl:!1,updated:null,disabledContainer:!1,changeType:null,_canFocus:!0,aria:{"aria-checked":{name:"checked",type:"boolean"},"aria-disabled":{name:"disabled",type:"boolean"}},
        events:["checked","unchecked","indeterminate","change"]};if(this===d.jqx._jqxCheckBox.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(b){this._createFromInput("CheckBox");this.render()},_createFromInput:function(b){if("input"==this.element.nodeName.toLowerCase()){this.field=this.element;this.field.className&&(this._className=this.field.className);var c={title:this.field.title};this.field.value&&(c.value=this.field.value);this.field.checked&&(c.checked=!0);c.id=this.field.id.length?
        this.field.id.replace(/[^\w]/g,"_")+"_"+b:d.jqx.utilities.createId()+"_"+b;var e=this.element.nextSibling,f=!1;!e||"#text"!=e.nodeName&&"span"!=e.nodeName||(f=!0);var g=0;b=d("<div></div>",c);f&&(b.append(e),e=d("<span>"+d(e).text()+"</span>"),e.appendTo(d(document.body)),g+=e.width(),e.remove());b[0].style.cssText=this.field.style.cssText;this.width||(this.width=d(this.field).width()+g+10);this.height||(this.height=d(this.field).outerHeight()+10);d(this.field).hide().after(b);g=this.host.data();
        this.host=b;this.host.data(g);this.element=b[0];this.element.id=this.field.id;this.field.id=c.id;this._className&&(this.host.addClass(this._className),d(this.field).removeClass(this._className));this.field.tabIndex&&(c=this.field.tabIndex,this.field.tabIndex=-1,this.element.tabIndex=c)}},_addInput:function(){if(this.hasInput){this.input&&this.input.remove();var b=this.host.attr("name");this.input=d("<input type='hidden'/>");this.host.append(this.input);b&&this.input.attr("name",b);this.input.val(this.checked);
        this.host.attr("role","checkbox");d.jqx.aria(this)}},render:function(){this.init=!0;var b=this;this.setSize();this.propertyChangeMap.width=function(c,e,d,f){b.setSize()};this.propertyChangeMap.height=function(c,e,d,f){b.setSize()};this._removeHandlers();this.width||this.host.css("overflow-x","visible");this.height||this.host.css("overflow-y","visible");this.checkbox&&(this.checkbox.remove(),this.checkbox=null);this.checkMark&&(this.checkMark.remove(),this.checkMark=null);this.box&&(this.box.remove(),
        this.box=null);this.clear&&(this.clear.remove(),this.clear=null);null==this.boxSize&&(this.boxSize=16);var c=parseInt(this.boxSize)+"px",e=Math.floor((parseInt(this.boxSize)-16)/2),f=e;e+="px";f+="px";16!=parseInt(this.boxSize)?this.checkbox=d('<div><div style="width: '+c+"; height: "+c+';"><span style="position: relative; left: '+e+"; top: "+f+'; width: 16px; height: 16px;"></span></div></div>'):this.checkbox=d('<div><div style="width: '+c+"; height: "+c+';"><span style="width: '+c+"; height: "+
        c+';"></span></div></div>');this.host.prepend(this.checkbox);this.disabledContainer||(this.host.attr("tabIndex")||this.host.attr("tabIndex",0),this.clear=d('<div style="clear: both;"></div>'),this.host.append(this.clear));this.checkMark=d(this.checkbox[0].firstChild.firstChild);this.box=this.checkbox;this.box.addClass(this.toThemeProperty("jqx-checkbox-default")+" "+this.toThemeProperty("jqx-fill-state-normal")+" "+this.toThemeProperty("jqx-rc-all"));this.disabled&&this.disable();this.disabledContainer||
    (this.host.addClass(this.toThemeProperty("jqx-widget")),this.host.addClass(this.toThemeProperty("jqx-checkbox")));this.locked&&!this.disabledContainer&&this.host.css("cursor","auto");c=this.element.getAttribute("checked");if("checked"==c||"true"==c||1==c)this.checked=!0;this._addInput();this._render();this._addHandlers();this.init=!1;this._centerBox();this.isMaterialized()&&(d(this.checkbox).addClass("ripple"),d.jqx.ripple(d(this.checkbox),this.host,"checkbox"))},_centerBox:function(){if(this.height&&
        -1==this.height.toString().indexOf("%")&&this.box){var b=parseInt(this.height);this.host.css("line-height",b+"px");b=b-parseInt(this.boxSize)-1;this.box.css("margin-top",parseInt(b/2))}},refresh:function(b){b||(this.setSize(),this._render())},resize:function(b,c){this.width=b;this.height=c;this.refresh()},setSize:function(){null!=this.width&&-1!=this.width.toString().indexOf("px")?this.host.width(this.width):void 0==this.width||isNaN(this.width)?null!=this.width&&-1!=this.width.toString().indexOf("%")&&
        (this.element.style.width=this.width):this.host.width(this.width);null!=this.height&&-1!=this.height.toString().indexOf("px")?this.host.height(this.height):void 0==this.height||isNaN(this.height)?null!=this.height&&-1!=this.height.toString().indexOf("%")&&(this.element.style.height=this.height):this.host.height(this.height);this._centerBox()},_addHandlers:function(){var b=this,c="mousedown";d.jqx.mobile.isTouchDevice()&&(c=d.jqx.mobile.getTouchEventName("touchend"));this.addHandler(this.box,c,function(c){if(!b.disabled&&
        !b.enableContainerClick&&!b.locked)return b.changeType="mouse",b.toggle(),b.updated&&(c.owner=b,b.updated(c,b.checked,b.oldChecked)),c.preventDefault&&c.preventDefault(),!1});this.disabledContainer||(this.addHandler(this.host,"keydown",function(c){if(!b.disabled&&!b.locked&&b.keyboardCheck&&32==c.keyCode){if(!b._canFocus)return!0;b.changeType="keyboard";b.toggle();b.updated&&(c.owner=b,b.updated(c,b.checked,b.oldChecked));c.preventDefault&&c.preventDefault();return!1}}),this.addHandler(this.host,
        c,function(c){if(!b.disabled&&b.enableContainerClick&&!b.locked)return b.clickTime=new Date,b.changeType="mouse",b.toggle(),c.preventDefault&&c.preventDefault(),b._canFocus&&b.focus(),!1}),this.addHandler(this.host,"selectstart",function(c){if(!b.disabled&&b.enableContainerClick)return c.preventDefault&&c.preventDefault(),!1}),this.addHandler(this.host,"mouseup",function(c){!b.disabled&&b.enableContainerClick&&c.preventDefault&&c.preventDefault()}),this.addHandler(this.host,"focus",function(c){if(!b.disabled&&
        !b.locked){if(!b._canFocus)return!0;b.enableHover&&b.box.addClass(b.toThemeProperty("jqx-checkbox-hover"));b.box.addClass(b.toThemeProperty("jqx-fill-state-focus"));c.preventDefault&&c.preventDefault();d(b.checkbox).removeClass("active");(!b.clickTime||b.clickTime&&300<new Date-b.clickTime)&&d(b.checkbox).addClass("active");b.hovered=!0;return!1}}),this.addHandler(this.host,"blur",function(c){d(b.checkbox).removeClass("active");if(!b.disabled&&!b.locked){if(!b._canFocus)return!0;b.enableHover&&b.box.removeClass(b.toThemeProperty("jqx-checkbox-hover"));
        b.box.removeClass(b.toThemeProperty("jqx-fill-state-focus"));c.preventDefault&&c.preventDefault();return b.hovered=!1}}),this.addHandler(this.host,"mouseenter",function(c){b.locked&&b.host.css("cursor","arrow");if(b.enableHover&&!b.disabled&&b.enableContainerClick&&!b.locked)return b.box.addClass(b.toThemeProperty("jqx-checkbox-hover")),b.box.addClass(b.toThemeProperty("jqx-fill-state-hover")),c.preventDefault&&c.preventDefault(),b.hovered=!0,!1}),this.addHandler(this.host,"mouseleave",function(c){if(b.enableHover&&
        !b.disabled&&b.enableContainerClick&&!b.locked)return b.box.removeClass(b.toThemeProperty("jqx-checkbox-hover")),b.box.removeClass(b.toThemeProperty("jqx-fill-state-hover")),c.preventDefault&&c.preventDefault(),b.hovered=!1}),this.addHandler(this.box,"mouseenter",function(){b.locked||b.disabled||b.enableContainerClick||(b.box.addClass(b.toThemeProperty("jqx-checkbox-hover")),b.box.addClass(b.toThemeProperty("jqx-fill-state-hover")))}),this.addHandler(this.box,"mouseleave",function(){b.disabled||b.enableContainerClick||
    (b.box.removeClass(b.toThemeProperty("jqx-checkbox-hover")),b.box.removeClass(b.toThemeProperty("jqx-fill-state-hover")))}))},focus:function(){try{this.host.focus()}catch(b){}},_removeHandlers:function(){var b="mousedown";d.jqx.mobile.isTouchDevice()&&(b="touchend");this.box&&(this.removeHandler(this.box,b),this.removeHandler(this.box,"mouseenter"),this.removeHandler(this.box,"mouseleave"));this.removeHandler(this.host,b);this.removeHandler(this.host,"mouseup");this.removeHandler(this.host,"selectstart");
        this.removeHandler(this.host,"mouseenter");this.removeHandler(this.host,"mouseleave");this.removeHandler(this.host,"keydown");this.removeHandler(this.host,"blur");this.removeHandler(this.host,"focus")},_render:function(){this.disabled?this.disable():this.enableContainerClick?this.host.css("cursor","pointer"):this.init||this.host.css("cursor","auto");this.rtl&&(this.box.addClass(this.toThemeProperty("jqx-checkbox-rtl")),this.host.addClass(this.toThemeProperty("jqx-rtl")));this.updateStates();this.host.attr("checked",
        this.checked)},_setState:function(b,c){this.checked!=b&&(this.checked=b,this.checkMark[0].className=this.checked?this.toThemeProperty("jqx-checkbox-check-checked"):null==this.checked?this.toThemeProperty("jqx-checkbox-check-indeterminate"):"");if(!1===c||!0===c)this.locked=c;b?this.element.setAttribute("checked",!0):this.element.removeAttribute("checked")},val:function(b){if(0==arguments.length||null!=b&&"object"==typeof b)return this.checked;"string"==typeof b?("true"==b&&this.check(),"false"==b&&
    this.uncheck(),""==b&&this.indeterminate()):(1==b&&this.check(),0==b&&this.uncheck(),null==b&&this.indeterminate());return this.checked},check:function(){this.checked=!0;var b=this;this.checkMark.removeClass();this.element.setAttribute("checked",!0);d.jqx.browser.msie||0==this.animationShowDelay?this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-checked")):(this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-checked")),this.checkMark.css("opacity",0),this.checkMark.stop().animate({opacity:1},
        this.animationShowDelay,function(){}));if(null!=this.groupName&&0<this.groupName.length){var c=d.find(this.toThemeProperty(".jqx-checkbox",!0));d.each(c,function(){d(this).jqxCheckBox("groupName")==b.groupName&&this!=b.element&&d(this).jqxCheckBox("uncheck")})}c=this.changeType;this._raiseEvent("0",{checked:!0});this.changeType=c;this._raiseEvent("3",{checked:!0});void 0!=this.input&&(this.input.val(this.checked),d.jqx.aria(this,"aria-checked",this.checked),this.host.attr("checked",this.checked))},
    uncheck:function(){this.checked=!1;var b=this;this.element.removeAttribute("checked");d.jqx.browser.msie||0==this.animationHideDelay?""!=b.checkMark[0].className&&(b.checkMark[0].className=""):(this.checkMark.css("opacity",1),this.checkMark.stop().animate({opacity:0},this.animationHideDelay,function(){""!=b.checkMark[0].className&&(b.checkMark[0].className="")}));var c=this.changeType;this._raiseEvent("1");this.changeType=c;this._raiseEvent("3",{checked:!1});void 0!=this.input&&(this.input.val(this.checked),
        d.jqx.aria(this,"aria-checked",this.checked),this.host.attr("checked",this.checked))},indeterminate:function(){this.checked=null;this.checkMark.removeClass();d.jqx.browser.msie||0==this.animationShowDelay?this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-indeterminate")):(this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-indeterminate")),this.checkMark.css("opacity",0),this.checkMark.stop().animate({opacity:1},this.animationShowDelay,function(){}));this._raiseEvent("2");
        this._raiseEvent("3",{checked:null});void 0!=this.input&&(this.input.val(this.checked),d.jqx.aria(this,"aria-checked","undefined"),this.host.attr("checked","undefined"))},toggle:function(){this.disabled||this.locked||(null!=this.groupName&&0<this.groupName.length?1!=this.checked&&(this.checked=!0,this.updateStates()):(this.oldChecked=this.checked,this.checked=1==this.checked?this.hasThreeStates?null:!1:null!=this.checked,this.updateStates(),void 0!=this.input&&this.input.val(this.checked)))},updateStates:function(){this.checked?
        this.check():0==this.checked?this.uncheck():null==this.checked&&this.indeterminate()},disable:function(){this.disabled=!0;1==this.checked?this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-disabled")):null==this.checked&&this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-indeterminate-disabled"));this.box.addClass(this.toThemeProperty("jqx-checkbox-disabled-box"));this.host.addClass(this.toThemeProperty("jqx-checkbox-disabled"));this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));
        this.box.addClass(this.toThemeProperty("jqx-checkbox-disabled"));d.jqx.aria(this,"aria-disabled",this.disabled)},enable:function(){1==this.checked?this.checkMark.removeClass(this.toThemeProperty("jqx-checkbox-check-disabled")):null==this.checked&&this.checkMark.removeClass(this.toThemeProperty("jqx-checkbox-check-indeterminate-disabled"));this.box.removeClass(this.toThemeProperty("jqx-checkbox-disabled-box"));this.host.removeClass(this.toThemeProperty("jqx-checkbox-disabled"));this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled"));
        this.box.removeClass(this.toThemeProperty("jqx-checkbox-disabled"));this.disabled=!1;d.jqx.aria(this,"aria-disabled",this.disabled)},destroy:function(){this.host.remove()},_raiseEvent:function(b,c){if(!this.init){b=new d.Event(this.events[b]);b.owner=this;c||(c={});c.type=this.changeType;this.changeType=null;b.args=c;try{var e=this.host.trigger(b)}catch(f){}return e}},propertiesChangedHandler:function(b,c,e){e.width&&e.height&&2==Object.keys(e).length&&b.setSize()},propertyChangedHandler:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              c,e,f){if(void 0!=this.isInitialized&&0!=this.isInitialized&&!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length)){"enableContainerClick"!=c||b.disabled||b.locked||(f?b.host.css("cursor","pointer"):b.host.css("cursor","auto"));"rtl"==c&&(f?(b.box.addClass(b.toThemeProperty("jqx-checkbox-rtl")),b.host.addClass(b.toThemeProperty("jqx-rtl"))):(b.box.removeClass(b.toThemeProperty("jqx-checkbox-rtl")),b.host.removeClass(b.toThemeProperty("jqx-rtl"))));"boxSize"==
    c&&b.render();"theme"==c&&d.jqx.utilities.setTheme(e,f,b.host);if("checked"==c&&f!=e)switch(f){case !0:b.check();break;case !1:b.uncheck();break;case null:b.indeterminate()}"disabled"==c&&f!=e&&(f?b.disable():b.enable())}}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxRibbon","",{});d.extend(d.jqx._jqxRibbon.prototype,{defineInstance:function(){var b={width:null,height:"auto",mode:"default",position:"top",selectedIndex:-1,selectionMode:"click",popupCloseMode:"click",animationType:"fade",animationDelay:400,scrollPosition:"both",disabled:!1,rtl:!1,scrollStep:10,scrollDelay:30,reorder:!1,initContent:null,_roundedCorners:!0,_removeByDrag:!1,_suppressReorder:!0,events:["select","unselect","change","_removeByDrag","reorder"]};if(this===
        d.jqx._jqxRibbon.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(){if("none"===this.host.css("display")||!1===document.body.contains(this.element))this._initiallyHidden=!0;this._browser=d.jqx.browser;"popup"!==this.mode&&-1===this.selectedIndex&&(this.selectedIndex=0);this._originalHTML=this.element.innerHTML;this._render(!0)},render:function(){this._render()},refresh:function(b){!0!==b&&this._render()},destroy:function(){this._removeHandlers();this.host.remove()},selectAt:function(b){this._selectAt(b)},
    clearSelection:function(){-1!==this.selectedIndex&&this._clearSelection()},disableAt:function(b){this._items[b]._disabled=!0;d(this._items[b]).addClass(this.toThemeProperty("jqx-fill-state-disabled"));b===this.selectedIndex&&this._clearSelection()},enableAt:function(b){this._items[b]._disabled=!1;d(this._items[b]).removeClass(this.toThemeProperty("jqx-fill-state-disabled"))},hideAt:function(b){this._items[b].style.display="none";this._checkScrollButtons();b===this.selectedIndex?this._clearSelection():
        this._updatePositions()},showAt:function(b){this._items[b].style.display="horizontal"===this._orientation?"inline-block":"inherit";this._checkScrollButtons();this._updatePositions()},val:function(b){if(b)this._selectAt(b);else return this.selectedIndex},addAt:function(b,c){var e="jqx-ribbon-item jqx-ribbon-item-"+this.position,f="jqx-widget-content jqx-ribbon-content-section jqx-ribbon-content-section-"+this.position;this._removeHandlers();var g=document.createElement("li");g.innerHTML=c.title;var h=
        document.createElement("div");if("string"===typeof c.content)h.innerHTML=c.content;else if(void 0!==c.content.length)try{if(void 0!==window.$&&c.content instanceof window.$)d(h).append(c.content);else if(d.isArray(c.content))for(var k=0;k<c.content.length;k++)c.content[k].appendTo(h);else for(;0<c.content.length;)h.appendChild(c.content[0])}catch(l){}else h.appendChild(c.content);switch(this.position){case "top":e+=" jqx-rc-t";f+=" jqx-rc-b";break;case "bottom":e+=" jqx-rc-b";f+=" jqx-rc-t";break;
        case "left":e+=" jqx-rc-l";f+=" jqx-rc-r";break;case "right":e+=" jqx-rc-r",f+=" jqx-rc-l"}"popup"===this.mode&&(f+=" jqx-ribbon-content-section-popup jqx-ribbon-content-section-"+this._orientation+"-popup");!0===this.rtl&&(e+=" jqx-ribbon-item-rtl");g.className=this.toThemeProperty(e);h.className=this.toThemeProperty(f);this._items.length-1>=b?(this._headerElement.insertBefore(g,this._items[b]),this._contentElement.insertBefore(h,this._contentSections[b])):(this._headerElement.appendChild(g),this._contentElement.appendChild(h));
        this._updateItems();this._addHandlers();this._checkScrollButtons();b<=this.selectedIndex&&this.selectedIndex<this._items.length-1&&this.selectedIndex++;this._updatePositions();0>this.selectedIndex||(this._suppressSelectionEvents=!0,this._selectAt(this.selectedIndex,this.selectedIndex,!0))},removeAt:function(b){b===this.selectedIndex&&this._clearSelection();d(this._items[b]).remove();d(this._contentSections[b]).remove();this._updateItems(!0);this._updatePositions();this._checkScrollButtons()},updateAt:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           c){var e=this._items[b];e.innerHTML=c.newTitle;this._contentSections[b].innerHTML=c.newContent;e._isInitialized=!1;this.initContent&&b===this.selectedIndex&&(this.initContent(b),e._isInitialized=!0);this._updatePositions()},setPopupLayout:function(b,c,e,d){var f=this._contentSections[b];"popup"===this.mode&&(f.getAttribute("data-width")||(f.style.width&&f.setAttribute("data-width",f.style.width),f.style.height&&f.setAttribute("data-height",f.style.height)),e&&(f.style.width=this._toPx(e)),d&&(f.style.height=
        this._toPx(d)),f._layout=c,this._positionContent(b))},propertiesChangedHandler:function(b,c,e){e&&e.width&&e.height&&2===Object.keys(e).length&&(b.element.style.width=b._toPx(b.width),b.element.style.height=b._toPx(b.height),b._updateSize())},propertyChangedHandler:function(b,c,e,f){if(!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2===Object.keys(b.batchUpdate).length)&&f!==e)switch(c){case "width":case "height":b.element.style[c]=b._toPx(f);b._updateSize();break;case "position":b._render();
        break;case "mode":b._contentElement.style.width="auto";b._removeHandlers(null,e);b._render();break;case "selectedIndex":b._selectAt(f,e);break;case "selectionMode":b._removeHandlers(e);b._addHandlers();break;case "scrollPosition":c=b._scrollButtonNear;var g=b._scrollButtonFar;d(c).removeClass(b.toThemeProperty("jqx-ribbon-scrollbutton-"+e+" jqx-rc-tr jqx-rc-bl jqx-rc-tl"));d(g).removeClass(b.toThemeProperty("jqx-ribbon-scrollbutton-"+e+" jqx-rc-tr jqx-rc-bl jqx-rc-br"));c.className+=" "+b.toThemeProperty("jqx-ribbon-scrollbutton-"+
        f);g.className+=" "+b.toThemeProperty("jqx-ribbon-scrollbutton-"+f);b._scrollButtonRc(c,g);b._checkScrollButtons();b._updatePositions();break;case "disabled":!0===f?(b._removeHandlers(),b.element.className+=" "+b.toThemeProperty("jqx-fill-state-disabled")):(b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")),b._addHandlers());break;case "theme":d.jqx.utilities.setTheme(e,f,b.host);break;case "rtl":if(!0===f)for(b._headerElement.className+=" "+b.toThemeProperty("jqx-ribbon-header-rtl"),
                                                                                                                                                                                                                                                                                                                                                                                                                                                        e=0;e<b._items.length;e++)b._items[e].className+=" "+b.toThemeProperty("jqx-ribbon-item-rtl");else for(b._header.removeClass(b.toThemeProperty("jqx-ribbon-header-rtl")),e=0;e<b._items.length;e++)d(b._items[e]).removeClass(b.toThemeProperty("jqx-ribbon-item-rtl"));b._positionSelectionToken(b.selectedIndex)}},_raiseEvent:function(b,c){b=new d.Event(this.events[b]);b.owner=this;b.args=c;try{var e=this.host.trigger(b)}catch(f){}return e},_render:function(b){var c=this;!0!==b&&c._removeHandlers();c._selectionTokenOffsetY=
        0;switch(c._browser.browser){case "mozilla":c._browserWidthRtlFlag=0;c._browserScrollRtlFlag=1;c._selectionTokenOffsetX=1;break;case "msie":c._browserWidthRtlFlag=0;c._browserScrollRtlFlag=-1;"8.0"===c._browser.version?c._selectionTokenOffsetX=1:"7.0"===c._browser.version?(c._selectionTokenOffsetX=0,"popup"!==c.mode||"bottom"!==c.position&&"right"!==c.position||(c._selectionTokenOffsetY=2)):c._selectionTokenOffsetX=0;break;default:c._browserWidthRtlFlag=1,c._browserScrollRtlFlag=1,c._selectionTokenOffsetX=
        0}if(!0===b){var e=c.host.children();c._headerElement=e[0];c._header=d(e[0]);c._contentElement=e[1];c._content=d(e[1]);c._checkStructure(e);c._refreshBarPosition()}c._headerElement.style["float"]="none";c._contentElement.style.padding="0px";c.element.style.width=c._toPx(c.width);c.element.style.height=c._toPx(c.height);"bottom"!==c.position&&"right"!==c.position||c.element.insertBefore(c._contentElement,c._headerElement);c._orientation="top"===c.position||"bottom"===c.position?"horizontal":"vertical";
        "right"===c.position?c._headerElement.style["float"]="right":"left"===c.position&&(c._headerElement.style["float"]="left");c._contentSections=c._content.children();d.each(c._contentSections,function(){this.getAttribute("data-width")&&(this.style.width=this.getAttribute("data-width"),this.style.height=this.getAttribute("data-height"),this.removeAttribute("data-width"),this.removeAttribute("data-height"))});!0===b&&(c._selectionToken=document.createElement("div"),c._selectionToken.className=c.toThemeProperty("jqx-widget-content jqx-ribbon-selection-token jqx-ribbon-selection-token-"+
            c.position),c.element.appendChild(c._selectionToken));c._updateItems();!0!==c._initiallyHidden&&c._addClasses();!0===b&&(c._appendScrollButtons(),c._checkScrollButtons());c._allowSelection=!0;-1!==c.selectedIndex&&(c._items[c.selectedIndex].className+=" "+c.toThemeProperty("jqx-widget-content jqx-ribbon-item-selected"),c._positionSelectionToken(c.selectedIndex),c._contentSections[c.selectedIndex].style.display="block",c.initContent&&(c.initContent(c.selectedIndex),c._items[c.selectedIndex]._isInitialized=
            !0));c.disabled?c.element.className+=" "+c.toThemeProperty("jqx-fill-state-disabled"):c._addHandlers();d.jqx.utilities.resize(c.host,function(){c._initiallyHidden&&(c._initiallyHidden=!1,c._addClasses(),-1!==c.selectedIndex&&(c._items[c.selectedIndex].className+=" "+c.toThemeProperty("jqx-widget-content jqx-ribbon-item-selected")));c._updateSize(!0)});"popup"===c.mode&&""!==c.theme&&setTimeout(function(){c._positionPopup();c._positionSelectionToken(c.selectedIndex)},30)},_updateSize:function(b){if("7.0"===
        this._browser.version&&"msie"===this._browser.browser)if("horizontal"===this._orientation)this._header.css("width",this.host.width()-parseInt(this._header.css("padding-left"),10)-parseInt(this._header.css("padding-right"),10)-parseInt(this._header.css("border-left-width"),10)-parseInt(this._header.css("border-right-width"),10)),this._contentSections.width(this._content.width()-parseInt(this._contentSections.css("border-left-width"),10)-parseInt(this._contentSections.css("border-right-width"),10)-
        parseInt(this._contentSections.css("padding-left"),10)-parseInt(this._contentSections.css("padding-right"),10)),"default"===this.mode&&"string"===typeof this.height&&-1!==this.height.indexOf("%")&&this._contentSections.height(this._content.height()-this._header.height()-parseInt(this._contentSections.css("border-bottom-width"),10)-parseInt(this._contentSections.css("border-top-width"),10)-1);else if(this._header.css("height",this.host.height()-parseInt(this._header.css("padding-top"),10)-parseInt(this._header.css("padding-bottom"),
        10)-parseInt(this._header.css("border-top-width"),10)-parseInt(this._header.css("border-bottom-width"),10)),this._contentSections.height(this._content.height()-parseInt(this._contentSections.css("border-top-width"),10)-parseInt(this._contentSections.css("border-bottom-width"),10)-parseInt(this._contentSections.css("padding-top"),10)-parseInt(this._contentSections.css("padding-bottom"),10)),"default"===this.mode&&"string"===typeof this.width&&-1!==this.height.indexOf("%")){var c="left"===this.position?
        parseInt(this._contentSections.css("border-left-width"),10)+parseInt(this._contentSections.css("border-right-width"),10)+1:0;this._contentSections.width(this._content.width()-this._header.width()-c)}this._checkScrollButtons(!0);this._updatePositions(void 0,b);"popup"===this.mode&&this._positionPopup();this._refreshBarPosition()},_stopAnimation:function(){if(!this._allowSelection){this.selectedIndex=this._animatingIndex;var b=d(this._contentSections[this._animatingIndex]);this._initAnimate(b);b.animate("finish");
        this._clearSelection(!0,this._animatingIndex);this._allowSelection=!0}},_refreshBarPosition:function(){var b=this;if(!this.bar){var c=d("<span></span>");d(this.host).append(c);c.addClass(this.toThemeProperty("jqx-tabs-bar"));this.bar=c}setTimeout(function(){var c=parseInt(d(b._headerElement).css("left"),10)-b._headerElement.scrollLeft,f=parseInt(d(b._headerElement).css("top"),10)-b._headerElement.scrollTop,g=void 0!==b._animatingIndex?b._animatingIndex:b.selectedIndex;b._items[g]&&b.bar&&("top"===
    b.position||"bottom"===b.position?(b.bar.css("left",b._items[g].offsetLeft+c),"top"===b.position?b.bar.css("top",b._items[g].offsetTop+f+b._items[g].offsetHeight):b.bar.css("top",f),b.bar.width(d(b._items[g]).outerWidth()-2),b.bar.removeClass(b.toThemeProperty("vertical"))):("left"===b.position?b.bar.css("left",b._items[g].offsetLeft+c+b._items[g].offsetWidth):b.bar.css("left",b._items[g].offsetLeft+c),b.bar.css("top",f+b._items[g].offsetTop),b.bar.height(d(b._items[g]).outerHeight()-2),b.bar.addClass(b.toThemeProperty("vertical"))))})},
    _selectAt:function(b,c,e){var f=this;void 0===c&&(c=f.selectedIndex);if(b!==c||!0===e)if(f._stopAnimation(),f._refreshBarPosition(),f._allowSelection){f._animatingIndex=b;-1!==f.selectedIndex&&f._clearSelection(!0,c);f._allowSelection=!1;f._selecting=b;"click"===f.selectionMode&&d(f._items[b]).removeClass(f.toThemeProperty("jqx-fill-state-hover jqx-ribbon-item-hover"));if("popup"===f.mode&&f._roundedCorners){f._header.removeClass(f.toThemeProperty("jqx-rc-all"));switch(f.position){case "top":var g=
        "jqx-rc-t";var h="jqx-rc-b";break;case "bottom":g="jqx-rc-b";h="jqx-rc-t";break;case "left":g="jqx-rc-l";h="jqx-rc-r";break;case "right":g="jqx-rc-r",h="jqx-rc-l"}f._headerElement.className+=" "+f.toThemeProperty(g);for(e=0;e<f._items.length;e++)f._items[e].className+=" "+f.toThemeProperty(g),f._contentSections[e].className+=" "+f.toThemeProperty(h)}f._items[b].className+=" "+f.toThemeProperty("jqx-widget-content jqx-ribbon-item-selected");f._selectionToken.style.display="block";f._updatePositions(b);
        switch(f.animationType){case "fade":g=d(f._contentSections[b]);f._initAnimate(g);"none"===g.css("display")?g.fadeIn({duration:f.animationDelay,complete:function(){f._animationComplete(b,c)}}):g.fadeOut({duration:f.animationDelay,complete:function(){f._animationComplete(b,c)}});break;case "slide":g=d(f._contentSections[b]);h=f.position;"top"===h?h="up":"bottom"===h&&(h="down");f.slideAnimation=f._slide(g,{mode:"show",direction:h,duration:f.animationDelay},b,c);break;case "none":f._contentSections[b].style.display=
            "block",f._animationComplete(b,c)}}},_clearSelection:function(b,c){var e=this;"popup"===e.mode&&e._roundedCorners&&(e._headerElement.className+=" "+e.toThemeProperty("jqx-rc-all"));e._selecting=-1;void 0===c&&(c=e.selectedIndex);d(e._items[c]).removeClass(e.toThemeProperty("jqx-widget-content jqx-ribbon-item-selected"));e._selectionToken.style.display="none";if(!0!==b&&"none"!==e.animationType)if(b=d(e._contentSections[c]),"fade"===e.animationType)e._initAnimate(b),b.fadeOut({duration:e.animationDelay,
        complete:function(){e._clearSelectionComplete(c)}});else{if("slide"===e.animationType){var f=e.position;"top"===f?f="up":"bottom"===f&&(f="down");e._stopAnimation();c=e.selectedIndex;e.slideAnimation=e._slide(b,{mode:"hide",direction:f,duration:e.animationDelay},c);e.selectedIndex=-1}}else-1!==c&&(e._contentSections[c].style.display="none",e._clearSelectionComplete(c,b))},_addHandlers:function(){function b(b){b=m._closest(b.target,"li");var c=b._index;m._items[c]._disabled||(c!==m.selectedIndex?m._selectAt(c):
        "popup"===m.mode&&"none"!==m.popupCloseMode&&(b.className+=" "+m.toThemeProperty("jqx-fill-state-hover jqx-ribbon-item-hover"),m._clearSelection()))}function c(b){if(!0===m.reorder&&!0===r){var c=m._closest(b.target,"li")._index;b=m._items[t].innerHTML;for(var e=m._contentSections[t].childNodes,f=[];0<e.length;)f.push(d(e[0]).detach());m._suppressSelectionEvents=!0;m._oldReorderIndex=t;m.removeAt(t);m.clearSelection();m.addAt(c,{title:b,content:f});m.selectAt(c);setTimeout(function(){d(m._items[c]).trigger("mousedown")},
        0)}else b=m._closest(b.target,"li"),q(b._index)&&(b.className+=" "+m.toThemeProperty("jqx-fill-state-hover jqx-ribbon-item-hover"))}function e(b){b=m._closest(b.target,"li");q(b._index)&&d(b).removeClass(m.toThemeProperty("jqx-fill-state-hover jqx-ribbon-item-hover"))}function f(b){"#document"!==b.target.nodeName&&(b=m._closest(b.target,"li"),!0!==m.reorder&&!0!==m._removeByDrag||b._index!==m.selectedIndex||(r=!0,t=b._index,b.style.cursor="move"))}function g(){"mouseLeave"===m.popupCloseMode&&"popup"===
    m.mode&&m._clearSelection()}function h(b){b=m._closest(b.target,"li")._index;m._items[b]._disabled||b===m.selectedIndex||m._selectAt(b)}function k(b){b=m._closest(b.target,"li")._index;m._items[b]._disabled||"popup"===m.mode&&"none"!==m.popupCloseMode&&m._clearSelection()}function l(){"mouseLeave"===m.popupCloseMode&&"popup"===m.mode&&m._clearSelection()}var m=this,p=m.element.id,r=!1,t,w=function(b){if("click"===m.popupCloseMode&&"popup"===m.mode&&-1!==m.selectedIndex&&"svg"!==b.target.tagName){var c=
        m._closest(b.target,void 0,"jqx-ribbon");if(void 0!==c&&c.getAttribute("id")!==p)m._clearSelection();else if(void 0===b.target.className||-1!==b.target.className.indexOf("jqx-ribbon-content-popup"))m._clearSelection();else if(!d(b.target).ischildof(m.host)){var e=!1,f=[],g=function(b){b.parentElement&&(f.push(b.parentElement),g(b.parentElement))};g(b.target);d.each(f,function(){if(void 0!==this.className&&this.className.indexOf){if(-1!==this.className.indexOf("jqx-ribbon"))return e=!0,!1;if(-1!==
        this.className.indexOf("jqx-ribbon"))return p===this.id&&(e=!0),!1}});e||m._clearSelection()}}};if("click"===m.selectionMode){for(var q=function(b){return(m._selecting!==b&&!1===m._allowSelection||(-1===m._selecting||m.selectedIndex!==b)&&!0===m._allowSelection)&&!m._items[b]._disabled},u=0;u<m._items.length;u++){var y=m._items[u];m.addHandler(y,"click.ribbon"+p,b);m.addHandler(y,"mouseenter.ribbon"+p,c);m.addHandler(y,"mouseleave.ribbon"+p,e);m.addHandler(y,"mousedown.ribbon"+p,f)}if("popup"===m.mode){m.addHandler(m.host,
        "mouseleave.ribbon"+p,function(){"mouseLeave"===m.popupCloseMode&&"popup"===m.mode&&m._clearSelection()});for(u=0;u<m._contentSections.length;u++)m.addHandler(m._contentSections[u],"mouseleave.ribbon"+p,g);m.addHandler(d(document),"mousedown.ribbon"+p,function(b){w(b)})}if(!0===m._removeByDrag)for(u=0;u<m._items.length;u++)m._items[u].className+=" "+m.toThemeProperty("jqx-ribbon-item-docking-layout");m.addHandler(document,"mouseup.ribbon"+p,function(){r=!1;for(var b=0;b<m._items.length;b++)m._items[b].style.cursor=
        ""});m.addHandler(m._header,"mouseleave.ribbon"+p,function(b){!0===m._removeByDrag&&!0===r&&(m._raiseEvent("3",{draggedIndex:t,x:b.pageX,y:b.pageY}),1<m._items.length&&m.removeAt(t),r=!1,b.target.style.cursor="")})}else if("hover"===m.selectionMode){for(u=0;u<m._items.length;u++)y=m._items[u],m.addHandler(y,"mouseenter.ribbon"+p,h),"popup"===m.mode&&m.addHandler(y,"click.ribbon"+p,k);if("popup"===m.mode){m.addHandler(m.host,"mouseleave.ribbon"+p,function(){"mouseLeave"===m.popupCloseMode&&"popup"===
    m.mode&&m._clearSelection()});for(u=0;u<m._contentSections.length;u++)m.addHandler(m._contentSections,"mouseleave.ribbon"+p,l);m.addHandler(d(document),"mousedown.ribbon"+p,function(b){w(b)})}}d.jqx.mobile.isTouchDevice()?(u="touchstart",y="touchend"):(u="mousedown",y="mouseup");m.addHandler(m._scrollButtonNear,u+".ribbon"+p,function(){m._timeoutNear="horizontal"===m._orientation?setInterval(function(){m._headerElement.scrollLeft-=m.scrollStep*(m.rtl&&"msie"===m._browser.browser?-1:1);m._updatePositions()},
        m.scrollDelay):setInterval(function(){m._headerElement.scrollTop-=m.scrollStep;m._updatePositions()},m.scrollDelay);return!1});m.addHandler(m._scrollButtonFar,u+".ribbon"+p,function(){m._timeoutFar="horizontal"===m._orientation?setInterval(function(){m._headerElement.scrollLeft+=m.scrollStep*(m.rtl&&"msie"===m._browser.browser?-1:1);m._updatePositions()},m.scrollDelay):setInterval(function(){m._headerElement.scrollTop+=m.scrollStep;m._updatePositions()},m.scrollDelay);return!1});m.addHandler(d(document),
        y+".ribbon"+p,function(){clearInterval(m._timeoutNear);clearInterval(m._timeoutFar)})},_removeHandlers:function(b,c){var e=this.element.id;b||(b=this.selectionMode);c||(c=this.mode);for(var f=0;f<this._items.length;f++){var g=this._items[f];this.removeHandler(g,"mouseenter.ribbon"+e);"click"===b&&(this.removeHandler(g,"click.ribbon"+e),this.removeHandler(g,"mouseleave.ribbon"+e),this.removeHandler(g,"mousedown.ribbon"+e))}"click"===b?(this.removeHandler(document,"mouseup.ribbon"+e),this.removeHandler(this._header,
        "mouseleave.ribbon"+e)):"hover"===b&&"popup"===c&&this.removeHandler(this.host,"mouseleave.ribbon"+e);d.jqx.mobile.isTouchDevice()?(b="touchstart",c="touchend"):(b="mousedown",c="mouseup");this.removeHandler(this._scrollButtonNear,b+".ribbon"+e);this.removeHandler(this._scrollButtonFar,b+".ribbon"+e);this.removeHandler(d(document),c+".ribbon"+e)},_checkStructure:function(b){if(2!==b.length)throw Error("jqxRibbon: Invalid HTML structure. You need to add a ul and a div to the widget container.");b=
        this._header.children().length;var c=this._content.children().length;if(b!==c)throw Error("jqxRibbon: Invalid HTML structure. For each list item you must have a corresponding div element.");},_addClasses:function(){var b="jqx-widget-content jqx-ribbon-content-section jqx-ribbon-content-section-"+this.position,c="jqx-widget-content jqx-ribbon-content jqx-ribbon-content-"+this._orientation,e="jqx-widget-header jqx-disableselect jqx-ribbon-header jqx-ribbon-header-"+this._orientation,f="jqx-ribbon-item jqx-ribbon-item-"+
        this.position;this._content.removeClass();this._header.removeClass(this.toThemeProperty("jqx-rc-all jqx-widget-header jqx-disableselect jqx-rc-t jqx-rc-b jqx-rc-l jqx-rc-r jqx-rc-all jqx-ribbon-header-"+this._orientation+"-popup jqx-ribbon-header-bottom jqx-ribbon-header-auto jqx-ribbon-header-right jqx-ribbon-header-rtl"));this.host.removeClass();if(this._roundedCorners)switch(this.position){case "top":e+=" jqx-rc-t";f+=" jqx-rc-t";b+=" jqx-rc-b";break;case "bottom":e+=" jqx-rc-b";f+=" jqx-rc-b";
        b+=" jqx-rc-t";break;case "left":e+=" jqx-rc-l";f+=" jqx-rc-l";b+=" jqx-rc-r";break;case "right":e+=" jqx-rc-r",f+=" jqx-rc-r",b+=" jqx-rc-l"}else switch(this.position){case "top":f+=" jqx-rc-t";break;case "bottom":f+=" jqx-rc-b";break;case "left":f+=" jqx-rc-l";break;case "right":f+=" jqx-rc-r"}!0===this.rtl&&(e+=" jqx-ribbon-header-rtl",f+=" jqx-ribbon-item-rtl");this.element.className+=" "+this.toThemeProperty("jqx-widget jqx-ribbon");this._headerElement.className+=" "+this.toThemeProperty(e);
        this._contentElement.className+=" "+this.toThemeProperty(c);for(c=0;c<this._items.length;c++){e=d(this._contentSections[c]);var g=d(this._items[c]);e.removeClass();g.removeClass(this.toThemeProperty("jqx-fill-state-disabled jqx-ribbon-item-rtl jqx-widget-content jqx-ribbon-item-selected jqx-rc-t jqx-rc-b jqx-rc-l jqx-rc-r jqx-ribbon-item-docking-layout jqx-ribbon-item jqx-ribbon-item-"+this.position));"popup"===this.mode&&(b+=" jqx-ribbon-content-section-popup jqx-ribbon-content-popup-"+this.position+
            " jqx-ribbon-content-section-"+this._orientation+"-popup");this._contentSections[c].className+=" "+this.toThemeProperty(b);this._items[c].className+=" "+this.toThemeProperty(f)}if("popup"===this.mode)-1===this.selectedIndex&&this._roundedCorners&&(this.element.className+=" "+this.toThemeProperty("jqx-rc-all"),this._headerElement.className+=" "+this.toThemeProperty("jqx-rc-all")),this.element.className+=" "+this.toThemeProperty("jqx-ribbon-popup"),this._headerElement.className+=" "+this.toThemeProperty("jqx-ribbon-header-"+
            this._orientation+"-popup"),this._contentElement.className+=" "+this.toThemeProperty("jqx-ribbon-content-popup"),this._positionPopup();else{if("horizontal"===this._orientation)if("auto"!==this.height){var h=this._headerElement.offsetHeight;"top"===this.position?this._contentElement.style.paddingTop=this._toPx(h):this._headerElement.className+=" "+this.toThemeProperty("jqx-ribbon-header-bottom")}else this._headerElement.className+=" "+this.toThemeProperty("jqx-ribbon-header-auto");else if("vertical"===
            this._orientation)if("auto"!==this.width){var k=this._headerElement.offsetWidth;"left"===this.position?this._contentElement.style.paddingLeft=this._toPx(k):(this._headerElement.className+=" "+this.toThemeProperty("jqx-ribbon-header-right"),this._contentElement.style.paddingRight=this._toPx(k))}else this.element.className+=" "+this.toThemeProperty("jqx-ribbon-auto"),this._headerElement.className+=" "+this.toThemeProperty("jqx-ribbon-header-auto"),this._contentElement.className+=" "+this.toThemeProperty("jqx-ribbon-content-auto-width");
            this.host.addClass("jqx-tabs-header-position-"+this.position)}d(this._headerElement).addClass(this.toThemeProperty("jqx-ribbon-header-"+this.position));"7.0"===this._browser.version&&"msie"===this._browser.browser&&("horizontal"===this._orientation?(this._header.css("width",this.host.width()-parseInt(this._header.css("padding-left"),10)-parseInt(this._header.css("padding-right"),10)-parseInt(this._header.css("border-left-width"),10)-parseInt(this._header.css("border-right-width"),10)),this._items.height(this._items.height()-
            parseInt(this._items.css("padding-top"),10)-parseInt(this._items.css("padding-bottom"),10)-parseInt(this._items.css("border-top-width"),10)-parseInt(this._items.css("border-bottom-width"),10)),this._contentSections.width(this._contentSections.width()-parseInt(this._contentSections.css("border-left-width"),10)-parseInt(this._contentSections.css("border-right-width"),10)-parseInt(this._contentSections.css("padding-left"),10)-parseInt(this._contentSections.css("padding-right"),10)),"default"===this.mode&&
        "auto"!==this.height&&("top"===this.position?this._contentSections.css("padding-top",h):this._contentSections.css("padding-bottom",h),this._content.css("height",this.host.height()+2),this._contentSections.css("height",this._content.height()-parseInt(this._contentSections.css("border-bottom-width"),10)-parseInt(this._contentSections.css("border-top-width"),10)-1))):("left"===this.position?(this._contentElement.className+=" "+this.toThemeProperty("jqx-ribbon-content-left"),b=parseInt(this._contentSections.css("border-left-width"),
            10)+parseInt(this._contentSections.css("border-right-width"),10)+1):(this._contentElement.className+=" "+this.toThemeProperty("jqx-ribbon-content-right"),b=0),this._header.css("height",this.host.height()-parseInt(this._header.css("padding-top"),10)-parseInt(this._header.css("padding-bottom"),10)-parseInt(this._header.css("border-top-width"),10)-parseInt(this._header.css("border-bottom-width"),10)),this._items.width(this._items.width()-parseInt(this._items.css("padding-left"),10)-parseInt(this._items.css("padding-right"),
            10)-parseInt(this._items.css("border-left-width"),10)-parseInt(this._items.css("border-right-width"),10)),this._contentSections.height(this._contentSections.height()-parseInt(this._contentSections.css("border-top-width"),10)-parseInt(this._contentSections.css("border-bottom-width"),10)-parseInt(this._contentSections.css("padding-top"),10)-parseInt(this._contentSections.css("padding-bottom"),10)),"default"===this.mode&&"auto"!==this.width&&("left"===this.position?this._contentSections.css("padding-left",
            k):this._contentSections.css("padding-right",k),this._contentSections.width(this._content.width()-this._header.width()-b))));"bottom"===this.position&&this._content.css("padding-bottom",h)},_positionPopup:function(){var b="7.0"===this._browser.version&&"msie"===this._browser.browser;switch(this.position){case "top":this._contentElement.style.top=this._toPx(this._headerElement.offsetHeight);break;case "bottom":this._contentElement.style.bottom=b?this._toPx(this._height(this._headerElement)):this._toPx(this._headerElement.offsetHeight);
        break;case "left":this._contentElement.style.left=this._toPx(this._headerElement.offsetWidth);break;case "right":this._contentElement.style.right=this._header.outerWidth()+"px"}},_appendScrollButtons:function(){function b(b,e,d){b.className=c.toThemeProperty("jqx-ribbon-scrollbutton jqx-ribbon-scrollbutton-"+c.position+" jqx-ribbon-scrollbutton-"+c.scrollPosition+" jqx-widget-header "+e);b.innerHTML='<div class="'+c.toThemeProperty("jqx-ribbon-scrollbutton-inner "+d)+'"></div>';"horizontal"===c._orientation?
        b.style.height=c._toPx(c._height(c._headerElement)):b.style.width=c._toPx(c._width(c._headerElement));c.element.appendChild(b)}var c=this,e="horizontal"===c._orientation?["left","right"]:["up","down"],d=document.createElement("div");b(d,"jqx-ribbon-scrollbutton-lt","jqx-icon-arrow-"+e[0]);var g=document.createElement("div");b(g,"jqx-ribbon-scrollbutton-rb","jqx-icon-arrow-"+e[1]);c._scrollButtonRc(d,g);c._scrollButtonNear=d;c._scrollButtonFar=g;if(c.roundedCorners)switch(c.position){case "top":case "bottom":d.style.marginLeft=
        "-1px";g.style.marginRight="-1px";break;case "right":case "left":d.style.marginTop="-1px",g.style.marginBottom="-1px"}},_scrollButtonRc:function(b,c){if(this.roundedCorners)switch(this.position){case "top":"far"!==this.scrollPosition&&(b.className+=" "+this.toThemeProperty("jqx-rc-tl"));"near"!==this.scrollPosition&&(c.className+=" "+this.toThemeProperty("jqx-rc-tr"));break;case "bottom":"far"!==this.scrollPosition&&(b.className+=" "+this.toThemeProperty("jqx-rc-bl"));"near"!==this.scrollPosition&&
    (c.className+=" "+this.toThemeProperty("jqx-rc-br"));break;case "left":"far"!==this.scrollPosition&&(b.className+=" "+this.toThemeProperty("jqx-rc-tl"));"near"!==this.scrollPosition&&(c.className+=" "+this.toThemeProperty("jqx-rc-bl"));break;case "right":"far"!==this.scrollPosition&&(b.className+=" "+this.toThemeProperty("jqx-rc-tr")),"near"!==this.scrollPosition&&(c.className+=" "+this.toThemeProperty("jqx-rc-br"))}},_updateItems:function(b){function c(){e._items[d]._index===e.selectedIndex&&(e.selectedIndex=
        d)}var e=this;e._items=e._header.children();e._contentSections=e._content.children();for(var d=0;d<e._items.length;d++){var g=e._items[d];g.setAttribute("unselectable","on");void 0===g._index&&(g._disabled=!1,g._isInitialized=!1,e._contentSections[d]._layout="default");!0===b&&c();g._index=d;!0!==b&&c();e._contentSections[d]&&(e._contentSections[d]._index=d)}},_positionContent:function(b){var c=this,e=c._contentSections[b];if("horizontal"===c._orientation){var f=c.element.offsetWidth;var g=c.host.offset().left;
        var h=c._items[b].offsetWidth;b=d(c._items[b]).offset().left;var k=e.offsetWidth||parseInt(e.style.width,10);var l="left"}else f=c.element.offsetHeight,g=c.host.offset().top,h=c._items[b].offsetHeight,b=d(c._items[b]).offset().top,k=e.offsetHeight||parseInt(e.style.height,10),l="top";var m=function(b){0>b?b=0:b+k>f&&(b=f-k);e.style[l]=c._toPx(b)};switch(e._layout){case "near":m(b-g);break;case "far":m(b-g-(k-h));break;case "center":m(b-g-(k-h)/2);break;default:if("right"===c.position)for(g=0;g<c._contentSections.length;g++)c._contentSections[g].style.right=
        "1px";else e.style[l]=""}},_checkScrollButtons:function(b){var c=this,e=0;d.each(c._items,function(){var b=d(this);"none"!==b.css("display")&&(e+="horizontal"===c._orientation?b.outerWidth(!0):b.outerHeight(!0))});var f="horizontal"===c._orientation?["margin-left","margin-right"]:["margin-top","margin-bottom"],g="horizontal"===c._orientation?c._width(c._headerElement):c._height(c._headerElement);c._itemMargins||(c._itemMargins=[],c._itemMargins.push(d(c._items[0]).css(f[0])),c._itemMargins.push(d(c._items[c._items.length-
    1]).css(f[1])));if(e>g){c._scrollButtonNear.style.display="block";c._scrollButtonFar.style.display="block";g=c.rtl?c._itemMargins[0]:17;var h=c.rtl?c._itemMargins[0]:17;switch(c.scrollPosition){case "near":h=0;g=34;break;case "far":h=34,g=17}c._items[0]&&(c._items[0].style[f[0]]=c._toPx(g));c._items[c._items.length-1]&&(c._items[c._items.length-1].style[f[1]]=c._toPx(h))}else c._items[0]&&(c._items[0].style[f[0]]=c._toPx(c._itemMargins[0])),c._items[c._items.length-1]&&(c._items[c._items.length-1].style[f[1]]=
        c._toPx(c._itemMargins[1])),c._scrollButtonNear.style.display="none",c._scrollButtonFar.style.display="none";!0===b&&("horizontal"===c._orientation?(b=c._toPx(c._height(c._headerElement)),c._scrollButtonNear.style.height=b,c._scrollButtonFar.style.height=b):(b=c._toPx(c._width(c._headerElement)),c._scrollButtonNear.style.width=b,c._scrollButtonFar.style.width=b))},_positionSelectionToken:function(b){if(-1!==b){var c=d(this._items[b]);if(0!==c.length)if("horizontal"===this._orientation){if(!0===this.rtl){b=
        1===this._browserWidthRtlFlag?this._headerElement.scrollWidth-this._headerElement.clientWidth:0;var e=this._browserScrollRtlFlag}else b=0,e=1;e=c[0].offsetLeft+b-this._headerElement.scrollLeft*e-this._selectionTokenOffsetX+2;var f=this._headerElement.offsetHeight-1;c=this._width(c[0])+parseInt(c.css("padding-left"),10)+parseInt(c.css("padding-right"),10);"top"===this.position?(b=f-this._selectionTokenOffsetY,f=""):(b="",f-=this._selectionTokenOffsetY);this._selectionToken.style.top=this._toPx(b);
        this._selectionToken.style.bottom=this._toPx(f);this._selectionToken.style.left=this._toPx(e);this._selectionToken.style.width=this._toPx(c)}else b=c[0].offsetTop-this._headerElement.scrollTop-this._selectionTokenOffsetX+2,f=this._headerElement.offsetWidth-1,c=this._height(c[0])+parseInt(c.css("padding-top"),10)+parseInt(c.css("padding-bottom"),10),"left"===this.position?(e=f-this._selectionTokenOffsetY,f=""):(e="",f-=this._selectionTokenOffsetY),this._selectionToken.style.top=this._toPx(b),this._selectionToken.style.left=
        this._toPx(e),this._selectionToken.style.right=this._toPx(f),this._selectionToken.style.height=this._toPx(c)}},_updatePositions:function(b,c){isNaN(b)&&(b=!0===c&&null!==this._selecting&&0<=this._selecting?this._selecting:this.selectedIndex);-1!==b&&(this._positionSelectionToken(b),"popup"===this.mode&&"default"!==this._contentSections[b]._layout&&this._positionContent(b),"popup"!==this.mode||"left"!==this.position&&"right"!==this.position||(this._contentElement.style.width="auto",this._contentSections[b].style.width&&
    0<=this._contentSections[b].style.width.indexOf("%")?this._contentElement.style.width=this._toPx(this._width(this._contentSections[b])-this._width(this._headerElement)):this._contentElement.style.width=this._toPx(this._width(this._contentSections[b]))),this._refreshBarPosition())},_animationComplete:function(b,c){c=-1!==c?c:null;this._contentElement.style.pointerEvents="auto";this.selectedIndex=b;!0!==this._suppressSelectionEvents?(this._raiseEvent("0",{selectedIndex:b}),this._raiseEvent("2",{unselectedIndex:c,
        selectedIndex:b})):(!0!==this._suppressReorder&&void 0!==this._oldReorderIndex&&b!==this._oldReorderIndex&&this._raiseEvent("4",{newIndex:b,oldIndex:this._oldReorderIndex}),this._suppressReorder=this._suppressSelectionEvents=!1);this.initContent&&!1===this._items[b]._isInitialized&&(this.initContent(b),this._items[b]._isInitialized=!0);this._allowSelection=!0;this._selecting=null;this._refreshBarPosition()},_clearSelectionComplete:function(b,c){this._selecting=null;void 0===b&&(b=this.selectedIndex);
        -1!==b&&(this._contentElement.style.pointerEvents="none",!0!==this._suppressSelectionEvents&&this._raiseEvent("1",{unselectedIndex:b}));!0!==c&&(this.selectedIndex=-1)},_slide:function(b,c,e,f){var g=this;g.activeAnimations||(g.activeAnimations=[]);if(0<g.activeAnimations.length)for(var h=0;h<g.activeAnimations.length;h++)g.activeAnimations[h].clearQueue(),g.activeAnimations[h].finish();else b.clearQueue(),b.animate("finish");var k={save:function(b,c){for(var e=0;e<c.length;e++)null!==c[e]&&0<b.length&&
        b.data("ui-effects-"+c[e],b[0].style[c[e]])},restore:function(b,c){var e;for(e=0;e<c.length;e++)if(null!==c[e]){var d=b.data("ui-effects-"+c[e]);void 0===d&&(d="");b.css(c[e],d)}},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();var c={width:b.outerWidth(!0),height:b.outerHeight(!0),"float":b.css("float")},e=d("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),f={width:b.width(),height:b.height()},
            g=document.activeElement;try{g.id}catch(C){g=document.body}b.wrap(e);(b[0]===g||d.contains(b[0],g))&&d(g).focus();e=b.parent();"static"===b.css("position")?(e.css({position:"relative"}),b.css({position:"relative"})):(d.extend(c,{position:b.css("position"),zIndex:b.css("z-index")}),d.each(["top","left","bottom","right"],function(e,d){c[d]=b.css(d);isNaN(parseInt(c[d],10))&&(c[d]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"}));b.css(f);return e.css(c).show()},removeWrapper:function(b){var c=
            document.activeElement;b.parent().is(".ui-effects-wrapper")&&(b.parent().replaceWith(b),(b[0]===c||d.contains(b[0],c))&&d(c).focus());return b}},l="position top bottom left right width height".split(" "),m=c.mode;h="show"===m;var p=c.direction||"left",r="up"===p||"down"===p?"top":"left";p="up"===p||"left"===p;var t={};k.save(b,l);b.show();var w=c.distance||b["top"===r?"outerHeight":"outerWidth"](!0);k.createWrapper(b).css({overflow:"hidden"});h&&b.css(r,p?isNaN(w)?"-"+w:-w:w);t[r]=(h?p?"+=":"-=":
        p?"-=":"+=")+w;g.activeAnimations.push(b);b.animate(t,{duration:c.duration,easing:c.easing,complete:function(){g.activeAnimations.pop(b);"show"===m?g._animationComplete(e,f):"hide"===m&&(b.hide(),g._clearSelectionComplete(e));k.restore(b,l);k.removeWrapper(b)}});return function(){b.clearQueue();b.stop(!0,!0)}},_toPx:function(b){return"number"===typeof b?b+"px":b},_width:function(b){var c=d(b),e=c.css("border-left-width"),f=c.css("border-right-width"),g=parseInt(c.css("padding-left"),10),h=parseInt(c.css("padding-right"),
        10);if(c="none"===c.css("display")?!0:!1)b.style.display="block";e=-1===e.indexOf("px")?1:parseInt(e,10);f=-1===f.indexOf("px")?1:parseInt(f,10);e=b.offsetWidth-(e+f+g+h);c&&(b.style.display="none");return Math.max(0,e)},_height:function(b){var c=d(b),e=c.css("border-top-width"),f=c.css("border-bottom-width"),g=parseInt(c.css("padding-top"),10);c=parseInt(c.css("padding-bottom"),10);e=-1===e.indexOf("px")?1:parseInt(e,10);f=-1===f.indexOf("px")?1:parseInt(f,10);return Math.max(0,b.offsetHeight-(e+
        f+g+c))},_closest:function(b,c,e){if(c){if(b.nodeName.toLowerCase()===c)return b;for(var d=b.parentNode;null!==d&&"#document"!==d.nodeName;){if(d.nodeName.toLowerCase()===c)return d;d=d.parentNode}}if(e){if(-1<(" "+b.className+" ").replace(/[\n\t]/g," ").indexOf(" "+e+" "))return b;for(b=b.parentNode;null!==b&&"#document"!==b.nodeName;){if(-1<(" "+b.className+" ").replace(/[\n\t]/g," ").indexOf(" "+e+" "))return b;b=b.parentNode}}},_initAnimate:function(b){b.initAnimate&&!b.animate&&b.initAnimate()}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxRadioButton","",{});d.extend(d.jqx._jqxRadioButton.prototype,{defineInstance:function(){var b={animationShowDelay:300,animationHideDelay:300,width:null,height:null,boxSize:"16px",checked:!1,hasThreeStates:!1,disabled:!1,enableContainerClick:!0,locked:!1,groupName:"",rtl:!1,changeType:null,_canFocus:!0,aria:{"aria-checked":{name:"checked",type:"boolean"},"aria-disabled":{name:"disabled",type:"boolean"}},events:["checked","unchecked","indeterminate","change"]};if(this===
        d.jqx._jqxRadioButton.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(b){this._createFromInput("RadioButton");this.render()},_createFromInput:function(b){if("input"==this.element.nodeName.toLowerCase()){this.field=this.element;this.field.className&&(this._className=this.field.className);var c={title:this.field.title};this.field.value&&(c.value=this.field.value);this.field.checked&&(c.checked=!0);c.id=this.field.id.length?this.field.id.replace(/[^\w]/g,"_")+"_"+b:d.jqx.utilities.createId()+
        "_"+b;var e=this.element.nextSibling,f=!1;!e||"#text"!=e.nodeName&&"span"!=e.nodeName||(f=!0);var g=0;b=d("<div></div>",c);f&&(b.append(e),e=d("<span>"+d(e).text()+"</span>"),e.appendTo(d(document.body)),g+=e.width(),e.remove());b[0].style.cssText=this.field.style.cssText;this.width||(this.width=d(this.field).width()+g+10);this.height||(this.height=d(this.field).outerHeight()+10);d(this.field).hide().after(b);g=this.host.data();this.host=b;this.host.data(g);this.element=b[0];this.element.id=this.field.id;
        this.field.id=c.id;this._className&&(this.host.addClass(this._className),d(this.field).removeClass(this._className));this.field.tabIndex&&(c=this.field.tabIndex,this.field.tabIndex=-1,this.element.tabIndex=c)}},render:function(){this.setSize();var b=this;this.propertyChangeMap.width=function(c,e,d,f){b.setSize()};this.propertyChangeMap.height=function(c,e,d,f){b.setSize()};this.radiobutton&&this.radiobutton.remove();this.width||this.host.css("overflow-x","visible");this.height||this.host.css("overflow-y",
        "visible");null==this.boxSize&&(this.boxSize=16);var c=parseInt(this.boxSize)+"px",e=Math.floor((parseInt(this.boxSize)-16)/2),f=e;e+="px";f+="px";var g=parseInt(this.boxSize)/2+"px";this.radiobutton="16px"!=this.boxSize?d('<div><div style="width: '+c+"; height: "+c+';"><span style="position: relative; left: '+e+"; top: "+f+'; width: 16px; height: 16px;"></span></div></div>'):d('<div><div style="width: '+c+"; height: "+c+';"><span style="width: '+g+"; height: "+g+';"></span></div></div>');this.host.attr("role",
        "radio");this.host.prepend(this.radiobutton);this.disabledContainer||(this.host.attr("tabIndex")||this.host.attr("tabIndex",0),this.clear=d('<div style="clear: both;"></div>'),this.host.append(this.clear));this.checkMark=d(this.radiobutton[0].firstChild.firstChild);this.box=this.radiobutton;this._supportsRC=!0;d.jqx.browser.msie&&9>d.jqx.browser.version&&(this._supportsRC=!1);this.box.addClass(this.toThemeProperty("jqx-fill-state-normal"));this.box.addClass(this.toThemeProperty("jqx-radiobutton-default"));
        this.host.addClass(this.toThemeProperty("jqx-widget"));this.disabled&&this.disable();this.host.addClass(this.toThemeProperty("jqx-radiobutton"));this.locked&&this.host.css("cursor","auto");c=this.element.getAttribute("checked");if("checked"==c||"true"==c||1==c)this.checked=!0;this._addInput();this._render();this._addHandlers();d.jqx.aria(this);this._centerBox();this.isMaterialized()&&(d(this.radiobutton).addClass("ripple"),d.jqx.ripple(d(this.radiobutton),this.host,"radiobutton"))},_centerBox:function(){if(this.height&&
        -1==this.height.toString().indexOf("%")&&this.box){var b=parseInt(this.height);this.host.css("line-height",b+"px");b=b-parseInt(this.boxSize)-1;this.box.css("margin-top",parseInt(b/2))}},_addInput:function(){var b=this.host.attr("name");this.input=d("<input type='hidden'/>");this.host.append(this.input);b&&this.input.attr("name",b)},refresh:function(b){b||(this.setSize(),this._render())},resize:function(b,c){this.width=b;this.height=c;this.setSize()},setSize:function(){null!=this.width&&-1!=this.width.toString().indexOf("px")?
        this.host.width(this.width):void 0==this.width||isNaN(this.width)?null!=this.width&&-1!=this.width.toString().indexOf("%")&&(this.element.style.width=this.width):this.host.width(this.width);null!=this.height&&-1!=this.height.toString().indexOf("px")?this.host.height(this.height):void 0==this.height||isNaN(this.height)?null!=this.height&&-1!=this.height.toString().indexOf("%")&&(this.element.style.height=this.height):this.host.height(this.height);this._centerBox()},_addHandlers:function(){var b=this;
        this.addHandler(this.box,"click",function(c){if(!b.disabled&&!b.enableContainerClick)return b.changeType="mouse",b.toggle("click"),c.preventDefault(),!1});this.addHandler(this.host,"keydown",function(c){if(!b.disabled&&!b.locked&&32==c.keyCode){if(!b._canFocus)return!0;b.changeType="keyboard";b.toggle("click");c.preventDefault();return!1}});this.addHandler(this.host,"mousedown",function(c){if(!b.disabled&&b.enableContainerClick)return b.clickTime=new Date,b.changeType="mouse",b.toggle("click"),b._canFocus&&
        b.focus(),c.preventDefault(),!1});this.addHandler(this.host,"selectstart",function(c){!b.disabled&&b.enableContainerClick&&c.preventDefault()});this.addHandler(this.host,"mouseup",function(c){!b.disabled&&b.enableContainerClick&&c.preventDefault()});this.addHandler(this.host,"focus",function(c){if(!b.disabled&&b.enableContainerClick&&!b.locked)return d(b.radiobutton).removeClass("active"),(!b.clickTime||b.clickTime&&300<new Date-b.clickTime)&&d(b.radiobutton).addClass("active"),b.box.addClass(b.toThemeProperty("jqx-radiobutton-hover")),
            b.box.addClass(b.toThemeProperty("jqx-fill-state-focus")),c.preventDefault(),!1});this.addHandler(this.host,"blur",function(c){d(b.radiobutton).removeClass("active");if(!b.disabled&&b.enableContainerClick&&!b.locked)return b.box.removeClass(b.toThemeProperty("jqx-radiobutton-hover")),b.box.removeClass(b.toThemeProperty("jqx-fill-state-focus")),c.preventDefault(),!1});this.addHandler(this.host,"mouseenter",function(c){if(!b.disabled&&b.enableContainerClick&&!b.locked)return b.box.addClass(b.toThemeProperty("jqx-radiobutton-hover")),
            b.box.addClass(b.toThemeProperty("jqx-fill-state-hover")),c.preventDefault(),!1});this.addHandler(this.host,"mouseleave",function(c){if(!b.disabled&&b.enableContainerClick&&!b.locked)return b.box.removeClass(b.toThemeProperty("jqx-radiobutton-hover")),b.box.removeClass(b.toThemeProperty("jqx-fill-state-hover")),c.preventDefault(),!1});this.addHandler(this.box,"mouseenter",function(){b.disabled||b.enableContainerClick||(b.box.addClass(b.toThemeProperty("jqx-radiobutton-hover")),b.box.addClass(b.toThemeProperty("jqx-fill-state-hover")))});
        this.addHandler(this.box,"mouseleave",function(){b.disabled||b.enableContainerClick||(b.box.removeClass(b.toThemeProperty("jqx-radiobutton-hover")),b.box.removeClass(b.toThemeProperty("jqx-fill-state-hover")))})},focus:function(){try{this.host.focus()}catch(b){}},_removeHandlers:function(){this.removeHandler(this.box,"click");this.removeHandler(this.box,"mouseenter");this.removeHandler(this.box,"mouseleave");this.removeHandler(this.host,"click");this.removeHandler(this.host,"mouseup");this.removeHandler(this.host,
        "mousedown");this.removeHandler(this.host,"selectstart");this.removeHandler(this.host,"mouseenter");this.removeHandler(this.host,"mouseleave");this.removeHandler(this.host,"keydown");this.removeHandler(this.host,"focus");this.removeHandler(this.host,"blur")},_render:function(){null==this.boxSize&&(this.boxSize=13);this.box.width(this.boxSize);this.box.height(this.boxSize);this.disabled?this.disable():this.enableContainerClick?this.host.css("cursor","pointer"):this.host.css("cursor","auto");this.rtl&&
    (this.box.addClass(this.toThemeProperty("jqx-radiobutton-rtl")),this.host.addClass(this.toThemeProperty("jqx-rtl")));this.updateStates()},val:function(b){if(0==arguments.length||"object"==typeof b)return this.checked;"string"==typeof b?("true"==b&&this.check("api"),"false"==b&&this.uncheck("api"),""==b&&this.indeterminate("api")):(1==b&&this.check("api"),0==b&&this.uncheck("api"),null==b&&this.indeterminate("api"));return this.checked},check:function(b){this.checked=!0;var c=this;this.checkMark.removeClass();
        this.checkMark.addClass(this.toThemeProperty("jqx-fill-state-pressed"));d.jqx.browser.msie?(this.disabled&&this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-disabled")),this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-checked"))):(this.disabled&&this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-disabled")),this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-checked")),this.checkMark.css("opacity",0),this.checkMark.stop().animate({opacity:1},
            this.animationShowDelay,function(){}));var e=d.find(".jqx-radiobutton");null==this.groupName&&(this.groupName="");d.each(e,function(){d(this).jqxRadioButton("groupName")==c.groupName&&this!=c.element&&d(this).jqxRadioButton("uncheck","api")});e=this.changeType;this._raiseEvent("0");this.changeType=e;this._raiseEvent("3",{type:b,checked:!0});0==this.checkMark.height()?(b=parseInt(this.boxSize)/2,this.checkMark.height(b),this.checkMark.width(b)):"13px"!=this.boxSize&&(b=parseInt(this.boxSize)/2,this.checkMark.height(b),
            this.checkMark.width(b),this.checkMark.css("margin-left",1+b/4),this.checkMark.css("margin-top",1+b/4));this.input.val(this.checked);d.jqx.aria(this,"aria-checked",this.checked);this.host.attr("checked",this.checked)},uncheck:function(b){var c=this.checked;this.checked=!1;var e=this;d.jqx.browser.msie?e.checkMark.removeClass():(this.checkMark.css("opacity",1),this.checkMark.stop().animate({opacity:0},this.animationHideDelay,function(){e.checkMark.removeClass()}));c&&(c=this.changeType,this._raiseEvent("1"),
        this.changeType=c,this._raiseEvent("3",{type:b,checked:!1}));this.input.val(this.checked);d.jqx.aria(this,"aria-checked",this.checked);this.host.attr("checked",this.checked)},indeterminate:function(b){var c=this.checked;this.checked=null;this.checkMark.removeClass();d.jqx.browser.msie?this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-indeterminate")):(this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-indeterminate")),this.checkMark.css("opacity",0),this.checkMark.stop().animate({opacity:1},
        this.animationShowDelay,function(){}));null!=c&&(c=this.changeType,this._raiseEvent("2"),this.changeType=c,this._raiseEvent("3",{type:b,checked:null}));this.input.val(this.checked);d.jqx.aria(this,"aria-checked","undefined");this.host.attr("checked","undefined")},toggle:function(b){if(!this.disabled&&!this.locked){var c=this.checked;this.checked=1==this.checked?this.hasTreeStates?null:!0:!0;c!=this.checked&&this.updateStates(b);this.input.val(this.checked)}},updateStates:function(b){this.checked?
        this.check(b):0==this.checked?this.uncheck(b):null==this.checked&&this.indeterminate(b)},disable:function(){this.disabled=!0;1==this.checked?this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-disabled")):null==this.checked&&this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-indeterminate-disabled"));this.box.addClass(this.toThemeProperty("jqx-radiobutton-disabled"));this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));d.jqx.aria(this,"aria-disabled",
        this.disabled)},enable:function(){this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled"));1==this.checked?this.checkMark.removeClass(this.toThemeProperty("jqx-radiobutton-check-disabled")):null==this.checked&&this.checkMark.removeClass(this.toThemeProperty("jqx-radiobutton-check-indeterminate-disabled"));this.box.removeClass(this.toThemeProperty("jqx-radiobutton-disabled"));this.disabled=!1;d.jqx.aria(this,"aria-disabled",this.disabled)},destroy:function(){this._removeHandlers();this.host.remove()},
    _raiseEvent:function(b,c){b=new d.Event(this.events[b]);b.owner=this;c||(c={});c.type=this.changeType;this.changeType=null;b.args=c;try{var e=this.host.trigger(b)}catch(f){}return e},propertiesChangedHandler:function(b,c,e){e.width&&e.height&&2==Object.keys(e).length&&b.setSize()},propertyChangedHandler:function(b,c,e,f){if(void 0!=this.isInitialized&&0!=this.isInitialized&&!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length)){c!=this.enableContainerClick||
    this.disabled||this.locked||(f?this.host.css("cursor","pointer"):this.host.css("cursor","auto"));"rtl"==c&&(f?(b.box.addClass(b.toThemeProperty("jqx-radiobutton-rtl")),b.host.addClass(b.toThemeProperty("jqx-rtl"))):(b.box.removeClass(b.toThemeProperty("jqx-radiobutton-rtl")),b.host.removeClass(b.toThemeProperty("jqx-rtl"))));"boxSize"==c&&b.render();if("checked"==c)switch(f){case !0:this.check("api");break;case !1:this.uncheck("api");break;case null:this.indeterminate()}"theme"==c&&d.jqx.utilities.setTheme(e,
        f,this.host);"disabled"==c&&(f?this.disable():this.enable())}}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxSplitter","",{});d.extend(d.jqx._jqxSplitter.prototype,{defineInstance:function(){var b={width:300,height:300,panels:[],orientation:"vertical",disabled:!1,splitBarSize:5,touchSplitBarSize:15,panel1:null,panel2:null,_eventsMap:{mousedown:d.jqx.mobile.getTouchEventName("touchstart"),mouseup:d.jqx.mobile.getTouchEventName("touchend"),mousemove:d.jqx.mobile.getTouchEventName("touchmove"),mouseenter:"mouseenter",mouseleave:"mouseleave"},_isTouchDevice:!1,_isNested:!1,resizable:!0,
        touchMode:"auto",showSplitBar:!0,initContent:null,_events:["resize","expanded","collapsed","resizeStart","layout"]};if(this===d.jqx._jqxSplitter.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(){this.render()},_initOverlay:function(b){this.overlay||"undefined"==b?(this.overlay.remove(),this.overlay=null):1==b&&(this.overlay=d("<div style='z-index: 100; background: #fff;'></div>"),this.overlay.css("opacity",.01),this.overlay.css("position","absolute"),this.overlay.appendTo(d(document.body)),
        this.host.coord(),this.overlay.css("left","0px"),this.overlay.css("top","0px"),this.overlay.width(d(window).width()),this.overlay.height(d(window).height()),this.overlay.addClass("jqx-disableselect"),"horizontal"==this.orientation?this.overlay.css("cursor","row-resize"):this.overlay.css("cursor","col-resize"))},_startDrag:function(b){return b.target==this.splitBarButton[0]||this.disabled||this.panels[0].collapsed||this.panels[1].collapsed||!this.resizable?!0:null==this.overlay?(this._dragging=!0,
        this._initOverlay(!0),this._dragStart=d.jqx.position(b),!1):!0},_drag:function(b){if(this.panels[0].collapsed||this.panels[1].collapsed||this.disabled||!this._dragging)return!0;var c="horizontal"==this.orientation?"top":"left",e="vertical"==this.orientation?"width":"height";this._position=d.jqx.position(b);if(this.overlay&&!this._splitBarClone&&3<=Math.abs(this._position[c]-this._dragStart[c]))b=this.splitBar.coord(),this._cloneStart={left:b.left,top:b.top},this._splitBarClone=this._createSplitBarClone(),
        this._raiseEvent(3,{panels:this.panels});else{if(this._splitBarClone){var f=this.host[e](),g=f/100;e=this._splitBarClone[e]()+2;var h=parseInt(this.host.coord()[c]);var k=this._position[c]-this._dragStart[c]+this._cloneStart[c]-h;0>k&&(k=0);k>f+0-e&&(k=f+0-e);h=this.panels[0].min;var l=this.panels[1].min;-1!=l.toString().indexOf("%")&&(l=parseFloat(l)*g);-1!=h.toString().indexOf("%")&&(h=parseFloat(h)*g);this._splitBarClone.removeClass(this.toThemeProperty("jqx-splitter-splitbar-invalid"));k<h&&(this._splitBarClone.addClass(this.toThemeProperty("jqx-splitter-splitbar-invalid")),
        k=h);k>f+0-e-l&&(this._splitBarClone.addClass(this.toThemeProperty("jqx-splitter-splitbar-invalid")),k=f+0-e-l);this._splitBarClone.css(c,k);b.preventDefault&&b.preventDefault();b.stopPropagation&&b.stopPropagation();return!1}return!0}},resize:function(b,c){this.width=b;this.height=c;this._arrange()},_resize:function(){var b="horizontal"==this.orientation?"height":"width",c=this._splitBarClone.css("horizontal"==this.orientation?"top":"left");b=this.host[b]();var e=1/(b/100);-1!=this.panels[0].size.toString().indexOf("%")?
        (this.panels[0].size=parseFloat(c)*e+"%",this.panels[1].size=100-parseFloat(c)*e+"%"):(this.panels[0].size=parseFloat(c),this.panels[1].size=b-parseFloat(c));this._layoutPanels();this._raiseEvent(0,{panels:this.panels})},_stopDrag:function(){this._dragging&&this._initOverlay();this._dragging=!1;if(this._splitBarClone){if(this.panels[0].collapsed||this.panels[1].collapsed||this.disabled)return!0;this._resize();this._splitBarClone.remove();this._splitBarClone=null}},_createSplitBarClone:function(){var b=
        this.splitBar.clone();b.fadeTo(0,.7);b.css("z-index",99999);"vertical"==this.orientation?b.css("cursor","col-resize"):b.css("cursor","row-resize");this.host.append(b);return b},_eventName:function(b){return this._isTouchDevice?this._eventsMap[b]:b},_addHandlers:function(){var b=this;d.jqx.utilities.resize(this.host,function(){b._layoutPanels()});this.addHandler(this.splitBar,"dragstart."+this.element.id,function(b){return!1});this.splitBarButton&&(this.addHandler(this.splitBarButton,"click."+this.element.id,
        function(){b.panels[0].collapsible?b.panels[0].collapsed?b.expand():b.collapse():b.panels[1].collapsible&&(b.panels[1].collapsed?b.expand():b.collapse())}),this.addHandler(this.splitBarButton,this._eventName("mouseenter"),function(){b.splitBarButton.addClass(b.toThemeProperty("jqx-splitter-collapse-button-hover"));b.splitBarButton.addClass(b.toThemeProperty("jqx-fill-state-hover"))}),this.addHandler(this.splitBarButton,this._eventName("mouseleave"),function(){b.splitBarButton.removeClass(b.toThemeProperty("jqx-splitter-collapse-button-hover"));
        b.splitBarButton.removeClass(b.toThemeProperty("jqx-fill-state-hover"))}));this.addHandler(d(document),this._eventName("mousemove")+"."+this.element.id,function(c){return b._drag(c)});this.addHandler(d(document),this._eventName("mouseup")+"."+this.element.id,function(){return b._stopDrag()});this.addHandler(this.splitBar,this._eventName("mousedown"),function(c){return b._startDrag(c)});this.addHandler(this.splitBar,this._eventName("mouseenter"),function(){b.resizable&&!b.disabled&&(b.splitBar.addClass(b.toThemeProperty("jqx-splitter-splitbar-hover")),
        b.splitBar.addClass(b.toThemeProperty("jqx-fill-state-hover")))});this.addHandler(this.splitBar,this._eventName("mouseleave"),function(){b.resizable&&!b.disabled&&(b.splitBar.removeClass(b.toThemeProperty("jqx-splitter-splitbar-hover")),b.splitBar.removeClass(b.toThemeProperty("jqx-fill-state-hover")))});if((""!=document.referrer||window.frameElement)&&null!=window.top&&window.top!=window.self){var c=null;window.parent&&document.referrer&&(c=document.referrer);c&&-1!=c.indexOf(document.location.host)&&
    (c=function(c){b._stopDrag()},window.top.document.addEventListener?window.top.document.addEventListener("mouseup",c,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",c))}},_removeHandlers:function(){this.removeHandler(d(window),"resize."+this.element.id);this.splitBarButton&&(this.removeHandler(this.splitBarButton,"click."+this.element.id),this.removeHandler(this.splitBarButton,this._eventName("mouseenter")),this.removeHandler(this.splitBarButton,this._eventName("mouseleave")));
        this.removeHandler(d(document),this._eventName("mousemove")+"."+this.element.id);this.removeHandler(d(document),this._eventName("mouseup")+"."+this.element.id);this.splitBar&&(this.removeHandler(this.splitBar,"dragstart."+this.element.id),this.removeHandler(this.splitBar,this._eventName("mousedown")),this.removeHandler(this.splitBar,this._eventName("mouseenter")),this.removeHandler(this.splitBar,this._eventName("mouseleave")))},render:function(){this.splitBar&&this.splitBar.remove();var b=this.host.children();
        if(2!=b.length)throw"Invalid HTML Structure! jqxSplitter requires 1 container DIV tag and 2 nested DIV tags.";if(2==b.length){var c=b[0].className.split(" ");b=b[1].className.split(" ");if(-1!=c.indexOf("jqx-reset")&&-1!=c.indexOf("jqx-splitter")&&-1!=c.indexOf("jqx-widget"))throw"Invalid HTML Structure! Nested jqxSplitter cannot be initialized from a Splitter Panel. You need to add a new DIV tag inside the Splitter Panel and initialize the nested jqxSplitter from it!";if(-1!=b.indexOf("jqx-reset")&&
            -1!=b.indexOf("jqx-splitter")&&-1!=b.indexOf("jqx-widget"))throw"Invalid HTML Structure! Nested jqxSplitter cannot be initialized from a Splitter Panel. You need to add a new DIV tag inside the Splitter Panel and initialize the nested jqxSplitter from it!";}if(0<this.host.parent().length&&-1!=this.host.parent()[0].className.indexOf("jqx-splitter")){if(-1!=this.element.className.indexOf("jqx-splitter-panel"))throw"Invalid HTML Structure! Nested jqxSplitter cannot be initialized from a Splitter Panel. You need to add a new DIV tag inside the Splitter Panel and initialize the nested jqxSplitter from it!";
            this._isNested=!0;300==this.width&&(this.width="100%");300==this.height&&(this.height="100%");"100%"==this.width&&"100%"==this.height&&(this.host.addClass("jqx-splitter-nested"),-1!=this.host.parent()[0].className.indexOf("jqx-splitter-panel")&&this.host.parent().addClass("jqx-splitter-panel-nested"))}this._hasBorder=0==this.host.hasClass("jqx-hideborder")||""!=this.element.style.borderTopWidth;this._removeHandlers();this._isTouchDevice=d.jqx.mobile.isTouchDevice();this._validate();this.panel1.css("left",
            "0px");this.panel1.css("top","0px");this.panel2.css("left","0px");this.panel2.css("top","0px");this.splitBar=d("<div><div></div></div>");this.resizable||this.splitBar.css("cursor","default");this.splitBarButton=this.splitBar.find("div:last");this._setTheme();this.splitBar.insertAfter(this.panel1);this._arrange();0==this.panels[0].collapsible&&0==this.panels[1].collapsible&&this.splitBarButton.hide();this._addHandlers();this.initContent&&this.initContent();this.disabled&&this.disable()},_hiddenParent:function(){return d.jqx.isHidden(this.host)},
    _setTheme:function(){this.panel1.addClass(this.toThemeProperty("jqx-widget-content"));this.panel2.addClass(this.toThemeProperty("jqx-widget-content"));this.panel1.addClass(this.toThemeProperty("jqx-splitter-panel"));this.panel2.addClass(this.toThemeProperty("jqx-splitter-panel"));this.panel1.addClass(this.toThemeProperty("jqx-reset"));this.panel2.addClass(this.toThemeProperty("jqx-reset"));this.host.addClass(this.toThemeProperty("jqx-reset"));this.host.addClass(this.toThemeProperty("jqx-splitter"));
        this.host.addClass(this.toThemeProperty("jqx-widget"));this.host.addClass(this.toThemeProperty("jqx-widget-content"));this.splitBar.addClass(this.toThemeProperty("jqx-splitter-splitbar-"+this.orientation));this.splitBar.addClass(this.toThemeProperty("jqx-fill-state-normal"));this.splitBarButton.addClass(this.toThemeProperty("jqx-splitter-collapse-button-"+this.orientation));this.splitBarButton.addClass(this.toThemeProperty("jqx-fill-state-pressed"))},_validate:function(){var b=this.host.children();
        if(2!=b.length)throw"Invalid HTML Structure! jqxSplitter requires two nested DIV tags!";this.panels&&!this.panels[1]?this.panels[0]?this.panels[1]={}:this.panels=[{size:"50%"},{size:"50%"}]:void 0==this.panels&&(this.panels=[{size:"50%"},{size:"50%"}]);b=this.host.children();this.panel1=this.panels[0].element=d(b[0]);this.panel2=this.panels[1].element=d(b[1]);this.panel1[0].style.minWidth="";this.panel1[0].style.maxWidth="";this.panel2[0].style.minWidth="";this.panel2[0].style.maxWidth="";d.each(this.panels,
            function(){void 0==this.min&&(this.min=0);void 0==this.size&&(this.size=0);0>this.size&&(this.size=0);0>this.min&&(this.min=0);void 0==this.collapsible&&(this.collapsible=!0);void 0==this.collapsed&&(this.collapsed=!1);0!=this.size&&(-1!=this.size.toString().indexOf("px")&&(this.size=parseInt(this.size)),-1==this.size.toString().indexOf("%")?parseInt(this.min)>parseInt(this.size)&&(this.min=this.size):-1!=this.min.toString().indexOf("%")&&parseInt(this.min)>parseInt(this.size)&&(this.min=this.size))})},
    _arrange:function(){if(null!=this.width){var b=this.width;"string"!=typeof b&&(b=parseInt(this.width)+"px");this.host.css("width",b)}null!=this.height&&(b=this.height,"string"!=typeof b&&(b=parseInt(this.height)+"px"),this.host.css("height",b));this._splitBarSize=this._isTouchDevice?this.touchSplitBarSize:this.splitBarSize;this.showSplitBar||(this._splitBarSize=0,this.splitBar.hide());b="horizontal"==this.orientation?"width":"height";this.splitBar.css(b,"100%");this.panel1.css(b,"100%");this.panel2.css(b,
        "100%");"horizontal"==this.orientation?this.splitBar.height(this._splitBarSize):this.splitBar.width(this._splitBarSize);"vertical"===this.orientation?(this.splitBarButton.width(this._splitBarSize),this.splitBarButton.height(45)):(this.splitBarButton.height(this._splitBarSize),this.splitBarButton.width(45));this.splitBarButton.css("position","relative");"vertical"===this.orientation?(this.splitBarButton.css("top","50%"),this.splitBarButton.css("left","0"),this.splitBarButton.css("margin-top","-23px"),
        this.splitBarButton.css("margin-left","-0px")):(this.splitBarButton.css("left","50%"),this.splitBarButton.css("top","0"),this.splitBarButton.css("margin-left","-23px"),this.splitBarButton.css("margin-top","-0px"));this._layoutPanels()},collapse:function(){if(!this.disabled){var b=-1;this.panels[0].collapsed=this.panels[1].collapsed=!1;this.panels[0].element[0].style.visibility="inherit";this.panels[1].element[0].style.visibility="inherit";this.panels[0].collapsible?b=0:this.panels[1].collapsible&&
        (b=1);-1!=b&&(this.panels[b].collapsed=!0,this.panels[b].element[0].style.visibility="hidden",this.splitBar.addClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed")),this._layoutPanels(),this._raiseEvent(2,{index:b,panels:this.panels}),this._raiseEvent(0,{panels:this.panels}))}},expand:function(){if(!this.disabled){var b=-1;this.panels[0].collapsed=this.panels[1].collapsed=!1;this.panels[0].element[0].style.visibility="inherit";this.panels[1].element[0].style.visibility="inherit";this.panels[0].collapsible?
        b=0:this.panels[1].collapsible&&(b=1);-1!=b&&(this.panels[b].collapsed=!1,this.panels[b].element[0].style.visibility="inherit",this.splitBar.removeClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed")),this._layoutPanels(),this._raiseEvent(1,{index:b,panels:this.panels}),this._raiseEvent(0,{panels:this.panels}))}},disable:function(){this.disabled=!0;this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));this.splitBar.addClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed"));
        this.splitBarButton.addClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed"))},enable:function(){this.disabled=!1;this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled"));this.splitBar.removeClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed"));this.splitBarButton.removeClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed"))},refresh:function(b){1!=b&&this._arrange()},propertyChangedHandler:function(b,c,e,f){"panels"===c||"orientation"===c||"showSplitBar"===c?
        b.render():("touchMode"===c&&(b._isTouchDevice=f),"disabled"===c?f?b.disable():b.enable():"theme"===c?d.jqx.utilities.setTheme(e,f,b.host):b.refresh())},_layoutPanels:function(){var b="horizontal"==this.orientation?"height":"width",c="horizontal"==this.orientation?"top":"left",e,d,g=parseInt(this._splitBarSize)+2;this.showSplitBar||(g=0);var h=this.host[b](),k=h/100,l=1/k,m=l*g,p=this.panel1,r=this.panel2,t=this.panels[0].size;this.panels[0].collapsed&&(e=!0);this.panels[1].collapsed&&(d=!0);var w=
        this.panels[0].min;var q=this.panels[1].min;-1!=q.toString().indexOf("%")&&(q=parseFloat(q)*k);-1!=w.toString().indexOf("%")&&(w=parseFloat(w)*k);this._isNested&&this._isTouchDevice&&("horizontal"==this.orientation?(p.width(this.host.width()),r.width(this.host.width())):(p.height(this.host.height()),r.height(this.host.height())));if(e)w=Math.max(q,h-g),p[b](0),r[b](w);else if(d)w=Math.max(w,h-g),r[b](0),p[b](w);else if(-1!=t.toString().indexOf("%"))e=100-parseFloat(t),p.css(b,parseFloat(t)+"%"),r.css(b,
        e-m+"%"),e=r[b](),e<q&&(q=(e-q)*l,t=parseFloat(t)+parseFloat(q),e=100-parseFloat(t),p.css(b,parseFloat(t)+"%"),r.css(b,e-m+"%")),p[b]()<w&&p.css(b,parseFloat(w*l)+"%");else{e=h-t-g;if(p[0].style[b]!=t+"px")p[b](t);if(r[0].style[b]!=e+"px")r[b](e);e<q&&(t+=e-q,r[b](q),p[b](t));if(t<w)p[b](w)}b=this.panel1[b]();this.splitBar[0].style[c]!=b+"px"&&("vertical"==this.orientation?(this.splitBar[0].style.borderLeftColor="",this.splitBar[0].style.borderRightColor="",this.splitBarButton[0].style.width=parseInt(this._splitBarSize)+
        "px",this.splitBarButton[0].style.left="0px"):(this.splitBar[0].style.borderTopColor="",this.splitBar[0].style.borderBottomColor="",this.splitBarButton[0].style.height=parseInt(this._splitBarSize)+"px",this.splitBarButton[0].style.top="0px"),this._hasBorder&&(h-g==b?"vertical"==this.orientation?(this.splitBar[0].style.borderRightColor="transparent",this.splitBarButton[0].style.width=parseInt(this._splitBarSize+1)+"px"):(this.splitBar[0].style.borderBottomColor="transparent",this.splitBarButton[0].style.height=
        parseInt(this._splitBarSize+1)+"px"):0==b&&("vertical"==this.orientation?(this.splitBar[0].style.borderLeftColor="transparent",this.splitBarButton[0].style.width=parseInt(this._splitBarSize+1)+"px",this.splitBarButton[0].style.left="-1px"):(this.splitBar[0].style.borderTopColor="transparent",this.splitBarButton[0].style.height=parseInt(this._splitBarSize+1)+"px",this.splitBarButton[0].style.top="-1px"))),this.splitBar[0].style[c]=b+"px");this.panel2[0].style[c]!=b+g+"px"&&(this.panel2[0].style[c]=
        b+g+"px");this._raiseEvent(4,{panels:this.panels})},destroy:function(){this._removeHandlers();d.jqx.utilities.resize(this.host,null,!0);this.host.remove()},_raiseEvent:function(b,c){b=new d.Event(this._events[b]);b.owner=this;b.args=c;c=[{},{}];c[0].size="vertical"==this.orientation?this.panel1[0].offsetWidth:this.panel1[0].offsetHeight;c[1].size="vertical"==this.orientation?this.panel2[0].offsetWidth:this.panel2[0].offsetHeight;c[0].min=this.panels[0].min;c[1].min=this.panels[1].min;c[0].collapsible=
        this.panels[0].collapsible;c[1].collapsible=this.panels[1].collapsible;c[0].collapsed=this.panels[0].collapsed;c[1].collapsed=this.panels[1].collapsed;b.args.panels=c;return this.host.trigger(b)}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxTabs","",{});d.extend(d.jqx._jqxTabs.prototype,{defineInstance:function(){var b={scrollAnimationDuration:200,enabledHover:!0,disabled:!1,collapsible:!1,animationType:"none",enableScrollAnimation:!0,contentTransitionDuration:450,toggleMode:"click",selectedItem:0,height:"auto",width:"auto",position:"top",selectionTracker:!1,scrollable:!0,scrollPosition:"right",scrollStep:70,autoHeight:!0,headerHeight:null,showCloseButtons:!1,canCloseAllTabs:!0,closeButtonSize:16,arrowButtonSize:16,
        keyboardNavigation:!0,reorder:!1,selectionTrackerAnimationDuration:300,_isTouchDevice:!1,roundedCorners:!0,_headerExpandingBalance:0,_dragStarted:!1,_tabCaptured:!1,_lastUnorderedListPosition:0,_selectedItem:0,_titleList:[],_contentList:[],_contentWrapper:null,_unorderedList:null,_scrollTimeout:null,isCollapsed:!1,touchMode:!1,initTabContent:null,enableDropAnimation:!1,_currentEvent:null,_needScroll:!0,_isAnimated:{},_events:"created selected add removed enabled disabled selecting unselecting unselected dragStart dragEnd locked unlocked collapsed expanded tabclick".split(" "),
        _initTabContentList:[],_invalidArgumentExceptions:{invalidScrollAnimationDuration:"The scroll animation duration is not valid!",invalidWidth:"Width you've entered is invalid!",invalidHeight:"Height you've entered is invalid!",invalidAnimationType:"You've entered invalid animation type!",invalidcontentTransitionDuration:"You've entered invalid value for contentTransitionDuration!",invalidToggleMode:"You've entered invalid value for toggleMode!",invalidPosition:"You've entered invalid position!",invalidScrollPosition:"You've entered invalid scroll position!",
            invalidScrollStep:"You've entered invalid scroll step!",invalidStructure:"Invalid structure!",invalidArrowSize:"Invalid scroll button size!",invalidCloseSize:"Invalid close button size!"},aria:{"aria-disabled":{name:"disabled",type:"boolean"}},rtl:!1};if(this===d.jqx._jqxTabs.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(){this._IE8=d.jqx.browser.msie&&9>d.jqx.browser.version;d.jqx.aria(this);this.element.className+=" "+this.toThemeProperty("jqx-tabs jqx-widget jqx-widget-content");
        this.element.setAttribute("role","tablist");for(var b=this.host.children(),c=0;c<b.length;c++){var e=b[c];"ul"===e.nodeName.toLowerCase()?this._unorderedList=e:"div"===e.nodeName.toLowerCase()&&this._contentList.push(e)}this._unorderedListHelper=d(this._unorderedList);this._unorderedListHelper.initAnimate&&this._unorderedListHelper.initAnimate();this._closeButtonList=[];this._selectedItem=this.selectedItem;this._isTouchDevice=d.jqx.mobile.isTouchDevice();this._needScroll=this.scrollable;this.selectionTracker&&
        (this.selectionTracker=this._seletionTrackerBrowserCheck());this._isTouchDevice&&(this.keyboardNavigation=this.reorder=!1);this._titleList=this._unorderedListHelper.children();for(b=this._titleList.length;b;)b--,this._titleList[b].setAttribute("role","tab"),this._titleList[b].getAttribute("id")||this._titleList[b].setAttribute("id",this.element.id+"Tab"+b),this._contentList[b].setAttribute("role","tabpanel");this._validateProperties();this._refresh();this._moveSelectionTrack(this._selectedItem,0);
        this.disabled&&this.disable();this.element.tabIndex=0;this._raiseEvent(0);this._enableWindowResize()},_hiddenParent:function(){if("none"===this.host.css("display"))return!0;var b=!1;d.each(this.host.parents(),function(){if("none"===d(this).css("display"))return b=!0,!1});return b},_enableWindowResize:function(){var b=this,c=d.jqx.isHidden(b.host);d.jqx.utilities.resize(this.host,function(){c?(b._uiRefresh(!0),c=!1):b.refresh();b._refreshBarPosition()})},resize:function(b,c){this.width=b;this.height=
        c;d.jqx.isHidden(this.host)?this._uiRefresh(!0):this.refresh()},refresh:function(b){!0===b&&void 0!==b||this._setSize()},_seletionTrackerBrowserCheck:function(){var b="Browser CodeName: "+navigator.appCodeName;b+="Browser Name: "+navigator.appName;b+="Browser Version: "+navigator.appVersion;b+="Platform: "+navigator.platform;b+="User-agent header: "+navigator.userAgent;return-1!==b.indexOf("IEMobile")||-1!==b.indexOf("Windows Phone OS")||d.jqx.browser.msie&&7>=d.jqx.browser.version?!1:!0},render:function(){this._refresh()},
    _uiRefresh:function(b){this._unorderedListLeftBackup=this._unorderedListHelper.css("left");b&&this._render();this._addStyles();this._performLayout();this._prepareTabs();this._removeEventHandlers();this._addEventHandlers();"auto"===this._unorderedListLeftBackup&&(this._unorderedListLeftBackup=this._getArrowsDisplacement());this._unorderedList.style.left=this._toPx(this._unorderedListLeftBackup);this.rtl&&this.scrollable&&this._rightArrow&&"hidden"!==d(this._rightArrow).css("visibility")&&(b=2*this.arrowButtonSize,
        b=this._width(this.element)-parseInt(this._width(this._unorderedList)+b+parseInt(this._unorderedListHelper.css("margin-left"),10),10),this._unorderedList.style.left=b+"px");var c=this;setTimeout(function(){c._performLayout()},100)},_refresh:function(){d.jqx.isHidden(this.host)||(this._uiRefresh(!0),this.host.addClass("jqx-tabs-header-position-"+this.position))},_addStyles:function(){this._unorderedList.className+=" "+this.toThemeProperty("jqx-tabs-title-container");this._unorderedList.style.outline=
        "none";this._unorderedList.style.whiteSpace="nowrap";this._unorderedList.style.marginTop="0px";this._unorderedList.style.marginBottom="0px";this._unorderedList.style.padding="0px";this._unorderedList.style.background="transparent";this._unorderedList.style.border="none";this._unorderedList.style.borderStyle="none";this._unorderedList.style.textIndent="0px";for(var b=this.length();b;){b--;var c=this._titleList[b],e="jqx-tabs-title jqx-item";c.style.padding="";"bottom"===this.position&&(e+=" jqx-tabs-title-bottom");
        c.disabled&&(e+=" jqx-tabs-title-disable jqx-fill-state-disabled");switch(this.position){case "top":e+=" jqx-rc-t";this._removeClass(this._contentList[b],this.toThemeProperty("jqx-rc-t"));this._contentList[b].className+=" "+this.toThemeProperty("jqx-rc-b");break;case "bottom":e+=" jqx-rc-b",this._removeClass(this._contentList[b],this.toThemeProperty("jqx-rc-b")),this._contentList[b].className+=" "+this.toThemeProperty("jqx-rc-t")}c.className="jqx-reset jqx-disableselect "+this.toThemeProperty(e)}if(this.selectionTracker)switch(this.position){case "top":this._removeClass(this._selectionTracker,
        this.toThemeProperty("jqx-rc-b"));this._selectionTracker.className+=" "+this.toThemeProperty("jqx-rc-t");break;case "bottom":this._removeClass(this._selectionTracker,this.toThemeProperty("jqx-rc-t")),this._selectionTracker.className+=" "+this.toThemeProperty("jqx-rc-b")}},_raiseEvent:function(b,c){var e=new d.Event(this._events[b]);e.owner=this;e.args=c;if(6===b||7===b)e.cancel=!1,this._currentEvent=e;c="";try{if(c=this.host.trigger(e),1===b){var f=this;if(this.selectionTracker||"none"!==this.animationType)setTimeout(function(){!f._initTabContentList[f.selectedItem]&&
    f.initTabContent&&(f.initTabContent(f.selectedItem),f._initTabContentList[f.selectedItem]=!0);var b=new d.Event("loadContent");b.owner=this;0<f._contentList.length&&f._contentList[f.selectedItem]&&d(f._contentList[f.selectedItem]).trigger(b)},50+f.selectionTrackerAnimationDuration);else{var g=new d.Event("loadContent");!f._initTabContentList[f.selectedItem]&&f.initTabContent&&(f.initTabContent(f.selectedItem),f._initTabContentList[f.selectedItem]=!0);g.owner=this;var h=new d.Event("resize");this.host.trigger(h)}}}catch(k){k&&
    console&&console.log(k)}return c},_getArrowsDisplacement:function(){if(!this._needScroll)return 0;var b=this.arrowButtonSize,c=this.arrowButtonSize;return"left"===this.scrollPosition?b+c:"both"===this.scrollPosition?b:0},_scrollRight:function(b){this._stop(this._unorderedListHelper);this._unlockAnimation("unorderedList");var c=parseInt(this._width(this._unorderedList)+parseInt(this._unorderedListHelper.css("margin-left"),10),10),e=this._width(this.element),f=parseInt(this._unorderedListHelper.css("left"),
        10),g=this._getArrowsDisplacement();if(this.scrollable){var h=this._leftArrow.offsetWidth;var k=this._rightArrow.offsetWidth}else k=h=0;b=this.enableScrollAnimation?b:0;if(!(this._width(this._headerWrapper)>parseInt(this._unorderedListHelper.css("margin-left"),10)+this._width(this._unorderedList)))if(Math.abs(f)+this.scrollStep<Math.abs(e-c)+h+k+g){g=f-this.scrollStep;var l=f-this.scrollStep+parseInt(d(this._titleList[this._selectedItem]).position().left,10)}else g=e-c-(2*this.arrowButtonSize-g),
    g<parseInt(this._unorderedListHelper.css("left"),10)-4&&g>parseInt(this._unorderedListHelper.css("left"),10)+4&&(l=e-c-h-k+parseInt(d(this._titleList[this._selectedItem]).position().left,10));this._performScrollAnimation(g,l,b)},_scrollLeft:function(b){this._stop(this._unorderedListHelper);this._unlockAnimation("unorderedList");var c=parseInt(this._unorderedListHelper.css("left"),10),e=this._getArrowsDisplacement();b=this.enableScrollAnimation?b:0;if(!(this._width(this._headerWrapper)>=this._width(this._unorderedList)))if(c+
        this.scrollStep<e){e=c+this.scrollStep;var f=c+this.scrollStep+parseInt(d(this._titleList[this._selectedItem]).position().left,10)}else e<parseInt(this._unorderedListHelper.css("left"),10)-4&&e>parseInt(this._unorderedListHelper.css("left"),10)+4&&(f=parseInt(d(this._titleList[this._selectedItem]).position().left,10));this._performScrollAnimation(e,f,b)},_performScrollAnimation:function(b,c,e){var d=this;void 0!==c&&this._moveSelectionTrack(this._selectedItem,0,c);this._lockAnimation("unorderedList");
        d._refreshBarPosition();this._unorderedListHelper.animate({left:b},e,function(){d._moveSelectionTrack(d.selectedItem,0);d._unlockAnimation("unorderedList");d._refreshBarPosition()})},_addKeyboardHandlers:function(){var b=this;this.keyboardNavigation&&this.addHandler(this.host,"keydown",function(c){if(!b._activeAnimation()){var e=b.selectionTracker,f=b.getContentAt(b._selectedItem);if(d(c.target).ischildof(f)||d(document.activeElement).ischildof(d(f)))return!0;switch(c.keyCode){case 37:return b.rtl?
        b.next():b.previous(),!1;case 39:return b.rtl?b.previous():b.next(),!1;case 36:return b.first(),!1;case 35:return b.last(),!1;case 27:b._tabCaptured&&(b._cancelClick=!0,b._uncapture(null,b.selectedItem),b._tabCaptured=!1)}b.selectionTracker=e}return!0})},_addScrollHandlers:function(){var b=this;this.addHandler(this._leftArrow,"mousedown",function(){b._startScrollRepeat(!0,b.scrollAnimationDuration)});this.addHandler(this._rightArrow,"mousedown",function(){b._startScrollRepeat(!1,b.scrollAnimationDuration)});
        this.addHandler(this._rightArrow,"mouseleave",function(){clearTimeout(b._scrollTimeout)});this.addHandler(this._leftArrow,"mouseleave",function(){clearTimeout(b._scrollTimeout)});this.addHandler(d(document),"mouseup.tab"+this.element.id,this._mouseUpScrollDocumentHandler,this);this.addHandler(d(document),"mouseleave.tab"+this.element.id,this._mouseLeaveScrollDocumentHandler,this)},_mouseLeaveScrollDocumentHandler:function(b){b=b.data;b._scrollTimeout&&clearTimeout(b._scrollTimeout)},_mouseUpScrollDocumentHandler:function(b){clearTimeout(b.data._scrollTimeout)},
    _mouseUpDragDocumentHandler:function(b){var c=b.data;c._tabCaptured&&c._dragStarted&&c._uncapture(b);c._tabCaptured=!1},_addReorderHandlers:function(){this.addHandler(d(document),"mousemove.tab"+this.element.id,this._moveElement,this);this.addHandler(d(document),"mouseup.tab"+this.element.id,this._mouseUpDragDocumentHandler,this)},_addEventHandlers:function(){for(var b=this.length();b;)b--,this._addEventListenerAt(b);this.keyboardNavigation&&this._addKeyboardHandlers();this.scrollable&&this._addScrollHandlers();
        this.reorder&&!this._isTouchDevice&&this._addReorderHandlers();var c=this;try{if((""!==document.referrer||window.frameElement)&&null!==window.top&&window.top!==window.self){b=function(){c._tabCaptured&&(c._cancelClick=!0,c._uncapture(null,c.selectedItem),c._tabCaptured=!1)};var e=null;window.parent&&document.referrer&&(e=document.referrer);e&&-1!==e.indexOf(document.location.host)&&window.top.document&&this.addHandler(d(window.top.document),"mouseup.tabs"+this.element.id,b)}}catch(f){}},focus:function(){try{this.host.focus();
        var b=this;setTimeout(function(){b.host.focus()},25)}catch(c){}},_getFocusedItem:function(b){for(var c=this.length();c;){c--;var e=this._titleList[c],f=this._outerWidth(e,!0),g=parseInt(d(e).offset().left,10);if(g<=b&&g+f>=b&&e!==this._capturedElement&&!this._titleList[c].locked&&!0!==this._titleList[c].disabled)return c}return-1},_uncapture:function(b){var c=this.selectionTracker;this._unorderedListLeftBackup=this._unorderedListHelper.css("left");this._tabCaptured=this._dragStarted=!1;var e=this._indexOf(this._capturedElement);
        if(this._capturedElement){switch(this.position){case "top":this._capturedElement.style.bottom="0px";break;case "bottom":this._capturedElement.style.top="0px"}var d;b&&(d=this._getFocusedItem(b.clientX));-1!==d&&b?(this._raiseEvent(10,{item:e,dropIndex:d}),this._reorderItems(d,e)):this._capturedElement.style.left="0px";for(var g=0;g<this._titleList.length;g++)this._titleList[g].style.position="static";this._reorderHeaderElements();this._unorderedList.style.position="relative";this._unorderedList.style.top=
            "0px";this._prepareTabs();-1!==d&&b?this._moveSelectionTrack(this._selectedItem,0):(this._selectedItem=e,this._moveSelectionTrack(e,0));this._addSelectStyle(this._selectedItem,!0);document.selection&&document.selection.clear();this._unorderedList.style.left=this._toPx(this._unorderedListLeftBackup);this.selectionTracker=c}},_reorderItems:function(b,c){var e=this._titleList[this.selectedItem],f=this._titleList[c];"undefined"===typeof this._capturedElement&&(this._capturedElement=f);d(f).remove();c<
    b?this._titleList[b+1]?this._unorderedList.insertBefore(f,this._titleList[b+1]):this._unorderedList.appendChild(f):this._unorderedList.insertBefore(f,this._titleList[b]);this._reorderElementArrays(b,c);this._getSelectedItem(e);this._removeEventHandlers();this._addEventHandlers()},_reorderElementArrays:function(b,c){var e=this._contentList[c];if(c<b)for(;c<=b;c++)this._titleList[c]=this._titleList[c+1],this._contentList[c]=this._contentList[c+1];else for(;c>=b;c--)this._titleList[c]=this._titleList[c-
    1],this._contentList[c]=this._contentList[c-1];this._contentList[b]=e;this._titleList[b]=this._capturedElement},getSelectedItem:function(){return this.selectedItem},_getSelectedItem:function(b){for(var c=this.length();c;)if(c--,this._titleList[c]===b){this._selectedItem=this.selectedItem=c;break}},_moveElement:function(b){var c=b.data;if(c._tabCaptured)if(document.selection&&document.selection.clear(),c._dragStarted)c._performDrag(b),clearTimeout(c._scrollTimeout);else{var e=-parseInt(c._unorderedListHelper.css("left"),
        10);if(b.clientX+e>c._startX+3||b.clientX+e<c._startX-3)c._prepareTabForDragging(),c._dragStarted=!0}},_performDrag:function(b){var c=this.getZoomFactor(),e=-parseInt(this._unorderedListHelper.css("left"),10);this._capturedElement.style.left=this._toPx(e+b.clientX/c-this._startX/c);this._lastX=b.clientX/c;this._moveSelectionTrack(this.selectedItem,0)},getZoomFactor:function(){var b=1;document.body.getBoundingClientRect&&(b=document.body.getBoundingClientRect(),b=Math.round((b.right-b.left)/document.body.offsetWidth*
        100)/100);return b},_prepareTabForDragging:function(){this._capturedElement.style.position="relative";this._capturedElement.style.left="0px";this._capturedElement.style.top="0px";this._capturedElement.style.zIndex=300;this.selectedItem=this._indexOf(this._capturedElement);switch(this.position){case "top":this._capturedElement.style.bottom=this._toPx(d(this._capturedElement).css("top"));break;case "bottom":this._capturedElement.style.top=this._toPx(d(this._capturedElement).css("top"))}this._raiseEvent(9,
        {item:this._indexOf(this._capturedElement)})},_dragScroll:function(b){var c=parseInt(this._unorderedListHelper.css("left"),10),e=this,f=d(e._headerWrapper);b.clientX<=f.offset().left?(this._scrollLeft(this.scrollAnimationDuration),this._capturedElement.style.left=parseInt(d(this._capturedElement).css("left"),10)+this._lastUnorderedListPosition-c):b.clientX>f.offset().left+e._width(this._headerWrapper)?(this._scrollRight(this.scrollAnimationDuration),this._capturedElement.style.left=parseInt(d(this._capturedElement).css("left"),
        10)+this._lastUnorderedListPosition-c):(e._stop(e._unorderedListHelper),this._unlockAnimation("unorderedList"),clearTimeout(this._scrollTimeout));this._scrollTimeout=setTimeout(function(){e._dragScroll(b)},this.scrollAnimationDuration);this._lastUnorderedListPosition=c},_captureElement:function(b,c){this._tabCaptured||this._titleList[c].locked||!0===this._titleList[c].disabled||this._activeAnimation()||(this._startX=-parseInt(this._unorderedListHelper.css("left"),10)+b.clientX,this._startY=b.clientY,
        this._lastX=b.clientX,this._lastY=b.clientY,this._tabCaptured=!0,this._capturedElement=this._titleList[c])},_titleInteractionTrigger:function(b){0<this._headerExpandingBalance&&this._removeOppositeBorder();this._selectedItem!==b?(this.select(this._titleList[b],"toggle"),this._titleList[b].collapsed=!1,this.collapsible||("auto"!==this.height?this._contentWrapper.style.visibility="visible":this._contentWrapper.style.display="block")):this.collapsible&&(this.isCollapsed?this.expand():this.collapse())},
    collapse:function(){var b=this._selectedItem;this.isCollapsed=!0;"auto"!==this.height?this._contentWrapper.style.visibility="hidden":this._contentWrapper.style.display="none";this._raiseEvent(13,{item:b});"top"===this.position?(this._headerWrapper.className+=" "+this.toThemeProperty("jqx-tabs-header-collapsed"),this.element.className+=" "+this.toThemeProperty("jqx-tabs-collapsed")):(this._headerWrapper.className+=" "+this.toThemeProperty("jqx-tabs-header-collapsed-bottom"),this.element.className+=
        " "+this.toThemeProperty("jqx-tabs-collapsed-bottom"))},expand:function(){var b=this._selectedItem;this.isCollapsed=!1;this._select(b,this.contentTransitionDuration,null,!1,!0);"auto"!==this.height?this._contentWrapper.style.visibility="visible":this._contentWrapper.style.display="block";this._raiseEvent(14,{item:b});"top"===this.position?(this._removeClass(this._headerWrapper,this.toThemeProperty("jqx-tabs-header-collapsed")),this._removeClass(this.element,this.toThemeProperty("jqx-tabs-collapsed"))):
        (this._removeClass(this._headerWrapper,this.toThemeProperty("jqx-tabs-header-collapsed-bottom")),this._removeClass(this.element,this.toThemeProperty("jqx-tabs-collapsed-bottom")))},_addSelectHandler:function(b){var c=this;this.addHandler(this._titleList[b],"selectstart",function(){return!1});this.addHandler(this._titleList[b],this.toggleMode,function(b){return function(){c._raiseEvent("15",{item:b});c._tabCaptured||c._cancelClick||c._titleInteractionTrigger(b);return!0}}(b))},_addDragDropHandlers:function(b){var c=
        this;this.addHandler(this._titleList[b],"mousedown",function(e){c._captureElement(e,b)});this.addHandler(this._titleList[b],"mouseup",function(e){c._tabCaptured&&c._dragStarted?(c._cancelClick=!0,c._uncapture(e,b)):c._cancelClick=!1;return c._tabCaptured=!1})},_removeHoverStates:function(){var b=this;d.each(this._titleList,function(){b._removeClass(this,b.toThemeProperty("jqx-tabs-title-hover-top jqx-tabs-title-hover-bottom"))})},_addHoverHandlers:function(b){var c=this,e=this._titleList[b];this.addHandler(e,
        "mouseenter mouseleave",function(d){if(b!==c._selectedItem){var f="jqx-fill-state-hover";f="top"===c.position?f+" jqx-tabs-title-hover-top":f+" jqx-tabs-title-hover-bottom";"mouseenter"===d.type?e.className+=" "+c.toThemeProperty(f):c._removeClass(e,c.toThemeProperty(f));c.showCloseButtons&&(f=c._closeButtonList[b],"mouseenter"===d.type?f.className+=" "+c.toThemeProperty("jqx-tabs-close-button-hover",!0):c._removeClass(f,c.toThemeProperty("jqx-tabs-close-button-hover",!0)))}})},_addEventListenerAt:function(b){var c=
        this;this._titleList[b].disabled||(this.reorder&&!this._isTouchDevice&&this._addDragDropHandlers(b),this._addSelectHandler(b),this.enabledHover&&this._addHoverHandlers(b),b=c._closeButtonList[b],this.removeHandler(b,"click"),this.addHandler(b,"click",function(){var b=d(this).parents("li").index();c.removeAt(b);return!1}))},_removeEventHandlers:function(){for(var b=this.length();b;)b--,this._removeEventListenerAt(b);this.scrollable&&(this.removeHandler(this._leftArrow,"mousedown"),this.removeHandler(this._rightArrow,
        "mousedown"));this.removeHandler(d(document),"mousemove.tab"+this.element.id,this._moveElement);this.removeHandler(d(document),"mouseup.tab"+this.element.id,this._mouseUpScrollDocumentHandler);this.removeHandler(d(document),"mouseup.tab"+this.element.id,this._mouseUpDragDocumentHandler);this.removeHandler(this.host,"keydown")},_removeEventListenerAt:function(b){this.removeHandler(this._titleList[b],this.toggleMode);this.removeHandler(this._titleList[b],"mouseenter");this.removeHandler(this._titleList[b],
        "mouseleave");this.removeHandler(this._titleList[b],"mousedown");this.removeHandler(this._titleList[b],"mouseup");this.removeHandler(this._closeButtonList[b],"click")},_moveSelectionTrack:function(b,c,e){var f=this;if(-1!==b&&0!==this._titleList.length&&!(b>=this._titleList.length)){var g=this._titleList[b],h=d(g);f._refreshBarPosition();if(this.selectionTracker&&this._selectionTracker){f._stop(f._selectionTrackerHelper);this._unlockAnimation("selectionTracker");void 0===e&&(e=parseInt(h.position().left,
        10),isNaN(parseInt(this._unorderedListHelper.css("left"),10))||(e+=parseInt(this._unorderedListHelper.css("left"),10)),isNaN(parseInt(this._unorderedListHelper.css("margin-left"),10))||(e+=parseInt(this._unorderedListHelper.css("margin-left"),10)),isNaN(parseInt(h.css("margin-left"),10))||(e+=parseInt(h.css("margin-left"),10)),isNaN(parseInt(h.css("margin-right"),10)));var k=0;"top"===this.position&&(this._height(f._headerWrapper),this.autoHeight||(k+=parseInt(h.css("margin-top"),10)));this._lockAnimation("selectionTracker");
        k=parseInt(h.css("padding-left"),10)+parseInt(h.css("padding-right"),10);var l="top"===this.position?0:1,m=parseInt(d(this._headerWrapper).css("padding-top"),10),p=parseInt(h.css("padding-top"),10)+parseInt(h.css("padding-bottom"),10);this._selectionTracker.style.visibility="visible";this._moveSelectionTrackerContainer.style.visibility="visible";h=parseInt(h.css("margin-top"),10);isNaN(h)&&(h=0);f._refreshBarPosition();f._selectionTrackerHelper.animate({top:m+h-l,left:e+"px",height:parseInt(this._height(g)+
                p,10),width:f._width(g)+k},c,function(){f._unlockAnimation("selectionTracker");f._selectionTracker.style.visibility="hidden";f._addSelectStyle(b,!0);f._moveSelectionTrackerContainer.style.visibility="hidden"})}}},destroy:function(){d.jqx.utilities.resize(this.host,null,!0);(""!=document.referrer||window.frameElement)&&null!=window.top&&window.top!=window.self&&this.removeHandler(d(window.top.document),"mouseup.tabs"+this.element.id);this.host.remove()},_switchTabs:function(b,c){if(b!==c&&!this._activeAnimation()&&
        !this._tabCaptured){this._raiseEvent(7,{item:c});this._raiseEvent(6,{item:b});if(this._currentEvent&&this._currentEvent.cancel){this._currentEvent=null;return}this._unselect(c,null,!0);this._select(b,this.contentTransitionDuration,null,!0);return!0}return!1},_activeAnimation:function(){for(var b in this._isAnimated)if(this._isAnimated.hasOwnProperty(b)&&this._isAnimated[b])return!0;return!1},_indexOf:function(b){for(var c=this.length();c;)if(c--,this._titleList[c]===b||this._contentList[c]===b)return c;
        return-1},_validateProperties:function(){try{if(0>this.scrollAnimationDuration||isNaN(this.scrollAnimationDuration))throw Error(this._invalidArgumentExceptions.invalidScrollAnimationDuration);if(0>parseInt(this.width,10)&&"auto"!==this.width)throw Error(this._invalidArgumentExceptions.invalidWidth);if(0>parseInt(this.height,10)&&"auto"!==this.height)throw Error(this._invalidArgumentExceptions.invalidHeight);if("none"!==this.animationType&&"fade"!==this.animationType)throw Error(this._invalidArgumentExceptions.invalidAnimationType);
        if(0>this.contentTransitionDuration||isNaN(this.contentTransitionDuration))throw Error(this._invalidArgumentExceptions.invalidcontentTransitionDuration);if("click"!==this.toggleMode&&"dblclick"!==this.toggleMode&&"mouseenter"!==this.toggleMode&&"none"!==this.toggleMode)throw Error(this._invalidArgumentExceptions.invalidToggleMode);if("top"!==this.position&&"bottom"!==this.position)throw Error(this._invalidArgumentExceptions.invalidPosition);if("left"!==this.scrollPosition&&"right"!==this.scrollPosition&&
            "both"!==this.scrollPosition)throw Error(this._invalidArgumentExceptions.invalidScrollPosition);if(0>this.scrollStep||isNaN(this.scrollStep))throw Error(this._invalidArgumentExceptions.invalidScrollStep);if(this._titleList.length!==this._contentList.length||0===this._titleList.length)throw Error(this._invalidArgumentExceptions.invalidStructure);if(0>this.arrowButtonSize||isNaN(this.arrowButtonSize))throw Error(this._invalidArgumentExceptions.invalidArrowSize);if(0>this.closeButtonSize||isNaN(this.closeButtonSize))throw Error(this._invalidArgumentExceptions.invalidCloseSize);
    }catch(b){try{console.log(b)}catch(c){}}},_startScrollRepeat:function(b,c){var e=this;b?this._scrollLeft(c):this._scrollRight(c);this._scrollTimeout&&clearTimeout(this._scrollTimeout);this._scrollTimeout=setTimeout(function(){e._startScrollRepeat(b,e.scrollAnimationDuration)},c)},_performLayout:function(){for(var b=this.length();b;)if(b--,"top"===this.position||"bottom"===this.position)this._titleList[b].style["float"]=this.rtl?"right":"left";this._fitToSize();this._performHeaderLayout();this._fitToSize()},
    updatetabsheader:function(){this._performHeaderLayout()},_setSize:function(){this._fitToSize();this._positionArrows(this._totalItemsWidth);this._unorderedList.style.width=this._totalItemsWidth>this.element.offsetWidth?this._toPx(this._totalItemsWidth):this.element.offsetWidth-2+"px";this._fitToSize()},_addArrows:function(){this._leftArrow&&this._rightArrow&&(d(this._leftArrow).remove(),d(this._rightArrow).remove());this._leftArrow=document.createElement("div");this._leftArrow.innerHTML='<span style="display: block; width: 16px; height: 16px;" class="'+
        this.toThemeProperty("jqx-tabs-arrow-left")+'"></span>';this._leftArrow.className=this.toThemeProperty("jqx-tabs-arrow-background jqx-widget-header");this._leftArrow.style.zIndex=30;this._leftArrow.style.display="none";this._leftArrow.style.width=this._toPx(this.arrowButtonSize);this._leftArrow.style.height="100%";this._rightArrow=document.createElement("div");this._rightArrow.innerHTML='<span style="display: block; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-tabs-arrow-right")+
        '"></span>';this._rightArrow.className=this.toThemeProperty("jqx-tabs-arrow-background jqx-widget-header");this._rightArrow.style.zIndex=30;this._rightArrow.style.display="none";this._rightArrow.style.width=this._toPx(this.arrowButtonSize);this._rightArrow.style.height="100%";this._headerWrapper.appendChild(this._leftArrow);this._headerWrapper.appendChild(this._rightArrow)},_tabsWithVisibleCloseButtons:function(){if(!this.showCloseButtons)return 0;var b=this.length();d.each(this._titleList,function(){var c=
        this.attr("hasclosebutton");void 0===c||null===c||"false"!==c&&!1!==c||b--});return b},_calculateTitlesSize:function(){function b(b,c){b&&(b.style.display=c?"block":"none")}var c=0,e=0,f=this.length();this.rtl&&d.jqx.browser.msie&&8>d.jqx.browser.version&&(this._measureItem=document.createElement("span"),this._measureItem.style.position="relative",this._measureItem.style.visibility="hidden",document.body.appendChild(this._measureItem));for(;f;){f--;var g=this._titleList[f],h=this._closeButtonList[f];
        this._measureItem&&(this._measureItem.innerHTML=g.innerHTML,this._measureItem.html(this._titleList[f].html()),g.style.width=this._toPx(this._width(this._measureItem)));g.style.position="static";b(h,!1);e+=this._outerWidth(g,!0);var k=this._outerHeight(g,!0);c<k&&(c=k);0===this._height(g)&&(k=g.cloneNode(!0),document.body.appendChild(k),c=this._outerHeight(k,!0),document.body.removeChild(k));k=g.getAttribute("hasCloseButton");if(void 0!==k&&null!==k){var l=!1;this.hiddenCloseButtons&&1===this.hiddenCloseButtons[f]&&
        (b(h,!1),l=!0);l||("true"===k||!0===k?(e+=this.closeButtonSize,b(h,!0)):"false"!==k&&!1!==k||b(h,!1))}else this.showCloseButtons&&(this.canCloseAllTabs||1<this._tabsWithVisibleCloseButtons())&&(l=!1,this.hiddenCloseButtons&&1===this.hiddenCloseButtons[f]&&(b(h,!1),l=!0),l||(e+=this.closeButtonSize,b(h,!0)));g.style.height=this._toPx(this._height(g))}this._measureItem&&d(this._measureItem).remove();return{height:c,width:10+e}},_reorderHeaderElements:function(){this.selectionTracker&&(this._moveSelectionTrackerContainer.style.position=
        "absolute",this._moveSelectionTrackerContainer.style.height="100%",this._moveSelectionTrackerContainer.style.top="0px",this._moveSelectionTrackerContainer.style.left="0px",this._moveSelectionTrackerContainer.style.width="100%");this._headerWrapper.style.position="relative";this._headerWrapper.style.left="0px";this._headerWrapper.style.top="0px";if(this.scrollable){this._rightArrow.style.width=this._toPx(this.arrowButtonSize);this._rightArrow.style.position="absolute";this._rightArrow.style.top="0px";
        this._leftArrow.style.width=this._toPx(this.arrowButtonSize);this._leftArrow.style.position="absolute";this._leftArrow.style.top="0px";var b=this.theme&&-1!==this.theme.indexOf("ui-")?3:0;0<b&&(this._rightArrow.className+=" "+this.toThemeProperty("jqx-rc-r"),this._leftArrow.className+=" "+this.toThemeProperty("jqx-rc-l"));var c=this.scrollPosition;this.rtl&&("left"===c&&(c="right"),"right"===c&&(c="left"));switch(c){case "both":this._rightArrow.style.right="0px";this._leftArrow.style.left="0px";break;
            case "left":this._rightArrow.style.left=this._toPx(this.arrowButtonSize);this._leftArrow.style.left="0px";break;case "right":this._rightArrow.style.right=this._toPx(-b),this._leftArrow.style.right=this._toPx(parseInt(this.arrowButtonSize,10)-b)}}},_positionArrows:function(b){b>=this._headerWrapper.offsetWidth&&this.scrollable?(this._needScroll=!0,0===this._unorderedListHelper.position().left&&(this._unorderedListLeftBackup=this._getArrowsDisplacement()+"px"),this._leftArrow.style.display="block",
        this._rightArrow.style.display="block"):(this._needScroll=!1,this._leftArrow.style.display="none",this._rightArrow.style.display="none",this._unorderedList.style.left="0px")},_performHeaderLayout:function(){this._removeSelectStyle();var b=this._calculateTitlesSize(),c=b.height;b=b.width;this._headerWrapper.style.height=this._toPx(c);this._unorderedList.style.height=this._toPx(c);null!==this.headerHeight&&"auto"!==this.headerHeight&&(this._headerWrapper.style.height=this._toPx(this.headerHeight),this._unorderedList.style.height=
        this._toPx(this.headerHeight));c=this._width(this.element);this._unorderedList.style.width=b>c?this._toPx(b):this._toPx(c);d.jqx.browser.msie&&8>d.jqx.browser.version&&(this._unorderedList.style.position="relative",this._unorderedList.style.overflow="hidden");this._reorderHeaderElements();this._totalItemsWidth=b+=parseInt(this._unorderedListHelper.css("margin-left"),10);this._positionArrows(b);this._unorderedList.style.position="relative";this._unorderedList.style.top="0px";this._verticalAlignElements();
        this._moveSelectionTrack(this._selectedItem,0);this._addSelectStyle(this.selectedItem)},_verticalAlignElements:function(){for(var b=this.length();b;){b--;var c=this._titleList[b],e=d(c),f=e.children()[0],g=this._closeButtonList[b];parseInt(e.css("padding-top"),10);if(this.autoHeight){var h=parseInt(e.css("padding-top"),10),k=parseInt(e.css("padding-bottom"),10),l=e.css("border-top-width");e=e.css("border-bottom-width");l=-1===l.indexOf("px")?1:parseInt(l,10);e=-1===e.indexOf("px")?1:parseInt(e,10);
        c.style.height=this._toPx(this._outerHeight(this._unorderedList,!0)-(h+k+l+e))}else"top"===this.position?(h=this._height(this._unorderedList)-parseInt(this._outerHeight(c,!0),10),parseInt(e.css("margin-top"),10)!==h&&0!==h&&(c.style.marginTop=this._toPx(h))):c.style.height=this._toPx(this._height(c));f.style.height="100%";c=this._height(c);g&&(e=c/2-this._height(g)/2,g.style.marginTop=this._toPx(1+e));g=c/2-this._height(f)/2;f.style.marginTop=this._toPx(g)}this.scrollable&&(b=(parseInt(this._headerWrapper.offsetHeight,
        10)-this.arrowButtonSize)/2,d(this._rightArrow).children()[0].style.marginTop=this._toPx(b),this._rightArrow.style.height="100%",d(this._leftArrow).children()[0].style.marginTop=this._toPx(b),this._leftArrow.style.height="100%")},_getImageUrl:function(b){b=b.css("background-image");b=b.replace('url("',"");b=b.replace('")',"");b=b.replace("url(","");return b=b.replace(")","")},_fitToSize:function(){var b=!1,c=!1;null!==this.width&&-1!==this.width.toString().indexOf("%")&&(b=!0);null!==this.height&&
    -1!==this.height.toString().indexOf("%")&&(c=!0);b?(this.element.style.width=this.width,this._contentWrapper.style.width="100%"):(this.element.style.width=this._toPx(this.width),"auto"!==this.width&&(this._contentWrapper.style.width="100%"));c?(this.element.style.height=this.height,this._contentWrapper.style.width="100%",this._contentWrapper.style.height="auto",b=this.element.offsetHeight-this._headerWrapper.offsetHeight-2,this._contentWrapper.style.height=b+"px"):"auto"!==this.height?(this.element.style.height=
        this._toPx(this.height),b=this._height(this.element)-this._headerWrapper.offsetHeight,this._contentWrapper.style.height=this._toPx(b)):this._contentWrapper.style.height="auto"},_maxHeightTab:function(){for(var b=this.length(),c=-1;b;)b--,-1<this._outerHeight(this._titleList[b],!0)&&(c=b);return c},_addSelectionTracker:function(){this._moveSelectionTrackerContainer&&d(this._moveSelectionTrackerContainer).remove();this._moveSelectionTrackerContainer=document.createElement("div");this._moveSelectionTrackerContainer.className=
        this.toThemeProperty("jqx-tabs-selection-tracker-container");this._selectionTracker=document.createElement("div");this._selectionTracker.className=this.toThemeProperty("jqx-tabs-selection-tracker-"+this.position);this._selectionTracker.style.color="inherit";this._selectionTracker.style.position="absolute";this._selectionTracker.style.zIndex=10;this._selectionTracker.style.left="0px";this._selectionTracker.style.top="0px";this._selectionTracker.style.display="inline-block";this._moveSelectionTrackerContainer.appendChild(this._selectionTracker);
        this._headerWrapper.appendChild(this._moveSelectionTrackerContainer);this._selectionTrackerHelper=d(this._selectionTracker);this._selectionTrackerHelper.initAnimate&&this._selectionTrackerHelper.initAnimate()},_addContentWrapper:function(){var b=null===this._contentWrapper;b&&(this._contentWrapper=document.createElement("div"),this._contentWrapper.className=this.toThemeProperty("jqx-tabs-content jqx-widget-content"),this._contentWrapper.style["float"]="none");for(var c=this.length();c;)c--,this._contentList[c].className+=
        " "+this.toThemeProperty("jqx-tabs-content-element");if(b)for("top"===this.position?this.element.appendChild(this._contentWrapper):this.element.insertBefore(this._contentWrapper,this.element.firstChild),b=0;b<this._contentList.length;b++)this._contentWrapper.appendChild(this._contentList[b]);this.roundedCorners&&(this._contentWrapper.className="top"===this.position?this._contentWrapper.className+(" "+this.toThemeProperty("jqx-rc-b")):this._contentWrapper.className+(" "+this.toThemeProperty("jqx-rc-t")),
        this.element.className+=" "+this.toThemeProperty("jqx-rc-all"))},_addHeaderWrappers:function(){var b=this.length();void 0!==this._headerWrapper&&(d(this._headerWrapper).remove(),this.bar&&(this.bar=null));this._headerWrapper=document.createElement("div");this._headerWrapper.style.outline="none";"top"===this.position?this.element.insertBefore(this._headerWrapper,this.element.firstChild):this.element.appendChild(this._headerWrapper);this._headerWrapper.appendChild(this._unorderedList);var c="jqx-tabs-headerWrapper jqx-tabs-header jqx-widget-header";
        "bottom"===this.position&&(c+=" jqx-tabs-header-bottom");this.roundedCorners&&(c="top"===this.position?c+" jqx-rc-t":c+" jqx-rc-b");for(this._headerWrapper.className=this.toThemeProperty(c);b;)if(b--,c=this._titleList[b],null===c.querySelector(".jqx-tabs-titleWrapper")){var e=document.createElement("div");e.className="jqx-tabs-titleWrapper";e.style.outline="none";e.style.position="relative";e.style.zIndex=15;var f=d(c).children();e.appendChild(f[0]);e.appendChild(f[1]);c.appendChild(e)}},_render:function(){this._addCloseButtons();
        this._addHeaderWrappers();this._addContentWrapper();this.selectionTracker&&this._addSelectionTracker();this._addArrows()},_addCloseButton:function(b,c){var e=document.createElement("div"),f=this._titleList[b];e.className="jqx-tabs-titleContentWrapper jqx-disableselect";var g="left";this.rtl&&(g="right");0<d(f).find(".jqx-tabs-close-button").length&&d(f).find(".jqx-tabs-close-button").remove();e.style["float"]=g;e.innerHTML=f.innerHTML;f.innerHTML="";var h=document.createElement("div");h.className=
        this.toThemeProperty("jqx-tabs-close-button");h.style.height=this._toPx(this.closeButtonSize);h.style.width=this._toPx(this.closeButtonSize);h.style["float"]=g;h.style.fontSize="1px";f.appendChild(e);f.appendChild(h);!0===c?this._closeButtonList[b]=h:this._closeButtonList.splice(b,0,h);this.showCloseButtons?this.hiddenCloseButtons&&1===this.hiddenCloseButtons[b]&&(h.style.display="none"):h.style.display="none"},_addCloseButtons:function(){for(var b=this.length();b;)b--,this._addCloseButton(b,!0)},
    _prepareTabs:function(){var b=this.length(),c=this.selectionTracker;for(this.selectionTracker=!1;b;)b--,this._selectedItem!==b&&this._unselect(b,null,!1);this._select(this._selectedItem,0,null,!1);this.selectionTracker=c;!this.initTabContent||this._initTabContentList[this.selectedItem]||this._hiddenParent()||(this.initTabContent(this.selectedItem),this._initTabContentList[this.selectedItem]=!0)},_isValidIndex:function(b){return 0<=b&&b<this.length()},_removeSelectStyle:function(){for(var b=this.length();b;){b--;
        var c=this._titleList[b];this.showCloseButtons&&this._removeClass(this._closeButtonList[b],this.toThemeProperty("jqx-tabs-close-button-selected"));var e="jqx-fill-state-pressed";e="top"===this.position?e+" jqx-tabs-title-selected-top":e+" jqx-tabs-title-selected-bottom";this._removeClass(c,this.toThemeProperty(e))}},_addSelectStyle:function(b,c){this._removeSelectStyle();if(!this.selectionTracker||void 0!==c&&c)if(c=this._titleList[b],0<=b&&void 0!==c){var e=null;this.showCloseButtons&&(e=this._closeButtonList[b],
    this.hiddenCloseButtons&&1===this.hiddenCloseButtons[b]&&(e=null));b="jqx-fill-state-hover";var d=" jqx-fill-state-pressed";"top"===this.position?(b+=" jqx-tabs-title-hover-top",d+=" jqx-tabs-title-selected-top"):(b+=" jqx-tabs-title-hover-bottom",d+=" jqx-tabs-title-selected-bottom");this._removeClass(c,this.toThemeProperty(b));c.className+=this.toThemeProperty(d);null!==e&&(e.className+=" "+this.toThemeProperty("jqx-tabs-close-button-selected"))}},_addItemTo:function(b,c,e){if(c<b.length){for(var d,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            g,h=c;h+1<b.length;h++)void 0===d?(d=b[h+1],b[h+1]=b[h]):(g=b[h+1],b[h+1]=d,d=g);void 0===d&&(d=b[c]);b[c]=e;b.push(d)}else b.push(e)},_refreshBarPosition:function(){var b=this;if(!this.bar){var c=d("<span></span>");d(this._headerWrapper).append(c);c.addClass(this.toThemeProperty("jqx-tabs-bar"));this.bar=c}setTimeout(function(){var c=parseInt(b._unorderedListHelper.css("left"),10),f=parseInt(b._unorderedListHelper.css("margin-left"));c?b.bar.css("left",f+b._titleList[b._selectedItem].offsetLeft+
        c):b.bar.css("left",f+b._titleList[b._selectedItem].offsetLeft);b.bar.width(d(b._titleList[b._selectedItem]).outerWidth()-2)})},_select:function(b,c,e,f,g){if(!this._tabCaptured){this.host.attr("hideFocus","true");var h=this;void 0===g?this._addSelectStyle(b):this._addSelectStyle(b,g);var k=d(h._titleList[b]),l=h._titleList[b].getAttribute("id"),m=d(h._contentList[b]);if(this.isCollapsed&&this.collapsible)m[0].style.display="none",this._selectCallback(b,e,f);else switch(h._refreshBarPosition(),this.animationType){case "none":if(h.selectionTracker)setTimeout(function(){m[0].style.display=
        "block";d.jqx.aria(k,"aria-selected",!0);d.jqx.aria(m,"aria-hidden",!1);d.jqx.aria(h,"aria-activedescendant",l)},this.selectionTrackerAnimationDuration);else{for(c=0;c<this._contentList.length;c++)b!==c&&"block"===d(h._contentList[c]).css("display")&&(h._contentList[c].style.display="none",d.jqx.aria(d(h._titleList[c]),"aria-selected",!1),d.jqx.aria(d(h._contentList[c]),"aria-hidden",!0));m[0].style.display="block";d.jqx.aria(k,"aria-selected",!0);d.jqx.aria(m,"aria-hidden",!1);d.jqx.aria(this,"aria-activedescendant",
        l)}this._selectCallback(b,e,f);break;case "fade":this._lockAnimation("contentListSelect"),h._selectCallback(b,e,f),m.initAnimate&&void 0===m.fadeIn&&m.initAnimate(),m.fadeIn({duration:1E3,complete:function(){h._unlockAnimation("contentListSelect");d.jqx.aria(k,"aria-selected",!0);d.jqx.aria(m,"aria-hidden",!1);d.jqx.aria(h,"aria-activedescendant",l)}})}}},_selectCallback:function(b,c,e){this.selectedItem=this._selectedItem=b;c&&c();e&&this._raiseEvent(1,{item:b})},_unselect:function(b,c,e){if(0<=
        b&&!this._tabCaptured){var f=this._contentList[b],g=d(f),h=this._titleList[b],k=d(h);g.initAnimate&&void 0===g.animate&&g.initAnimate();this._stop(g);"fade"===this.animationType?(f.style.display="none",d.jqx.aria(k,"aria-selected",!1),d.jqx.aria(g,"aria-hidden",!0)):this.selectionTracker?setTimeout(function(){f.style.display="none";d.jqx.aria(k,"aria-selected",!1);d.jqx.aria(g,"aria-hidden",!0)},this.selectionTrackerAnimationDuration):(f.style.display="none",d.jqx.aria(k,"aria-selected",!1),d.jqx.aria(g,
        "aria-hidden",!0));this._unselectCallback(b,c,e);this.selectionTracker||this._removeClass(h,this.toThemeProperty("jqx-tabs-title-selected jqx-fill-state-pressed"))}},_unselectCallback:function(b,c,e){e&&this._raiseEvent(8,{item:b});c&&c()},disable:function(){for(var b=this.length();b;)b--,this.disableAt(b)},enable:function(){for(var b=this.length();b;)b--,this.enableAt(b)},getEnabledTabsCount:function(){var b=0;d.each(this._titleList,function(){this.disabled||b++});return b},getDisabledTabsCount:function(){var b=
        0;d.each(this._titleList,function(){this.disabled&&b++});return b},removeAt:function(b){if(this._isValidIndex(b)&&(this.canCloseAllTabs||1<this.length())){this._removeHoverStates();this._initTabContentList[b]=!1;var c=this,e=c._outerWidth(this._titleList[b],!0),f=this.getTitleAt(b);this._unorderedList.style.width=c._toPx(c._width(this._unorderedList)-e);d(this._titleList[b]).remove();d(this._contentList[b]).remove();this._titleList.splice(b,1);this._contentList.splice(b,1);c._closeButtonList.splice(b,
        1);this._addStyles();this._performHeaderLayout();this._removeEventHandlers();this._addEventHandlers();this._raiseEvent(3,{item:b,title:f});this._isAnimated={};0<this.selectedItem?(this._selectedItem=-1,this.selectedItem>=b?(b=this._getPreviousIndex(this.selectedItem),this.select(b)):this.select(c.selectedItem)):(this._selectedItem=-1,b=this._getNextIndex(this.selectedItem),this.select(b));parseInt(this._unorderedListHelper.css("left"),10)>this._getArrowsDisplacement()&&(this._unorderedList.style.left=
        c._toPx(this._getArrowsDisplacement()));c._width(this._unorderedList)<=c._width(this._headerWrapper)&&(b=this.enableScrollAnimation?this.scrollAnimationDuration:0,this._lockAnimation("unorderedList"),this._unorderedListHelper.animate({left:0},b,function(){c._unlockAnimation("unorderedList")}))}},removeFirst:function(){this.removeAt(0)},removeLast:function(){this.removeAt(this.length()-1)},disableAt:function(b){var c=this._titleList[b];c.disabled&&void 0!==c.disabled||(this.selectedItem===b&&(this.next()||
        this.previous()),c.disabled=!0,this.removeHandler(c,this.toggleMode),this.enabledHover&&d(c).off("mouseenter").off("mouseleave"),this._removeEventListenerAt(b),c.className+=" "+this.toThemeProperty("jqx-tabs-title-disable jqx-fill-state-disabled"),this._raiseEvent(5,{item:b}))},enableAt:function(b){var c=this._titleList[b];c.disabled&&(c.disabled=!1,this._addEventListenerAt(b),this._removeClass(c,this.toThemeProperty("jqx-tabs-title-disable jqx-fill-state-disabled")),this._raiseEvent(4,{item:b}))},
    addAt:function(b,c,e){if(0<=b&&b<=this.length()){this._removeHoverStates();var d=document.createElement("li");d.innerHTML=c;d.className=this.toThemeProperty("jqx-tabs-title jqx-item");c=document.createElement("div");c.innerHTML=e;c.className=this.toThemeProperty("jqx-tabs-content-element");"bottom"===this.position&&(d.className+=" "+this.toThemeProperty("jqx-tabs-title-bottom"));0===this._titleList.length?this._unorderedList.appendChild(d):b<this.length()&&0<=b?this._unorderedList.insertBefore(d,
        this._titleList[b]):this._unorderedList.appendChild(d);this._contentWrapper.appendChild(c);this._addItemTo(this._titleList,b,d);this._addItemTo(this._contentList,b,c);this._addCloseButton(b);this._selectedItem>b&&this._selectedItem++;this._switchTabs(b,this._selectedItem);this._selectedItem=b;this._uiRefresh(!1);this._raiseEvent(2,{item:b});this._moveSelectionTrack(this._selectedItem,0)}},addFirst:function(b,c){this.addAt(0,b,c)},addLast:function(b,c){this.addAt(this.length(),b,c)},val:function(b){if(0===
        arguments.length||"object"===typeof b)return this._selectedItem;this.select(b);return this._selectedItem},select:function(b){"object"===typeof b&&(b=this._indexOf(b));var c=0<=b&&b<this._titleList.length?this._titleList[b].getAttribute("canselect"):!0;(void 0===c||null===c||"true"===c||!0===c)&&b!==this._selectedItem&&this._isValidIndex(b)&&(this._activeAnimation()||this._titleList[b].disabled||this._switchTabs(b,this._selectedItem)&&this.ensureVisible(b))},previous:function(b){var c=this._selectedItem;
        for(void 0===b||isNaN(b)||(c=b);0<c&&c<this._titleList.length;)if(c--,!this._titleList[c].disabled)return this.select(c),!0;return!1},_getPreviousIndex:function(b){if(void 0===b||isNaN(b))return 0;for(var c=b;0<b&&b<=this._titleList.length;)if(b--,!this._titleList[b].disabled)return b;return c},_getNextIndex:function(b){if(void 0===b||isNaN(b))return 0;for(var c=b;0<=b&&b<this._titleList.length;){if(!this._titleList[b].disabled)return b;b++}return c},next:function(b){var c=this._selectedItem;for(void 0===
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             b||isNaN(b)||(c=b);0<=c&&c<this._titleList.length-1;)if(c++,!this._titleList[c].disabled)return this.select(c),!0;return!1},first:function(){this._titleList[0].disabled?this.next(0):this.select(0)},last:function(){var b=this._titleList.length-1;this._titleList[b].disabled?this.previous(b):this.select(b)},length:function(){return this._titleList.length},lockAt:function(b){!this._isValidIndex(b)||this._titleList[b].locked&&void 0!==this._titleList[b].locked||(this._titleList[b].locked=!0,this._raiseEvent(11,
        {item:b}))},unlockAt:function(b){this._isValidIndex(b)&&this._titleList[b].locked&&(this._titleList[b].locked=!1,this._raiseEvent(12,{item:b}))},lockAll:function(){for(var b=this.length();b;)b--,this.lockAt(b)},unlockAll:function(){for(var b=this.length();b;)b--,this.unlockAt(b)},showCloseButtonAt:function(b){this._isValidIndex(b)&&(this.showCloseButtons||(this.showCloseButtons=!0,this.updatetabsheader()),this._closeButtonList[b].style.display="block",this.hiddenCloseButtons||(this.hiddenCloseButtons=
        []),this.hiddenCloseButtons[b]=0)},hideCloseButtonAt:function(b){this._isValidIndex(b)&&(this._closeButtonList[b].style.display="none",this.hiddenCloseButtons||(this.hiddenCloseButtons=[]),this.hiddenCloseButtons[b]=1)},hideAllCloseButtons:function(){for(var b=this.length();b;)b--,this.hideCloseButtonAt(b)},showAllCloseButtons:function(){for(var b=this.length();b;)b--,this.showCloseButtonAt(b)},getTitleAt:function(b){return this._titleList[b]?d(this._titleList[b]).text():null},getContentAt:function(b){return this._contentList[b]?
        this._contentList[b]:null},setTitleAt:function(b,c){this._titleList[b]&&(d(this._titleList[b]).text(c),this.showCloseButtons&&(this._addCloseButton(b),this._removeEventHandlers(),this._addEventHandlers()),this.render(),this.refresh())},setContentAt:function(b,c){this._contentList[b]&&d(this._contentList[b]).html(c)},ensureVisible:function(b){var c=this;if(void 0===b||-1===b||null===b)b=this.selectedItem;if(!this._isValidIndex(b))return!1;var e=this._titleList[b],f=parseInt(d(e).position().left,10)+
        parseInt(this._unorderedListHelper.css("margin-left"),10),g=parseInt(this._unorderedListHelper.css("left"),10),h=this._outerWidth(this._headerWrapper,!0);e=this._outerWidth(e,!0);g-=this._getArrowsDisplacement();var k=h-this._getArrowsDisplacement()-g;if(f<-g)f=-f+this._getArrowsDisplacement(),h=this._getArrowsDisplacement();else if(f+e>k-this._getArrowsDisplacement())f=-f+h-e-(this.scrollable?2*this.arrowButtonSize-this._getArrowsDisplacement():0),h=h-e-this._getArrowsDisplacement();else return this._moveSelectionTrack(b,
        this.selectionTrackerAnimationDuration),!0;this._lockAnimation("unorderedList");this._unorderedListHelper.animate({left:f},this.scrollAnimationDuration,function(){c._unlockAnimation("unorderedList");c._moveSelectionTrack(c._selectedItem,0);return!0});this._moveSelectionTrack(b,this.selectionTrackerAnimationDuration,h);return!0},isVisibleAt:function(b){if(void 0===b||-1===b||null===b)b=this.selectedItem;if(!this._isValidIndex(b))return!1;var c=this._titleList[b];b=parseInt(d(c).position().left,10)+
        parseInt(this._unorderedListHelper.css("margin-left"),10);var e=parseInt(this._unorderedListHelper.css("left"),10),f=this._outerWidth(this._headerWrapper,!0);c=this._outerWidth(c,!0);e-=this._getArrowsDisplacement();f=f-this._getArrowsDisplacement()-e;return b<-e||b+c>f?!1:!0},isDisabled:function(b){return this._titleList[b].disabled},_lockAnimation:function(b){this._isAnimated&&(this._isAnimated[b]=!0)},_unlockAnimation:function(b){this._isAnimated&&(this._isAnimated[b]=!1)},propertiesChangedHandler:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           c,e){e&&e.width&&e.height&&2===Object.keys(e).length&&b._setSize()},propertyChangedHandler:function(b,c,e,f){if(!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2===Object.keys(b.batchUpdate).length)){this._validateProperties();switch(c){case "touchMode":f&&(b.enabledHover=!1,b.keyboardNavigation=!1);break;case "width":case "height":b._setSize();return;case "disabled":f?this.disable():this.enable();return;case "showCloseButtons":f?this.showAllCloseButtons():this.hideAllCloseButtons();this._performHeaderLayout();
        return;case "selectedItem":this._isValidIndex(f)&&this.select(f);return;case "scrollStep":case "contentTransitionDuration":case "scrollAnimationDuration":case "enableScrollAnimation":return;case "selectionTracker":f?(this._refresh(),this.select(this._selectedItem)):this._selectionTracker&&this._selectionTrackerHelper.remove();return;case "scrollable":f?(this._refresh(),this.select(this._selectedItem)):(d(this._leftArrow).remove(),d(this._rightArrow).remove(),this._performHeaderLayout());return;case "autoHeight":this._performHeaderLayout();
        return;case "theme":d.jqx.utilities.setTheme(e,f,this.host);return}this._unorderedList.style.left="0px";this._refresh();this.select(this._selectedItem);this._addSelectStyle(this._selectedItem,!0)}},_toPx:function(b){return"number"===typeof b?b+"px":b},_removeClass:function(b,c){d(b).removeClass(c)},_width:function(b){var c=d(b),e=c.css("border-left-width"),f=c.css("border-right-width"),g=parseInt(c.css("padding-left"),10);c=parseInt(c.css("padding-right"),10);e=-1===e.indexOf("px")?1:parseInt(e,10);
        f=-1===f.indexOf("px")?1:parseInt(f,10);return b.offsetWidth-(e+f+g+c)},_outerWidth:function(b,c){var e=b.offsetWidth;c&&(c=d(b),b=parseInt(c.css("margin-left"),10),c=parseInt(c.css("margin-right"),10),e+=b+c);return e},_height:function(b){var c=d(b),e=c.css("border-top-width"),f=c.css("border-bottom-width"),g=parseInt(c.css("padding-top"),10);c=parseInt(c.css("padding-bottom"),10);e=-1===e.indexOf("px")?1:parseInt(e,10);f=-1===f.indexOf("px")?1:parseInt(f,10);return b.offsetHeight-(e+f+g+c)},_outerHeight:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                c){var e=b.offsetHeight;c&&(c=d(b),b=parseInt(c.css("margin-top"),10),c=parseInt(c.css("margin-bottom"),10),e+=b+c);return e},_stop:function(b){b.stop?b.stop():b.animate("stop",!0)}})})(jqxBaseFramework);
(function(d){function b(b){b=d(b);return"none"!==b.css("display")&&"hidden"!==b.css("visibility")}d.jqx.jqxWidget("jqxWindow","",{});d.extend(d.jqx._jqxWindow.prototype,{defineInstance:function(){var b={height:"auto",width:200,minHeight:50,maxHeight:1200,minWidth:50,maxWidth:1200,showCloseButton:!0,disabled:!1,autoOpen:!0,keyboardCloseKey:"esc",title:"",content:"",draggable:!0,resizable:!0,animationType:"fade",closeAnimationDuration:250,showAnimationDuration:250,isModal:!1,position:"center",closeButtonSize:16,
        closeButtonAction:"hide",modalOpacity:.3,dragArea:null,okButton:null,cancelButton:null,dialogResult:{OK:!1,Cancel:!1,None:!0},collapsed:!1,showCollapseButton:!1,collapseAnimationDuration:150,collapseButtonSize:16,rtl:!1,keyboardNavigation:!0,headerHeight:null,_events:"created closed moving moved open collapse expand open close resize".split(" "),initContent:null,enableResize:!0,restricter:null,autoFocus:!0,closing:null,_invalidArgumentExceptions:{invalidHeight:"Invalid height!",invalidWidth:"Invalid width!",
            invalidMinHeight:"Invalid minHeight!",invalidMaxHeight:"Invalid maxHeight!",invalidMinWidth:"Invalid minWidth!",invalidMaxWidth:"Invalid maxWidth",invalidKeyCode:"Invalid keyCode!",invalidAnimationType:"Invalid animationType!",invalidCloseAnimationDuration:"Invalid closeAnimationDuration!",invalidShowAnimationDuration:"Invalid showAnimationDuration!",invalidPosition:"Invalid position!",invalidCloseButtonSize:"Invalid closeButtonSize!",invalidCollapseButtonSize:"Invalid collapseButtonSize!",invalidCloseButtonAction:"Invalid cluseButtonAction!",
            invalidModalOpacity:"Invalid modalOpacity!",invalidDragArea:"Invalid dragArea!",invalidDialogResult:"Invalid dialogResult!",invalidIsModal:"You can have just one modal window!"},_enableResizeCollapseBackup:null,_enableResizeBackup:void 0,_heightBeforeCollapse:null,_minHeightBeforeCollapse:null,_mouseDown:!1,_isDragging:!1,_rightContentWrapper:null,_leftContentWrapper:null,_headerContentWrapper:null,_closeButton:null,_collapseButton:null,_title:null,_content:null,_mousePosition:{},_windowPosition:{},
        _modalBackground:null,_SCROLL_WIDTH:21,_visible:!0,modalBackgroundZIndex:1299,modalZIndex:1800,zIndex:1E3,_touchEvents:{mousedown:d.jqx.mobile.getTouchEventName("touchstart"),mouseup:d.jqx.mobile.getTouchEventName("touchend"),mousemove:d.jqx.mobile.getTouchEventName("touchmove"),mouseenter:"mouseenter",mouseleave:"mouseleave",click:d.jqx.mobile.getTouchEventName("touchstart")}};if(this===d.jqx._jqxWindow.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(){this.host.initAnimate&&
    this.host.initAnimate();this.host.attr("role","dialog");this.host.removeAttr("data-bind");this.host.appendTo(document.body);var b=this;(function(c){for(var e=0;e<c.length;e++){var d=c[e];b[d]&&0<=b[d].toString().indexOf("px")&&(b[d]=parseInt(b[d],10))}})("minWidth minHeight maxWidth maxHeight width height".split(" "));var e=function(){var c=parseInt(d(b.restricter).css("padding-top"),10),e=parseInt(d(b.restricter).css("padding-left"),10),h=parseInt(d(b.restricter).css("padding-bottom"),10),k=parseInt(d(b.restricter).css("padding-right"),
        10),l=d(b.restricter).coord();b.dragArea={left:e+l.left,top:c+l.top,width:1+k+d(b.restricter).width(),height:1+h+d(b.restricter).height()}};this.restricter&&e();this.restricter&&(this.addHandler(d(window),"resize."+this.element.id,function(){e()}),this.addHandler(d(window),"orientationchanged."+this.element.id,function(){e()}),this.addHandler(d(window),"orientationchange."+this.element.id,function(){e()}));this._isTouchDevice=d.jqx.mobile.isTouchDevice();this._validateProperties();this._createStructure();
        this._refresh();this.autoOpen||(this.element.style.display="none");d.jqx.browser.msie&&this.host.addClass(this.toThemeProperty("jqx-noshadow"));this.isModal||this._fixWindowZIndex();this._setStartupSettings();this._positionWindow();this._raiseEvent(0);this.autoOpen&&(this._performLayout(),this.isModal&&this._fixWindowZIndex("modal-show"),this.initContent&&(this.initContent(),this._contentInitialized=!0),this._raiseEvent(7),this._raiseEvent(9))},refresh:function(){this._performLayout()},_setStartupSettings:function(){this.disabled&&
    this.disable();this.collapsed&&(this.collapsed=!1,this.collapse(0));this.autoOpen||(this.hide(null,.001,!0),this._visible=!1);null!==this.title&&""!==this.title&&this.setTitle(this.title);null!==this.content&&""!==this.content&&this.setContent(this.content);this.title=this._headerContentWrapper.html();this.content=this._content.html()},_fixWindowZIndex:function(b){var c=d.data(document.body,"jqxwindows-list")||[],f=this.zIndex;if(this.isModal)c&&(c=this._removeFromArray(this.host,c),d.data(document.body,
        "jqxwindows-list",c)),(c=d.data(document.body,"jqxwindows-modallist"))?"modal-show"==b?c.push(this.host):(b=c.indexOf(this.host),-1!=b&&c.splice(b,1)):"modal-show"==b?(c=[],c.push(this.host),d.data(document.body,"jqxwindows-modallist",c)):(d.data(document.body,"jqxwindows-modallist",[]),c=[]),f=this.modalZIndex,d.each(c,function(){if(this.data()&&this.data().jqxWindow){var b=this.data().jqxWindow.instance;b._modalBackground.style.zIndex=f;b.element.style.zIndex=f+1;f+=2}}),d.data(document.body,"jqxwindow-modal",
        this.host);else{0>this._indexOf(this.host,c)&&c.push(this.host);d.data(document.body,"jqxwindows-list",c);if(1<c.length)if(b=c[c.length-2],"auto"==b.css("z-index"))f=this.zIndex+c.length+1;else{var g=this.zIndex;f=parseInt(b.css("z-index"),10)+1;f<g&&(f=g)}this.element.style.zIndex=f;this._sortByStyle("z-index",c)}},_validateProperties:function(){try{this._validateSize();this._validateAnimationProperties();this._validateInteractionProperties();this._validateModalProperties();if(!this.position)throw Error(this._invalidArgumentExceptions.invalidPosition);
        if(isNaN(this.closeButtonSize)||0>parseInt(this.closeButtonSize,10))throw Error(this._invalidArgumentExceptions.invalidCloseButtonSize);if(isNaN(this.collapseButtonSize)||0>parseInt(this.collapseButtonSize,10))throw Error(this._invalidArgumentExceptions.invalidCollapseButtonSize);}catch(c){throw Error(c);}},_validateModalProperties:function(){if(0>this.modalOpacity||1<this.modalOpacity)throw Error(this._invalidArgumentExceptions.invalidModalOpacity);if(this.isModal&&!this._singleModalCheck())throw Error(this._invalidArgumentExceptions.invalidIsModal);
    },_validateSize:function(){this._validateSizeLimits();if("auto"!==this.height&&isNaN(parseInt(this.height,10)))throw Error(this._invalidArgumentExceptions.invalidHeight);if("auto"!==this.width&&isNaN(parseInt(this.width,10)))throw Error(this._invalidArgumentExceptions.invalidWidth);"auto"!==this.height&&this.height<this.minHeight&&(this.height=this.minHeight);this.width<this.minWidth&&(this.width=this.minWidth);"auto"!==this.height&&this.height>this.maxHeight&&(this.height=this.maxHeight);this.width>
    this.maxWidth&&(this.width=this.maxWidth);null!==this.dragArea&&this.dragArea&&(null!==this.dragArea.height&&this.host.height()>this.dragArea.height||parseInt(this.height,10))},_validateSizeLimits:function(){null==this.maxHeight&&(this.maxHeight=9999);null==this.minWidth&&(this.minWidth=0);null==this.maxWidth&&(this.maxWidth=9999);null==this.minHeight&&(this.minHeight=0);if(isNaN(parseInt(this.minHeight,10)))throw Error(this._invalidArgumentExceptions.invalidMinHeight);if(isNaN(parseInt(this.maxHeight,
        10)))throw Error(this._invalidArgumentExceptions.invalidMaxHeight);if(isNaN(parseInt(this.minWidth,10)))throw Error(this._invalidArgumentExceptions.invalidMinWidth);if(isNaN(parseInt(this.maxWidth,10)))throw Error(this._invalidArgumentExceptions.invalidMaxWidth);if(this.minHeight&&this.maxHeight&&parseInt(this.minHeight,10)>parseInt(this.maxHeight,10)&&this.maxHeight!=Number.MAX_VALUE)throw Error(this._invalidArgumentExceptions.invalidMinHeight);if(this.minWidth&&this.maxWidth&&parseInt(this.minWidth,
        10)>parseInt(this.maxWidth,10)&&this.maxWidth!=Number.MAX_VALUE)throw Error(this._invalidArgumentExceptions.invalidMinWidth);},_validateAnimationProperties:function(){if("fade"!==this.animationType&&"slide"!==this.animationType&&"combined"!==this.animationType&&"none"!==this.animationType)throw Error(this._invalidArgumentExceptions.invalidAnimationType);if(isNaN(parseInt(this.closeAnimationDuration,10))||0>this.closeAnimationDuration)throw Error(this._invalidArgumentExceptions.invalidCloseAnimationDuration);
        if(isNaN(parseInt(this.showAnimationDuration,10))||0>this.showAnimationDuration)throw Error(this._invalidArgumentExceptions.invalidShowAnimationDuration);},_validateInteractionProperties:function(){if(0>parseInt(this.keyCode,10)||130<parseInt(this.keyCode,10)&&"esc"!==this.keyCode)throw Error(this._invalidArgumentExceptions.invalidKeyCode);if(null!==this.dragArea&&("undefined"===typeof this.dragArea.width||"undefined"===typeof this.dragArea.height||"undefined"===typeof this.dragArea.left||"undefined"===
        typeof this.dragArea.top))throw Error(this._invalidArgumentExceptions.invalidDragArea);if(!this.dialogResult||!this.dialogResult.OK&&!this.dialogResult.Cancel&&!this.dialogResult.None)throw Error(this._invalidArgumentExceptions.invalidDialogResult);if("hide"!==this.closeButtonAction&&"close"!==this.closeButtonAction)throw Error(this._invalidArgumentExceptions.invalidCloseButtonAction);},_singleModalCheck:function(){for(var b=d.data(document.body,"jqxwindows-list")||[],e=b.length;e;)if(--e,0<d(b[e].attr("id")).length&&
    d(b[e].attr("id")).jqxWindow("isModal"))return!1;return!0},_createStructure:function(){var b=this.host.children();if(1===b.length)this._content=b[0],this._header=document.createElement("div"),this._header.innerHTML=this.host.attr("caption"),this.element.insertBefore(this._header,this._content),this.host.attr("caption",""),this._header=d(this._header),this._content=d(this._content);else if(2===b.length)this._header=d(b[0]),this._content=d(b[1]);else throw Error("Invalid structure!");},_refresh:function(){this._render();
        this._addStyles();this._performLayout();this._removeEventHandlers();this._addEventHandlers();this._initializeResize()},_render:function(){this._addHeaderWrapper();this._addCloseButton();this._addCollapseButton();this._removeModal();this._makeModal()},_addHeaderWrapper:function(){this._headerContentWrapper||(this._header[0].innerHTML='<div style="float:left;">'+this._header[0].innerHTML+"</div>",this._headerContentWrapper=d(this._header.children()[0]),null!==this.headerHeight&&this._header.height(this.headerHeight))},
    _addCloseButton:function(){this._closeButton||(this._closeButtonWrapper=document.createElement("div"),this._closeButtonWrapper.className=this.toThemeProperty("jqx-window-close-button-background"),this._closeButton=document.createElement("div"),this._closeButton.className=this.toThemeProperty("jqx-window-close-button jqx-icon-close"),this._closeButton.style.width="100%",this._closeButton.style.height="100%",this._closeButtonWrapper.appendChild(this._closeButton),this._header[0].appendChild(this._closeButtonWrapper),
        this._closeButtonWrapper=d(this._closeButtonWrapper),this._closeButton=d(this._closeButton))},_addCollapseButton:function(){this._collapseButton||(this._collapseButtonWrapper=document.createElement("div"),this._collapseButtonWrapper.className=this.toThemeProperty("jqx-window-collapse-button-background"),this._collapseButton=document.createElement("div"),this._collapseButton.className=this.toThemeProperty("jqx-window-collapse-button jqx-icon-arrow-up"),this._collapseButton.style.width="100%",this._collapseButton.style.height=
        "100%",this._collapseButtonWrapper.appendChild(this._collapseButton),this._header[0].appendChild(this._collapseButtonWrapper),this._collapseButtonWrapper=d(this._collapseButtonWrapper),this._collapseButton=d(this._collapseButton))},_removeModal:function(){this.isModal||"object"!==typeof this._modalBackground||null===this._modalBackground||(d("."+this.toThemeProperty("jqx-window-modal")).remove(),this._modalBackground=null)},focus:function(){try{this.host.focus();var b=this;setTimeout(function(){b.host.focus()},
        10)}catch(e){}},_makeModal:function(){if(this.isModal&&!this._modalBackground){var b=d.data(document.body,"jqxwindows-list");b&&(this._removeFromArray(this.host,b),d.data(document.body,"jqxwindows-list",b));this._modalBackground=document.createElement("div");this._modalBackground.className=this.toThemeProperty("jqx-window-modal");this._setModalBackgroundStyles();document.body.appendChild(this._modalBackground);this.addHandler(this._modalBackground,this._getEvent("click"),function(){return!1});var e=
        this;this.addHandler(this._modalBackground,"mouseup",function(b){e._stopResizing(e);b.preventDefault()});this.addHandler(this._modalBackground,"mousedown",function(b){var c=e._getTabbables();0<c.length&&(c[0].focus(),setTimeout(function(){c[0].focus()},100));b.preventDefault();return!1});this.addHandler(d(document),"keydown.window"+this.element.id,function(b){if(9===b.keyCode){var c=d.data(document.body,"jqxwindows-modallist");if(!(1<c.length&&c[c.length-1][0]!=e.element)){c=e._getTabbables();var f=
        null,k=null;if(0!==e.element.offsetWidth&&0!==e.element.offsetHeight&&(0<c.length&&(f=c[0],k=c[c.length-1]),b.target!=e.element&&null!=f)){if(!e.element.contains(b.target)||b.target===k&&!b.shiftKey)return f.focus(),!1;if(b.target===f&&b.shiftKey)return k.focus(),!1}}}})}},_addStyles:function(){this.host.addClass(this.toThemeProperty("jqx-rc-all"));this.host.addClass(this.toThemeProperty("jqx-window"));this.host.addClass(this.toThemeProperty("jqx-popup"));d.jqx.browser.msie&&this.host.addClass(this.toThemeProperty("jqx-noshadow"));
        this.host.addClass(this.toThemeProperty("jqx-widget"));this.host.addClass(this.toThemeProperty("jqx-widget-content"));this._header.addClass(this.toThemeProperty("jqx-window-header"));this._content.addClass(this.toThemeProperty("jqx-window-content"));this._header.addClass(this.toThemeProperty("jqx-widget-header"));this._content.addClass(this.toThemeProperty("jqx-widget-content"));this._header.addClass(this.toThemeProperty("jqx-disableselect"));this._header.addClass(this.toThemeProperty("jqx-rc-t"));
        this._content.addClass(this.toThemeProperty("jqx-rc-b"));this.host.attr("tabindex")||(this.element.tabIndex=0,this._header[0].tabIndex=0,this._content[0].tabIndex=0);this.element.setAttribute("hideFocus","true");this.element.style.outline="none"},_performHeaderLayout:function(){this._handleHeaderButtons();this._header[0].style.position="relative";this.rtl?(this._headerContentWrapper[0].style.direction="rtl",this._headerContentWrapper[0].style["float"]="right"):(this._headerContentWrapper[0].style.direction=
        "ltr",this._headerContentWrapper[0].style["float"]="left");this._performHeaderCloseButtonLayout();this._performHeaderCollapseButtonLayout();this._centerElement(this._headerContentWrapper,this._header,"y","margin");this.headerHeight&&(this._centerElement(this._closeButtonWrapper,this._header,"y","margin"),this._centerElement(this._collapseButtonWrapper,this._header,"y","margin"))},_handleHeaderButtons:function(){if(this._closeButtonWrapper){if(this.showCloseButton){this._closeButtonWrapper[0].style.visibility=
        "visible";var b=this._toPx(this.closeButtonSize);this._closeButtonWrapper[0].style.width=b;this._closeButtonWrapper[0].style.height=b}else this._closeButtonWrapper[0].style.visibility="hidden";this.showCollapseButton?(this._collapseButtonWrapper[0].style.visibility="visible",b=this._toPx(this.collapseButtonSize),this._collapseButtonWrapper[0].style.width=b,this._collapseButtonWrapper[0].style.height=b):this._collapseButtonWrapper[0].style.visibility="hidden"}},_performHeaderCloseButtonLayout:function(){if(this._closeButtonWrapper){var b=
        parseInt(this._header.css("padding-right"),10);isNaN(b)||(this._closeButtonWrapper.width(this._closeButton.width()),this.rtl?(this._closeButtonWrapper[0].style.marginRight="0px",this._closeButtonWrapper[0].style.marginLeft=this._toPx(b)):(this._closeButtonWrapper[0].style.marginRight=this._toPx(b),this._closeButtonWrapper[0].style.marginLeft="0px"));this._closeButtonWrapper[0].style.position="absolute";this.rtl?(this._closeButtonWrapper[0].style.right="",this._closeButtonWrapper[0].style.left="0px"):
        (this._closeButtonWrapper[0].style.right="0px",this._closeButtonWrapper[0].style.left="")}},_performHeaderCollapseButtonLayout:function(){if(this._closeButtonWrapper){var b=parseInt(this._header.css("padding-right"),10);if(!isNaN(b)){var e=this._toPx(this.collapseButtonSize);this._collapseButtonWrapper[0].style.width=e;this._collapseButtonWrapper[0].style.height=e;this.rtl?(this._collapseButtonWrapper[0].style.marginRight="0px",this._collapseButtonWrapper[0].style.marginLeft=this._toPx(b)):(this._collapseButtonWrapper[0].style.marginRight=
        this._toPx(b),this._collapseButtonWrapper[0].style.marginLeft="0px")}this._collapseButtonWrapper[0].style.position="absolute";b=this._toPx(this.showCloseButton?this._closeButton.outerWidth(!0):0);this.rtl?(this._collapseButtonWrapper[0].style.right="",this._collapseButtonWrapper[0].style.left=b):(this._collapseButtonWrapper[0].style.right=b,this._collapseButtonWrapper[0].style.left="");this._centerElement(this._collapseButton,d(this._collapseButton[0].parentElement),"y")}},_performWidgetLayout:function(){"auto"!==
    this.width&&(this.width&&0<=this.width.toString().indexOf("%")?this.element.style.width=this.width:this.element.style.width=this._toPx(this.width));this.collapsed||("auto"!==this.height?this.height&&0<=this.height.toString().indexOf("%")?this.element.style.height=this.height:this.element.style.height=this._toPx(this.height):this.element.style.height=this.host.height()+"px",this.element.style.minHeight=this._toPx(this.minHeight));this._setChildrenLayout();var b=this._validateMinSize();this.element.style.maxHeight=
        this._toPx(this.maxHeight);this.element.style.minWidth=this._toPx(this.minWidth);this.element.style.maxWidth=this._toPx(this.maxWidth);b||this._setChildrenLayout()},_setChildrenLayout:function(){this._header.width(this.host.width()-(this._header.outerWidth(!0)-this._header.width()));this._content.width(this.host.width()-(this._content.outerWidth(!0)-this._content.width()));this._content.height(this.host.height()-this._header.outerHeight(!0)-(this._content.outerHeight(!0)-this._content.height()))},
    _validateMinSize:function(){var b=!0;this.minHeight<this._header.height()&&(this.minHeight=this._header.height(),b=!1);var e=d(this._header.children()[0]).outerWidth(),f=this._header.children()[1]?d(this._header.children()[1]).outerWidth():0;100>this.minWidth&&(this.minWidth=Math.min(e+f,100),b=!1);return b},_centerElement:function(b,e,d,g){"number"===typeof e.left&&"number"===typeof e.top&&"number"===typeof e.height&&"number"===typeof e.width?this._centerElementInArea(b,e,d):this._centerElementInParent(b,
        e,d,g)},_centerElementInParent:function(b,e,d,g){var c="none"===b.css("display");d=d.toLowerCase();if(g){var f=g+"Top";g+="Left"}else f="top",g="left";if(0<=d.indexOf("y")){c&&(b[0].style.display="block");var l=b.outerHeight(!0);c&&(b[0].style.display="none");var m=e.height();b[0].style[f]=Math.max(0,m-l)/2+"px"}0<=d.indexOf("x")&&(c&&(b[0].style.display="block"),d=b.outerWidth(!0),c&&(b[0].style.display="none"),e=e.width(),b[0].style[g]=Math.max(0,e-d)/2+"px")},_centerElementInArea:function(b,e,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         d){d=d.toLowerCase();if(0<=d.indexOf("y")){var c=b.outerHeight(!0);b[0].style.top=(e.height-c)/2+e.top+"px"}0<=d.indexOf("x")&&(d=b.outerWidth(!0),b[0].style.left=(e.width-d)/2+e.left+"px")},_removeEventHandlers:function(){this.removeHandler(this._header,this._getEvent("mousedown"));this.removeHandler(this._header,this._getEvent("mousemove"));this.removeHandler(this._header,"focus");this.removeHandler(d(document),this._getEvent("mousemove")+"."+this.host.attr("id"));this.removeHandler(d(document),
        this._getEvent("mouseup")+"."+this.host.attr("id"));this.removeHandler(this.host,"keydown");this.removeHandler(this._closeButton,this._getEvent("click"));this.removeHandler(this._closeButton,this._getEvent("mouseenter"));this.removeHandler(this._closeButton,this._getEvent("mouseleave"));this.removeHandler(this._collapseButton,this._getEvent("click"));this.removeHandler(this._collapseButton,this._getEvent("mouseenter"));this.removeHandler(this._collapseButton,this._getEvent("mouseleave"));this.removeHandler(this.host,
        this._getEvent("mousedown"));this.okButton&&this.removeHandler(d(this.okButton),this._getEvent("click"),this._setDialogResultHandler);this.cancelButton&&this.removeHandler(d(this.cancelButton),this._getEvent("click"),this._setDialogResultHandler);this.removeHandler(this._header,this._getEvent("mouseenter"));this.removeHandler(this._header,this._getEvent("mouseleave"));this.removeHandler(this.host,"resizing",this._windowResizeHandler)},_removeFromArray:function(b,e){return 0<=this._indexOf(b,e)?e.splice(this._indexOf(b,
        e),1):e},_sortByStyle:function(b,e){for(var c=0;c<e.length;c++)for(var d=e.length-1;d>c;d--){var h=e[d],k=e[d-1];parseInt(h.css(b),10)<parseInt(k.css(b),10)&&(e[d]=k,e[d-1]=h)}},_initializeResize:function(){this.resizable&&this.initResize({target:this.host,alsoResize:this._content,maxWidth:this.maxWidth,minWidth:this.minWidth,maxHeight:this.maxHeight,minHeight:this.minHeight,indicatorSize:10,resizeParent:this.dragArea})},_removeResize:function(){this.removeResize()},_getEvent:function(b){return this._isTouchDevice?
        this._touchEvents[b]:b},_addEventHandlers:function(){this._addDragDropHandlers();this._addCloseHandlers();this._addCollapseHandlers();this._addFocusHandlers();this._documentResizeHandlers();this._closeButtonHover();this._collapseButtonHover();this._addDialogButtonsHandlers();this._addHeaderHoverEffect();this._addResizeHandlers();var b=this;this.addHandler(this._header,this._getEvent("mousemove"),function(){b._addHeaderCursorHandlers(b)})},_addResizeHandlers:function(){var b=this;b.addHandler(b.host,
        "resizing",b._windowResizeHandler,{self:b});this.addHandler(d(window),"orientationchanged."+this.element.id,function(){b._performLayout()});this.addHandler(d(window),"orientationchange."+this.element.id,function(){b._performLayout()})},_windowResizeHandler:function(b){var c=b.data.self;c._header.width(c.host.width()-(c._header.outerWidth(!0)-c._header.width()));if(c.width&&0<=c.width.toString().indexOf("%")){var f=d(document.body).width()/100;c.width=1/f*b.args.width+"%"}else c.width=b.args.width;
        c.height&&0<=c.height.toString().indexOf("%")?(f=d(document.body).height()/100,c.height=1/f*b.args.height+"%"):c.height=b.args.height},_addHeaderHoverEffect:function(){var b=this;this.addHandler(this._header,this._getEvent("mouseenter"),function(){d(this).addClass(b.toThemeProperty("jqx-window-header-hover"))});this.addHandler(this._header,this._getEvent("mouseleave"),function(){d(this).removeClass(b.toThemeProperty("jqx-window-header-hover"))})},_addDialogButtonsHandlers:function(){this.okButton&&
    this.addHandler(d(this.okButton),this._getEvent("click"),this._setDialogResultHandler,{self:this,result:"ok"});this.cancelButton&&this.addHandler(d(this.cancelButton),this._getEvent("click"),this._setDialogResultHandler,{self:this,result:"cancel"})},_documentResizeHandlers:function(){var b=this;this.isModal&&this.addHandler(d(window),"resize.window"+this.element.id,function(){if("object"===typeof b._modalBackground&&null!==b._modalBackground){b.isOpen()&&(b._modalBackground.style.display="none");
        if(b.restricter)b._modalBackground.style.left=b._toPx(b.dragArea.left),b._modalBackground.style.top=b._toPx(b.dragArea.top),b._modalBackground.style.width=b._toPx(b.dragArea.width),b._modalBackground.style.height=b._toPx(b.dragArea.height);else{var c=b._getDocumentSize();b._modalBackground.style.width=c.width+"px";b._modalBackground.style.height=c.height+"px"}b.isOpen()&&(b._modalBackground.style.display="block")}})},_setDialogResultHandler:function(b){var c=b.data.self;c._setDialogResult(b.data.result);
        c.closeWindow()},_setDialogResult:function(b){this.dialogResult.OK=!1;this.dialogResult.None=!1;this.dialogResult.Cancel=!1;b=b.toLowerCase();switch(b){case "ok":this.dialogResult.OK=!0;break;case "cancel":this.dialogResult.Cancel=!0;break;default:this.dialogResult.None=!0}},_getDocumentSize:function(){var b=d.jqx.browser.msie&&9>d.jqx.browser.version,e=b?4:0,f=e;document.body.scrollHeight>document.body.clientHeight&&b&&(e=this._SCROLL_WIDTH);document.body.scrollWidth>document.body.clientWidth&&b&&
    (f=this._SCROLL_WIDTH);return{width:d(document).width()-e,height:d(document).height()-f}},_closeButtonHover:function(){var b=this;this.addHandler(this._closeButton,this._getEvent("mouseenter"),function(){b._closeButton.addClass(b.toThemeProperty("jqx-window-close-button-hover"))});this.addHandler(this._closeButton,this._getEvent("mouseleave"),function(){b._closeButton.removeClass(b.toThemeProperty("jqx-window-close-button-hover"))})},_collapseButtonHover:function(){var b=this;this.addHandler(this._collapseButton,
        this._getEvent("mouseenter"),function(){b._collapseButton.addClass(b.toThemeProperty("jqx-window-collapse-button-hover"))});this.addHandler(this._collapseButton,this._getEvent("mouseleave"),function(){b._collapseButton.removeClass(b.toThemeProperty("jqx-window-collapse-button-hover"))})},_setModalBackgroundStyles:function(){if(this.isModal){var b=this._getDocumentSize();d.jqx.browser.msie&&9>d.jqx.browser.version?this._modalBackground.style.filter="alpha(opacity="+100*this.modalOpacity+")":this._modalBackground.style.opacity=
        this.modalOpacity;this._modalBackground.style.position="absolute";this._modalBackground.style.top="0px";this._modalBackground.style.left="0px";this._modalBackground.style.width=b.width;this._modalBackground.style.height=b.height;this._modalBackground.style.zIndex=this.modalBackgroundZIndex;this.autoOpen||(this._modalBackground.style.display="none")}},_addFocusHandlers:function(){var b=this;this.addHandler(this.host,this._getEvent("mousedown"),function(){b.isModal||b.bringToFront()})},_indexOf:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   e){for(var c=0;c<e.length;c++)if(e[c][0]===b[0])return c;return-1},_addCloseHandlers:function(){var b=this;this.addHandler(this._closeButton,this._getEvent("click"),function(c){return b._closeWindow(c)});"none"!==this.keyboardCloseKey&&"number"!==typeof this.keyboardCloseKey&&"esc"===this.keyboardCloseKey.toLowerCase()&&(this.keyboardCloseKey=27);this.addHandler(this.host,"keydown",function(c){c.keyCode===b.keyboardCloseKey&&null!=b.keyboardCloseKey&&"none"!=b.keyboardCloseKey?b._closeWindow(c):b._handleKeys(c)},
        {self:this});this.addHandler(this.host,"keyup",function(){if(b.keyboardNavigation&&b._moved){var c=b.host.coord(),d=c.left;c=c.top;b._raiseEvent(3,d,c,d,c);b._moved=!1}})},_handleKeys:function(b){if(this.keyboardNavigation&&this._headerFocused&&!d(document.activeElement).ischildof(this._content)){var c=b.ctrlKey,f=b.keyCode,g=this.host.coord(),h=g.left;g=g.top;var k=this._getDraggingArea(),l=this.host.width(),m=this.host.height(),p=!0;switch(f){case 37:c?this.resizable&&this.resize(l-10,m):this.draggable&&
        0<=h-10&&this.move(h-10,g);p=!1;break;case 38:c?this.resizable&&this.resize(l,m-10):this.draggable&&0<=g-10&&this.move(h,g-10);p=!1;break;case 39:c?this.resizable&&this.resize(l+10,m):this.draggable&&h+l+10<=k.width&&this.move(h+10,g);p=!1;break;case 40:c?this.resizable&&this.resize(l,m+10):this.draggable&&g+m+10<=k.height&&this.move(h,g+10),p=!1}p||(b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation());return p}},_addCollapseHandlers:function(){var b=this;this.addHandler(this._collapseButton,
        this._getEvent("click"),function(){b.collapsed?b.expand():b.collapse()})},_closeWindow:function(){this.closeWindow();return!1},_addHeaderCursorHandlers:function(b){b.resizeArea&&b.resizable&&!b.collapsed?b._header[0].style.cursor=b._resizeWrapper.style.cursor:b.draggable?b._header[0].style.cursor="move":(b._header[0].style.cursor="default",b._resizeWrapper&&(b._resizeWrapper.style.cursor="default"))},_addDragDropHandlers:function(){if(this.draggable){var b=this;this.addHandler(this.host,"focus",function(){b._headerFocused=
        !0});this.addHandler(this.host,"blur",function(){b._headerFocused=!1});this.addHandler(this._header,"focus",function(){b._headerFocused=!0;return!1});this.addHandler(this._header,this._getEvent("mousedown"),function(c,e,d){e&&(c.pageX=e);d&&(c.pageY=d);b._headerMouseDownHandler(b,c);return!0});this.addHandler(this._header,"dragstart",function(b){b.preventDefault&&b.preventDefault();return!1});this.addHandler(this._header,this._getEvent("mousemove"),function(c){return b._headerMouseMoveHandler(b,c)});
        this.addHandler(d(document),this._getEvent("mousemove")+"."+this.host.attr("id"),function(c){return b._dragHandler(b,c)});this.addHandler(d(document),this._getEvent("mouseup")+"."+this.host.attr("id"),function(c){return b._dropHandler(b,c)});try{if(""!==document.referrer||window.frameElement){var e=null;null!=window.top&&window.top!=window.self&&window.parent&&document.referrer&&(e=document.referrer);e&&-1!=e.indexOf(document.location.host)&&(e=function(c){b._dropHandler(b,c)},window.top.document.addEventListener?
            window.top.document.addEventListener("mouseup",e,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",e))}}catch(f){}}},_headerMouseDownHandler:function(b,e){b.isModal||b.bringToFront();null==b._resizeDirection&&(e=d.jqx.position(e),b._mousePosition.x=e.left,b._mousePosition.y=e.top,b._mouseDown=!0,b._isDragging=!1)},_headerMouseMoveHandler:function(b,e){if(b._mouseDown&&!b._isDragging){d.jqx.mobile.getTouches(e);var c=d.jqx.position(e);var g=c.left;c=c.top;if(g+3<b._mousePosition.x||
        g-3>b._mousePosition.x||c+3<b._mousePosition.y||c-3>b._mousePosition.y)b._isDragging=!0,b._mousePosition={x:g,y:c},b._windowPosition={x:b.host.coord().left,y:b.host.coord().top},d(document.body).addClass(b.toThemeProperty("jqx-disableselect"));return b._isTouchDevice?(e.preventDefault(),!0):!1}return b._isDragging?b._isTouchDevice?(e.preventDefault(),!0):!1:!0},_dropHandler:function(b,e){var c=!0;if(b._isDragging&&!b.isResizing&&!b._resizeDirection){c=parseInt(b.host.css("left"),10);var g=parseInt(b.host.css("top"),
        10),h=b._isTouchDevice?0:e.pageX,k=b._isTouchDevice?0:e.pageY;b.enableResize=b._enableResizeBackup;b._enableResizeBackup="undefined";b._raiseEvent(3,c,g,h,k);c=!1;"undefined"!=e.preventDefault&&e.preventDefault();null!=e.originalEvent&&(e.originalEvent.mouseHandled=!0);"undefined"!=e.stopPropagation&&e.stopPropagation()}b._isDragging=!1;b._mouseDown=!1;d(document.body).removeClass(b.toThemeProperty("jqx-disableselect"));return c},_dragHandler:function(b,e){if(b._isDragging&&!b.isResizing&&!b._resizeDirection){var c=
        b._isTouchDevice?e.originalEvent.which:e.which;"undefined"===typeof b._enableResizeBackup&&(b._enableResizeBackup=b.enableResize);b.enableResize=!1;if(0===c&&d.jqx.browser.msie&&8>d.jqx.browser.version)return b._dropHandler(b,e);c=d.jqx.position(e);b.move(b._windowPosition.x+(c.left-b._mousePosition.x),b._windowPosition.y+(c.top-b._mousePosition.y),e);e.preventDefault();return!1}return!0},_validateCoordinates:function(b,e,d,g){var c=this._getDraggingArea();b=b<c.left?c.left:b;e=e<c.top?c.top:e;var f=
        this.host.outerWidth(!0),l=this.host.outerHeight(!0);b+f>=c.width+c.left-2*g&&(b=c.width+c.left-f-g);e+l>=c.height+c.top-d&&(e=c.height+c.top-l-d);return{x:b,y:e}},_performLayout:function(){this._performHeaderLayout();this._performWidgetLayout()},_parseDragAreaAttributes:function(){null!==this.dragArea&&(this.dragArea.height=parseInt(this.dragArea.height,10),this.dragArea.width=parseInt(this.dragArea.width,10),this.dragArea.top=parseInt(this.dragArea.top,10),this.dragArea.left=parseInt(this.dragArea.left,
        10))},_positionWindow:function(){this._parseDragAreaAttributes();if(this.position instanceof Array&&2===this.position.length&&"number"===typeof this.position[0]&&"number"===typeof this.position[1])this.element.style.left=this._toPx(this.position[0]),this.element.style.top=this._toPx(this.position[1]);else if(this.position instanceof Object)if(this.position.left)this.host.offset(this.position);else if(void 0!==this.position.x&&void 0!==this.position.y)this.element.style.left=this._toPx(this.position.x),
        this.element.style.top=this._toPx(this.position.y);else{if(this.position.center){this._centerElement(this.host,this.position.center,"xy");var b=this.position.center.coord(),e=parseInt(this.host.css("left"),10),d=parseInt(this.host.css("top"),10);this.element.style.left=this._toPx(e+b.left);this.element.style.top=this._toPx(d+b.top)}}else this._positionFromLiteral()},_getDraggingArea:function(){var b={};b.left=this.dragArea&&this.dragArea.left?this.dragArea.left:0;b.top=this.dragArea&&this.dragArea.top?
        this.dragArea.top:0;b.width=this.dragArea&&this.dragArea.width?this.dragArea.width:this._getDocumentSize().width;b.height=this.dragArea&&this.dragArea.height?this.dragArea.height:this._getDocumentSize().height;return b},_positionFromLiteral:function(){this.position instanceof Array||(this.position=this.position.split(","));for(var b=this.position.length,e=this._getDraggingArea();b;)switch(--b,this.position[b]=this.position[b].replace(/ /g,""),this.position[b]){case "top":this.element.style.top=this._toPx(e.top);
        break;case "left":this.element.style.left=this._toPx(e.left);break;case "bottom":this.element.style.top=this._toPx(e.height-this.host.height()+e.top);break;case "right":this.element.style.left=this._toPx(e.left+e.width-this.host.width());break;default:this.dragArea||(e=d(window)),this._centerElement(this.host,e,"xy")}},_raiseEvent:function(b,e,f,g,h){var c=this._events[b],l=d.Event(c),m={};if(2===b||3===b)m.x=e,m.y=f,m.pageX=g,m.pageY=h;if("closed"===c||"close"===c)m.dialogResult=this.dialogResult;
        l.args=m;return this.host.trigger(l)},destroy:function(){this.removeHandler(d(window),"resize.window"+this.element.id);this._removeEventHandlers();this._destroy()},_destroy:function(){this.isModal&&(null!==this._modalBackground&&d(this._modalBackground).remove(),this.host.jqxWindow({isModal:!1}));this.restricter&&(this.removeHandler(d(window),"resize."+this.element.id),this.removeHandler(d(window),"orientationchanged."+this.element.id),this.removeHandler(d(window),"orientationchange."+this.element.id));
        this.host.remove();null!==this._modalBackground&&d(this._modalBackground).remove()},_toClose:function(b,e){return b&&e[0]===this.element||e[0]!==this.element&&"object"===typeof e[0]},propertyChangedHandler:function(b,e,f,g){this._validateProperties();switch(e){case "rtl":this._performLayout();break;case "dragArea":this._positionWindow();break;case "collapseButtonSize":this._performLayout();break;case "closeButtonSize":this._performLayout();break;case "isModal":this._refresh();this._fixWindowZIndex();
        if(!1===g){b=d.data(document.body,"jqxwindows-modallist");var c=[];for(e=0;e<b.length;e++)b[e][0]!==this.element&&c.push(b[e])}d.data(document.body,"jqxwindows-modallist",c);break;case "keyboardCloseKey":this._removeEventHandlers();this._addEventHandlers();break;case "disabled":g?this.disable():(this.disabled=!0,this.enable());break;case "showCloseButton":case "showCollapseButton":this._performLayout();break;case "height":this._performLayout();break;case "width":this._performLayout();break;case "title":this.setTitle(g);
        this.title=g;break;case "content":this.setContent(g);break;case "draggable":this._removeEventHandlers();this._addEventHandlers();this._removeResize();this._initializeResize();break;case "resizable":(this.enableResize=g)?this._initializeResize():this._removeResize();break;case "position":this._positionWindow();break;case "modalOpacity":this._setModalBackgroundStyles();break;case "okButton":g?this._addDialogButtonsHandlers():this.removeHandler(this.okButton);break;case "cancelButton":g?this._addDialogButtonsHandlers():
        this.removeHandler(this.cancelButton);break;case "collapsed":g?f||(this.collapsed=!1,this.collapse(0)):f&&(this.collapsed=!0,this.expand(0));break;case "theme":d.jqx.utilities.setTheme(f,g,this.host);break;case "maxWidth":case "maxHeight":case "minWidth":case "minHeight":b._performLayout(),b._removeResize(),b._initializeResize()}},collapse:function(b){if(!this.collapsed&&!0!==this._animationInProgress&&"none"!=this.host.css("display")){var c=this,f=this._header.outerHeight(!0),g=parseInt(this._header.css("border-bottom-width"),
        10),h=parseInt(this._header.css("margin-bottom"),10);b=isNaN(parseInt(b,10))?this.collapseAnimationDuration:b;isNaN(g)||(f-=2*g);isNaN(h)||(f+=h);this._heightBeforeCollapse=this.host.height();this._minHeightBeforeCollapse=this.host.css("min-height");this.element.style.minHeight=this._toPx(f);c._animationInProgress=!0;this.host.animate({height:f},{duration:b,complete:function(){c._animationInProgress=!1;c.collapsed=!0;c._collapseButton.addClass(c.toThemeProperty("jqx-window-collapse-button-collapsed"));
            c._collapseButton.addClass(c.toThemeProperty("jqx-icon-arrow-down"));c._content[0].style.display="none";c._raiseEvent(5);c._raiseEvent(9);d.jqx.aria(c,"aria-expanded",!1)}})}},expand:function(b){if(this.collapsed&&!0!==this._animationInProgress){var c=this;b=isNaN(parseInt(b,10))?this.collapseAnimationDuration:b;c._animationInProgress=!0;this.host.animate({height:this._heightBeforeCollapse},{duration:b,complete:function(){c._animationInProgress=!1;c.collapsed=!1;c.element.style.minHeight=c._toPx(c._minHeightBeforeCollapse);
            c._collapseButton.removeClass(c.toThemeProperty("jqx-window-collapse-button-collapsed"));c._collapseButton.removeClass(c.toThemeProperty("jqx-icon-arrow-down"));c._content[0].style.display="block";c._raiseEvent(6);c._performWidgetLayout();c._raiseEvent(9);d.jqx.aria(c,"aria-expanded",!0)}})}},closeAll:function(b){b=!0;for(var c=d.data(document.body,"jqxwindows-list"),f=c.length,g=d.data(document.body,"jqxwindow-modal")||[];f;)--f,this._toClose(b,c[f])&&(c[f].jqxWindow("closeWindow","close"),c.splice(f,
        1));this._toClose(b,g)&&(g.jqxWindow("closeWindow","close"),d.data(document.body,"jqxwindow-modal",[]));d.data(document.body,"jqxwindows-list",c)},setTitle:function(b){if("string"===typeof b)this._headerContentWrapper.html(b);else if("object"===typeof b)try{this._headerContentWrapper[0].innerHTML="",b instanceof HTMLElement?this._headerContentWrapper[0].appendChild(b):b.appendTo&&b.appendTo(this._headerContentWrapper)}catch(e){throw Error(e);}this.title=b;this._performLayout()},setContent:function(b){this._contentInitialized=
        !1;for(var c=this._content,f=!1;!f;)c[0].style.width="auto",c[0].style.height="auto",c.hasClass("jqx-window")?f=!0:c=d(c[0].parentNode);if(d.isArray(b))for(c=0;c<b.length;c++)b[c].appendTo(this._content);else if("string"===typeof b)d(this._content[0]).html(b);else if("object"===typeof b)try{this._content[0].innerHTML="",b instanceof HTMLElement?this._content[0].appendChild(b):b.appendTo&&b.appendTo(this._content)}catch(g){throw Error(g);}this.content=b;this._performLayout()},disable:function(){this.disabled=
        !0;this._removeEventHandlers();this._header.addClass(this.toThemeProperty("jqx-window-header-disabled"));this._closeButton.addClass(this.toThemeProperty("jqx-window-close-button-disabled"));this._collapseButton.addClass(this.toThemeProperty("jqx-window-collapse-button-disabled"));this._content.addClass(this.toThemeProperty("jqx-window-content-disabled"));this.host.addClass(this.toThemeProperty("jqx-window-disabled"));this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));this._removeResize()},
    enable:function(){this.disabled&&(this._addEventHandlers(),this._header.removeClass(this.toThemeProperty("jqx-window-header-disabled")),this._content.removeClass(this.toThemeProperty("jqx-window-content-disabled")),this._closeButton.removeClass(this.toThemeProperty("jqx-window-close-button-disabled")),this._collapseButton.removeClass(this.toThemeProperty("jqx-window-collapse-button-disabled")),this.host.removeClass(this.toThemeProperty("jqx-window-disabled")),this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled")),
        this.disabled=!1,this._initializeResize())},isOpen:function(){return this._visible},closeWindow:function(b){var c=this;b="undefined"===typeof b?this.closeButtonAction:b;this.hide(function(){"close"===b&&c._destroy()})},bringToFront:function(){var b=d.data(document.body,"jqxwindows-list");if(this.isModal)d.data(document.body,"jqxwindows-modallist"),this._fixWindowZIndex("modal-hide"),this._fixWindowZIndex("modal-show");else{for(var e=parseInt(b[b.length-1].css("z-index"),10),f=this._indexOf(this.host,
        b),g=b.length-1;g>f;--g){var h=parseInt(b[g].css("z-index"),10)-1;b[g][0].style.zIndex=h}this.element.style.zIndex=e;this._sortByStyle("z-index",b)}},hide:function(b,e,f){var c=this;if(!this.closing||!1!==this.closing()){e=e||this.closeAnimationDuration;switch(this.animationType){case "none":this.element.style.display="none";break;case "fade":c._animationInProgress=!0;this.host.fadeOut({duration:e,callback:function(){c._animationInProgress=!1;b instanceof Function&&b()}});break;case "slide":c._animationInProgress=
        !0;this.host.slideUp({duration:e,callback:function(){c._animationInProgress=!1;b instanceof Function&&b()}});break;case "combined":c._animationInProgress=!0,this.host.animate({opacity:0,width:"0px",height:"0px"},{duration:e,complete:function(){c._animationInProgress=!1;c.element.style.display="none";b instanceof Function&&b()}})}this._visible=!1;this.isModal&&(d(this._modalBackground).hide(),this._fixWindowZIndex("modal-hide"));!0!==f&&(this._raiseEvent(1),this._raiseEvent(8))}},open:function(b,e){this.show(b,
        e)},close:function(b,e,d){this.hide(b,e,d)},show:function(b,e){var c=this;this._setDialogResult("none");e=e||this.showAnimationDuration;switch(this.animationType){case "none":this.element.style.display="block";break;case "fade":c._animationInProgress=!0;this.host.fadeIn({duration:e,complete:function(){c._animationInProgress=!1;b instanceof Function&&b()}});break;case "slide":c._animationInProgress=!0;this.host.slideDown({duration:e,callback:function(){c._animationInProgress=!1;b instanceof Function&&
        b()}});break;case "combined":this.element.style.display="block";var g=c.host.width(),h=c.host.height();this.element.style.minWidth="0px";this.element.style.minHeight="0px";this.element.style.opacity=0;this.element.style.width="0px";this.element.style.height="0px";c._animationInProgress=!0;this.host.animate({opacity:1,width:g+"px",height:h+"px"},{duration:e,complete:function(){c._animationInProgress=!1;c._performLayout();b instanceof Function&&b()}})}this.isModal&&(d(this._modalBackground).show(),
        this._fixWindowZIndex("modal-show"));var k=this;this._visible||(150<e&&"none"!=this.animationType?setTimeout(function(){!k._contentInitialized&&k.initContent&&(k.initContent(),k._contentInitialized=!0);k._raiseEvent(7);k._raiseEvent(9)},e-150):(!k._contentInitialized&&k.initContent&&(k.initContent(),k._contentInitialized=!0),this._raiseEvent(7),k._raiseEvent(9)));this._visible=!0;"combined"!==c.animationType&&this._performLayout();this.autoFocus&&(k._isTouchDevice||k._content[0].focus(),setTimeout(function(){k._isTouchDevice||
    k._content[0].focus()},100))},_getTabbables:function(){var c=d.jqx.browser.msie&&9>d.jqx.browser.version?this._content.find("*"):this._content[0].querySelectorAll("*");var e=[];d.each(c,function(){var c=this.getAttribute("tabindex"),g=null===c;if(c=g||0<=c)g=!g,c=this.nodeName.toLowerCase(),"area"===c?(g=this.parentNode,c=g.name,this.href&&c&&"map"===g.nodeName.toLowerCase()?(g=d("img[usemap=#"+c+"]")[0],c=!!g&&b(g)):c=!1):c=(/input|select|textarea|button|object/.test(c)?!this.disabled:"a"==c?this.href||
        g:g)&&b(this);c&&(e[e.length]=this)});return e},move:function(b,e,f,g){var c=0,k=0;b=parseInt(b,10);e=parseInt(e,10);d.jqx.browser.msie&&(d(window).width()>d(document).width()&&!this.dragArea&&(k=this._SCROLL_WIDTH),d(window).height()<d(document).height()&&document.documentElement.clientWidth>document.documentElement.scrollWidth&&!this.dragArea&&(c=this._SCROLL_WIDTH));c=this._validateCoordinates(b,e,k,c);if(parseInt(this.host.css("left"),10)!==c.x||parseInt(this.host.css("top"),10)!==c.y){if(f){f=
        d.jqx.position(f);var l=f.left;var m=f.top}void 0===l&&(l=b);void 0===m&&(m=e);!1!==g&&this._raiseEvent(2,c.x,c.y,l,m)}this.element.style.left=c.x+"px";this.element.style.top=c.y+"px";this._moved=!0},_toPx:function(b){return"number"===typeof b?b+"px":b}})})(jqxBaseFramework);
(function(d){var b=function(b){return{resizeConfig:function(){this.resizeTarget=null;this.resizeIndicatorSize=5;this.resizeTargetChildren=null;this.resizeArea=this.isResizing=!1;this.minWidth=1;this.maxWidth=100;this.minHeight=1;this.maxHeight=100;this.resizeParent=null;this.enableResize=!0;this._resizeEvents=["resizing","resized","resize"];this._resizeMouseDown=!1;this._resizeCurrentMode=null;this._mouseResizePosition={};this._resizeMethods=null;this._SCROLL_WIDTH=21},_resizeExceptions:{invalidTarget:"Invalid target!",
        invalidMinHeight:"Invalid minimal height!",invalidMaxHeight:"Invalid maximum height!",invalidMinWidth:"Invalid minimum width!",invalidMaxWidth:"Invalid maximum width!",invalidIndicatorSize:"Invalid indicator size!",invalidSize:"Invalid size!"},removeResize:function(){if(this.resizeTarget){var c=b(this.resizeTarget.children(".jqx-resize"));c.detach();var d=c.children();this._removeResizeEventListeners();for(var g=0;g<d.length;g+=1)b(d[g]).detach(),this.resizeTarget.append(d[g]);c.remove()}this._resizeDirection=
        null},initResize:function(c){this.resizeConfig();this.resizeTarget=b(c.target);this.resizeIndicatorSize=c.indicatorSize||10;this.maxWidth=c.maxWidth||100;this.minWidth=c.minWidth||1;this.maxHeight=c.maxHeight||100;this.minHeight=c.minHeight||1;this.resizeParent=c.resizeParent;this._parseResizeParentProperties();this._validateResizeProperties();this._validateResizeTargetDimensions();this._getChildren(this.resizeTarget.maxWidth,this.resizeTarget.minWidth,this.resizeTarget.maxHeight,this.resizeTarget.minHeight,
        c.alsoResize);this._refreshResize();this._cursorBackup=this.resizeTarget.css("cursor");"auto"===this._cursorBackup&&(this._cursorBackup="default")},_validateResizeTargetDimensions:function(){this.resizeTarget.maxWidth=this.maxWidth;this.resizeTarget.minWidth=3*this.resizeIndicatorSize>this.minWidth?3*this.resizeIndicatorSize:this.minWidth;this.resizeTarget.maxHeight=this.maxHeight;this.resizeTarget.minHeight=3*this.resizeIndicatorSize>this.minHeight?3*this.resizeIndicatorSize:this.minHeight},_parseResizeParentProperties:function(){this.resizeParent&&
    (this.resizeParent.left=parseInt(this.resizeParent.left,10),this.resizeParent.top=parseInt(this.resizeParent.top,10),this.resizeParent.width=parseInt(this.resizeParent.width,10),this.resizeParent.height=parseInt(this.resizeParent.height,10))},_getChildren:function(c,d,g,h,k){this.resizeTargetChildren=b(k);this.resizeTargetChildren=this.resizeTargetChildren.toArray();for(c=this.resizeTargetChildren.length;c;)--c,this.resizeTargetChildren[c]=b(this.resizeTargetChildren[c])},_refreshResize:function(){this._renderResize();
        this._performResizeLayout();this._removeResizeEventListeners();this._addResizeEventHandlers()},_renderResize:function(){if(!(void 0!==this._resizeWrapper&&0<b(this._resizeWrapper).parents().length)){var c=document.createElement("div");c.className="jqx-resize jqx-rc-all";c.style.zIndex=8E3;c.appendChild(this._header[0]);c.appendChild(this._content[0]);this.resizeTarget[0].appendChild(c);this._resizeWrapper=c}},_performResizeLayout:function(){this._resizeWrapper.style.height=this.resizeTarget.height()+
        "px";this._resizeWrapper.style.width=this.resizeTarget.width()+"px"},_removeResizeEventListeners:function(){var c=this.resizeTarget.attr("id");this.removeHandler(this._resizeWrapper,"mousemove.resize"+c);this.removeHandler(this._resizeWrapper,"mousedown.resize"+c);this.removeHandler(b(document),"mousemove.resize"+c);this.removeHandler(b(document),"mouseup.resize"+c)},_addResizeEventHandlers:function(){var c=this.resizeTarget.attr("id"),d=this;d._isTouchDevice?(this.addHandler(this._resizeWrapper,
        "touchmove.resize."+c,function(b){d._resizeCursorChangeHandler(d,b)}),this.addHandler(this._resizeWrapper,"touchstart.resize."+c,function(b){d._resizeCursorChangeHandler(d,b);d._resizeMouseDownHandler(d,b)}),this.addHandler(b(document),"touchmove.resize."+c,function(b){return d._resizeHandler(d,b)}),this.addHandler(b(document),"touchend.resize."+c,function(b){d._stopResizing(d,b)})):(this.addHandler(this._resizeWrapper,"mousemove.resize."+c,function(b){d._resizeCursorChangeHandler(d,b)}),this.addHandler(this._resizeWrapper,
        "mousedown.resize."+c,function(b){d._resizeMouseDownHandler(d,b)}),this.addHandler(b(document),"mousemove.resize."+c,function(b){return d._resizeHandler(d,b)}),this.addHandler(b(document),"mouseup.resize."+c,function(b){d._stopResizing(d,b)}));try{if(""!==document.referrer||window.frameElement)c=function(b){d._stopResizing(d,b)},window.top.document.addEventListener?window.top.document.addEventListener("mouseup",c,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",c)}catch(g){}},
    _stopResizing:function(b){b.enableResize&&(b.isResizing&&b._raiseResizeEvent(1),b._resizeMouseDown=!1,b.isResizing=!1,b._resizeDirection=null,b.resizeTarget&&b.resizeTarget.removeClass("jqx-disableselect"));"undefined"==b._cursorBackup&&(b._cursorBackup="default");b._resizeWrapper&&(b._resizeWrapper.style.cursor=b._cursorBackup)},_resizeHandler:function(c,d){if(c.enableResize&&!c.collapsed){if(c.isResizing&&c._resizeDirection){0===d.which&&b.jqx.browser.msie&&9>b.jqx.browser.version&&c._stopResizing(d);
        if(c._isTouchDevice)return d=b.jqx.position(d),c._performResize(d.left,d.top),!1;c._performResize(d.pageX,d.pageY);return!1}return c._isTouchDevice?(d=b.jqx.position(d),c._resizeCaptureCursor(d.left,d.top)):c._resizeCaptureCursor(d.pageX,d.pageY)}},_resizeCaptureCursor:function(b,c){if(this._resizeMouseDown&&!this.isResizing&&this._resizeDirection&&(this._isTouchDevice||b+3<this._mouseResizePosition.x||b-3>this._mouseResizePosition.x||c+3<this._mouseResizePosition.y||c-3>this._mouseResizePosition.y))return this._changeCursor(b-
        parseInt(this.resizeTarget.css("left"),10),c-parseInt(this.resizeTarget.css("top"),10)),this._mouseResizePosition={x:b,y:c},this._prepareResizeMethods(this._resizeDirection),this._resizeBackupData(),this.isResizing=!0,this.resizeTarget.addClass("jqx-disableselect"),!1},_resizeBackupData:function(){this.resizeTarget.lastWidth=this.resizeTarget.width();this.resizeTarget.lastHeight=this.resizeTarget.height();this.resizeTarget.x=parseInt(this.resizeTarget.css("left"),10);this.resizeTarget.y=parseInt(this.resizeTarget.css("top"),
        10);this._resizeBackupChildrenSize()},_resizeBackupChildrenSize:function(){for(var b=this.resizeTargetChildren.length,c;b;)--b,c=this.resizeTargetChildren[b],this.resizeTargetChildren[b].lastWidth=c.width(),this.resizeTargetChildren[b].lastHeight=c.height()},_performResize:function(b,c){b-=this._mouseResizePosition.x;c-=this._mouseResizePosition.y;this._resizeDirection&&this._resize(this.resizeTarget,b,c)},_resizeCursorChangeHandler:function(c,d){!c.enableResize||c.collapsed||c.isResizing||(c._isTouchDevice?
        (d=b.jqx.position(d),c._changeCursor(d.left-parseInt(c.resizeTarget.css("left"),10),d.top-parseInt(c.resizeTarget.css("top"),10))):c._changeCursor(d.pageX-parseInt(c.resizeTarget.css("left"),10),d.pageY-parseInt(c.resizeTarget.css("top"),10)))},_resizeMouseDownHandler:function(c,d){if(c.enableResize&&null!==c._resizeDirection){c._resizeMouseDown=!0;if(c._isTouchDevice){var e=b.jqx.position(d);c._mouseResizePosition.x=e.left;c._mouseResizePosition.y=e.top}else c._mouseResizePosition.x=d.pageX,c._mouseResizePosition.y=
        d.pageY;d.preventDefault()}},_validateResizeProperties:function(){try{if(!this.resizeTarget||1!==this.resizeTarget.length)throw Error(this._resizeExceptions.invalidTarget);if(0>this.minHeight||isNaN(parseInt(this.minHeight,10)))throw Error(this._resizeExceptions.invalidMinHeight);if(0>=this.maxHeight||isNaN(parseInt(this.maxHeight,10)))throw Error(this._resizeExceptions.invalidMaxHeight);if(0>this.minWidth||isNaN(parseInt(this.minWidth,10)))throw Error(this._resizeExceptions.invalidMinWidth);if(0>
        this.maxWidth||isNaN(parseInt(this.maxWidth,10)))throw Error(this._resizeExceptions.invalidMaxWidth);if(0>this.resizeIndicatorSize||isNaN(parseInt(this.resizeIndicatorSize,10)))throw Error(this._resizeExceptions.invalidIndicatorSize);if(this.minHeight>this.maxHeight||this.minWidth>this.maxWidth)throw Error(this._resizeExceptions.invalidSize);}catch(e){throw Error(e);}},_changeCursor:function(b,c){this.isResizing||this._resizeMouseDown||(this.resizeArea=!0,b<=this.resizeIndicatorSize&&0<=b&&c<=this.resizeIndicatorSize&&
    0<c?(this._resizeWrapper.style.cursor="nw-resize",this._resizeDirection="topleft"):c<=this.resizeIndicatorSize&&0<c&&b>=this.resizeTarget.width()-this.resizeIndicatorSize?(this._resizeWrapper.style.cursor="ne-resize",this._resizeDirection="topright"):c>=this.resizeTarget.height()-this.resizeIndicatorSize&&c<this.resizeTarget.height()&&b<=this.resizeIndicatorSize&&0<=b?(this._resizeWrapper.style.cursor="sw-resize",this._resizeDirection="bottomleft"):c>=this.resizeTarget.height()-this.resizeIndicatorSize&&
    c<this.resizeTarget.height()&&b>=this.resizeTarget.width()-this.resizeIndicatorSize&&b<this.resizeTarget.width()?(this._resizeWrapper.style.cursor="se-resize",this._resizeDirection="bottomright"):b<=this.resizeIndicatorSize&&0<=b?(this._resizeWrapper.style.cursor="e-resize",this._resizeDirection="left"):c<=this.resizeIndicatorSize&&0<c?(this._resizeWrapper.style.cursor="n-resize",this._resizeDirection="top"):c>=this.resizeTarget.height()-this.resizeIndicatorSize&&c<this.resizeTarget.height()?(this._resizeWrapper.style.cursor=
        "n-resize",this._resizeDirection="bottom"):b>=this.resizeTarget.width()-this.resizeIndicatorSize&&b<this.resizeTarget.width()?(this._resizeWrapper.style.cursor="e-resize",this._resizeDirection="right"):(this._resizeWrapper.style.cursor=this._cursorBackup,this._resizeDirection=null,this.resizeArea=!1))},_prepareResizeMethods:function(b){this._resizeMethods=[];0<=b.indexOf("left")&&this._resizeMethods.push(this._resizeLeft);0<=b.indexOf("top")&&this._resizeMethods.push(this._resizeTop);0<=b.indexOf("right")&&
    this._resizeMethods.push(this._resizeRight);0<=b.indexOf("bottom")&&this._resizeMethods.push(this._resizeBottom)},_validateResize:function(b,c,d,h,k){return"horizontal"===d||"both"===d?this._validateWidth(b,h,k):"vertical"===d||"both"===d?this._validateHeight(c,h,k):{result:!1,fix:0}},_getParent:function(){return null!==this.resizeParent&&"undefined"!==this.resizeParent&&this.resizeParent.height&&this.resizeParent.width&&this.resizeParent.top&&this.resizeParent.left?this.resizeParent:{left:0,top:0,
        width:b(document).width(),height:b(document).height()}},_validateHeight:function(c,d,g){var e=0,f=this._getParent();b(window).width()>b(document).width()&&b.jqx.browser.msie&&f.height===b(document).height()&&(e=this._SCROLL_WIDTH);return"bottom"===g&&c+d.position().top+e+2>f.height+f.top?{fix:f.height-d.position().top-e-2+f.top,result:!1}:"top"===g&&d.lastHeight-c+d.y<f.top?{fix:c+(d.lastHeight-c+d.y)-f.top,result:!1}:c<d.minHeight?{fix:d.minHeight,result:!1}:c>d.maxHeight?{fix:d.maxHeight,result:!1}:
        {result:!0,fix:c}},_validateWidth:function(c,d,g){var e=0,f=this._getParent();b(window).height()<b(document).height()&&b.jqx.browser.msie&&document.documentElement.clientWidth>=document.documentElement.scrollWidth&&f.width===b(document).width()&&(e=this._SCROLL_WIDTH);return"right"===g&&c+d.position().left+e+2>f.width+f.left?{fix:f.width-d.position().left-e-2+f.left,result:!1}:"left"===g&&d.lastWidth-c+d.x<f.left?{fix:c+(d.lastWidth-c+d.x)-f.left,result:!1}:c<d.minWidth?{fix:d.minWidth,result:!1}:
        c>d.maxWidth?{fix:d.maxWidth,result:!1}:{result:!0,fix:c}},_resize:function(b,c,d){for(var e=this._resizeMethods.length,f=0;f<e;f++)if(this._resizeMethods[f]instanceof Function)this._resizeMethods[f]({element:b,x:c,y:d,self:this});this._performResizeLayout()},resize:function(b,c){if(this.resizable){b-=this.host.width();c-=this.host.height();var e="right";0!==c&&(e="bottom");this._resizeDirection=e;this._prepareResizeMethods(this._resizeDirection);this._resizeBackupData();this.isResizing=!0;this._resize(this.resizeTarget,
        b,c);this.isResizing=!1;0<b&&0<c&&(this._resizeDirection="right",this._prepareResizeMethods(this._resizeDirection),this._resizeBackupData(),this.isResizing=!0,this._resize(this.resizeTarget,b,c),this.isResizing=!1)}},_setResizeChildrenSize:function(b,c){for(var e=this.resizeTargetChildren.length;e;)if(e--,"width"===c){var d=this.resizeTargetChildren[e].lastWidth-(this.resizeTarget.lastWidth-b);d<this.resizeTarget.maxWidth&&0<d&&this.resizeTargetChildren[e].width(d)}else d=this.resizeTargetChildren[e].lastHeight-
        (this.resizeTarget.lastHeight-b),d<this.resizeTarget.maxHeight&&0<d&&this.resizeTargetChildren[e].height(d)},_resizeRight:function(c){var e=c.element.lastWidth+c.x,d=c.self._validateResize(e,0,"horizontal",c.element,"right");d.result||(e=d.fix);c.element.width()!==e&&(c.self._setResizeChildrenSize(e,"width"),c.element.width(e),0<=c.self.width.toString().indexOf("%")&&(d=b(document.body).width()/100,c.element[0].style.width=1/d*e+"%",c.self._setChildrenLayout()),c.self._raiseResizeEvent(0));return e},
    _resizeLeft:function(c){var e=c.element.lastWidth-c.x,d=c.self._validateResize(e,0,"horizontal",c.element,"left"),h=c.element.x+c.x;if(d.result)return c.element.width()!==e&&(c.self._setResizeChildrenSize(e,"width"),c.element.width(e),0<=c.self.width.toString().indexOf("%")&&(d=b(document.body).width()/100,c.element[0].style.width=1/d*e+"%",c.self._setChildrenLayout()),c.element[0].style.left=c.self._toPx(h),c.self._raiseResizeEvent(0)),e},_resizeBottom:function(c){var e=c.element.lastHeight+c.y,
        d=c.self._validateResize(0,e,"vertical",c.element,"bottom");d.result||(e=d.fix);c.element.height()!==e&&(c.self._setResizeChildrenSize(e,"height"),c.element.height(e),0<=c.self.height.toString().indexOf("%")&&(d=b(document.body).height()/100,c.element[0].style.height=1/d*e+"%",c.self._setChildrenLayout()),c.self._raiseResizeEvent(0));return e},_resizeTop:function(c){var e=c.element.lastHeight-c.y,d=c.self._validateResize(0,e,"vertical",c.element,"top"),h=c.element.y+c.y;if(d.result)return c.element.height()!==
    e&&(c.self._setResizeChildrenSize(e,"height"),c.element.height(e),0<=c.self.height.toString().indexOf("%")&&(d=b(document.body).height()/100,c.element[0].style.height=1/d*e+"%",c.self._setChildrenLayout()),c.element[0].style.top=c.self._toPx(h),c.self._raiseResizeEvent(0)),e},_raiseResizeEvent:function(c){var e=this._resizeEvents[c],d=b.Event(e),h={};h.width=parseInt(this.resizeTarget[0].style.width,10);h.height=parseInt(this.resizeTarget[0].style.height,10);d.args=h;0===c&&(e=this._resizeEvents[2],
        c=b.Event(e),c.args=h,this.resizeTarget.trigger(c));return this.resizeTarget.trigger(d)}}}(jqxBaseFramework);d.extend(d.jqx._jqxWindow.prototype,b)})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxInput","",{});d.extend(d.jqx._jqxInput.prototype,{defineInstance:function(){var b={disabled:!1,filter:this._filter,sort:this._sort,highlight:this._highlight,dropDownWidth:null,renderer:this._renderer,opened:!1,$popup:document.createElement("ul"),source:[],roundedCorners:!0,searchMode:"default",placeHolder:"",width:null,height:null,value:"",rtl:!1,hint:!0,displayMember:"",valueMember:"",events:["select","open","close","change"],popupZIndex:1E3,items:8,minLength:1,maxLength:null};
        if(this===d.jqx._jqxInput.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(){if("none"===this.host.css("display")||!1===document.body.contains(this.element))this._initiallyHidden=!0;this._popupHelper=d(this.$popup);this.render()},render:function(){var b=this;this.input=this.element;if(b.isMaterialized()&&this.input instanceof HTMLInputElement){var c=this.host.children();d.each(c,function(e){var f="jqx-input-group-addon";d(this).removeClass(b.toThemeProperty("jqx-rc-all"));
        0===e&&(f+=" jqx-rc-l");e===c.length-1&&(f+=" jqx-rc-r");this!==b.element&&(f+=" jqx-fill-state-normal");this.className+=" "+b.toThemeProperty(f)});var e=d("<div></div>");e.addClass(b.toThemeProperty("jqx-input-group"));this.host.after(e);var f=this.element,g=this.host.data();e.append(f);var h=d("<label></label");this.hint&&(h[0].innerHTML=this.placeHolder);h.addClass(b.toThemeProperty("jqx-input-label"));e.append(h);var k=d("<span></span>");e.append(k);k.addClass(b.toThemeProperty("jqx-input-bar"));
        e[0].id=this.element.id;this.element.removeAttribute("id");e[0].style.cssText=this.element.style.cssText;b.input=b.element;this.input instanceof HTMLInputElement||(this.input=this.host.find("input"),0<this.input.length&&(this.input=this.input[0]),d(this.input).addClass(this.toThemeProperty("jqx-input-widget")));this.label=h;this.bar=k;this.element.style.cssText="";this.host=e;this.element=e[0];this.host.data(g);b=this;b.template&&(b.bar.addClass(b.toThemeProperty("jqx-"+b.template)),b.label.addClass(b.toThemeProperty("jqx-"+
            b.template)));0<c.length&&(b._hasAddons=!0)}else if("textarea"===this.element.nodeName.toLowerCase())this.element.style.overflow="auto";else if("div"===this.element.nodeName.toLowerCase()){this.baseHost=this.element;f=b.element.getElementsByTagName("input");var l=!1;d.each(f,function(){var b=this.type;if(null==b||"text"===b||"textarea"===b)return f=d(this),l=!0,!1});if(!l)throw Error("jqxInput: Missing Text Input in the Input Group");0<f.length&&(this.baseHost=d(this.element),b.baseElement=b.element,
        g=this.host.data(),this.host=f,this.element=f[0],b.input=f[0],this.host.data(g),b.baseElement.className+=" "+b.toThemeProperty("jqx-widget jqx-rc-all jqx-input-group"),c=this.baseHost.children(),d.each(c,function(e){var f="jqx-input-group-addon";d(this).removeClass(b.toThemeProperty("jqx-rc-all"));0===e&&(f+=" jqx-rc-l");e===c.length-1&&(f+=" jqx-rc-r");this!==b.element&&(f+=" jqx-fill-state-normal");this.className+=" "+b.toThemeProperty(f)}))}this.addHandlers();this.rtl&&(b.element.className+=" "+
        b.toThemeProperty("jqx-rtl"));b.element.setAttribute("role","textbox");d.jqx.aria(this,"aria-autocomplete","both");d.jqx.aria(this,"aria-disabled",this.disabled);d.jqx.aria(this,"aria-readonly",!1);d.jqx.aria(this,"aria-multiline",!1);this.source&&this.source.length&&d.jqx.aria(this,"aria-haspopup",!0);""!==this.value&&(this.input.value=this.value);this._oldsource=this.source;this._updateSource()},_updateSource:function(){var b=this,c=function(c){if(void 0===c)return null;if("string"===typeof c||
        c instanceof String)return{label:c,value:c};if("string"!==typeof c&&!1===c instanceof String){var e="",d="";""!==b.displayMember&&void 0!==b.displayMember&&c[b.displayMember]&&(e=c[b.displayMember]);""!==b.valueMember&&void 0!==b.valueMember&&(d=c[b.valueMember]);""===e&&(e=c.label);""===d&&(d=c.value);return{label:e,value:d}}return c},e=function(b){for(var e=[],d=0;d<b.length;d++)e[d]=c(b[d]);return e};if(this.source&&this.source._source){this.adapter=this.source;if(null!=this.adapter._source.localdata)this.adapter.unbindBindingUpdate(this.element.id),
        this.adapter.bindBindingUpdate(this.element.id,function(){b.source=e(b.adapter.records)});else{var f={};this.adapter._options.data?d.extend(b.adapter._options.data,f):(this.source._source.data&&d.extend(f,this.source._source.data),this.adapter._options.data=f);this.adapter.unbindDownloadComplete(this.element.id);this.adapter.bindDownloadComplete(this.element.id,function(){b.source=e(b.adapter.records)})}this.source.dataBind()}else d.isFunction(this.source)||(this.source=e(this.source))},_refreshClasses:function(b){b=
        b?"addClass":"removeClass";var c="jqx-widget-content jqx-input-widget jqx-input jqx-widget",e="jqx-popup jqx-input-popup jqx-menu jqx-menu-vertical jqx-menu-dropdown jqx-widget jqx-widget-content";d.jqx.browser.msie&&(e+=" jqx-noshadow");this.roundedCorners&&(c+=" jqx-rc-all",e+=" jqx-rc-all");this.disabled?c+=" jqx-fill-state-disabled":this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled"));this.host[b](this.toThemeProperty(c));this._popupHelper[b](this.toThemeProperty(e))},selectAll:function(){var b=
        this.host;!1===b[0]instanceof HTMLInputElement&&(b=d(this.input));setTimeout(function(){if("selectionStart"in b[0])b[0].focus(),b[0].setSelectionRange(0,b[0].value.length);else{var c=b[0].createTextRange();c.collapse(!0);c.moveEnd("character",b[0].value.length);c.moveStart("character",0);c.select()}},10)},selectLast:function(){var b=this.host;!1===b[0]instanceof HTMLInputElement&&(b=d(this.input));this.selectStart(b[0].value.length)},selectFirst:function(){this.selectStart(0)},selectStart:function(b){var c=
        this.host;!1===c[0]instanceof HTMLInputElement&&(c=d(this.input));setTimeout(function(){if("selectionStart"in c[0])c[0].focus(),c[0].setSelectionRange(b,b);else{var e=c[0].createTextRange();e.collapse(!0);e.moveEnd("character",b);e.moveStart("character",b);e.select()}},10)},focus:function(){try{var b=this;b.element.focus();setTimeout(function(){b.element.focus()},25)}catch(c){}},resize:function(b,c){this.width=b;this.height=c;this.refresh()},refresh:function(){this._refreshClasses(!1);this._refreshClasses(!0);
        if(this.baseHost){null!=this.width&&-1!=this.width.toString().indexOf("px")?this.baseElement.style.width=parseInt(this.width)+"px":void 0==this.width||isNaN(this.width)||(this.baseElement.style.width=this.width+"px");null!=this.height&&-1!=this.height.toString().indexOf("px")?this.baseElement.style.height=parseInt(this.height)+"px":void 0==this.height||isNaN(this.height)||(this.baseElement.style.height=this.height+"px");var b=this,c=d.jqx.browser.msie&&9>d.jqx.browser.version,e=0;d.each(this.baseHost.children(),
            function(){this.style.height="100%";this!==b.element&&(e+=d(this).outerWidth())});b._addonsWidth=e;if(c){var f=Math.max(0,b.baseElement.offsetHeight-2);b.element.style.width=Math.max(0,b.baseElement.offsetWidth-e-1)+"px";b.element.style.minHeight=f+"px";b.element.style.lineHeight=f+"px"}else b.element.style.width="calc(100% - "+e+"px)";d.jqx.utilities.resize(b.baseHost,function(){if(c&&"string"===typeof b.width&&-1!==b.width.indexOf("%")&&!b._initiallyHidden)b.element.style.width=b.baseElement.offsetWidth-
            b._addonsWidth-1+"px";else if(b._initiallyHidden){b._addonsWidth=b._getAddonsWidth();if(c){b.element.style.width=b.baseElement.offsetWidth-b._addonsWidth-1+"px";var e=b.baseElement.offsetHeight-2;b.element.style.minHeight=e+"px";b.element.style.lineHeight=e+"px"}else b.element.style.width="calc(100% - "+b._addonsWidth+"px)";b._initiallyHidden=!1}})}else null!=this.width&&-1!=this.width.toString().indexOf("px")?this.element.style.width=parseInt(this.width)+"px":void 0==this.width||isNaN(this.width)?
            this.element.style.width=this.width:this.element.style.width=this.width+"px",null!=this.height&&-1!=this.height.toString().indexOf("px")?this.element.style.height=parseInt(this.height)+"px":void 0==this.height||isNaN(this.height)?this.element.style.height=this.height:this.element.style.height=this.height+"px",this._hasAddons&&(this._addonsWidth=35,this.input.style.width="calc(100% - "+this._addonsWidth+"px)");this.disabled?this.element.setAttribute("disabled",!0):this.element.removeAttribute("disabled");
        this.maxLength&&(this.element.setAttribute("maxlength",this.maxLength),this.input&&this.input.setAttribute("maxlength",this.maxLength));this.element.getAttribute("placeholder")||this._refreshPlaceHolder()},_refreshPlaceHolder:function(){this.isMaterialized()&&this.hint||("placeholder"in this.input&&!(d.jqx.browser.msie&&9>d.jqx.browser.version)?this.input.setAttribute("placeHolder",this.placeHolder):""===this.input.value&&(this.input.value=this.placeHolder));this.hint&&(""!==this.input.value?this.element.setAttribute("hint",
        !0):this.element.removeAttribute("hint"),this.label&&(this.label.innerHTML=this.placeHolder))},destroy:function(){this.removeHandlers();this.baseHost?this.baseHost.remove():this.host.remove();this.$popup&&this._popupHelper.remove()},propertiesChangedHandler:function(b,c,e){e.width&&e.height&&2===Object.keys(e).length&&b.refresh()},propertyChangedHandler:function(b,c,e,f){if("width"===c&&f!==e)b.baseHost?(b.baseElement.style.width=b._toPx(f),d.jqx.browser.msie&&9>d.jqx.browser.version&&(b.element.style.width=
        b.baseElement.offsetWidth-b._addonsWidth-1+"px")):b.element.style.width=b._toPx(f);else if("placeHolder"===c)"placeholder"in b.element&&!(d.jqx.browser.msie&&9>d.jqx.browser.version)||b.input.value!==e||(b.input.value=""),b._refreshPlaceHolder();else if(!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2===Object.keys(b.batchUpdate).length))if("theme"===c&&d.jqx.utilities.setTheme(e,f,b.host),"opened"===c)f?b.open():b.close();else{"source"===c&&(b._oldsource=f,b._updateSource());if("displayMember"===
        c||"valueMember"===c)b.source=b._oldsource,b._updateSource();"disabled"===c&&d.jqx.aria(b,"aria-disabled",b.disabled);"value"===c&&(b.input.value=f,b._refreshPlaceHolder());b.refresh()}},select:function(b,c,e){c=this._find("jqx-fill-state-pressed",this._popupHelper);b=c.getAttribute("data-value");c=c.getAttribute("data-name");this.input.value=this.renderer(c,this.input.value);this.selectedItem={label:c,value:b};this.element.setAttribute("data-value",b);this.element.setAttribute("data-label",c);this._raiseEvent("0",
        {item:{label:c,value:b},label:c,value:b});this._raiseEvent("3",{type:e,item:{label:c,value:b},label:c,value:b});this.value=c;return this.close()},val:function(b){if(0===arguments.length||null!=b&&"object"===typeof b&&!b.label&&!b.value)return""!==this.displayMember&&""!==this.valueMember&&this.selectedItem?""===this.input.value?"":this.selectedItem:this.input.value;if(b&&b.label)return this.selectedItem={label:b.label,value:b.value},this.element.setAttribute("data-value",b.value),this.element.setAttribute("data-label",
        b.label),this.value=b,this.input.value=b.label,this.input&&(this.input.value=b.label),this.input.value;this.value=b;this.input.value=b;this.element.setAttribute("data-value",b);this.element.setAttribute("data-label",b);b&&b.label?this._raiseEvent("3",{type:null,item:{label:b.label,value:b.value},label:b.label,value:b.value}):this._raiseEvent("3",{type:null,item:{label:b,value:b},label:b,value:b});this._refreshPlaceHolder();return this.input.value},_raiseEvent:function(b,c){void 0===c&&(c={owner:null});
        b=this.events[b];c.owner=this;b=new d.Event(b);b.owner=this;b.args=c;b.preventDefault&&b.preventDefault();return this.host.trigger(b)},_renderer:function(b){return b},open:function(){if(!d.jqx.isHidden(this.host)){var b=d.extend({},this.host.coord(!0),{height:this.element.offsetHeight});if(this.$popup.parentNode!==document.body){var c=this.element.id+"_popup";this.$popup.id=c;d.jqx.aria(this,"aria-owns",c);document.body.appendChild(this.$popup)}this.$popup.style.position="absolute";this.$popup.style.zIndex=
        this.popupZIndex;this.$popup.style.top=this._toPx(b.top+b.height);this.$popup.style.left=this._toPx(b.left);this.$popup.style.display="block";var e=0;b=this._popupHelper.children();d.each(b,function(){e+=d(this).outerHeight()+1});this.$popup.style.height=this._toPx(e);this.opened=!0;this._raiseEvent("1",{popup:this.$popup});d.jqx.aria(this,"aria-expanded",!0);return this}},close:function(){if(this.opened)return this.$popup.style.display="none",this.opened=!1,this._raiseEvent("2",{popup:this.$popup}),
        d.jqx.aria(this,"aria-expanded",!1),this._refreshPlaceHolder(),this},suggest:function(){var b;this.query=this.input.value;return!this.query||this.query.length<this.minLength?this.opened?this.close():this:(b=d.isFunction(this.source)?this.source(this.query,d.proxy(this.load,this)):this.source)?this.load(b):this},load:function(b){for(var c=[],e=0;e<b.length;e++){var d=b[e];this.filter(d)&&c.push(d)}c=this.sort(c);return c.length?this._render(c.slice(0,this.items)).open():this.opened?this.close():this},
    _filter:function(b){var c=this.query,e=b;null!=b.label?e=b.label:this.displayMember&&(e=b[this.displayMember]);switch(this.searchMode){case "none":break;default:return d.jqx.string.containsIgnoreCase(e,c);case "contains":return d.jqx.string.contains(e,c);case "equals":return d.jqx.string.equals(e,c);case "equalsignorecase":return d.jqx.string.equalsIgnoreCase(e,c);case "startswith":return d.jqx.string.startsWith(e,c);case "startswithignorecase":return d.jqx.string.startsWithIgnoreCase(e,c);case "endswith":return d.jqx.string.endsWith(e,
        c);case "endswithignorecase":return d.jqx.string.endsWithIgnoreCase(e,c)}},_sort:function(b){for(var c=[],e=[],d=[],g=0;g<b.length;g++){var h=b[g],k=h;h.label?k=h.label:this.displayMember&&(k=h[this.displayMember]);0===k.toString().toLowerCase().indexOf(this.query.toString().toLowerCase())?c.push(h):0<=k.toString().indexOf(this.query)?e.push(h):0<=k.toString().toLowerCase().indexOf(this.query.toString().toLowerCase())&&d.push(h)}return c.concat(e,d)},_highlight:function(b){var c=this.query;c=c.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,
        "\\$&");return b.replace(new RegExp("("+c+")","ig"),function(b,c){return"<b>"+c+"</b>"})},_render:function(b){var c=this,e=c._popupHelper.children();if(0<e.length)for(var f=0;f<e.length;f++)d(e[f]).remove();var g=function(b,e){var d=b,f=document.createElement("li"),g=document.createElement("a");g.setAttribute("href","#");f.appendChild(g);if(void 0!==b.value&&null!==b.value){var h=void 0!==b.label&&null!==b.label?b.label:b.value;var k=b.value}else void 0!==b.label&&null!==b.label?k=h=b.label:void 0!==
    c.displayMember&&""!==c.displayMember?(h=b[c.displayMember],k=b[c.valueMember]):k=h=b;f.setAttribute("data-value",k);f.setAttribute("data-name",h);b.label?d=b.label:c.displayMember&&(d=b[c.displayMember]);g.innerHTML=c.highlight(d);b="";c.rtl&&(b=" jqx-rtl");0===e&&(b+=" jqx-fill-state-pressed");f.className=c.toThemeProperty("jqx-item jqx-menu-item jqx-rc-all"+b);c.$popup.appendChild(f);c.addHandler(f,"mouseenter",function(b){c.mouseenter(b)})};(function(b){for(var c=0;c<b.length;c++)g(b[c],c)})(b);
        this.$popup.style.width=this.dropDownWidth?c._toPx(c.dropDownWidth):c._toPx(c.element.offsetWidth-6);return this},next:function(){var b=this._find("jqx-fill-state-pressed",this._popupHelper),c=b.nextSibling;d(b).removeClass(this.toThemeProperty("jqx-fill-state-pressed"));c||(c=this.$popup.firstChild);c.className+=" "+this.toThemeProperty("jqx-fill-state-pressed")},prev:function(){var b=this._find("jqx-fill-state-pressed",this._popupHelper),c=b.previousSibling;d(b).removeClass(this.toThemeProperty("jqx-fill-state-pressed"));
        c||(c=this.$popup.lastChild);c.className+=" "+this.toThemeProperty("jqx-fill-state-pressed")},addHandlers:function(){var b=this,c=".jqxInput"+b.element.id;b.addHandler(b.host,"focus"+c,function(){b.onFocus()});b.addHandler(b.host,"blur"+c,function(){b.onBlur()});b.addHandler(b.host,"change"+c,function(c){if(!c.args){c.stopPropagation();c.preventDefault();var e=b.val();e&&e.label?(c=e.label,e=e.val):c=e;b._raiseEvent("3",{type:"keyboard",item:{label:c,value:e},label:c,value:e});b.value=c;b._refreshPlaceHolder()}});
        b.addHandler(b.host,"keypress"+c,function(c){b.keypress(c)});b.addHandler(b.host,"keyup"+c,function(c){b.keyup(c)});b.addHandler(b.host,"keydown"+c,function(c){b.keydown(c)});b.addHandler(b.$popup,"mousedown"+c,function(c){b.click(c)})},removeHandlers:function(){var b=".jqxInput"+this.element.id;this.removeHandler(this.host,"change"+b);this.removeHandler(this.host,"focus"+b);this.removeHandler(this.host,"blur"+b);this.removeHandler(this.host,"keypress"+b);this.removeHandler(this.host,"keyup"+b);this.removeHandler(this.host,
        "keydown"+b);this.removeHandler(this.$popup,"mousedown"+b)},move:function(b){if(this.opened){switch(b.keyCode){case 9:case 13:case 27:b.preventDefault();break;case 38:b.shiftKey||(b.preventDefault(),this.prev());break;case 40:b.shiftKey||(b.preventDefault(),this.next())}b.stopPropagation()}},keydown:function(b){this.suppressKeyPressRepeat=-1!==[40,38,9,13,27].indexOf(b.keyCode);this.move(b)},keypress:function(b){this.suppressKeyPressRepeat||this.move(b)},keyup:function(b){switch(b.keyCode){case 40:case 38:case 16:case 17:case 18:break;
        case 9:case 13:if(!this.opened)return;this.select(b,this,"keyboard");break;case 27:if(!this.opened)return;this.close();break;default:var c=this;this.timer&&clearTimeout(this.timer);this.timer=setTimeout(function(){c.suggest()},300)}b.stopPropagation();b.preventDefault()},clear:function(){this.val("")},onBlur:function(){var b=this;setTimeout(function(){b.close()},150);b.host.removeClass(b.toThemeProperty("jqx-fill-state-focus"));b._refreshPlaceHolder()},onFocus:function(){this.element.className+=" "+
        this.toThemeProperty("jqx-fill-state-focus");this._refreshPlaceHolder()},click:function(b){b.stopPropagation();b.preventDefault();this.select(b,this,"mouse")},mouseenter:function(b){d(this._find("jqx-fill-state-pressed",this._popupHelper)).removeClass(this.toThemeProperty("jqx-fill-state-pressed"));b.currentTarget.className+=" "+this.toThemeProperty("jqx-fill-state-pressed")},_toPx:function(b){return"number"===typeof b?b+"px":b},_find:function(b,c){c=c.children();for(var e=0;e<c.length;e++){var d=
        c[e];if(-1!==d.className.indexOf(b))return d}},_getAddonsWidth:function(){for(var b=this.baseHost.children(),c=0,e=0;e<b.length;e++)b[e]!==this.element&&(c+=d(b[e]).outerWidth());return c}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxNumberInput","",{});d.extend(d.jqx._jqxNumberInput.prototype,{defineInstance:function(){var b={value:0,decimal:0,min:-99999999,max:99999999,width:200,validationMessage:"Invalid value",height:25,textAlign:"right",readOnly:!1,promptChar:"_",decimalDigits:2,decimalSeparator:".",groupSeparator:",",groupSize:3,symbol:"",symbolPosition:"left",digits:8,negative:!1,negativeSymbol:"-",disabled:!1,inputMode:"advanced",spinButtons:!1,spinButtonsWidth:18,spinButtonsStep:1,autoValidate:!0,
        spinMode:"advanced",enableMouseWheel:!0,touchMode:"auto",allowNull:!0,placeHolder:"",changeType:null,template:"",rtl:!1,hint:!0,events:"valueChanged textchanged mousedown mouseup keydown keyup keypress change".split(" "),aria:{"aria-valuenow":{name:"decimal",type:"number"},"aria-valuemin":{name:"min",type:"number"},"aria-valuemax":{name:"max",type:"number"},"aria-disabled":{name:"disabled",type:"boolean"}},invalidArgumentExceptions:["invalid argument exception"]};if(this===d.jqx._jqxNumberInput.prototype)return b;
        d.extend(!0,this,b);return b},createInstance:function(b){""===this.promptChar&&(this.promptChar=" ");b=this.host.attr("value");void 0!=b&&(this.decimal=b);0===this.decimal&&(null!=this.value?this.decimal=this.value:null===this.value&&0!==this.decimal&&(this.value=this.decimal));this._createFromInput("jqxNumberInput");this.render()},_updateHint:function(){var b=this;b.hint&&b.isMaterialized()&&setTimeout(function(){0===b.numberInput[0].value.length?(b.element.removeAttribute("hint"),b.label&&b.label[0]&&
    (b.label[0].innerHTML=b.placeHolder)):b.element.setAttribute("hint",!0)})},_createFromInput:function(b){if("input"==this.element.nodeName.toLowerCase()){this.field=this.element;this.field.className&&(this._className=this.field.className);var c={title:this.field.title};this.field.value&&(this.decimal=parseFloat(this.field.value));if(this.field.getAttribute("min")){var e=this.field.getAttribute("min");this.min=parseFloat(e)}this.field.getAttribute("step")&&(e=this.field.getAttribute("step"),this.spinButtonsStep=
        parseFloat(e));this.field.getAttribute("max")&&(e=this.field.getAttribute("max"),this.max=parseFloat(e));c.id=this.field.id.length?this.field.id.replace(/[^\w]/g,"_")+"_"+b:d.jqx.utilities.createId()+"_"+b;b=d("<div></div>",c);b[0].style.cssText=this.field.style.cssText;this.width||(this.width=d(this.field).width());this.height||(this.height=d(this.field).outerHeight());d(this.field).hide().after(b);e=this.host.data();this.host=b;this.host.data(e);this.element=b[0];this.element.id=this.field.id;this.field.id=
        c.id;this._className&&(this.host.addClass(this._className),d(this.field).removeClass(this._className));this.field.tabIndex&&(c=this.field.tabIndex,this.field.tabIndex=-1,this.element.tabIndex=c)}},_doTouchHandling:function(){var b=this.savedValue;this.parsing||(this.parsing=!0);if(this.parsing){this.numberInput.val()&&0==this.numberInput.val().indexOf("-")?this.setvalue("negative",!0):this.setvalue("negative",!1);for(var c=this.numberInput.val(),e=0;e<c.length-1;e++){var d=c.substring(e,e+1);if(isNaN(parseFloat(d))&&
        -1===this.symbol.toString().indexOf(d)&&"%"!=d&&"$"!=d&&"."!=d&&","!=d&&"-"!=d){this.numberInput[0].value=b;this.parsing=!1;return}}this.ValueString=this.GetValueString(this.numberInput.val(),this.decimalSeparator,""!=this.decimalSeparator);this._parseDecimalInSimpleMode();this.decimal=this.ValueString;this.getvalue("negative")&&(this.decimal="-"+this.ValueString);this.parsing=!1}},render:function(){this.host.attr({role:"spinbutton"});this.host.attr("data-role","input");d.jqx.aria(this);d.jqx.aria(this,
        "aria-multiline",!1);var b=this;(this.officeMode||this.theme&&-1!=this.theme.indexOf("office"))&&18==this.spinButtonsWidth&&(this.spinButtonsWidth=15);if(d.jqx.mobile.isTouchDevice()||!0===this.touchMode)this.inputMode="textbox",this.spinMode="simple";""==this.decimalSeparator&&(this.decimalSeparator=" ");this.host.addClass(this.toThemeProperty("jqx-input"));this.host.addClass(this.toThemeProperty("jqx-rc-all"));this.host.addClass(this.toThemeProperty("jqx-widget"));this.host.addClass(this.toThemeProperty("jqx-widget-content"));
        this.host.addClass(this.toThemeProperty("jqx-numberinput"));this.spinButtons?this._spinButtons():(this.numberInput=d("<input style='border:none;' autocomplete='off' type='textarea'/>").appendTo(this.host),this.numberInput.addClass(this.toThemeProperty("jqx-input-content")),this.numberInput.addClass(this.toThemeProperty("jqx-widget-content")));this.isMaterialized()||this.numberInput.attr("placeholder",this.placeHolder);var c=this.host.attr("name");c&&this.numberInput.attr("name",c);this.host.attr("tabindex")&&
        (this.numberInput.attr("tabindex",this.host.attr("tabindex")),this.host.removeAttr("tabindex"));if(d.jqx.mobile.isTouchDevice()||!0===this.touchMode||"textbox"==this.inputMode)b=this,b.savedValue="",this.addHandler(this.numberInput,"focus",function(){b.savedValue=b.numberInput[0].value}),this.addHandler(this.numberInput,"change",function(){b._doTouchHandling()});d.data(this.host[0],"jqxNumberInput").jqxNumberInput=this;b=this;0<this.host.parents("form").length&&this.addHandler(this.host.parents("form"),
            "reset",function(){setTimeout(function(){b.setDecimal(0)},10)});this.propertyChangeMap.disabled=function(b,c,d,f){f?(b.numberInput.addClass(e.toThemeProperty("jqx-input-disabled")),b.numberInput.attr("disabled",!0)):(b.host.removeClass(e.toThemeProperty("jqx-input-disabled")),b.numberInput.attr("disabled",!1));b.spinButtons&&b.host.jqxRepeatButton&&(b.upbutton.jqxRepeatButton({disabled:f}),b.downbutton.jqxRepeatButton({disabled:f}))};this.disabled&&(this.numberInput.addClass(this.toThemeProperty("jqx-input-disabled")),
            this.numberInput.attr("disabled",!0),this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled")));this.selectedText="";this.decimalSeparatorPosition=-1;var e=this;this.oldValue=this._value();this.items=[];c=this.value;var f=this.decimal;this._initializeLiterals();this._render();this.setDecimal(null!==c?f:null);b=this;setTimeout(function(){},100);this._addHandlers();d.jqx.utilities.resize(this.host,function(){b._render()})},refresh:function(b){b||this._render()},wheel:function(b,c){if(c.enableMouseWheel){c.changeType=
        "mouse";var e=0;b||(b=window.event);b.originalEvent&&b.originalEvent.wheelDelta&&(b.wheelDelta=b.originalEvent.wheelDelta);b.wheelDelta?e=b.wheelDelta/120:b.detail&&(e=-b.detail/3);if(e)return c=c._handleDelta(e),b.preventDefault&&b.preventDefault(),null!=b.originalEvent&&(b.originalEvent.mouseHandled=!0),void 0!=b.stopPropagation&&b.stopPropagation(),c?(c=!1,b.returnValue=c):!1;b.preventDefault&&b.preventDefault();b.returnValue=!1}},_handleDelta:function(b){0>b?this.spinDown():this.spinUp();return!0},
    _addHandlers:function(){var b=this;this.addHandler(this.numberInput,"paste",function(c){var e=b._selection();c.preventDefault();if(c.originalEvent.clipboardData)var g=(c.originalEvent||c).clipboardData.getData("text/plain");else window.clipboardData&&(g=window.clipboardData.getData("Text"));this.selectedText=g;d.data(document.body,"jqxSelection",this.selectedText);"simple"!=b.inputMode?b._pasteSelectedText():b.val(g);setTimeout(function(){b._setSelectionStart(e.start)})});this.addHandler(this.numberInput,
        "mousedown",function(c){return b._raiseEvent(2,c)});this._mousewheelfunc=this._mousewheelfunc||function(c){if(!b.editcell)return b.wheel(c,b),!1};this.removeHandler(this.host,"mousewheel",this._mousewheelfunc);this.addHandler(this.host,"mousewheel",this._mousewheelfunc);var c="";this.addHandler(this.numberInput,"focus",function(e){d.data(b.numberInput,"selectionstart",b._selection().start);b.host.addClass(b.toThemeProperty("jqx-fill-state-focus"));b.spincontainer&&b.spincontainer.addClass(b.toThemeProperty("jqx-numberinput-focus"));
        c=b.numberInput.val();b._savedValue=b.decimal});this.addHandler(this.numberInput,"blur",function(e){"simple"==b.inputMode&&b._exitSimpleInputMode(e,b,!1,c);if(b.autoValidate){var f=parseFloat(b.decimal);b.getvalue("negative")&&0<b.decimal&&(f=-parseFloat(b.decimal));f>b.max&&(b._disableSetSelection=!0,b.setDecimal(b.max),b._disableSetSelection=!1);f<b.min&&(b._disableSetSelection=!0,b.setDecimal(b.min),b._disableSetSelection=!1)}b.host.removeClass(b.toThemeProperty("jqx-fill-state-focus"));b.spincontainer&&
    b.spincontainer.removeClass(b.toThemeProperty("jqx-numberinput-focus"));b.numberInput.val()!=c&&(b._raiseEvent(7,e),d.jqx.aria(b,"aria-valuenow",b.decimal),b.element.value=b.decimal);return!0});this.addHandler(this.numberInput,"mouseup",function(c){return b._raiseEvent(3,c)});this.addHandler(this.numberInput,"keydown",function(c){b.changeType="keyboard";return b._raiseEvent(4,c)});this.addHandler(this.numberInput,"keyup",function(c){return b._raiseEvent(5,c)});this.addHandler(this.numberInput,"keypress",
        function(c){return b._raiseEvent(6,c)})},focus:function(){try{this.numberInput.focus()}catch(b){}},_removeHandlers:function(){this.removeHandler(this.numberInput,"mousedown");d.jqx.mobile.isOperaMiniMobileBrowser()&&this.removeHandler(d(document),"click."+this.element.id,this._exitSimpleInputMode,this);this.removeHandler(this.numberInput,"paste");this.removeHandler(this.numberInput,"focus");this.removeHandler(this.numberInput,"blur");this.removeHandler(this.numberInput,"mouseup");this.removeHandler(this.numberInput,
        "keydown");this.removeHandler(this.numberInput,"keyup");this.removeHandler(this.numberInput,"keypress")},_spinButtons:function(){if(this.host.jqxRepeatButton){this.numberInput?this.numberInput.css("float","left"):(this.numberInput=d("<input autocomplete='off' style='border: none; position: relative; float: left;' type='textarea'/>"),this.numberInput.appendTo(this.host),this.numberInput.addClass(this.toThemeProperty("jqx-input-content")),this.numberInput.addClass(this.toThemeProperty("jqx-widget-content")));
        this.spincontainer&&(this.upbutton&&this.upbutton.jqxRepeatButton("destroy"),this.downbutton&&this.downbutton.jqxRepeatButton("destroy"),this.spincontainer.remove());this.spincontainer=d('<div style="float: right; height: 100%; overflow: hidden; position: relative;"></div>');this.rtl&&(this.spincontainer.css("float","right"),this.numberInput.css("float","right"),this.spincontainer.css("left","-1px"));this.host.append(this.spincontainer);this.upbutton=d('<div style="overflow: hidden; padding: 0px; margin-left: -1px; position: relative;"><div></div></div>');
        this.spincontainer.append(this.upbutton);this.upbutton.jqxRepeatButton({overrideTheme:!0,disabled:this.disabled,roundedCorners:"top-right"});this.downbutton=d('<div style="overflow: hidden; padding: 0px; margin-left: -1px; position: relative;"><div></div></div>');this.spincontainer.append(this.downbutton);this.downbutton.jqxRepeatButton({overrideTheme:!0,disabled:this.disabled,roundedCorners:"bottom-right"});this.template&&(this.upbutton.addClass(this.toThemeProperty("jqx-"+this.template)),this.downbutton.addClass(this.toThemeProperty("jqx-"+
            this.template)));var b=this;this.downbutton.addClass(this.toThemeProperty("jqx-fill-state-normal jqx-action-button"));this.upbutton.addClass(this.toThemeProperty("jqx-fill-state-normal jqx-action-button"));this.upbutton.addClass(this.toThemeProperty("jqx-rc-tr"));this.downbutton.addClass(this.toThemeProperty("jqx-rc-br"));this.addHandler(this.downbutton,"mouseup",function(c){b.disabled||(b.downbutton.removeClass(b.toThemeProperty("jqx-fill-state-pressed")),b._downArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-down-selected")))});
        this.addHandler(this.upbutton,"mouseup",function(c){b.disabled||(b.upbutton.removeClass(b.toThemeProperty("jqx-fill-state-pressed")),b._upArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-up-selected")))});this.removeHandler(d(document),"mouseup."+this.element.id);this.addHandler(d(document),"mouseup."+this.element.id,function(c){b.upbutton.removeClass(b.toThemeProperty("jqx-fill-state-pressed"));b._upArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-up-selected"));b.downbutton.removeClass(b.toThemeProperty("jqx-fill-state-pressed"));
            b._downArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-down-selected"))});this.addHandler(this.downbutton,"mousedown",function(c){if(!b.disabled)return d.jqx.browser.msie&&9>d.jqx.browser.version&&(b._inputSelection=b._selection()),b.downbutton.addClass(b.toThemeProperty("jqx-fill-state-pressed")),b._downArrow.addClass(b.toThemeProperty("jqx-icon-arrow-down-selected")),c.preventDefault(),c.stopPropagation(),!1});this.addHandler(this.upbutton,"mousedown",function(c){if(!b.disabled)return d.jqx.browser.msie&&
        9>d.jqx.browser.version&&(b._inputSelection=b._selection()),b.upbutton.addClass(b.toThemeProperty("jqx-fill-state-pressed")),b._upArrow.addClass(b.toThemeProperty("jqx-icon-arrow-up-selected")),c.preventDefault(),c.stopPropagation(),!1});this.addHandler(this.upbutton,"mouseenter",function(c){b.upbutton.addClass(b.toThemeProperty("jqx-fill-state-hover"));b._upArrow.addClass(b.toThemeProperty("jqx-icon-arrow-up-hover"))});this.addHandler(this.upbutton,"mouseleave",function(c){b.upbutton.removeClass(b.toThemeProperty("jqx-fill-state-hover"));
            b._upArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-up-hover"))});this.addHandler(this.downbutton,"mouseenter",function(c){b.downbutton.addClass(b.toThemeProperty("jqx-fill-state-hover"));b._downArrow.addClass(b.toThemeProperty("jqx-icon-arrow-down-hover"))});this.addHandler(this.downbutton,"mouseleave",function(c){b.downbutton.removeClass(b.toThemeProperty("jqx-fill-state-hover"));b._downArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-down-hover"))});this.upbutton.css("border-width","0px");
        this.downbutton.css("border-width","0px");this.disabled?(this.upbutton[0].disabled=!0,this.downbutton[0].disabled=!0):(this.upbutton[0].disabled=!1,this.downbutton[0].disabled=!1);this.spincontainer.addClass(this.toThemeProperty("jqx-input"));this.spincontainer.addClass(this.toThemeProperty("jqx-rc-r"));this.spincontainer.css("border-width","0px");this.rtl?this.spincontainer.css("border-right-width","1px"):this.spincontainer.css("border-left-width","1px");this._upArrow=this.upbutton.find("div");this._downArrow=
            this.downbutton.find("div");this._upArrow.addClass(this.toThemeProperty("jqx-icon-arrow-up"));this._downArrow.addClass(this.toThemeProperty("jqx-icon-arrow-down"));this._upArrow.addClass(this.toThemeProperty("jqx-input-icon"));this._downArrow.addClass(this.toThemeProperty("jqx-input-icon"));b=this;this._upArrow.hover(function(){b.disabled||b._upArrow.addClass(b.toThemeProperty("jqx-icon-arrow-up-hover"))},function(){b._upArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-up-hover"))});this._downArrow.hover(function(){b.disabled||
        b._downArrow.addClass(b.toThemeProperty("jqx-icon-arrow-down-hover"))},function(){b._downArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-down-hover"))});var c=d.jqx.mobile.isTouchDevice(),e="click";c&&(e=d.jqx.mobile.getTouchEventName("touchstart"));c&&(this.addHandler(this.downbutton,"click",function(c){b.spinDown()}),this.addHandler(this.upbutton,"click",function(c){b.spinUp()}));this.addHandler(this.downbutton,e,function(e){c?(e.preventDefault(),e.stopPropagation()):(0==b._selection().start&&
        b._setSelectionStart(b.numberInput.val().length),d.jqx.browser.msie&&9>d.jqx.browser.version&&b._setSelectionStart(b._inputSelection.start));b.spinDown();return!1});this.addHandler(this.upbutton,e,function(e){c?(e.preventDefault(),e.stopPropagation()):(0==b._selection().start&&b._setSelectionStart(b.numberInput.val().length),d.jqx.browser.msie&&9>d.jqx.browser.version&&b._setSelectionStart(b._inputSelection.start));b.spinUp();return!1})}else throw Error("jqxNumberInput: Missing reference to jqxbuttons.js.");
    },spinDown:function(){var b=this.decimal;if("none"!=this.spinMode)if(null==this.decimal)this.setDecimal(0);else{var c=this.getvalue("negative"),e=c?-1:0;(d.jqx.mobile.isTouchDevice()||"textbox"==this.inputMode)&&this._doTouchHandling();if(!this.disabled){var f=this._selection(),g=this.decimal,h=this.getDecimal();if(h<this.min)this.setDecimal(this.min),this._setSelectionStart(f.start),this.spinDown();else if(h>this.max)this.setDecimal(this.max),this._setSelectionStart(f.start),this.spinDown();else{0>
    this.spinButtonsStep&&(this.spinButtonsStep=1);var k=parseInt(this.decimal)-this.spinButtonsStep;k=k.toString().length;var l=e+k<=this.digits;if("advanced"!=this.spinMode){if(h-this.spinButtonsStep>=this.min&&l){k=1;for(l=0;l<this.decimalDigits;l++)k*=10;h=k*h-k*this.spinButtonsStep;h=this._parseDecimalValueToEditorValue(h/k);this.setDecimal(h)}}else{c=this._getspindecimal();this._getSeparatorPosition();h=parseFloat(c.decimal);0>this.spinButtonsStep&&(this.spinButtonsStep=1);k=parseInt(h)-this.spinButtonsStep;
        k=k.toString().length;l=e+k<=this.digits;k=1;var m=c.decimal.indexOf(".");if(-1!=m){var p=c.decimal.length-m-1;k=1;for(l=0;l<p;l++)k*=10;h-=new Number(this.spinButtonsStep/k);h=h.toFixed(p);m=h.toString().indexOf(".");-1==m&&(h=h.toString()+".");p=h.toString()+c.afterdecimal;p=new Number(p);p=p.toFixed(this.decimalDigits);p>=this.min&&(p=this._parseDecimalValueToEditorValue(p),this.setDecimal(p))}else h-this.spinButtonsStep>=this.min&&l&&(h=k*h-k*this.spinButtonsStep,p=(h/k).toString()+c.afterdecimal,
        p>=this.min&&(p=this._parseDecimalValueToEditorValue(p),this.setDecimal(p)))}void 0==p||"simple"!=this.inputMode?(this._setSelectionStart(f.start),this.savedValue=this.numberInput[0].value):(p=this.decimal.toString(),c=this.getvalue("negative"),0==e&&c?this._setSelectionStart(f.start+1):void 0==p||void 0!=g&&g.toString().length!=p.length?c?this._setSelectionStart(f.start+1):this._setSelectionStart(f.start-1):this._setSelectionStart(f.start));b!=this.decimal&&(d.jqx.mobile.isTouchDevice()&&this._raiseEvent(0,
        {}),this._raiseEvent(7,{}));d.jqx.aria(this,"aria-valuenow",this.decimal)}}}},_getspindecimal:function(){var b=this._selection(),c="";this._getSeparatorPosition();var e=this._getVisibleItems(),d=this._getHiddenPrefixCount(),g=this.numberInput.val();this.numberInput.val().length==b.start&&0==b.length&&(this._setSelection(b.start,b.start+1),b=this._selection());var h="advanced"!=this.inputMode;b=b.start;0===b&&b++;1===b&&"left"===this.symbolPosition&&""!==this.symbol&&(b+=this.symbol.length);for(var k=
        0;k<b;k++)if(h){var l=g.substring(k,k+1),m=!isNaN(parseInt(l));m&&(c+=l);l==this.decimalSeparator&&(c+=l)}else e[k].canEdit&&e[k].character!=this.promptChar?c+=e[k].character:e[k].canEdit||-1==this.decimalSeparatorPosition||e[k]!=e[this.decimalSeparatorPosition-d]||(0==c.length&&(c="0"),c+=e[k].character);var p="";for(k=b;k<e.length;k++)h?(l=g.substring(k,k+1),(m=!isNaN(parseInt(l)))&&(p+=l),l==this.decimalSeparator&&(p+=l)):e[k].canEdit&&e[k].character!=this.promptChar?p+=e[k].character:e[k].canEdit||
        -1==this.decimalSeparatorPosition||e[k]!=e[this.decimalSeparatorPosition-d]||(p+=e[k].character);return{decimal:this.getvalue("negative")?"-"+this._parseDecimalValue(c).toString():this._parseDecimalValue(c).toString(),afterdecimal:this._parseDecimalValue(p)}},_parseDecimalValue:function(b){if("."!=this.decimalSeparator){var c=b.toString().indexOf(this.decimalSeparator);if(0<=c)return b.toString().substring(0,c)+"."+b.toString().substring(c+1)}return b},_parseDecimalValueToEditorValue:function(b){if("."!=
        this.decimalSeparator){var c=b.toString().indexOf(".");if(0<=c)return b.toString().substring(0,c)+this.decimalSeparator+b.toString().substring(c+1)}return b},spinUp:function(){var b=this.decimal;if("none"!=this.spinMode)if(null==this.decimal)this.setDecimal(0);else{(d.jqx.mobile.isTouchDevice()||"textbox"==this.inputMode)&&this._doTouchHandling();var c=this.getvalue("negative"),e=c?-1:0;if(!this.disabled){var f=this._selection(),g=this.decimal,h=this.getDecimal();if(h<this.min)this.setDecimal(this.min),
        this._setSelectionStart(f.start),this.spinUp();else if(h>this.max)this.setDecimal(this.max),this._setSelectionStart(f.start),this.spinUp();else{0>this.spinButtonsStep&&(this.spinButtonsStep=1);var k=parseInt(this.decimal)+this.spinButtonsStep;k=k.toString().length;var l=e+k<=this.digits;if("advanced"!=this.spinMode){if(h+this.spinButtonsStep<=this.max&&l){k=1;for(c=0;c<this.decimalDigits;c++)k*=10;h=k*h+k*this.spinButtonsStep;h=this._parseDecimalValueToEditorValue(h/k);this.setDecimal(h)}}else{var m=
        this._getspindecimal();this._getSeparatorPosition();h=parseFloat(m.decimal);0>this.spinButtonsStep&&(this.spinButtonsStep=1);k=parseInt(h)+this.spinButtonsStep;k=k.toString().length;l=e+k<=this.digits;k=1;var p=m.decimal.indexOf(".");if(-1!=p){var r=m.decimal.length-p-1;k=1;for(c=0;c<r;c++)k*=10;h+=new Number(this.spinButtonsStep/k);h=h.toFixed(r);p=h.toString().indexOf(".");-1==p&&(h=h.toString()+".");r=h.toString()+m.afterdecimal;r=new Number(r);r=r.toFixed(this.decimalDigits);h=(new Number(r)).toFixed(this.decimalDigits);
        h<=this.max?(r=this._parseDecimalValueToEditorValue(r),this.setDecimal(r)):r=void 0}else h+this.spinButtonsStep<=this.max&&l&&(h=k*h+k*this.spinButtonsStep,r=(h/k).toString()+m.afterdecimal,h=(new Number(r)).toFixed(this.decimalDigits),h<=this.max?(r=this._parseDecimalValueToEditorValue(r),c&&-1==r.indexOf("-")&&"-0"!=m.decimal&&(r="-"+r),this.setDecimal(r)):r=void 0)}void 0==r||"simple"!=this.inputMode?(this._setSelectionStart(f.start),this.savedValue=this.numberInput[0].value):(r=this.decimal.toString(),
        c=this.getvalue("negative"),-1!=e||c?void 0==r||void 0!=g&&g.toString().length!=r.length?c?this._setSelectionStart(f.start):this._setSelectionStart(1+f.start):this._setSelectionStart(f.start):this._setSelectionStart(-1+f.start));b!=this.decimal&&(d.jqx.mobile.isTouchDevice()&&this._raiseEvent(0,{}),this._raiseEvent(7,{}));d.jqx.aria(this,"aria-valuenow",this.decimal)}}}},_exitSimpleInputMode:function(b,c,e,f){void 0==c&&(c=b.data);if(null!=c){if(void 0==e){if(null!=b.target&&null!=c.element&&(void 0!=
        b.target.id&&0<b.target.id.toString().length&&0<c.host.find("#"+b.target.id).length||b.target==c.element))return;f=c.host.offset();e=f.left;f=f.top;var g=c.host.width(),h=c.host.height();b=d(b.target).offset();if(b.left>=e&&b.left<=e+g&&b.top>=f&&b.top<=f+h)return}d.jqx.mobile.isOperaMiniBrowser()&&c.numberInput.attr("readonly",!0);if(!c.disabled&&!c.readOnly&&null!=d.data(c.numberInput,"simpleInputMode"))return d.data(c.numberInput,"simpleInputMode",null),this._parseDecimalInSimpleMode(),!1}},_getDecimalInSimpleMode:function(){var b=
        this.decimal;if("."!=this.decimalSeparator){var c=b.toString().indexOf(this.decimalSeparator);0<c&&(b=b.toString().substring(0,c)+"."+b.toString().substring(c+1))}return b},_parseDecimalInSimpleMode:function(b){var c=this.getvalue("negative"),e=this.ValueString;void 0==e&&(e=this.GetValueString(this.numberInput.val(),this.decimalSeparator,""!=this.decimalSeparator));if("."!=this.decimalSeparator){var d=e.toString().indexOf(".");0<d&&(e=e.toString().substring(0,d)+this.decimalSeparator+e.toString().substring(d+
        1))}c=c?"-":"";"left"==this.symbolPosition&&(c+=this.symbol);e=e.toString();0<=e.indexOf("-")&&(e=e.substring(e.indexOf("-")+1));c+=e;"right"==this.symbolPosition&&(c+=this.symbol);0!=b&&this.numberInput.val(c)},_enterSimpleInputMode:function(b,c){void 0==c&&(c=b.data);b=this._selection();if(null!=c){var e=c.getvalue("negative"),f=c.decimal;e&&0<f&&(f=-f);c.numberInput.val(f);d.data(c.numberInput,"simpleInputMode",!0);d.jqx.mobile.isOperaMiniBrowser()&&c.numberInput.attr("readonly",!1);this._parseDecimalInSimpleMode();
        this._setSelectionStart(b.start)}},setvalue:function(b,c){void 0!==this[b]&&("decimal"==b?this._setDecimal(c):(this[b]=c,this.propertyChangedHandler(this,b,c,c)))},getvalue:function(b){return"decimal"==b&&void 0!=this.negative&&1==this.negative?this.decimal.toString().indexOf(",")?-Math.abs(this.decimal.toString().replace(/,/,".")):-Math.abs(this[b]):b in this?this[b]:null},_getString:function(){for(var b="",c=0;c<this.items.length;c++)b+=this.items[c].character;return b},_literal:function(b,c,e,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       d){return{character:b,regex:c,canEdit:e,isSeparator:d}},_initializeLiterals:function(){if("textbox"!=this.inputMode){for(var b=0,c=this.negativeSymbol.length,e=0;e<c;e++){var d=this.negativeSymbol.substring(e,e+1),g="",h=!1;d=this.negative?this._literal(d,g,h,!1):this._literal("",g,h,!1);this.items[b]=d;b++}c=this.symbol.length;if("left"==this.symbolPosition)for(e=0;e<c;e++)d=this.symbol.substring(e,e+1),g="",h=!1,d=this._literal(d,g,h,!1),this.items[b]=d,b++;var k=this.digits%this.groupSize;0==k&&
    (k=this.groupSize);for(e=0;e<this.digits;e++)d=this.promptChar,g="\\d",h=!0,d=this._literal(d,g,h,!1),this.items[b]=d,b++,e<this.digits-1&&void 0!=this.groupSeparator&&0<this.groupSeparator.length?(k--,0==k&&(k=this.groupSize,d=this._literal(this.groupSeparator,"",!1,!1),this.items[b]=d,b++)):e==this.digits-1&&(d.character=0);this.decimalSeparatorPosition=-1;if(void 0!=this.decimalDigits&&0<this.decimalDigits)for(d=this.decimalSeparator,0==d.length&&(d="."),d=this._literal(d,"",!1,!0),this.items[b]=
        d,this.decimalSeparatorPosition=b,b++,e=0;e<this.decimalDigits;e++)g="\\d",k=this._literal(0,g,!0,!1),this.items[b]=k,b++;if("right"==this.symbolPosition)for(e=0;e<c;e++)d=this.symbol.substring(e,e+1),g="",h=!1,d=this._literal(d,g,h),this.items[b]=d,b++}},_match:function(b,c){return(new RegExp(c,"i")).test(b)},_raiseEvent:function(b,c){var e=this.events[b],f={owner:this};if("none"==this.host.css("display"))return!0;var g=c.charCode?c.charCode:c.keyCode?c.keyCode:0,h=!0,k=this.readOnly;if((3==b||2==
        b)&&!this.disabled)if("simple"!=this.inputMode&&"textbox"!=this.inputMode)this._handleMouse(c);else return!0;if(0==b){var l=this.getvalue("decimal");this.max<l||this.min>l?this.host.addClass(this.toThemeProperty("jqx-input-invalid")):(this.host.removeClass(this.toThemeProperty("jqx-input-invalid")),this.host.addClass(this.toThemeProperty("jqx-input")),this.host.addClass(this.toThemeProperty("jqx-rc-all")))}l=new d.Event(e);l.owner=this;f.value=this.getvalue("decimal");f.text=this.numberInput.val();
        l.args=f;7==b&&(f.type=this.changeType,this.changeType=null);void 0!=e&&4!=b&&5!=b&&6!=b&&(h=this.host.trigger(l));if("textbox"==this.inputMode)return h;if("simple"!=this.inputMode)if(4==b){if(k||this.disabled)return!1;h=this._handleKeyDown(c,g)}else if(5==b){if(k||this.disabled)h=!1}else{if(6==b){if(k||this.disabled)return!1;h=this._handleKeyPress(c,g)}}else if(4==b||5==b||6==b){if(d.jqx.mobile.isTouchDevice()||!0===this.touchMode)return!0;if(k||this.disabled)return!1;e=String.fromCharCode(g);parseInt(e);
            e=!0;c.ctrlKey||c.shiftKey||c.metaKey||65<=g&&90>=g&&(e=!1);if(6==b&&void 0!=d.jqx.browser.opera&&8==g)return!1;if(e){4==b&&(e=this._handleSimpleKeyDown(c,g));107==g&&(h=this.getvalue("negative"))&&(this.setvalue("negative",!1),this.decimal=this.ValueString,this._parseDecimalInSimpleMode(),this._setSelectionStart(m.start+1),this._raiseEvent(0,this.value),this._raiseEvent(1,this.numberInput.val()));if(189==g||45==g||109==g||173==g){var m=this._selection();4==b&&(h=this.getvalue("negative"),0==h?this.setvalue("negative",
                !0):this.setvalue("negative",!1),this.decimal=this.ValueString,this._parseDecimalInSimpleMode(),h?this._setSelectionStart(m.start-1):this._setSelectionStart(m.start+1),e=!1,this._raiseEvent(0,this.value),this._raiseEvent(1,this.numberInput.val()))}f=f.ctrlKey||f.metaKey;if(!d.jqx.browser.msie&&(f&&99==g||f&&67==g||f&&122==g||f&&90==g||f&&118==g||f&&86==g||c.shiftKey&&45==g))return(d.jqx.browser.webkit||d.jqx.browser.chrome)&&this._handleSimpleKeyDown(c,g),67==g?!0:!1;if(f&&97==g||f&&65==g)return!0;
                if(6==b&&e)return this._isSpecialKey(g)}return e}return h},GetSelectionInValue:function(b,c,e,d){for(var f=0,h=0;h<c.length&&!(h>=b);h++){var k=c.substring(h,h+1);(!isNaN(parseInt(k))||d&&c.substring(h,h+1)==e)&&f++}return f},GetSelectionLengthInValue:function(b,c,e,d){for(var f=0,h=0;h<e.length&&!(h>=b+c);h++){var k=e.substring(h,h+1);k=!isNaN(parseInt(k));(0<c&&h>=b&&k||h>=b&&e[h].toString()==d)&&f++}return f},GetInsertTypeByPositionInValue:function(b,c,e,d){var f="before";e=this.GetValueString(e,
        c,d);c=this.GetDigitsToSeparator(0,e,c);b>c&&(f="after");return f},RemoveRange:function(b,c,e,d,g,h){var f=this.digits,l=c,m=0;this._selection();d=this.decimalSeparator;var p=""!=d;if(0==l&&this.ValueString.length<this.decimalPossibleChars-1)return m;var r=this.GetSeparatorPositionInText(d,e);g||(r=this.GetSeparatorPositionInText(d,e));0>r&&!p&&1<e.length&&(r=e.length);-1==r&&(r=e.length);2>c&&1==h&&this.ValueString.length-this.decimalDigits-(p?1:0)==f&&b+c<r&&l++;c="";for(h=0;h<e.length;h++)h<b||
    h>=b+l?c+=e.substring(h,h+1):(f=e.substring(h,h+1),f==d?c+=d:(f=e.substring(h,h+1),this.symbol&&""!=this.symbol&&0<=this.symbol.indexOf(f)||(h>r?c+="0":(f=e.substring(h,h+1),isNaN(parseInt(f))||m++))));0==c.length&&(c="0");g?this.numberInput.val(c):this.ValueString=c;e=c.substring(0,1);e==d&&isNaN(parseInt(e))&&(c="0"+c);this.decimal=this.ValueString=this.GetValueString(c,d,p);this._parseDecimalInSimpleMode();this._setSelectionStart(b);return m},InsertDigit:function(b,c){"number"!=typeof this.digits&&
    (this.digits=parseInt(this.digits));"number"!=typeof this.decimalDigits&&(this.decimalDigits=parseInt(this.decimalDigits));var e=1+this.digits,d=this._selection(),g=this.getvalue("negative"),h=!1;0==d.start&&""!=this.symbol&&"left"==this.symbolPosition&&(this._setSelectionStart(d.start+1),d=this._selection(),h=!0);if(g&&h||g&&!h&&0==d.start)this._setSelectionStart(d.start+1),d=this._selection();var k=this.numberInput.val().substring(d.start,d.start+1),l=this.numberInput.val();h=this.decimalSeparator;
        var m=""!=h&&0<this.decimalDigits;if(k==this.symbol&&"right"==this.symbolPosition)if(0==this.decimalDigits){if(this.ValueString=this.GetValueString(l,h,m),this.ValueString.length>=e)return}else return;this.ValueString=this.GetValueString(l,h,m);""==this.ValueString&&(this.ValueString=(new Number(0)).toFixed(this.decimalDigits));k=this.ValueString;0<this.decimalDigits&&c>=k.length&&(c=k.length-1);var p="";c<k.length&&(p=k.substring(c,c+1));var r=!1;"after"==this.GetInsertTypeByPositionInValue(c,h,
            l,m)&&(r=!0);p!=h&&this.ValueString.length-this.decimalDigits-(m?1:0)>=e-1&&(r=!0);"0"===p&&1===this.ValueString.length&&0===this.decimalDigits&&(r=!0);l=m?1:0;if(!(!r&&this.ValueString&&this.ValueString.length>=this.digits+this.decimalDigits+l)){if(r&&p!=h){e=k.substring(0,c);if(e.length==k.length&&this.ValueString.length>=this.digits+this.decimalDigits+l)return;l="";c+1<k.length&&(l=k.substring(c+1));this.ValueString=e+b+l}else e=k.substring(0,c),l=k.substring(c),c=e+b+l,"0"==k.substring(0,1)&&
        k.substring(1,2)==h&&(c=b+k.substring(1),p==h&&(this._setSelectionStart(d.start-1),d=this._selection())),this.ValueString=c;this.decimal=g?-this.ValueString:this.ValueString;this._parseDecimalInSimpleMode();this._setSelectionStart(d.start+1);this.value=this.decimal;this._raiseEvent(0,this.value);this._raiseEvent(1,this.numberInput.val())}},GetStringToSeparator:function(b,c,e){var d=this.GetSeparatorPositionInText(c,b);b=b.subString(0,d);return this.GetValueString(b,c,e)},GetSeparatorPositionInText:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        c){for(var e=-1,d=0;d<c.length;d++)if(c.substring(d,d+1)==b){e=d;break}return e},GetValueString:function(b,c,e){e="";for(var d=0;d<b.length;d++){var g=b.substring(d,d+1);isNaN(parseInt(g))||(e+=g);g==c&&(e+=c)}return e},Backspace:function(){var b=this._selection(),c=this._selection(),e=this.numberInput.val();if(0!=b.start||0!=b.length)this.isBackSpace=!0,e=e.substring[b.start,b.start+1],isNaN(parseInt(e)),0<b.start&&0==b.length&&(this._setSelectionStart(b.start-1),this._selection()),this.Delete(),
        this._setSelectionStart(c.start-1),this.isBackSpace=!1},Delete:function(b){var c=this._selection(),e=this.numberInput.val();0===c.start&&"-"==e.substring(0,1)&&(this.setvalue("negative",!1),c=this._selection(),e=this.numberInput.val());b=c.start;var d=c.length;d=Math.max(d,1);this.ValueString=this.GetValueString(e,this.decimalSeparator,""!=this.decimalSeparator);b>this.ValueString.indexOf(this.decimalSeparator)&&0<this.decimalDigits&&b++;e=0;this.symbol&&("left"==this.symbolPosition&&e--,this.negative&&
    e--);this.RemoveRange(c.start+e,d,this.ValueString,".",!1);c=this.ValueString.substring(0,1);isNaN(parseInt(c))&&(this.ValueString="0"+this.ValueString);this.decimal=this.ValueString;this._parseDecimalInSimpleMode();this._setSelectionStart(b);this.value=this.decimal;this._raiseEvent(0,this.value);this._raiseEvent(1,this.numberInput.val())},insertsimple:function(b){var c=this._selection(),e=this.numberInput.val();if(!(c.start==e.length&&null!=this.decimal&&0<this.decimalDigits)){var d=this.decimalSeparator;
        this.ValueString=this.GetValueString(e,d,""!=d);var g=this.GetSelectionInValue(c.start,e,d,""!=d);e=this.GetSelectionLengthInValue(c.start,c.length,e,d);this.GetDigitsToSeparator(0,this.ValueString,d);0<this.decimalDigits&&g>=this.ValueString.length&&g--;""==this.ValueString?(this.ValueString=(new Number(0)).toFixed(this.decimalDigits),this.ValueString=this.ValueString.replace(".",d),this.RemoveRange(c.start,e,this.ValueString,d,!1,!0),this.InsertDigit(b,0,c)):(this.RemoveRange(c.start,e,this.ValueString,
            d,!1,!0),this.InsertDigit(b,g,c))}},GetDigitsToSeparator:function(b,c,e){void 0==e&&(e=".");if(0>c.indexOf(e))return c.length;for(var d=0;d<c.length;d++)if(c.substring(d,d+1)==e){b=d;break}return b},_handleSimpleKeyDown:function(b,c){var e=this._selection(),f=b.ctrlKey||b.metaKey;if((8==c||46==c)&&f)return this.setDecimal(null),!1;0<=e.start&&e.start<this.items.length&&(f=String.fromCharCode(c));27===c&&(this.setDecimal(this._savedValue),f=this.GetSeparatorPositionInText(this.decimalSeparator,this.numberInput.val()),
    -1!=f&&this._setSelectionStart(f),b.preventDefault());if(this.rtl&&37==c)return b=(c=b.shiftKey)?1:0,c?this._setSelection(e.start+1-b,e.start+e.length+1):this._setSelection(e.start+1-b,e.start+1),!1;if(this.rtl&&39==c)return(c=b.shiftKey)?this._setSelection(e.start-1,e.length+(c?1:0)+e.start-1):this._setSelection(e.start-1,e.start-1),!1;if(8==c)return this.Backspace(),!1;if(190==c||110==c)return f=this.GetSeparatorPositionInText(this.decimalSeparator,this.numberInput.val()),-1!=f&&this._setSelectionStart(f+
        1),!1;if(188==c){b=this.numberInput.val();for(c=e.start;c<b.length;c++)if(b[c]==this.groupSeparator){this._setSelectionStart(1+c);break}return!1}if((f=b.ctrlKey||b.metaKey)&&99==c||f&&67==c){e=this._selection();b="";f=this.numberInput.val();if(0<e.start||0<e.length)for(c=e.start;c<e.end;c++)b+=f.substring(c,c+1);d.data(document.body,"jqxSelection",b);if(d.jqx.browser.msie)window.clipboardData.setData("Text",b);else{var g=this,h=d('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');
        h.val(b);d("body").append(h);h.select();setTimeout(function(){document.designMode="off";h.select();h.remove();g.focus()},100)}this.savedText=b;return!0}if(f&&122==c||f&&90==c)return!1;if(f&&118==c||f&&86==c||b.shiftKey&&45==c)return d.jqx.browser.msie&&!this.savedText&&(this.savedText=window.clipboardData.getData("Text")),null!=this.savedText&&0<this.savedText.length?this.val(this.savedText):this.val(d.data(document.body,"jqxSelection")),!1;f=String.fromCharCode(c);e=parseInt(f);96<=c&&105>=c&&(e=
        c-96,c-=48);if(!isNaN(e))return g=this,this.insertsimple(e),!1;if(46==c)return this.Delete(),!1;if(38==c)return this.spinUp(),!1;if(40==c)return this.spinDown(),!1;e=this._isSpecialKey(c);return d.jqx.browser.mozilla?e:!0},_getEditRange:function(){for(var b=0,c=0,e=0;e<this.items.length;e++)if(this.items[e].canEdit){b=e;break}for(e=this.items.length-1;0<=e;e--)if(this.items[e].canEdit){c=e;break}return{start:b,end:c}},_getVisibleItems:function(){for(var b=[],c=0,e=0;e<this.items.length;e++)0<this.items[e].character.toString().length&&
    (b[c]=this.items[e],c++);return b},_hasEmptyVisibleItems:function(){for(var b=this._getVisibleItems(),c=0;c<b.length;c++)if(b[c].canEdit&&b[c].character==this.promptChar)return!0;return!1},_getFirstVisibleNonEmptyIndex:function(){for(var b=this._getVisibleItems(),c=0;c<b.length;c++)if(b[c].canEdit&&b[c].character!=this.promptChar)return c},_handleMouse:function(b,c){b=this._selection();1>=b.length&&(c=this._getFirstVisibleNonEmptyIndex(),b.start<c&&this._setSelectionStart(c))},_insertKey:function(b){this.numberInput[0].focus();
        var c=String.fromCharCode(b);b=parseInt(c);if(!isNaN(b)){var e=0;for(b=0;b<this.items.length;b++)0==this.items[b].character.length&&e++;var f=this._selection(),g=this;if(0<=f.start&&f.start<=this.items.length){var h=!1;b=this._getFirstVisibleNonEmptyIndex();f.start<b&&0==f.length&&(!isNaN(c)||" "==c)&&(this._setSelectionStart(b),f=this._selection());this._getFirstEditableItemIndex();var k=this._getLastEditableItemIndex();null===this.value&&(k=0);var l=this._getVisibleItems();d.each(l,function(b,d){if(!(f.start>
            b&&b!=l.length-1)){var m=l[b];b>k&&(m=l[k]);if(!isNaN(c)&&" "!=c&&""!=c&&m&&m.canEdit&&(d=g._getSeparatorPosition(),g._match(c,m.regex))){if(!h&&0<f.length){for(var p=f.start+e;p<f.end+e;p++)g.items[p].canEdit&&(g.items[p].character=p>d?"0":g.promptChar);g._getString();h=!0}d=g._getSeparatorPosition();p=g._hasEmptyVisibleItems();null==g.decimal&&(f.start=d-1,0>f.start&&(f.start=0),f.end=f.start);if(f.start<=d&&p){m=b;-1==g.decimalSeparatorPosition&&f.start==d&&(m=b+1);null==g.decimal&&(m=f.start);
            p="";for(var w=0;w<m;w++)l[w].canEdit&&l[w].character!=g.promptChar&&(p+=l[w].character);p+=c;b=1>g.decimal?1:0;f.start==d&&-1!=g.decimalSeparatorPosition&&(p+=g.decimalSeparator,b=0);for(w=m+b;w<l.length;w++)l[w].character==g.decimalSeparator&&l[w].isSeparator?p+=l[w].character:l[w].canEdit&&l[w].character!=g.promptChar&&(p+=l[w].character);"."!=g.decimalSeparator&&(p=g._parseDecimalValue(p));p=parseFloat(p).toString();p=new Number(p);p=p.toFixed(g.decimalDigits);"."!=g.decimalSeparator&&(p=g._parseDecimalValueToEditorValue(p));
            g.setvalue("decimal",p);g._getString();f.end<d?g._setSelectionStart(f.end+b):g._setSelectionStart(f.end);1<=f.length&&g._setSelectionStart(f.end);f.length==g.numberInput.val().length&&(b=g._moveCaretToDecimalSeparator(),g._setSelectionStart(b-(0<=g.decimalSeparatorPosition?1:0)))}else if(f.start<d||f.start>d){if(g.numberInput.val().length==f.start&&-1!=g.decimalSeparatorPosition||g.numberInput.val().length==f.start&&-1==g.decimalSeparatorPosition&&!p)return!1;p="";var q=!1;for(w=0;w<b;w++)l[w].canEdit&&
        l[w].character!=g.promptChar&&(p+=l[w].character),l[w].character==g.decimalSeparator&&l[w].isSeparator&&(p+=l[w].character,q=!0);p+=c;q||f.start!=d-1||(p+=g.decimalSeparator,q=!0);for(w=b+1;w<l.length;w++)!q&&l[w].character==g.decimalSeparator&&l[w].isSeparator?p+=l[w].character:l[w].canEdit&&l[w].character!=g.promptChar&&(p+=l[w].character);g.setvalue("decimal",p);d=g._getString();if(0>g.decimalSeparatorPosition&&m==l[k])return g._setSelectionStart(b),!1;m=d.indexOf(g.symbol);p=g.getvalue("negative")?
            1:0;m<=p&&(m=d.length);f.start<m?g._setSelectionStart(b+1):g._setSelectionStart(b);f.length==g.numberInput.val().length&&(b=g._moveCaretToDecimalSeparator(),g._setSelectionStart(b-1))}return!1}}})}}},_handleKeyPress:function(b,c){var e=this._selection();if((b=b.ctrlKey||b.metaKey)&&97==c||b&&65==c)return!0;if(8==c)return 0<e.start&&this._setSelectionStart(e.start),!1;if(46==c)return e.start<this.items.length&&this._setSelectionStart(e.start),!1;d.jqx.browser.mozilla||45!=c&&173!=c&&109!=c&&189!=c||
    (0==this.getvalue("negative")?this.setvalue("negative",!0):this.setvalue("negative",!1));d.jqx.browser.msie&&this._insertKey(c);return this._isSpecialKey(c)},_deleteSelectedText:function(){var b=this._selection(),c="",e=this._getSeparatorPosition(),d=this._getVisibleItems(),g=this._getHiddenPrefixCount();this.numberInput.val().length==b.start&&0==b.length&&(this._setSelection(b.start,b.start+1),b=this._selection());for(var h=0;h<b.start;h++)d[h].canEdit&&d[h].character!=this.promptChar?c+=d[h].character:
        d[h].canEdit||-1==this.decimalSeparatorPosition||d[h]!=d[this.decimalSeparatorPosition-g]||(0==c.length&&(c="0"),c+=d[h].character);for(h=b.start;h<b.end;h++)h>e&&-1!=this.decimalSeparatorPosition?d[h].canEdit&&d[h].character!=this.promptChar&&(c+="0"):d[h].canEdit||-1==this.decimalSeparatorPosition||d[h]!=d[this.decimalSeparatorPosition-g]||(0==c.length&&(c="0"),c+=d[h].character);for(h=b.end;h<d.length;h++)d[h].canEdit&&d[h].character!=this.promptChar?c+=d[h].character:d[h].canEdit||-1==this.decimalSeparatorPosition||
        d[h]!=d[this.decimalSeparatorPosition-g]||(0==c.length&&(c="0"),c+=d[h].character);this.setvalue("decimal",c);return 0<b.length},_restoreInitialState:function(){var b=parseInt(this.decimalDigits);0<b&&(b+=2);for(var c=this.items.length-1;c>this.items.length-1-b&&this.items[c];c--)this.items[c].canEdit&&this.items[c].character==this.promptChar&&(this.items[c].character=0)},clear:function(){this.setDecimal(0)},clearDecimal:function(){if("textbox"==this.inputMode)this.numberInput.val();else{for(var b=
        0;b<this.items.length;b++)this.items[b].canEdit&&(this.items[b].character=this.promptChar);this._restoreInitialState()}},_saveSelectedText:function(){var b=this._selection(),c="",e=this._getVisibleItems();if(0<b.start||0<b.length)for(var f=b.start;f<b.end;f++)e[f].canEdit&&e[f].character!=this.promptChar?c+=e[f].character:e[f].isSeparator&&(c+=e[f].character);d.jqx.browser.msie&&window.clipboardData.setData("Text",c);return c},_pasteSelectedText:function(){this._selection();this.selectedText=d.data(document.body,
        "jqxSelection");if(window.clipboardData){var b=window.clipboardData.getData("Text");if(b!=this.selectedText&&0<b.length&&(this.selectedText=window.clipboardData.getData("Text"),null==this.selectedText||void 0==this.selectedText))return}this._getVisibleItems();if(null!=this.selectedText)for(b=0;b<this.selectedText.length;b++){var c=parseInt(this.selectedText[b]);isNaN(c)||this._insertKey(48+c)}},_getHiddenPrefixCount:function(){var b=0;this.negative||b++;if("left"==this.symbolPosition)for(var c=0;c<
    this.symbol.length;c++)""==this.symbol.substring(c,c+1)&&b++;return b},_getEditableItem:function(){for(var b=this._selection(),c=0;c<this.items.length;c++)if(c<b.start&&this.items[c].canEdit&&this.items[c].character!=this.promptChar)return this.items[c];return null},_getEditableItems:function(){for(var b=[],c=0,e=0;e<this.items.length;e++)this.items[e].canEdit&&(b[c]=this.items[e],c++);return b},_getValidSelectionStart:function(b){for(b=this.items.length-1;0<=b;b--)if(this.items[b].canEdit&&this.items[b].character!=
        this.promptChar)return b;return-1},_getEditableItemIndex:function(b){b=this._selection();for(var c=this._getHiddenPrefixCount(),e=this._getVisibleItems(),d=b.start,g=-1,h=0;h<d;h++)h<e.length&&e[h].canEdit&&(g=h+c);if(-1==g&&0<b.length)for(d=b.end,h=0;h<d;h++)if(h<e.length&&e[h].canEdit){g=h+c;break}return g},_getEditableItemByIndex:function(b){for(var c=0;c<this.items.length;c++)if(c>b&&this.items[c].canEdit&&this.items[c].character!=this.promptChar)return c;return-1},_getFirstEditableItemIndex:function(){for(var b=
        this._getVisibleItems(),c=0;c<b.length;c++)if(b[c].character!=this.promptChar&&b[c].canEdit&&"0"!=b[c].character)return c;return-1},_getLastEditableItemIndex:function(){for(var b=this._getVisibleItems(),c=b.length-1;0<=c;c--)if(b[c].character!=this.promptChar&&b[c].canEdit)return c;return-1},_moveCaretToDecimalSeparator:function(){for(var b=this.items.length-1;0<=b;b--)if(this.items[b].character==this.decimalSeparator&&this.items[b].isSeparator)return this.negative?this._setSelectionStart(b+1):this._setSelectionStart(b),
        b;return this.numberInput.val().length},_handleBackspace:function(){var b=this._selection(),c=this._getHiddenPrefixCount(),e=this._getEditableItemIndex()-c,d=this._getFirstVisibleNonEmptyIndex();c=!1;this.negative&&(c=!0,d>=e+1||0==b.start)&&(this.setvalue("negative",!1),0==b.length&&(this._setSelectionStart(b.start-1),b=this._selection()));if(0<=e){if(0==b.length&&-1!=e&&this._setSelection(e,e+1),(e=b.start>this._getSeparatorPosition()+1&&0<this.decimalSeparatorPosition)&&(b=this._selection()),this._deleteSelectedText(),
        1>b.length||e?this._setSelectionStart(b.start):1<=b.length&&this._setSelectionStart(b.end),b.length==this.numberInput.val().length||c)b=this._moveCaretToDecimalSeparator(),this._setSelectionStart(b-1)}else this._setSelectionStart(b.start)},_handleKeyDown:function(b,c){var e=this._selection(),f=b.ctrlKey||b.metaKey;if((8==c||46==c)&&f)return this.setDecimal(null),!1;if(this.rtl&&37==c)return b=(c=b.shiftKey)?1:0,c?this._setSelection(e.start+1-b,e.start+e.length+1):this._setSelection(e.start+1-b,e.start+
        1),!1;if(this.rtl&&39==c)return(c=b.shiftKey)?this._setSelection(e.start-1,e.length+(c?1:0)+e.start-1):this._setSelection(e.start-1,e.start-1),!1;if(f&&97==c||f&&65==c)return!0;if(f&&120==c||f&&88==c)return this.selectedText=this._saveSelectedText(b),d.data(document.body,"jqxSelection",this.selectedText),this._handleBackspace(),!1;if(f&&99==c||f&&67==c)return this.selectedText=this._saveSelectedText(b),d.data(document.body,"jqxSelection",this.selectedText),!1;if(f&&122==c||f&&90==c)return!1;if(f&&
        118==c||f&&86==c||b.shiftKey&&45==c)return this._pasteSelectedText(),!1;0<=e.start&&e.start<this.items.length&&String.fromCharCode(c);if(8==c)return this._handleBackspace(),!1;if(190==c||110==c)return this._moveCaretToDecimalSeparator(),!1;if(188==c){c=this.numberInput.val();for(e=e.start;e<c.length;e++)if(c[e]==this.groupSeparator){this._setSelectionStart(1+e);break}return!1}if(null==d.jqx.browser.msie&&(f=String.fromCharCode(c),f=parseInt(f),96<=c&&105>=c&&(f=c-96,c-=48),!isNaN(f)))return this._insertKey(c),
        !1;if(46==c){c=this._getVisibleItems();if(e.start<c.length){b=0==c[e.start].canEdit?2:1;if(0==e.start&&this.negative&&(this.setvalue("negative",!1),0==e.length&&this._setSelectionStart(0),e=this._selection(),0==e.length))return!1;0==e.length&&this._setSelection(e.start+b,e.start+b+e.length);this._handleBackspace();1>new Number(this.decimal)||e.start>this._getSeparatorPosition()?this._setSelectionStart(e.end+b):e.start+1<this.decimalSeparatorPosition&&this._setSelectionStart(e.end+b)}return!1}if(38==
        c)return this.spinUp(),!1;if(40==c)return this.spinDown(),!1;27===c&&(this.setDecimal(this._savedValue),this._setSelectionStart(e.end),b.preventDefault());e=this._isSpecialKey(c);!d.jqx.browser.mozilla||45!=c&&173!=c&&109!=c&&189!=c||(0==this.getvalue("negative")?this.setvalue("negative",!0):this.setvalue("negative",!1));return d.jqx.browser.mozilla?e:!0},_isSpecialKey:function(b){return 8!=b&&9!=b&&13!=b&&35!=b&&36!=b&&37!=b&&39!=b&&27!=b&&46!=b?!1:!0},_selection:function(){try{if("selectionStart"in
        this.numberInput[0]){var b=this.numberInput[0],c=b.selectionEnd-b.selectionStart;return{start:b.selectionStart,end:b.selectionEnd,length:c,text:b.value}}var e=document.selection.createRange();if(null==e)return{start:0,end:b.value.length,length:0};var d=this.numberInput[0].createTextRange(),g=d.duplicate();d.moveToBookmark(e.getBookmark());g.setEndPoint("EndToStart",d);c=e.text.length;return{start:g.text.length,end:g.text.length+e.text.length,length:c,text:e.text}}catch(h){return{start:0,end:0,length:0}}},
    selectAll:function(){var b=this.numberInput;setTimeout(function(){if("selectionStart"in b[0])b[0].focus(),b[0].setSelectionRange(0,b[0].value.length);else{var c=b[0].createTextRange();c.collapse(!0);c.moveEnd("character",b[0].value.length);c.moveStart("character",0);c.select()}},10)},_setSelection:function(b,c){if(1!=this._disableSetSelection&&!d.jqx.mobile.isTouchDevice()&&1!=this.touchMode)try{if("selectionStart"in this.numberInput[0])this.numberInput[0].focus(),this.numberInput[0].setSelectionRange(b,
        c);else{var e=this.numberInput[0].createTextRange();e.collapse(!0);e.moveEnd("character",c);e.moveStart("character",b);e.select()}}catch(f){}},_setSelectionStart:function(b){this._setSelection(b,b);d.data(this.numberInput,"selectionstart",b)},resize:function(b,c){this.width=b;this.height=c;this._render(!1)},_render:function(b){var c=parseInt(this.host.css("border-left-width")),e=parseInt(this.host.css("border-left-width")),f=parseInt(this.host.css("border-left-width")),g=parseInt(this.host.css("border-left-width"));
        this.numberInput.css("padding-top","0px");this.numberInput.css("padding-bottom","0px");var h=window.getComputedStyle(this.element),k=2*parseInt(h.borderLeftWidth);if("border-box"===h.boxSizing||isNaN(k))k=0;null!=this.width&&-1!=this.width.toString().indexOf("px")?this.element.style.width=parseInt(this.width)-k+"px":void 0==this.width||isNaN(this.width)||(this.element.style.width=parseInt(this.width)-k+"px");null!=this.height&&-1!=this.height.toString().indexOf("px")?this.element.style.height=parseInt(this.height)-
            k+"px":void 0==this.height||isNaN(this.height)||(this.element.style.height=parseInt(this.height)-k+"px");h=this.host.width();k=this.host.height();this.numberInput.css({"border-left-width":0,"border-right-width":0,"border-bottom-width":0,"border-top-width":0});isNaN(f)&&(f=1);isNaN(e);isNaN(g);isNaN(c);this.numberInput.css("text-align",this.textAlign);c=this.numberInput.css("font-size");""==c&&(c=13);this.numberInput.css("height",parseInt(c)+4+"px");this.numberInput.css("width",h-2);f=k-2*f-parseInt(c)-
            2;isNaN(f)&&(f=0);0>f&&(f=0);this.spinButtons&&this.spincontainer&&(h-=parseInt(this.spinButtonsWidth-2),d.jqx.mobile.isTouchDevice()||!0===this.touchMode?(this.spincontainer.width(2*this.spinButtonsWidth),h-=this.spinButtonsWidth,this.upbutton.height("100%"),this.downbutton.height("100%"),this.downbutton.css("float","left"),this.upbutton.css("float","right"),this.upbutton.width(this.spinButtonsWidth),this.downbutton.width(1+this.spinButtonsWidth)):(this.spincontainer.width(this.spinButtonsWidth),
            this.upbutton.width(this.spinButtonsWidth+2),this.downbutton.width(this.spinButtonsWidth+2),this.upbutton.height("50%"),this.downbutton.height("50%"),this.spincontainer.width(this.spinButtonsWidth)),this._upArrow.height("100%"),this._downArrow.height("100%"),this.numberInput.css("width",h-6),this.numberInput.css("margin-right","2px"));c=f/2;d.jqx.browser.msie&&8>d.jqx.browser.version&&(c=f/4);this.numberInput.css("padding-left","0px");this.numberInput.css("padding-right","0px");this.numberInput.css("padding-top",
            Math.round(c)+"px");this.numberInput.css("padding-bottom",Math.round(c)+"px");if(void 0==b||1==b)this.numberInput.val(this._getString()),"advanced"!=this.inputMode&&this._parseDecimalInSimpleMode();this._addBarAndLabel(this.numberInput);this._updateHint()},_addBarAndLabel:function(b){if(null===this.bar&&null===this.label){var c=d("<label></label");this.hint&&(c[0].innerHTML=this.placeHolder);c.addClass(this.toThemeProperty("jqx-input-label"));b.after(c);this.label=c;c=d("<span></span>");b.after(c);
        c.addClass(this.toThemeProperty("jqx-input-bar"));this.spinButtons?c.css("top",this.host.height()):c.css("top","0px");this.bar=c;this.template&&(this.bar.addClass(this.toThemeProperty("jqx-"+this.template)),this.label.addClass(this.toThemeProperty("jqx-"+this.template)))}},destroy:function(){this._removeHandlers();this.host.remove()},inputValue:function(b){if(void 0===b)return this._value();this.propertyChangedHandler(this,"value",this._value,b);this._refreshValue();return this},_value:function(){return this.numberInput.val()},
    val:function(b){if(void 0!==b&&"object"!=typeof b||null===b)if(null===b)this.setDecimal(null);else{b=b.toString();-1<b.indexOf(this.symbol)&&(b=b.replace(this.symbol,""));b=b.replace(this.decimalSeparator,".");var c=this.groupSeparator,e=b;if(""!=c){for(b=e.indexOf(c);-1!=b;)e=e.replace(c,""),b=e.indexOf(c);b=e}c="";for(e=0;e<b.length;e++){var d=b.substring(e,e+1);"-"===d&&(c+="-");"."===d&&(c+=".");null!=d.match(/^[0-9]+$/)&&(c+=d)}b=c.replace(/ /g,"");b=new Number(b);this.setDecimal(b)}else return this.getDecimal()},
    getDecimal:function(){if(null==this.decimal)return null;"simple"==this.inputMode&&(this._parseDecimalInSimpleMode(!1),this.decimal=this._getDecimalInSimpleMode(this.decimal));return""==this.decimal?0:this.getvalue("negative")&&0<this.decimal?-parseFloat(this.decimal):parseFloat(this.decimal)},setDecimal:function(b){var c=b;if("."!=this.decimalSeparator)if(null===b)this._setDecimal(b);else{var e=b;if("number"!=typeof b){b=b.toString();var d=b.indexOf(".");if(-1!=d){var g=b.substring(0,d);b=b.substring(d+
        1);e=g+"."+b;-1!=g.indexOf("-")&&(g=g.substring(1));b="advanced"!=this.inputMode?g+"."+b:g+this.decimalSeparator+b}else d=b.indexOf(this.decimalSeparator),-1!=d&&(g=b.substring(0,d),b=b.substring(d+1),e=g+"."+b,-1!=g.indexOf("-")&&(g=g.substring(1)),b="advanced"!=this.inputMode?g+"."+b:g+this.decimalSeparator+b)}0>e?this.setvalue("negative",!0):this.setvalue("negative",!1);null===b?this._setDecimal(b):this._setDecimal(Math.abs(b))}else 0>b?this.setvalue("negative",!0):this.setvalue("negative",!1),
        null===b?this._setDecimal(b):this._setDecimal(Math.abs(b));null==c&&this.numberInput.val("");this._updateHint()},_setDecimal:function(b){this.allowNull||null!=b||(b=this.decimal=0);if(null==b)this.value=this.decimal=null,this.clearDecimal(),this._refreshValue(),this.value=this.decimal=null,this.ValueString="";else{-1!=b.toString().indexOf("e")&&(b=(new Number(b)).toFixed(this.decimalDigits).toString());this.clearDecimal();var c=b.toString(),e="",d="",g=!0;0==c.length&&(c="0");for(var h=0;h<c.length;h++){if("number"==
        typeof b){if("."==c.substring(h,h+1)){g=!1;continue}}else if(c.substring(h,h+1)==this.decimalSeparator){g=!1;continue}g?e+=c.substring(h,h+1):d+=c.substring(h,h+1)}0<e.length&&(e=parseFloat(e).toString());h=this.digits;h<e.length&&(e=e.substr(0,h));c=0;g=this._getSeparatorPosition();h=this._getHiddenPrefixCount();for(h=g+=h;0<=h;h--)h<this.items.length&&this.items[h].canEdit&&c<e.length&&(this.items[h].character=e.substring(e.length-c-1,e.length-c),c++);c=0;for(h=g;h<this.items.length;h++)this.items[h].canEdit&&
    c<d.length&&(this.items[h].character=d.substring(c,c+1),c++);this._refreshValue();"."==this.decimalSeparator?this.ValueString=(new Number(b)).toFixed(this.decimalDigits):(e=b.toString().indexOf(this.decimalSeparator),0<e?(b=b.toString().substring(0,e)+"."+b.toString().substring(e+1),this.ValueString=(new Number(b)).toFixed(this.decimalDigits)):this.ValueString=(new Number(b)).toFixed(this.decimalDigits));"advanced"!=this.inputMode&&(this._parseDecimalInSimpleMode(),this._raiseEvent(1,this.ValueString));
        "textbox"==this.inputMode&&(this.decimal=this.ValueString,this.getvalue("negative")&&(this.decimal="-"+this.ValueString));b=this.val();b<this.min||b>this.max?this.host.addClass("jqx-input-invalid"):this.host.removeClass("jqx-input-invalid");this._updateHint()}},_getSeparatorPosition:function(){var b=this._getHiddenPrefixCount();return 0<this.decimalSeparatorPosition?this.decimalSeparatorPosition-b:this.items.length-b},_setTheme:function(){this.host.removeClass();this.host.addClass(this.toThemeProperty("jqx-input"));
        this.host.addClass(this.toThemeProperty("jqx-rc-all"));this.host.addClass(this.toThemeProperty("jqx-widget"));this.host.addClass(this.toThemeProperty("jqx-widget-content"));this.host.addClass(this.toThemeProperty("jqx-numberinput"));this.spinButtons&&(this.downbutton.removeClass(),this.upbutton.removeClass(),this.downbutton.addClass(this.toThemeProperty("jqx-scrollbar-button-state-normal")),this.upbutton.addClass(this.toThemeProperty("jqx-scrollbar-button-state-normal")),this._upArrow.removeClass(),
            this._downArrow.removeClass(),this._upArrow.addClass(this.toThemeProperty("jqx-icon-arrow-up")),this._downArrow.addClass(this.toThemeProperty("jqx-icon-arrow-down")));this.numberInput.removeClass();this.numberInput.addClass(this.toThemeProperty("jqx-input-content"))},propertiesChangedHandler:function(b,c,e){e&&e.width&&e.height&&2==Object.keys(e).length&&b._render()},propertyChangedHandler:function(b,c,e,f){if(!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length)){"template"==
    c&&(b.upbutton.removeClass(b.toThemeProperty("jqx-"+b.template)),b.downbutton.removeClass(b.toThemeProperty("jqx-"+b.template)),b.upbutton.addClass(b.toThemeProperty("jqx-"+b.template)),b.downbutton.addClass(b.toThemeProperty("jqx-"+b.template)));if(("digits"==c||"groupSize"==c||"decimalDigits"==c)&&0>f)throw new Exception(this.invalidArgumentExceptions[0]);"placeHolder"==c&&(b.isMaterialized()?b.hint&&(b.label[0].innerHTML=b.placeHolder):b.numberInput.attr("placeholder",b.placeHolder));"theme"===
    c&&d.jqx.utilities.setTheme(e,f,b.host);"digits"==c&&f!=e&&(b.digits=parseInt(f));if("min"==c||"max"==c)d.jqx.aria(b,"aria-value"+c,f.toString()),b._refreshValue();"decimalDigits"==c&&f!=e&&(b.decimalDigits=parseInt(f));if("decimalSeparator"==c||"digits"==c||"symbol"==c||"symbolPosition"==c||"groupSize"==c||"groupSeparator"==c||"decimalDigits"==c||"negativeSymbol"==c){var g=b.decimal;"decimalSeparator"==c&&""==f&&(f=" ");e!=f&&(b._selection(),b.items=[],b._initializeLiterals(),b.value=b._getString(),
        b._refreshValue(),b._setDecimal(g))}"rtl"==c&&(b.rtl?(b.spincontainer&&(b.spincontainer.css("float","right"),b.spincontainer.css("border-right-width","1px")),b.numberInput.css("float","right")):(b.spincontainer&&(b.spincontainer.css("float","right"),b.spincontainer.css("border-right-width","1px")),b.numberInput.css("float","left")));"spinButtons"==c&&(b.spincontainer?(f?b.spincontainer.css("display","block"):b.spincontainer.css("display","none"),b._render()):b._spinButtons());"touchMode"===c&&(b.inputMode=
        "textbox",b.spinMode="simple",b.render());"negative"==c&&"advanced"==b.inputMode&&(e=b._selection(),f?(b.items[0].character=b.negativeSymbol[0],g=1):(b.items[0].character="",g=-1),b._refreshValue(),b.isInitialized&&b._setSelection(e.start+g,e.end+g));"decimal"==c&&(b.value=f,b.setDecimal(f));"value"===c&&(b.value=f,b.setDecimal(f),b._raiseEvent(1,f));"textAlign"==c&&(b.textAlign=f,b._render());"disabled"==c&&(b.numberInput.attr("disabled",f),b.disabled?b.host.addClass(b.toThemeProperty("jqx-fill-state-disabled")):
        b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")),d.jqx.aria(b,"aria-disabled",f.toString()));"readOnly"==c&&(b.readOnly=f);if("promptChar"==c){for(e=0;e<b.items.length;e++)b.items[e].character==b.promptChar&&(b.items[e].character=f);b.promptChar=f}"width"==c?(b.width=f,b._render()):"height"==c&&(b.height=f,b._render())}},_refreshValue:function(){if("textbox"!==this.inputMode){var b=this.value=this._getString();for(var c="",e=0;e<this.items.length;e++){var d=this.items[e];d.canEdit&&
    d.character!=this.promptChar&&(c+=d.character);e==this.decimalSeparatorPosition&&(c+=".")}this.decimal=c;c=!1;this.oldValue!==b&&(this.oldValue=b,this._raiseEvent(0,b),c=!0);"simple"!=this.inputMode&&(this.numberInput.val(b),c&&this._raiseEvent(1,b));null==b&&this.numberInput.val("")}}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxPasswordInput","",{});d.extend(d.jqx._jqxPasswordInput.prototype,{defineInstance:function(){var b={width:null,height:null,disabled:!1,rtl:!1,placeHolder:null,showStrength:!1,showStrengthPosition:"right",maxLength:null,minLength:null,showPasswordIcon:!0,strengthTypeRenderer:null,passwordStrength:null,changeType:null,hint:!0,localization:{passwordStrengthString:"Password strength",tooShort:"Too short",weak:"Weak",fair:"Fair",good:"Good",strong:"Strong",showPasswordString:"Show Password"},
        strengthColors:{tooShort:"rgb(170, 0, 51)",weak:"rgb(170, 0, 51)",fair:"rgb(255, 204, 51)",good:"rgb(45, 152, 243)",strong:"rgb(118, 194, 97)"}};if(this===d.jqx._jqxPasswordInput.prototype)return b;d.extend(!0,this,b);return b},createInstance:function(){this._inDOM=document.body.contains(this.element);this.render()},render:function(){var b=this,c=d.jqx.browser.version;this._browserCheck="msie"!=d.jqx.browser.browser||"7.0"!=c&&"8.0"!=c;this.widgetID=b.element.id;if("password"!=this.element.getAttribute("type"))throw"Invalid input type. Please set the type attribute of the input element to password.";
        this.input=this.element;if(b.isMaterialized()){c=d("<div></div>");c.addClass(b.toThemeProperty("jqx-input-group"));this.host.after(c);var e=this.element,f=this.host.data();c.append(e);e=d("<label></label");this.hint&&(e[0].innerHTML=this.placeHolder);e.addClass(b.toThemeProperty("jqx-input-label"));c.append(e);var g=d("<span></span>");c.append(g);g.addClass(b.toThemeProperty("jqx-input-bar"));c[0].id=this.element.id;this.element.removeAttribute("id");c[0].style.cssText=this.element.style.cssText;
            b.input=b.element;this.element.style.cssText="";this.bar=g;this.label=e;this.host=c;this.element=c[0];this.host.data(f);b=this;b.template&&(b.bar.addClass(b.toThemeProperty("jqx-"+b.template)),b.label.addClass(b.toThemeProperty("jqx-"+b.template)))}b._hidden=!0;b._setTheme();b._setAttributes();b._showPassword();b._showStrength();d.jqx.utilities.resize(this.host,function(){if(!b._inDOM){var c=b.element.parentNode;b.element.nextSibling?c.insertBefore(b.icon,b.element.nextSibling):c.appendChild(b.icon);
            b._inDOM=!0}else if(b.element===document.activeElement||b.isMaterialized())b._positionIcon(),b.showStrength&&b.host.jqxTooltip("close")})},refresh:function(b){b||(this.removeHandler(this.host,"change.passwordinput"+this.widgetID),this.removeHandler(this.host,"focus.passwordinput"+this.widgetID),this.removeHandler(this.host,"blur.passwordinput"+this.widgetID),this.removeHandler(this.host,"click.passwordinput"+this.widgetID),this.removeHandler(this.host,"keyup.passwordinput"+this.widgetID),this.removeHandler(this.icon,
        "mousedown.passwordinput"+this.widgetID),this.removeHandler(d(document),"mouseup.passwordinput"+this.widgetID),this.removeHandler(d(document),"mousedown.passwordinput"+this.widgetID),this._setAttributes(),this._setTheme(),this._showPassword(),this._showStrength())},val:function(b){var c=this.input.value,e="placeholder"in this.input;if(d.isEmptyObject(b)&&""!==b)return e||c!==this.placeHolder||(c=""),c;if(!e||b!==c){if(!e){if(""===b){c!==this.placeHolder&&(this.input.value=this.placeHolder,this.input.setAttribute("type",
        "text"));return}this.input.setAttribute("type","password")}this.input.value=b;e&&this.isMaterialized()&&this._refreshPlaceHolder();!0===this.showStrength&&this._evaluateStrength()}},propertyChangedHandler:function(b,c,e,f){"theme"===c?d.jqx.utilities.setTheme(e,f,b.host):"disabled"==c?b.disabled?(b.element.setAttribute("disabled","disabled"),b.element.className+=" "+b.toThemeProperty("jqx-fill-state-disabled")):(b.host.removeAttr("disabled"),b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled"))):
        "placeHolder"==c?this._browserCheck&&("placeholder"in this.element?b.element.setAttribute("placeholder",b.placeHolder):""===b.input.value?(b.input.setAttribute("type","text"),b.input.value=f):b.input.value==e&&(b.input.value=f)):this.refresh()},resize:function(b,c){this.width=b;this.height=c;null!=this.width&&-1!=this.width.toString().indexOf("px")?this.element.style.width=this.width:void 0==this.width||isNaN(this.width)||(this.element.style.width=this.width+"px");null!=this.height&&-1!=this.height.toString().indexOf("px")?
        this.element.style.height=this.height:void 0==this.height||isNaN(this.height)||(this.element.style.height=this.height+"px")},_setAttributes:function(){var b=this,c=b.element;null!=this.width&&-1!=this.width.toString().indexOf("px")?this.element.style.width=this.width:void 0==this.width||isNaN(this.width)||(this.element.style.width=this.width+"px");null!=this.height&&-1!=this.height.toString().indexOf("px")?this.element.style.height=this.height:void 0==this.height||isNaN(this.height)||(this.element.style.height=
        this.height+"px");null!=this.height&&-1!=this.height.toString().indexOf("%")&&(this.element.style.height=this.height);null!=this.width&&-1!=this.width.toString().indexOf("%")&&(this.element.style.width=this.width);b.maxLength&&c.setAttribute("maxlength",b.maxLength);b.minLength&&c.setAttribute("minLength",b.minLength);b.placeHolder&&b._browserCheck&&("placeholder"in b.element?c.setAttribute("placeholder",b.placeHolder):""===c.value&&(c.setAttribute("type","text"),c.value=b.placeHolder));b.disabled?
        (c.setAttribute("disabled","disabled"),c.className+=" "+this.toThemeProperty("jqx-fill-state-disabled")):(c.removeAttribute("disabled"),b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")));var e=!1;b.addHandler(c,"change.passwordinput"+b.widgetID,function(c){e||(c.preventDefault(),c.stopPropagation(),e=!0,b._raiseEvent(),e=!1);b._refreshPlaceHolder()});b.addHandler(c,"click.passwordinput"+b.widgetID,function(){b.showPasswordIcon&&b.icon&&(b.icon.style.display="inline",b._positionIcon())});
        b.interval=null;b.addHandler(c,"keydown.passwordinput"+b.widgetID,function(){b.changeType="keyboard";if(b.showPasswordIcon&&b.icon){b.interval&&clearInterval(b.interval);var c=0;b.interval=setInterval(function(){"none"!=b.icon.style.display?(b._positionIcon(),c++,5<c&&clearInterval(b.interval)):clearInterval(b.interval)},100)}});b.addHandler(c,"focus.passwordinput"+b.widgetID,function(){b._focused=!0;c.className+=" "+b.toThemeProperty("jqx-fill-state-focus");!b.placeHolder||!b._browserCheck||"placeholder"in
        b.element||c.value!=b.placeHolder||(c.value="",b._hidden&&c.setAttribute("type","password"));0<b.val().length&&b.showStrength&&b.host.jqxTooltip("content")&&b.host.jqxTooltip("open");b.showPasswordIcon&&b.icon&&(b.icon.style.display="inline",b._positionIcon())});b.addHandler(c,"blur.passwordinput"+b.widgetID,function(){b._focused=!1;b.host.removeClass(b.toThemeProperty("jqx-fill-state-focus"));!b.placeHolder||!b._browserCheck||"placeholder"in b.input||""!==c.value||(b.input.value=b.placeHolder,b.input.setAttribute("type",
            "text"));b.showPasswordIcon&&b._browserCheck&&(!1===b.rtl?b.host.removeClass(b.toThemeProperty("jqx-passwordinput-password-icon-ltr")):b.host.removeClass(b.toThemeProperty("jqx-passwordinput-password-icon-rtl")));b.showStrength&&b.host.jqxTooltip("close");b.showPasswordIcon&&b.icon&&(b.icon.style.display="none")})},_refreshPlaceHolder:function(){this.isMaterialized()||("placeholder"in this.input&&!(d.jqx.browser.msie&&9>d.jqx.browser.version)?this.input.setAttribute("placeHolder",this.placeHolder):
        ""===this.input.value&&(this.input.value=this.placeHolder));""!==this.input.value?this.element.setAttribute("hint",!0):this.element.removeAttribute("hint");this.label&&(this.label.innerHTML=this.placeHolder)},destroy:function(){this.host.jqxTooltip&&this.host.jqxTooltip("destroy");this.host.remove()},_setTheme:function(){var b="jqx-widget jqx-widget-content jqx-input jqx-input-widget jqx-rc-all";this.rtl?(b+=" jqx-rtl",this.element.style.direction="rtl"):(this.host.removeClass(this.toThemeProperty("jqx-rtl")),
        this.element.style.direction="ltr");this.element.className+=" "+this.toThemeProperty(b)},_showPassword:function(){if(this.showPasswordIcon&&this._browserCheck){var b=this,c=document.createElement("span"),e=".passwordinput"+b.widgetID;c.setAttribute("tabindex",-1);c.setAttribute("hasfocus",!1);c.setAttribute("title",b.localization.showPasswordString);c.style.position="absolute";c.style.display="none";c.className=b.toThemeProperty("jqx-passwordinput-password-icon");var f=b.element.parentNode;f&&(b.element.nextSibling?
        f.insertBefore(c,b.element.nextSibling):f.appendChild(c));b.icon=c;b._positionIcon();var g=function(){b.element.setAttribute("type","password");b.input&&b.input.setAttribute("type","password");b._hidden=!0},h=function(){!1===b._hidden?g():b._hidden&&(b.element.setAttribute("type","text"),b.input&&b.input.setAttribute("type","text"),b._hidden=!1)};d.jqx.mobile.isTouchDevice()?b.addHandler(b.icon,"mousedown"+e,function(){h();return!1}):(b.addHandler(b.icon,"mousedown"+e,function(){h();return!1}),b.addHandler(d(document),
        "mouseup"+e,function(){g();return!1}),b.addHandler(d(document),"mousedown"+e,function(){b._focused&&g()}))}},_positionIcon:function(){var b=this.host.offset(),c=this.element.offsetWidth,e=this.element.offsetHeight,f=d(this.icon);this.rtl?f.offset({top:parseInt(b.top+e/2-5,10),left:b.left+2}):f.offset({top:parseInt(b.top+e/2-5,10),left:b.left+c-18})},_showStrength:function(){if(this.showStrength)if(this.host.jqxTooltip){var b=this.widgetID+"Strength",c=b+"Value";b+="Indicator";if(this.strengthTypeRenderer){var e=
        this.input.value;"placeholder"in this.input||!this._browserCheck||e!=this.placeHolder||(e="");this._countCharacters();e=this.strengthTypeRenderer(e,{letters:this.letters,numbers:this.numbers,specialKeys:this.specials},this.localization.tooShort)}else e='<div style="width: 220px;"><div><span style="font-weight: bold;">'+this.localization.passwordStrengthString+': </span><span id="'+c+'"></span></div><div id="'+b+'"></div></div>';this.host.jqxTooltip({theme:this.theme,position:this.showStrengthPosition,
        content:e,trigger:"none",autoHide:!1,rtl:this.rtl});this.strengthTypeRenderer||(b=document.getElementById(b),document.getElementById(c).innerHTML=this.localization.tooShort,b.className+=" jqx-passwordinput-password-strength-inicator",b.style.backgroundColor=this.strengthColors.tooShort,b.style["float"]=!1===this.rtl?"left":"right");this._checkStrength()}else throw Error("jqxPasswordInput: Missing reference to jqxtooltip.js");},_checkStrength:function(){var b=this;b.addHandler(b.host,"keyup.passwordinput"+
        b.widgetID,function(){b._evaluateStrength()})},_raiseEvent:function(){var b=new d.Event("change");b.args={type:this.changeType};this.changeType=null;b.owner=this;return this.host.trigger(b)},_evaluateStrength:function(){var b=this.input.value,c=b.length;this._countCharacters();0<c&&this.showStrength&&(this.host.jqxTooltip("opened")||this.host.jqxTooltip("open"));var e=this.letters+this.numbers+2*this.specials+this.letters*this.numbers/2+c;var f=8>c?this.localization.tooShort:20>e?this.localization.weak:
        30>e?this.localization.fair:40>e?this.localization.good:this.localization.strong;if(this.strengthTypeRenderer){var g=this.strengthTypeRenderer(b,{letters:this.letters,numbers:this.numbers,specialKeys:this.specials},f);this.host.jqxTooltip({content:g})}else{this.passwordStrength&&(g=this.passwordStrength(b,{letters:this.letters,numbers:this.numbers,specialKeys:this.specials},f),d.each(this.localization,function(){if(g==this)return f=g,!1}));document.getElementById(this.widgetID+"StrengthValue").innerHTML=
        f;b=document.getElementById(this.widgetID+"StrengthIndicator");switch(f){case this.localization.tooShort:var h="20%";var k=this.strengthColors.tooShort;break;case this.localization.weak:h="40%";k=this.strengthColors.weak;break;case this.localization.fair:h="60%";k=this.strengthColors.fair;break;case this.localization.good:h="80%";k=this.strengthColors.good;break;case this.localization.strong:h="100%",k=this.strengthColors.strong}b.style.width=h;b.style.backgroundColor=k}},_countCharacters:function(){this.specials=
        this.numbers=this.letters=0;for(var b=this.input.value,c=b.length,e=0;e<c;e++){var d=b.charAt(e),g=b.charCodeAt(e);64<g&&91>g||96<g&&123>g||127<g&&155>g||159<g&&166>g?this.letters+=1:!1===isNaN(d)?this.numbers+=1:-1!="<>@!#$%^&*()_+[]{}?:;|'\"\\,./~`-=".indexOf(d)&&(this.specials+=1)}},_toPx:function(b){return"number"===typeof b?b+"px":b}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxProgressBar","",{});d.extend(d.jqx._jqxProgressBar.prototype,{defineInstance:function(){var b={colorRanges:[],value:0,oldValue:null,max:100,min:0,orientation:"horizontal",layout:"normal",width:null,height:null,showText:!1,animationDuration:300,disabled:!1,rtl:!1,renderText:null,template:"",aria:{"aria-valuenow":{name:"value",type:"number"},"aria-disabled":{name:"disabled",type:"boolean"}},events:["valueChanged","invalidValue","complete","change"]};if(this===d.jqx._jqxProgressBar.prototype)return b;
        d.extend(!0,this,b);return b},createInstance:function(b){var c=this;this.host.addClass(this.toThemeProperty("jqx-progressbar"));this.host.addClass(this.toThemeProperty("jqx-widget"));this.host.addClass(this.toThemeProperty("jqx-widget-content"));this.host.addClass(this.toThemeProperty("jqx-rc-all"));d.jqx.aria(this);if(null==this.width||-1==this.width.toString().indexOf("px"))void 0==this.width||isNaN(this.width);this.host.width(this.width);if(null==this.height||-1==this.height.toString().indexOf("px"))void 0==
    this.height||isNaN(this.height);this.host.height(this.height);this.valueDiv=d("<div></div>").appendTo(this.element);this._addRanges();this.valueDiv.addClass(this.toThemeProperty("jqx-fill-state-pressed"));this.template&&this.valueDiv.addClass(this.toThemeProperty("jqx-"+this.template));this.feedbackElementHost=d("<div style='left: 0px; top: 0px; width: 100%; height: 100%; position: absolute;'></div>").appendTo(this.host);this.feedbackElement=d("<span class='text'></span>").appendTo(this.feedbackElementHost);
        this.feedbackElement.addClass(this.toThemeProperty("jqx-progressbar-text"));this.oldValue=this._value();this.refresh();d.jqx.utilities.resize(this.host,function(){c.refresh()})},_addRanges:function(){if(0!=this.colorRanges.length)for(var b="vertical"==this.orientation,c=this.colorRanges,e=c.length,d=0;d<e;d++)this._createColorElements(c[d].stop,c[d].color,b,e-d,d)},_refreshColorElements:function(){for(var b=this.host.outerWidth(),c=this.host.outerHeight(),e="vertical"==this.orientation,d=0;d<this.colorRanges.length;d++){var g=
        this.colorRanges[d].element;if(!g){this.host.find(".jqx-progressbar-range").remove();this._addRanges();break}var h=this.colorRanges[d].stop;h>Math.min(this.max,this.value)&&(h=Math.min(this.max,this.value));h=100*(h-this.min)/(this.max-this.min);h=e?c*h/100:b*h/100;h+="px";e?(g.css("height",h),"reverse"==this.layout?g.css("bottom",0):g.css("top",0)):(g.css("width",h),(this.rtl||"reverse"==this.layout)&&g.css("right","0px"))}},_createColorElements:function(b,c,e,f,g){b>Math.min(this.max,this.value)&&
    (b=Math.min(this.max,this.value));b=100*b/this.max;this.host.width();this.host.height();b=e?this.host.outerHeight()*b/100:this.host.outerWidth()*b/100;b+="px";var h=d(this.valueDiv).parent()[0];h.style.position="relative";e?(e=d("<div/>"),e.attr("class","jqx-progressbar-range"),e.css("width","100%"),e.css("height",b),e.css("background-color",c),e.css("position","absolute"),e.css("z-index",f),"reverse"==this.layout?e.css("bottom",0):e.css("top",0)):(e=d("<div/>"),e.attr("class","jqx-progressbar-range"),
        e.css("width",b),e.css("height","100%"),e.css("background-color",c),e.css("position","absolute"),e.css("z-index",f),e.css("top","0px"),this.rtl&&e.css("right","0px"));e.appendTo(h);this.colorRanges[g].element=e},resize:function(b,c){this.width=b;this.height=c;this.refresh()},destroy:function(){this.host.removeClass();this.valueDiv.removeClass();this.valueDiv.remove();this.feedbackElement.remove()},_raiseevent:function(b,c,e){if(void 0!=this.isInitialized&&1==this.isInitialized)return b=new d.Event(this.events[b]),
        b.previousValue=c,b.currentValue=e,b.owner=this,this.host.trigger(b)},actualValue:function(b){if(void 0===b)return this._value();d.jqx.aria(this,"aria-valuenow",b);d.jqx.setvalueraiseevent(this,"value",b);return this._value()},val:function(b){return 0==arguments.length||"object"==typeof b?this.actualValue():this.actualValue(b)},propertiesChangedHandler:function(b,c,e){e&&e.width&&e.height&&2==Object.keys(e).length&&(b.host.width(e.width),b.host.height(e.height),b.refresh())},propertyChangedHandler:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        c,e,f){!this.isInitialized||e==f||b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length||("colorRanges"==c&&(b.host.find(".jqx-progressbar-range").remove(),b._addRanges()),"min"==c&&b.value<f?b.value=f:"max"==c&&b.value>f&&(b.value=f),"value"===c&&void 0!=this.value&&(this.value=f,this.oldValue=e,d.jqx.aria(b,"aria-valuenow",f),(f<this.min||f>this.max)&&this._raiseevent(1,e,f),this.refresh()),"theme"==c&&d.jqx.utilities.setTheme(e,f,b.host),"renderText"==c||
    "orientation"==c||"layout"==c||"showText"==c||"min"==c||"max"==c?this.refresh():"width"==c&&void 0!=this.width?void 0==this.width||isNaN(this.width)||(this.host.width(this.width),this.refresh()):"height"!=c||void 0==this.height||void 0==this.height||isNaN(this.height)||(this.host.height(this.height),this.refresh()),"disabled"==c&&this.refresh())},_value:function(){var b=this.value;"number"!==typeof b&&(b=parseInt(b),b=isNaN(b)?0:b);return Math.min(this.max,Math.max(this.min,b))},_percentage:function(){return 100*
        (this._value()-this.min)/(this.max-this.min)},_textwidth:function(b){b=d("<span>"+b+"</span>");d(this.host).append(b);var c=b.width();b.remove();return c},_textheight:function(b){b=d("<span>"+b+"</span>");d(this.host).append(b);var c=b.height();b.remove();return c},_initialRender:!0,refresh:function(b){if(!0!==b){var c=this.actualValue(),e=this._percentage();if(this.disabled)this.host.addClass(this.toThemeProperty("jqx-progressbar-disabled")),this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));
    else if(this.host.removeClass(this.toThemeProperty("jqx-progressbar-disabled")),this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled")),d(this.element.children[0]).show(),!isNaN(c)&&!isNaN(e)){this.oldValue!==c&&(this._raiseevent(0,this.oldValue,c),this._raiseevent(3,this.oldValue,c),this.oldValue=c);var f=this.oldValue,g=this.host.outerHeight(),h=this.host.outerWidth();null!=this.width&&(h=parseInt(this.width));null!=this.height&&(g=parseInt(this.height));this._refreshColorElements();
        b=parseInt(this.host.outerWidth())/2;parseInt(this.host.outerHeight());isNaN(e)&&(e=0);this.valueDiv.removeClass(this.toThemeProperty("jqx-progressbar-value-vertical jqx-progressbar-value"));"horizontal"==this.orientation?(this.valueDiv.width(0),this.valueDiv[0].style.height="100%",this.valueDiv.addClass(this.toThemeProperty("jqx-progressbar-value"))):(this.valueDiv[0].style.width="100%",this.valueDiv.height(0),this.valueDiv.addClass(this.toThemeProperty("jqx-progressbar-value-vertical")));var k=
            this;try{var l=this.element.children[0];d(l)[0].style.position="relative";if("horizontal"==this.orientation){d(l).toggle(c>=this.min);h=this.host.outerWidth()*e/100;g=0;if("reverse"==this.layout||this.rtl)this._initialRender&&(d(l)[0].style.left=this.host.width()+"px",d(l)[0].style.width=0),g=this.host.outerWidth()-h;d(l).stop();d(l).animate({width:h,left:g+"px"},this.animationDuration,function(){k._value()===k.max&&k._raiseevent(2,f,k.max)})}else d(l).toggle(c>=this.min),g=this.host.height()*e/100,
            h=0,"reverse"==this.layout&&(this._initialRender&&(d(l)[0].style.top=this.host.height()+"px",d(l)[0].style.height=0),h=this.host.height()-g),d(l).stop(),d(l).animate({height:g,top:h+"px"},this.animationDuration,function(){var b=k._percentage();isNaN(b)&&(b=0);b.toFixed(0)==k.min&&(d(l).hide(),k._value()===k.max&&k._raiseevent(2,f,k.max))})}catch(m){}this._initialRender=!1;this.feedbackElement.html(e.toFixed(0)+"%").toggle(1==this.showText);this.renderText&&this.feedbackElement.html(this.renderText(e.toFixed(0)+
            "%",e));this.feedbackElement.css("position","absolute");this.feedbackElement.css("top","50%");this.feedbackElement.css("left","0");0<this.colorRanges.length&&this.feedbackElement.css("z-index",this.colorRanges.length+1);e=this.feedbackElement.height();g=this.feedbackElement.width();b=Math.floor(b-parseInt(g)/2);this.feedbackElement.css({left:b,"margin-top":-parseInt(e)/2+"px"})}}}})})(jqxBaseFramework);
(function(d){d.jqx.jqxWidget("jqxValidator","",{});d.extend(d.jqx._jqxValidator.prototype,{defineInstance:function(){var b={rules:null,scroll:!0,focus:!0,scrollDuration:300,scrollCallback:null,position:"right",arrow:!0,animation:"fade",animationDuration:150,closeOnClick:!0,onError:null,onSuccess:null,ownerElement:null,_events:["validationError","validationSuccess"],hintPositionOffset:5,_inputHint:[],rtl:!1,hintType:"tooltip"};if(this===d.jqx._jqxValidator.prototype)return b;d.extend(!0,this,b);return b},
    createInstance:function(){"label"==this.hintType&&150==this.animationDuration&&(this.animationDuration=0);this._configureInputs();this._removeEventListeners();this._addEventListeners()},destroy:function(){this._removeEventListeners();this.hide()},validate:function(b){var c=!0,e,f=Infinity,g=[];this.updatePosition();for(var h=this,k=0,l=0;l<this.rules.length;l+=1)"function"===typeof this.rules[l].rule&&k++;this.positions=[];for(l=0;l<this.rules.length;l+=1)if(d(this.rules[l].input),"function"===typeof this.rules[l].rule?
        this._validateRule(this.rules[l],function(l,q){e=l;0==e&&(c=!1,d(q.input),m=d(q.input),g.push(m),l=m.offset())&&(r=l.top,f>r&&(f=r,t=m));k--;0==k&&"function"===typeof b&&(h._handleValidation(c,f,t,g),b&&b(c))}):e=this._validateRule(this.rules[l]),0==e){c=!1;var m=d(this.rules[l].input);g.push(m);var p=m.offset();if(p){var r=p.top;if(f>r){f=r;var t=m}}}if(0==k)return this._handleValidation(c,f,t,g),c},validateInput:function(b){b=this._getRulesForInput(b);for(var c=!0,e=0;e<b.length;e+=1)this._validateRule(b[e])||
    (c=!1);return c},hideHint:function(b){b=this._getRulesForInput(b);for(var c=0;c<b.length;c+=1)this._hideHintByRule(b[c])},hide:function(){for(var b=0;b<this.rules.length;b+=1)this._hideHintByRule(this.rules[b])},updatePosition:function(){this.positions=[];for(var b=0;b<this.rules.length;b+=1){var c=this.rules[b];c.hint&&this._hintLayout(c.hint,d(c.input),c.position,c)}},_getRulesForInput:function(b){for(var c=[],e=0;e<this.rules.length;e+=1)this.rules[e].input===b&&c.push(this.rules[e]);return c},
    _validateRule:function(b,c){var e=d(b.input),f=!0,g=this,h=function(f){f?(g._hideHintByRule(b),c&&c(!0,b)):(f=g.animation,g.animation=null,b.hint&&g._hideHintByRule(b),"none"==d(e).css("display")?g._hideHintByRule(b):0==d(e).parents().length?g._hideHintByRule(b):(l=b.hintRender.apply(g,[b.message,e]),g._hintLayout(l,e,b.position,b),g._showHint(l),b.hint=l,g._removeLowPriorityHints(b),c&&c(!1,b),g.animation=f))},k=!1;"function"===typeof b.rule&&(k=b.rule.call(this,e,h),1==k&&c&&c(!0,b));if("function"===
        typeof b.rule&&0==k){if("function"===typeof b.hintRender&&!b.hint&&!this._higherPriorityActive(b)&&e.is(":visible")){var l=b.hintRender.apply(this,[b.message,e]);this._removeLowPriorityHints(b);this._hintLayout(l,e,b.position,b);this._showHint(l);b.hint=l}f=!1;c&&c(!1,b)}else this._hideHintByRule(b);return f},_hideHintByRule:function(b){var c=d(b.input),e=this,f,g=function(){if("label"==e.hintType){if("top"==e.position||"left"==e.position){if(c.prev().hasClass(".jqx-validator-error-label"))return}else if(c.next().hasClass(".jqx-validator-error-label"))return;
        "input"!=c[0].nodeName.toLowerCase()?0<c.find("input").length?(0<c.find(".jqx-input").length?c.find(".jqx-input").removeClass(e.toThemeProperty("jqx-validator-error-element")):0<c.find(".jqx-text-area").length?c.find(".jqx-text-area").removeClass(e.toThemeProperty("jqx-validator-error-element")):c.is(".jqx-checkbox")&&c.find(".jqx-checkbox-default").removeClass(e.toThemeProperty("jqx-validator-error-element")),c.is(".jqx-radiobutton")?c.find(".jqx-radiobutton-default").removeClass(e.toThemeProperty("jqx-validator-error-element")):
            c.removeClass(e.toThemeProperty("jqx-validator-error-element"))):c.removeClass(e.toThemeProperty("jqx-validator-error-element")):c.removeClass(e.toThemeProperty("jqx-validator-error-element"))}};if(b){if(f=b.hint)this.positions&&this.positions[Math.round(f.offset().top)+"_"+Math.round(f.offset().left)]&&(this.positions[Math.round(f.offset().top)+"_"+Math.round(f.offset().left)]=null),"fade"===this.animation?f.fadeOut(this.animationDuration,function(){f.remove();g()}):(f.remove(),g());b.hint=null}},
    _handleValidation:function(b,c,e,d){if(b){if(this._raiseEvent(1),"function"===typeof this.onSuccess)this.onSuccess()}else if(this._scrollHandler(c),this.focus&&e.focus(),this._raiseEvent(0,{invalidInputs:d}),"function"===typeof this.onError)this.onError(d)},_scrollHandler:function(b){if(this.scroll){var c=this;d("html,body").animate({scrollTop:b},this.scrollDuration,function(){"function"===typeof c.scrollCallback&&c.scrollCallback.call(c)})}},_higherPriorityActive:function(b){for(var c=!1,e,d=this.rules.length-
        1;0<=d;--d){e=this.rules[d];if(c&&e.input===b.input&&e.hint)return!0;e===b&&(c=!0)}return!1},_removeLowPriorityHints:function(b){for(var c=!1,e,d=0;d<this.rules.length;d+=1)e=this.rules[d],c&&e.input===b.input&&this._hideHintByRule(e),e===b&&(c=!0)},_getHintRuleByInput:function(b){for(var c,e=0;e<this.rules.length;e+=1)if(c=this.rules[e],d(c.input)[0]===b[0]&&c.hint)return c;return null},_removeEventListeners:function(){for(var b,c,e=0;e<this.rules.length;e+=1){b=this.rules[e];c=b.action.split(",");
        b=d(b.input);for(var f=0;f<c.length;f+=1)this.removeHandler(b,d.trim(c[f])+".jqx-validator")}},_addEventListeners:function(){if(0<this.host.parents(".jqx-window").length){var b=this,c=function(){b.updatePosition()};var e=this.host.parents(".jqx-window");this.addHandler(e,"closed",function(){b.hide()});this.addHandler(e,"moved",c);this.addHandler(e,"moving",c);this.addHandler(e,"resized",c);this.addHandler(e,"resizing",c);this.addHandler(d(document.parentWindow),"scroll",function(){b.scroll&&c()})}for(var f=
        0;f<this.rules.length;f+=1){e=this.rules[f];var g=d(e.input);this._addListenerTo(g,e)}},_addListenerTo:function(b,c){var e=this,f=c.action.split(","),g=!1;this._isjQWidget(b)&&(g=!0);for(var h=0;h<f.length;h+=1){var k=d.trim(f[h]);!g||"blur"!=k&&"focus"!=k||b&&"input"!=b[0].nodeName.toLowerCase()&&(b=b.find("input"));this.addHandler(b,k+".jqx-validator",function(b){e._validateRule(c)})}},_configureInputs:function(){this.rules=this.rules||[];for(var b=0;b<this.rules.length;b+=1)this._handleInput(b)},
    _handleInput:function(b){b=this.rules[b];b.position||(b.position=this.position);b.message||(b.message="Validation Failed!");b.action||(b.action="blur");b.hintRender||(b.hintRender=this._hintRender);b.rule?this._handleRule(b):b.rule=null},_handleRule:function(b){var c=b.rule,e,d=!1;if("string"===typeof c){if(0<=c.indexOf("=")){c=c.split("=");var g=c[1].split(",");c=c[0]}(e=this["_"+c])?b.rule=function(b,c){return e.apply(this,[b].concat(g))}:d=!0}else"function"!==typeof c?d=!0:b.rule=c;if(d)throw Error("Wrong parameter!");
    },_required:function(b){switch(this._getType(b)){case "jqx-input-inner":if(0<b.find("input").length)return""!==d.trim(b.find("input").val());break;case "textarea":case "password":case "jqx-input":case "jqx-text-area":case "text":var c=d.data(b[0]);return c.jqxMaskedInput?(c=b.jqxMaskedInput("promptChar"),(b=b.jqxMaskedInput("value"))&&0>b.indexOf(c)):c.jqxNumberInput?""!==b.jqxNumberInput("inputValue"):c.jqxDateTimeInput?!0:""!==d.trim(b.val());case "checkbox":return b.is(":checked");case "radio":return b.is(":checked");
        case "jqx-check-box":case "jqx-radio-button":return b[0].val();case "jqxCheckBox":case "jqxcheckbox":case "jqxradiobutton":case "jqxRadioButton":b=b.find("input").val();if(!0===b||1===b||"true"===b)return!0;break;case "div":if(b.is(".jqx-checkbox"))return b.jqxCheckBox("checked");if(b.is(".jqx-radiobutton"))return b.jqxRadioButton("checked")}return!1},_notNumber:function(b){return this._validateText(b,function(b){return""==b?!0:!/\d/.test(b)})},_startWithLetter:function(b){return this._validateText(b,
        function(b){return""==b?!0:!/\d/.test(b.substring(0,1))})},_number:function(b){return this._validateText(b,function(b){if(""==b)return!0;b=new Number(b);return!isNaN(b)&&isFinite(b)})},_phone:function(b){return this._validateText(b,function(b){return""==b?!0:/^\(\d{3}\)(\d){3}-(\d){4}$/.test(b)})},_length:function(b,c,e){return this._minLength(b,c)&&this._maxLength(b,e)},_maxLength:function(b,c){c=parseInt(c,10);return this._validateText(b,function(b){return b.length<=c})},_minLength:function(b,c){c=
        parseInt(c,10);return this._validateText(b,function(b){return b.length>=c})},_email:function(b){return this._validateText(b,function(b){return""==b?!0:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(b)})},_zipCode:function(b){return this._validateText(b,function(b){return""==b?!0:/^(^\d{5}$)|(^\d{5}-\d{4}$)|(\d{3}-\d{2}-\d{4})$/.test(b)})},_ssn:function(b){return this._validateText(b,function(b){return""==
    b?!0:/\d{3}-\d{2}-\d{4}/.test(b)})},_validateText:function(b,c){return this._isTextInput(b)?(b=this._isjQWidget(b)?0<b.find("input").length?b.find("input").val():b.val():b.val(),c(b)):!1},_isjQWidget:function(b){var c=d.data(b[0]);return c.jqxMaskedInput||c.jqxNumberInput||c.jqxDateTimeInput||0<=b[0].tagName.toLowerCase().indexOf("jqx")||0<=b[0].tagName.toLowerCase().indexOf("jqx-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-password-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-complex-input")||
    0<=b[0].tagName.toLowerCase().indexOf("jqx-formatted-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-masked-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-date-time-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-number-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-check-box")||0<=b[0].tagName.toLowerCase().indexOf("jqx-radio-button")||0<=b[0].tagName.toLowerCase().indexOf("jqxcheckbox")||0<=b[0].tagName.toLowerCase().indexOf("angular")?!0:!1},_isTextInput:function(b){var c=this._getType(b);
        return"text"===c||"textarea"===c||"password"===c||"jqx-input-inner"===c||b.is(".jqx-input")||b.is(".jqx-text-area")},_getType:function(b){if(b[0]){var c=b[0].tagName.toLowerCase();return"textarea"===c?"textarea":b.is(".jqx-input")?"jqx-input":b.is(".jqx-text-area")?"jqx-text-area":0<b.find(".jqx-input").length?"jqx-input-inner":"input"===c?b=d(b).attr("type")?d(b).attr("type").toLowerCase():"text":"jqx-password-input"===c?"password":"jqx-check-box"===c?"jqx-check-box":"jqx-radio-button"===c?"jqx-radio-button":
        c}},_hintRender:function(b,c){if("label"==this.hintType){var e=d('<label class="'+this.toThemeProperty("jqx-validator-error-label")+'"></label>');e.html(b);var f=!1;0<c.parent().find(".jqx-input-label").length&&!c.hasClass("jqx-dropdownlist")&&!c.hasClass("jqx-combobox")&&!c.hasClass("jqx-datetimeinput")&&(e=c.parent().find(".jqx-input-label"),c.data().jqxWidget.hint&&(e.html(b),e.addClass(this.toThemeProperty("jqx-validator-error-label")),c.data().jqxWidget.host.attr("hint",!0)),this.hasHint=f=!0);
        var g=this;this.closeOnClick&&e.click(function(){g.hideHint(c.selector)});f||("left"==this.position||"top"==this.position?e.insertBefore(d(c)):e.insertAfter(d(c)));return e}e=d('<div class="'+this.toThemeProperty("jqx-validator-hint")+' jqx-rc-all"></div>');var h=this;e.html(b);this.closeOnClick&&e.click(function(){h.hideHint(c.selector)});null==this.ownerElement?e.appendTo(document.body):this.ownerElement.innerHTML?e.appendTo(d(this.ownerElement)):e.appendTo(this.ownerElement);return e},_hintLayout:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          c,e,f){if(this._hintRender===f.hintRender)if(f=this._getPosition(c,e,b,f),"label"==this.hintType){f="2px";if("left"==this.position||"top"==this.position)f="-2px";"input"!=c[0].nodeName.toLowerCase()&&"textarea"!=c[0].nodeName.toLowerCase()?(0<c.find(".jqx-text-area").length&&c.find(".jqx-text-area").addClass(this.toThemeProperty("jqx-validator-error-element")),0<c.find("input").length&&(0<c.find(".jqx-input").length?c.find(".jqx-input").addClass(this.toThemeProperty("jqx-validator-error-element")):
        0<c.find(".jqx-text-area").length?c.find(".jqx-text-area").addClass(this.toThemeProperty("jqx-validator-error-element")):c.is(".jqx-checkbox")&&c.find(".jqx-checkbox-default").addClass(this.toThemeProperty("jqx-validator-error-element")),c.is(".jqx-radiobutton")?c.find(".jqx-radiobutton-default").addClass(this.toThemeProperty("jqx-validator-error-element")):c.addClass(this.toThemeProperty("jqx-validator-error-element")))):c.addClass(this.toThemeProperty("jqx-validator-error-element"));var g=d("<span></span>");
        g.addClass(this.toThemeProperty("jqx-validator-hint"));g.html(b.text());g.appendTo(d(document.body));var h=g.outerWidth();g.remove();this.hasHint||(b.css({position:"relative",left:d(c).css("margin-left"),width:d(c).width(),top:f}),"center"==e&&(b.css("width",h),b.css("left","0px"),b.css("margin-left","auto"),b.css("margin-right","auto")))}else b.css({position:"absolute",left:f.left,top:f.top}),this.arrow&&this._addArrow(c,b,e,f)},_showHint:function(b){b&&"fade"===this.animation&&(b.fadeOut(0),b.fadeIn(this.animationDuration))},
    _getPosition:function(b,c,e,f){var g=b.offset(),h=b.outerWidth(),k=b.outerHeight();this.rtl&&0<=c.indexOf("left")&&(c="right");this.rtl&&0<=c.indexOf("right")&&(c="left");null!=this.ownerElement&&(g={left:0,top:0},g.top=parseInt(g.top)+b.position().top,g.left=parseInt(g.left)+b.position().left);f&&f.hintPositionRelativeElement&&(f=d(f.hintPositionRelativeElement),g=f.offset(),h=f.width(),k=f.height());f=0<=c.indexOf("top")?g.top-k:0<=c.indexOf("bottom")?g.top+e.outerHeight()+this.hintPositionOffset+
        5:g.top;e=0<=c.indexOf("center")?g.left+this.hintPositionOffset+(h-e.outerWidth())/2:0<=c.indexOf("left")?g.left-e.outerWidth()-this.hintPositionOffset:0<=c.indexOf("right")?g.left+h+this.hintPositionOffset:g.left+this.hintPositionOffset;0<=c.indexOf(":")&&(c=c.split(":")[1].split(","),e+=parseInt(c[0],10),f+=parseInt(c[1],10));this.positions||(this.positions=[]);this.positions[Math.round(f)+"_"+Math.round(e)]&&this.positions[Math.round(f)+"_"+Math.round(e)].top==f&&(f+=b.outerHeight());this.positions[Math.round(f)+
    "_"+Math.round(e)]={left:e,top:f};return{left:e,top:f}},_addArrow:function(b,c,e,f){b=d('<div class="'+this.toThemeProperty("jqx-validator-hint-arrow")+'"></div>');var g;this.rtl&&0<=e.indexOf("left")&&(e="right");this.rtl&&0<=e.indexOf("right")&&(e="left");c.children(".jqx-validator-hint-arrow").remove();c.append(b);var h=b.outerHeight();f=b.outerWidth();var k=c.outerHeight();c=c.outerWidth();this._addImage(b);h=0<=e.indexOf("top")?k-h:0<=e.indexOf("bottom")?-h:(k-h)/2-h/2;0<=e.indexOf("center")?
        g=(c-f)/2:0<=e.indexOf("left")?g=c-f/2-1:0<=e.indexOf("right")&&(g=-f/2);if(0<=e.indexOf("topright")||0<=e.indexOf("bottomright"))g=0;if(0<=e.indexOf("topleft")||0<=e.indexOf("bottomleft"))g=c-f;b.css({position:"absolute",left:g,top:h})},_addImage:function(b){var c=b.css("background-image");c=c.replace('url("',"");c=c.replace('")',"");c=c.replace("url(","");c=c.replace(")","");b.css("background-image","none");b.append('<img src="'+c+'" alt="Arrow" style="position: relative; top: 0px; left: 0px; width: '+
        b.width()+"px; height: "+b.height()+'px;" />')},_raiseEvent:function(b,c){b=d.Event(this._events[b]);b.args=c;return this.host.trigger(b)},propertyChangedHandler:function(b,c,e,d){"rules"===c&&(this._configureInputs(),this._removeEventListeners(),this._addEventListeners())}})})(jqxBaseFramework);
var saveAs=saveAs||function(d){if(!("undefined"===typeof d||"undefined"!==typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=d.document.createElementNS("http://www.w3.org/1999/xhtml","a"),c="download"in b,e=/constructor/i.test(d.HTMLElement),f=/CriOS\/[\d]+/.test(navigator.userAgent),g=function(b){(d.setImmediate||d.setTimeout)(function(){throw b;},0)},h=function(b){setTimeout(function(){"string"===typeof b?(d.URL||d.webkitURL||d).revokeObjectURL(b):b.remove()},4E4)},k=function(b){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(b.type)?
    new Blob([String.fromCharCode(65279),b],{type:b.type}):b},l=function(l,m,t){t||(l=k(l));var p=this,q="application/octet-stream"===l.type,u=function(){var b=["writestart","progress","write","writeend"];b=[].concat(b);for(var c=b.length;c--;){var e=p["on"+b[c]];if("function"===typeof e)try{e.call(p,p)}catch(B){g(B)}}};p.readyState=p.INIT;if(c){var y=(d.URL||d.webkitURL||d).createObjectURL(l);setTimeout(function(){b.href=y;b.download=m;var c=new MouseEvent("click");b.dispatchEvent(c);u();h(y);p.readyState=
    p.DONE})}else(function(){if((f||q&&e)&&d.FileReader){var b=new FileReader;b.onloadend=function(){var c=f?b.result:b.result.replace(/^data:[^;]*;/,"data:attachment/file;");d.open(c,"_blank")||(d.location.href=c);p.readyState=p.DONE;u()};b.readAsDataURL(l);p.readyState=p.INIT}else y||(y=(d.URL||d.webkitURL||d).createObjectURL(l)),q?d.location.href=y:d.open(y,"_blank")||(d.location.href=y),p.readyState=p.DONE,u(),h(y)})()},m=l.prototype;if("undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob)return function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        c,e){c=c||b.name||"download";e||(b=k(b));return navigator.msSaveOrOpenBlob(b,c)};m.abort=function(){};m.readyState=m.INIT=0;m.WRITING=1;m.DONE=2;m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null;return function(b,c,e){return new l(b,c||b.name||"download",e)}}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content);
"undefined"!==typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!==typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs});"use strict";var CBStatIconField=function(d){jsGrid.Field.call(this,d)};CBStatIconField.prototype=new jsGrid.Field({css:"jsg-icon",align:"center",itemTemplate:genTemplate("statIcon")});jsGrid.fields.staticon=CBStatIconField;var CBResIconField=function(d){jsGrid.Field.call(this,d)};
CBResIconField.prototype=new jsGrid.Field({css:"jsg-icon",align:"center",itemTemplate:genTemplate("resIcon")});jsGrid.fields.resicon=CBResIconField;function genTemplate(d){return function(b,c){return b?String.formatEx('<span data-{0}="'+c.id+'"><img src="/Common/Media/Ribbons/Reader/Status/'+(b+'16.png"height="16"></span>'),d):String.formatEx('<span data-{0}="'+c.id+'"></span>',d)}}
(function(d){"object"===typeof exports&&"undefined"!==typeof module?module.exports=d():"function"===typeof define&&define.amd?define([],d):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).localforage=d()})(function(){return function f(b,c,e){function g(k,m){if(!c[k]){if(!b[k]){var l="function"==typeof require&&require;if(!m&&l)return l(k,!0);if(h)return h(k,!0);m=Error("Cannot find module '"+k+"'");throw m.code="MODULE_NOT_FOUND",m;}m=c[k]=
    {exports:{}};b[k][0].call(m.exports,function(c){var e=b[k][1][c];return g(e?e:c)},m,m.exports,f,b,c,e)}return c[k].exports}for(var h="function"==typeof require&&require,k=0;k<e.length;k++)g(e[k]);return g}({1:[function(b,c,e){(function(b){function e(){r=!0;for(var b,c,e=t.length;e;){c=t;t=[];for(b=-1;++b<e;)c[b]();e=t.length}r=!1}var f=b.MutationObserver||b.WebKitMutationObserver;if(f){var k=0;f=new f(e);var l=b.document.createTextNode("");f.observe(l,{characterData:!0});var m=function(){l.data=k=
        ++k%2}}else if(b.setImmediate||"undefined"===typeof b.MessageChannel)m="document"in b&&"onreadystatechange"in b.document.createElement("script")?function(){var c=b.document.createElement("script");c.onreadystatechange=function(){e();c.onreadystatechange=null;c.parentNode.removeChild(c);c=null};b.document.documentElement.appendChild(c)}:function(){setTimeout(e,0)};else{var p=new b.MessageChannel;p.port1.onmessage=e;m=function(){p.port2.postMessage(0)}}var r,t=[];c.exports=function(b){1!==t.push(b)||
    r||m()}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],2:[function(b,c,e){function f(){}function g(b){if("function"!==typeof b)throw new TypeError("resolver must be a function");this.state=u;this.queue=[];this.outcome=void 0;b!==f&&m(this,b)}function h(b,c,e){this.promise=b;"function"===typeof c&&(this.onFulfilled=c,this.callFulfilled=this.otherCallFulfilled);"function"===typeof e&&(this.onRejected=e,this.callRejected=this.otherCallRejected)}
        function k(b,c,e){r(function(){try{var f=c(e)}catch(B){return t.reject(b,B)}f===b?t.reject(b,new TypeError("Cannot resolve promise with itself")):t.resolve(b,f)})}function l(b){var c=b&&b.then;if(b&&("object"===typeof b||"function"===typeof b)&&"function"===typeof c)return function(){c.apply(b,arguments)}}function m(b,c){function e(c){g||(g=!0,t.reject(b,c))}function f(c){g||(g=!0,t.resolve(b,c))}var g=!1,h=p(function(){c(f,e)});"error"===h.status&&e(h.value)}function p(b,c){var e={};try{e.value=
            b(c),e.status="success"}catch(C){e.status="error",e.value=C}return e}var r=b(1),t={},w=["REJECTED"],q=["FULFILLED"],u=["PENDING"];c.exports=g;g.prototype["catch"]=function(b){return this.then(null,b)};g.prototype.then=function(b,c){if("function"!==typeof b&&this.state===q||"function"!==typeof c&&this.state===w)return this;var e=new this.constructor(f);this.state!==u?k(e,this.state===q?b:c,this.outcome):this.queue.push(new h(e,b,c));return e};h.prototype.callFulfilled=function(b){t.resolve(this.promise,
            b)};h.prototype.otherCallFulfilled=function(b){k(this.promise,this.onFulfilled,b)};h.prototype.callRejected=function(b){t.reject(this.promise,b)};h.prototype.otherCallRejected=function(b){k(this.promise,this.onRejected,b)};t.resolve=function(b,c){var e=p(l,c);if("error"===e.status)return t.reject(b,e.value);if(e=e.value)m(b,e);else{b.state=q;b.outcome=c;e=-1;for(var f=b.queue.length;++e<f;)b.queue[e].callFulfilled(c)}return b};t.reject=function(b,c){b.state=w;b.outcome=c;for(var e=-1,f=b.queue.length;++e<
        f;)b.queue[e].callRejected(c);return b};g.resolve=function(b){return b instanceof this?b:t.resolve(new this(f),b)};g.reject=function(b){var c=new this(f);return t.reject(c,b)};g.all=function(b){function c(b,c){e.resolve(b).then(function(b){k[c]=b;++q!==g||h||(h=!0,t.resolve(u,k))},function(b){h||(h=!0,t.reject(u,b))})}var e=this;if("[object Array]"!==Object.prototype.toString.call(b))return this.reject(new TypeError("must be an array"));var g=b.length,h=!1;if(!g)return this.resolve([]);for(var k=
            Array(g),q=0,l=-1,u=new this(f);++l<g;)c(b[l],l);return u};g.race=function(b){function c(b){e.resolve(b).then(function(b){h||(h=!0,t.resolve(q,b))},function(b){h||(h=!0,t.reject(q,b))})}var e=this;if("[object Array]"!==Object.prototype.toString.call(b))return this.reject(new TypeError("must be an array"));var g=b.length,h=!1;if(!g)return this.resolve([]);for(var k=-1,q=new this(f);++k<g;)c(b[k]);return q}},{1:1}],3:[function(b,c,e){c="undefined"!==typeof global?global:"undefined"!==typeof self?self:
        "undefined"!==typeof window?window:{};"function"!==typeof c.Promise&&(c.Promise=b(2))},{2:2}],4:[function(b,c,e){function f(b,c){b=b||[];c=c||{};try{return new Blob(b,c)}catch(la){if("TypeError"!==la.name)throw la;for(var e=new ("undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),f=0;f<b.length;f+=1)e.append(b[f]);return e.getBlob(c.type)}}function g(b,c){c&&b.then(function(b){c(null,b)},
        function(b){c(b)})}function h(b,c,e){"function"===typeof c&&b.then(c);if("function"===typeof e)b["catch"](e)}function k(b){"string"!==typeof b&&(console.warn(b+" used as a key, but it is not a string."),b=String(b));return b}function l(){if(arguments.length&&"function"===typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function m(b){return(new F(function(c){var e=b.transaction("local-forage-detect-blob-support","readwrite"),g=f([""]);e.objectStore("local-forage-detect-blob-support").put(g,
        "key");e.onabort=function(b){b.preventDefault();b.stopPropagation();c(!1)};e.oncomplete=function(){var b=navigator.userAgent.match(/Chrome\/(\d+)/),e=navigator.userAgent.match(/Edge\//);c(e||!b||43<=parseInt(b[1],10))}}))["catch"](function(){return!1})}function p(b){return"boolean"===typeof R?F.resolve(R):m(b).then(function(b){return R=b})}function r(b){b=U[b.name];var c={};c.promise=new F(function(b,e){c.resolve=b;c.reject=e});b.deferredOperations.push(c);b.dbReady=b.dbReady?b.dbReady.then(function(){return c.promise}):
        c.promise}function t(b){if(b=U[b.name].deferredOperations.pop())return b.resolve(),b.promise}function w(b,c){if(b=U[b.name].deferredOperations.pop())return b.reject(c),b.promise}function q(b,c){return new F(function(e,f){U[b.name]=U[b.name]||D();if(b.db)if(c)r(b),b.db.close();else return e(b.db);var g=[b.name];c&&g.push(b.version);var h=E.open.apply(E,g);c&&(h.onupgradeneeded=function(c){var e=h.result;try{e.createObjectStore(b.storeName),1>=c.oldVersion&&e.createObjectStore("local-forage-detect-blob-support")}catch(ja){if("ConstraintError"===
        ja.name)console.warn('The database "'+b.name+'" has been upgraded from version '+c.oldVersion+" to version "+c.newVersion+', but the storage "'+b.storeName+'" already exists.');else throw ja;}});h.onerror=function(b){b.preventDefault();f(h.error)};h.onsuccess=function(){e(h.result);t(b)}})}function u(b,c){if(!b.db)return!0;var e=!b.db.objectStoreNames.contains(b.storeName),f=b.version>b.db.version;b.version<b.db.version&&(b.version!==c&&console.warn('The database "'+b.name+"\" can't be downgraded from version "+
        b.db.version+" to version "+b.version+"."),b.version=b.db.version);return f||e?(e&&(c=b.db.version+1,c>b.version&&(b.version=c)),!0):!1}function y(b){return new F(function(c,e){var f=new FileReader;f.onerror=e;f.onloadend=function(e){e=btoa(e.target.result||"");c({__local_forage_encoded_blob:!0,data:e,type:b.type})};f.readAsBinaryString(b)})}function z(b){for(var c=atob(b.data),e=c.length,g=new ArrayBuffer(e),h=new Uint8Array(g),k=0;k<e;k++)h[k]=c.charCodeAt(k);return f([g],{type:b.type})}function A(b){var c=
        this,e=c._initReady().then(function(){var b=U[c._dbInfo.name];if(b&&b.dbReady)return b.dbReady});h(e,b,b);return e}function C(b){r(b);for(var c=U[b.name],e=c.forages,f=0;f<e.length;f++){var g=e[f];g._dbInfo.db&&(g._dbInfo.db.close(),g._dbInfo.db=null)}b.db=null;return q(b,!1).then(function(c){b.db=c;return u(b)?q(b,!0):c}).then(function(f){b.db=c.db=f;for(var g=0;g<e.length;g++)e[g]._dbInfo.db=f})["catch"](function(c){w(b,c);throw c;})}function B(b,c,e,f){void 0===f&&(f=1);try{var g=b.db.transaction(b.storeName,
        c);e(null,g)}catch(ia){if(0<f&&(!b.db||"InvalidStateError"===ia.name||"NotFoundError"===ia.name))return F.resolve().then(function(){if(!b.db||"NotFoundError"===ia.name&&!b.db.objectStoreNames.contains(b.storeName)&&b.version<=b.db.version)return b.db&&(b.version=b.db.version+1),q(b,!0)}).then(function(){return C(b).then(function(){B(b,c,e,f-1)})})["catch"](e);e(ia)}}function D(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function K(b){var c=.75*b.length,e=b.length,f=0;"="===b[b.length-
    1]&&(c--,"="===b[b.length-2]&&c--);var g=new ArrayBuffer(c),h=new Uint8Array(g);for(c=0;c<e;c+=4){var k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[c]);var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[c+1]);var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[c+2]);var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[c+3]);h[f++]=k<<2|q>>4;h[f++]=(q&15)<<4|l>>2;h[f++]=(l&
        3)<<6|u&63}return g}function I(b){b=new Uint8Array(b);var c="",e;for(e=0;e<b.length;e+=3)c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[e]>>2],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(b[e]&3)<<4|b[e+1]>>4],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(b[e+1]&15)<<2|b[e+2]>>6],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[e+2]&63];2===b.length%3?c=c.substring(0,c.length-1)+"=":1===b.length%3&&
        (c=c.substring(0,c.length-2)+"==");return c}function G(b,c,e,f){b.executeSql("CREATE TABLE IF NOT EXISTS "+c.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],e,f)}function H(b,c,e,f,g,h){b.executeSql(e,f,g,function(b,k){k.code===k.SYNTAX_ERR?b.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[c.storeName],function(b,q){q.rows.length?h(b,k):G(b,c,function(){b.executeSql(e,f,g,h)},h)},h):h(b,k)},h)}function N(b,c,e,f){var h=this;b=k(b);var q=new F(function(g,k){h.ready().then(function(){void 0===
    c&&(c=null);var q=c,l=h._dbInfo;l.serializer.serialize(c,function(c,u){u?k(u):l.db.transaction(function(e){H(e,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[b,c],function(){g(q)},function(b,c){k(c)})},function(c){c.code===c.QUOTA_ERR&&(0<f?g(N.apply(h,[b,q,e,f-1])):k(c))})})})["catch"](k)});g(q,e);return q}function Q(b){return new F(function(c,e){b.transaction(function(f){f.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",
        [],function(e,f){e=[];for(var g=0;g<f.rows.length;g++)e.push(f.rows.item(g).name);c({db:b,storeNames:e})},function(b,c){e(c)})},function(b){e(b)})})}function J(b,c){var e=b.name+"/";b.storeName!==c.storeName&&(e+=b.storeName+"/");return e}function O(b,c){b[c]=function(){var e=arguments;return b.ready().then(function(){return b[c].apply(b,e)})}}function L(){for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var e in c)c.hasOwnProperty(e)&&(v(c[e])?arguments[0][e]=c[e].slice():arguments[0][e]=
        c[e])}return arguments[0]}$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var M="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(b){return typeof b}:function(b){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return b&&"function"===typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},E=function(){if("undefined"!==typeof indexedDB)return indexedDB;if("undefined"!==typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!==
        typeof mozIndexedDB)return mozIndexedDB;if("undefined"!==typeof OIndexedDB)return OIndexedDB;if("undefined"!==typeof msIndexedDB)return msIndexedDB}();"undefined"===typeof Promise&&b(3);var F=Promise,R=void 0,U={},W=Object.prototype.toString;b={_driver:"asyncStorage",_initStorage:function(b){function c(){return F.resolve()}var e=this,f={db:null};if(b)for(var g in b)f[g]=b[g];var h=U[f.name];h||(h=D(),U[f.name]=h);h.forages.push(e);e._initReady||(e._initReady=e.ready,e.ready=A);b=[];for(g=0;g<h.forages.length;g++){var k=
            h.forages[g];k!==e&&b.push(k._initReady()["catch"](c))}var l=h.forages.slice(0);return F.all(b).then(function(){f.db=h.db;return q(f,!1)}).then(function(b){f.db=b;return u(f,e._defaultConfig.version)?q(f,!0):b}).then(function(b){f.db=h.db=b;e._dbInfo=f;for(b=0;b<l.length;b++){var c=l[b];c!==e&&(c._dbInfo.db=f.db,c._dbInfo.version=f.version)}})},_support:function(){try{if(!E)return!1;var b="undefined"!==typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&
            !/BlackBerry/.test(navigator.platform),c="function"===typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!b||c)&&"undefined"!==typeof indexedDB&&"undefined"!==typeof IDBKeyRange}catch(ta){return!1}}(),iterate:function(b,c){var e=this,f=new F(function(c,f){e.ready().then(function(){B(e._dbInfo,"readonly",function(g,h){if(g)return f(g);try{var k=h.objectStore(e._dbInfo.storeName).openCursor(),q=1;k.onsuccess=function(){var e=k.result;if(e){var f=e.value;f&&f.__local_forage_encoded_blob&&
        (f=z(f));f=b(f,e.key,q++);if(void 0!==f)c(f);else e["continue"]()}else c()};k.onerror=function(){f(k.error)}}catch(oa){f(oa)}})})["catch"](f)});g(f,c);return f},getItem:function(b,c){var e=this;b=k(b);var f=new F(function(c,f){e.ready().then(function(){B(e._dbInfo,"readonly",function(g,h){if(g)return f(g);try{var k=h.objectStore(e._dbInfo.storeName).get(b);k.onsuccess=function(){var b=k.result;void 0===b&&(b=null);b&&b.__local_forage_encoded_blob&&(b=z(b));c(b)};k.onerror=function(){f(k.error)}}catch(na){f(na)}})})["catch"](f)});
            g(f,c);return f},setItem:function(b,c,e){var f=this;b=k(b);var h=new F(function(e,g){var h;f.ready().then(function(){h=f._dbInfo;return"[object Blob]"===W.call(c)?p(h.db).then(function(b){return b?c:y(c)}):c}).then(function(c){B(f._dbInfo,"readwrite",function(h,k){if(h)return g(h);try{var q=k.objectStore(f._dbInfo.storeName);null===c&&(c=void 0);var l=q.put(c,b);k.oncomplete=function(){void 0===c&&(c=null);e(c)};k.onabort=k.onerror=function(){g(l.error?l.error:l.transaction.error)}}catch(ua){g(ua)}})})["catch"](g)});
            g(h,e);return h},removeItem:function(b,c){var e=this;b=k(b);var f=new F(function(c,f){e.ready().then(function(){B(e._dbInfo,"readwrite",function(g,h){if(g)return f(g);try{var k=h.objectStore(e._dbInfo.storeName)["delete"](b);h.oncomplete=function(){c()};h.onerror=function(){f(k.error)};h.onabort=function(){f(k.error?k.error:k.transaction.error)}}catch(na){f(na)}})})["catch"](f)});g(f,c);return f},clear:function(b){var c=this,e=new F(function(b,e){c.ready().then(function(){B(c._dbInfo,"readwrite",
            function(f,g){if(f)return e(f);try{var h=g.objectStore(c._dbInfo.storeName).clear();g.oncomplete=function(){b()};g.onabort=g.onerror=function(){e(h.error?h.error:h.transaction.error)}}catch(ja){e(ja)}})})["catch"](e)});g(e,b);return e},length:function(b){var c=this,e=new F(function(b,e){c.ready().then(function(){B(c._dbInfo,"readonly",function(f,g){if(f)return e(f);try{var h=g.objectStore(c._dbInfo.storeName).count();h.onsuccess=function(){b(h.result)};h.onerror=function(){e(h.error)}}catch(ja){e(ja)}})})["catch"](e)});
            g(e,b);return e},key:function(b,c){var e=this,f=new F(function(c,f){if(0>b)c(null);else e.ready().then(function(){B(e._dbInfo,"readonly",function(g,h){if(g)return f(g);try{var k=!1,q=h.objectStore(e._dbInfo.storeName).openCursor();q.onsuccess=function(){var e=q.result;e?0===b?c(e.key):k?c(e.key):(k=!0,e.advance(b)):c(null)};q.onerror=function(){f(q.error)}}catch(oa){f(oa)}})})["catch"](f)});g(f,c);return f},keys:function(b){var c=this,e=new F(function(b,e){c.ready().then(function(){B(c._dbInfo,"readonly",
            function(f,g){if(f)return e(f);try{var h=g.objectStore(c._dbInfo.storeName).openCursor(),k=[];h.onsuccess=function(){var c=h.result;c?(k.push(c.key),c["continue"]()):b(k)};h.onerror=function(){e(h.error)}}catch(na){e(na)}})})["catch"](e)});g(e,b);return e},dropInstance:function(b,c){c=l.apply(this,arguments);var e=this.config();b="function"!==typeof b&&b||{};b.name||(b.name=b.name||e.name,b.storeName=b.storeName||e.storeName);b.name?(e=b.name===e.name&&this._dbInfo.db?F.resolve(this._dbInfo.db):q(b,
            !1).then(function(c){var e=U[b.name],f=e.forages;e.db=c;for(e=0;e<f.length;e++)f[e]._dbInfo.db=c;return c}),e=b.storeName?e.then(function(c){if(c.objectStoreNames.contains(b.storeName)){var e=c.version+1;r(b);var f=U[b.name],g=f.forages;c.close();for(c=0;c<g.length;c++){var h=g[c];h._dbInfo.db=null;h._dbInfo.version=e}return(new F(function(c,f){var g=E.open(b.name,e);g.onerror=function(b){g.result.close();f(b)};g.onupgradeneeded=function(){g.result.deleteObjectStore(b.storeName)};g.onsuccess=function(){var b=
            g.result;b.close();c(b)}})).then(function(b){f.db=b;for(var c=0;c<g.length;c++){var e=g[c];e._dbInfo.db=b;t(e._dbInfo)}})["catch"](function(c){(w(b,c)||F.resolve())["catch"](function(){});throw c;})}}):e.then(function(c){r(b);var e=U[b.name],f=e.forages;c.close();for(c=0;c<f.length;c++)f[c]._dbInfo.db=null;return(new F(function(c,e){var f=E.deleteDatabase(b.name);f.onerror=f.onblocked=function(b){var c=f.result;c&&c.close();e(b)};f.onsuccess=function(){var b=f.result;b&&b.close();c(b)}})).then(function(b){e.db=
            b;for(b=0;b<f.length;b++)t(f[b]._dbInfo)})["catch"](function(c){(w(b,c)||F.resolve())["catch"](function(){});throw c;})})):e=F.reject("Invalid arguments");g(e,c);return e}};var P=/^~~local_forage_type~([^~]+)~/,Z=Object.prototype.toString,ba={serialize:function(b,c){var e="";b&&(e=Z.call(b));if(b&&("[object ArrayBuffer]"===e||b.buffer&&"[object ArrayBuffer]"===Z.call(b.buffer))){var f="__lfsc__:";if(b instanceof ArrayBuffer){var g=b;f+="arbf"}else g=b.buffer,"[object Int8Array]"===e?f+="si08":"[object Uint8Array]"===
        e?f+="ui08":"[object Uint8ClampedArray]"===e?f+="uic8":"[object Int16Array]"===e?f+="si16":"[object Uint16Array]"===e?f+="ur16":"[object Int32Array]"===e?f+="si32":"[object Uint32Array]"===e?f+="ui32":"[object Float32Array]"===e?f+="fl32":"[object Float64Array]"===e?f+="fl64":c(Error("Failed to get type for BinaryArray"));c(f+I(g))}else if("[object Blob]"===e)e=new FileReader,e.onload=function(){var e="~~local_forage_type~"+b.type+"~"+I(this.result);c("__lfsc__:blob"+e)},e.readAsArrayBuffer(b);else try{c(JSON.stringify(b))}catch(ia){console.error("Couldn't convert value into a JSON string: ",
            b),c(null,ia)}},deserialize:function(b){if("__lfsc__:"!==b.substring(0,9))return JSON.parse(b);var c=b.substring(13);b=b.substring(9,13);if("blob"===b&&P.test(c)){var e=c.match(P);var g=e[1];c=c.substring(e[0].length)}c=K(c);switch(b){case "arbf":return c;case "blob":return f([c],{type:g});case "si08":return new Int8Array(c);case "ui08":return new Uint8Array(c);case "uic8":return new Uint8ClampedArray(c);case "si16":return new Int16Array(c);case "ur16":return new Uint16Array(c);case "si32":return new Int32Array(c);
            case "ui32":return new Uint32Array(c);case "fl32":return new Float32Array(c);case "fl64":return new Float64Array(c);default:throw Error("Unkown type: "+b);}},stringToBuffer:K,bufferToString:I};e={_driver:"webSQLStorage",_initStorage:function(b){var c=this,e={db:null};if(b)for(var f in b)e[f]="string"!==typeof b[f]?b[f].toString():b[f];b=new F(function(b,f){try{e.db=openDatabase(e.name,String(e.version),e.description,e.size)}catch(T){return f(T)}e.db.transaction(function(g){G(g,e,function(){c._dbInfo=
            e;b()},function(b,c){f(c)})},f)});e.serializer=ba;return b},_support:"function"===typeof openDatabase,iterate:function(b,c){var e=this,f=new F(function(c,f){e.ready().then(function(){var g=e._dbInfo;g.db.transaction(function(e){H(e,g,"SELECT * FROM "+g.storeName,[],function(e,f){e=f.rows;f=e.length;for(var h=0;h<f;h++){var k=e.item(h),q=k.value;q&&(q=g.serializer.deserialize(q));q=b(q,k.key,h+1);if(void 0!==q){c(q);return}}c()},function(b,c){f(c)})})})["catch"](f)});g(f,c);return f},getItem:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     c){var e=this;b=k(b);var f=new F(function(c,f){e.ready().then(function(){var g=e._dbInfo;g.db.transaction(function(e){H(e,g,"SELECT * FROM "+g.storeName+" WHERE key = ? LIMIT 1",[b],function(b,e){(b=e.rows.length?e.rows.item(0).value:null)&&(b=g.serializer.deserialize(b));c(b)},function(b,c){f(c)})})})["catch"](f)});g(f,c);return f},setItem:function(b,c,e){return N.apply(this,[b,c,e,1])},removeItem:function(b,c){var e=this;b=k(b);var f=new F(function(c,f){e.ready().then(function(){var g=e._dbInfo;
            g.db.transaction(function(e){H(e,g,"DELETE FROM "+g.storeName+" WHERE key = ?",[b],function(){c()},function(b,c){f(c)})})})["catch"](f)});g(f,c);return f},clear:function(b){var c=this,e=new F(function(b,e){c.ready().then(function(){var f=c._dbInfo;f.db.transaction(function(c){H(c,f,"DELETE FROM "+f.storeName,[],function(){b()},function(b,c){e(c)})})})["catch"](e)});g(e,b);return e},length:function(b){var c=this,e=new F(function(b,e){c.ready().then(function(){var f=c._dbInfo;f.db.transaction(function(c){H(c,
            f,"SELECT COUNT(key) as c FROM "+f.storeName,[],function(c,e){c=e.rows.item(0).c;b(c)},function(b,c){e(c)})})})["catch"](e)});g(e,b);return e},key:function(b,c){var e=this,f=new F(function(c,f){e.ready().then(function(){var g=e._dbInfo;g.db.transaction(function(e){H(e,g,"SELECT key FROM "+g.storeName+" WHERE id = ? LIMIT 1",[b+1],function(b,e){b=e.rows.length?e.rows.item(0).key:null;c(b)},function(b,c){f(c)})})})["catch"](f)});g(f,c);return f},keys:function(b){var c=this,e=new F(function(b,e){c.ready().then(function(){var f=
            c._dbInfo;f.db.transaction(function(c){H(c,f,"SELECT key FROM "+f.storeName,[],function(c,e){c=[];for(var f=0;f<e.rows.length;f++)c.push(e.rows.item(f).key);b(c)},function(b,c){e(c)})})})["catch"](e)});g(e,b);return e},dropInstance:function(b,c){c=l.apply(this,arguments);var e=this.config();b="function"!==typeof b&&b||{};b.name||(b.name=b.name||e.name,b.storeName=b.storeName||e.storeName);var f=this;var h=b.name?(new F(function(c){var g=b.name===e.name?f._dbInfo.db:openDatabase(b.name,"","",0);b.storeName?
            c({db:g,storeNames:[b.storeName]}):c(Q(g))})).then(function(b){return new F(function(c,e){b.db.transaction(function(f){function g(b){return new F(function(c,e){f.executeSql("DROP TABLE IF EXISTS "+b,[],function(){c()},function(b,c){e(c)})})}for(var h=[],k=0,q=b.storeNames.length;k<q;k++)h.push(g(b.storeNames[k]));F.all(h).then(function(){c()})["catch"](function(b){e(b)})},function(b){e(b)})})}):F.reject("Invalid arguments");g(h,c);return h}};try{var S="undefined"!==typeof localStorage&&"setItem"in
        localStorage&&!!localStorage.setItem}catch(V){S=!1}var da=function(b,c){for(var e=b.length,f=0;f<e;){var g=b[f],h=c;if(g===h||"number"===typeof g&&"number"===typeof h&&isNaN(g)&&isNaN(h))return!0;f++}return!1},v=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)},X={},aa={},Y={INDEXEDDB:b,WEBSQL:e,LOCALSTORAGE:{_driver:"localStorageWrapper",_initStorage:function(b){var c={};if(b)for(var e in b)c[e]=b[e];c.keyPrefix=J(b,this._defaultConfig);try{localStorage.setItem("_localforage_support_test",
                !0);localStorage.removeItem("_localforage_support_test");var f=!1}catch(la){f=!0}if(f&&!(0<localStorage.length))return F.reject();this._dbInfo=c;c.serializer=ba;return F.resolve()},_support:S,iterate:function(b,c){var e=this,f=e.ready().then(function(){for(var c=e._dbInfo,f=c.keyPrefix,g=f.length,h=localStorage.length,k=1,q=0;q<h;q++){var l=localStorage.key(q);if(0===l.indexOf(f)){var u=localStorage.getItem(l);u&&(u=c.serializer.deserialize(u));u=b(u,l.substring(g),k++);if(void 0!==u)return u}}});
                g(f,c);return f},getItem:function(b,c){var e=this;b=k(b);var f=e.ready().then(function(){var c=e._dbInfo,f=localStorage.getItem(c.keyPrefix+b);f&&(f=c.serializer.deserialize(f));return f});g(f,c);return f},setItem:function(b,c,e){var f=this;b=k(b);var h=f.ready().then(function(){void 0===c&&(c=null);var e=c;return new F(function(g,h){var k=f._dbInfo;k.serializer.serialize(c,function(c,f){if(f)h(f);else try{localStorage.setItem(k.keyPrefix+b,c),g(e)}catch(pa){"QuotaExceededError"!==pa.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==
            pa.name||h(pa),h(pa)}})})});g(h,e);return h},removeItem:function(b,c){var e=this;b=k(b);var f=e.ready().then(function(){localStorage.removeItem(e._dbInfo.keyPrefix+b)});g(f,c);return f},clear:function(b){var c=this,e=c.ready().then(function(){for(var b=c._dbInfo.keyPrefix,e=localStorage.length-1;0<=e;e--){var f=localStorage.key(e);0===f.indexOf(b)&&localStorage.removeItem(f)}});g(e,b);return e},length:function(b){var c=this.keys().then(function(b){return b.length});g(c,b);return c},key:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                c){var e=this,f=e.ready().then(function(){var c=e._dbInfo;try{var f=localStorage.key(b)}catch(T){f=null}f&&(f=f.substring(c.keyPrefix.length));return f});g(f,c);return f},keys:function(b){var c=this,e=c.ready().then(function(){for(var b=c._dbInfo,e=localStorage.length,f=[],g=0;g<e;g++){var h=localStorage.key(g);0===h.indexOf(b.keyPrefix)&&f.push(h.substring(b.keyPrefix.length))}return f});g(e,b);return e},dropInstance:function(b,c){c=l.apply(this,arguments);b="function"!==typeof b&&b||{};if(!b.name){var e=
                this.config();b.name=b.name||e.name;b.storeName=b.storeName||e.storeName}var f=this;e=b.name?(new F(function(c){b.storeName?c(J(b,f._defaultConfig)):c(b.name+"/")})).then(function(b){for(var c=localStorage.length-1;0<=c;c--){var e=localStorage.key(c);0===e.indexOf(b)&&localStorage.removeItem(e)}}):F.reject("Invalid arguments");g(e,c);return e}}};S=[Y.INDEXEDDB._driver,Y.WEBSQL._driver,Y.LOCALSTORAGE._driver];var ha=["dropInstance"],wa="clear getItem iterate key keys length removeItem setItem".split(" ").concat(ha),
        ka={description:"",driver:S.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};S=new (function(){function b(c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");for(var e in Y)if(Y.hasOwnProperty(e)){var f=Y[e],g=f._driver;this[e]=g;X[g]||this.defineDriver(f)}this._defaultConfig=L({},ka);this._config=L({},this._defaultConfig,c);this._initDriver=this._driverSet=null;this._ready=!1;this._dbInfo=null;this._wrapLibraryMethodsWithReady();this.setDriver(this._config.driver)["catch"](function(){})}
        b.prototype.config=function(b){if("object"===("undefined"===typeof b?"undefined":M(b))){if(this._ready)return Error("Can't call config() after localforage has been used.");for(var c in b){"storeName"===c&&(b[c]=b[c].replace(/\W/g,"_"));if("version"===c&&"number"!==typeof b[c])return Error("Database version must be a number.");this._config[c]=b[c]}return"driver"in b&&b.driver?this.setDriver(this._config.driver):!0}return"string"===typeof b?this._config[b]:this._config};b.prototype.defineDriver=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   c,e){var f=new F(function(c,e){try{var f=b._driver,h=Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(b._driver){for(var k=wa.concat("_initStorage"),q=0,l=k.length;q<l;q++){var u=k[q];if((!da(ha,u)||b[u])&&"function"!==typeof b[u]){e(h);return}}(function(){for(var c=function(b){return function(){var c=F.reject(Error("Method "+b+" is not implemented by the current driver"));g(c,arguments[arguments.length-1]);return c}},e=0,f=ha.length;e<f;e++){var h=
            ha[e];b[h]||(b[h]=c(h))}})();h=function(e){X[f]&&console.info("Redefining LocalForage driver: "+f);X[f]=b;aa[f]=e;c()};"_support"in b?b._support&&"function"===typeof b._support?b._support().then(h,e):h(!!b._support):h(!0)}else e(h)}catch(ua){e(ua)}});h(f,c,e);return f};b.prototype.driver=function(){return this._driver||null};b.prototype.getDriver=function(b,c,e){b=X[b]?F.resolve(X[b]):F.reject(Error("Driver not found."));h(b,c,e);return b};b.prototype.getSerializer=function(b){var c=F.resolve(ba);
            h(c,b);return c};b.prototype.ready=function(b){var c=this,e=c._driverSet.then(function(){null===c._ready&&(c._ready=c._initDriver());return c._ready});h(e,b,b);return e};b.prototype.setDriver=function(b,c,e){function f(){q._config.driver=q.driver()}function g(b){q._extend(b);f();q._ready=q._initStorage(q._config);return q._ready}function k(b){return function(){function c(){for(;e<b.length;){var h=b[e];e++;q._dbInfo=null;q._ready=null;return q.getDriver(h).then(g)["catch"](c)}f();q._driverSet=F.reject(Error("No available storage method found."));
            return q._driverSet}var e=0;return c()}}var q=this;v(b)||(b=[b]);var l=this._getSupportedDrivers(b);this._driverSet=(null!==this._driverSet?this._driverSet["catch"](function(){return F.resolve()}):F.resolve()).then(function(){var b=l[0];q._dbInfo=null;q._ready=null;return q.getDriver(b).then(function(b){q._driver=b._driver;f();q._wrapLibraryMethodsWithReady();q._initDriver=k(l)})})["catch"](function(){f();q._driverSet=F.reject(Error("No available storage method found."));return q._driverSet});h(this._driverSet,
            c,e);return this._driverSet};b.prototype.supports=function(b){return!!aa[b]};b.prototype._extend=function(b){L(this,b)};b.prototype._getSupportedDrivers=function(b){for(var c=[],e=0,f=b.length;e<f;e++){var g=b[e];this.supports(g)&&c.push(g)}return c};b.prototype._wrapLibraryMethodsWithReady=function(){for(var b=0,c=wa.length;b<c;b++)O(this,wa[b])};b.prototype.createInstance=function(c){return new b(c)};return b}());c.exports=S},{3:3}]},{},[4])(4)});"use strict";function CBDebug(){}
CBDebug.assert=function(d,b){if(!d)if(b||(b="ASSERT FAILURE"),"undefined"!==typeof console&&console.assert)console.assert(d,b),alert(b),CB.LOG(b);else throw b;};CBDebug.call=function(d,b){for(var c=arguments,e=[],f=2;f<c.length;++f)e.push(c[f]);b.apply(d,e)};CBDebug.profile=function(d){"undefined"!==typeof console&&console.profile&&console.profile(d)};CBDebug.profileEnd=function(){"undefined"!==typeof console&&console.profileEnd&&console.profileEnd()};function ASSERT(d){CBDebug.assert(d,d)}"use strict";
var CB={namespace:function(d){d=d.split(".");var b=CB;"CB"===d[0]&&(d=d.slice(1));for(var c=0;c<d.length;c+=1)"undefined"===typeof b[d[c]]&&(b[d[c]]={}),b=b[d[c]]},inherit:function(d,b){var c=d.prototype;d.prototype=new b;for(var e in c)c.hasOwnProperty(e)&&(d.prototype[e]=c[e]);d.superClass=b;d.prototype.superClass=b.prototype;return d},mixin:function(d,b){for(var c in b)b.hasOwnProperty(c)&&(d.prototype[c]=b[c])},mixObject:function(d,b){for(var c in b)b.hasOwnProperty(c)&&(d[c]=b[c])},partial:function(d,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             b){return ObjUtil.copyTo(b,d,!0)},protect:function(d,b){Object.defineProperty(d,b,{writable:!1})},property:function(d,b,c,e){Object.defineProperty(d,b,{get:c,set:e})},classProperty:function(d,b,c,e){Object.defineProperty(d.prototype,b,{get:c,set:e})},StringTools:{trimChar:function(d,b){d.charAt(0)==b&&(d=d.slice(1,d.length-1));2<d.length&&d.charAt(d.length-1)==b&&(d=d.slice(0,d.length-1));return d}}};function Char(){}Char.IsDigit=function(d){return"9">=d&&"0"<=d};
Char.IsLetter=function(d){return"z">=d&&"a"<=d||"Z">=d&&"A"<=d};Char.IsUpperCaseLetter=function(d){return"Z">=d&&"A"<=d};Char.IsLetterOrDigit=function(d){return Char.IsLetter(d)||Char.IsDigit(d)};Char.IsWhiteSpace=function(d){return"\r"===d||"\n"===d||" "===d||"\t"===d};Char.getIsChar=function(d){return function(b){return b===d}};Char.getIsNotChar=function(d){return function(b){return b!==d}};function StringIterator(d){this.m_str=d;this.m_len=d.length}StringIterator.prototype.m_str=null;
StringIterator.prototype.m_inx=-1;StringIterator.g_hasIndex=function(){return!0}();
StringIterator.g_hasIndex?(StringIterator.prototype.Current=function(){return this.m_str[this.m_inx]},StringIterator.prototype.Peek=function(){return this.m_inx>=this.m_len-1?0:this.m_str[this.m_inx+1]},StringIterator.prototype.Next=function(){++this.m_inx;return this.m_inx===this.m_len?0:this.m_str[this.m_inx]}):(StringIterator.prototype.Current=function(){return this.m_str.charAt(this.m_inx)},StringIterator.prototype.Peek=function(){return this.m_inx>=this.m_len-1?0:this.m_str.charAt(this.m_inx+
    1)},StringIterator.prototype.Next=function(){++this.m_inx;return this.m_inx===this.m_len?0:this.m_str.charAt(this.m_inx)});StringIterator.prototype.CurrentString=function(d){return this.SubString(this.m_inx,d)};StringIterator.prototype.NextString=function(d){return this.SubString(this.m_inx+1,d)};StringIterator.prototype.SubString=function(d,b){var c=this.m_len-d;if(!b||b>c)b=c;return this.m_str.substring(d,d+b)};StringIterator.prototype.getPosition=function(){return this.m_inx};
StringIterator.prototype.setPosition=function(d){this.m_inx=d};StringIterator.prototype.skip=function(d){this.m_inx+=d};StringIterator.prototype.isEOF=function(){return this.m_inx===this.m_len};StringIterator.prototype.AcceptWhile=function(d,b){var c="";if(b){b=this.Current();if("undefined"===typeof b||!d(b))return c;c=b}for(b=this.Next();0!==b&&d(b)&&(c+=b,"undefined"!==typeof b);b=this.Next());return c};StringIterator.prototype.AcceptUntil=function(d,b){return this.AcceptWhile(NOT(d),b)};
StringIterator.prototype.AcceptStr=function(d,b){var c=d.length;return(b?this.CurrentString(c):this.NextString(c))===d?(b||++c,this.skip(c),!0):!1};StringIterator.prototype.AcceptChar=function(d,b){if(b){if(this.Current()===d)return this.skip(1),!0}else if(this.Peek()===d)return this.skip(2),!0;return!1};StringIterator.prototype.skipWhile=function(d,b){if(!b||d(this.Current()))for(b=this.Next();0!==b&&d(b);b=this.Next());};StringIterator.prototype.skipUntil=function(d){return this.skipWhite(NOT(d))};
String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")});String.quote||(String.prototype.quote=function(){return'"'+this.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'});String.startsWith||(String.prototype.startsWith=function(d){return this.indexOf?0===this.indexOf(d):!1});String.capitalize||(String.capitalize=function(){return this.length?this[0].toUpperCase()+this.substring(1,this.length).toLowerCase():this});"use strict";
function StringBuilder(){var d=null,b=null,c=0,e="";this.appendFormat=function(){var b=String.formatEx.apply("",arguments);this.append(b)};this.append=function(f){e+=f;2800<e.length&&(null===d?d=b=[]:(f=b,b=[],f[1]=b),b[0]=e,e="",++c)};this.toString=function(){if(0==c)return e;for(;1<c;){for(var f=d,g=[],h=g,k=0;"undefined"!=typeof f;)"undefined"==typeof h[0]?(h[0]=f[0],++k):("undefined"!=typeof f[0]&&(h[0]+=f[0]),h[1]=[],h=h[1]),f=f[1];d=g;b=h;c=k}return d[0]+e}}
(function(){function d(b){try{for(var e="",d=c.lastIndex=0;;){var h=c.exec(b);if(!h)break;var k=h.index;if(k>d){var l=b.substring(d,k).quote();e&&(e+="+");e+=l}var m=h[1],p=parseInt(m);var r="nz(";r=isNaN(p)?r+("(_a."+m+")"):r+("(_a["+(p+1)+"])");r+=")";e&&(e+="+");e+=r;d=c.lastIndex}if(b.length>d){var t=b.substring(d).quote();e&&(e+="+");e+=t}var w="var nz = function(_v){if(_v === undefined || _v === null)return ''; return _v.toString()};return "+e+";"}catch(q){CB.LogException("_prepFormat",q)}return new Function("_a",
    w)}var b={},c=/{(\w+(\.\w+)*(\[\d+\])?)}/g;String.formatEx||(String.formatEx=function(c){try{var e=b[c];e||(e=d(c),b[c]=e);var g=arguments;2===arguments.length&&"object"===typeof arguments[1]&&0>c.indexOf("{0}")&&(g=arguments[1])}catch(h){CB.LogException("formatEx",h)}return e(g)});String.f=String.formatEx;String.vformatEx||(String.vformatEx=function(b,c){return d(b)(c)})})();
CB.Levenshtein={getDistance:function(d,b,c,e,f){c=c||1;e=e||1;f=f||1;if(0===d.length)return b.length;if(0===b.length)return d.length;var g=[],h;for(h=0;h<=b.length;h++)g[h]=[h];var k;for(k=0;k<=d.length;k++)g[0][k]=k;for(h=1;h<=b.length;h++)for(k=1;k<=d.length;k++)b.charAt(h-1)==d.charAt(k-1)?g[h][k]=g[h-1][k-1]:g[h][k]=Math.min(g[h-1][k-1]+c,Math.min(g[h][k-1]+e,g[h-1][k]+f));return g[b.length][d.length]}};"use strict";
CB.Form=function(){var d=function(b){this.config=b;this.inpH=26;this.buttonW=90;this.buttonH=30;this.theme="chessbase"};d.prototype.show=function(){$(this.nestDiv).css("display","block")};d.prototype.hide=function(){$(this.nestDiv).css("display","none")};d.prototype.isVisible=function(){return!$(this.nestDiv).is(":hidden")};d.prototype.create=function(b,c){$("#"+this.config.id).remove();this.nestDiv=$(String.f("<div id='{0}'></div>",this.config.id));this._createHtml(this.nestDiv);$(b).append(this.nestDiv);
    $(this.nestDiv).jqxWindow({width:this.config.width||400,height:this.config.height||400,isModal:this.config.modal,theme:this.theme,resizable:!1,autoOpen:!1,showCloseButton:!1});$(this.nestDiv).jqxWindow({initContent:function(){"undefined"===typeof this.config.noButtons&&($("#btnCancel").jqxButton({width:this.buttonW,height:this.buttonH,theme:this.theme}),$("#btnOk").jqxButton({width:this.buttonW,height:this.buttonH,theme:this.theme}));this.config.focusField&&$("#"+this.config.focusField).jqxInput("focus");
            $(this.nestDiv).keyup(function(b){13==b.keyCode&&$("#btnOk").click()})}.bind(this)});$(this.nestDiv).jqxWindow("cancelButton",$("#btnCancel"));$(this.nestDiv).jqxWindow("open");this.validator&&this.validator(this.nestDiv);$("#btnOk").click(function(b){b=!0;this.validator&&(b=$(this.nestDiv).jqxValidator("validate"));b&&(b=this._extractResults(),$(this.nestDiv).jqxWindow("hide"),$(this.nestDiv).remove(),this.config.okHandler&&this.config.okHandler(b))}.bind(this));$("#btnCancel")&&$("#btnCancel").click(function(b){$(this.nestDiv).jqxWindow("hide");
        $(this.nestDiv).remove();this.config.cancelHandler&&this.config.cancelHandler()}.bind(this));this.config.accountButton&&($("#btnAccount").jqxButton({width:this.buttonW,height:this.buttonH,theme:this.theme}),$("#btnAccount").on("click",function(b){V15.panelMgr.openRegisterPage()}));this.config.pasteButton&&($("#btnPaste").jqxButton({width:this.buttonW,height:this.buttonH,theme:this.theme}),$("#btnPaste").on("click",function(b){CB.System.isElectron()&&"undefined"!==typeof electronBridge&&(b=electronBridge.readFromClipboard().trim(),
    34<=b.length&&($("#idSerial0").val(b.substr(0,5)),$("#idSerial1").val(b.substr(6,5)),$("#idSerial2").val(b.substr(12,5)),$("#idSerial3").val(b.substr(18,5)),$("#idSerial4").val(b.substr(24,5))))}))};d.prototype.closeDialog=function(){$(this.nestDiv).jqxWindow("hide");$(this.nestDiv).remove()};d.prototype._extractResults=function(){var b={};this.config.fields.forEach(function(c){switch(c.type){case "number":case "password":case "string":case "stringmultiline":b[c.id]=$("#"+c.id).val();break;case "serial":for(var e=
    "",d=0;5>d;d++)e+=$("#"+c.id+d).val();b[c.id]=e;break;case "checkbox":b[c.id]=$("#"+c.id).jqxCheckBox("checked")}}.bind(this));return b};d.prototype._getButtonConfig=function(){return{imgHeight:32,imgWidth:32,theme:"chessbase"}};d.prototype._createHtml=function(b){var c=$("<div>"+this.config.title+"</div>");b.append(c);c=$(String.f("<div></div>"));var e=$("<table class='cbJqxFormTable'></table>");c.append(e);this.config.fields.forEach(function(b){var c=$("<tr></tr>");switch(b.type){case "label":b=
    $(String.f("<td align='right' class='cbJqxFormCaption'><h3 id='myLabel'>{0}</h3></td>",b.caption));c.append(b);this.label=b;break;case "separator":c.append($("<td colspan='2'><div class='cbJqxFormSeparator'/></td>"));break;case "progress":var d=$(String.f("<td align='right' class='cbJqxFormCaption'>{0}</td>",b.caption));c.append(d);d=$("<td align='left'></td>");var f=$(String.f("<div id='{0}'></div>",b.id));d.append(f);f.jqxProgressBar({width:300,height:this.config.checkBoxH||this.inpH,value:0,showText:!0});
    c.append(d);f.jqxProgressBar("animationDuration",0);f.jqxProgressBar("theme","shinyblack");f.jqxProgressBar("value",0);f.jqxProgressBar("colorRanges",[{stop:0,color:"#A00000"},{stop:100,color:"#00FF00"}]);this.progressBar=f;break;case "number":d=$(String.f("<td align='right' class='cbJqxFormCaption'>{0}</td>",b.caption));c.append(d);d=$("<td align='left'></td>");f=$(String.f("<input id='{0}'/>",b.id));d.append(f);f.jqxNumberInput({width:this.config.numInpW||60,height:this.config.inpH||this.inpH,min:b.min||
        0,max:b.max||999999999,theme:this.theme,decimalDigits:0,digits:2,inputMode:"simple",spinButtons:b.spin});b.val&&f.jqxNumberInput("val",b.val);c.append(d);break;case "string":d=$(String.f("<td align='right'>{0}</td>",b.caption));c.append(d);d=$("<td align='left'></td>");f=$(String.f("<input id='{0}'/>",b.id));d.append(f);f.jqxInput({width:this.config.strInpW||200,height:this.config.inpH||this.inpH,maxLength:this.config.maxLength||128,theme:this.theme});b.val&&f.jqxInput("val",b.val);c.append(d);break;
    case "serial":d=$(String.f("<td align='right'>{0}</td>",b.caption));c.append(d);d=$("<td align='left'></td>");for(var g=0;5>g;g++)f=$(String.f("<input id='{0}' style='text-transform: uppercase;' />",b.id+g)),d.append(f),f.jqxInput({width:80,height:this.config.inpH||this.inpH,minLength:5,maxLength:5,theme:this.theme}),b.val&&34<=b.val.length&&5>g&&f.jqxInput("val",b.val.substr(6*g,5)),d.append("-"),4==g&&d.append("DATA");c.append(d);break;case "stringmultiline":d=$(String.f("<td align='right'>{0}</td>",
        b.caption));c.append(d);d=$("<td align='center'></td>");f=$(String.f("<textarea id='{0}' rows='{1}' cols='{2}' maxlength='{3}'/>",b.id,b.rows,b.cols,b.maxLength));$(f).addClass("jqx-input jqx-widget jqx-widget-content");this.theme&&$(f).addClass(String.f("jqx-input-{0} jqx-widget-{0} jqx-widget-content-{0}",this.theme));d.append(f);b.val&&f.jqxInput("val",b.val);c.append(d);break;case "password":d=$(String.f("<td align='right'>{0}</td>",b.caption));c.append(d);d=$("<td align='left'></td>");f=$(String.f("<input id='{0}' type='password' />",
        b.id));d.append(f);f.jqxPasswordInput({width:this.config.strInpW||200,height:this.config.inpH||this.inpH,maxLength:128,theme:this.theme,placeHolder:"Enter password"});c.append(d);break;case "checkbox":d=$(String.f("<td align='right' class='cbJqxFormCaption'>{0}</td>",b.caption)),c.append(d),d=$("<td align='left'></td>"),f=$(String.f("<div id='{0}'></div>",b.id)),d.append(f),f.jqxCheckBox({width:this.config.checkBoxW||120,height:this.config.checkBoxH||this.inpH,theme:this.theme,checked:b.checked}),
        c.append(d)}e.append(c)}.bind(this));var d=$("<tr></tr>");e.append($("<tr><td></td></tr>"));d.append($("<td align='right'></td>"));if(this.config.pasteButton){var g=$("<tr></tr>");g.append($("<td colspan='2' align='left' style='padding-top: 16px'><input type='button' id='btnPaste' value='"+lm.PASTE+"' /></td>"));e.append(g)}this.progressBar||d.append($(String.f('<td style="padding-top: 10px;" align="right"><input style="margin-right: 5px;" type="button" id="btnOk" value="OK" /><input id="btnCancel" type="button" value="{0}" /></td>',
    lm.CANCEL)));e.append(d);this.config.accountButton&&(e.append($("<tr><td></td></tr>")),d=$("<tr></tr>"),d.append($("<td colspan='2' align='left' style='padding-top: 16px'><input type='button' id='btnAccount' value='Register' /></td>")),e.append(d));b.append(c)};d.prototype._getImgSrc=function(b){var c=V15.config.getRibbonPath();this.config.iconPath&&(c+=this.config.iconPath+"/");c=c+b+(this.config.iconHeight||32);return c+".png"};d.inputString=function(b,c,e,d,g,h){(new CB.Form({id:"inputString",
    title:b,width:300,height:180,modal:!0,okHandler:g,cancelHandler:h,fields:[{caption:c,type:"string",id:"idInput",strInpW:160,maxLength:d,val:e}]})).create()};return d}();CB.LOG=function(){return function(d){}}();"use strict";CB.namespace("CB.Localization");var glLoc,lm;
CB.Localization=function(){return function(d){this.locObjects=[].concat(d);lm=this.locObjects[0];for(d=1;d<this.locObjects.length;d++){var b=this.locObjects[d];for(c in b)b.hasOwnProperty(c)&&(lm[c]=b[c])}var c=ObjUtil.clone(CB.V1);c.arrStrPieces[CB.Piece.W_KING]=c.arrStrPieces[CB.Piece.B_KING]=lm.NOTATION_KING;c.arrStrPieces[CB.Piece.W_QUEEN]=c.arrStrPieces[CB.Piece.B_QUEEN]=lm.NOTATION_QUEEN;c.arrStrPieces[CB.Piece.W_ROOK]=c.arrStrPieces[CB.Piece.B_ROOK]=lm.NOTATION_ROOK;c.arrStrPieces[CB.Piece.W_BISHOP]=
    c.arrStrPieces[CB.Piece.B_BISHOP]=lm.NOTATION_BISHOP;c.arrStrPieces[CB.Piece.W_KNIGHT]=c.arrStrPieces[CB.Piece.B_KNIGHT]=lm.NOTATION_KNIGHT;c.arrStrPieces[CB.Piece.W_PAWN]=c.arrStrPieces[CB.Piece.B_PAWN]="";lm.NOTA_LOCALIZATION=c}}();"use strict";CB.namespace("CB.Loc.Chess.ENG");
CB.Loc.Chess.ENG={LOGIN:"Log in",LOGOUT:"Log out",ACCOUNT:"My Account",BOARDS:"Boards",RECONNECT:"Reconnect",RESIGN:"Resign",CLOSE_BOARD:"Close Board",OFFER_DRAW:"Offer Draw",ACCEPT_DRAW:"Accept Draw",ACCEPTED_DRAW:"{0} accepted a draw.",OFFERS_DRAW:"{0} offers a draw.",ACCEPTS_DRAW:"{0} accepts a draw.",RESIGNS:"{0} resigns.",TESTING_CONN:"Testing Connection to Server",CONNECTING:"Connecting to server, please wait...",RECONNECTED_OK:"Reconnected OK",NAME:"Name",NATION:"Country",RANK:"Rank",WHITE:"White",
    BLACK:"Black",ELO_WHITE:"Elo White",ELO_BLACK:"Elo Black",RESULT:"Result",TIME_CONTROL:"Time Control",TOURNAMENT:"Tournament",GAMES:"Games",CHAT:"Chat",CHAT_PARTNER_GONE:"Your chat partner is gone.",CONNECTION:"Connection",MAP:"Map",KING:"King",QUEEN:"Queen",ROOK:"Rook",BISHOP:"Bishop",KNIGHT:"Knight",PAWN:"Pawn",TYPE_CHAT_HERE:"Type Chat Here",TYPE_HERE_TO_CHAT_WITH:"Type Here To Chat With",GUEST:"Guest",CONFIRM:"Confirm",CANCEL:"Cancel",CLOCK:"Clock",TIME:"Time",GAIN_PER_MOVE:"Gain per Move",CLOSE:"Close",
    ADD:"Add",REMOVE:"Remove",NOTATION:"Notation",BOARD_FRITZ:"Fritz",BOARD_CRYSTALS:"Crystals",BOARD_USCF:"USCF",BOARD_OLDSTYLE:"OldStyle",BOARD_HABSBURG:"Habsburg",BOARD_FRITZ_AND_CHESTER:"Fritz & Chesster",PLAY_BLITZ:"Play Blitz",NEW_GAME:"New Game",TAKE_BACK:"Take Back",MAKE_MOVE:"Make Move",FLIP_BOARD:"Flip Board",COPY:"Copy",SEARCH_BOARD:"Search Board",YEAR:"Year",BOOK:"Book",LIVE_BOOK:"Live Book",MOVE:"Move",NR_GAMES:"Nr Games",SCORE:"Score",LAST_PLAYED:"Last Played",ELO_AVG:"Elo Avg.",VISITS:"Visits",
    LOADING_STATISTICS:"Loading statistics",LETS_CHECK:"Let's Check",EVAL:"Eval",VARIATION:"Variation",DEPTH:"Depth",ENGINE:"Engine",ENTER_YOUR_SEARCH_TEXT:"Enter your search text...",RETRIEVING_GAMES:"Retrieving games",PLAYER_DETAILS:"Player details",PLAYER_INFORMATION:"Player information",FIRST_NAME:"First Name",LAST_NAME:"Last Name",YEAR_OF_BIRTH:"Year of Birth",TREND:"Trend",RATING:"Rating",SEND_FEEDBACK:"Send Feedback",YOUR_COMMENT:"Your Comment",YOUR_EMAIL_ADDRESS:"Your E-mail Address",SEND:"Send",
    BROWSER_DOESNT_SUPPORT_3D:"Browser does not support 3d boards",BOARD3D_FRITZ:"Fritz",BOARD3D_MODERN:"Modern",BOARD3D_ROOM:"Room",BOARD3D_BALLOON:"Balloon",BOARD3D_METAL:"Metal",BOARD3D_SILVER:"Silver",BOARD3D_FUTURE:"Future",BOARD3D_MARBLE:"Marble",WELCOME:"Welcome",MATERIAL:"Material",ANALYSIS:"Analysis",ANALYSIS_ENGINE:"Engine",ENG_SEARCH_INFO_FMT:"Depth {0}/{1}, Speed = {2}kPos/s, Time = {3}s",PASTE:"Paste",PW_INVALID:"<bold>User/Password invalid, please try again</bold>",PLEASE_LOGIN:"Please log in with your ChessBase (Playchess) account:",
    ACCOUNTNAME:"Name",PASSWORD:"Password",CREATE_ACCOUNT:"Create Account",LOGIN_GUEST:"Guest",PLEASE_LOGIN_SHORT:"Please Log In",LOADING_ENGINE:"Loading Engine...",LOADING_LIVE_GAMES:"Loading Live Games ...",INVITING_OTHER_PLAYERS:"Inviting other players to a game of {0} ({1})",OTHER_TOOLS:"More Apps",DATABASES:"Databases",OPEN_DATABASE:"Open Database",CREATE_DATABASE:"Create Database",DELETE_DATABASE:"Delete Database",DELETE:"Delete",CLEAN_UP:"Clean Up",MY_DATABASES:"My Databases",DATABASES_SHARED_WITH_ME:"Databases shared with me",
    SELECT_DATABASE_FOR_USER:"Select Database For '{0}'",OPEN_PGN:"Open PGN",SAVE:"Save",SAVE_AND_REPLACE_GAMES:"Save and replace games",SAVE_AS_NEW:"Save As New",EDIT_GAME:"Edit Game",DATABASE_FUNCTIONS:"Open, create and delete databases",TEXT_BEFORE:"Text Before",TEXT_AFTER:"Text",START_LINE:"Start Line",PROMOTE_LINE:"Promote Line",DELETE_LINE:"Delete Line",CUT_LINE:"Cut Line",OPEN_PGN_TIP:"Open a PGN file from your computer",TEXT_BEFORE_TIP:"Add a text annotation before this move",TEXT_AFTER_TIP:"Add a text annotation after this move",
    START_LINE_TIP:"Retract current move and start a line",PROMOTE_LINE_TIP:"Promote the currently selected line",DELETE_LINE_TIP:"Delete the selected line",CUT_LINE_TIP:"Cut off the following moves",STAY_LOGGED_IN:"Stay Logged In",FORGOT_PASSWORD:"Forgot Password",CHANGE_PASSWORD:"Change Password",OLD_PASSWORD:"Old Password",NEW_PASSWORD:"New Password",CONFIRM_PASSWORD:"Confirm Password",MENU_PLAYCHESS_TOOL:"Play & Watch",MENU_DATABASE_TOOL:"Live Database",MENU_MYGAMES_TOOL:"My Own Games",MENU_FRITZ_TOOL:"Chess Program Fritz",
    MENU_FRITZ_CHESSTER_TOOL:"Chess For Kids",MENU_TACTICS_TOOL:"Tactics Training",LANGUAGE:"Language",LOGIN_CREATE_LINK:"Click here to create an account",LOGIN_PLEASE_LOGIN:"Please Log In",LOGIN_ACCOUNT_FREE:"Creating an account is free. The account is valid for all other ChessBase Web Tools and for play.chessbase.com.",LOGIN_WELCOME:"Welcome, {0}",MANAGE_FRIENDS:"Manage friends",INVITE_FRIEND:"Invite a friend",PING:"Ping",NOTATION_KING:"K",NOTATION_QUEEN:"Q",NOTATION_KNIGHT:"N",NOTATION_BISHOP:"B",
    NOTATION_ROOK:"R",NOTATION_PAWN:"P",GENERAL_INVITE:'Thank you for using the <span style="font-weight:bold">{0}</span>.',MYGAMES_INVITE:'Thank you for using <span style="font-weight:bold">ChessBase MyGames</span>, your personal chess database in the web.',MYGAMES_FUNCTIONALITY:"Please login with your ChessBase Account to create and access your cloud chess databases. You can also use the cloud databases with ChessBase 13.",ECO:"ECO",BACK:"Back",NEXT_MOVE:"Next Move",PREV_MOVE:"Previous Move",NEXT_GAME:"Next Game",
    PREV_GAME:"Previous Game",MENU_VIDEO_TOOL:"Training Videos",MENU_OPENINGS_TOOL:"Manage Openings",REQUESTING_MOVES:"Requesting Moves",FRESH_POSITION:"Fresh Position",EMBED:"Embed",HELP:"Help",TOGGLE_3D_2D:"Toggle 2D/3D Board",BOARD3D_BLACKWHITE:"Black white",MATE:"Mate",STALEMATE:"Stalemate",SETUP_POSITION:"Setup Position",WHITE_MATES:"White mates",WHITE_CLEARLY_WINNING:"White is clearly winning",WHITE_WINNING:"White is winning",WHITE_DECISIVE:"White has a decisive advantage",WHITE_CLEARLY_BETTER:"White is clearly better",
    WHITE_BETTER:"White is better",WHITE_SLIGHTLY:"White is slightly better",WHITE_EDGE:"White is minimally better",BLACK_MATES:"Black mates",BLACK_CLEARLY_WINNING:"Black is clearly winning",BLACK_WINNING:"Black is winning",BLACK_DECISIVE:"Black has a decisive advantage",BLACK_CLEARLY_BETTER:"Black is clearly better",BLACK_BETTER:"Black is better",BLACK_SLIGHTLY:"Black is slightly better",BLACK_EDGE:"Black is minimally better",EQUAL_POS:"The position is equal",PREMIUM_ONLY:"Premium Only",BOARD3D_CHARACTER:"Avatar",
    CALC_TRAINING:"Assisted Calculation",TTIP_CALC_TRAINING:"Calculate variations with Fritz' assistance before you continue the game here.",CALC_INFO:"Enter moves blindly. Click in the notation to add variations anywhere. Right-click unveils current position. Click 'Assisted Calculation' to resume your game.",CALCULATING:"Calculating...",WOOD:"Wood",TRAINING_SOLUTION:"Show Solution",TRAINING_HELP:"Get Help",TRAINING_QUESTION:"Find the correct move",UNANNOTATE:"Unannotate",MORE_LINES:"More Lines",LESS_LINES:"Less Lines",
    CALCULATE_THREAT:"Calculate Threat",START_RADIO:"Start",PAUSE_RADIO:"Pause",CURRENTLY_NO_LIVE_BROADCAST:"At the moment there\u2019s no live broadcast",CONNECTED_TO_SERVER:"Connected to server: {0}",INITIALIZING:"Initializing",INSERT_DIAGRAM:"Insert Diagram",BOARD:"Board",LOADING_BOARD:"Loading board, just a second...",LIKE:"Like",DB_NOGAMES_FOUND:"No games found for this position and search string.",YOUR_KING_ACC:"your king",YOUR_QUEEN_ACC:"your queen",YOUR_KNIGHT_ACC:"your knight",YOUR_BISHOP_ACC:"your bishop",
    YOUR_ROOK_ACC:"your rook",YOUR_PAWN_ACC:"your pawn",MOVE_IMP:"Move",WHITES_MOVE:"White's move",BLACKS_MOVE:"Black's move",CLICK_TO_FLIP_BOARD:"click to flip board",MAXIMIZE:"Maximize",PIECES:"Pieces",SOUND_ONOFF:"Sound On/Off",GOTO_BEGIN:"Goto Begin",GOTO_END:"Goto End",LOAD_PREV:"Load Prev.",LOAD_NEXT:"Load Next",SEARCH_MATERIAL:"Search Material"};"use strict";CB.namespace("CB.Loc.Chess.GER");
CB.Loc.Chess.GER={LOGIN:"Anmelden",LOGOUT:"Abmelden",ACCOUNT:"Mein Konto",BOARDS:"Bretter",RECONNECT:"Verbinden",RESIGN:"Aufgeben",CLOSE_BOARD:"Brett schlie\u00dfen",OFFER_DRAW:"Remis bieten",ACCEPT_DRAW:"Remis akzeptieren",ACCEPTED_DRAW:"{0} hat das Remis angenommen.",OFFERS_DRAW:"{0} bietet Remis.",ACCEPTS_DRAW:"{0} nimmt Remis an.",RESIGNS:"{0} gibt auf.",TESTING_CONN:"Test Verbindung zum Server",CONNECTING:"Verbindung wird aufgebaut, einen Moment...",RECONNECTED_OK:"Verbindung wiederhergestellt",
    NAME:"Name",NATION:"Land",RANK:"Rang",WHITE:"Weiss",BLACK:"Schwarz",ELO_WHITE:"Elo Weiss",ELO_BLACK:"Elo Schwarz",RESULT:"Ergebnis",TIME_CONTROL:"Bedenkzeit",TOURNAMENT:"Turnier",GAMES:"Partien",CHAT:"Chat",CHAT_PARTNER_GONE:"Ihr Chat Partner ist gegangen.",CONNECTION:"Verbindung",MAP:"Karte",KING:"K\u00f6nig",QUEEN:"Dame",ROOK:"Turm",BISHOP:"L\u00e4ufer",KNIGHT:"Springer",PAWN:"Bauer",TYPE_CHAT_HERE:"Chat hier eingeben",TYPE_HERE_TO_CHAT_WITH:"Hier tippen f\u00fcr Chat an",GUEST:"Gast",CONFIRM:"Best\u00e4tigen",
    CANCEL:"Abbruch",CLOCK:"Uhr",TIME:"Time",GAIN_PER_MOVE:"Gain per Move",CLOSE:"Close",ADD:"Add",REMOVE:"Remove",NOTATION:"Notation",BOARD_FRITZ:"Fritz",BOARD_CRYSTALS:"Crystals",BOARD_USCF:"USCF",BOARD_OLDSTYLE:"OldStyle",BOARD_HABSBURG:"Habsburg",BOARD_FRITZ_AND_CHESTER:"Fritz & Fertig",PLAY_BLITZ:"Blitzpartie",NEW_GAME:"Neue Partie",TAKE_BACK:"Zug zur\u00fcck",MAKE_MOVE:"Zug vor",FLIP_BOARD:"Brett drehen",COPY:"Kopieren",SEARCH_BOARD:"Brett suchen",YEAR:"Jahr",BOOK:"Buch",LIVE_BOOK:"Live Buch",MOVE:"Zug",
    NR_GAMES:"Nr Games",SCORE:"Score",LAST_PLAYED:"Zuletzt gespielt",ELO_AVG:"Elo Avg.",VISITS:"Besuche",LOADING_STATISTICS:"L\u00e4dt Statistiken",LETS_CHECK:"Let's Check",EVAL:"Eval",VARIATION:"Variation",DEPTH:"Tiefe",ENGINE:"Engine",ENTER_YOUR_SEARCH_TEXT:"Suchtext hier eingeben...",RETRIEVING_GAMES:"Lade Partien",PLAYER_DETAILS:"Spieler Details",PLAYER_INFORMATION:"Spieler Information",FIRST_NAME:"Vorname",LAST_NAME:"Nachname",YEAR_OF_BIRTH:"Geburtsjahr",TREND:"Trend",RATING:"Rating",SEND_FEEDBACK:"Feedback senden",
    YOUR_COMMENT:"Ihr Hinweis",YOUR_EMAIL_ADDRESS:"Ihre E-Mail-Adresse",SEND:"Absenden",BROWSER_DOESNT_SUPPORT_3D:"Ihr Browser unterst\u00fctzt noch kein 3D",BOARD3D_FRITZ:"Fritz",BOARD3D_MODERN:"Modern",BOARD3D_ROOM:"Room",BOARD3D_BALLOON:"Balloon",BOARD3D_METAL:"Metal",BOARD3D_SILVER:"Silver",BOARD3D_FUTURE:"Future",BOARD3D_MARBLE:"Marble",WELCOME:"Willkommen",MATERIAL:"Material",ANALYSIS:"Analyse",ANALYSIS_ENGINE:"Engine",ENG_SEARCH_INFO_FMT:"Tiefe {0}/{1}, {2}Tsd Pos/s, Zeit = {3}s",PASTE:"Einf\u00fcgen",
    PW_INVALID:'Account <em>"{0}"</em> oder Passwort nicht erkannt.',PLEASE_LOGIN:"Anmelden mit ChessBase (Playchess) Konto:",ACCOUNTNAME:"Name",PASSWORD:"Passwort",CREATE_ACCOUNT:"Konto neu anlegen",LOGIN_GUEST:"Gast",PLEASE_LOGIN_SHORT:"Bitte anmelden",LOADING_ENGINE:"Lade Engine...",LOADING_LIVE_GAMES:"Lade Live Partien ...",INVITING_OTHER_PLAYERS:"Inviting other players to a game of {0} ({1})",OTHER_TOOLS:"Weitere Apps",DATABASES:"Datenbanken",OPEN_DATABASE:"Datenbank \u00f6ffnen",CREATE_DATABASE:"Neue Datenbank",
    DELETE_DATABASE:"Datenbank l\u00f6schen",DELETE:"L\u00f6schen",CLEAN_UP:"Aufr\u00e4umen",MY_DATABASES:"Meine Datenbanken",DATABASES_SHARED_WITH_ME:"Mit mir geteilt",SELECT_DATABASE_FOR_USER:"Datenbankauswahl f\u00fcr '{0}'",OPEN_PGN:"PGN \u00d6ffnen",SAVE:"Speichern",SAVE_AND_REPLACE_GAMES:"Partien speichern und ersetzen",SAVE_AS_NEW:"Neue Version speichern",EDIT_GAME:"Kenndaten setzen",DATABASE_FUNCTIONS:"Datenbanken \u00f6ffnen, anlegen und l\u00f6schen",TEXT_BEFORE:"Text vor Zug",TEXT_AFTER:"Text",
    START_LINE:"Variante",PROMOTE_LINE:"Aufwerten",DELETE_LINE:"L\u00f6schen",CUT_LINE:"Schneiden",OPEN_PGN_TIP:"PGN-Datei von Ihrem Computer \u00f6ffnen",TEXT_BEFORE_TIP:"Textkommentar vor diesem Zug",TEXT_AFTER_TIP:"Textkommentar nach diesem Zug",START_LINE_TIP:"Zug zur\u00fccknehmen und Variante starten",PROMOTE_LINE_TIP:"Ausgew\u00e4hlte Variante wird Hauptvariante",DELETE_LINE_TIP:"Ausgew\u00e4hlte Variante l\u00f6schen",CUT_LINE_TIP:"Nachfolgende Z\u00fcge wegschneiden",STAY_LOGGED_IN:"Angemeldet bleiben",
    FORGOT_PASSWORD:"Passwort vergessen",CHANGE_PASSWORD:"Passwort \u00e4ndern",OLD_PASSWORD:"Altes Passwort",NEW_PASSWORD:"Neues Passwort",CONFIRM_PASSWORD:"Passwort best\u00e4tigen",MENU_PLAYCHESS_TOOL:"Spielen & Zuschauen",MENU_DATABASE_TOOL:"Live Datenbank",MENU_MYGAMES_TOOL:"Meine Partien",MENU_FRITZ_TOOL:"Schachprogramm Fritz",MENU_FRITZ_CHESSTER_TOOL:"Fritz & Fertig f\u00fcr Kinder",MENU_TACTICS_TOOL:"Taktiktraining",LANGUAGE:"Sprache",LOGIN_CREATE_LINK:"Hier klicken, um Account anzulegen",LOGIN_PLEASE_LOGIN:"Bitte anmelden",
    LOGIN_ACCOUNT_FREE:"Ein ChessBase Account ist kostenlos und gilt f\u00fcr alle ChessBase Web Tools und f\u00fcr www.schach.de.",LOGIN_WELCOME:"Willkommen, {0}",MANAGE_FRIENDS:"Freunde verwalten",INVITE_FRIEND:"Einen Freund einladen",PING:"Ping",NOTATION_KING:"K",NOTATION_QUEEN:"D",NOTATION_KNIGHT:"S",NOTATION_BISHOP:"L",NOTATION_ROOK:"T",NOTATION_PAWN:"",GENERAL_INVITE:'Danke f\u00fcr den Einsatz von <span style="font-weight:bold">{0}</span>.',MYGAMES_INVITE:'Danke f\u00fcr den Einsatz von <span style="font-weight:bold">ChessBase MyGames</span>, ihrer pers\u00f6nlichen Schachdatenbank im Web.',
    MYGAMES_FUNCTIONALITY:"Mit Ihrem ChessBase Account k\u00f6nnen Sie Clouddatenbanken f\u00fcr Schachpartien anlegen und verwalten. Diese Clouddatenbanken stehen auch unter ChessBase 13 zur Verf\u00fcgung.",ECO:"ECO",BACK:"Zur\u00fcck",NEXT_MOVE:"Next Move",PREV_MOVE:"Previous Move",NEXT_GAME:"Next Game",PREV_GAME:"Previous Game",MENU_VIDEO_TOOL:"Videotraining",MENU_OPENINGS_TOOL:"Er\u00f6ffnungen verwalten",REQUESTING_MOVES:"Z\u00fcge anfordern",FRESH_POSITION:"Frische Stellung",EMBED:"Teilen",HELP:"Hilfe",
    TOGGLE_3D_2D:"2D/3D Brett umschalten",BOARD3D_BLACKWHITE:"Schwarzweiss",MATE:"Matt",STALEMATE:"Patt",SETUP_POSITION:"Stellung aufbauen",WHITE_MATES:"Weiss setzt Matt",WHITE_CLEARLY_WINNING:"Weiss steht v\u00f6llig auf Gewinn",WHITE_WINNING:"Weiss steht auf Gewinn",WHITE_DECISIVE:"Weiss hat gro\u00dfen Vorteil",WHITE_CLEARLY_BETTER:"Weiss steht deutlich besser",WHITE_BETTER:"Weiss steht besser",WHITE_SLIGHTLY:"Weiss steht etwas besser",WHITE_EDGE:"Weiss steht minimal besser",BLACK_MATES:"Schwarz setzt Matt",
    BLACK_CLEARLY_WINNING:"Schwarz steht v\u00f6llig auf Gewinn",BLACK_WINNING:"Schwarz steht auf Gewinn",BLACK_DECISIVE:"Schwarz hat gro\u00dfen Vorteil",BLACK_CLEARLY_BETTER:"Schwarz steht deutlich besser",BLACK_BETTER:"Schwarz steht besser",BLACK_SLIGHTLY:"Schwarz steht etwas besser",BLACK_EDGE:"Schwarz steht minimal besser",EQUAL_POS:"Die Stellung ist ausgeglichen",PREMIUM_ONLY:"Nur bei Premium",BOARD3D_CHARACTER:"Avatar",CALC_TRAINING:"Rechentraining",TTIP_CALC_TRAINING:"Berechnen Sie beliebige (gepr\u00fcfte) Varianten bevor Sie die Partie hier fortsetzen.",
    CALC_INFO:"F\u00fchren Sie Z\u00fcge blind aus. Klicken Sie in die Notation, um Varianten hinzuzuf\u00fcgen. Rechtsklick zeigt wahre Stellung. Klick auf 'Rechentraining' setzt die Partie fort.",TRAINING_SOLUTION:"L\u00f6sung zeigen",TRAINING_HELP:"Hilfestellung",TRAINING_QUESTION:"Finde den richtigen Zug",UNANNOTATE:"Entkommentieren",MORE_LINES:"Mehr Varianten",LESS_LINES:"Weniger Varianten",CALCULATE_THREAT:"Drohung berechnen",START_RADIO:"Start",PAUSE_RADIO:"Pause",CURRENTLY_NO_LIVE_BROADCAST:"Im Augenblick l\u00e4uft keine Live\u00fcbertragung",
    CONNECTED_TO_SERVER:"Verbunden: {0}",INITIALIZING:"Initialisiere",INSERT_DIAGRAM:"Diagramm einf\u00fcgen",BOARD:"Brett",LOADING_BOARD:"Brett wird geladen, eine Sekunde...",LIKE:"Like",DB_NOGAMES_FOUND:"Keine Partien mit diesem Suchtext und diesem Brett.",YOUR_KING_ACC:"Deinen K\u00f6nig",YOUR_QUEEN_ACC:"Deine Dame",YOUR_ROOK_ACC:"Deinen Turm",YOUR_BISHOP_ACC:"Deinen L\u00e4ufer",YOUR_KNIGHT_ACC:"Deinen Springer",YOUR_PAWN_ACC:"Deinen Bauern",MOVE_IMP:"Ziehe",WHITES_MOVE:"Wei\u00df am zug",BLACKS_MOVE:"Schwarz am zug",
    CLICK_TO_FLIP_BOARD:"Klicke hier, um das brett zu drehen",MAXIMIZE:"Maximieren",PIECES:"Figuren",SOUND_ONOFF:"Ton An/Aus",GOTO_BEGIN:"Gehe zur Anfangsstellung",GOTO_END:"Gehe zur Endstellung",LOAD_PREV:"Vorherigen Zug",LOAD_NEXT:"N\u00e4chsten Zug",SEARCH_MATERIAL:"Search Material"};CB.Loc.Chess.DEU=CB.Loc.Chess.GER;"use strict";CB.namespace("CB.Loc.Chess.ESP");
CB.Loc.Chess.ESP={LOGIN:"Conectar",LOGOUT:"Cerrar sesi\u00f3n",ACCOUNT:"Mi cuenta",BOARDS:"Tablero",RECONNECT:"Reconectar",RESIGN:"Rendirse",CLOSE_BOARD:"Cerrar tablero",OFFER_DRAW:"Ofrecer tablas",ACCEPT_DRAW:"Aceptar tablas",ACCEPTED_DRAW:"{0} acept\u00f3 tablas.",OFFERS_DRAW:"{0} ofrece tablas.",ACCEPTS_DRAW:"{0} acepta tablas.",RESIGNS:"{0} se rinde.",TESTING_CONN:"Probando la conexi\u00f3n con el servidor",CONNECTING:"Conectando con el servidor, por favor espere...",RECONNECTED_OK:"Reconectado",
    NAME:"Nombre",NATION:"Pa\u00eds",RANK:"Rango",WHITE:"Blancas",BLACK:"Negras",ELO_WHITE:"Elo blancas",ELO_BLACK:"Elo negras",RESULT:"Resultado",TIME_CONTROL:"Control de tiempo",TOURNAMENT:"Torneo",GAMES:"Partidas",CHAT:"Charla",CHAT_PARTNER_GONE:"Su interlocutor se ha ido.",CONNECTION:"Conexi\u00f3n",MAP:"Mapa",KING:"Rey",QUEEN:"Dama",ROOK:"Torre",BISHOP:"Alfil",KNIGHT:"Caballo",PAWN:"Pe\u00f3n",TYPE_CHAT_HERE:"Escriba aqu\u00ed la charla",TYPE_HERE_TO_CHAT_WITH:"Escriba aqu\u00ed con quien quiere charlar",
    GUEST:"Invitado",CONFIRM:"Confirmar",CANCEL:"Cancelar",CLOCK:"Reloj",TIME:"Tiempo",GAIN_PER_MOVE:"Incr. por mov.",CLOSE:"Cerrar",ADD:"A\u00f1adir",REMOVE:"Quitar",NOTATION:"Notaci\u00f3n",BOARD_FRITZ:"Fritz",BOARD_CRYSTALS:"Crystals",BOARD_USCF:"USCF",BOARD_OLDSTYLE:"OldStyle",BOARD_HABSBURG:"Habsburg",BOARD_FRITZ_AND_CHESTER:"Fritz & Chesster",PLAY_BLITZ:"Jugar blitz",NEW_GAME:"Nueva partida",TAKE_BACK:"Retroceder",MAKE_MOVE:"Jugar",FLIP_BOARD:"Girar tablero",COPY:"Copiar",SEARCH_BOARD:"Buscar tablero",
    YEAR:"A\u00f1o",BOOK:"Libro",LIVE_BOOK:"Live Book",MOVE:"Jugada",NR_GAMES:"Partidas",SCORE:"Marcador",LAST_PLAYED:"\u00daltima vez",ELO_AVG:"Elo medio",VISITS:"Visitas",LOADING_STATISTICS:"Cargando estad\u00edsticas",LETS_CHECK:"Let's Check",EVAL:"Eval.",VARIATION:"Variante",DEPTH:"Prof.",ENGINE:"M\u00f3dulo",ENTER_YOUR_SEARCH_TEXT:"Escriba el texto a buscar...",RETRIEVING_GAMES:"Obtener partidas",PLAYER_DETAILS:"Datos del jugador",PLAYER_INFORMATION:"Informaci\u00f3n del jugador",FIRST_NAME:"Nombre",
    LAST_NAME:"Apellidos",YEAR_OF_BIRTH:"Nacido en",TREND:"Tendencia",RATING:"Elo",SEND_FEEDBACK:"Enviar comentario",YOUR_COMMENT:"Su comentario",YOUR_EMAIL_ADDRESS:"Su e-mail",SEND:"Enviado",BROWSER_DOESNT_SUPPORT_3D:"El navegador no admite tableros 3D",BOARD3D_FRITZ:"Fritz",BOARD3D_MODERN:"Moderno",BOARD3D_ROOM:"Habitaci\u00f3n",BOARD3D_BALLOON:"Globos",BOARD3D_METAL:"Metal",BOARD3D_SILVER:"Plata",BOARD3D_FUTURE:"Futuro",BOARD3D_MARBLE:"M\u00e1rmol",WELCOME:"Bienvenido",MATERIAL:"Material",ANALYSIS:"An\u00e1lisis",
    ANALYSIS_ENGINE:"M\u00f3dulo",ENG_SEARCH_INFO_FMT:"Prof {0}/{1}, {2}kPos/s, tiempo = {3}s",PASTE:"Pegar",PW_INVALID:"Usuario/Contrase\u00f1a no v\u00e1lido. Por favor, vuelva a intentarlo",PLEASE_LOGIN:"Por favor conecte con su cuenta ChessBase (Playchess):",ACCOUNTNAME:"Nombre",PASSWORD:"Contrase\u00f1a",CREATE_ACCOUNT:"Crear cuenta",LOGIN_GUEST:"Invitado",PLEASE_LOGIN_SHORT:"Por favor, identif\u00edquese",LOADING_ENGINE:"Cargando m\u00f3dulo...",LOADING_LIVE_GAMES:"Cargando partidas en directo...",
    INVITING_OTHER_PLAYERS:"Invitando a otros jugadores a una partida de {0} ({1})",OTHER_TOOLS:"M\u00e1s herramientas",DATABASES:"Bases de datos",OPEN_DATABASE:"Abrir base",CREATE_DATABASE:"Crear base",DELETE_DATABASE:"Borrar base",DELETE:"Borrar",CLEAN_UP:"Limpiar",MY_DATABASES:"Mis bases",DATABASES_SHARED_WITH_ME:"Bases compartidas conmigo",SELECT_DATABASE_FOR_USER:"Seleccionar base para '{0}'",OPEN_PGN:"Abrir PGN",SAVE:"Guardar",SAVE_AND_REPLACE_GAMES:"Guardar y reemplazar partidas",SAVE_AS_NEW:"Guardar como nueva",
    EDIT_GAME:"Editar partida",DATABASE_FUNCTIONS:"Abrir, crear y y borrar bases",TEXT_BEFORE:"Texto antes",TEXT_AFTER:"Texto despu\u00e9s",START_LINE:"Iniciar l\u00ednea",PROMOTE_LINE:"Promocionar l\u00ednea",DELETE_LINE:"Borrar l\u00ednea",CUT_LINE:"Cortar l\u00ednea",OPEN_PGN_TIP:"Abrir un archivo PGN de su equipo",TEXT_BEFORE_TIP:"A\u00f1adir comentario en forma de texto antes de esta jugada",TEXT_AFTER_TIP:" A\u00f1adir comentario en forma de texto tras esta jugada",START_LINE_TIP:"Retroceder la jugada y comenzar una variante",
    PROMOTE_LINE_TIP:"Subir de nivel la variante seleccionada",DELETE_LINE_TIP:"Borrar la variante seleccionada",CUT_LINE_TIP:"Truncar la variante",STAY_LOGGED_IN:"Seguir conectado",FORGOT_PASSWORD:"Contrase\u00f1a olvidada",CHANGE_PASSWORD:"Cambiar contrase\u00f1a",OLD_PASSWORD:"Contrase\u00f1a antigua",NEW_PASSWORD:"Contrase\u00f1a nueva",CONFIRM_PASSWORD:"Confirmar contrase\u00f1a",MENU_PLAYCHESS_TOOL:"Playchess",MENU_DATABASE_TOOL:"Live Database",MENU_MYGAMES_TOOL:"My Games Cloud",MENU_FRITZ_TOOL:"Fritz Online",
    MENU_FRITZ_CHESSTER_TOOL:"Chess For Kids",MENU_TACTICS_TOOL:"Tactics Training",LANGUAGE:"Idioma",LOGIN_CREATE_LINK:"Haga clic aqu\u00ed para crear una cuenta",LOGIN_PLEASE_LOGIN:"Por favor identif\u00edquese",LOGIN_ACCOUNT_FREE:"La creaci\u00f3n de una cuenta es gratis. La cuenta vale para todas las dem\u00e1s herramientas web de ChessBase y para jugar en www.playchess.com.",LOGIN_WELCOME:"Bienvenido {0}",MANAGE_FRIENDS:"Gestionar amigos",INVITE_FRIEND:"Invitar a un amigo",PING:"Ping",NOTATION_KING:"R",
    NOTATION_QUEEN:"D",NOTATION_KNIGHT:"C",NOTATION_BISHOP:"A",NOTATION_ROOK:"T",NOTATION_PAWN:"P",GENERAL_INVITE:"Gracias por usar {0}.",MYGAMES_INVITE:"Gracias por usar ChessBase MyGames, su base de datos de ajedrez personal en la web.",MYGAMES_FUNCTIONALITY:"Por favor con\u00e9ctese con su cuenta ChessBase para tener acceso a sus bases de datos en la nube. Tambi\u00e9n puede usar las bases de datos en la nube con ChessBase 13.",ECO:"ECO",BACK:"Volver",NEXT_MOVE:"Siguiente jug.",PREV_MOVE:"Anterior jug.",
    NEXT_GAME:"Siguiente part.",PREV_GAME:"Anterior part.",MENU_VIDEO_TOOL:"V\u00eddeos de entrenamiento",MENU_OPENINGS_TOOL:"Gestionar aperturas",REQUESTING_MOVES:"Requesting Moves",FRESH_POSITION:"Fresh Position",EMBED:"Embed",HELP:"Help",TOGGLE_3D_2D:"Toggle 2D/3D Board",BOARD3D_BLACKWHITE:"Black white",MATE:"Mate",STALEMATE:"Ahogado",SETUP_POSITION:"Armar posici\u00f3n",WHITE_MATES:"Las blancas dan mate",WHITE_CLEARLY_WINNING:"Las blancas tienen clara ventaja ganadora",WHITE_WINNING:"Las blancas tienen ventaja ganadora",
    WHITE_DECISIVE:"Las blancas tienen ventaja decisiva",WHITE_CLEARLY_BETTER:"Las blancas est\u00e1n claramente mejor",WHITE_BETTER:"Las blancas est\u00e1n mejor",WHITE_SLIGHTLY:"Las blancas est\u00e1n un poco mejor",WHITE_EDGE:"Las blancas tienen una ventaja m\u00ednima",BLACK_MATES:"Las negras dan mate",BLACK_CLEARLY_WINNING:"Las negras tienen clara ventaja ganadora",BLACK_WINNING:"Las negras tienen ventaja ganadora",BLACK_DECISIVE:"Las negras tienen ventaja decisiva",BLACK_CLEARLY_BETTER:"Las negras est\u00e1n claramente mejor",
    BLACK_BETTER:"Las negras est\u00e1n mejor",BLACK_SLIGHTLY:"Las negras est\u00e1n un poco mejor",BLACK_EDGE:"Las negras tienen una ventaja m\u00ednima",EQUAL_POS:"La posici\u00f3n est\u00e1 igualada",PREMIUM_ONLY:"S\u00f3lo premium",BOARD3D_CHARACTER:"Avatar",CALC_TRAINING:"Entrenar c\u00e1lculo",TTIP_CALC_TRAINING:"Calcular variantes con la ayuda de Fritz antes de continuar la partida aqu\u00ed.",CALC_INFO:"Ejecute jugadas a la ciega. Haga clic en la notaci\u00f3n para a\u00f1adir variantes. Haga clic en 'Entrenar c\u00e1lculo' para reanudar la partida.",
    CALCULATING:"Calculando...",WOOD:"Madera",TRAINING_SOLUTION:"Ver soluci\u00f3n",TRAINING_HELP:"Ayuda",TRAINING_QUESTION:"Encontrar la jugada correcta",UNANNOTATE:"Desanotar",MORE_LINES:"M\u00e1s l\u00edneas",LESS_LINES:"Menos l\u00edneas",CALCULATE_THREAT:"Calcular amenaza",START_RADIO:"Start",PAUSE_RADIO:"Pause",CURRENTLY_NO_LIVE_BROADCAST:"En ese momento, no hay una transmisi\u00f3n",CONNECTED_TO_SERVER:"Connected to server: {0}",INITIALIZING:"Initializing",INSERT_DIAGRAM:"Insert Diagram",BOARD:"Tablero",
    LOADING_BOARD:"Loading board, just a second...",LIKE:"Like",KING_ACC:"King",QUEEN_ACC:"Queen",KNIGHT_ACC:"Knight",BISHOP_ACC:"Bishop",ROOK_ACC:"Rook",PAWN_ACC:"Pawn",MOVE_IMP:"Move",WHITES_MOVE:"White's move",BLACKS_MOVE:"Black's move",CLICK_TO_FLIP_BOARD:"click to flip board",MAXIMIZE:"Maximize",PIECES:"Pieces",SOUND_ONOFF:"Sound On/Off",GOTO_BEGIN:"Goto Begin",GOTO_END:"Goto End",LOAD_PREV:"Load Prev.",LOAD_NEXT:"Load Next"};"use strict";CB.namespace("CB.Loc.Reader.ENG");
CB.Loc.Reader.ENG={PRODUCT_IS_ACTIVATED:"Product is activated",PRODUCT_KEY_CONTAINS_5_BLOCKS:"A product key should contain 5 blocks of 5 characters",DOWNLOADING_FILES:"Downloading files",PLEASE_ACTIVATE_THIS_PRODUCT:"Please activate this product",SERVER_IS_IN_MAINTENANCE:"Server in Maintenance",PRODUCT_KEY_ALREADY_USED_BEFORE:"Product key Already used",PRODUCT_KEY_IS_DISABLED:"Product key disabled",PRODUCT_KEY_IS_INVALID:"Product key invalid",PRODUCT_KEY_ALREADY_ACTIVATED:"Product key is already activated",
    PRODUCT_KEY_NOT_VALID_FOR_THIS_PRODUCT:"Product key not valid for this product",DEACTIVATE_THIS_PRODUCT:"Deactivate this product",PRODUCT_IS_DEACTIVATED:"Product is deactivated",LAST_BLOCK_SHOULD_CONTAIN_DATA:"Last block should contain 'DATA'",YOUR_SYSTEMS_CONFIGURATION_HAS_CHANGED:"Your Systems configuration has changed",SEND_YOUR_FEEDBACK:"Send your feedback",DOWNLOAD_STARTED:"Download started",PLEASE_WAIT:"Please wait",CLICK_ENGINE_TO_ANALYSE:"You can click on the Engine button to Analyse the position",
    AUTOPLAY:"Autoplay (Ctrl, Shift and/or Alt-key when clicking changes time)",DOWNLOAD_PGN:"Download PGN",MORE_LINES:"More Lines",LESS_LINES:"Less Lines",PRODUCT_KEY:"Product Key",MESSAGE:"Message",SUBJECT:"Subject"};"use strict";CB.namespace("CB.Loc.Reader.GER");
CB.Loc.Reader.GER={PRODUCT_IS_ACTIVATED:"Aktiviert",PRODUCT_KEY_CONTAINS_5_BLOCKS:"Der Aktivierungsschl\u00fcssel besteht aus 5 Blocken \u00e0 5 Zeichen",DOWNLOADING_FILES:"Lade Dateien herunter",PLEASE_ACTIVATE_THIS_PRODUCT:"Bitte aktivieren Sie dieses Produkt",SERVER_IS_IN_MAINTENANCE:"Zur Zeit sind Serverwartungsarbeiten im Gange, bitte versuchen Sie es sp\u00e4ter noch ein Mal",PRODUCT_KEY_ALREADY_USED_BEFORE:"Der Aktivierungsschl\u00fcssel wurde bereits verwendet",PRODUCT_KEY_IS_DISABLED:"Der Aktivierungsschl\u00fcssel wurde gesperrt",
    PRODUCT_KEY_IS_INVALID:"Der Aktivierungsschl\u00fcssel ist ung\u00fcltig",PRODUCT_KEY_ALREADY_ACTIVATED:"Der Aktivierungsschl\u00fcssel wurde bereits aktiviert",PRODUCT_KEY_NOT_VALID_FOR_THIS_PRODUCT:"Der Aktivierungsschl\u00fcssel passt nicht f\u00fcr dieses Produkt",DEACTIVATE_THIS_PRODUCT:"Deaktiviere dieses Produkt ",PRODUCT_IS_DEACTIVATED:"Das Produkt ist deaktiviert ",LAST_BLOCK_SHOULD_CONTAIN_DATA:"Der letzte Block sollte 'DATA' beinhalten",YOUR_SYSTEMS_CONFIGURATION_HAS_CHANGED:"Ihre Systemkonfiguration hat sich ver\u00e4ndert ",
    SEND_YOUR_FEEDBACK:"Schicken Sie uns Feedback",DOWNLOAD_STARTED:"Download startet",PLEASE_WAIT:"Bitte warten",CLICK_ENGINE_TO_ANALYSE:"Sie k\u00f6nnen auf den Engineknopf dr\u00fccken um die Brettstellung zu analysieren",AUTOPLAY:"Partie vorf\u00fchren",DOWNLOAD_PGN:"PGN Herunterladen",MORE_LINES:"Mehr Varianten",LESS_LINES:"Weniger Varianten",PRODUCT_KEY:"Aktivierungsschl\u00fcssel",MESSAGE:"Nachricht",SUBJECT:"Betreff"};"use strict";CB.namespace("CB.Loc.Reader.ESP");
CB.Loc.Reader.ESP={PRODUCT_IS_ACTIVATED:"Product is activated",PRODUCT_KEY_CONTAINS_5_BLOCKS:"A product key should contain 5 blocks of 5 characters",DOWNLOADING_FILES:"Downloading files",PLEASE_ACTIVATE_THIS_PRODUCT:"Please activate this product",SERVER_IS_IN_MAINTENANCE:"Server in Maintenance",PRODUCT_KEY_ALREADY_USED_BEFORE:"Product key Already used",PRODUCT_KEY_IS_DISABLED:"Product key disabled",PRODUCT_KEY_IS_INVALID:"Product key invalid",PRODUCT_KEY_ALREADY_ACTIVATED:"Product key is already activated",
    PRODUCT_KEY_NOT_VALID_FOR_THIS_PRODUCT:"Product key not valid for this product",DEACTIVATE_THIS_PRODUCT:"Deactivate this product",PRODUCT_IS_DEACTIVATED:"Product is deactivated",LAST_BLOCK_SHOULD_CONTAIN_DATA:"Last block should contain 'DATA'",YOUR_SYSTEMS_CONFIGURATION_HAS_CHANGED:"Your Systems configuration has changed",SEND_YOUR_FEEDBACK:"Send your feedback",DOWNLOAD_STARTED:"Download started",PLEASE_WAIT:"Please wait",CLICK_ENGINE_TO_ANALYSE:"You can click on the Engine button to Analyse the position",
    AUTOPLAY:"Autoplay (Ctrl, Shift and/or Alt-key when clicking changes time)",DOWNLOAD_PGN:"Download PGN",MORE_LINES:"More Lines",LESS_LINES:"Less Lines",PRODUCT_KEY:"Product Key",MESSAGE:"Message",SUBJECT:"Subject"};
var LZString=function(){function d(b,e){if(!c[b]){c[b]={};for(var d=0;d<b.length;d++)c[b][b.charAt(d)]=d}return c[b][e]}var b=String.fromCharCode,c={},e={compressToBase64:function(b){if(null==b)return"";b=e._compress(b,6,function(b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)});switch(b.length%4){default:case 0:return b;case 1:return b+"===";case 2:return b+"==";case 3:return b+"="}},decompressFromBase64:function(b){return null==b?"":""==b?null:e._decompress(b.length,
        32,function(c){return d("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b.charAt(c))})},compressToUTF16:function(c){return null==c?"":e._compress(c,15,function(c){return b(c+32)})+" "},decompressFromUTF16:function(b){return null==b?"":""==b?null:e._decompress(b.length,16384,function(c){return b.charCodeAt(c)-32})},compressToUint8Array:function(b){b=e.compress(b);for(var c=new Uint8Array(2*b.length),d=0,f=b.length;d<f;d++){var l=b.charCodeAt(d);c[2*d]=l>>>8;c[2*d+1]=l%256}return c},
    decompressFromUint8Array:function(c){if(null===c||void 0===c)return e.decompress(c);for(var d=Array(c.length/2),f=0,k=d.length;f<k;f++)d[f]=256*c[2*f]+c[2*f+1];var l=[];d.forEach(function(c){l.push(b(c))});return e.decompress(l.join(""))},compressToEncodedURIComponent:function(b){return null==b?"":e._compress(b,6,function(b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(b)})},decompressFromEncodedURIComponent:function(b){if(null==b)return"";if(""==b)return null;
        b=b.replace(/ /g,"+");return e._decompress(b.length,32,function(c){return d("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",b.charAt(c))})},compress:function(c){return e._compress(c,16,function(c){return b(c)})},_compress:function(b,c,e){if(null==b)return"";var d,f={},g={},h="",r=2,t=3,w=2,q=[],u=0,y=0,z;for(z=0;z<b.length;z+=1){var A=b.charAt(z);Object.prototype.hasOwnProperty.call(f,A)||(f[A]=t++,g[A]=!0);var C=h+A;if(Object.prototype.hasOwnProperty.call(f,C))h=C;else{if(Object.prototype.hasOwnProperty.call(g,
        h)){if(256>h.charCodeAt(0)){for(d=0;d<w;d++)u<<=1,y==c-1?(y=0,q.push(e(u)),u=0):y++;var B=h.charCodeAt(0);for(d=0;8>d;d++)u=u<<1|B&1,y==c-1?(y=0,q.push(e(u)),u=0):y++,B>>=1}else{B=1;for(d=0;d<w;d++)u=u<<1|B,y==c-1?(y=0,q.push(e(u)),u=0):y++,B=0;B=h.charCodeAt(0);for(d=0;16>d;d++)u=u<<1|B&1,y==c-1?(y=0,q.push(e(u)),u=0):y++,B>>=1}r--;0==r&&(r=Math.pow(2,w),w++);delete g[h]}else for(B=f[h],d=0;d<w;d++)u=u<<1|B&1,y==c-1?(y=0,q.push(e(u)),u=0):y++,B>>=1;r--;0==r&&(r=Math.pow(2,w),w++);f[C]=t++;h=String(A)}}if(""!==
        h){if(Object.prototype.hasOwnProperty.call(g,h)){if(256>h.charCodeAt(0)){for(d=0;d<w;d++)u<<=1,y==c-1?(y=0,q.push(e(u)),u=0):y++;B=h.charCodeAt(0);for(d=0;8>d;d++)u=u<<1|B&1,y==c-1?(y=0,q.push(e(u)),u=0):y++,B>>=1}else{B=1;for(d=0;d<w;d++)u=u<<1|B,y==c-1?(y=0,q.push(e(u)),u=0):y++,B=0;B=h.charCodeAt(0);for(d=0;16>d;d++)u=u<<1|B&1,y==c-1?(y=0,q.push(e(u)),u=0):y++,B>>=1}r--;0==r&&(r=Math.pow(2,w),w++);delete g[h]}else for(B=f[h],d=0;d<w;d++)u=u<<1|B&1,y==c-1?(y=0,q.push(e(u)),u=0):y++,B>>=1;r--;0==
    r&&w++}B=2;for(d=0;d<w;d++)u=u<<1|B&1,y==c-1?(y=0,q.push(e(u)),u=0):y++,B>>=1;for(;;)if(u<<=1,y==c-1){q.push(e(u));break}else y++;return q.join("")},decompress:function(b){return null==b?"":""==b?null:e._decompress(b.length,32768,function(c){return b.charCodeAt(c)})},_decompress:function(c,e,d){var f=[],g=4,h=4,p=3,r=[],t,w,q=d(0),u=e,y=1;for(t=0;3>t;t+=1)f[t]=t;var z=0;var A=Math.pow(2,2);for(w=1;w!=A;){var C=q&u;u>>=1;0==u&&(u=e,q=d(y++));z|=(0<C?1:0)*w;w<<=1}switch(z){case 0:z=0;A=Math.pow(2,8);
        for(w=1;w!=A;)C=q&u,u>>=1,0==u&&(u=e,q=d(y++)),z|=(0<C?1:0)*w,w<<=1;var B=b(z);break;case 1:z=0;A=Math.pow(2,16);for(w=1;w!=A;)C=q&u,u>>=1,0==u&&(u=e,q=d(y++)),z|=(0<C?1:0)*w,w<<=1;B=b(z);break;case 2:return""}t=f[3]=B;for(r.push(B);;){if(y>c)return"";z=0;A=Math.pow(2,p);for(w=1;w!=A;)C=q&u,u>>=1,0==u&&(u=e,q=d(y++)),z|=(0<C?1:0)*w,w<<=1;switch(B=z){case 0:z=0;A=Math.pow(2,8);for(w=1;w!=A;)C=q&u,u>>=1,0==u&&(u=e,q=d(y++)),z|=(0<C?1:0)*w,w<<=1;f[h++]=b(z);B=h-1;g--;break;case 1:z=0;A=Math.pow(2,16);
        for(w=1;w!=A;)C=q&u,u>>=1,0==u&&(u=e,q=d(y++)),z|=(0<C?1:0)*w,w<<=1;f[h++]=b(z);B=h-1;g--;break;case 2:return r.join("")}0==g&&(g=Math.pow(2,p),p++);if(f[B])B=f[B];else if(B===h)B=t+t.charAt(0);else return null;r.push(B);f[h++]=t+B.charAt(0);g--;t=B;0==g&&(g=Math.pow(2,p),p++)}}};return e}();
"function"===typeof define&&define.amd?define(function(){return LZString}):"undefined"!==typeof module&&null!=module?module.exports=LZString:"undefined"!==typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",function(){return LZString});function getCtxFunction(d,b){return function(){return b.apply(d,arguments)}}Function.prototype.bind||(Function.prototype.bind=function(d){return getCtxFunction(d,this)});
var Ve={initInstForListeners:function(d){d.addListener=Ve.addListener;d.removeListener=Ve.removeListener;d.fireEvent=Ve.fireEvent;d.getListeners=Ve.getListeners;d.enableEvents=Ve.enableEvents;d.eventsEnabled=!0;d.idLstnr=0},initForListeners:function(d){Ve.initInstForListeners(d.prototype)},enableEvents:function(d){this.eventsEnabled=d},getListeners:function(d){d="m_lstOn"+d;var b=this[d];b||(b={},this[d]=b);return b},addListener:function(d,b){this.getListeners(d)[++this.idLstnr]=b;return this.idLstnr},
    removeListener:function(d,b){delete this.getListeners(d)[b]},fireEvent:function(d,b){if(this.eventsEnabled){d=this.getListeners(d);for(var c in d)d.hasOwnProperty(c)&&d[c].apply(this,b)}},addInstEvent:function(d,b,c){d[String.formatEx("addOn{0}Listener",b)]=function(c){return this.addListener(b,c)};d[String.formatEx("removeOn{0}Listener",b)]=function(c){this.removeListener(b,c)};d[String.formatEx("fireOn{0}",b)]=function(){if(this[String.formatEx("fireOn{0}",b)].delayed)this[String.formatEx("fireOn{0}",
        b)].needFire=!0;else try{var e=arguments||[];c&&(e=c.call(this));this.fireEvent(b,e)}catch(f){CB.LogException("fire-"+b,f)}};d.removeAllListeners=function(){for(var b in this)this.hasOwnProperty(b)&&0==b.search("m_lstOn")&&delete this[b]};d[String.formatEx("delayfireOn{0}",b)]=function(c){c=c||100;this[String.formatEx("fireOn{0}",b)].delayed=!0;var e=this;window.setTimeout(function(){e[String.formatEx("continuefireOn{0}",b)]()},c)};d[String.formatEx("continuefireOn{0}",b)]=function(){this[String.formatEx("fireOn{0}",
        b)].delayed=!1;if(this[String.formatEx("fireOn{0}",b)].needFire)try{this[String.formatEx("fireOn{0}",b)]()}catch(e){CB.LogException("delfire-"+b,e)}this[String.formatEx("fireOn{0}",b)].needFire=!1}},addEvent:function(d,b,c){Ve.addInstEvent(d.prototype,b,c)}};function HashTable(d,b){d&&(this.funcHash=d);b&&(this.funcEq=b);this.impl={}}HashTable.prototype.impl={};HashTable.prototype.funcHash=function(d){return ObjUtil.hashCode(d)};HashTable.prototype.funcEq=function(d,b){return d===b};
HashTable.prototype.getItem=function(d){var b=this.funcHash(d);if(b=this.impl[b]){var c=function(b){return this.funcEq(b.key,d)}.bind(this);b=b.filter(c);if(null!=b&&0<b.length)return b[0].value}};HashTable.prototype.setItem=function(d,b){var c=this.funcHash(d),e=this.impl[c];e||(e=[],this.impl[c]=e);c=0;for(var f=e.length;c<f;++c){var g=e[c];if(this.funcEq(g.key,d)){g.value=b;return}}e.push({key:d,value:b})};
HashTable.prototype.removeItem=function(d){var b=this.funcHash(d),c=this.impl[b];if(c){var e=function(b){return!this.funcEq(b.key,d)}.bind(this);c=c.filter(e);this.impl[b]=c}};HashTable.prototype.clear=function(){this.impl={}};"use strict";
var ObjUtil={clone:function(d,b){b||(b=new HashTable);var c=b.getItem(d);if(c)return c;d.clone?c=d.clone(b):(c=ObjUtil.isArray(d)?[]:new d.constructor,b.setItem(d,c),ObjUtil.copyTo(d,c,!1,b));b.setItem(d,c);return c},clone2:function(d){return ObjUtil.copyTo2(d,new d.constructor)},cloneNoFunc:function(d){d=JSON.stringify(d);return JSON.parse(d)},copyTo:function(d,b,c,e){for(var f in d)if(!(c&&f in b)){var g=d[f],h=g;null!=g&&"object"===typeof g&&(h=ObjUtil.clone(g,e));b[f]=h}d.toString!==b.toString&&
    (b.toString=d.toString);return b},copyTo2:function(d,b){for(var c in d){var e=d[c],f=e;null!=e&&"object"===typeof e&&(f=ObjUtil.clone2(e));b[c]=f}return b}};function _CMP(d,b){if(void 0===d!==(void 0===b))return!1;if(void 0===d&&void 0===b)return!0;if(null===d!==(null===b))return!1;if(null===d&&null===b)return!0;var c=typeof d,e=typeof b;return"object"===c!==("object"===e)?!1:"object"===c&&"object"===e?ObjUtil.equals(d,b):d==b}
ObjUtil.equals=function(d,b){if(d.equals)return d.equals(b);for(var c in d)if(!_CMP(d[c],b[c]))return!1;return!0};ObjUtil.isEmpty=function(d){return!Object.keys(d).length};ObjUtil.isFunction=function(d){return!!(d&&d.constructor&&d.call&&d.apply)};ObjUtil.isArray=function(d){return"[object Array]"===Object.prototype.toString.call(d)};function djb2(d){for(var b=5381,c,e=0;e<d.length;++e)c=d.charCodeAt(e)&255,b=4294967295&(b<<5)+b+c;return b}
function StringHash(d){return djb2(typeof d+d.constructor.toString())}ObjUtil.hashCode=function(d){return d.hashCode?d.hashCode():"object"===typeof d?StringHash(d):djb2(d.toString())};function EnumToString(d,b){for(var c in d)if(d[c]===b)return c;return""}function StringToEnum(d,b){if(b in d)return d[b]}function StringToEnumFlags(d,b){b=b.split("|");for(var c=0,e=0,f=b.length;e<f;++e){var g=StringToEnum(d,b[e]);g&&(c|=g)}return c}
function evalObj(d){var b={},c;for(c in d){var e=d[c];b[c]=e;"string"===typeof e&&(0>e.indexOf("{")||(b[c]=eval("("+e+")")))}return b}function minusToCamel(d){for(var b=d.indexOf("-");0<=b;b=d.indexOf("-")){var c=d.substring(0,b);d=d.substring(b+1);0<d.length&&(d=d.charAt(0).toUpperCase()+(1<d.length?d.substring(1):""));d=c+d}return d}function NOT(d){return function(){return!d.apply(this,arguments)}}function TRUE(){return function(){return!0}}function FALSE(){return function(){return!1}}
function EqualsFilter(d){return function(b,c,e){return ObjUtil.equals(b,d)}}"use strict";Array.prototype.find||(Array.prototype.find=function(d){if("function"!==typeof d)throw new TypeError("predicate must be a function");for(var b=Object(this),c=b.length>>>0,e,f=0;f<c;f++)if(f in b&&(e=b[f],d.call(this,e,f,b)))return e});Array.prototype.all||(Array.prototype.all=function(d){return!this.some(function(b,c,e){return!d(b,c,e)})});
Array.prototype.findIndex||(Array.prototype.findIndex=function(d){if("function"!==typeof d)throw new TypeError("predicate must be a function");for(var b=Object(this),c=b.length>>>0,e,f=0;f<c;f++)if(f in b&&(e=b[f],d.call(this,e,f,b)))return f;return-1});
Array.prototype.pickRandom||(Array.prototype.pickRandom=function(d){if("function"!==typeof d)throw new TypeError("predicate must be a function");for(var b=Object(this),c=b.length>>>0,e,f=void 0,g=0,h=0;h<c;h++)h in b&&(g+=d.call(this,b[h],h,b));var k=Math.random()*g;for(h=g=0;h<c;h++)if(h in b&&(e=b[h],g+=d.call(this,e,h,b),g>=k)){f=e;break}return f});"use strict";
CB.Handlers=function(){var d=function(b){this.scope=b;this.handlers=[]};d.prototype.count=function(){return this.handlers.length};d.prototype.add=function(b){this.handlers.push(b);return this.handlers.length-1};d.prototype.remove=function(b){null!=b&&void 0!==this.handlers[b]&&delete this.handlers[b]};d.prototype.execute=function(){for(var b=0;b<this.handlers.length;b++)if(void 0!==this.handlers[b])this.handlers[b](this.scope)};d.prototype.empty=function(){for(var b=0;b<this.handlers.length;b++)if(void 0!==
    this.handlers[b])return!1;return!0};return d}();"use strict";CB.namespace("CB.strUtil");CB.strUtil.encodeUTF8=function(d){return unescape(encodeURIComponent(d))};CB.strUtil.decodeUTF8=function(d){return CB.strUtil.utf8ArrayToStr(d)};CB.strUtil.test=function(){var d=CB.strUtil.encodeUTF8("Rh\u00f4ne");return CB.strUtil.mayBeUtf8(d)};
CB.strUtil.utf8ArrayToStr=function(d){var b,c,e;var f="";var g=d.length;for(b=0;b<g;){var h=d[b++].charCodeAt(0);switch(h>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:f+=String.fromCharCode(h);break;case 12:case 13:b<g&&(c=d[b++].charCodeAt(0));f+=String.fromCharCode((h&31)<<6|c&63);break;case 14:b<g&&(c=d[b++].charCodeAt(0)),b<g&&(e=d[b++].charCodeAt(0)),f+=String.fromCharCode((h&15)<<12|(c&63)<<6|(e&63)<<0)}}return f};
CB.strUtil.mayBeUtf8=function(d){for(var b=!1,c=0;c<d.length&&!b;c++){var e=d.charCodeAt(c);if(e&128)if(194<=e&&223>=e&&128<=d.charCodeAt(c+1)&&191>=d.charCodeAt(c+1))c+=2,b=!0;else if(224==e&&160<=d.charCodeAt(c+1)&&191>=d.charCodeAt(c+1)&&128<=d.charCodeAt(c+2)&&191>=d.charCodeAt(c+2)||(225<=e&&236>=e||238==e||239==e)&&128<=d.charCodeAt(c+1)&&191>=d.charCodeAt(c+1)&&128<=d.charCodeAt(c+2)&&191>=d.charCodeAt(c+2)||237==e&&128<=d.charCodeAt(c+1)&&159>=d.charCodeAt(c+1)&&128<=d.charCodeAt(c+2)&&191>=
    d.charCodeAt(c+2))c+=3,b=!0;else if(240==e&&144<=d.charCodeAt(c+1)&&191>=d.charCodeAt(c+1)&&128<=d.charCodeAt(c+2)&&191>=d.charCodeAt(c+2)&&128<=d.charCodeAt(c+3)&&191>=d.charCodeAt(c+3)||241<=e&&243>=e&&128<=d.charCodeAt(c+1)&&191>=d.charCodeAt(c+1)&&128<=d.charCodeAt(c+2)&&191>=d.charCodeAt(c+2)&&128<=d.charCodeAt(c+3)&&191>=d.charCodeAt(c+3)||244==e&&128<=d.charCodeAt(c+1)&&143>=d.charCodeAt(c+1)&&128<=d.charCodeAt(c+2)&&191>=d.charCodeAt(c+2)&&128<=d.charCodeAt(c+3)&&191>=d.charCodeAt(c+3))c+=
    4,b=!0}return b};CB.strUtil.hasASCIIgreater127=function(d){for(var b=0;b<d.length;b++)if(d.charCodeAt(b)&128)return!0;return!1};CB.strUtil.codeURLParameter=function(d){return CB.strUtil.base64.encode(d)};CB.strUtil.decodeURLParameter=function(d){return CB.strUtil.base64.decode(d)};
CB.strUtil.base64={base64s:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",encode:function(d){if("function"===typeof btoa)return btoa(d);for(var b=this.base64s,c,e,f=0,g="";d.length>=f+3;)c=(d.charCodeAt(f++)&255)<<16|(d.charCodeAt(f++)&255)<<8|d.charCodeAt(f++)&255,g+=b.charAt((c&16515072)>>18)+b.charAt((c&258048)>>12)+b.charAt((c&4032)>>6)+b.charAt(c&63);0<d.length-f&&3>d.length-f&&(e=!!(d.length-f-1),c=(d.charCodeAt(f++)&255)<<16|(e?(d.charCodeAt(f)&255)<<8:0),g+=b.charAt((c&
        16515072)>>18)+b.charAt((c&258048)>>12)+(e?b.charAt((c&4032)>>6):"=")+"=");return g},decode:function(d){if("function"===typeof atob)return atob(d);var b=this.base64s,c="",e;for(e=0;e<d.length;e+=4){var f=(b.indexOf(d.charAt(e))&255)<<18|(b.indexOf(d.charAt(e+1))&255)<<12|(b.indexOf(d.charAt(e+2))&255)<<6|b.indexOf(d.charAt(e+3))&255;c+=String.fromCharCode((f&16711680)>>16,(f&65280)>>8,f&255)}return 61===d.charCodeAt(e-2)?c.substring(0,c.length-2):61===d.charCodeAt(e-1)?c.substring(0,c.length-1):c},
    decodeToBinary:function(d){this.lookup=new Uint8Array(256);for(var b=0;b<this.base64s.length;b++)this.lookup[this.base64s.charCodeAt(b)]=b;b=.75*d.length;var c=d.length,e=0;"="===d[d.length-1]&&(b--,"="===d[d.length-2]&&b--);var f=new ArrayBuffer(b),g=new Uint8Array(f);for(b=0;b<c;b+=4){var h=this.lookup[d.charCodeAt(b)];var k=this.lookup[d.charCodeAt(b+1)];var l=this.lookup[d.charCodeAt(b+2)];var m=this.lookup[d.charCodeAt(b+3)];g[e++]=h<<2|k>>4;g[e++]=(k&15)<<4|l>>2;g[e++]=(l&3)<<6|m&63}return f}};
CB.strUtil.getURLParam=function(d){d=d.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");d=(new RegExp("[\\?&]"+d+"=([^&#]*)")).exec(window.location.href);if(null===d)return"";d=d[1];d.length&&"/"==d.charAt(d.length-1)&&(d=d.slice(0,d.length-1));return d};CB.strUtil.shortenURL=function(d){if(d){var b=d.toLowerCase();b.replace(/</g,"(");b.replace(/>/g,")");b&&15<b.length&&(-1!=d.search("http://")&&(b=b.slice(7)),-1!=d.search("https://")&&(b=b.slice(8)),d=b.indexOf("/"),0<d&&(b=b.slice(0,d)));return b}return""};
CB.strUtil.trimQuotes=function(d){d=d.replace("%22",'"');d=d.replace("%27","'");if('"'==d.charAt(0)||"'"==d.charAt(0))d=d.slice(1,d.length-1);return d};CB.strUtil.escapeHtmlEntities=function(d){return d.replace(/[\u00A0-\u2666<>&]/g,function(b){return"&#"+b.charCodeAt(0)+";"})};var decodeHtmlEntity=function(d){},encodeHtmlEntity=function(d){};CB.strUtil.htmlEncode=function(d){return d.replace(/[\u00A0-\u2666<>&]/g,function(b){return"&#"+b.charCodeAt(0)+";"})};
CB.strUtil.htmlDecode=function(d){return d.replace(/&#(\d+);/g,function(b,c){return String.fromCharCode(c)})};CB.strUtil.tryConvertCyrillicAscii=function(d){for(var b=0,c="",e=0;e<d.length;e++){var f=d.charCodeAt(e);if(255<f)return d;127<f&&b++;c+=String.fromCharCode(this.conv1252[f])}return b>.7*d.length?c:d};
CB.strUtil.conv1252=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,1026,1027,8218,1107,8222,8230,8224,8225,8364,8240,1033,8249,1034,1036,1035,1039,1106,8216,8217,8220,8221,
    8226,8211,8212,8482,1113,8250,1114,1116,1115,1119,160,1038,1118,1032,164,1168,166,167,1025,169,1028,171,172,173,174,1031,176,177,1030,1110,1169,181,182,183,1105,8470,1108,187,1112,1029,1109,1111,1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,
    1102,1103];
(function(d,b){d.JSONP=function(b,e,f,g){b=b||"";e=e||{};f=f||"";g=g||function(){};var c=function(b){var c=[],e;for(e in b)b.hasOwnProperty(e)&&c.push(e);return c};if("object"==typeof e){var k="";c=c(e);for(var l=0;l<c.length;l++)k+=encodeURIComponent(c[l])+"="+encodeURIComponent(e[c[l]]),l!=c.length-1&&(k+="&");b+="?"+k}else"function"==typeof e&&(g=f=e);"function"==typeof f&&(g=f,f="callback");Date.now||(Date.now=function(){return(new Date).getTime()});e=Date.now();var m="jsonp"+Math.round(e+1000001*
    Math.random());d[m]=function(b){g(b);delete d[m]};b=-1===b.indexOf("?")?b+"?":b+"&";e=document.createElement("script");e.setAttribute("src",b+f+"="+m);document.getElementsByTagName("head")[0].appendChild(e)}})(window);function byteswap_ushort(d){var b=new ArrayBuffer(2);b=new DataView(b);b.setUInt16(0,d);d=b.GetUint8();b.SetUint8(0,b.GetUint8(1));b.SetUint8(1,d);return b.GetUint16(0)}
function byteswap_ulong(d){var b=new ArrayBuffer(4);b=new DataView(b);b.setUInt32(0,d);d=new ArrayBuffer(4);d=new DataView(d);for(var c=0;4>c;c++)d.setUint8(c,b.getUint8(3-c));return d.GetUint32(0)}function byteswap_uint64(d){var b=new ArrayBuffer(8);b=new DataView(b);b.setUInt64(0,d);d=new ArrayBuffer(8);d=new DataView(d);for(var c=0;8>c;c++)d.setUint8(c,b.getUint8(7-c));return d.GetUint64(0)}
function getInternetExplorerVersion(){return 0<=navigator.userAgent.indexOf("MSIE ")||navigator.userAgent.match(/Trident.*rv:11\./)?11:-1}function idiv(d,b){return(d-d%b)/b}function isNumber(d){return!isNaN(parseInt(d,10))}CB.setFlag=function(d,b,c){if("number"!=typeof b)throw Error("CB.setFlag: number expected for bits");void 0===d.flags&&(d.flags=0);d.flags=c?d.flags|b:d.flags&~b};CB.isFlag=function(d,b){return 0!=(d&b)};CB.namespace("CB.TimeTools");CB.TimeTools={};
CB.TimeTools.getCBTimeOfCentiSecs=function(d){d=new Date(10*d);return d.getUTCHours()<<24|d.getUTCMinutes()<<16|d.getUTCSeconds()<<8|d.getUTCMilliseconds()/10};"use strict";CB=CB||{};
CB.Timer=function(){var d=function(b){this.handler=b;this.active=!1};d.prototype.launch=function(b){this.runOnce(0,b)};d.prototype.runOnce=function(b,c){if(this.inHandler)this.fnAfterHandler=function(){this.runOnce(b,c)}.bind(this);else{if("undefined"==typeof b||null==b)b=5E3;c&&(this.handler=c);this.stop();this.isPeriodic=!1;this.active=!0;this.timeout=b;this.timer=window.setTimeout(this.timeoutHandler.bind(this),this.timeout);this.tick=new CB.Tick}};d.prototype.runPeriodic=function(b,c){c&&(this.handler=
    c);this.stop();this.active=this.isPeriodic=!0;this.timeout=b||5E3;this.timer=window.setInterval(this.timeoutHandler.bind(this),this.timeout);this.tick=new CB.Tick};d.prototype.restart=function(){this.active&&(this.stop(),this.active=!0,this.timer=this.isPeriodic?window.setInterval(this.timeoutHandler.bind(this),this.timeout):window.setTimeout(this.timeoutHandler.bind(this),this.timeout),this.tick=new CB.Tick)};d.prototype.getExpiredMS=function(){return this.tick?this.tick.getExpiredMS():0};d.prototype.stop=
    function(){this.isPeriodic?window.clearInterval(this.timer):window.clearTimeout(this.timer);this.active=!1};d.prototype.isActive=function(){return this.active};d.prototype.timeoutHandler=function(){this.inHandler=!0;this.handler&&this.handler();this.inHandler=!1;this.active=this.isPeriodic;this.fnAfterHandler&&(this.fnAfterHandler(),delete this.fnAfterHandler)};d.prototype.getTimeoutMs=function(){return this.timeout?this.timeout:0};d.busyWait=function(b){for(b+=(new Date).getTime();new Date<b;);};
    d.launch=function(b,c){c=c||100;(new CB.Timer).runOnce(c,b)};return d}();CB.hasHiResTimer=window.performance&&window.performance.now;
CB.Tick=function(){var d=function(){this.start()};d.prototype.start=function(){this.ticker=CB.hasHiResTimer?window.performance.now():(new Date).valueOf()};d.prototype.getExpired=function(){return CB.hasHiResTimer?Math.round(100*(window.performance.now()-this.ticker))/100:(new Date).valueOf()-this.ticker};d.prototype.logTime=function(b){var c="";b&&(c=b+": ");c+=this.getExpired()+"ms";this.start();return c};d.prototype.getExpiredMS=function(){return Math.round(this.getExpired())};return d}();
CB.getTick=function(){return CB.hasHiResTimer?Math.round(window.performance.now()):(new Date).valueOf()};CB.getHiResTick=function(){return CB.hasHiResTimer?window.performance.now():(new Date).valueOf()};
CB.TimeSpan=function(){var d=function(b){this.autoRestart=void 0!==b?b:!0;this.start()};d.prototype.start=function(){this.tick=(new Date).valueOf()};d.prototype.isElapsed=function(b){return this.getElapsedMilliSecs()>1E3*b?(this.autoRestart&&this.start(),!0):!1};d.prototype.getElapsedMilliSecs=function(){return(new Date).valueOf()-this.tick};return d}();
CB.Vr=function(){var d=function(){};d.prototype.exec=function(b,c){this.timer&&this.timer.stop();this.timer=new CB.Timer(b);this.milliSecs=c;this.timer.runOnce(c)};d.prototype.isActive=function(){return this.timer&&this.timer.isActive()};d.prototype.stop=function(){this.timer&&this.timer.stop()};d.prototype.restart=function(){this.isActive()&&(this.timer.stop(),this.timer.runOnce(this.milliSecs||1E3))};return d}();"use strict";
CB.Date=function(){var d=function(b,c,e){b&&(this.year=b);c&&(this.month=c);e&&(this.day=e)};d.prototype.year=0;d.prototype.month=0;d.prototype.day=0;d.prototype.toString=function(){return String.formatEx("{day}.{month}.{year}",this)};d.g_regexPGN=/(?:(\d{4})|\?{4})\.(?:(\d{2})|\?{2})\.(?:(\d{2})|\?{2})/;d.fromPGNString=function(b){return(b=d.g_regexPGN.exec(b))?new d(Number(b[1]),Number(b[2]),Number(b[3])):new d};d.prototype.constructFromNum=function(b){this.year=b>>9;this.month=b>>5&15;this.day=
    b&31};d.prototype.setToday=function(){var b=new Date;this.year=b.getFullYear();this.month=b.getMonth()+1;this.day=b.getDate()};d.today=function(){var b=new CB.Date;b.setToday();return b};d.prototype.getNum=function(){return this.year<<9|this.month<<5|this.day};d.prototype.fromDataBuf=function(b){b=b.V10();this.constructFromNum(b)};d.prototype.Vz=function(b){b.Vx(this.year<<9|this.month<<5|this.day)};d.prototype.toLocaleString=function(){var b="";this.year&&(b=this.year.toString(),this.month&&(b=this.month.toString()+
    "."+b,10>this.month&&(b="0"+b),this.day&&(b=this.day.toString()+"."+b,10>this.day&&(b="0"+b))));return b};d.prototype.toPGNString=function(){var b="";if(this.year){b=this.year.toString();if(this.month){var c=this.month.toString();10>this.month&&(c="0"+c);b+="."+c}else b+=".??";this.day?(c=this.day.toString(),10>this.day&&(c="0"+c),b+="."+c):b+=".??"}return b};d.prototype.getDay=function(){return this.day};d.prototype.setDay=function(b){this.day=b};d.prototype.getMonth=function(){return this.month};
    d.prototype.setMonth=function(b){this.month=b};d.prototype.getYear=function(){return this.year};d.prototype.setYear=function(b){this.year=b};d.getThisYear=function(){var b=new CB.Date;b.setToday();return b.getYear()};return d}();"use strict";CB.Time=function(){var d=function(b){this.time=b};d.prototype.time=0;return d}();CB.DateAndTime=function(){var d=function(){this.timeVal=0};d.prototype.Vz=function(b){b.Vt(this.timeVal)};d.prototype.fromDataBuf=function(b){b.Vy(this.timeVal)};return d}();
function CBGuid(){this.uint16Data3=this.uint16Data2=this.uint32Data1=0;this.uint8Data4=[0,0,0,0,0,0,0,0]}
CBGuid.prototype={fromRandom:function(d){var b=0;if(void 0!==d)for(var c=0;c<d.length;c++)b+=d.charCodeAt(c);this.uint32Data1=Math.floor(4294967296*Math.random()+b);this.uint16Data2=Math.floor(65536*Math.random()+b);this.uint16Data3=Math.floor(65536*Math.random()+b);for(c=0;8>c;c++)this.uint8Data4[c]=Math.floor(256*Math.random()+b)},toString:function(){for(var d=this.uint32Data1.toString(16)+"-"+this.uint16Data2.toString(16)+"-"+this.uint16Data3.toString(16)+"-",b=0;2>b;b++)d+=this.uint8Data4[b].toString(16);
        d+="-";for(b=2;8>b;b++)d+=this.uint8Data4[b].toString(16);return d},Vz:function(d){d.Vh(this.uint32Data1);d.Vi(this.uint16Data2);d.Vi(this.uint16Data3);for(var b=0;8>b;b++)d.writeUint8(this.uint8Data4[b])},fromDataBuf:function(d){this.uint32Data1=d.Vw();this.uint16Data2=d.Vi();this.uint16Data3=d.Vi();for(var b=0;8>b;b++)this.uint8Data4[b]=d.readUint8()}};"use strict";
CB.NAT={NONE:0,AFG:1,ALB:2,ALG:3,AND:4,ANG:5,ANT:6,ARG:7,ARM:8,AUS:9,AUT:10,AZE:11,BAH:12,BHN:13,BAN:14,BAR:15,BLR:16,BEL:17,BLZ:18,BER:19,BOL:20,BIH:21,BOT:22,BRA:23,IVB:24,BRN:25,BUL:26,BUR:27,CAN:28,CHI:29,CHN:30,COL:31,CRI:32,CRO:33,CUB:34,CYP:35,CZE:36,DEN:37,DJI:38,DOM:39,ECU:40,EGY:41,ENG:42,ESP:43,EST:44,ETH:45,FAI:46,FIJ:47,FIN:48,FRA:49,MKD:50,GAM:51,GEO:52,GER:53,GHA:54,GRE:55,GUA:56,GCI:57,GUY:58,HAI:59,HON:60,HKG:61,HUN:62,ISL:63,IND:64,INA:65,IRI:66,IRQ:67,ISR:68,IRL:69,ITA:70,IVO:71,
    JAM:72,JPN:73,JCI:74,JOR:75,KAZ:76,KEN:77,KOR:78,KYR:79,KUW:80,LAT:81,LBN:82,LBY:83,LIE:84,LTU:85,LUX:86,MAC:87,MAD:88,MAS:89,MLI:90,MLT:91,MAU:92,MRI:93,MEX:94,MDA:95,MNC:96,MON:97,MAR:98,MOZ:99,MYA:100,NAM:101,NEP:102,NED:103,AHO:104,NZL:105,NCA:106,NGR:107,NOR:108,PAK:109,PLE:110,PAN:111,PNG:112,PAR:113,PER:114,PHI:115,POL:116,POR:117,PUR:118,QAT:119,ROU:120,RUS:121,ESA:122,SMR:123,SCO:124,SEN:125,SEY:126,SIN:127,SVK:128,SLO:129,RSA:130,SRI:131,SUD:132,SUR:133,SWE:134,SUI:135,SYR:136,TJK:137,TAN:138,
    THA:139,TRI:140,TUN:141,TUR:142,TKM:143,UGA:144,UKR:145,UAE:146,USA:147,URU:148,URS:149,UZB:150,VEN:151,VIE:152,ISV:153,WLS:154,YEM:155,YUG:156,ZAM:157,ZIM:158,ZRE:159,DDR:160,CSR:161,CAM:162,CHD:163,KAP:164,KBA:165,COM:166,CON:167,NKO:168,LAO:169,LES:170,MWI:171,MDV:172,MSH:173,OMN:174,NAU:175,MIC:176,NIG:177,SAU:178,TOG:179,TON:180,VAN:181,VAT:182,TUV:183,SWA:184,SIE:185,SLU:186,PAP:187,SVI:188,SAM:189,SKI:190,SAL:191,GE2:192,ZAR:193,RWA:194,LBR:195,NET:196,TPE:197,ASU:198,AGG:199,ARN:200,BNN:201,
    BTN:202,BRI:203,CMB:204,CAY:205,CAR:206,CIB:207,CIA:208,COA:209,CIN:210,ELG:211,ERI:212,FGB:213,FRG:214,FRP:215,GAB:216,GGB:217,GRA:218,GRL:219,FGA:220,GMA:221,GUI:222,GUB:223,IOM:224,JMY:225,MFR:226,MYF:227,MSG:228,NCF:229,NNN:230,NNA:231,NMI:232,OTM:233,PAL:234,PIG:235,RUF:236,SAO:237,SOM:238,SVN:239,HGB:240,PGB:241,TKI:242,TCI:243,WFR:244,NIR:245,ISS:246,GBR:247,SAA:248,MNE:249,SRB:250,CAT:251,BAS:252,KOS:253,NUM:254};
CB.Nation=function(){var d=[];d[CB.NAT.NONE]="United Nations";d[CB.NAT.AFG]="Afghanistan";d[CB.NAT.ALB]="Albania";d[CB.NAT.ALG]="Algeria";d[CB.NAT.ASU]="American samoa";d[CB.NAT.AND]="Andorra";d[CB.NAT.ANG]="Angola";d[CB.NAT.AGG]="Anguilla";d[CB.NAT.ANT]="Antigua and Barbuda";d[CB.NAT.ARG]="Argentina";d[CB.NAT.ARM]="Armenia";d[CB.NAT.ARN]="Aruba";d[CB.NAT.AUS]="Australia";d[CB.NAT.AUT]="Austria";d[CB.NAT.AZE]="Azerbaijan";d[CB.NAT.BAH]="Bahamas";d[CB.NAT.BHN]="Bahrain";d[CB.NAT.BAN]="Bangladesh";
    d[CB.NAT.BAR]="Barbados";d[CB.NAT.BAS]="Basque Country";d[CB.NAT.BLR]="Belarus";d[CB.NAT.BEL]="Belgium";d[CB.NAT.BLZ]="Belize";d[CB.NAT.BNN]="Benin";d[CB.NAT.BER]="Bermuda";d[CB.NAT.BTN]="Bhutan";d[CB.NAT.BOL]="Bolivia";d[CB.NAT.BIH]="Bosnia and Herzegovina";d[CB.NAT.BOT]="Botswana";d[CB.NAT.BRA]="Brazil";d[CB.NAT.IVB]="Virgin Islands British";d[CB.NAT.ISV]="Virgin Islands US";d[CB.NAT.BRN]="Brunei";d[CB.NAT.BUL]="Bulgaria";d[CB.NAT.BUR]="Burkina faso";d[CB.NAT.BRI]="Burundi";d[CB.NAT.CMB]="Cambodja";
    d[CB.NAT.CAM]="Cameroon";d[CB.NAT.CAN]="Canada";d[CB.NAT.KAP]="Cape verde";d[CB.NAT.CAY]="Cayman Islands";d[CB.NAT.CAR]="Central African Republic";d[CB.NAT.CAT]="Catalonia";d[CB.NAT.CHD]="Chad";d[CB.NAT.CIB]="Jersey";d[CB.NAT.CHI]="Chile";d[CB.NAT.CHN]="China";d[CB.NAT.CIA]="Christmas";d[CB.NAT.COA]="Cocos (Keeling)";d[CB.NAT.COL]="Colombia";d[CB.NAT.COM]="Comoros";d[CB.NAT.CON]="Congo-Brazzaville";d[CB.NAT.CIN]="Cook Islands";d[CB.NAT.CRI]="Costa Rica";d[CB.NAT.CRO]="Croatia";d[CB.NAT.CUB]="Cuba";
    d[CB.NAT.CYP]="Cyprus";d[CB.NAT.CZE]="Czech Republic";d[CB.NAT.DEN]="Denmark";d[CB.NAT.DJI]="Djibouti";d[CB.NAT.DOM]="Dominican Republic";d[CB.NAT.ECU]="Ecuador";d[CB.NAT.ELG]="Equatorial Guinea";d[CB.NAT.EGY]="Egypt";d[CB.NAT.ENG]="England";d[CB.NAT.ERI]="Eritrea";d[CB.NAT.ESP]="Spain";d[CB.NAT.EST]="Estonia";d[CB.NAT.ETH]="Ethiopia";d[CB.NAT.FGB]="England";d[CB.NAT.FAI]="Faroes";d[CB.NAT.FIJ]="Fiji";d[CB.NAT.FIN]="Finland";d[CB.NAT.FRA]="France";d[CB.NAT.FRG]="Guyana";d[CB.NAT.FRP]="Tahiti(French Polinesia)";
    d[CB.NAT.MKD]="Macedonia";d[CB.NAT.GAB]="Gabon";d[CB.NAT.GAM]="Gambia";d[CB.NAT.GEO]="Georgia";d[CB.NAT.GER]="Germany";d[CB.NAT.SAA]="Germany";d[CB.NAT.DDR]="Germany";d[CB.NAT.GE2]="Germany";d[CB.NAT.GHA]="Ghana";d[CB.NAT.GGB]="Gibraltar";d[CB.NAT.GRE]="Greece";d[CB.NAT.GRA]="Grenada";d[CB.NAT.GRL]="Greenland";d[CB.NAT.FGA]="Guadeloupe";d[CB.NAT.GMA]="Guam";d[CB.NAT.GUA]="Guatemala";d[CB.NAT.GUI]="Guinea";d[CB.NAT.GUB]="Guinea-Bissau";d[CB.NAT.GCI]="Guernsey";d[CB.NAT.GUY]="Guyana";d[CB.NAT.HAI]=
        "Haiti";d[CB.NAT.HON]="Honduras";d[CB.NAT.HKG]="Hong Kong";d[CB.NAT.HUN]="Hungary";d[CB.NAT.ISL]="Iceland";d[CB.NAT.IND]="India";d[CB.NAT.INA]="Indonesia";d[CB.NAT.IRI]="Iran";d[CB.NAT.IRQ]="Iraq";d[CB.NAT.IOM]="Isle of MAN";d[CB.NAT.ISR]="Israel";d[CB.NAT.IRL]="Ireland";d[CB.NAT.ITA]="Italy";d[CB.NAT.IVO]="Cote d'Ivoire";d[CB.NAT.JAM]="Jamaica";d[CB.NAT.JMY]="Svalbard and Jan Mayen";d[CB.NAT.JPN]="Japan";d[CB.NAT.JCI]="Jersey";d[CB.NAT.JOR]="Jordan";d[CB.NAT.KAZ]="Kazakhstan";d[CB.NAT.KEN]="Kenya";
    d[CB.NAT.KBA]="Kiribati";d[CB.NAT.KOR]="South Korea";d[CB.NAT.KYR]="Kyrgyzstan";d[CB.NAT.KUW]="Kuwait";d[CB.NAT.LAO]="Laos";d[CB.NAT.LAT]="Latvia";d[CB.NAT.LBN]="Lebanon";d[CB.NAT.LES]="Lesotho";d[CB.NAT.LBR]="Liberia";d[CB.NAT.LBY]="Libya";d[CB.NAT.LIE]="Liechtenstein";d[CB.NAT.LTU]="Lithuania";d[CB.NAT.LUX]="Luxembourg";d[CB.NAT.MAC]="Macao";d[CB.NAT.MAD]="Madagascar";d[CB.NAT.MAS]="Malaysia";d[CB.NAT.MLI]="Mali";d[CB.NAT.MLT]="Malta";d[CB.NAT.MWI]="Malawi";d[CB.NAT.MFR]="Martinique";d[CB.NAT.MAU]=
        "Mauritania";d[CB.NAT.MRI]="Mauritius";d[CB.NAT.MYF]="Mayotte";d[CB.NAT.MEX]="Mexico";d[CB.NAT.MIC]="Micronesia";d[CB.NAT.MDA]="Moldova";d[CB.NAT.MNC]="Monaco";d[CB.NAT.MON]="Mongolia";d[CB.NAT.MSG]="Montserrat";d[CB.NAT.MAR]="Morocco";d[CB.NAT.MOZ]="Mozambique";d[CB.NAT.MYA]="Myanmar(Burma)";d[CB.NAT.NAM]="Namibia";d[CB.NAT.NEP]="Nepal";d[CB.NAT.NED]="Netherlands";d[CB.NAT.AHO]="Netherlands Antilles";d[CB.NAT.NCF]="New caledonia";d[CB.NAT.NET]="United Nations";d[CB.NAT.NZL]="New zealand";d[CB.NAT.NCA]=
        "Nicaragua";d[CB.NAT.NGR]="Nigeria";d[CB.NAT.NNN]="Niue";d[CB.NAT.NNA]="Norfolk";d[CB.NAT.NMI]="Northern Mariana";d[CB.NAT.NOR]="Norway";d[CB.NAT.OTM]="Timor-Leste";d[CB.NAT.PAK]="Pakistan";d[CB.NAT.PAL]="Palau";d[CB.NAT.PLE]="Palestine";d[CB.NAT.PAN]="Panama";d[CB.NAT.PNG]="Papua new GUINEA";d[CB.NAT.PAR]="Paraguay";d[CB.NAT.PER]="Peru";d[CB.NAT.PHI]="Philippines";d[CB.NAT.PIG]="Pitcairn";d[CB.NAT.POL]="Poland";d[CB.NAT.POR]="Portugal";d[CB.NAT.PUR]="Puerto rico";d[CB.NAT.QAT]="Qatar";d[CB.NAT.RUF]=
        "Reunion";d[CB.NAT.ROU]="Romania";d[CB.NAT.URS]="Russian Federation";d[CB.NAT.RUS]="Russian Federation";d[CB.NAT.ZAR]="Russian Federation";d[CB.NAT.ESA]="El Salvador";d[CB.NAT.SMR]="San Marino";d[CB.NAT.SAO]="Sao Tome and PRINCIPE";d[CB.NAT.SCO]="Scotland";d[CB.NAT.SEN]="Senegal";d[CB.NAT.YUG]="Serbia(Yugoslavia)";d[CB.NAT.SRB]="Serbia(Yugoslavia)";d[CB.NAT.SEY]="Seychelles";d[CB.NAT.SIN]="Singapore";d[CB.NAT.SVK]="Slovakia";d[CB.NAT.SLO]="Slovenia";d[CB.NAT.SOM]="Somalia";d[CB.NAT.RSA]="South africa";
    d[CB.NAT.SRI]="Sri lanka";d[CB.NAT.SUD]="Sudan";d[CB.NAT.SUR]="Suriname";d[CB.NAT.SVN]="Svalbard and Jan Mayen";d[CB.NAT.SWE]="Sweden";d[CB.NAT.SUI]="Switzerland";d[CB.NAT.SYR]="Syria";d[CB.NAT.HGB]="Saint Helena";d[CB.NAT.PGB]="Saint Pierre and Miquelon";d[CB.NAT.TJK]="Tajikistan";d[CB.NAT.TAN]="Tanzania";d[CB.NAT.THA]="Thailand";d[CB.NAT.TKI]="Tokelau";d[CB.NAT.TRI]="Trinidad and Tobago";d[CB.NAT.TUN]="Tunisia";d[CB.NAT.TCI]="Turks and Caicos Islands";d[CB.NAT.TUR]="Turkey";d[CB.NAT.TKM]="Turkmenistan";
    d[CB.NAT.UGA]="Uganda";d[CB.NAT.UKR]="Ukraine";d[CB.NAT.UAE]="United Arab Emirates";d[CB.NAT.USA]="United States of America";d[CB.NAT.URU]="Uruguay";d[CB.NAT.UZB]="Uzbekistan";d[CB.NAT.VEN]="Venezuela";d[CB.NAT.VIE]="Viet Nam";d[CB.NAT.WLS]="Wales";d[CB.NAT.WFR]="Wallis and Futuna";d[CB.NAT.YEM]="Yemen";d[CB.NAT.ZAM]="Zambia";d[CB.NAT.ZIM]="Zimbabwe";d[CB.NAT.ZRE]="Congo-Kinshasa(Zaire)";d[CB.NAT.NKO]="North korea";d[CB.NAT.MDV]="Maldives";d[CB.NAT.MSH]="Marshall Islands";d[CB.NAT.OMN]="Oman";d[CB.NAT.NAU]=
        "Nauru";d[CB.NAT.NIG]="Niger";d[CB.NAT.SAU]="Saudi Arabia";d[CB.NAT.TOG]="Togo";d[CB.NAT.TON]="Tonga";d[CB.NAT.VAN]="Vanuatu";d[CB.NAT.VAT]="Vatican City";d[CB.NAT.TUV]="Tuvalu";d[CB.NAT.SWA]="Swaziland";d[CB.NAT.SIE]="Sierra Leone";d[CB.NAT.SLU]="Saint Lucia";d[CB.NAT.PAP]="Papua New Guinea";d[CB.NAT.SVI]="St Vincent and The Grenadines";d[CB.NAT.SAM]="Samoa";d[CB.NAT.SKI]="St Kitts and NEVIS";d[CB.NAT.SAL]="Solomon islands";d[CB.NAT.RWA]="Rwanda";d[CB.NAT.TPE]="Taiwan";d[CB.NAT.NIR]="Northern Ireland";
    d[CB.NAT.GBR]="United Kingdom(Great Britain)";d[CB.NAT.KOS]="Kosovo";var b=[],c=function(c){this.n=c;void 0===this.n&&(this.n=CB.NAT.NONE);if(0==b.length){c=0;for(var e in CB.NAT)CB.NAT.hasOwnProperty(e)&&(b[c]=e,c+=1);for(e=0;e<b.length;e++){var g=d[e];void 0===g&&(g=d[0]);c=b[e];1<c.length&&(g=window.escape(g),g=" background-image: url( "+CB.getCommonPath()+"media/flags/flags16/"+g+".png ) !important;",CB.CSS.addRules(".cls-"+c,g+"background-repeat:no-repeat; background-position:center center;"))}}};
    c.prototype.getStrCode=function(){return b[this.n]};c.prototype.getStrFlag=function(){return d[this.n]?d[this.n]:d[CB.NAT.NONE]};return c}();"use strict";
CB.System={getStrOS:function(){this.strOS||(this.getiOSVersion()&&(this.strOS="iOS"+this.getiOSVersion()),this.getAndroidVersion()&&(this.strOS="Andr"+this.getAndroidVersion()),this.isWindows()&&(this.strOS="Win"),this.isLinux()&&(this.strOS="Ux"),this.isMac()&&(this.strOS="Mac"),this.strOS=navigator.platform);return this.strOS},getOSChar:function(){var d="X";this.isWindows()?d="W":this.isMac()?d="M":this.isIPhone()||this.isIPad()?d="I":this.isAndroid()?d="A":this.isLinux()&&(d="L");return d},getStrSysInfo:function(){return this.getStrOS()+
        " "+String.f("{0}/{1}/{2}, cpus={3}",window.innerWidth,window.innerHeight,window.devicePixelRatio,this.getNCpus())},isCordova:function(){return"cordova"===CB.strUtil.getURLParam("client")||!!window.cordova},isMobile:function(){4;return/Kindle|Silk|KFAPW|KFARWI|KFASWI|KFFOWI|KFJW|KFMEWI|KFOT|KFSAW|KFSOWI|KFTBW|KFTHW|KFTT|WFFOWI/i.test(navigator.userAgent)?!0:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|bada|Opera Mini/i.test(navigator.userAgent)},isDesktop:function(){return!CB.System.isMobile()&&
        1400<screen.width&&900<=screen.height},isElectron:function(){return-1<navigator.userAgent.toLowerCase().indexOf(" electron/")},requestFullScreen:function(){var d=document.documentElement;d.requestFullscreen?d.requestFullscreen():d.webkitrequestFullscreen?d.webkitrequestFullscreen():d.mozrequestFullscreen?d.mozrequestFullscreen():d.msrequestFullscreen&&d.msrequestFullscreen()},isFullScreen:function(){return document.fullscreen||document.webkitIsFullScreen||document.mozFullScreen||(screen.availHeight||
        screen.height-30)<=window.innerHeight},isAtLeastTablet:function(){7;return 1E3<=screen.width&&760<=screen.height||1E3<=screen.height},isIPhone:function(){return/iPhone/i.test(navigator.userAgent)||/iPod/i.test(navigator.userAgent)},isIPad:function(){return/iPad/i.test(navigator.userAgent)},getiOSVersion:function(){return parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1},
    isWindows:function(){return/Win32/i.test(navigator.platform)},isLinux:function(){return/Linux/i.test(navigator.platform)},isMac:function(){return/Mac/i.test(navigator.platform)},isTouchDevice:function(){void 0===this.isTouchChecked&&(this.isTouchChecked=this.isMobile()||"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints);return this.isTouchChecked},runsInIFrame:function(){try{return window.self!==window.top&&-1==document.referrer.search(/google/i)&&-1==document.referrer.search(/bing/i)}catch(d){return!0}},
    getWindowPos:function(){if(void 0!==window.screenLeft)return new CB.Point(window.screenLeft,window.screenTop);if(void 0!==window.screenX)return new CB.Point(window.screenX,window.screenY)},getWindowSize:function(){var d=window,b=document,c=b.documentElement;b=b.getElementsByTagName("body")[0];return new CB.Size(d.innerWidth||c.clientWidth||b.clientWidth,d.innerHeight||c.clientHeight||b.clientHeight)},getTimeZone:function(){return String(String(new Date).split("(")[1]).split(")")[0]},isHighResScreen:function(){return 1400<=
        screen.width&&900<=screen.height},isPortraitScreen:function(d){return screen.width*(d||1)<screen.height},getLanguage:function(){return navigator.language},getSystemLanguage:function(){return navigator.systemLanguage||window.navigator.language},getWindowsCodePage:function(){if(document.inputEncoding)switch(document.inputEncoding){default:return 1252;case "ISO-8859-11":return 874;case "Windows-31J":return 932;case "ISO-8859-2":return 1250;case "ISO-8859-5":return 1251;case "ISO-8859-1":return 1252;
        case "ISO-8859-7":return 1253;case "ISO-8859-9":return 1254;case "ISO-8859-8":return 1255;case "ISO-8859-6":return 1256;case "ISO-8859-13":return 1257}else return 1252},getInternetExplorerVersion:function(){var d=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(d=parseFloat(RegExp.$1));return d},useExtJSTouchCSS:function(){return this.isMobile()||this.isTouchDevice()},isBrowserOk:function(){return void 0!==Function.prototype.bind&&
    "undefined"!==typeof console&&"WebSocket"in window?11<=this.getIEVersion()?!0:this.isAndroidBrowser()&&4.2>=this.getAndroidVersion()||this.isSafariOnWindows()&&535>this.getSafariVersion()&&!this.isChrome()?!1:!0:!1},isHTTPS:function(){return document.location&&document.location.protocol?"http:"!=document.location.protocol:window.location&&window.location.protocol?"http:"!=window.location.protocol:!1},getIEVersion:function(){var d=window.navigator.userAgent,b=d.indexOf("MSIE ");if(0<b)return parseInt(d.substring(b+
        5,d.indexOf(".",b)),10);if(0<d.indexOf("Trident/"))return b=d.indexOf("rv:"),parseInt(d.substring(b+3,d.indexOf(".",b)),10);b=d.indexOf("Edge/");if(0<b)return parseInt(d.substring(b+5,d.indexOf(".",b)),10)},getFirefoxVersion:function(){var d=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return d?parseInt(d[1]):0},isNonCrossDomainIE:function(){var d=this.getIEVersion();return d?12>d:!1},canRunWebAssembly:function(){return"object"===typeof WebAssembly},isActivexEnabled:function(){var d=null;
        try{d=!!new ActiveXObject("htmlfile")}catch(b){d=!1}return d},isWebKit:function(){return null!=window.webkitURL},isChrome:function(){return-1!=navigator.userAgent.indexOf("Chrome")},isSafari:function(){return-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&-1==navigator.userAgent.indexOf("CriOS")},isFirefox:function(){return-1!=navigator.userAgent.indexOf("Firefox")},isIE:function(){return 0<this.getIEVersion()},isOldIE:function(){return 0<this.getIEVersion()&&
        12>this.getIEVersion()},isOpera:function(){return-1!=navigator.userAgent.indexOf("OPR")},browserIsSafeForEngine:function(d){var b=this.getIEVersion(),c=this.getFirefoxVersion(),e=parseFloat(this.getSafariVersion());b=this.isChrome()||11<=b||54<=c||600<e||CB.System.canRunWebAssembly();return b=CB.System.getNCpus()?b&&CB.System.getNCpus()>=(d||6):b&&!CB.System.isMobile()},isAndroidBrowser:function(){return 0<=navigator.userAgent.indexOf("Android")&&-1==navigator.userAgent.indexOf("Chrome")},isAndroid:function(){return 0<
        this.getAndroidVersion()},isSafariOnWindows:function(){return 0<=navigator.userAgent.indexOf("Windows")&&0<=navigator.userAgent.indexOf("Safari")},getSafariVersion:function(){var d=navigator.userAgent;return 0<=d.indexOf("Safari")?parseFloat(d.slice(d.indexOf("Safari")+7)):0},copyToClipboard:function(d){if(navigator.clipboard)navigator.clipboard.writeText(d);else{var b=document.createElement("textarea");b.value=d;document.body.appendChild(b);b.focus();b.select();try{document.execCommand("copy")}catch(c){}document.body.removeChild(b)}},
    getAndroidVersion:function(){var d=navigator.userAgent;return 0<=d.indexOf("Android")?parseFloat(d.slice(d.indexOf("Android")+8)):0},isWebGlCapable:function(d){if(window.WebGLRenderingContext)for(var b=document.createElement("canvas"),c=["webgl","experimental-webgl","moz-webgl","webkit-3d"],e=!1,f=0;4>f;f++)try{if((e=b.getContext(c[f]))&&"function"==typeof e.getParameter)return d?{name:c[f],gl:e}:!0}catch(g){}return!1},runsOnChessBaseDomain:function(){return-1!=document.URL.search(/chessbase.com/i)&&
        -1==document.URL.search(/cloudserver/i)||-1!=document.URL.search(/playchess.com/i)||-1!=document.URL.search(/schach.de/i)},runsOnChessBaseCom:function(){return-1!=document.URL.search(/chessbase.com/i)},runsOnLiveChessBaseCom:function(){return-1!=document.URL.search(/live.chessbase.com/i)||-1!=document.URL.search(/acc.chessbase.com/i)},runsOnVideosChessBaseCom:function(){return-1!=document.URL.search(/videos.chessbase.com/i)||-1!=document.URL.search(/videostest.chessbase.com/i)},getDevicePixelRatio:function(){return window.devicePixelRatio},
    overrideDeviceZoom:function(d){this.overriddenDeviceZoom=d},pixToZoom:function(d){return this.overriddenDeviceZoom?d/this.overriddenDeviceZoom:window.devicePixelRatio?d/window.devicePixelRatio:d},zoomToPix:function(d){return this.overriddenDeviceZoom?d*this.overriddenDeviceZoom:window.devicePixelRatio?d*window.devicePixelRatio:d},getNCpus:function(){return window.navigator.hardwareConcurrency?window.navigator.hardwareConcurrency:0},getDeviceMemory:function(){return navigator.deviceMemory?navigator.deviceMemory:
        0},getHardwareId:function(){return this.getDeviceMemory()+navigator.platform+this.getNCpus()+this.getSystemLanguage()+this.getTimeZone()},browser:{detect:function(){return{browser:this.search(this.data.browser),version:this.search(navigator.userAgent)||this.search(navigator.appVersion),os:this.search(this.data.os)}},search:function(d){if("object"===typeof d)for(var b=0;b<d.length;b++){var c=d[b].string,e=d[b].prop;this.version_string=d[b].versionSearch||d[b].identity;if(c){if(-1!=c.indexOf(d[b].subString))return d[b].identity}else if(e)return d[b].identity}else return b=
            d.indexOf(this.version_string),-1==b?void 0:parseFloat(d.substr(b+this.version_string.length+1))},data:{browser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,
                subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],
            os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}};"use strict";
CB.Language={ENG:0,DEU:1,GER:1,FRA:2,ESP:3,ITA:4,NED:5,POR:6,DEF:7,SLO:8,SWE:9,BAS:10,SVK:11,POL:12,CZE:13,CAT:14,TRK:15,MGY:16,RUS:17,GRK:18,ROM:19,CHN:20,UN:21,NOR:22,HEB:23,UKR:24,VIE:25,ARA:26,SER:27,LIT:28,BRA:29,FAR:30,CRO:31,GAL:32,HIN:33,getStrUserLanguage:function(){return void 0!==navigator.languages&&navigator.languages.length?navigator.languages[0]:void 0!==navigator.language?navigator.language:void 0!==navigator.userLanguage?navigator.userLanguage:"en-en"},getStrUserLanguageTwoChars:function(){return this.getStrUserLanguage().slice(0,
        2)},getUserLanguageId:function(){var d=CB.Language.getStrUserLanguage();return this.getLanguageIdOfParam(d)},getLanguageIdOfParam:function(d){return-1<d.indexOf("de")?this.DEU:-1<d.indexOf("es")?this.ESP:-1<d.indexOf("nl")?this.NED:-1<d.indexOf("fr")?this.FRA:-1<d.indexOf("it")?this.ITA:-1<d.indexOf("sl")?this.SLO:-1<d.indexOf("sv")?this.SWE:-1<d.indexOf("ro")?this.ROM:-1<d.indexOf("zh")?this.CHN:-1<d.indexOf("ru")?this.RUS:-1<d.indexOf("no")?this.NOR:-1<d.indexOf("pl")?this.POL:-1<d.indexOf("he")?
        this.HEB:-1<d.indexOf("ca")?this.CAT:-1<d.indexOf("tr")?this.TRK:-1<d.indexOf("sl")?this.SLO:-1<d.indexOf("el")?this.GRK:-1<d.indexOf("uk")?this.UKR:-1<d.indexOf("vi")?this.VIE:-1<d.indexOf("ar")?this.ARA:-1<d.indexOf("sr")?this.SER:-1<d.indexOf("lt")?this.LIT:-1<d.indexOf("pt-br")||-1<d.indexOf("pt")?this.BRA:-1<d.indexOf("fa")?this.FAR:-1<d.indexOf("ga")?this.GAL:-1<d.indexOf("hr")?this.CRO:-1<d.indexOf("hi")?this.HIN:-1<d.indexOf("cs")?this.CZE:this.ENG},getParamOfLanguageId:function(d){switch(d){default:case CB.Language.ENG:return"en";
        case CB.Language.DEU:return"de";case CB.Language.ESP:return"es";case CB.Language.NED:return"nl";case CB.Language.FRA:return"fr";case CB.Language.ITA:return"it";case CB.Language.POR:return"pt";case CB.Language.SLO:return"sl";case CB.Language.SWE:return"sv";case CB.Language.ROM:return"ro";case CB.Language.CHN:return"zh";case CB.Language.RUS:return"ru";case CB.Language.NOR:return"no";case CB.Language.POL:return"pl";case CB.Language.HEB:return"he";case CB.Language.CAT:return"ca";case CB.Language.TRK:return"tr";
        case CB.Language.SLO:return"sl";case CB.Language.GRK:return"el";case CB.Language.UKR:return"uk";case CB.Language.VIE:return"vi";case CB.Language.ARA:return"ar";case CB.Language.SER:return"sr";case CB.Language.LIT:return"lt";case CB.Language.BRA:return"pt";case CB.Language.FAR:return"fa";case CB.Language.CRO:return"hr";case CB.Language.GAL:return"ga";case CB.Language.HIN:return"hi";case CB.Language.CZE:return"cs"}},getHelpParamOfLanguageId:function(d){switch(d){default:case CB.Language.ENG:return"en";
        case CB.Language.DEU:return"de";case CB.Language.ESP:return"es";case CB.Language.FRA:return"fr";case CB.Language.NED:return"nl";case CB.Language.ITA:return"it"}},getRibbonFlagName:function(d){switch(d){default:case CB.Language.ENG:return"en-us"==this.getStrUserLanguage()?"us":"gb";case CB.Language.DEU:return"de-at"==this.getStrUserLanguage()?"at":"de";case CB.Language.ESP:return"es";case CB.Language.NED:return"nl";case CB.Language.ROM:return"ro";case CB.Language.CHN:switch(this.getStrUserLanguage()){default:case "zh-cn":return"cn";
        case "zh-tw":return"tw";case "zh-sg":return"si";case "zh-hk":return"hk"}case CB.Language.FRA:return"fr";case CB.Language.RUS:return"ru";case CB.Language.NOR:return"no";case CB.Language.ITA:return"it";case CB.Language.POL:return"pl";case CB.Language.UN:return"_United_Nations";case CB.Language.HEB:return"il";case CB.Language.CAT:return"_Catalonia";case CB.Language.TRK:return"tr";case CB.Language.SLO:return"si";case CB.Language.GRK:return"gr";case CB.Language.UKR:return"ua";case CB.Language.VIE:return"vn";
        case CB.Language.ARA:return"sa";case CB.Language.SER:return"rs";case CB.Language.LIT:return"lt";case CB.Language.BRA:return"br";case CB.Language.FAR:return"ir";case CB.Language.CRO:return"hr";case CB.Language.GAL:return"ie";case CB.Language.HIN:return"in";case CB.Language.CZE:return"cz"}}};
CB.Language.getInternalName=function(d){switch(d){default:case CB.Language.ENG:return"ENG";case CB.Language.DEU:case CB.Language.GER:return"GER";case CB.Language.ESP:return"ESP";case CB.Language.NED:return"NED";case CB.Language.ROM:return"ROM";case CB.Language.CHN:return"CHN";case CB.Language.FRA:return"FRA";case CB.Language.RUS:return"RUS";case CB.Language.NOR:return"NOR";case CB.Language.POL:return"POL";case CB.Language.ITA:return"ITA";case CB.Language.HEB:return"HEB";case CB.Language.CAT:return"CAT";
    case CB.Language.TRK:return"TRK";case CB.Language.SLO:return"SLO";case CB.Language.UN:return"UN";case CB.Language.GRK:return"EL";case CB.Language.UKR:return"UKR";case CB.Language.VIE:return"VIE";case CB.Language.ARA:return"ARA";case CB.Language.SER:return"SER";case CB.Language.LIT:return"LIT";case CB.Language.BRA:return"BRA";case CB.Language.FAR:return"FAR";case CB.Language.CRO:return"CRO";case CB.Language.GAL:return"GAL";case CB.Language.HIN:return"HIN";case CB.Language.CZE:return"CZE"}};
CB.Language.getNativeLangName=function(d){switch(d){default:case CB.Language.ENG:return"English";case CB.Language.DEU:return"Deutsch";case CB.Language.ESP:return"Espa\u00f1ol";case CB.Language.NED:return"Nederlands";case CB.Language.ROM:return"Rom\u00e2n";case CB.Language.CHN:return"\u4e2d\u6587";case CB.Language.FRA:return"Fran\u00e7ais";case CB.Language.RUS:return"\u0420\u0443\u0441\u0441\u043a\u0438\u0439";case CB.Language.NOR:return"Norsk";case CB.Language.POL:return"Polski";case CB.Language.ITA:return"Italiano";
    case CB.Language.HEB:return"\u05e2\u05d1\u05e8\u05d9\u05ea";case CB.Language.CAT:return"Catal\u00e0";case CB.Language.TRK:return"T\u00fcrk\u00e7e";case CB.Language.SLO:return"Slovenski";case CB.Language.GRK:return"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac";case CB.Language.UKR:return"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430";case CB.Language.VIE:return"Ti\u1ebfng Vi\u1ec7t";case CB.Language.ARA:return"\u0627\u0644\u0639\u0631\u0628\u064a\u0629";case CB.Language.SER:return"Srbski";
    case CB.Language.LIT:return"Lietuvi\u0173";case CB.Language.BRA:return"Portugu\u00eas";case CB.Language.FAR:return"\u0641\u0627\u0631\u0633\u06cc";case CB.Language.CRO:return"Hrvatski";case CB.Language.GAL:return"Gaeilge";case CB.Language.HIN:return"\u0939\u093f\u0928\u094d\u0926\u0940";case CB.Language.CZE:return"\u010ce\u0161tina"}};CB.Language.getNativeLangNames=function(d){var b=[];d.forEach(function(c){b.push(this.getNativeLangName(c))}.bind(this));return b};
CB.Language.getFlagNames=function(d){var b=[];d.forEach(function(c){b.push(this.getRibbonFlagName(c))}.bind(this));return b};"use strict";
CB.GeoCoordinates=function(){var d=function(b,e){this.fLat=b;this.fLong=e;this.nNation=this.fHeight=0},b=function(b){return Math.PI/180*b};d.prototype={isValid:function(){return 0!=this.fLat||0!=this.fLong},toString:function(){return""},fromDataBuf:function(b){this.fLat=b.readFloat32();this.fLong=b.readFloat32();this.nNation=b.V10()},Vz:function(b){b.writeFloat32(this.fLat);b.writeFloat32(this.fLong);b.Vx(this.nNation)},getSphericDist:function(c){return this.fLat==c.fLat&&this.fLong==c.fLong?0:6378*
        Math.acos(Math.sin(b(this.fLat))*Math.sin(b(c.fLat))+Math.cos(b(this.fLat))*Math.cos(b(c.fLat))*Math.cos(b(c.fLong-this.fLong)))},getAzimuthDirection:function(c){return-Math.atan2(Math.sin(b(this.fLong-c.fLong))*Math.cos(b(this.fLat)),Math.cos(b(this.fLat))*Math.sin(b(c.fLat))-Math.sin(b(this.fLat))*Math.cos(b(c.fLat))*Math.cos(b(this.fLong-c.fLong)))},getNewPoint:function(c,e){var d=c/6378;c=Math.acos(Math.cos(d)*Math.cos(b(90-this.fLat))+Math.sin(b(90-this.fLat))*Math.sin(d)*Math.cos(b(e)));e=Math.asin(Math.sin(d)*
        Math.sin(b(e))/Math.sin(c));return new CB.GeoCoordinates(90-c/(Math.PI/180),e/(Math.PI/180)+this.fLon)},fromBrowser:function(){navigator.geolocation.getCurrentPosition(function(b){this.fLat=b.coords.latitude;this.fLong=b.coords.longitude;this.fHeight=b.coords.altitude},function(b){},{enableHighAccuracy:!1,timeout:2E4,maximumAge:"Infinite"})}};return d}();"NOMINIFY=w,h,topLeft";"use strict";
CB.Point=function(){var d=function(b,c){"object"==typeof b&&"undefined"==typeof c?void 0!=b.clientX?this.set(b.clientX,b.clientY):b.touches&&b.touches.length?this.set(b.touches[0].pageX,b.touches[0].pageY):void 0!=b.pageX&&this.set(b.pageX,b.pageY):this.set(b,c)};d.prototype.set=function(b,c){this.x=b;this.y=c};d.prototype.add=function(b){return new CB.Point(this.x+b.x,this.y+b.y)};d.prototype.subtract=function(b){return new CB.Point(this.x-b.x,this.y-b.y)};d.prototype.getDist=function(b){b=this.subtract(b);
    return Math.sqrt(b.x*b.x+b.y*b.y)};d.prototype.getVecLen=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};d.prototype.toInt=function(){this.x=Math.floor(this.x+.5);this.y=Math.floor(this.y+.5)};d.prototype.cloneIntPoint=function(){var b=new d(this.x,this.y);b.toInt();return b};d.prototype.toString=function(){return"("+this.x+","+this.y+")"};d.prototype.getX=function(){return this.x};d.prototype.getY=function(){return this.y};return d}();
CB.Size=function(){var d=function(b,c){this.w=b;this.h=c};d.prototype.toString=function(){return"w="+this.w+", h="+this.h};d.prototype.centerInSize=function(b){return new CB.Point((b.w-this.w)/2,(b.h-this.h)/2)};return d}();
CB.Rect=function(){var d=function(b,c,e,d){this.left=b||0;this.top=c||0;this.right=e||0;this.bottom=d||0};Object.defineProperty(d.prototype,"w",{get:function(){return this.getSize().w},set:function(b){this.right=this.left+b-1},enumerable:!0});Object.defineProperty(d.prototype,"h",{get:function(){return this.getSize().h},set:function(b){this.bottom=this.top+b-1},enumerable:!0});Object.defineProperty(d.prototype,"topLeft",{get:function(){return new CB.Point(this.left,this.top)},set:function(b){var c=
        this.w,e=this.h;this.left=b.x;this.top=b.y;this.w=c;this.h=e},enumerable:!0});d.prototype.fromRect=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};d.prototype.fromPosSize=function(b,c){this.left=b.x;this.top=b.y;this.right=b.x+c.w-1;this.bottom=b.y+c.h-1};d.prototype.fromClientRect=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};d.prototype.fromTwoPoints=function(b,c,e,d){this.left=Math.min(b,e);this.right=Math.max(b,e);this.top=
    Math.min(c,d);this.bottom=Math.max(c,d)};d.prototype.toString=function(){return"l="+this.left+", t="+this.top+" "+this.getSize().toString()};d.prototype.getPos=function(){return new CB.Point(this.left,this.top)};d.prototype.getTopLeft=function(){return new CB.Point(this.left,this.top)};d.prototype.getTopRight=function(){return new CB.Point(this.right,this.top)};d.prototype.getBottomRight=function(){return new CB.Point(this.right,this.bottom)};d.prototype.getBottomLeft=function(){return new CB.Point(this.left,
    this.bottom)};d.prototype.getSize=function(){return new CB.Size(this.right-this.left+1,this.bottom-this.top+1)};d.prototype.getUnion=function(b){return new CB.Rect(Math.min(Math.min(this.left,b.left),Math.min(this.right,b.right)),Math.min(Math.min(this.top,b.top),Math.min(this.bottom,b.bottom)),Math.max(Math.max(this.left,b.left),Math.max(this.right,b.right)),Math.max(Math.max(this.top,b.top),Math.max(this.bottom,b.bottom)))};d.prototype.getCutAtBoundary=function(b){var c=new CB.Rect(this.left,this.top,
    this.right,this.bottom);if(c.left<b.left||c.left>=b.right)c.left=b.left;if(c.right>b.right||c.right<=b.left)c.right=b.right;if(c.top<b.top||c.top>=b.bottom)c.top=b.top;if(c.bottom>b.bottom||c.bottom<=b.top)c.bottom=b.bottom;return c};d.prototype.isInside=function(b,c){return b>=this.left&&b<=this.right&&c>=this.top&&c<=this.bottom};d.prototype.getPath=function(){var b=new CB.Path;b.push(this.getTopLeft());b.push(this.getTopRight());b.push(this.getBottomRight());b.push(this.getBottomLeft());return b};
    d.prototype.move=function(b,c){this.left+=b;this.top+=c;this.right+=b;this.bottom+=c};d.prototype.shrink=function(b,c){this.left+=b;this.right-=b;this.top+=c;this.bottom-=c};d.prototype.expand=function(b,c){this.shrink(-b,-c)};return d}();
CB.Vector=function(){var d=function(b,c,e){this.set(b,c,e)};d.prototype.set=function(b,c,e){this.x=b;this.y=c;this.z=e};d.prototype.add=function(b){return new CB.Vec(this.x+b.x,this.y+b.y,this.z+b.z)};d.prototype.subtract=function(b){return new CB.Point(this.x-b.x,this.y-b.y,this.z-b.z)};d.prototype.getLength=function(){return void 0!==this.z?Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z):Math.sqrt(this.x*this.x+this.y*this.y)};d.prototype.negate=function(){this.x=-this.x;this.y=-this.y;void 0!==
this.z&&(this.z=-this.z)};d.prototype.toString=function(){return void 0!==this.z?"("+this.x+","+this.y+","+this.z+")":"("+this.x+","+this.y+")"};return d}();
CB.Path=function(){var d=function(){this.subPaths=[]};d.prototype.toString=function(){for(var b="Pth:",c=0;c<this.subPaths.length;c++)b+="s=",this.subPaths[c].forEach(function(c,d,g){b+=c.toString();g<d.length-1&&(b+=",")});return b};d.prototype.push=function(b){0===this.subPaths.length&&this.subPaths.push([]);this.subPaths[this.subPaths.length-1].push(b)};d.prototype.exec=function(b){b.beginPath();for(var c=0;c<this.subPaths.length;c++)1<this.subPaths[c].length&&this.execPoly(b,this.subPaths[c]);
    b.closePath()};d.prototype.execPoly=function(b,c){b.moveTo(c[0].x,c[0].y);for(var e=1;e<c.length;e++)b.lineTo(c[e].x,c[e].y)};d.prototype.curve=function(b){for(var c=0;c<this.subPaths.length;c++)3<this.subPaths[c].length&&(b.beginPath(),this.execCurve(b,this.subPaths[c]),b.closePath())};d.prototype.execCurve=function(b,c){b.moveTo(c[0].x,c[0].y);var e;for(e=1;e<c.length-2;e++)b.quadraticCurveTo(c[e].x,c[e].y,(c[e].x+c[e+1].x)/2,(c[e].y+c[e+1].y)/2);b.quadraticCurveTo(c[e].x,c[e].y,c[e+1].x,c[e+1].y)};
    d.prototype.reverse=function(){this.subPaths.length&&this.subPaths[this.subPaths.length-1].reverse()};d.prototype.append=function(b){this.subPaths=this.subPaths.concat(b.subPaths)};return d}();
CB.CanvasTools={clipRect:function(d,b){b.getPath().exec(d);d.clip()},clipRectFrame:function(d,b,c){b=b.getPath();c=c.getPath();c.reverse();b.append(c);this.clipPath(d,b)},drawRect:function(d,b,c){c&&(d.strokeStyle=c);b.getPath().exec(d);d.stroke()},fillRect:function(d,b){b.getPath().exec(d);d.fill()},clipPath:function(d,b){b.exec(d);d.clip()},drawLine:function(d,b,c,e,f){d.beginPath();d.moveTo(b,c);d.lineTo(e,f);d.stroke()},drawRoundedRect:function(d,b,c,e,f,g){e<2*g&&(g=e/2);f<2*g&&(g=f/2);d.beginPath();
        d.moveTo(b+g,c);d.arcTo(b+e,c,b+e,c+f,g);d.arcTo(b+e,c+f,b,c+f,g);d.arcTo(b,c+f,b,c,g);d.arcTo(b,c,b+e,c,g);d.stroke()},saveImage:function(d,b,c,e){(d=CB.CanvasTools.imgToBlob(d,c,e))&&window.saveAs(d,b)},imgToBlob:function(d,b,c){var e=document.createElement("canvas");e.width=b;e.height=c;d.data&&d.data.length?e.getContext("2d").putImageData(d,0,0):e.getContext("2d").drawImage(d,0,0);return CB.CanvasTools.dataURItoBlob(e.toDataURL())},dataURItoBlob:function(d){var b=atob(d.split(",")[1]);d=d.split(",")[0].split(":")[1].split(";")[0];
        for(var c=new ArrayBuffer(b.length),e=new Uint8Array(c),f=0;f<b.length;f++)e[f]=b.charCodeAt(f);if(window.Blob)return new Blob([c],{type:d})}};CB.Color=function(){var d=function(b,c,e,d){this.red=b;this.green=c;this.blue=e;this.alpha=void 0!==d?d:1};d.prototype.toString=function(){return"rgba( "+Math.round(this.red)+", "+Math.round(this.green)+", "+Math.round(this.blue)+", "+this.alpha+" )"};return d}();
CB.HSLColor=function(){var d=function(b,c,e,d){this.hue=b;this.saturation=c;this.lightness=e;this.alpha=d||1};d.prototype.toString=function(){return 1>this.alpha?"hsla( "+Math.round(this.hue)+", "+Math.round(this.saturation)+"%, "+Math.round(this.lightness)+"%, "+this.alpha+" )":"hsl( "+Math.round(this.hue)+", "+Math.round(this.saturation)+"%, "+Math.round(this.lightness)+"% )"};d.RED=0;d.YELLOW=60;d.GREEN=120;d.CYAN=180;d.BLUE=240;d.MAGENTA=300;return d}();"use strict";
CB.Bitmap=function(){var d=function(){this.loaded=!1;this.height=this.width=0;this.url="";this.callOnLoaded=function(){}};d.prototype.isValid=function(){return 0<this.width&&0<this.height};d.prototype.fromUrl=function(b){b?(this.image=new Image,V15&&V15.config.externalCommonPath&&(0>b.search("data:image/png;base64")||!CB.System.isSafari())&&(this.image.crossOrigin="Anonymous"),this.image.addEventListener("load",d.prototype.onLoaded.bind(this)),this.image.addEventListener("error",d.prototype.onError.bind(this)),
    this.url=b,this.image.src=b):CB.LogException("bmp._fromUrl","no url")};d.createFromDB=function(b,c){var e=new CB.Bitmap;b.getItem(c,function(b,d){var f=!1;d&&!b&&((b=(window.URL||window.webkitURL).createObjectURL(d))?(e.fromUrl(b),e.urlToRevoke=b,f=!0):CB.LogException("Bitmap::fromDB","imgURL null"));f||e.fromUrl(c)});return e};d.prototype.getPattern=function(b){if("undefined"!=typeof this.image&&this.loaded)return b.createPattern(this.image,"repeat")};d.prototype.copyFromCtx=function(b,c,e,d,g){try{this.imageData=
    b.getImageData(c,e,d,g),this.loaded=!0,this.width=d,this.height=g}catch(h){console.log(h)}};d.prototype.copyScaledFromCtx=function(b,c,e,d,g,h,k){try{void 0===this.canvas&&(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")),this.canvas.width=d,this.canvas.height=g,0<c+d&&0<e+g&&this.context&&b&&(this.context.drawImage(b.canvas,c,e,h,k,0,0,d,g),this.imageData=this.context.getImageData(0,0,d,g)),this.loaded=!0,this.width=d,this.height=g}catch(l){console.log(l)}};
    d.prototype.draw=function(b,c,e,d,g,h,k,l,m){if(isNaN(c)||isNaN(e)){var f=this.url.substring(0,30);CB.LogException("BmpDraw","NaN + "+f+Error().stack)}else if(f=Function.prototype.call.bind(Array.prototype.slice),this.loaded)try{if(void 0!==this.imageData){var r=f(arguments);r.splice(0,1,this.imageData);b.putImageData.apply(b,r)}else void 0!==this.image&&(r=f(arguments),r.splice(0,1,this.image),b.drawImage.apply(b,r))}catch(t){CB.LogException("BMP draw",t)}};d.prototype.drawStretched=function(b,c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      e,d,g){this.loaded&&(void 0!==this.imageData?b.putImageData(this.imageData,c,e,d,g):void 0!==this.image&&b.drawImage(this.image,c,e,d,g))};d.prototype.drawTiled=function(b,c,e,d,g){this.loaded&&(void 0!==this.imageData?this.tile(b,this.imageData,b.putImageData,c,e,d,g):void 0!==this.image&&this.tile(b,this.image,b.drawImage,c,e,d,g))};d.prototype.tile=function(b,c,e,d,g,h,k){if(isNaN(d)||isNaN(g))b=this.url.substring(0,30),CB.LogException("Tile","NaN + "+b+Error().stack);else{new CB.Rect(d,g,d+h,
        g+k);for(var f=g,m=d;f<g+k;){for(;m<d+h;){var p=this.width,r=this.height;m+p>d+h&&(p=d+h-m);f+r>g+k&&(r=g+k-f);try{e.call(b,c,0,0,p,r,m,f,p,r)}catch(t){CB.LOG("Bitmap Exception: "+t+", "+this.url,"LogException"),CB.LogException("BMP tile: ",t)}m+=this.width}m=d;f+=this.height}}};d.prototype.isValid=function(){return this.loaded};d.prototype.onLoaded=function(){this.loaded=!0;this.width=this.image.width;this.height=this.image.height;this.callOnLoaded();this.urlToRevoke&&(window.URL||window.webkitURL).revokeObjectURL(this.urlToRevoke)};
    d.prototype.onError=function(){5};return d}();"use strict";CB.namespace("CB.Sprite");
CB.Sprite=function(){var d=function(){this.bitmap=new CB.Bitmap;this.backSave=new CB.Bitmap;this.hotY=this.hotX=this.backX=this.backY=-1;this.pos=new CB.Point(0,0);this.lastPos=new CB.Point(0,0);this.isVisible=this.loaded=!1;this.h=this.w=0};d.prototype.toString=function(){return this.pos.toString()};d.prototype.fromUrl=function(b){this.bitmap.callOnLoaded=this.onLoaded.bind(this);this.bitmap.fromUrl(b)};d.prototype.copyFromCtx=function(b,c,e){this.bitmap.copyFromCtx(b,c,e);this.onLoaded()};d.prototype.fromUrlSized=
    function(b,c){this.bitmap.callOnLoaded=function(){var b=document.createElement("canvas");b&&(b=b.getContext("2d"))&&(this.bitmap.drawStretched(b,0,0,c,c),this.bitmap.copyFromCtx(b,0,0,c,c),this.onLoaded())}.bind(this);this.bitmap.fromUrl(b)};d.prototype.onLoaded=function(){this.w=this.bitmap.width;this.h=this.bitmap.height;this.hotX=Math.floor(this.w/2);this.hotY=Math.floor(this.h/2);this.loaded=!0};d.prototype.moveTo=function(b,c){this.bitmap.loaded&&(this.lastPos=this.pos,this.pos=c=c.cloneIntPoint(),
this.backSave.isValid()&&this.backSave.draw(b,this.backX-this.hotX,this.backY-this.hotY),this.externalBG&&(this.backSave=new CB.Bitmap,this.externalBG=!1),this.backSave.copyFromCtx(b,c.x-this.hotX,c.y-this.hotY,this.w,this.h),this.backX=c.x,this.backY=c.y,this.drawWithShadow(b,c.x-this.hotX,c.y-this.hotY),this.isVisible=!0)};d.prototype.setBackground=function(b){b&&(this.externalBG=!0,this.backSave=b,this.backX=this.pos.x,this.backY=this.pos.y)};d.prototype.hasBackground=function(){return this.backSave.loaded||
    this.externalBG};d.prototype.hide=function(b){this.backSave.isValid()&&this.isVisible&&(this.backSave.draw(b,this.backX-this.hotX,this.backY-this.hotY),this.isVisible=!1)};d.prototype.saveBeforeMove=function(b,c){c=c.cloneIntPoint();this.externalBG&&(this.backSave=new CB.Bitmap,this.externalBG=!1);this.backSave.copyFromCtx(b,c.x-this.hotX,c.y-this.hotY,this.w,this.h);this.backX=c.x;this.backY=c.y};d.prototype.moveToNoSave=function(b,c){this.bitmap.loaded&&(this.lastPos=this.pos,this.pos=c=c.cloneIntPoint(),
    this.drawWithShadow(b,c.x-this.hotX,c.y-this.hotY),this.isVisible=!0)};d.prototype.show=function(b){this.backSave.isValid()&&this.hotX&&(this.backSave.draw(b,this.backX-this.hotX,this.backY-this.hotY),this.externalBG&&(this.backSave=new CB.Bitmap,this.externalBG=!1),this.backSave.copyFromCtx(b,this.backX-this.hotX,this.backY-this.hotY,this.w,this.h),CB.LOG("Sprite.Show: "+(this.backX-this.hotX).toString()+", "+(this.backY-this.hotY).toString(),"","board"),this.drawWithShadow(b,this.backX-this.hotX,
    this.backY-this.hotY),this.isVisible=!0)};d.prototype.saveBackground=function(b){this.externalBG&&(this.backSave=new CB.Bitmap,this.externalBG=!1);this.backSave.copyFromCtx(b,this.backX-this.hotX,this.backY-this.hotY,this.w,this.h)};d.prototype.drawWithShadow=function(b,c,e){b.save();if(37<this.bitmap.width&&!this.noShadow){var d=Math.min(3,Math.round(Math.sqrt(this.bitmap.width/30)));b.shadowOffsetX=d;b.shadowOffsetY=d;b.shadowBlur=1*d;b.shadowColor="rgba( 40, 18, 10, 0.24 )"}this.bitmap.draw(b,
    c,e);b.restore()};d.prototype.deleteBackground=function(){this.externalBG=!1;this.backSave=new CB.Bitmap;this.backY=this.backX=-1};d.prototype.setClickArea=function(b){this.clickArea=b};d.prototype.getMoveClipRect=function(){return new CB.Rect(Math.min(this.pos.x,this.lastPos.x)-this.hotX,Math.min(this.pos.y,this.lastPos.y)-this.hotY,Math.max(this.pos.x,this.lastPos.x)+this.hotX,Math.max(this.pos.y,this.lastPos.y)+this.hotY)};return d}();
CB.Animation=function(){var d=function(b){this.cbcanvas=b;this.STARTING_FPS=30;this.gameTime=this.lastTime=0;this.startTime=this.getTimeNow();this.fps=0;this.jobs=[];this.callInAnimation=[]};d.prototype.kill=function(){window.cancelAnimationFrame(this.requestFrame);this.callInAnimation=[];this.inAnimation=!1;if(this.jobs.length){CB.LOG("Kill Animation, Jobs="+this.jobs.length,"LogRed","Board");for(var b=0;b<this.jobs.length;b++)this.jobs[b].deleteBackground();this.jobs=[];return!0}return!1};d.prototype.startMultiAnimation=
    function(b,c,e){this.forceFinish=!1;this.lastTime=this.avFPSCnt=this.avFPS=0;this.startTime=this.getTimeNow();this.clipArea=e;this.callInAnimation.push(function(){this.mergeJobs(b,c)}.bind(this));this.requestFrame=window.requestAnimationFrame(function(b){this.doMultiAnimationStep(b)}.bind(this));this.inAnimation=!0};d.prototype.doMultiAnimationStep=function(b){this.callOnBeforeEveryStep&&this.callOnBeforeEveryStep();var c=10,e=1;void 0===b&&(b=new Date);this.tick(b);for(b=0;b<this.callInAnimation.length;b++)this.callInAnimation[b]();
    this.callInAnimation=[];this.avFPSCnt+=1;this.avFPS+=this.fps;2<this.avFPSCnt&&(c=Math.floor(this.avFPS/this.avFPSCnt),40>c&&(e=1<c?Math.floor(40/c+.5):40));this.forceFinish?e=50:2<e&&CB.LOG("Joining anim Steps: "+e+", fps="+c,"LogRed");var d=this.cbcanvas.bufferCtx,g=!0;for(b=0;b<this.jobs.length;b++)this.jobs[b].shouldHideInThisStep()&&this.jobs[b].hide(d);for(b=0;b<this.jobs.length;b++)this.jobs[b].isImmobileInThisStep()&&!this.jobs[b].getsInvisibleAtEnd()&&this.jobs[b].moveToNoSave(d,this.jobs[b].currPos);
    for(b=0;b<this.jobs.length;b++)this.jobs[b].isStillMoving()&&(this.jobs[b].hasReachedEndPos()?this.jobs[b].currPos=this.jobs[b].ptTo:this.jobs[b].displace(e),this.jobs[b].saveBeforeMove(d,this.jobs[b].currPos));for(b=0;b<this.jobs.length;b++)this.jobs[b].isStillMoving()&&(this.jobs[b].moveToNoSave(d,this.jobs[b].currPos),this.cbcanvas.joinClipRect(this.jobs[b].getMoveClipRect())),this.jobs[b].prepNextStep(e)||(g=!1);this.clipArea&&this.cbcanvas.cutClipRect(this.clipArea);this.callOnAfterEveryStep&&
    this.callOnAfterEveryStep();this.cbcanvas._drawDoubleBufferClipped();this.reorgJobs();g?(this.inAnimation=!1,this.callOnAnimFinished&&this.callOnAnimFinished(),this.jobs=[]):this.requestFrame=window.requestAnimationFrame(function(b){this.doMultiAnimationStep(b)}.bind(this));g||(3<this.avFPSCnt?this.currFPS=c:delete this.currFPS)};d.prototype.quickFinish=function(){window.cancelAnimationFrame(this.requestFrame);this.forceFinish=!0;this.requestFrame=window.requestAnimationFrame(function(b){this.doMultiAnimationStep(b)}.bind(this))};
    d.prototype.hideAll=function(){this.jobs.forEach(function(b){b.shouldHideInThisStep()&&b.hide(this.cbcanvas.bufferCtx)}.bind(this))};d.prototype.showAll=function(){this.jobs.forEach(function(b){b.shouldHideInThisStep()&&b.show(this.cbcanvas.bufferCtx)}.bind(this))};d.prototype.reorgJobs=function(){for(var b=[],c=0;c<this.jobs.length;c++)this.jobs[c].canDelete()||b.push(this.jobs[c]);this.jobs=b};d.prototype.mergeJobs=function(b,c){for(var e=this.cbcanvas.bufferCtx,d=0;d<this.jobs.length;d++)this.jobs[d].hide(e);
        for(d=0;d<b.length;d++)b[d].hide(e);for(d=0;d<this.jobs.length;d++)-1==this.jobs[d].sqTo&&this.jobs[d].moveTo(e,this.jobs[d].ptTo);for(d=0;d<this.jobs.length;d++)-1!=this.jobs[d].sqTo&&this.jobs[d].moveTo(e,this.jobs[d].ptTo);var g=0<this.jobs.length;this.jobs=[];for(d=0;d<b.length;d++)b[d].startAnimation(e,c),b[d].deleteBackground(),b[d].moveTo(e,b[d].ptFrom),this.jobs.push(b[d]);return g};d.prototype.tick=function(b){this.updateFrameRate(b);this.gameTime=this.getTimeNow()-this.startTime;this.lastTime=
        b};d.prototype.updateFrameRate=function(b){0==this.lastTime&&(this.lastTime=this.startTime);this.fps=0===this.lastTime||this.lastTime==b?this.STARTING_FPS:1E3/(b-this.lastTime)};d.prototype.getTimeNow=function(){return(new Date).getTime()};return d}();"use strict";
CB.DataBuffer=function(){var d=function(){this.nSize=this.nPos=0;this.buffer=new ArrayBuffer(188);this.viewBuf=new DataView(this.buffer);this.nSizeMarker=[];this.nMarkedSize=[]};d.prototype.clear=function(){this.nSize=this.nPos=0;this.nSizeMarker=[];this.nMarkedSize=[]};d.prototype.rewind=function(){this.nPos=0;this.nSizeMarker=[];this.nMarkedSize=[]};d.prototype.getPos=function(){return this.nPos};d.prototype.setPos=function(b){if(b<=this.nSize&&b<=this.buffer.byteLength)this.nPos=b;else throw"Error: SetPos exceeds DataBuffer size";
};d.prototype.getSize=function(){return this.nSize};d.prototype.setSize=function(b){if(b>=this.buffer.byteLength)throw"DBuf setSize illegal";this.nSize=b};d.prototype.getWriteSize=function(){return this.nSize+4};d.prototype.writeToDataView=function(b,c){b.setInt32(c,this.nSize);this._swapBytes(b,c,4);c+=4;for(var e=0;e<this.nSize;e++)b.setUint8(e+c,this.viewBuf.getUint8(e))};d.prototype.readFromDataView=function(b,c){this._swapBytes(b,c,4);var e=b.getInt32(c);if(35E4>e&&0<=e){this._checkAlloc(e);
    c+=4;for(var d=0;d<e;d++){var g=b.getUint8(d+c);this.viewBuf.setUint8(d,g)}this._incSize(e)}};d.prototype.Vn=function(b){b=CB.strUtil.encodeUTF8(b);this.V8(b)};d.prototype.V8=function(b){this._checkAlloc(b.length+4);this.Vx(b.length);for(var c=0;c<b.length;c++){var e=b.charCodeAt(c);this.viewBuf.setUint8(this.nPos+c,e)}this._incSize(b.length)};d.prototype.Vq=function(b){var c=this.V10();if(c<=b&&25E4>c){b="";for(var e=0;e<c;e++){var d=this.viewBuf.getUint8(this.nPos+e);b+=String.fromCharCode(d)}b=
    CB.strUtil.decodeUTF8(b);this.nPos+=c}else throw Error("Data Error: Read String");return b};d.prototype.V5=function(b){this._checkAlloc(b.length+4);this.Vx(b.length);for(var c=0;c<b.length;c++){var e=b.charCodeAt(c);this.viewBuf.setUint8(this.nPos+c,e)}this._incSize(b.length)};d.prototype.V6=function(b){var c="",e=this.V10();if(e<=b&&25E4>e){for(b=0;b<e;b++){var d=this.viewBuf.getUint8(this.nPos+b);c+=String.fromCharCode(d)}this.nPos+=e}else throw Error(String.f("Data Error: Read String, Len={0}, maxLen={1}",
    e,b));return c};d.prototype.writeByteLenASCIIString=function(b){this._checkAlloc(b.length+2);this.writeUint8(b.length+1);for(var c=0;c<b.length;c++){var e=b.charCodeAt(c);this.viewBuf.setUint8(this.nPos+c,e)}this.viewBuf.setUint8(this.nPos+b.length,0);this._incSize(b.length+1)};d.prototype.readByteLenASCIIString=function(b){var c="",e=this.readUint8();0<e&&--e;if(1E3>e){for(var d=0;d<e;d++){var g=this.viewBuf.getUint8(this.nPos+d);c+=String.fromCharCode(g)}if(e<=b)this.nPos+=e+1;else throw Error(String.f("Data Error: Read ByteLenString, len={0}, maxLen={1}",
    e,b));}else throw Error(String.f("Data Error: Read ByteLenString > 1000, len={0}",e));return c};d.prototype.readSizedString=function(b){var c="";if(25E4>b){for(var e=0;e<b;e++){var d=this.viewBuf.getUint8(this.nPos+e);c+=String.fromCharCode(d)}this.nPos+=b}else throw Error("Data Error: Read SizedString, max="+b);return c};d.prototype.writeSizedString=function(b){var c=b.length;this._checkAlloc(c);for(var e=0;e<c;e++){var d=b.charCodeAt(e);this.viewBuf.setUint8(this.nPos+e,d)}this._incSize(c)};d.prototype.readSizedUTF8String=
    function(b){if(25E4>b){var c="";for(var e=0;e<b;e++){var d=this.viewBuf.getUint8(this.nPos+e);c+=String.fromCharCode(d)}c=CB.strUtil.decodeUTF8(c);this.nPos+=b}else throw Error("Data Error: Read UTF8String, len="+b);return c};d.prototype.readByteArray=function(b){for(var c=[],e=0;e<b&&this.nPos+e<this.nSize;e++)c.push(this.viewBuf.getUint8(this.nPos+e));this.nPos+=b;return c};d.prototype.writeByteArray=function(b,c){for(var e=0;e<b.length&&e<c;e++)this.writeByte(b[e])};d.prototype.writeDataBuffer=
    function(b){this.Vx(b.getSize());this._checkAlloc(b.getSize());for(var c=0;c<b.getSize();c++)this.viewBuf.setUint8(this.nPos+c,b.viewBuf.getUint8(c));this._incSize(b.getSize())};d.prototype.readDataBuffer=function(){var b=new CB.DataBuffer,c=this.V10();b._checkAlloc(c);for(var e=0;e<c;e++)b.viewBuf.setUint8(e,this.viewBuf.getUint8(this.nPos+e));this.nPos+=c;b._incSize(c);b.nPos=0;return b};d.prototype.writeData=function(b){this._checkAlloc(b.getSize());for(var c=0;c<b.getSize();c++)this.viewBuf.setUint8(this.nPos+
    c,b.viewBuf.getUint8(c));this._incSize(b.getSize())};d.prototype.V13=function(b){if(void 0===b)throw Error("V13, value undefined");this._checkAlloc(1);b?this.viewBuf.setUint8(this.nPos,1):this.viewBuf.setUint8(this.nPos,0);this._incSize(1)};d.prototype.V14=function(b){b=this.viewBuf.getUint8(this.nPos);this.nPos+=1;return 0!=b};d.prototype.writeUint8=function(b){if(void 0===b)throw Error("writeUint8, value undefined");this._checkAlloc(1);this.viewBuf.setUint8(this.nPos,b);this._incSize(1)};d.prototype.readUint8=
    function(){var b=this.viewBuf.getUint8(this.nPos);this.nPos+=1;return b};d.prototype.readByte=d.prototype.readUint8;d.prototype.writeByte=d.prototype.writeUint8;d.prototype.Vv=function(b){if(void 0===b)throw Error("Vv, value undefined");this._checkAlloc(2);this.viewBuf.setInt16(this.nPos,b);this._swapBytes(this.viewBuf,this.nPos,2);this._incSize(2)};d.prototype.V11=function(){var b=0;this.nPos<=this.viewBuf.byteLength-2&&(this._swapBytes(this.viewBuf,this.nPos,2),b=this.viewBuf.getInt16(this.nPos),
    this._swapBytes(this.viewBuf,this.nPos,2),this.nPos+=2);return b};d.prototype.readShort=d.prototype.V11;d.prototype.writeShort=d.prototype.Vv;d.prototype.Vi=function(b){if(void 0===b)throw Error("Vi, value undefined");this._checkAlloc(2);this.viewBuf.setUint16(this.nPos,b);this._swapBytes(this.viewBuf,this.nPos,2);this._incSize(2)};d.prototype.Vu=function(){var b=0;this.nPos<=this.viewBuf.byteLength-2&&(this._swapBytes(this.viewBuf,this.nPos,2),b=this.viewBuf.getUint16(this.nPos),this._swapBytes(this.viewBuf,
    this.nPos,2),this.nPos+=2);return b};d.prototype.Vx=function(b){if(void 0===b)throw Error("Vx, value undefined");this._checkAlloc(4);this.viewBuf.setInt32(this.nPos,b);this._swapBytes(this.viewBuf,this.nPos,4);this._incSize(4)};d.prototype.writeFakeInt64=function(b){this.Vx(b);this.Vx(0)};d.prototype.readFakeInt64=function(){var b=this.V10();this.V10();return b};d.prototype.V10=function(){var b=0;this.nPos<=this.viewBuf.byteLength-4&&(this._swapBytes(this.viewBuf,this.nPos,4),b=this.viewBuf.getInt32(this.nPos),
    this._swapBytes(this.viewBuf,this.nPos,4),this.nPos+=4);return b};d.prototype.writeInt=d.prototype.Vx;d.prototype.readInt=d.prototype.V10;d.prototype.Vh=function(b){this._checkAlloc(4);this.viewBuf.setUint32(this.nPos,b);this._swapBytes(this.viewBuf,this.nPos,4);this._incSize(4)};d.prototype.Vw=function(){var b=0;this.nPos<=this.viewBuf.byteLength-4&&(this._swapBytes(this.viewBuf,this.nPos,4),b=this.viewBuf.getUint32(this.nPos),this._swapBytes(this.viewBuf,this.nPos,4),this.nPos+=4);return b};d.prototype.Vg=
    function(b){b=b.getYear()<<9|b.getMonth()<<5|b.getDay();this.Vh(b)};d.prototype.Vs=function(){var b=new CB.Date,c=this.Vw();b.setYear(c>>9);b.setMonth(c>>5&15);b.setDay(c&31);return b};d.prototype.readCBTime=function(){var b=this.Vw();return new CB.Time(b)};d.prototype.Vt=function(b){if(void 0===b)throw Error("Vt, value undefined");var c=Math.floor(b/4294967296);this.Vx(b-c);this.Vx(c)};d.prototype.readUint64=function(){if(this.nPos<=this.viewBuf.byteLength-8){this._swapBytes(this.viewBuf,this.nPos,
    8);var b=this.viewBuf.getUint32(this.nPos);this.nPos+=4;var c=this.viewBuf.getUint32(this.nPos);this.nPos+=4;return 4294967296*b+c}return 0};d.prototype.Vy=function(){if(this.nPos<=this.viewBuf.byteLength-8){this._swapBytes(this.viewBuf,this.nPos,8);var b=this.viewBuf.getInt32(this.nPos);this.nPos+=4;var c=this.viewBuf.getUint32(this.nPos);this.nPos+=4;return 4294967296*b+c}return 0};d.prototype.writeFloat32=function(b){this._checkAlloc(4);this.viewBuf.setFloat32(this.nPos,b);this._swapBytes(this.viewBuf,
    this.nPos,4);this._incSize(4)};d.prototype.readFloat32=function(){this._swapBytes(this.viewBuf,this.nPos,4);var b=this.viewBuf.getFloat32(this.nPos);this.nPos+=4;return b};d.prototype.writeFloat64=function(b){this._checkAlloc(8);this.viewBuf.setFloat64(this.nPos,b);this._swapBytes(this.viewBuf,this.nPos,8);this._incSize(8)};d.prototype.readFloat64=function(){this._swapBytes(this.viewBuf,this.nPos,8);var b=this.viewBuf.getFloat64(this.nPos);this.nPos+=8;return b};d.prototype.exportAsCompressedString=
    function(){for(var b=this.getSize(),c=[],e=0;e<b;e++){var d=this.viewBuf.getUint8(e);c[e]=d}return CB.BinToString.ByteArrayToString(c,b)};d.prototype.constructFromString=function(b,c){this.clear();if(c){if(c=[],b=CB.BinToString.StringToByteArray(c,b),0<b)for(var e=0;e<b;e++)this.writeByte(c[e])}else for(c=0,10<b.length&&(c=parseInt(b.substr(0,10),10)),0>c&&(c=0),e=0;e<c;e++){var d=b.substr(10+2*e,2);d=parseInt(d,16);this.writeByte(d)}};d.prototype.constructFromBase64=function(b){this.clear();b=CB.strUtil.base64.decodeToBinary(b);
    for(var c=new Uint8Array(b),e=0;e<b.byteLength;e++)this.writeByte(c[e]);this.writeByteArray(b,b.byteLength);this.rewind()};d.prototype.readBEInt32=function(){var b=this.readUint8(),c=this.readUint8(),e=this.readUint8(),d=this.readUint8();return b<<24|c<<16|e<<8|d};d.prototype.writeBEInt32=function(b){if(void 0===b)throw Error("Vx, value undefined");this._checkAlloc(4);this.viewBuf.setInt32(this.nPos,b);this._incSize(4)};d.prototype.readBEInt24=function(){var b=this.readUint8(),c=this.readUint8(),
    e=this.readUint8();return b<<16|c<<8|e};d.prototype.readBEInt16=function(){var b=this.readUint8(),c=this.readUint8();return 256*b+c};d.prototype.writeBEInt24=function(b){var c=b>>8,e=b&255;this.writeUint8(b>>16);this.writeUint8(c);this.writeUint8(e)};d.prototype.writeBEInt16=function(b){var c=b&255;this.writeUint8(b>>8);this.writeUint8(c)};d.prototype.writeArray=function(b){var c=b.length;this.Vx(c);for(var e=0;e<c;++e)b[e].write(this)};d.prototype.writeArrayShort=function(b){var c=b.length;this.Vv(c);
    for(var e=0;e<c;++e)b[e].write(this)};d.prototype.readArray=function(b,c){var e=this.V10();65534<e&&CBDebug.assert(65535>e);b.length=e;for(var d=0;d<e;++d){var g=c(this);b[d]=g}};d.prototype.readArrayShort=function(b,c){var e=this.V11();b.length=e;for(var d=0;d<e;++d){var g=c(this);b[d]=g}};d.prototype.beginSizedWrite=function(){this.nSizeMarker.push(this.getPos());this.Vx(0)};d.prototype.endSizedWrite=function(){var b=this.getPos();if(0<this.nSizeMarker.length){this.setPos(this.nSizeMarker[this.nSizeMarker.length-
1]);var c=this.nSize;this.Vx(b-this.nSizeMarker[this.nSizeMarker.length-1]-4);this.nSize=c;this.setPos(b);this.nSizeMarker.pop()}else throw Error("DB::EndWrite");};d.prototype.beginSizedRead=function(){this.nSizeMarker.push(this.getPos());this.nMarkedSize.push(this.V10())};d.prototype.endSizedRead=function(){if(0<this.nSizeMarker.length&&0<this.nMarkedSize.length){var b=this.getPos()-this.nSizeMarker[this.nSizeMarker.length-1]-4;this.skip(this.nMarkedSize[this.nMarkedSize.length-1]-b);this.nSizeMarker.pop();
    this.nMarkedSize.pop()}else throw Error("DB::EndRead");};d.prototype.skipSizedRead=function(){var b=this.V10();this.skip(b)};d.prototype.skip=function(b){this.nPos+b<=this.nSize&&(this.nPos+=b)};d.prototype.writeAtPrevPos=function(b,c){var e=this.getPos();this.setPos(b);c();this.setPos(e)};d.prototype._checkAlloc=function(b){if(this.nPos+b>=this.buffer.byteLength||this.nSize+b>=this.buffer.byteLength){var c=Math.max(this.nPos,this.nSize),e=8*Math.floor(3*(c+b)/16+1);if(e<b+c)throw"DataBuffer Size";
    b=new ArrayBuffer(e);c=new DataView(b);for(e=0;e<this.buffer.byteLength/4;e++)c.setUint32(4*e,this.viewBuf.getUint32(4*e));this.buffer=b;this.viewBuf=c}};d.prototype._incSize=function(b){if(this.nPos+b>=this.buffer.byteLength)throw"DataBuffer overrun";this.nPos+=b;this.nSize+=b;if(this.nSize>=this.buffer.byteLength)throw"DataBuffer Size Limit exc.";};d.prototype._swapBytes=function(b,c,e){for(var d=[],g=0;g<e;g++)d.push(b.getUint8(c+g));for(g=0;g<e;g++)b.setUint8(c+g,d[e-g-1])};return d}();
function createReadFactory(d){return function(b){var c=new d;c.read(b);return c}}function createReadFactory2(d){return function(b){var c=new d;c.read2(b);return c}}"use strict";
CB.Set=function(){var d=function(b){this.bag=[];var c;if(0<arguments.length)for(c=0;c<b.length;c++)this.insert(b[c])};d.prototype.clear=function(){this.bag=[]};d.prototype.search=function(b,c){for(var e=this.bag.length,d,g=2==arguments.length?c:0;g<e;){d=g+Math.floor((e-g)/2);if(this.bag[d].setEquals(b))return d;b.setGreater(this.bag[d])?g=d+1:e=d}return g};d.prototype.insert=function(b){var c=this.search(b);void 0!==this.bag[c]&&this.bag[c].setEquals(b)||this.bag.splice(c,0,b)};d.prototype.contains=
    function(b){var c=this.search(b);return void 0!==this.bag[c]?this.bag[c].setEquals(b):!1};d.prototype.get=function(b){var c=this.search(b);if(void 0!==this.bag[c]&&this.bag[c].setEquals(b))return this.bag[c]};d.prototype.size=function(){return this.bag.length};d.prototype.getElements=function(){return this.bag};d.prototype.equals=function(b){if(this.size()!=b.size())return!1;var c;for(c=0;c<this.bag.length;c++)if(!this.bag[c].setEquals(b.bag[c]))return!1;return!0};d.prototype.save=function(b,c){var e=
    new CB.Storage;e.save(b+"_len",this.bag.length);for(var d=0;d<this.bag.length;d++)c&&!c(this.bag[d])||e.save(b+"_o"+d,this.bag[d])};d.prototype.load=function(b,c){var e=new CB.Storage,d=e.load(b+"_len");if(d)for(var g=0,h=0;h<d;h++){var k=e.load(b+"_o"+h);c?(k=c(k))&&(this.bag[g++]=k):this.bag[g++]=k}};return d}();
CB.NativeSet=function(){var d=function(b){this.bag=[];var c;if(0<arguments.length)for(c=0;c<b.length;c++)this.insert(b[c])};d.prototype.clear=function(){this.bag=[]};d.prototype.search=function(b,c){for(var e=this.bag.length,d,g=2==arguments.length?c:0;g<e;){d=g+Math.floor((e-g)/2);if(this.bag[d]==b)return d;b>this.bag[d]?g=d+1:e=d}return g};d.prototype.insert=function(b){var c=this.search(b);void 0!==this.bag[c]&&this.bag[c]==b||this.bag.splice(c,0,b)};d.prototype.contains=function(b){var c=this.search(b);
    return void 0!==this.bag[c]?this.bag[c]==b:!1};d.prototype.get=function(b){var c=this.search(b);if(void 0!==this.bag[c]&&this.bag[c]==b)return this.bag[c]};d.prototype.size=function(){return this.bag.length};d.prototype.getElements=function(){return this.bag};d.prototype.equals=function(b){if(this.size()!=b.size())return!1;var c;for(c=0;c<this.bag.length;c++)if(this.bag[c]!=b.bag[c])return!1;return!0};d.prototype.save=function(b,c){var e=new CB.Storage;e.save(b+"_len",this.bag.length);for(var d=0;d<
this.bag.length;d++)c&&!c(this.bag[d])||e.save(b+"_o"+d,this.bag[d])};d.prototype.load=function(b,c){var e=new CB.Storage,d=e.load(b+"_len");if(d)for(var g=0,h=0;h<d;h++){var k=e.load(b+"_o"+h);c?(k=c(k))&&(this.bag[g++]=k):this.bag[g++]=k}};return d}();"use strict";CB.namespace("CB.VectorSender");
CB.VectorSender=function(){var d=function(b){this.sendFn=b;this.sendBuffers={};this.endOfVec={}};d.staticIdVector=0;d.staticIdBunch=0;d.prototype.receiveVector=function(b,c,e,d){var f={vec:[],overhead:new CB.DataBuffer},h=b.getBuf().Vw();b.getBuf().Vw();var k=b.getBuf().Vw();b.getBuf().Vw();f.overhead=b.getBuf().readDataBuffer();if(0<k){for(var l=b.getBuf().V10(),m=0;m<l&&3E4>m;m++){var p=d(b.getBuf());f.vec.push(p)}c=new CB.WebSockMessage(c);c.setUserType(e);c.getBuf().Vh(h);c.getBuf().Vh(0);c.getBuf().Vh(k);
    c.getBuf().Vh(0);c.getBuf().Vx(l);c.address(b.getIdReceiver(),b.Vj());this.sendFn(c)}return f};d.prototype.sendVector=function(b,c,e,f,g,h,k,l){var m=++d.staticIdVector,p=++d.staticIdBunch,r=0;do{var t=new CB.DataBuffer;t.Vx(m);t.Vx(0);t.Vx(p);t.Vx(0);t.writeDataBuffer(k);var w=0,q=t.getPos();t.Vx(w);if(e.length){var u;do{var y=t.getSize(),z=t.getPos();l(t,e[r]);(u=t.getSize()<f)||0==w?(w++,r++):(t.setPos(z),t.setSize(y))}while(u&&r<e.length);u=t.getPos();t.setPos(q);t.Vx(w);t.setPos(u)}this.sendBuffers[p]=
    {sender:b,receiver:c,buf:t,idBunch:p,idVec:m,msgType:g,userType:h,nSent:0};p++}while(r<e.length);this.endOfVec[m]={idVec:m,data:{msgType:g,userType:h,overHead:k}};this.sendNextBunch(b,c,m)};d.prototype.sendNextBunch=function(b,c,e){var d=!1;for(h in this.sendBuffers)if(this.sendBuffers.hasOwnProperty(h)){var g=this.sendBuffers[h];d=d||g.idVec==e;if(0==e||g.idVec==e){if(0==g.nSent%10){var h=new CB.WebSockMessage(g.msgType);h.setUserType(g.userType);h.getBuf().writeData(g.buf);h.address(b,c);this.sendFn(h);
    CB.LOG("Send Bunch = "+g.idBunch+", vec="+g.idVec+", sent="+g.nSent,"LogGreen")}g.nSent++;break}}!d&&(d=this.endOfVec[e])&&(h=new CB.WebSockMessage(d.data.msgType),h.setUserType(d.data.userType),h.getBuf().writeFakeInt64(e),h.getBuf().writeFakeInt64(0),h.getBuf().writeDataBuffer(d.data.overHead),h.address(b,c),this.sendFn(h),delete this.endOfVec[e])};d.prototype.handleConfirmBunch=function(b){var c=b.getBuf().readFakeInt64(),e=b.getBuf().readFakeInt64(),d=b.getBuf().V10();this.sendBuffers[e]?CB.LOG("Confirm Bunch = "+
    e+", idVec="+c+", nItems="+d,"LogGreen"):CB.LOG("Confirm Bunch not found: "+e+", idVec="+c,"LogError");delete this.sendBuffers[e];this.sendNextBunch(b.getIdReceiver(),b.Vj(),c);return d};return d}();"use strict";CB.Side={NONE:-1,WHITE:0,BLACK:1,SIDE_OFFSET:3};CB.Side.SIDE_MASK=8;CB.Side.other=function(d){return d^CB.Side.BLACK};CB.Side.fromString=function(d){return"w"===d?CB.Side.WHITE:CB.Side.BLACK};CB.Side.toString=function(d){return d===CB.Side.WHITE?"w":"b"};
CB.Piece={NONE:0,KING:1,QUEEN:2,KNIGHT:3,BISHOP:4,ROOK:5,PAWN:6,W_KING:1,W_QUEEN:2,W_KNIGHT:3,W_BISHOP:4,W_ROOK:5,W_PAWN:6,B_KING:9,B_QUEEN:10,B_KNIGHT:11,B_BISHOP:12,B_ROOK:13,B_PAWN:14,COLOUR:8,WHITE:0,BLACK:8,JOKER:7};CB.Piece.PIECE_MASK=7;CB.Piece.SIDE_MASK=8;CB.Piece.nominal=function(d){return d&CB.Piece.PIECE_MASK};CB.Piece.side=function(d){return(d&CB.Side.SIDE_MASK)/8};CB.Piece.changeSide=function(d){return d^CB.Side.SIDE_MASK};CB.Piece.make=function(d,b){return d|8*b};
CB.Piece.g_arrPieces=" KQNBRP  kqnbrp".split("");CB.Piece.toString=function(d){return CB.Piece.g_arrPieces[d]};CB.Piece.fromString=function(d){d=CB.Piece.g_arrPieces.indexOf(d);return 0>d?CB.Piece.NONE:d};CB.Piece.getNameAccusative=function(d){switch(d){case CB.Piece.KING:return lm.KING_ACC;case CB.Piece.QUEEN:return lm.QUEEN_ACC;case CB.Piece.KNIGHT:return lm.KNIGHT_ACC;case CB.Piece.BISHOP:return lm.BISHOP_ACC;case CB.Piece.ROOK:return lm.ROOK_ACC;case CB.Piece.PAWN:return lm.PAWN_ACC}};
CB.CastleRights={NONE:0,W_000:1,W_00:2,B_000:4,B_00:8};CB.CastleRights.W_ALL=CB.CastleRights.W_00|CB.CastleRights.W_000;CB.CastleRights.B_ALL=CB.CastleRights.B_00|CB.CastleRights.B_000;CB.CastleRights.ALL=CB.CastleRights.W_ALL|CB.CastleRights.B_ALL;CB.CastleRights.toString=function(d){if(d===CB.CastleRights.NONE)return"-";var b="";d&CB.CastleRights.W_00&&(b+="K");d&CB.CastleRights.W_000&&(b+="Q");d&CB.CastleRights.B_00&&(b+="k");d&CB.CastleRights.B_000&&(b+="q");return b};
CB.CastleRights.fromString=function(d){var b=CB.CastleRights.NONE;d=new StringIterator(d);for(var c=d.Next();0!==c;c=d.Next())switch(c){case "K":b|=CB.CastleRights.W_00;break;case "Q":b|=CB.CastleRights.W_000;break;case "k":b|=CB.CastleRights.B_00;break;case "q":b|=CB.CastleRights.B_000}return b};
CB.Square={ROW_OFFSET:0,ROW_MASK:7,COL_OFFSET:3,COL_MASK:56,A1:0,A2:1,A3:2,A4:3,A5:4,A6:5,A7:6,A8:7,B1:8,B2:9,B3:10,B4:11,B5:12,B6:13,B7:14,B8:15,C1:16,C2:17,C3:18,C4:19,C5:20,C6:21,C7:22,C8:23,D1:24,D2:25,D3:26,D4:27,D5:28,D6:29,D7:30,D8:31,E1:32,E2:33,E3:34,E4:35,E5:36,E6:37,E7:38,E8:39,F1:40,F2:41,F3:42,F4:43,F5:44,F6:45,F7:46,F8:47,G1:48,G2:49,G3:50,G4:51,G5:52,G6:53,G7:54,G8:55,H1:56,H2:57,H3:58,H4:59,H5:60,H6:61,H7:62,H8:63,C_A:0,C_B:1,C_C:2,C_D:3,C_E:4,C_F:5,C_G:6,C_H:7,R_1:0,R_2:1,R_3:2,R_4:3,
    R_5:4,R_6:5,R_7:6,R_8:7};CB.Sq=CB.Square;CB.Square.g_arrSquareStrs="a1 a2 a3 a4 a5 a6 a7 a8 b1 b2 b3 b4 b5 b6 b7 b8 c1 c2 c3 c4 c5 c6 c7 c8 d1 d2 d3 d4 d5 d6 d7 d8 e1 e2 e3 e4 e5 e6 e7 e8 f1 f2 f3 f4 f5 f6 f7 f8 g1 g2 g3 g4 g5 g6 g7 g8 h1 h2 h3 h4 h5 h6 h7 h8".split(" ");CB.Square.toString=function(d){return this.g_arrSquareStrs[d]};CB.Square.getStr=CB.Square.toString;CB.Square.getStrXY=function(d,b){return CB.Square.getStr(CB.Square.get64(d,b))};
CB.Square.colToString=function(d){return String.fromCharCode("a".charCodeAt()+d)};CB.Square.rowToString=function(d){return d+1};CB.Square.colFromString=function(d){return d.charCodeAt(0)-"a".charCodeAt()};CB.Square.rowFromString=function(d){return d.charCodeAt(0)-"1".charCodeAt()};CB.Square.fromString=function(d){if(d&&2===d.length){var b=CB.Square.colFromString(d.charAt(0));d=CB.Square.rowFromString(d.charAt(1));return CB.Square.I(b,d)}};CB.Square.R=function(d){return(d&CB.Square.ROW_MASK)>>CB.Square.ROW_OFFSET};
CB.Square.C=function(d){return(d&CB.Square.COL_MASK)>>CB.Square.COL_OFFSET};CB.Square.F=function(d){return(d&CB.Square.COL_MASK)>>CB.Square.COL_OFFSET};CB.Square.getRank=CB.Square.R;CB.Square.getFile=CB.Square.C;CB.Square.DIST=function(d,b){var c=CB.Square.R(d)-CB.Square.R(b);d=CB.Square.C(d)-CB.Square.C(b);return Math.sqrt(c*c+d*d)};CB.Square.I=function(d,b){return 8*d+b};CB.Square.get64=CB.Square.I;CB.Square.isLegal=function(d,b){return d<=CB.Square.C_H&&d>=CB.Square.C_A&&b<=CB.Square.R_8&&b>=CB.Square.R_1};
CB.Square.isDark=function(d){var b=CB.Square.C(d);d=CB.Square.R(d);return!((b+d)%2)};CB.Square.isLight=function(d){return!CB.Square.isDark(d)};CB.Square.isCenterFile=function(d){return CB.Square.F(d)==CB.Square.C_D||CB.Square.F(d)==CB.Square.C_E};CB.Square.isCenterRank=function(d){return CB.Square.R(d)==CB.Square.R_4||CB.Square.R(d)==CB.Square.R_5};CB.Square.isCenterSquare=function(d){return CB.Square.isCenterFile(d)&&CB.Square.isCenterRank(d)};
CB.Square.getDist=function(d,b){var c=CB.Square.getFile(d)-CB.Square.getFile(b);d=CB.Square.getRank(d)-CB.Square.getRank(b);return Math.sqrt(c*c+d*d)};CB.Square.getFileDist=function(d,b){return CB.Square.getFile(d)-CB.Square.getFile(b)};CB.Square.getPromRow=function(d){return d===CB.Side.WHITE?CB.Square.R_8:CB.Square.R_1};"use strict";
CB.Board=function(){var d=function(b){this.sqs=[];for(var c=0;64>c;c++)this.sqs.push(0);b&&this.setup()};d.SIZE=64;d.prototype.setup=function(){this.sqs=[CB.Piece.W_ROOK,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_ROOK,CB.Piece.W_KNIGHT,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_KNIGHT,CB.Piece.W_BISHOP,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_BISHOP,CB.Piece.W_QUEEN,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_QUEEN,CB.Piece.W_KING,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,
    CB.Piece.B_KING,CB.Piece.W_BISHOP,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_BISHOP,CB.Piece.W_KNIGHT,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_KNIGHT,CB.Piece.W_ROOK,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_ROOK]};d.prototype.clear=function(){this.sqs.forEach(function(b,c,e){e[c]=0})};d.prototype.fromPosStr=function(b){for(var c=CB.Side.WHITE,e=CB.Piece.KING,d=0;d<b.length;d++)switch(b[d]){case "K":e=CB.Piece.KING;break;case "Q":e=CB.Piece.QUEEN;break;case "R":e=CB.Piece.ROOK;
    break;case "B":e=CB.Piece.BISHOP;break;case "N":e=CB.Piece.KNIGHT;break;case "P":e=CB.Piece.PAWN;break;case "a":case "b":case "c":case "d":case "e":case "f":case "g":case "h":var g=b.charCodeAt(d),h=b.charCodeAt(d+1);49<=h&&56>=h?this.sqs[(g-97<<3)+h-49]=e|c:98==g&&(c=CB.Side.SIDE_MASK);break;case "w":c=CB.Side.WHITE}};d.prototype.copyFrom=function(b){for(var c=0;c<b.length;c++)this.sqs[c]=b[c]};d.prototype.copyTo=function(b){for(var c=0;64>c;c++)b[c]=this.sqs[c]};d.prototype.set=function(b,c){this.sqs[b]=
    c};d.prototype.get=function(b){return this.sqs[b]};d.prototype.change=function(b,c){this.sqs[c]=this.sqs[b];this.sqs[b]=0};d.prototype.promo=function(b,c,e){this.sqs[c]=e;this.sqs[b]=0};d.prototype.enPassant=function(b,c,e){this.sqs[c]=this.sqs[b];this.sqs[b]=0;this.sqs[e]=0};d.prototype.writeToDataBuffer=function(b){for(var c=0;64>c;c++)b.writeByte(this.sqs[c])};d.prototype.toDebugStrs=function(){for(var b=[],c=7;0<=c;c--){for(var e="",d=0;8>d;d++){var g=this.get(8*d+c);e=g?e+CB.Piece.g_arrPieces[g]:
    CB.Square.isDark(8*d+c)?e+".":e+" "}b.push(e)}return b};d.prototype.findSamePieceClosestSquare=function(b,c,e,d){for(c=0;64>c;c++)if((void 0===d||!d[c])&&e[c]==b)return c;return-1};d.prototype.test=function(){var b=new CB.Board;b.setup();b.toDebugStrs().forEach(function(b){CB.LOG(b)})};return d}();"use strict";
CB.Undo=function(){var d=function(b,c){void 0!==b?(this.cr=b.cr,this.ep=b.ep,this.mvd=b.board[c.from],this.vct=b.board[c.to]):(this.cr=CB.CastleRights.NONE,this.ep=0,this.mvd=this.vct=CB.Piece.NONE);void 0!==c&&(this.fldVct=c.to);this.from2=this.to2=0};d.prototype.setEP=function(b,c){this.fldVct=c;this.vct=b};d.prototype.setCastle=function(b,c){this.from2=b;this.to2=c};return d}();"use strict";
CB.Move=function(){var d=function(b,c,e){this.to=this.from=0;this.prom=CB.Piece.NONE;b&&(this.from=b);c&&(this.to=c);e&&(this.prom=e)};d.g_mvW00=new d(CB.Square.E1,CB.Square.G1);d.g_mvW000=new d(CB.Square.E1,CB.Square.C1);d.g_mvB00=new d(CB.Square.E8,CB.Square.G8);d.g_mvB000=new d(CB.Square.E8,CB.Square.C8);d.prototype.isACheck=!1;d.prototype.isAMate=!1;d.prototype.needCol=!1;d.prototype.needRow=!1;d.prototype.mvd=CB.Piece.NONE;d.prototype.vct=CB.Piece.NONE;Object.defineProperty(d.prototype,"piece",
    {get:function(){return this.mvd},set:function(b){this.mvd=b},enumerable:!0});Object.defineProperty(d.prototype,"capt",{get:function(){return this.vct},set:function(b){this.vct=b},enumerable:!0});d.prototype.shortCastling=!1;d.prototype.longCastling=!1;d.prototype.isNullMove=function(){return this.from===this.to&&!this.from};d.prototype.isCastling=function(){return this.isShortCastling()||this.isLongCastling()};d.prototype.equals=function(b){return this.from===b.from&&this.to===b.to&&this.prom===b.prom};
    d.prototype.isValid=function(){return this.from!=this.to};d.prototype._isShortCastling=function(){return this.equals(CB.Move.g_mvW00)&&this.mvd===CB.Piece.W_KING||this.equals(CB.Move.g_mvB00)&&this.mvd===CB.Piece.B_KING};d.prototype.isShortCastling=function(){return this.shortCastling};d.prototype._isLongCastling=function(){return this.equals(CB.Move.g_mvW000)&&this.mvd===CB.Piece.W_KING||this.equals(CB.Move.g_mvB000)&&this.mvd===CB.Piece.B_KING};d.prototype.isLongCastling=function(){return this.longCastling};
    d.prototype.setIsCastling=function(){this.shortCastling=this._isShortCastling();this.longCastling=this._isLongCastling()};d.prototype.subLines=null;d.prototype.annos=null;d.prototype.isCheck=function(){return this.isACheck};d.prototype.setCheck=function(b){this.isACheck=b};d.prototype.isMate=function(){return this.isAMate};d.prototype.setMate=function(b){this.isAMate=b};d.prototype.isTake=function(){return this.vct!=CB.Piece.NONE};d.prototype.getMoved=function(){return this.mvd};d.prototype.setMoved=
        function(b){this.mvd=b};d.prototype.getVictim=function(){return this.vct};d.prototype.setVictim=function(b){this.vct=b};d.prototype.getPiece=d.prototype.getMoved;d.prototype.isProm=function(){return this.prom!=CB.Piece.NONE};d.prototype.isPawn=function(){return this.mvd&&(this.mvd&7)==CB.Piece.PAWN};d.prototype.getSide=function(){return CB.Piece.side(this.mvd)};d.prototype.isNeedCol=function(){return this.needCol};d.prototype.setNeedCol=function(b){this.needCol=b};d.prototype.isNeedRow=function(){return this.needRow};
    d.prototype.setNeedRow=function(b){this.needRow=b};d.prototype.getTreeMoveCount=function(){var b=1;this.subLines&&(b=this.subLines.reduce(function(b,e){return b+e.getTreeMoveCount()},b));return b};d.prototype.indexOfLine=function(b){return this.subLines?this.subLines.indexOf(b):-1};d.prototype.findLine=function(b){if(this.subLines)for(var c=0;c<this.subLines.length;++c){var e=this.subLines[c];if(e[0].equals(b))return e}return null};d.prototype.removeLine=function(b){this.subLines&&(b=this.subLines.indexOf(b),
    0>b||this.subLines.splice(b,1))};d.prototype.removeLines=function(){this.subLines=null};d.prototype.getLine=function(b){return this.subLines[b]};d.prototype.getSubLines=function(){return this.subLines};d.prototype.getSubLinesCount=function(){return this.subLines?this.subLines.length:0};d.prototype.hasLines=function(){return null!=this.subLines&&0<this.subLines.length};d.prototype.newLine=function(b,c){this.subLines||(this.subLines=[]);b=new CB.MoveLine(b,c);this.subLines.push(b);return b};d.prototype.addLine=
        function(b){this.subLines||(this.subLines=[]);this.subLines.push(b)};d.prototype.insertLine=function(b,c){this.subLines||(this.subLines=[]);this.subLines.splice(b,0,c)};d.prototype.swapLines=function(b,c){if(this.subLines){var e=this.subLines[b];this.subLines[b]=this.subLines[c];this.subLines[c]=e}};d.prototype.write=function(b){if(this.prom){var c=this.to|this.prom-CB.Piece.QUEEN<<6;b.writeByte(this.from|64);b.writeByte(c)}else b.writeByte(this.from),b.writeByte(this.to);this.writeAnnos(b);this.writeSubLines(b)};
    d.prototype.write2=function(b){if(this.prom){var c=this.to|this.prom-CB.Piece.QUEEN<<6;b.writeByte(this.from|64);b.writeByte(c)}else b.writeByte(this.from),b.writeByte(this.to);c=0;this.annos&&this.annos.count()&&(c|=1);this.getSubLinesCount()&&(c|=2);b.writeUint8(c);c&1&&this.writeAnnos2(b);c&2&&this.writeSubLines2(b)};d.prototype.read=function(b){this.from=b.readByte();this.to=b.readByte();64==(this.from&192)&&(this.prom=CB.Piece.QUEEN+(this.to>>6));this.from&=63;this.to&=63;this.readAnnos(b);this.readSubLines(b)};
    d.prototype.read2=function(b){this.from=b.readByte();this.to=b.readByte();64==(this.from&192)&&(this.prom=CB.Piece.QUEEN+(this.to>>6));this.from&=63;this.to&=63;var c=b.readByte();c&1&&this.readAnnos2(b);c&2&&this.readSubLines2(b)};d.prototype.readAnnos=function(b){this.annos=CB.Annotation.readFactory(b)};d.prototype.readAnnos2=function(b){this.annos=CB.Annotation.readFactory2(b)};d.prototype.writeAnnos=function(b){CB.Annotation.write(b,this.annos)};d.prototype.writeAnnos2=function(b){CB.Annotation.write2(b,
        this.annos)};d.prototype.readSubLines=function(b){var c=b.readByte();if(127>=c){this.subLines=Array(c);for(var e=0;e<c;++e)this.subLines[e]=CB.MoveLine.readFactory(b)}};d.prototype.readSubLines2=function(b){var c=b.readByte();if(127>=c){this.subLines=Array(c);for(var e=0;e<c;++e)this.subLines[e]=CB.MoveLine.readFactory2(b)}};d.prototype.writeSubLines=function(b){var c=this.getSubLinesCount();b.writeByte(c);if(c)for(var e=0;e<c;++e)this.subLines[e].write(b)};d.prototype.writeSubLines2=function(b){var c=
        this.getSubLinesCount();b.writeByte(c);if(c)for(var e=0;e<c;++e)this.subLines[e].write2(b)};d.readFactory=createReadFactory(d);d.readFactory2=createReadFactory2(d);d.prototype.moveLinesTo=function(b){b.subLines=this.subLines;this.subLines=null};d.prototype.toString=function(){var b=CB.Square.toString(this.from)+CB.Square.toString(this.to);this.prom!=CB.Piece.NONE&&(b+=CB.Piece.toString(this.prom).toLowerCase());return b};d.g_regex=/^[a-h][1-8][a-h][1-8]([NBRQ])?$/i;d.isValidString=function(b){return d.g_regex.test(b)};
    d.fromString=function(b){var c=b.substring(0,2),e=b.substring(2,4);c=CB.Square.fromString(c);e=CB.Square.fromString(e);var d=void 0;4<b.length&&(b=b.charAt(4),d=CB.Piece.nominal(CB.Piece.fromString(b)));return new CB.Move(c,e,d)};d.prototype.toJSON=function(){return{from:CB.Square.toString(this.from),to:CB.Square.toString(this.to),prom:"  Q N B R  ".split(" ")[this.prom%8]}};d.prototype.fromJSON=function(b){this.from=CB.Square.fromString(b.from);this.to=CB.Square.fromString(b.to);b=" KQNBR".search(RegExp(b.prom,
        "i"));this.prom=0<b?b:0;return{from:CB.Square.toString(this.from),to:CB.Square.toString(this.to),prom:"  Q N B R  ".split(" ")[this.prom%8]}};d.prototype.setSubParentData=function(b,c,e){if(this.subLines)for(var d=0;d<this.subLines.length;++d){var g=this.subLines[d];g.setParentMoveIndex(c);g.setParentLine(b);e&&g.setSubParentData(!0)}};d.prototype.getAnno=function(){return this.annos};d.prototype.hasAnno=function(){return null!=this.annos};d.prototype.setAnnoItem=function(b,c){this.annos||(this.annos=
        new CB.Annotation);this.annos.setItem(b,c)};d.prototype.setAnno=function(b){this.annos=b};d.prototype.getAnnoItem=function(b){return this.annos?this.annos.getItem(b):null};d.prototype.deleteAnnoItem=function(b){this.annos&&this.annos.deleteItem(b)};d.prototype.resetAnno=function(){this.annos=null};d.prototype.unAnnotate=function(){this.resetAnno();this.removeLines()};d.prototype.getBaggage=function(){return this.baggage};d.prototype.setBaggage=function(b){this.baggage=b};d.prototype.forAllMoves=function(b){b(this);
        if(this.subLines)for(var c=0;c<this.subLines.length;c++)this.subLines[c].forAllMoves(b)};return d}();"use strict";
CB.MoveRecord=function(){var d=function(b,c,e,d){this.from=b||0;this.to=c||0;this.type=e||0;this.prom=d||0};d.prototype.initFromMove=function(b){b&&(this.from=b.from,this.to=b.to,this.prom=b.prom,this.type=void 0!==b.type?b.type:0)};d.prototype.toString=function(){return CB.Square.toString(this.from)+"-"+CB.Square.toString(this.to)+", ty="+this.type};d.prototype.fromDataBuf=function(b){this.from=b.readUint8();this.to=b.readUint8();this.type=b.readUint8();this.prom=b.readUint8()};d.prototype.Vz=function(b){b.writeUint8(this.from);
    b.writeUint8(this.to);b.writeUint8(this.type);b.writeUint8(this.prom)};return d}();"use strict";
CB.MoveLine=function(){var d=function(b,c){this.parent=null;this.inxMvParent=0;b&&(this.parent=b,this.inxMvParent=c)};d.prototype=[];d.prototype.isMainLine=function(){return!this.parent};d.prototype.setMainLine=function(){this.parent=null;this.inxMvParent=0};d.prototype.getParentLine=function(){return this.parent};d.prototype.setParentLine=function(b){this.parent=b};d.prototype.getParentMoveIndex=function(){return this.inxMvParent};d.prototype.setParentMoveIndex=function(b){this.inxMvParent=b};d.prototype.getTreeMoveCount=
    function(){return this.reduce(function(b,c){return b+c.getTreeMoveCount()},0)};d.prototype.setSubParentData=function(b){this.forEach(function(c,e){c.setSubParentData(this,e,b)}.bind(this))};d.prototype.swapMoves=function(b,c){b=[b,this.length-b];if(c)for(var e=0,d=c.length;e<d;++e)b.push(c[e]);b=this.splice.apply(this,b);this.setSubParentData();b=[0,c.length].concat(b);c.splice.apply(c,b);c.setSubParentData();c.setParentLine(this);return c};d.prototype.selfTest=function(b,c,e){CBDebug.assert(this.inxMvParent===
    e);CBDebug.assert(!c||null!=this.getParentMove()&&0<=this.getParentMove().indexOfLine(this));b=ObjUtil.clone(b);e=0;for(var d=this.length;e<d;++e){var g=this[e];if(g.hasLines()){CBDebug.assert(!c||e);for(var h=g.getSubLines(),k=0;k<h.length;++k)h[k].selfTest(ObjUtil.clone(b),this,e)}b.makeMove(g)}};d.prototype.getParentMove=function(){return this.parent?this.parent[this.inxMvParent]:null};d.prototype.toString=function(){return this.join(" ")};d.readFactory=createReadFactory(d);d.readFactory2=createReadFactory2(d);
    d.prototype.read=function(b){b.readArray(this,CB.Move.readFactory);this.setSubParentData();this.shiftTrainingAnnosBack()};d.prototype.read2=function(b){var c=b.readUint8();c&128&&(c=(c<<8|b.readUint8())&32767);if(0<c){if(2048<c)return!1;if(0<c){this.length=c;for(var e=0;e<c;e++){var d=new CB.Move;d.read2(b);this[e]=d}}}else if(0>c)return!1;this.setSubParentData();this.shiftTrainingAnnosBack()};d.prototype.write=function(b){this.shiftTrainingAnnosFwd();b.writeArray(this)};d.prototype.write2=function(b){this.shiftTrainingAnnosFwd();
        2048>=this.length&&(this.length&-128&&b.writeUint8(this.length<<8|128),b.writeUint8(this.length&255));for(var c=0;c<this.length;c++)this[c].write2(b)};d.prototype.hasLines=function(){return this.some(function(b){return b.hasLines()})};d.prototype.shiftTrainingAnnosBack=function(){for(var b=1;b<this.length;b++)if(this[b].hasAnno()&&this[b].getAnno().hasTraining()){var c=this[b].getAnno().getTraining();this[b].getAnno().setTraining(null);this[b-1].setAnnoItem(CB.AnnoType.TRAINING,c)}};d.prototype.shiftTrainingAnnosFwd=
        function(){for(var b=this.length-2;0<=b;b--)if(this[b].hasAnno()&&this[b].getAnno().hasTraining()){var c=this[b].getAnno().getTraining();this[b].getAnno().setTraining(null);this[b+1].setAnnoItem(CB.AnnoType.TRAINING,c)}};d.prototype.isAnnotated=function(){return this.some(function(b){return b.hasLines()||b.hasAnno()})};d.prototype.setAnno=function(b){this.anno=b};d.prototype.getAnno=function(b){return this.anno};d.prototype.setAnnoItem=function(b,c){this.anno||(this.anno=new CB.Annotation);this.anno.setItem(b,
        c)};d.prototype.hasAnno=function(){return void 0!==this.anno};d.prototype.unAnnotate=function(){this.forEach(function(b){b.unAnnotate()})};d.prototype.forAllMoves=function(b){this.forEach(function(c){c.forAllMoves(b)})};d.prototype.removeLines=function(){this.forEach(function(b){b.removeLines()})};return d}();"use strict";
CB.LineStackItem=function(){var d=function(b,c){this.line=void 0!=b?b:null;this.mvsToGo=void 0!=c?c:0};d.prototype.getLine=function(){return this.line};d.prototype.getMovesToGo=function(){return this.mvsToGo};d.prototype.setMovesToGo=function(b){this.mvsToGo=b};d.prototype.incMovesToGo=function(){++this.mvsToGo};d.prototype.decMovesToGo=function(){--this.mvsToGo};d.prototype.isLineEnd=function(){return this.line.length===this.mvsToGo};d.prototype.isLineStart=function(){return 0===this.mvsToGo};d.prototype.pushMove=
    function(b){this.line.length=this.mvsToGo;this.line.push(b);++this.mvsToGo};d.prototype.deleteRemaining=function(){this.line.length=this.mvsToGo};d.prototype.deletePrevious=function(){this.line.splice(0,this.mvsToGo-1);this.mvsToGo=1;this.line.setSubParentData();this.line.setMainLine();return this.line};d.prototype.shallowClone=function(){return new d(this.line,this.mvsToGo)};return d}();
CB.LineStack=function(){var d=function(b,c){b&&(c||(c=0),this.push(new CB.LineStackItem(b,c)))};d.prototype=[];d.prototype.Top=function(){return this[this.length-1]};d.prototype.shallowClone=function(){var b=new CB.LineStack;b.length=this.length;for(var c=0,e=this.length;c<e;++c)b[c]=this[c].shallowClone();return b};d.prototype.deleteRemaining=function(){this.Top()&&this.Top().deleteRemaining()};d.prototype.deletePrevious=function(){var b=this.Top(),c=b.deletePrevious();this.length=0;this.push(b);
    return c};d.prototype.gotoPrev=function(){var b=this.Top();b&&(b.decMovesToGo(),1<this.length&&0===b.getMovesToGo()&&this.pop())};d.prototype.promoteLine=function(){var b=this.Top();if(b){var c=b.getLine(),e=b.getMovesToGo();b=c.getParentLine();var d=c.getParentMoveIndex(),g=b[d],h=g.indexOfLine(c);g.removeLine(c);var k=c[0];g.moveLinesTo(k);b.swapMoves(d,c);k.insertLine(h,c);e+=d;this.pop();b=this.Top();b.setMovesToGo(e)}};d.prototype.getSimplePath=function(){for(var b=[],c=null,e=0,d=this.length;e<
d;++e){var g=this[e],h=g.getLine();g=g.getMovesToGo();var k=0;c&&(k=c.indexOfLine(h));b.push({inxLine:k,mvsToGo:g});c=h[g]}return b};d.prototype.selfTest=function(){for(var b=null,c=0,e=0,d=this.length;e<d;++e){var g=this[e],h=g.getLine();g=g.getMovesToGo();CBDebug.assert(h.getParentLine()===b);CBDebug.assert(h.getParentMoveIndex()===c);CBDebug.assert(!b||0<=h.getParentMove().indexOfLine(h));b=h;c=g}};return d}();"use strict";
CB.Position=function(){function d(b,c){this.piece=b;this.field=c}function b(b,c){return function(e){return e===b||c&&e===c}}var c=function(b){this.initFields();b?b.length&&("w"==b.charAt(0)?this.initString(b):this.initFEN(b)):this.initStartPos()};c.NOEP=-1;c.prototype.copy=function(b){for(var c=0;c<this.board.length;++c)this.board[c]=b.board[c];this.sd=b.sd;this.ep=b.ep;this.cr=b.cr;this.lastKillOrPawn=b;this.numPly=b.numPly};c.prototype.equals=function(b){if(!b||this.sd!=b.sd||this.ep!=b.ep||this.cr!=
    b.cr)return!1;for(var c=0;c<this.board.length;++c)if(this.board[c]!==b.board[c])return!1;return!0};c.prototype.plyToMvNum=function(b,c){return idiv(b,2)+1};c.mvToPlyNum=function(b,c){return 2*(b-1)+c};c.prototype.getMoveNum=function(){return this.plyToMvNum(this.numPly,this.sd)};c.prototype.setMoveNum=function(b){this.numPly=c.mvToPlyNum(b,this.sd)};c.prototype.getPlyNum=function(){return this.numPly};c.prototype.initStartPos=function(){this.sd=CB.Side.WHITE;for(var b=CB.Square.C_A;b<=CB.Square.C_H;++b)this.board[CB.Square.I(b,
    CB.Square.R_2)]=CB.Piece.W_PAWN,this.board[CB.Square.I(b,CB.Square.R_7)]=CB.Piece.B_PAWN;this.board[CB.Square.A1]=this.board[CB.Square.H1]=CB.Piece.W_ROOK;this.board[CB.Square.B1]=this.board[CB.Square.G1]=CB.Piece.W_KNIGHT;this.board[CB.Square.C1]=this.board[CB.Square.F1]=CB.Piece.W_BISHOP;this.board[CB.Square.D1]=CB.Piece.W_QUEEN;this.board[CB.Square.E1]=CB.Piece.W_KING;this.board[CB.Square.A8]=this.board[CB.Square.H8]=CB.Piece.B_ROOK;this.board[CB.Square.B8]=this.board[CB.Square.G8]=CB.Piece.B_KNIGHT;
    this.board[CB.Square.C8]=this.board[CB.Square.F8]=CB.Piece.B_BISHOP;this.board[CB.Square.D8]=CB.Piece.B_QUEEN;this.board[CB.Square.E8]=CB.Piece.B_KING;this.cr=CB.CastleRights.ALL;this.numPly=this.lastKillOrPawn=0};c.prototype.boardEquals=function(b){for(var c=0;c<this.board.length&&64>c;c++)if(this.board[c]!==b[c])return!1;return!0};c.prototype.initFEN=function(b){b=new StringIterator(b);var e=CB.Square.R_8,d=CB.Square.C_A,h;for(h=b.Next();0!==h&&!Char.IsWhiteSpace(h);h=b.Next())if("/"===h)--e,d=
    CB.Square.C_A;else if(Char.IsDigit(h))d+=Number(h);else{var k=CB.Square.I(d,e);h=CB.Piece.fromString(h);CBDebug.assert(h!==CB.Piece.NONE);this.board[k]=h;d++}b.isEOF()||(b.skipWhile(Char.IsWhiteSpace),b.isEOF()||(this.sd=CB.Side.fromString(b.Current()),b.skipWhile(Char.IsWhiteSpace),b.isEOF()||(e=b.AcceptUntil(Char.IsWhiteSpace,!0),this.cr=CB.CastleRights.fromString(e),b.isEOF()||(b.skipWhile(Char.IsWhiteSpace),e=b.AcceptUntil(Char.IsWhiteSpace,!0),"-"===e?this.ep=c.NOEP:(e=CB.Square.fromString(e),
    this.ep=CB.Square.C(e)),this.numPly=c.mvToPlyNum(1,this.sd),b.isEOF()||(b.skipWhile(Char.IsWhiteSpace),b.isEOF()||(e=b.AcceptUntil(Char.IsWhiteSpace,!0),this.lastKillOrPawn=Number(e),b.isEOF()||(b.skipWhile(Char.IsWhiteSpace),b.isEOF()||(b=b.AcceptUntil(Char.IsWhiteSpace,!0),(b=Number(b))||(b=1),this.numPly=c.mvToPlyNum(b,this.sd)))))))))};c.prototype.initString=function(b){this.initEmpty();for(var c=b.length,e=!1,d=0;d<c;d++)if(("b"==b[d]||"s"==b[d])&&"K"==b[d+1]){e="s"==b[d];break}var k=0,l=0;for(d=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0;d<c;d++)switch(b[d]){case "K":k=CB.Piece.KING;break;case "D":case "Q":k=CB.Piece.QUEEN;break;case "T":case "R":k=CB.Piece.ROOK;break;case "L":k=CB.Piece.BISHOP;break;case "B":k=e?CB.Piece.PAWN:CB.Piece.BISHOP;break;case "S":case "N":k=CB.Piece.KNIGHT;break;case "P":k=CB.Piece.PAWN;break;case "a":case "b":case "c":case "d":case "e":case "f":case "g":case "h":48<b.charCodeAt(d+1)&&57>b.charCodeAt(d+1)?this.board[(b.charCodeAt(d)-97<<3)+b.charCodeAt(d+1)-49]=k|l:"b"!=b[d]||e||(l=CB.Piece.BLACK);break;
    case "s":e&&(l=CB.Piece.BLACK);break;case "w":l=CB.Piece.WHITE;break;case ":":this.parseAttributes(b.slice(d+1)),d=c}0==this.cr&&(this.board[CB.Square.E1]==CB.Piece.W_KING&&(this.board[CB.Square.H1]==CB.Piece.W_ROOK?this.cr|=CB.CastleRights.W_00:this.board[CB.Square.A1]==CB.Piece.W_ROOK&&(this.cr|=CB.CastleRights.W_000)),this.board[CB.Square.E8]==CB.Piece.B_KING&&(this.board[CB.Square.H8]==CB.Piece.B_ROOK?this.cr|=CB.CastleRights.B_00:this.board[CB.Square.A8]==CB.Piece.B_ROOK&&(this.cr|=CB.CastleRights.B_000)))};
    c.prototype.parseAttributes=function(b){CB.LOG(b);"b"==b[0]&&(this.sd=CB.Side.BLACK)};c.prototype.canMakeNullMove=function(){return!this.isCheck()};c.prototype.makeNullMove=function(){return this.makeMove(new CB.Move(0,0))};c.prototype.unmakeNullMove=function(){return this.unmakeMove(new CB.Move(0,0))};c.prototype.makeMove=function(b){if(b){var e=new CB.Undo(this,b);++this.numPly;this.sd=CB.Side.other(this.sd);var d=this.ep;this.ep=c.NOEP;if(b.isNullMove())return e;var h=this.board[b.from],k=this.board[b.to];
        this.board[b.to]=this.board[b.from];this.board[b.from]=CB.Piece.NONE;var l=CB.Square.R(b.from),m=CB.Square.R(b.to),p=CB.Square.C(b.from),r=CB.Square.C(b.to);CB.Piece.nominal(h)===CB.Piece.PAWN&&(r!==p&&r===d&&k===CB.Piece.NONE&&(k=CB.Piece.changeSide(h),d=CB.Square.I(r,l),this.board[d]=CB.Piece.NONE,e.setEP(k,d)),b.prom!==CB.Piece.NONE&&(k=CB.Piece.make(b.prom,CB.Piece.side(h)),this.board[b.to]=k),2===Math.abs(l-m)&&(this.ep=p));CB.Piece.nominal(h)===CB.Piece.KING&&2===Math.abs(r-p)&&(r===CB.Square.C_G?
            (h=CB.Square.I(CB.Square.C_H,l),l=CB.Square.I(CB.Square.C_F,l)):(h=CB.Square.I(CB.Square.C_A,l),l=CB.Square.I(CB.Square.C_D,l)),this.board[l]=this.board[h],this.board[h]=CB.Piece.NONE,e.setCastle(h,l));if(this.cr){if(this.cr&CB.CastleRights.W_ALL)if(b.from===CB.Square.E1)this.cr&=~CB.CastleRights.W_ALL;else if(b.from===CB.Square.A1||b.to===CB.Square.A1)this.cr&=~CB.CastleRights.W_000;else if(b.from===CB.Square.H1||b.to===CB.Square.H1)this.cr&=~CB.CastleRights.W_00;if(this.cr&CB.CastleRights.B_ALL)if(b.from===
            CB.Square.E8)this.cr&=~CB.CastleRights.B_ALL;else if(b.from===CB.Square.A8||b.to===CB.Square.A8)this.cr&=~CB.CastleRights.B_000;else if(b.from===CB.Square.H8||b.to===CB.Square.H8)this.cr&=~CB.CastleRights.B_00}return e}};c.prototype.unmakeMove=function(b,c){!b.isNullMove()&&(this.board[b.from]=c.mvd,this.board[b.to]=CB.Piece.NONE,this.board[c.fldVct]=c.vct,c.to2||c.from2)&&(this.board[c.from2]=this.board[c.to2],this.board[c.to2]=CB.Piece.NONE);this.cr=c.cr;this.ep=c.ep;--this.numPly;this.sd=CB.Side.other(this.sd)};
    c.prototype.V7=function(){var b=this.generateSemiLegals();return this.filterLegals(b)};c.prototype.generateSemiLegals=function(b){for(var c=[],e=0;e<this.board.length;++e){var d=this.board[e];d!==CB.Piece.NONE&&(b&&d!==b||CB.Piece.side(d)===this.sd&&this._generateSemiLegalsFrom(e,d,c))}return c};c.prototype.generateSemiLegalsFrom=function(b,c){c||(c=this.board[b]);var e=[];this._generateSemiLegalsFrom(b,c,e);return e};c.prototype.V7From=function(b,c){b=this.generateSemiLegalsFrom(b,c);return this.filterLegals(b)};
    c.prototype._generateSemiLegalsFrom=function(b,c,d){switch(c){case CB.Piece.W_PAWN:case CB.Piece.B_PAWN:this.generatePawn(c,b,d);break;case CB.Piece.W_KNIGHT:case CB.Piece.B_KNIGHT:this.generateKnight(c,b,d);break;case CB.Piece.W_BISHOP:case CB.Piece.B_BISHOP:this.generateBishop(c,b,d);break;case CB.Piece.W_ROOK:case CB.Piece.B_ROOK:this.generateRook(c,b,d);break;case CB.Piece.W_QUEEN:case CB.Piece.B_QUEEN:this.generateQueen(c,b,d);break;case CB.Piece.W_KING:case CB.Piece.B_KING:this.generateKing(c,
        b,d)}};c.prototype.generateSemiLegalsTo=function(b,c){return this.generateSemiLegals(c).filter(function(c){return c.to===b})};c.g_arrKnightMvs=[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]];c.g_arrKingMvs=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];c.g_arrBishopMvs=[[1,1],[-1,1],[-1,-1],[1,-1]];c.g_arrRookMvs=[[1,0],[0,1],[-1,0],[0,-1]];c.prototype.generateKnight=function(b,d,g){this.generate(b,d,c.g_arrKnightMvs,!1,g)};c.prototype.generateKing=function(b,d,g){this.generate(b,
        d,c.g_arrKingMvs,!1,g);if(b===CB.Piece.W_KING){if(!(this.cr&CB.CastleRights.W_ALL)||this.isAttacked(CB.Square.E1,CB.Side.BLACK))return;this.cr&CB.CastleRights.W_00&&this.board[CB.Square.F1]===CB.Piece.NONE&&this.board[CB.Square.G1]===CB.Piece.NONE&&(this.isAttacked(CB.Square.F1,CB.Side.BLACK)||this.isAttacked(CB.Square.G1,CB.Side.BLACK)||g.push(CB.Move.g_mvW00));this.cr&CB.CastleRights.W_000&&this.board[CB.Square.D1]===CB.Piece.NONE&&this.board[CB.Square.C1]===CB.Piece.NONE&&this.board[CB.Square.B1]===
    CB.Piece.NONE&&(this.isAttacked(CB.Square.D1,CB.Side.BLACK)||this.isAttacked(CB.Square.C1,CB.Side.BLACK)||g.push(CB.Move.g_mvW000))}b===CB.Piece.B_KING&&this.cr&CB.CastleRights.B_ALL&&!this.isAttacked(CB.Square.E8,CB.Side.WHITE)&&(this.cr&CB.CastleRights.B_00&&this.board[CB.Square.F8]===CB.Piece.NONE&&this.board[CB.Square.G8]===CB.Piece.NONE&&(this.isAttacked(CB.Square.F8,CB.Side.WHITE)||this.isAttacked(CB.Square.G8,CB.Side.WHITE)||g.push(CB.Move.g_mvB00)),this.cr&CB.CastleRights.B_000&&this.board[CB.Square.D8]===
    CB.Piece.NONE&&this.board[CB.Square.C8]===CB.Piece.NONE&&this.board[CB.Square.B8]===CB.Piece.NONE&&(this.isAttacked(CB.Square.D8,CB.Side.WHITE)||this.isAttacked(CB.Square.C8,CB.Side.WHITE)||g.push(CB.Move.g_mvB000)))};c.prototype.generateRook=function(b,d,g){this.generate(b,d,c.g_arrRookMvs,!0,g)};c.prototype.generateBishop=function(b,d,g){this.generate(b,d,c.g_arrBishopMvs,!0,g)};c.prototype.generateQueen=function(b,c,d){this.generateRook(b,c,d);this.generateBishop(b,c,d)};c.prototype.generatePawn=
        function(b,c,d){var e=b===CB.Piece.W_PAWN?1:-1,f=b===CB.Piece.W_PAWN?CB.Square.R_8:CB.Square.R_1,g=CB.Square.C(c),m=CB.Square.R(c),p=CB.Piece.side(b),r=m+e,t=CB.Square.I(g,r);f=r===f;this.board[t]===CB.Piece.NONE&&(f?(d.push(new CB.Move(c,t,CB.Piece.QUEEN)),d.push(new CB.Move(c,t,CB.Piece.ROOK)),d.push(new CB.Move(c,t,CB.Piece.BISHOP)),d.push(new CB.Move(c,t,CB.Piece.KNIGHT))):(t=new CB.Move(c,t),d.push(t)),b===CB.Piece.W_PAWN&&m===CB.Square.R_2||b===CB.Piece.B_PAWN&&m===CB.Square.R_7)&&(t=CB.Square.I(g,
            m+2*e),this.board[t]===CB.Piece.NONE&&(t=new CB.Move(c,t),d.push(t)));for(t=-1;1>=t;t+=2){var w=g+t;r=m+e;if(CB.Square.isLegal(w,r)){r=CB.Square.I(w,r);var q=this.board[r];if(q!==CB.Piece.NONE&&CB.Piece.side(q)!==p)if(f)d.push(new CB.Move(c,r,CB.Piece.QUEEN)),d.push(new CB.Move(c,r,CB.Piece.ROOK)),d.push(new CB.Move(c,r,CB.Piece.BISHOP)),d.push(new CB.Move(c,r,CB.Piece.KNIGHT));else{var u=new CB.Move(c,r);d.push(u)}q===CB.Piece.NONE&&w===this.ep&&(q=p===CB.Side.WHITE?CB.Square.R_5:CB.Square.R_4,w=
            CB.Square.I(w,q),w=this.board[w],m===q&&w===CB.Piece.changeSide(b)&&(r=new CB.Move(c,r),d.push(r)))}}};c.prototype.generate=function(b,c,d,h,k){b=CB.Piece.side(b);for(var e=CB.Square.R(c),f=CB.Square.C(c),g=0,r=d.length;g<r;++g){var t=d[g],w=f,q=e,u=h;do{w+=t[0];q+=t[1];if(!CB.Square.isLegal(w,q))break;var y=CB.Square.I(w,q),z=this.board[y];if(z!==CB.Piece.NONE)if(CB.Piece.side(z)===b)break;else u=!1;y=new CB.Move(c,y);k.push(y)}while(u)}};c.prototype.filterLegals=function(b){var c=this;return b.filter(function(b){return!c.isSuicideMove(b)})};
    c.prototype.isProm=function(b,c){var e=this.sd;return this.board[b]==CB.Piece.make(CB.Piece.PAWN,e)&&CB.Square.R(c)==CB.Square.getPromRow(e)};c.prototype.isLegalFromTo=function(b,c){var e=new CB.Move(b,c);this.isProm(b,c)&&(e.prom=CB.Piece.QUEEN);return this.isLegalMove(e)};c.prototype.isLegalMove=function(b){return null!=b&&(b.isNullMove()||this.isSemiLegalMove(b))&&!this.isSuicideMove(b)};c.prototype.isSemiLegalMove=function(b){if(null==b)return!1;var c=b.from,e=b.to;if(c===e)return!1;var d=this.board[c];
        if(d===CB.Piece.NONE||CB.Piece.side(d)!==this.sd)return!1;e=this.board[e];return e!==CB.Piece.NONE&&CB.Piece.side(d)===CB.Piece.side(e)?!1:this.generateSemiLegalsFrom(c,d).some(b.equals.bind(b))};c.prototype.isSuicideMove=function(b){var c=this.makeMove(b),e=this.isSuicidePos();this.unmakeMove(b,c);return e};c.prototype.initFields=function(){this.board=Array(CB.Board.SIZE);this.initEmpty()};c.prototype.initEmpty=function(){for(var b=0;64>b;b++)this.board[b]=CB.Piece.NONE;this.sd=CB.Side.WHITE;this.cr=
        0;this.ep=c.NOEP;this.numPly=this.lastKillOrPawn=0};c.prototype.toNormalizedFEN=function(){for(var b="",d=CB.Square.R_8;d>=CB.Square.R_1;--d){for(var g=0,h=CB.Square.C_A;h<=CB.Square.C_H;++h){var k=CB.Square.I(h,d);k=this.board[k];k===CB.Piece.NONE?++g:(0<g&&(b+=g),g=0,b+=CB.Piece.toString(k))}0<g&&(b+=g);d>CB.Square.R_1&&(b+="/")}b=b+" "+CB.Side.toString(this.sd);b=b+" "+CB.CastleRights.toString(this.cr);b+=" ";this.ep===c.NOEP?b+="-":(d=this.getEPField(),b+=CB.Square.toString(d));return b};c.prototype.toFEN=
        function(){var b=this.toNormalizedFEN();b+=" 0 ";var c=this.getMoveNum();return b+c};c.prototype.toString=c.prototype.toFEN;c.prototype.toDescriptiveString=function(){for(var b=" KQNBRP".split(""),c="",d=[],h=[],k=0;16>k;k++)d.push([0,0,0,0,0,0,0,0,0,0]),h[k]=0;for(k=0;64>k;k++){var l=this.board[k]&15;l&&16>h[l]&&(d[l][h[l]++]=k)}c+="w";for(k=1;7>k;k++)if(0<h[k]){1<k&&(c+=",");l=b[k];c+=String(l);for(var m=0;m<h[k];m++)l=d[k][m],c+=CB.Square.toString(l),m<h[k]-1&&(c+=",")}c+="/b";for(k=9;15>k;k++)if(0<
        h[k])for(9<k&&(c+=","),l=b[k&7],c+=String(l),m=0;m<h[k];m++)l=d[k][m],c+=CB.Square.toString(l),m<h[k]-1&&(c+=",");return c};c.prototype.getPiece=function(b){return this.board[b]};c.prototype.getPieces=function(){for(var b=[],c=0;c<this.board.length;++c){var g=this.board[c];g!==CB.Piece.NONE&&(g=new d(g,c),b.push(g))}return b};c.prototype.countPieces=function(b){for(var c=0,e=0;e<this.board.length;++e)this.board[e]==b&&c++;return c};c.prototype.countAllPieces=function(b){for(var c=0,e=0;e<this.board.length;++e)this.board[e]&&
    0!=(this.board[e]&CB.Piece.SIDE_MASK)==b&&c++;return c};d.prototype.toString=function(){var b=CB.Piece.nominal(this.piece);return CB.Piece.toString(b)+CB.Square.toString(this.field)};d.prototype.equals=function(b){return this.piece===b.piece&&this.field===b.field};c.prototype.getSideToMove=function(){return this.sd};c.prototype.getBoard=function(){return this.board};c.prototype.isWTM=function(){return this.sd===CB.Side.WHITE};c.prototype.isBTM=function(){return this.sd===CB.Side.BLACK};c.prototype.setBTM=
        function(b){this.sd=b?CB.Side.BLACK:CB.Side.WHITE};c.prototype.getBTM=c.prototype.isBTM;c.prototype.setCastleRights=function(b){this.cr=b};c.prototype.getEPFile=function(){return this.ep===c.NOEP?-1:this.ep%8};c.prototype.getCPPEPFile=function(){return this.ep===c.NOEP?0:this.ep%8+1};c.prototype.setCPPEPFile=function(b){this.ep=0>=b?c.NOEP:b-1};c.prototype.getEPField=function(){return this.ep===c.NOEP?-1:CB.Square.I(this.ep,this.sd===CB.Side.WHITE?CB.Square.R_6:CB.Square.R_3)};c.prototype.getEPCol=
        function(){return this.ep};c.prototype.getEPVictimField=function(){return this.ep===c.NOEP?-1:CB.Square.I(this.ep,this.sd===CB.Side.WHITE?CB.Square.R_5:CB.Square.R_4)};c.prototype.getCastleRights=function(){return this.cr};c.prototype.getPossibleCastleRights=function(){var b=0;this.board[CB.Square.E1]===CB.Piece.W_KING&&(this.board[CB.Square.A1]===CB.Piece.W_ROOK&&(b|=CB.CastleRights.W_000),this.board[CB.Square.H1]===CB.Piece.W_ROOK&&(b|=CB.CastleRights.W_00));this.board[CB.Square.E8]===CB.Piece.B_KING&&
    (this.board[CB.Square.A8]===CB.Piece.B_ROOK&&(b|=CB.CastleRights.B_000),this.board[CB.Square.H8]===CB.Piece.B_ROOK&&(b|=CB.CastleRights.B_00));return b};c.prototype.getPossibleEP=function(){for(var b=[],c=this.sd==CB.Side.WHITE?CB.Square.R_5:CB.Square.R_4,d=CB.Piece.make(CB.Piece.PAWN,this.sd),h=CB.Piece.changeSide(d),k=CB.Square.C_A;k<=CB.Square.C_H;++k){var l=CB.Square.I(k,c);this.board[l]===h&&(k>CB.Square.C_A&&this.board[CB.Square.I(k-1,c)]===d||k<CB.Square.C_H&&this.board[CB.Square.I(k+1,c)]===
        d)&&b.push(k)}return b};c.prototype.isAttacked=function(b,c){return 0<this.getAttacksTo(b,c).length};c.prototype.getAttacksTo=function(b,c){var e=[];this._getAttacksTo(b,c,e);return e};c.prototype._getAttacksTo=function(b,c,d){this.getPawnAttacksTo(b,c,d);this.getKnightAttacksTo(b,c,d);this.getKingAttacksTo(b,c,d);this.getRangedAttacksTo(b,c,d)};c.prototype.getKnightAttacksTo=function(e,d,g){this.getAttacks(e,d,c.g_arrKnightMvs,b(CB.Piece.make(CB.Piece.KNIGHT,d)),!1,g)};c.prototype.getKingAttacksTo=
        function(e,d,g){this.getAttacks(e,d,c.g_arrKingMvs,b(CB.Piece.make(CB.Piece.KING,d)),!1,g)};c.prototype.getQueenAttacksTo=function(e,d,g){this.getAttacks(e,d,c.g_arrBishopMvs,b(CB.Piece.make(CB.Piece.QUEEN,d)),!0,g);this.getAttacks(e,d,c.g_arrRookMvs,b(CB.Piece.make(CB.Piece.QUEEN,d)),!0,g)};c.prototype.getPawnMovesTo=function(b,c,d){if(this.board[b]===CB.Piece.NONE){var e=CB.Square.R(b),f=CB.Square.C(b);if(c!==CB.Side.WHITE||e!==CB.Square.R_1&&e!==CB.Square.R_2)if(c!==CB.Side.BLACK||e!==CB.Square.R_8&&
        e!==CB.Square.R_7){var g=c===CB.Side.WHITE?-1:1;b=CB.Piece.make(CB.Piece.PAWN,c);c=c===CB.Side.WHITE?CB.Square.R_4:CB.Square.R_5;var m=CB.Square.I(f,e+g);this.board[m]===b?d.push(m):e===c&&this.board[m]===CB.Piece.NONE&&(e=CB.Square.I(f,e+2*g),this.board[e]===b&&d.push(e))}}};c.prototype.getBishopAttacksTo=function(e,d,g){this.getAttacks(e,d,c.g_arrBishopMvs,b(CB.Piece.make(CB.Piece.BISHOP,d)),!0,g)};c.prototype.getRookAttacksTo=function(e,d,g){this.getAttacks(e,d,c.g_arrRookMvs,b(CB.Piece.make(CB.Piece.ROOK,
        d)),!0,g)};c.prototype.getRangedAttacksTo=function(e,d,g){this.getAttacks(e,d,c.g_arrRookMvs,b(CB.Piece.make(CB.Piece.ROOK,d),CB.Piece.make(CB.Piece.QUEEN,d)),!0,g);this.getAttacks(e,d,c.g_arrBishopMvs,b(CB.Piece.make(CB.Piece.BISHOP,d),CB.Piece.make(CB.Piece.QUEEN,d)),!0,g)};c.g_arrWhPawnAttks=[[1,1],[-1,1]];c.g_arrBlPawnAttks=[[1,-1],[-1,-1]];c.prototype.getPawnAttacksTo=function(e,d,g){d===CB.Side.WHITE?this.getAttacks(e,d,c.g_arrWhPawnAttks,b(CB.Piece.W_PAWN),!1,g):this.getAttacks(e,d,c.g_arrBlPawnAttks,
        b(CB.Piece.B_PAWN),!1,g)};c.prototype.getAttacks=function(b,c,d,h,k,l){var e=CB.Square.R(b);b=CB.Square.C(b);for(var f=0,g=d.length;f<g;++f){var t=d[f],w=b,q=e,u=k;do{w-=t[0];q-=t[1];if(!CB.Square.isLegal(w,q))break;var y=CB.Square.I(w,q),z=this.board[y];if(z!==CB.Piece.NONE){if(CB.Piece.side(z)!==c)break;else u=!1;h(z)&&l.push(y)}}while(u)}};c.prototype.getKingsPos=function(b){b=CB.Piece.make(CB.Piece.KING,b);return this.board.indexOf(b)};c.prototype.getPiecePos=function(b,c){b=CB.Piece.make(b,c);
        return this.board.indexOf(b)};c.prototype.isCheck=function(){var b=this.getKingsPos(this.sd),c=CB.Side.other(this.sd);return this.isAttacked(b,c)};c.prototype.isSuicidePos=function(){var b=CB.Side.other(this.sd);b=this.getKingsPos(b);return this.isAttacked(b,this.sd)};c.prototype.isMate=function(){return this.isCheck()?!this.hasLegals():!1};c.prototype.isStaleMate=function(){return this.isCheck()?!1:!this.hasLegals()};c.prototype.swapSide=function(){return this.isCheck()||this.isMate()||this.isStaleMate()?
        !1:(this.makeMove(new CB.Move),!0)};c.prototype.hasLegals=function(){return 0<this.V7().length};c.prototype.getVictim=function(b){var c=this.board[b.to];return c!==CB.Piece.NONE?c:CB.Piece.nominal(this.board[b.from])===CB.Piece.PAWN&&CB.Square.C(b.from)!==CB.Square.C(b.to)?(b=CB.Square.I(CB.Square.C(b.to),CB.Square.R(b.from)),this.board[b]):CB.Piece.NONE};c.prototype.isTake=function(b){return this.getVictim(b)!==CB.Piece.NONE};c.prototype.calcNeed=function(b){var c=b.from,e=this.board[c],d={needCol:!1,
        needRow:!1},k=CB.Piece.nominal(e);if(k===CB.Piece.PAWN||k===CB.Piece.KING)return d;for(var l=[],m=0;m<CB.Board.SIZE;++m)this.board[m]===e&&m!==c&&l.push(m);if(!l.length||k===CB.Piece.BISHOP&&l.every(function(b){return CB.Square.isDark(b)!==CB.Square.isDark(c)}))return d;m=k=!0;for(var p=!1,r=0,t=l.length;r<t;++r){var w=l[r];this.generateSemiLegalsFrom(w,e).some(function(c){return c.to===b.to})&&(p=!0,k&=CB.Square.C(w)!==CB.Square.C(c),m&=CB.Square.R(w)!==CB.Square.R(c))}p&&(d.needCol=k||!m,d.needRow=
        !k);return d};c.prototype.preCalcCtx=function(b){this.preSetMinCtx(b);if(!b.isNullMove()){var c=this.calcNeed(b);b.setNeedCol(c.needCol);b.setNeedRow(c.needRow)}};c.prototype.preSetMinCtx=function(b){if(b.isNullMove())b.setMoved(CB.Piece.make(CB.Piece.PAWN,this.sd)),b.setVictim(CB.Piece.NONE);else{b.setMoved(this.board[b.from]);var c=this.getVictim(b);b.setVictim(c);b.setIsCastling()}};c.prototype.postCalcCtx=function(b,c){if(b.isNullMove())b.setCheck(!1);else{var e=this.isCheck();b.setCheck(e);e&&
    c&&b.setMate(!this.hasLegals())}};c.prototype.read=function(b){this.board=b.readByteArray(CB.Board.SIZE);this.sd=b.readInt();this.ep=b.readByte()-1;this.cr=b.readByte();this.numPly=0};c.prototype.write=function(b){b.writeByteArray(this.board,CB.Board.SIZE);b.writeInt(this.sd);b.writeByte(this.ep+1);b.writeByte(this.cr)};c.prototype.copyTo=function(b){b.sd=this.sd;b.ep=this.ep;b.cr=this.cr;for(var c=0;64>c;c++)b.board[c]=this.board[c]};c.packBoard=function(b){for(var c=Array(32),e=0,d=c.length;e<d;++e)c[e]=
        b[2*e]|b[2*e+1]<<4;return c};c.unpackBoard=function(b){for(var c=Array(2*b.length),e=0,d=b.length;e<d;++e)c[2*e]=b[e]&15,c[2*e+1]=b[e]>>4;return c};c.prototype.fillSquaresOfSide=function(b,c){for(var e=0;e<this.board.length;e++)CB.Piece.side(this.board[e])==c&&(b[e]=this.board[e])};c.prototype.setEquals=function(b){for(var c=0;c<this.board.length;c++)if(this.board[c]!=b.board[c])return!1;return this.sd!=b.sd||this.ep!=b.ep||this.cr!=b.cr?!1:!0};c.prototype.setGreater=function(b){for(var c=0;c<this.board.length;c++)if(this.board[c]!=
        b.board[c])return this.board[c]>b.board[c];return this.sd!=b.sd?this.sd>b.sd:this.ep!=b.ep?this.ep>b.ep:this.cr!=b.cr?this.cr>b.cr:!1};c.prototype.dump=function(b){var c=new CB.Board;c.copyFrom(this.board);c.toDebugStrs().forEach(void 0!==b?b:function(b){CB.LOG(b)});c="s="+this.sd+", ep="+this.ep+", cr="+this.cr;void 0!==b?b(c):CB.LOG(c)};c.prototype.isLegal=function(){var b=this.getPieces();if(32<b.length||2>b.length)return!1;for(var c=Array(CB.Piece.B_PAWN+1),d=0;d<c.length;++d)c[d]=0;for(d=0;d<
    b.length;++d){var h=b[d];++c[h.piece];if(CB.Piece.nominal(h.piece)===CB.Piece.PAWN&&(h=CB.Square.R(h.field),h==CB.Square.R_1||h==CB.Square.R_8))return!1}return 1!==c[CB.Piece.W_KING]||1!==c[CB.Piece.B_KING]||8<c[CB.Piece.W_PAWN]||8<c[CB.Piece.B_PAWN]?!1:!0};c.prototype.isBoardEqual=function(b){if(b.length!=this.board.length)return!1;for(var c=0;c<this.board.length;c++)if(this.board[c]!=b[c])return!1;return!0};c.prototype.findSquaresOfPiece=function(b){for(var c=[],e=0;e<this.board.length;e++)this.board[e]==
    b&&c.push(e);return c};c.fromValues=function(b,d,g,h){var e=new c;b.copyTo(e.board);e.sd=d;e.setCastleRights(g);e.setCPPEPFile(h);return e};return c}();"use strict";
CB.Annotation=function(){var d=function(){};d.prototype={};d.DIAG_CHAR="[#]";d.prototype.toString=function(){var b="",c;for(c in this)this.hasOwnProperty(c)&&(b+=this[c].toString());return b};d.prototype._read=function(b,c){for(var e=0;e<c;++e){var d=b.readShort(),g=AnnoRec.readHeader(b);CBDebug.assert(g.len===d,"LEN OK");g.len-=AnnoRec.ANNO_HEAD_SIZE;(d=AnnoFactory.factory(g.type))?(d.read(g.len,b),this.setItem(g.type,d)):b.skip(g.len)}return this};d.prototype._read2=function(b,c){this._read(b,c);
    return this};d.prototype.write=function(b){var c=0,e;for(e in this)this.hasOwnProperty(e)&&c++;b.writeShort(c);for(e in this)this.hasOwnProperty(e)&&this[e].write(b,e)};d.prototype.write2=function(b){var c=[],e;for(e in this)this.hasOwnProperty(e)&&c.push(e);var d=b.getPos();b.writeByte(0);var g=0;for(e=0;e<c.length;e++)this[c[e]].write&&(this[c[e]].write(b,c[e]),g++);c=b.getPos();b.setPos(d);b.writeByte(g);b.setPos(c)};d.write=function(b,c){c?c.write(b):b.writeShort(0)};d.write2=function(b,c){c?
    c.write2(b):b.writeByte(0)};d.prototype.read=function(b){var c=b.readShort();this._read(b,c)};d.prototype.read2=function(b){var c=b.readByte();c&&this._read2(b,c)};d.prototype.fromDataBuf=d.prototype.read;d.prototype.Vz=d.prototype.write;d.readFactory=function(b){var c=b.readShort();return c?(new CB.Annotation)._read(b,c):null};d.readFactory2=function(b){var c=b.readUint8();return c?(new CB.Annotation)._read2(b,c):null};d.prototype.empty=function(){for(var b in this)if(this.hasOwnProperty(b))return!1;
    return!0};d.prototype.count=function(){var b=0,c;for(c in this)this.hasOwnProperty(c)&&b++;return b};d.prototype.setItem=function(b,c){this[b]=c};d.prototype.hasItem=function(b){return!!this[b]};d.prototype.getItem=function(b){return this[b]};d.prototype.deleteItem=function(b){delete this[b]};d.prototype.addPreText=function(b){this[CB.AnnoType.PRETEXT]=new CB.TextAnno(b)};d.prototype.addPostText=function(b){this[CB.AnnoType.POSTTEXT]&&this[CB.AnnoType.POSTTEXT].m_str.length?this[CB.AnnoType.POSTTEXT].addText(" "+
    b):this[CB.AnnoType.POSTTEXT]=new CB.TextAnno(b)};d.prototype.hasDiagram=function(){if(this[CB.AnnoType.POSTTEXT]&&this[CB.AnnoType.POSTTEXT].m_str.length)return-1!=this[CB.AnnoType.POSTTEXT].m_str.search("[#]")};d.prototype.toggleDiagram=function(){this[CB.AnnoType.POSTTEXT]&&this[CB.AnnoType.POSTTEXT].m_str.length?-1!=this[CB.AnnoType.POSTTEXT].m_str.search("[#]")?(this[CB.AnnoType.POSTTEXT].m_str=this[CB.AnnoType.POSTTEXT].m_str.replace("[#]",""),this[CB.AnnoType.POSTTEXT].m_str.length||delete this[CB.AnnoType.POSTTEXT]):
    this[CB.AnnoType.POSTTEXT].m_str+="[#]":this[CB.AnnoType.POSTTEXT]=new CB.TextAnno("[#]")};d.prototype.removeDiagram=function(){};d.prototype.hasPreText=function(){return this.hasItem(CB.AnnoType.PRETEXT)};d.prototype.getPreText=function(){if(this.hasPreText())return this[CB.AnnoType.PRETEXT].getString()};d.prototype.getPostText=function(){if(this.hasPostText())return this[CB.AnnoType.POSTTEXT].getString()};d.prototype.hasPostText=function(){return this.hasItem(CB.AnnoType.POSTTEXT)};d.prototype.addSymbol=
    function(b){this[CB.AnnoType.SYMBOL]||(this[CB.AnnoType.SYMBOL]=new CB.SymbolsAnno);this[CB.AnnoType.SYMBOL].addSymbol(b)};d.prototype.hasSymbol=function(){return void 0!==this[CB.AnnoType.SYMBOL]};d.prototype.getSymbol=function(){return this[CB.AnnoType.SYMBOL]};d.prototype.hasColSquares=function(){return this.hasItem(CB.AnnoType.SQUARE_LIST)};d.prototype.hasArrows=function(){return this.hasItem(CB.AnnoType.ARROW_LIST)};d.prototype.hasTraining=function(){return this.hasItem(CB.AnnoType.TRAINING)};
    d.prototype.getTraining=function(){return this[CB.AnnoType.TRAINING]};d.prototype.setTraining=function(b){b?this[CB.AnnoType.TRAINING]=b:delete this[CB.AnnoType.TRAINING]};return d}();"use strict";
CB.GameResultEnum={GAME_UNFINISHED:-1,BLACK_WINS:0,DRAW:1,WHITE_WINS:2,LINE:3,UNDEFINED_RESULT:3,UNDEFINED:3,isFinished:function(d){return d>=this.BLACK_WINS&&d<=this.WHITE_WINS},toString:function(d){switch(d){case this.GAME_UNFINISHED:return lm.IN_PROGRESS;case this.WHITE_WINS:return"1\u20130";case this.BLACK_WINS:return"0\u20131";case this.DRAW:return"\u00bd\u2013\u00bd";case this.UNDEFINED_RESULT:return"";default:return""}},fromString:function(d){switch(d){case "\u00bd\u2013\u00bd":case "1/2-1/2":case "1/2":return this.DRAW;
        case "1\u20130":case "1-0":return this.WHITE_WINS;case "0\u20131":case "0-1":return this.BLACK_WINS}}};
CB.GameResult=function(){var d=function(b){this.n=b};d.prototype.isFinished=function(){return CB.GameResultEnum.isFinished(this.n)};d.prototype.toString=function(){return CB.GameResultEnum.toString(this.n)};d.prototype.toPGNString=function(){switch(this.n){default:return"*";case CB.GameResultEnum.WHITE_WINS:return"1-0";case CB.GameResultEnum.BLACK_WINS:return"0-1";case CB.GameResultEnum.DRAW:return"1/2-1/2"}};return d}();
CB.GameHeader=function(){var d=function(){this.white=new CB.PlayerData;this.black=new CB.PlayerData;this.event=new CB.EventData;this.player=[this.white,this.black];this.result=CB.GameResultEnum.LINE;this.clockParams=null};d.prototype.annotator="";d.prototype.round=0;d.prototype.subRound=0;d.prototype.board=0;d.prototype.eco="";d.prototype.result=CB.GameResultEnum.LINE;d.prototype.eloWh=0;d.prototype.eloBl=0;d.prototype.date=new CB.Date;d.prototype.clockParams=null;d.prototype.getStrPlayers=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        c){var e=this.white.getListStr(c||0);(c=this.black.getListStr(c||0))&&c.length?b?(b=e,0<this.eloWh&&(b+=" ("+this.eloWh+")"),b=b+" - "+c,0<this.eloBl&&(b+=" ("+this.eloBl+")")):b=e+"-"+c:b=e;return b};d.prototype.toString=function(){var b=this.event.toString(),c=this.date.toLocaleString(),e=this.getStrPlayers(!0,999);b&&(e+=", "+b);c&&(e+=" "+c);return e};d.prototype.getWhite=function(){return this.white.toString()};d.prototype.getClockParams=function(){return this.clockParams};d.prototype.setClockParams=
    function(b){this.clockParams=b};d.prototype.setWhite=function(b){this.white.init(b)};d.prototype.getBlack=function(){return this.black.toString()};d.prototype.setBlack=function(b){this.black.init(b)};d.prototype.getECO=function(){return this.eco};d.prototype.setECO=function(b){this.eco=b};d.prototype.getEvent=function(){return this.event.event};d.prototype.setEvent=function(b){this.event.event=b};d.prototype.getAnnotator=function(){return this.annotator};d.prototype.setAnnotator=function(b){this.annotator=
    b};d.prototype.getSite=function(){return this.event.site};d.prototype.setSite=function(b){this.event.site=b};d.prototype.isDefined=function(){return this.getWhite()||this.getBlack()};d.prototype.getResult=function(){return this.result};d.prototype.getCBResult=function(){return new CB.GameResult(this.result)};d.prototype.setResult=function(b){var c=this.result;this.result="undefined"!=typeof b?b:CB.GameResultEnum.LINE;return c};d.prototype.setRoundStr=function(b){b&&(b=b.split("."),this.round=parseInt(b[0],
    10),1<b.length&&(this.subRound=parseInt(b[1],10)))};d.prototype.getRoundStr=function(){var b="";this.round&&(b=""+this.round,this.subRound&&(b=b+"."+this.subRound));return b};d.prototype.getEloWhite=function(){return this.eloWh};d.prototype.setEloWhite=function(b){this.eloWh=b};d.prototype.getEloBlack=function(){return this.eloBl};d.prototype.setEloBlack=function(b){this.eloBl=b};d.prototype.getMaxElo=function(){return Math.max(this.eloWh,this.eloBl)};d.prototype.setDateStr=function(b){this.date=
    CB.Date.fromPGNString(b)};d.prototype.getLocaleDateStr=function(){return this.date.toLocaleString()};d.prototype.getDateStr=function(){return this.date.toPGNString()};d.prototype.setDeleted=function(b){this.flags=(this.deleted=b)?this.flags|1:this.flags&-2};d.prototype.read=function(b){this.white=CB.PlayerData.readFactory(b);this.black=CB.PlayerData.readFactory(b);try{this.event=CB.EventData.readFactory(b);CB.SourceData.readFactory(b);this.annotator=CB.AnnotatorData.readFactory(b).name;this.eloWh=
    b.readShort();this.eloBl=b.readShort();this.nEco=b.Vu();this.eco=CB.GameHeader.ECOtoString(this.nEco);this.result=CB.GameHeader.readResult(b);this.date=new CB.Date;var c=b.readInt();this.date.constructFromNum(c);this.plyCount=b.readShort();this.round=b.readByte();this.subRound=b.readByte();b.readInt();b.readInt();b.skipSizedRead()}catch(e){return console.log(e),!1}return!0};d.prototype.compactFromDataBuf=function(b){b.beginSizedRead();this.eType=b.V11();this.nGame=b.V10();this.white=CB.PlayerData.readFactory(b);
    this.black=CB.PlayerData.readFactory(b);this.event=CB.EventData.readFactory(b);this.eloWh=b.V11();this.eloBl=b.V11();this.result=CB.GameHeader.readResult(b);this.date=new CB.Date;this.date.fromDataBuf(b);this.plyCount=b.V11();this.round=b.readByte();this.subRound=b.readByte();b.Vw();b.Vw();this.nEco=b.Vu();this.eco=CB.GameHeader.ECOtoString(this.nEco);this.flags=b.Vu();this.deleted=!!(this.flags&1);b.endSizedRead()};d.prototype.compactToDataBuf=function(b){b.beginSizedWrite();void 0!==this.eType?
    b.Vv(this.eType):b.Vv(1);void 0!==this.nGame?b.Vx(this.nGame):b.Vx(0);this.white.write(b);this.black.write(b);this.event.write(b);b.writeShort(this.eloWh);b.writeShort(this.eloBl);d.writeResult(this.result,b);void 0===this.date&&(this.date=new CB.Date(0));this.date.Vz(b);this.plyCount?b.Vv(this.plyCount):b.Vv(0);b.writeByte(this.round);b.writeByte(this.subRound);b.Vh(0);b.Vh(0);this.nEco?b.Vi(this.nEco):b.Vi(0);void 0===this.flags&&(this.flags=0);this.deleted&&(this.flags|=1);b.Vi(this.flags);b.endSizedWrite()};
    d.prototype.write=function(b){this.white.write(b);this.black.write(b);this.event.write(b);(new CB.SourceData).write(b);(new CB.AnnotatorData(this.annotator)).write(b);b.writeShort(this.eloWh);b.writeShort(this.eloBl);b.writeShort(0);d.writeResult(this.result,b);b.writeInt(0);this.plyCount?b.writeShort(this.plyCount):b.writeShort(0);b.writeByte(this.round);b.writeByte(this.subRound);b.writeInt(0);b.writeInt(0);b.beginSizedWrite();b.endSizedWrite()};d.readResult=function(b){var c=b.readByte();b.readByte();
        b.readByte();return c};d.writeResult=function(b,c){c.writeByte(b);c.writeByte(0);c.writeByte(0)};d.ECOtoString=function(b){var c=b>>7;if(0<c&&500>=c){c--;var e=String.fromCharCode("A".charCodeAt()+c/100)[0];c%=100;e+=String.fromCharCode("0".charCodeAt()+c/10)[0];e+=String.fromCharCode("0".charCodeAt()+c%10)[0];if(c=b&127)e+="/",100<=c?e+="99":(e+=String.fromCharCode("0".charCodeAt()+c/10)[0],e+=String.fromCharCode("0".charCodeAt()+c%10)[0])}else e="";return e};d.prototype.toJson=function(){return{gameNo:this.nGame,
        white:this.white.getListStr(1),black:this.black.getListStr(1),event:this.event.event,date:this.date.getYear(),result:CB.GameResultEnum.toString(this.result),elow:this.eloWh,elob:this.eloBl,eco:this.eco,round:this.round,subRound:this.subRound,plyCount:this.plyCount,flags:this.flags}};d.prototype.matchesFilterVal=function(b){return-1!=this.white.last.search(b)||-1!=this.black.last.search(b)||-1!=this.event.site.search(b)||-1!=this.event.event.search(b)?!0:!1};return d}();
CB.PlayerData=function(){var d=function(b,c){this.first=b?b:"";this.last=c?c:""};d.prototype.toString=function(){return this.first&&this.first.length&&this.last&&this.last.length?String.formatEx("{last}, {first}",this):this.last||this.first};d.prototype.getListStr=function(b){return b&&this.first&&this.last&&this.first.length&&this.last.length?this.last+","+this.first.substr(0,b):this.last||this.first};d.g_splitOnComma=!0;d.g_splitOnSpace=!1;d.prototype.init=function(b){if(d.g_splitOnComma){var c=
    b.split(",");if(2===c.length){this.first=c[1].trim();this.last=c[0].trim();return}}if(d.g_splitOnSpace&&(c=b.split(" "),1<c.length)){this.first=c[0];this.last=c.slice(1).join(" ");return}this.last=b;this.first=""};d.create=function(b){var c=new d;c.init(b);return c};d.prototype.read=function(b){this.last=b.readByteLenASCIIString(50);this.first=b.readByteLenASCIIString(50);this.last=this.last.trim();this.first=this.first.trim()};d.readFactory=createReadFactory(d);d.prototype.write=function(b){b.writeByteLenASCIIString(this.last);
    b.writeByteLenASCIIString(this.first)};return d}();
CB.EventData=function(){var d=function(){this.event=this.site="";this.rounds=this.flags=this.category=this.nation=this.type=this.dt=0};d.prototype.read=function(b){this.site=b.readByteLenASCIIString(100);this.event=b.readByteLenASCIIString(100);this.dt=b.readInt();this.type=b.readShort();this.nation=b.readShort();this.category=b.readByte();this.flags=b.readByte();this.rounds=b.readShort()};d.readFactory=createReadFactory(d);d.prototype.write=function(b){b.writeByteLenASCIIString(this.site);b.writeByteLenASCIIString(this.event);
    b.writeInt(this.dt);b.writeShort(this.type);b.writeShort(this.nation);b.writeByte(this.category);b.writeByte(this.flags);b.writeShort(this.rounds)};d.prototype.toString=function(){var b=this.event;this.site&&this.event&&this.site!=this.event&&(b+=" ");this.site!=this.event&&(b+=this.site);return b};return d}();
CB.SourceData=function(){var d=function(){this.publisher=this.source="";this.quality=this.version=this.verdt=this.pubdt=0};d.prototype.read=function(b){this.source=b.readByteLenASCIIString(100);this.publisher=b.readByteLenASCIIString(100);this.pubdt=b.readInt();this.verdt=b.readInt();this.version=b.readByte();this.quality=b.readByte()};d.readFactory=createReadFactory(d);d.prototype.write=function(b){b.writeByteLenASCIIString(this.source);b.writeByteLenASCIIString(this.publisher);b.writeInt(this.pubdt);
    b.writeInt(this.verdt);b.writeByte(this.version);b.writeByte(this.quality)};return d}();
CB.TeamData=function(){var d=function(){this.team="";this.nation=this.seasoned=this.num=0};d.prototype.toString=function(){return this.num?String.formatEx("{team} {num}",this):this.team};d.prototype.read=function(b){this.team=b.readByteLenASCIIString(100);this.num=b.readShort();this.seasoned=b.readByte();this.nation=b.readByte()};d.readFactory=createReadFactory(d);d.prototype.write=function(b){b.writeByteLenASCIIString(this.team);b.writeShort(this.num);b.writeByte(this.seasoned);b.writeByte(this.nation)};
    return d}();CB.AnnotatorData=function(){var d=function(b){this.name="";b&&(this.name=b)};d.prototype.toString=function(){return this.name};d.prototype.read=function(b){this.name=b.readByteLenASCIIString(100)};d.readFactory=createReadFactory(d);d.prototype.write=function(b){b.writeByteLenASCIIString(this.name)};return d}();"use strict";CB.MoveEnterType={CANCEL:-1,TYPE_MASK:-64,LINE_MASK:63,QUERY:64,OVERWRITE_MAIN:128,OVERWRITE_LINE:256,NEWLINE:512,INSERT_MAIN:1024,NEWMAINLINE:2048,INSERT_LINE:4096};
CB.Game=function(){var d=function(b,c){b||(b=new CB.Position);this.start=b;c||(c=new CB.MoveLine);this.mainLine=c;this.stk=new CB.LineStack(this.mainLine);this.hdr=new CB.GameHeader;this.initPost()};d.prototype.start=null;d.prototype.cur=null;d.prototype.mainLine=null;d.prototype.stk=null;d.prototype.hdr=null;d.prototype.init=function(b,c){d.call(this,b,c);this.fireOnChanged();this.fireOnHeaderChanged()};d.prototype.initPost=function(){this.cur=ObjUtil.clone(this.start);d.initLine(this.start,this.mainLine)};
    d.prototype.assign=function(b,c){this.start=b.start;this.cur=b.cur;this.mainLine=b.mainLine;this.stk=b.stk;this.hdr=b.hdr;this.replaceGameNo=b.replaceGameNo;this.replaceDBId=b.replaceDBId;c||(this.fireOnResetGame(),this.fireOnCurPosChanged(),this.fireOnChanged(),this.fireOnHeaderChanged())};d.prototype.getMoves=function(){return this.mainLine};d.prototype.setMoves=function(b){this.mainLine=b};d.prototype.getMainLine=d.prototype.getMoves;d.prototype.getCurPos=function(){return this.cur};d.prototype.getStartPos=
        function(){return this.start};d.prototype.isNormalInit=function(){var b=new CB.Position;return ObjUtil.equals(this.start,b)};d.prototype.getNextMove=function(){var b=this.stk.Top();if(b){if(b.isLineEnd())return null;var c=b.getLine();b=b.getMovesToGo();return c[b]}return null};d.prototype.getLastMove=function(){if(this.stk){var b=this.stk.Top();if(!b||b.isLineStart())return null;var c=b.getLine();if(c)return b=b.getMovesToGo(),c[b-1]}return null};d.prototype.getPreviousMove=d.prototype.getLastMove;
    d.initLine=function(b,c){b=ObjUtil.clone(b);for(var e=0,f=c.length;e<f;++e){var g=c[e];b.preCalcCtx(g);if(g.hasLines())for(var h=g.getSubLines(),k=0,l=h.length;k<l;++k)d.initLine(b,h[k]);b.makeMove(g);b.postCalcCtx(g,e===c.length-1)}};d.prototype.reset=function(){d.apply(this);this.fireOnResetGame();this.fireOnCurPosChanged();this.fireOnChanged();this.fireOnHeaderChanged()};d.prototype.setResult=function(b){this.hdr.setResult(b);this.fireOnChanged();this.fireOnHeaderChanged()};d.prototype.getResult=
        function(){return this.hdr.getResult()};d.prototype.getCBResult=function(){return this.hdr.getCBResult()};d.prototype.getTopItem=function(){return this.stk.Top()};d.prototype.getTopLine=function(){if(this.stk.Top())return this.stk.Top().getLine()};d.prototype.getTopMovesToGo=function(){if(this.stk.Top())return this.stk.Top().getMovesToGo()};d.prototype.isLineEnd=function(){return this.stk.Top()?this.stk.Top().isLineEnd():!1};d.prototype.isOnMainLine=function(){return 1===this.stk.length};d.prototype.isGameStart=
        function(){return 1===this.stk.length&&this.stk[0].isLineStart()};d.prototype.isGameEnd=function(){return 1===this.stk.length&&this.stk[0].isLineEnd()};d.prototype.getStackPos=function(b){for(var c=ObjUtil.clone(this.start),e=0,d=b.length;e<d;++e){var g=b[e],h=g.getLine();g=g.getMovesToGo();for(var k=0;k<g;++k)c.makeMove(h[k])}return c};d.prototype.getLinePos=function(b,c){b=d.getStackForLine(b,c);return this.getStackPos(b)};d.prototype.setStack=function(b){this.stk=b;0<this.stk.length&&(this.mainLine=
        this.stk[0].line);this.cur=this.getStackPos(this.stk)};d.prototype.getSimplePath=function(){return this.stk.getSimplePath()};d.prototype.getHeader=function(){return this.hdr};d.prototype.setHeader=function(b){this.hdr=b};d.prototype.getGameNo=function(){return this.hdr.nGame};d.prototype.requiresPremiumForDownload=function(){var b=0;this.forAllMoves(function(c){b++});return b>2*this.getMainLine().length?5<this.hdr.annotator.length:!1};d.prototype.selfTest=function(){CBDebug.call(this.stk,this.stk.selfTest);
        CBDebug.call(this.mainLine,this.mainLine.selfTest,this.start,null,0)};d.prototype.getLineCnt=function(b){return this.stk.length};d.prototype.isOnLastMove=function(){return this.getMoveIndex()==this.mainLine.length};d.prototype.getPlyNum=function(){return this.getCurPos().getPlyNum()};d.prototype.getMoveNo=d.prototype.getPlyNum;d.prototype.getMoveCount=function(){return this.mainLine.length};d.prototype.getMoveBaggage=function(){return this.getLastMove()?this.getLastMove().getBaggage():this.baggage};
    d.prototype.setMoveBaggage=function(b){this.getLastMove()?this.getLastMove().setBaggage(b):this.baggage=b;this.fireOnChanged()};d.prototype.getAnno=function(b){if(this.getLastMove())return this.getLastMove().getAnnoItem(b);if(this.mainLine.anno)return this.mainLine.anno.getItem(b)};d.prototype.setAnno=function(b,c){this.getLastMove()&&(this.getLastMove().setAnnoItem(b,c),this.fireOnChanged())};d.prototype.setAnnoBeforeFirstMove=function(b,c,e){this.mainLine.anno||(this.mainLine.anno=new CB.Annotation);
        this.mainLine.anno.setItem(b,c);e||this.fireOnChanged()};d.prototype.getOrCreateCurrAnno=function(){if(this.getPreviousMove())return this.getPreviousMove().hasAnno()||this.getPreviousMove().setAnno(new CB.Annotation),this.getPreviousMove().getAnno();this.getMoves().hasAnno()||this.getMoves().setAnno(new CB.Annotation);return this.getMoves().getAnno()};d.prototype.updateFromExtern=function(){this.fireOnChanged();this.fireOnCurPosChanged()};d.prototype.updateHeaderFromExtern=function(){this.fireOnHeaderChanged()};
    d.prototype.deleteAnnosInCurLine=function(b,c){for(var e=this.getCurLine(),d=0;d<e.length;d++)e[d]&&(b?e[d].deleteAnnoItem(b):e[d].setAnno(null));c||this.fireOnChanged()};d.prototype.deleteAnno=function(b,c){this.getLastMove()&&(this.getLastMove().deleteAnnoItem(b),c||this.fireOnAnnoChanged())};d.prototype.getEvaluationProfile=function(){if(this.mainLine.anno&&this.mainLine.anno[CB.AnnoType.EVAL_PROFILE])return this.mainLine.anno[CB.AnnoType.EVAL_PROFILE];var b=this.getCurLine();if(b.length&&b[0].annos)return b[0].annos[CB.AnnoType.EVAL_PROFILE]};
    d.prototype.initEvaluationProfile=function(b){this.mainLine.anno||(this.mainLine.anno=new CB.Annotation);b=b||new CB.EvalProfileAnno;return this.mainLine.anno[CB.AnnoType.EVAL_PROFILE]=b};d.prototype.deleteEvaluationProfile=function(){this.mainLine.anno&&delete this.mainLine.anno[CB.AnnoType.EVAL_PROFILE]};d.prototype.toString=function(){var b=new CB.NotationGenerator(CB.V1),c=this.hdr.toString();c+="\r\n";for(var e=0;e<this.mainLine.length;e++){var d=b.getMoveNota(this.mainLine[e]),g=b.getStrMoveNumInLine(e,
        this.getStartPos().getPlyNum());c+=g+d;e<this.mainLine.length-1&&(c+=" ")}return c+=" "+this.hdr.getCBResult().toString()};d.prototype.onSync=function(b){if(V15.panelMgr&&V15.panelMgr.onSync)V15.panelMgr.onSync(b)};d.createTestGame=function(){return new CB.Game};d.prototype.delayChangedEvents=function(b){this.delayfireOnCurPosChanged(b);this.delayfireOnChanged(b);this.delayfireOnHeaderChanged(b);this.delayfireOnAnnoChanged(b)};d.prototype.continueChangedEvents=function(){this.continuefireOnCurPosChanged();
        this.continuefireOnChanged();this.continuefireOnHeaderChanged();this.continuefireOnAnnoChanged()};Ve.initForListeners(d);Ve.addEvent(d,"CurPosChanged",function(){return[this,this.getCurPos()]});Ve.addEvent(d,"Navigate",function(){return[this]});Ve.addEvent(d,"Move",function(){return[this,this.getLastMove()]});Ve.addEvent(d,"Changed");Ve.addEvent(d,"HeaderChanged");Ve.addEvent(d,"AnnoChanged");Ve.addEvent(d,"ResetGame");Ve.addEvent(d,"GameEnd",function(){return[this,this.getResult()]});Ve.addEvent(d,
        "ClickInNotation");Ve.addEvent(d,"NotaDoubleClick");Ve.addEvent(d,"Eval");return d}();
(function(d){d.prototype.jump=function(b){b=this.getMoveIndex()+b;1>b&&(b=1);b>this.mainLine.length&&(b=this.mainLine.length);this.gotoIndex(b);this.fireOnNavigate();this.fireOnCurPosChanged()};d.prototype.gotoFirst=function(){this.gotoIndex(0)};d.prototype.gotoLast=function(){this.gotoIndex(this.mainLine.length)};d.prototype.gotoIndex=function(b,e){b=d.getStackForIndex(this.mainLine,b);this.gotoStack(b,e)};d.prototype.gotoLine=function(b,e){b=d.getStackForLine(b,e);this.gotoStack(b)};d.prototype.gotoSimplePath=
    function(b){for(var c=this.mainLine,d=new CB.LineStack,g=0,h=b.length;g<h;++g){var k=b[g],l=new CB.LineStackItem(c,k.mvsToGo);d.push(l);g<h-1&&(c=c[k.mvsToGo].getLine(k.inxLine))}this.gotoStack(d)};d.prototype.triggerOnClickInNotation=function(){this.fireOnClickInNotation()};d.prototype.gotoNext=function(){if(!this.isLineEnd()){var b=this.getNextMove();this.cur.makeMove(b);(b=this.getTopItem())&&b.incMovesToGo();this.fireOnCurPosChanged();this.fireOnNavigate()}};d.prototype.gotoPrev=function(b){if(!this.isGameStart()){var c=
    this.stk;c.gotoPrev();this.gotoStack(c,b)}};d.prototype.gotoPrevClone=function(){if(!this.isGameStart()){var b=ObjUtil.clone(this.stk);b.gotoPrev();this.gotoStack(b)}};d.prototype.gotoStart=function(){this.gotoIndex(0);this.fireOnCurPosChanged();this.fireOnNavigate()};d.prototype.gotoEnd=function(){this.gotoIndex(this.mainLine.length);this.fireOnCurPosChanged();this.fireOnNavigate()};d.prototype.gotoStack=function(b,e){this.setStack(b);e||(this.fireOnCurPosChanged(),this.fireOnNavigate())};d.prototype.gotoMove=
    function(b,e){var c=this.getNextMove();return c?b.equals(c)?(b.mvd=c.mvd,this.gotoNext(),e&&this.fireOnMove(),!0):(b=c.findLine(b))?(this.gotoLine(b,1),e&&this.fireOnMove(),!0):!1:!1};d.prototype.beginLineNextMove=function(b){var c=this.getNextMove();if(!c||!c.hasLines()||b>=c.getSubLines().length)return!1;b=c.getSubLines()[b][0];return this.gotoMove(b)?b:!1};d.prototype.endLine=function(){if(1<this.stk.length){var b=this.stk[this.stk.length-2],e=b.getLine();this.gotoLine(e,b.mvsToGo);return this.getMoveIndex()}};
    d.prototype.getMoveOffs=function(){return this.cur.numPly-this.start.numPly};d.prototype.getMoveIndex=function(){var b=0;if(0<this.stk.length){b=this.stk[this.stk.length-1];var e=b.getLine();b=b.getMovesToGo();for(var d=this.stk.length-2;0<=d;--d){var g=this.stk[d].getLine(),h=e.getParentMoveIndex(),k=g[h],l=k.indexOfLine(e);CBDebug.assert(0<=l,"inxPrevLine >= 0");for(e=0;e<l;++e)b+=k.getLine(e).getTreeMoveCount();h+=1;for(k=g.length;h<k;++h)if(l=g[h],l.hasLines()){e=0;for(var m=l.getSubLinesCount();e<
    m;++e)b+=l.getLine(e).getTreeMoveCount()}b+=g.length;e=g}}return b};d.getStackForLine=function(b,e){for(var c=[];null!=b;e=b.getParentMoveIndex(),b=b.getParentLine())e=new CB.LineStackItem(b,e),c.push(e);for(b=new CB.LineStack;0<c.length;)e=c.pop(),b.push(e);return b};d.getStackForIndex=function(c,e){e={complete:!1,inxMv:e};var d=new CB.LineStack;b.call(this,c,e,d);return d};var b=function(c,e,d){var f=c.length;if(e.inxMv<=f)return d.push(new CB.LineStackItem(c,e.inxMv)),e.complete=!0;e.inxMv-=f;
        for(f=c.length-1;0<=f;--f){var h=c[f];if(h.hasLines()){d.push(new CB.LineStackItem(c,f));for(var k=0,l=h.getSubLinesCount();k<l;++k){var m=h.getLine(k);b(m,e,d);if(e.complete)return!0}d.pop()}}return!1}})(CB.Game);
(function(d){function b(b){this.cur.preCalcCtx(b);var c=this.cur.makeMove(b);this.cur.postCalcCtx(b,!0);return c}function c(b){return e.call(this,b,function(b,c){b.length=c+1})}function e(c,e){var d=b.call(this,c);d||CB.LogException("MoveInMain, no undo",c);var f=this.stk.Top();if(f){var g=f.getLine(),h=f.getMovesToGo();g[h]=c;e(g,h);f.setMovesToGo(h+1)}c.undo=d;this.fireOnMove(c);this.fireOnCurPosChanged();return d}function f(b){return e.call(this,b,function(b,c){m(this.cur,b,c+1)}.bind(this))}function g(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               e,d){var f=b.call(this,c),g=this.stk.Top(),h=g.getMovesToGo();e=g.getLine()[h].getLine(e);e[0]=c;d(e);c=new CB.LineStackItem(e,1);this.stk.push(c);this.fireOnMove();this.fireOnCurPosChanged();return f}function h(b,c){return g.call(this,b,c,function(b){b.length=1})}function k(b,c){var e=function(b){m(this.cur,b,1)}.bind(this);return g.call(this,b,c,e)}function l(c){var e=b.call(this,c),d=this.stk.Top();if(d){var f=d.getLine(),g=d.getMovesToGo();g<f.length?(d=f[g].newLine(f,g),d=new CB.LineStackItem(d,
    0),d.pushMove(c),this.stk.push(d)):d.pushMove(c);this.fireOnMove();this.fireOnCurPosChanged();return e}}function m(b,c,e){e=e||0;for(b=ObjUtil.clone(b);e<c.length;++e){var d=c[e];if(!b.isLegalMove(d))break;if(d.hasLines())for(var f=d.getSubLinesCount()-1;0<=f;--f){var g=d.getLine(f);m(b,g);0===g.length&&d.removeLine(f)}b.makeMove(d)}c.length=e}d.prototype.storeOnce=function(){this.storeState={start:ObjUtil.clone(this.start),cur:ObjUtil.clone(this.cur),mainLine:ObjUtil.clone(this.mainLine),stk:ObjUtil.clone(this.stk)}};
    d.prototype.restoreOnce=function(){this.storeState&&(this.start=ObjUtil.clone(this.storeState.start),this.cur=ObjUtil.clone(this.storeState.cur),this.mainLine=ObjUtil.clone(this.storeState.mainLine),this.stk=ObjUtil.clone(this.storeState.stk))};d.prototype.storeOnce2=function(){this.storeState={start:ObjUtil.clone2(this.start),cur:ObjUtil.clone2(this.cur),mainLine:ObjUtil.clone2(this.mainLine),stk:ObjUtil.clone2(this.stk)}};d.prototype.restoreOnce2=function(){this.storeState&&(this.start=ObjUtil.clone2(this.storeState.start),
        this.cur=ObjUtil.clone2(this.storeState.cur),this.mainLine=ObjUtil.clone2(this.storeState.mainLine),this.stk=ObjUtil.clone2(this.storeState.stk))};d.prototype.beginLine=function(b){l.call(this,b)};d.prototype.makeMove=function(b,e){0<=e&&63>=e&&(e=CB.MoveEnterType.NEWLINE);if(this.gotoMove(b))return!0;var d=null,g=e&CB.MoveEnterType.TYPE_MASK;e&=CB.MoveEnterType.LINE_MASK;switch(g){case CB.MoveEnterType.CANCEL&CB.MoveEnterType.TYPE_MASK:case CB.MoveEnterType.CANCEL:break;case CB.MoveEnterType.NEWMAINLINE:d=
        l.call(this,b);this.promoteLine();break;case CB.MoveEnterType.NEWLINE:d=l.call(this,b);break;case CB.MoveEnterType.INSERT_MAIN:d=f.call(this,b);break;default:case CB.MoveEnterType.OVERWRITE_MAIN:d=c.call(this,b);break;case CB.MoveEnterType.OVERWRITE_LINE:d=h.call(this,b,e);break;case CB.MoveEnterType.INSERT_LINE:d=k.call(this,b,e)}if(d)return b.undo=d,!0;CB.LogException("No Undo","Type="+g+", mv="+b);return!1}})(CB.Game);"use strict";
(function(d){function b(b){CBDebug.call(this,this.selfTest);if(!this.isOnMainLine()){var c=this.getTopLine(),d=c.getParentMove(),g=d.getSubLinesCount();g&&1!==g&&(c=d.indexOfLine(c),b=c+b,0>b||b>=g||(d.swapLines(c,b),CBDebug.call(this,this.selfTest),this.fireOnChanged()))}}d.prototype.promoteLine=function(){if(this.isOnMainLine())return!1;CBDebug.call(this,this.selfTest);this.stk.promoteLine();CBDebug.call(this,this.selfTest);this.fireOnChanged();return!0};d.prototype.upLine=function(){b.call(this,
    -1)};d.prototype.downLine=function(){b.call(this,1)};d.prototype.deleteLine=function(){if(!this.isOnMainLine()){CBDebug.call(this,this.selfTest);var b=this.stk.shallowClone(),e=this.getTopLine();e.getParentMove().removeLine(e);b.pop();this.setStack(b);CBDebug.call(this,this.selfTest);this.fireOnCurPosChanged();this.fireOnChanged()}};d.prototype.deleteRemaining=function(b){this.stk.deleteRemaining();b||this.fireOnChanged()};d.prototype.deletePrevious=function(){if(0!=this.getCurLine().length){var b=
    this.stk.shallowClone();b.gotoPrev();b=this.getStackPos(b);this.mainLine=this.stk.deletePrevious();this.start=b;this.fireOnChanged()}};d.prototype.unAnnotate=function(){this.mainLine.unAnnotate();var b=new CB.LineStack(this.mainLine,0);this.setStack(b);this.fireOnChanged();this.fireOnCurPosChanged()};d.prototype.startLine=function(){this.gotoPrev()};d.prototype.forAllMoves=function(b){this.mainLine.forAllMoves(b)}})(CB.Game);
(function(d){function b(b){for(var c=[],d=0,g=this.stk.length;d<g;++d){var h=this.stk[d],k=h.getLine();h=h.getMovesToGo();b||d!=g-1||(h=k.length);h&&(c=c.concat(k.slice(0,h)))}return c}d.prototype.getCurLine=function(){return b.call(this,!1)};d.prototype.getCurLineCut=function(){return b.call(this,!0)};d.prototype.getLineStartMoveNo=function(){for(var b=0,e=0;e<this.stk.length-1;e++)b+=this.stk[e].getMovesToGo();return b};d.prototype.getCurLineIndex=function(){for(var b=0,e=0,d=this.stk.length;e<
d;++e)b+=this.stk[e].getMovesToGo();return b};d.prototype.setCurLineIndex=function(b){for(var c=new LineStack,d=0,g=this.stk.length;d<g;++d){var h=this.stk[d],k=h.getMovesToGo();if(d<g-1&&k<b)c.push(h),b-=k;else{d=h.getLine();k=b;b=new CB.LineStackItem(d,k);c.push(b);break}}this.gotoStack(c)}})(CB.Game);"use strict";CB.Game=CB.Game||function(){};
(function(d){function b(c,e,f,g){if(f.isMainLine()&&ObjUtil.equals(c,e))return g.push(new CB.LineStackItem(f)),!0;e=ObjUtil.clone(e);for(var h=0;h<f.length;++h){var k=f[h];if(k.hasLines())for(var l=k.getSubLinesCount()-1;0<=l;--l){var m=k.getLine(l);g.push(new CB.LineStackItem(f,h));if(b(c,e,m,g))return!0;g.pop()}if(d.canCut(k,c,e))break;else if(e.makeMove(k),ObjUtil.equals(c,e))return g.push(new CB.LineStackItem(f,h+1)),!0}return!1}d.canCut=function(b,e,d){d.preSetMinCtx(b);var c=d.sd,f=b.getMoved();
    d.getPiece(b.to);var k=b.from;b=b.to;var l=CB.Square.R(k);d=CB.Square.R(b);var m=CB.Piece.make(CB.Piece.PAWN,c),p=c===CB.Side.WHITE?CB.Square.R_2:CB.Square.R_7;if(f===m&&l===p&&e.getPiece(k)===m)return!0;k=CB.Piece.changeSide(m);c=c===CB.Side.WHITE?CB.Square.R_7:CB.Square.R_2;return f===k&&d===c&&e.getPiece(b)===k||e.cr&CB.CastleRights.W_ALL&&f===CB.Piece.W_KING||e.cr&CB.CastleRights.B_ALL&&f===CB.Piece.B_KING?!0:!1};d.prototype.hasPos=function(b){return this._findPos(b)};d.prototype._findPos=function(c){var e=
    this.getStartPos(),d=new CB.LineStack;return b(c,e,this.mainLine,d)?d:null};d.prototype.gotoPos=function(b,e){var c=this._findPos(b);if(!c)return!1;this.gotoStack(c,e);CBDebug.call(this,this.selfTest);CBDebug.assert(this.cur.equals(b));return!0};d.prototype.findInTree=function(b){for(this.gotoEnd();0<this.getMoveNo();){if(b.hasPos(this.getCurPos()))return this.getMoveNo();this.gotoPrev()}return-1}})(CB.Game);
(function(d){function b(b){var c=new CB.Position;c=ObjUtil.equals(this.start,c);b.V13(c);c||(this.start.write(b),b.writeShort(0),b.writeShort(this.start.getMoveNum()),b.V13(c))}function c(b){var c=b.V14();!c&&(this.start.read(b),b.readShort(),c=b.readShort(),this.start.setMoveNum(c),c=b.V14())&&(this.start=new CB.Position)}function e(b){c.call(this,b);var e=new CB.Annotation;e.read2(b);this.mainLine.read2(b);e.empty()||this.mainLine.setAnno(e)}d.prototype.fromBuf64=function(b){var c=new CB.DataBuffer;
    c.constructFromBase64(b);b=new CB.Game;var e=new CB.GameHeader;e.compactFromDataBuf(c);c.V10();b.readGameOnly2(c);b.setHeader(e);this.assign(b)};d.prototype.write=function(c){var e=this.getMoveIndex();c.writeInt(e);c.writeInt(0);this.hdr.write(c);b.call(this,c);(new CB.Annotation).write(c);this.mainLine.write(c);c.beginSizedWrite();c.endSizedWrite()};d.prototype.read=function(b){var e=b.readInt();b.readInt();this.hdr.read(b);c.call(this,b);var d=new CB.Annotation;d.read(b);this.mainLine.read(b);d.empty()||
this.mainLine.setAnno(d);b.beginSizedRead();b.endSizedRead();this.initPost();CBDebug.call(this,this.selfTest);this.fireOnChanged();this.gotoIndex(e)};d.prototype.read2=function(b){var c=!1;this.hdr.read(b)&&(e.call(this,b),c=!0);this.initPost();return c};d.prototype.read3=function(b){var c=b.readInt();b.readInt();this.hdr.read(b);e.call(this,b);b.beginSizedWrite();b.endSizedWrite();this.initPost();CBDebug.call(this,this.selfTest);this.fireOnChanged();this.fireOnHeaderChanged();this.gotoIndex(c)};
    d.prototype.readGameOnly2=function(b){e.call(this,b);this.initPost()};d.prototype.writeGameOnly2=function(c){b.call(this,c);c.writeUint8(0);this.mainLine.write2(c)};d.prototype.fromDataBuf=d.prototype.read;d.prototype.Vz=d.prototype.write})(CB.Game);"use strict";CB.V1={arrStrPieces:[],strTakes:"x",strCheck:"+",strMate:"#",strProm:"",str00:"0-0",str000:"0-0-0",strNullMove:"--",bOmitPawnTakes:!1};CB.V1.arrStrPieces[CB.Piece.W_KING]=CB.V1.arrStrPieces[CB.Piece.B_KING]="K";
CB.V1.arrStrPieces[CB.Piece.W_QUEEN]=CB.V1.arrStrPieces[CB.Piece.B_QUEEN]="Q";CB.V1.arrStrPieces[CB.Piece.W_ROOK]=CB.V1.arrStrPieces[CB.Piece.B_ROOK]="R";CB.V1.arrStrPieces[CB.Piece.W_BISHOP]=CB.V1.arrStrPieces[CB.Piece.B_BISHOP]="B";CB.V1.arrStrPieces[CB.Piece.W_KNIGHT]=CB.V1.arrStrPieces[CB.Piece.B_KNIGHT]="N";CB.V1.arrStrPieces[CB.Piece.W_PAWN]=CB.V1.arrStrPieces[CB.Piece.B_PAWN]="";
CB.NotationGenerator=function(){var d=function(b){this.m_loc=b||CB.V1};d.prototype.getLocalization=function(){return this.m_loc};d.prototype.getLineNota=function(b,c,e){var d=0;e&&(d=e);b=b.getMoveNum();for(e="";d<c.length;++d){var g=c[d],h=g.getMoved();h=CB.Piece.side(h)===CB.Side.WHITE;e+=this.getMoveNota(g,h||!d?b:0)+" ";h||++b}return e};d.prototype.genLineNotaFromEnd=function(b,c){var e=b.getMainLine().length;e-=c;0>e&&(e=0);e=Math.floor(e/2)+1;for(var d=[],g=c=Math.max(0,b.getMoveNo()-c);g<b.getMainLine().length;++g){var h=
    b.getMainLine()[g],k=h.getMoved();k=CB.Piece.side(k)===CB.Side.WHITE;d.push(this.getMoveNota(h,k||g==c?e:0));k||++e}return d};d.prototype.getNota=function(b,c){var e=Math.floor(c.getCurPos().getMoveNum()/2+1);c.getCurPos().preCalcCtx(b);return this.getMoveNota(b,e)};d.prototype.getMoveNota=function(b,c){var e="",d=b.getMoved();c&&(e=""+c+".",CB.Piece.side(d)===CB.Side.BLACK&&(e+=".."));b.isNullMove()?e+=this.m_loc.strNullMove:b.isShortCastling()?e+=this.m_loc.str00:b.isLongCastling()?e+=this.m_loc.str000:
    (e=1>d||15<d?e+("[pcMvd="+d+"]"):e+this.m_loc.arrStrPieces[d],b.isNeedCol()&&(e+=CB.Square.colToString(CB.Square.C(b.from))),b.isNeedRow()&&(e+=CB.Square.rowToString(CB.Square.R(b.from))),b.isTake()&&(d===CB.Piece.W_PAWN||d===CB.Piece.B_PAWN?(e+=CB.Square.colToString(CB.Square.C(b.from)),this.m_loc.bOmitPawnTakes||(e+=this.m_loc.strTakes)):e+=this.m_loc.strTakes),e+=CB.Square.toString(b.to),b.prom&&(e+=this.m_loc.strProm,e+=this.m_loc.arrStrPieces[b.prom]));b.isMate()?e+=this.m_loc.strMate:b.isCheck()&&
    (e+=this.m_loc.strCheck);return e};d.prototype.getStrMoveNumInLine=function(b,c,e){var d=CB.Position.prototype.plyToMvNum(b+c),g="";if(0==(b+c&1)||0==b)g=d.toString()+".",e?0==(b+c&1)&&(g+=".."):0!=(b+c&1)&&(g+="..");return g};d.Localizations={};d.Localizations.invariant=CB.V1;return d}();var NotationLocalizations=CB.NotationGenerator.Localizations;"use strict";CB.SessionActionEnum={};
CB.SessionAction=function(){var d=function(){};d.prototype.init=function(b,c,e){this.id=-1;this.idGame=b;this.gameAction=c;this.controlMove=e;this.tickCount=new Date};d.prototype.getSockMsg=function(b){var c=new CB.WebSockMessage(USER);c.setUserType(b);this.Vz(c.getBuf());return c};d.prototype.fromDataBuf=function(b){this.id=b.V10();this.tickCount=b.V10();this.idGame=b.V10();this.controlMove=new CB.MoveRecord;this.controlMove.fromDataBuf(b);this.reserved1=b.V10();this.reserved2=b.V10();this.gameAction=
    new CB.GameAction;this.gameAction.fromDataBuf(b)};d.prototype.Vz=function(b){b.Vx(this.id);b.Vx(this.tickCount);b.Vx(this.idGame);this.controlMove.Vz(b);b.Vx(this.reserved1||0);b.Vx(this.reserved2||0);this.gameAction.Vz(b)};d.prototype.isAnEarlierMove=function(b){if(this.gameAction.type==CB.GameActionEnum.MOVEDATA){var c=this.gameAction.moveData;if(this.gameAction.moveData.moveNo<b.getPlyNum()&&(c=new CB.Move(c.move[0],c.move[1],c.move[2]),b.getMoves()[this.gameAction.moveData.moveNo].equals(c)&&
(0==this.gameAction.moveData.moveNo||b.getMoves()[this.gameAction.moveData.moveNo-1].equals(this.controlMove))))return!0}return!1};d.prototype.isPlayingMove=function(){return this.gameAction.type==CB.GameActionEnum.MOVEDATA};d.prototype.toString=function(){return"gameId="+this.idGame.toString(10)+" "+this.gameAction.toString()};return d}();"use strict";
CB.Attack={isPawnFork:function(d,b){var c=ObjUtil.clone(d);d=c.board[b.from];if((d&CB.Piece.PIECE_MASK)==CB.Piece.PAWN){c.makeMove(b);c.sd=CB.Side.other(c.sd);var e=[];c.generatePawn(d,b.to,e);if(2<=e.length){var f=0;e.forEach(function(b){(b=c.board[b.to])&&(b&CB.Piece.PIECE_MASK)!=CB.Piece.PAWN&&f++});return 2==f}}return!1},sumMaterial:function(d,b){var c=0,e=[0,0,900,325,325,450,100];d.board.forEach(function(d){d&&CB.Piece.side(d)==b&&(c+=e[CB.Piece.nominal(d)])});return c}};"use strict";
CB.AllowedColor={NONE:0,WHITE_ONLY:1,BLACK_ONLY:2,BOTH_COLORS:3,detFromOpponentSide:function(d){return d==CB.Side.BLACK?CB.AllowedColor.WHITE_ONLY:CB.AllowedColor.BLACK_ONLY}};
CB.MoveEntry=function(){var d=function(b){this.board=b;this.fnToMove=function(){return null};this.withPreMove=!0;this.preMoves=[]};d.prototype.onMove=function(){var b=this.getMySide();null!==b&&b===this.getCurPos().getSideToMove()&&this.processPreMove()};d.prototype.getLastPreMoveToSq=function(){if(this.preMoves.length)return this.preMoves[this.preMoves.length-1].to};d.prototype.onSquareClicked=function(b){};d.prototype.clearPreMoves=function(){CB.LOG("Clear PreMoves","LogBold");this.preMoves=[];
    this.getBoardWin().undoAttributes()};d.prototype.getPreMoveHsla=function(b){switch(b%7){case 0:return"hsla( 120, 90%, 40%, 0.9 )";case 1:return"hsla( 120, 00%, 100%, 0.9 )";case 2:return"hsla( 5, 90%, 70%, 0.9 )";case 3:return"hsla( 180, 90%, 50%, 0.9 )";case 4:return"hsla( 180, 00%, 40%, 0.9 )";case 5:return"hsla( 0, 0%, 5%, 0.9 )";case 6:return"hsla( 270, 70%, 60%, 0.9 )"}};d.prototype.renderPreMoves=function(){try{for(var b=[],e=0;e<this.preMoves.length;e++){var d=this.preMoves[e],g=this.getPreMoveHsla(e);
    b.push(new CB.BoardArrow(d.from,d.to,g))}b.length&&this.getBoardWin().queueBoardAttributes(b,{eraseQueue:!1,renderNow:!0,requestAnimInRender:!0})}catch(h){CB.LogException("ME::rp")}};d.prototype.clearPreMoves=function(){this.preMoves=[]};d.prototype.boardWinMoveEntered=function(b,e,d){try{if(this.colorOk()&&this.squareHasColorToMove(b)){var c=new CB.Move(b,e,d&7);this.fireOnStopClock();this.fireOnMoveEntered(c);return!0}if(this.withPreMove){var f=new CB.Move(b,e,d&7),k=!1;this.preMoves.forEach(function(c){c.from==
b&&c.to==e&&(k=!0)});k||(this.preMoves.push(f),CB.LOG("PreMove entered: "+f+", tot="+this.preMoves.length))}}catch(l){CB.LogException("MvE::Entd",l)}return!1};d.prototype.squareHasColorToMove=function(b){return CB.Piece.side(this.getCurPos().getPiece(b))==this.getCurPos().getSideToMove()};d.prototype.clearAttributesOnMouseDown=function(b){try{var c=!0;if(this.withPreMove){var d=this.getCurPos().getPiece(b);d&&CB.Piece.side(d)!=this.getCurPos().getSideToMove()&&CB.Piece.side(d)===this.getMySide()&&
(c=!1);b==this.getLastPreMoveToSq()&&(c=!1)}c&&this.board.undoAttributes(!0)}catch(g){CB.LogException("ME::clr",g)}};var b=!1;d.prototype.processPreMove=function(){if(b)return!1;b=!0;var c=!1;if(this.preMoves.length){var e=this.preMoves.shift();this.getCurPos().isLegalFromTo(e.from,e.to)&&this.getCurPos().getSideToMove()==this.getMySide()?(CB.LOG("Exec Legal PreMove: "+e,"LogBold"),this.fireOnStopClock(),new CB.Timer.launch(function(){this.fireOnMoveEntered(e)}.bind(this)),c=!0,this.renderPreMoves()):
    (CB.LOG("PreMove illegal: "+e,"LogRed"),this.clearPreMoves())}b=!1;return c};d.prototype.fillSingleClickMove=function(b,e){var c={ok:!1,from:-1};try{if(b.get(e)==CB.Piece.NONE){var d=this.getCurPos().V7();d=d.filter(function(b){return b.to==e});if(c.ok=1==d.length&&this.isSingleClickColorOk())c.from=d[0].from}}catch(h){CB.LogException("ME:FS",h)}return c};d.prototype.isLegalOrPremove=function(b,e,d){return this.colorOk(b.get(e),e)?this.getCurPos().isLegalFromTo(e,d)||this.isPremove(b,e,d):!1};d.prototype.isLegal=
    function(b,e,d){return this.canMoveForCurSide()?this.getCurPos().isLegalFromTo(e,d):!1};d.prototype.isMyPiece=function(b){return!!(this.getBoardWin().board.get(b)&CB.Piece.SIDE_MASK)==this.getCurPos().isBTM()&&0<this.getBoardWin().board.get(b)};d.prototype.isOpponentPiece=function(b){return!!(this.getBoardWin().board.get(b)&CB.Piece.SIDE_MASK)!=this.getCurPos().isBTM()&&0<this.getBoardWin().board.get(b)};d.prototype.tryTwoClickMove=function(b,e){var c=this.getBoardWin().board;if(this.colorOk(c.get(b),
    b)&&this.getCurPos().isLegalFromTo(b,e)){c=0;if(this.getBoardWin().isWhitePromoPawn(b)||this.getBoardWin().isBlackPromoPawn(b))c=CB.Piece.QUEEN;return this.boardWinMoveEntered(b,e,c)}return!1};d.prototype.colorOk=function(b,e){switch(this.getAllowedColor()){case CB.AllowedColor.BOTH_COLORS:return!0;case CB.AllowedColor.WHITE_ONLY:return this.getCurPos().isWTM()||this.colorOkInPremove(b,CB.Side.WHITE,e);case CB.AllowedColor.BLACK_ONLY:return this.getCurPos().isBTM()||this.colorOkInPremove(b,CB.Side.BLACK,
    e);default:return!1}};d.prototype.colorOkInPremove=function(b,e,d){return this.withPreMove&&(this.preMovesLeadTo(d)||b&&CB.Piece.side(b)==e)?!0:!1};d.prototype.canMoveForCurSide=function(){switch(this.getAllowedColor()){case CB.AllowedColor.BOTH_COLORS:return!0;case CB.AllowedColor.WHITE_ONLY:return this.getCurPos().isWTM();case CB.AllowedColor.BLACK_ONLY:return this.getCurPos().isBTM();default:return!1}};d.prototype.isSingleClickColorOk=function(){switch(this.getAllowedColor()){case CB.AllowedColor.WHITE_ONLY:return this.getCurPos().isWTM();
    case CB.AllowedColor.BLACK_ONLY:return this.getCurPos().isBTM();default:case CB.AllowedColor.BOTH_COLORS:return!0}};d.prototype.onPosInput=function(b){};d.prototype.allowBothColors=function(){this.setMySide(null)};d.prototype.isPremove=function(b,e,d){return 0<=e&&0<=d&&63>=e&&63>d?this.preMovesLeadTo(e)?!0:(b=b.get(e))&&this.withPreMove&&this.getCurPos().isBTM()==(CB.Piece.side(b)==CB.Side.WHITE):!1};d.prototype.isLegalFromTo=function(b,e){return this.getCurPos().isLegalFromTo(b,e)};d.prototype.preMovesLeadTo=
    function(b){if(this.withPreMove)for(var c=0;c<this.preMoves.length;c++)if(this.preMoves[c].to==b)return!0;return!1};d.prototype.isPremovePromoPawn=function(b,e){if(-1==b)return!1;for(var c=this.preMoves.length-1;0<=c;c--)if(this.preMoves[c].to==b){var d=this.getCurPos().board[this.preMoves[0].from];if((d&CB.Piece.PIECE_MASK)==CB.Piece.PAWN&&CB.Piece.side(d)==e)return 6==CB.Square.getRank(b)||1==CB.Square.getRank(b)}return!1};d.prototype.mayEnPassant=function(b,e){return this.isLegalFromTo(b,e)?this.getCurPos().getEPCol()==
    CB.Square.getFile(e):!1};d.prototype.test=function(){};d.prototype.getGame=function(){return this.board.getGame()};d.prototype.getCurPos=function(){return this.getGame().getCurPos()};d.prototype.getBoardWin=function(){return this.board};d.prototype.getMySide=function(){return this.fnToMove()};d.prototype.setMySide=function(b){ObjUtil.isFunction(b)?this.fnToMove=b:this.fnToMove=function(){return b}};d.prototype.getAllowedColor=function(){switch(this.getMySide()){case CB.Side.WHITE:return CB.AllowedColor.WHITE_ONLY;
    case CB.Side.BLACK:return CB.AllowedColor.BLACK_ONLY;default:return CB.AllowedColor.BOTH_COLORS}};d.prototype.mayEnterBackwards=function(b,e){if(0<=e&&64>e)return b=b.get(e),this.getCurPos().isBTM()==(CB.Piece.side(b)==CB.Side.BLACK)};Ve.initForListeners(d);Ve.addEvent(d,"MoveEntered");Ve.addEvent(d,"StopClock");return d}();"use strict";
CB.GameKernel=function(){var d=1,b=function(b,e){this.game=e||new CB.Game;CB.protect(this,"game");this.setGameListeners();this.legalMoves=[];this.viewLink=b;this.isPostAnnoEdit=!0;this.uniqueId=d++;this.audioInst=new CB.ChessAudioInstance;this.audioInst.setGame(this.game);this.fnInitGame=function(b){b.reset();if(PGN&&V15&&V15.urlParams&&V15.urlParams.pgn){var c=PGN.parseGame(V15.urlParams.pgn);b.assign(c)}else V15&&V15.urlParams&&V15.urlParams.buf64?(CB.strUtil.getURLParam("buf64"),c=new CB.Game,
    c.fromBuf64(V15.urlParams.buf64),b.assign(c)):V15&&V15.urlParams&&V15.urlParams.hasStartPos&&V15.urlParams.hasStartPos()?(V15.urlParams.fen?c=new CB.Position(V15.urlParams.fen):V15.urlParams.pos&&(c=new CB.Position,c.initString(V15.urlParams.pos)),c.isLegal()&&b.assign(new CB.Game(c))):this.playFromPgnGame&&!this.playFromPgnGame.isNormalInit()&&b.assign(new CB.Game(this.playFromPgnGame.getStartPos()))}};b.prototype.destroy=function(){this.setBoardWin(null);this.audioInst.setGame(null);this.removeGameListeners();
    this.releaseCommandHandlers();this.Vk&&this.Vk.destroy()};b.prototype.setAllowedColor=function(b){this.boardWin&&(this.boardWin.moveEntry.allowedColor=b)};b.prototype.linkCommandHandlers=function(){this.commandHandlerId=V15.commands.registerCommandHandler(this);this.keyDownHandlerId=V15.commands.registerkeyDownHandler(this)};b.prototype.releaseCommandHandlers=function(){V15.commands.unregisterCommandHandler(this.commandHandlerId);V15.commands.unregisterkeyDownHandler(this.keyDownHandlerId)};b.prototype.createControl=
    function(b,e,d,g){this.animateBoard=!0;var c="undefined"===typeof this.boardArea;this.boardArea=new CB.BoardArea(b,e,d,g);var f=(g?g.fnBoardFactory:null)||this.fnBoardFactory;f?b=f(b,e,d,"ByKernel",g):(b=new CB.BoardControl(b,e,d,"ByKernel",g),g&&g.mixin&&CB.mixObject(b,g.mixin));!g||!g.addTitle||V15.panelMgr.hasLogo&&V15.panelMgr.hasLogo()||b.addTitle(null,g.noClock);this.setBoardWin(b);this.Vk.createGUIElements(this.boardWin);this.boardArea.addBoard(this.boardWin);c&&this.initGame();this.boardWin.addStyleListener();
        this.releaseCommandHandlers();this.linkCommandHandlers();return this.boardArea};b.prototype.createControl3D=function(b,e,d){this.animateBoard=V15.animatedBoard();this.boardArea=new CB.BoardArea3D(b,e,d);b=new CB.BoardControl3D(b,e,d,"FritzBoard",this.on3DLoaded.bind(this));this.setBoardWin(b);this.Vk.createGUIElements(this.boardWin);this.boardArea.addBoard(this.boardWin);this.boardWin.addStyleListener();this.releaseCommandHandlers();this.linkCommandHandlers();return this.boardArea};b.prototype.on3DLoaded=
    function(){this.boardWin&&this.boardWin.setGame(this.game)};b.prototype.enableAudio=function(b){this.audioInst&&this.audioInst.enable(b)};b.prototype.setBlackIsBottom=function(b){this.boardWin&&this.boardWin.setBlackIsBottom(b)};b.prototype.setBoardWin=function(b){this.boardWin&&this.boardWin.moveEntry.removeOnMoveEnteredListener(this.idOnMoveEntered);if(this.boardWin=b)this.boardWin.moveEntry&&(this.boardWin.moveEntry.setMySide&&this.boardWin.moveEntry.setMySide(this.getMySide.bind(this)),this.boardWin.moveEntry.addOnMoveEnteredListener&&
(this.idOnMoveEntered=this.boardWin.moveEntry.addOnMoveEnteredListener(this.reactToEnteredMove.bind(this)))),this.boardWin.setGame(this.game),this.idGame&&(this.boardWin.idGame=this.idGame)};b.prototype.createNotaElement=function(b,e,d){this.notation=CB.NotaElement.factory(b,e,null);this.notation.setGame(this.game);return this.notation};b.prototype.suppressNotationFromMoves=function(b){this.notation&&this.notation.suppressNotationFromMoves(b)};b.prototype.onPanelsReady=function(){this.Vk.onPanelsReady()};
    b.prototype.setPlayingMode=function(b){this.modeState=this.modeState||{};this.Vk&&this.Vk.saveState(this.modeState);this.boardWin&&this.Vk&&(this.Vk.destroyGUIElements(this.boardWin),this.Vk.destroy());this.Vk=b;this.boardWin&&(this.Vk.createGUIElements(this.boardWin),this.Vk.onPanelsReady(),this.Vk&&this.Vk.loadState(this.modeState),this.Vk.updateGamePos());this.boardArea&&this.boardArea.forceResize();this.Vk.getFnLoadSearchResult&&(this.loadSearchResultGame=this.Vk.getFnLoadSearchResult())};b.gMapTimeControls=
        null;b.getTimeControl=function(c){b.initTimeControls();return b.gMapTimeControls[c]};b.initTimeControls=function(){b.gMapTimeControls||(b.gMapTimeControls={},b.gMapTimeControls[V15.Vo.LEVEL_BLITZ_3_0]={clockParams:new CB.ClockParams(3,0)},b.gMapTimeControls[V15.Vo.LEVEL_BLITZ_4_0]={clockParams:new CB.ClockParams(4,0)},b.gMapTimeControls[V15.Vo.LEVEL_BLITZ_5_0]={clockParams:new CB.ClockParams(5,0)},b.gMapTimeControls[V15.Vo.LEVEL_BLITZ_3_2]={clockParams:new CB.ClockParams(3,2)},b.gMapTimeControls[V15.Vo.LEVEL_BLITZ_5_5]=
        {clockParams:new CB.ClockParams(5,5)},b.gMapTimeControls[V15.Vo.LEVEL_1_SECOND]={fixedTime:1E3},b.gMapTimeControls[V15.Vo.LEVEL_5_SECONDS]={fixedTime:5E3},b.gMapTimeControls[V15.Vo.LEVEL_15_SECONDS]={fixedTime:15E3},b.gMapTimeControls[V15.Vo.LEVEL_40_SECONDS]={fixedTime:4E4})};b.prototype.execCommand=function(b){try{switch(b){case V15.Vo.NEW_GAME:this.newGame();break;case V15.Vo.SETUP_POSITION:this.togglePosInputMode(this.Vk.posLegalChecker);break;case V15.Vo.TAKEBACK:this.Vk.mayNavigate()&&this.game.gotoPrev();
        break;case V15.Vo.EXECMOVE:this.Vk.mayNavigate()&&this.game.gotoNext();break;case V15.Vo.START_LINE:this.startLine();break;case V15.Vo.FLIP_BOARD:this.boardWin&&this.boardWin.flipBoard();break;case V15.Vo.PROMOTE_LINE:this.Vk.onPromoteLine()&&this.game.promoteLine();break;case V15.Vo.DELETE_LINE:this.Vk.onDeleteLine()&&this.game.deleteLine();break;case V15.Vo.CUT_LINE:this.Vk.onCutLine()&&this.game.deleteRemaining();break;case V15.Vo.DELETE_PREVIOUS_MOVES:this.Vk.onDeletePrevious()&&this.game.deletePrevious();
        break;case V15.Vo.ADD_POST_TEXT:this._editAnno(!0);break;case V15.Vo.ADD_PRE_TEXT:this._editAnno(!1);break;case V15.Vo.INSERT_DIAGRAM:this.Vk.onInsertDiagram()&&this.insertDiagram();break;case V15.Vo.ENGINE_PLUS_LINE:this.changeEngineLines(1);break;case V15.Vo.ENGINE_MINUS_LINE:this.changeEngineLines(-1);break;case V15.Vo.OPEN_CMS:this.openCMS();break;case V15.Vo.PLAYERDB_TEST:this.Vk.test();break;case V15.Vo.GAME_COPYTOCLIPBOARD:this.copyGameToClipboard();break;case V15.Vo.GAME_PASTEFROMCLIPBOARD:this.pasteGameFromClipboard();
        break;case V15.Vo.MARK_GOOD:this.Vk.onAnnotate()&&this.addSymbol(CB.AnnoMarkType.GOOD);break;case V15.Vo.MARK_BAD:this.Vk.onAnnotate()&&this.addSymbol(CB.AnnoMarkType.BAD);break;case V15.Vo.MARK_VERYGOOD:this.Vk.onAnnotate()&&this.addSymbol(CB.AnnoMarkType.VERY_GOOD);break;case V15.Vo.MARK_VERYBAD:this.Vk.onAnnotate()&&this.addSymbol(CB.AnnoMarkType.VERY_BAD);break;case V15.Vo.MARK_INTERESTING:this.Vk.onAnnotate()&&this.addSymbol(CB.AnnoMarkType.INTERESTING);break;case V15.Vo.MARK_DUBIOUS:this.Vk.onAnnotate()&&
    this.addSymbol(CB.AnnoMarkType.DUBIOUS);break;case V15.Vo.WHITE_WINS:this.Vk.onEval(CB.AnnoEvalType.WHITE_WINS)&&this.addSymbol(CB.AnnoEvalType.WHITE_WINS);break;case V15.Vo.WHITE_BETTER:this.Vk.onEval(CB.AnnoEvalType.WHITE_BETTER)&&this.addSymbol(CB.AnnoEvalType.WHITE_BETTER);break;case V15.Vo.WHITE_SLIGHTLY:this.Vk.onEval(CB.AnnoEvalType.WHITE_SLIGHTLY_BETTER)&&this.addSymbol(CB.AnnoEvalType.WHITE_SLIGHTLY_BETTER);break;case V15.Vo.EQUAL:this.Vk.onEval(CB.AnnoEvalType.EQUAL)&&this.addSymbol(CB.AnnoEvalType.EQUAL);
        break;case V15.Vo.UNCLEAR:this.Vk.onEval(CB.AnnoEvalType.UNCLEAR)&&this.addSymbol(CB.AnnoEvalType.UNCLEAR);break;case V15.Vo.BLACK_WINS:this.Vk.onEval(CB.AnnoEvalType.BLACK_WINS)&&this.addSymbol(CB.AnnoEvalType.BLACK_WINS);break;case V15.Vo.BLACK_BETTER:this.Vk.onEval(CB.AnnoEvalType.BLACK_BETTER)&&this.addSymbol(CB.AnnoEvalType.BLACK_BETTER);break;case V15.Vo.BLACK_SLIGHTLY:this.Vk.onEval(CB.AnnoEvalType.BLACK_SLIGHTLY_BETTER)&&this.addSymbol(CB.AnnoEvalType.BLACK_SLIGHTLY_BETTER);break;case V15.Vo.COMPENSATION:this.Vk.onEval(CB.AnnoEvalType.COMPENSATION)&&
    this.addSymbol(CB.AnnoEvalType.COMPENSATION)}}catch(e){b=V15.Vo.toNumString(b),CB.LogException(b,e)}};b.prototype.onKeyDown=function(b){var c=this.Vk.onKeyDown(b);if(!c&&b&&b.getKey)switch(this.breakLoop=c=!0,b.getKey()){default:c=!1;break;case b.A:b.ctrlKey?this._editAnno(!0):c=!1;break;case b.F:b.ctrlKey?this.execCommand(CB.CommandIds.FLIP_BOARD):c=!1;break;case b.N:b.ctrlKey?this.execCommand(CB.CommandIds.NEW_GAME):c=!1;break;case b.LEFT:this.Vk.mayNavigate()&&this.game.gotoPrev();break;case b.RIGHT:this.handleCursorRight();
        break;case b.HOME:this.Vk.mayNavigate()&&this.game.gotoStart();break;case b.END:this.handleEnd();break;case b.PAGE_DOWN:this.handlePageDown();break;case b.PAGE_UP:this.Vk.mayNavigate()&&this.game.jump(-20);break;case b.SPACE:this.Vk.mayNavigate()&&(c=this.execCommand(CB.CommandIds.ENGINE_MOVE_NOW));break;case b.F2:b.altKey?this.execCommand(CB.CommandIds.TOGGLE_ANALYSIS_ENGINE):c=!1}return c};b.prototype.onFileSelect=function(b,e){return!1};b.prototype.handleCursorRight=function(){this.Vk.mayGotoNext()&&
    this.game.gotoNext()};b.prototype.handleEnd=function(){this.Vk.mayGotoEnd()&&this.game.gotoEnd()};b.prototype.handlePageDown=function(){this.Vk.mayPageDown()&&this.game.jump(20)};b.prototype.togglePosInputMode=function(b){V15.isPremium()?this.posInput?this.endPosInputMode():this.startPosInputMode(b):V15.panelMgr.showBoardMessage(lm.PREMIUM_ONLY,3E3)};b.prototype.doTest=function(){var b=new CB.Position("8/7k/P7/8/K7/8/8/8 w - - 0 1");b=new CB.Game(b);this.game.assign(b)};b.prototype.startPosInputMode=
        function(b){this.boardWin&&(this.boardWin.destroyTitle(),this.posInput=new CB.PosInputControl(this.boardWin.cbcanvas,this.boardWin.width,this.boardWin.height,"posInput",function(b){(new CB.Timer(function(){this.endPosInputMode(b)}.bind(this))).launch()}.bind(this),b,{}),this.boardArea.setPosInput(this.posInput),this.posInput.createButtons(),this.posInput.setPosition(this.getCurPos()),this.boardArea.calcGeometry())};b.prototype.endPosInputMode=function(b){if(this.posInput){var c=new CB.Game(this.posInput.createPosition());
        this.boardArea.removePosInput(this.boardWin);this.posInput.destroy();delete this.posInput;this.Vk.createGUIElements(this.boardWin);b||this.game.assign(c);this.Vk.onPosInput(c.getCurPos());this.boardWin.moveEntry.onPosInput(c.getCurPos());this.setBlackIsBottom(c.getCurPos().getBTM())}};b.prototype.setPGN=function(b){b&&(this.game.assign(PGN.parseGame(b)),this.game.gotoFirst())};b.prototype.initGame=function(){this.fnInitGame(this.game,this);this.Vk.newGame(!1)};b.prototype.newGame=function(){this.boardWin&&
    (this.boardWin.prepareFullRedraw(),this.boardWin.destroyMessage(),this.boardWin.clearBoardAttributes(),this.boardWin.moveEntry.clearPreMoves());this.Vk.resetGame(this.game);this.Vk.newGame(!0)};b.prototype.setGameListeners=function(){this.game&&(this.idNavListener=this.game.addOnNavigateListener(this._onGameNavigate.bind(this)),this.idMoveListener=this.game.addOnMoveListener(this._onGameMove.bind(this)),this.idChangeListener=this.game.addOnChangedListener(this._onGameChanged.bind(this)),this.idHeaderListener=
        this.game.addOnHeaderChangedListener(this._onHeaderChanged.bind(this)),this.idCurPosListener=this.game.addOnCurPosChangedListener(this._onGameCurPosChanged.bind(this)),this.idResetGameListener=this.game.addOnResetGameListener(this._onResetGame.bind(this)),this.idClickInNotationListener=this.game.addOnClickInNotationListener(this._onClickInNotation.bind(this)))};b.prototype.removeGameListeners=function(){this.game.removeOnNavigateListener(this.idNavListener);this.game.removeOnMoveListener(this.idMoveListener);
        this.game.removeOnChangedListener(this.idChangeListener);this.game.removeOnHeaderChangedListener(this.idHeaderListener);this.game.removeOnCurPosChangedListener(this.idCurPosListener);this.game.removeOnResetGameListener(this.idResetGameListener);this.game.removeOnClickInNotationListener(this.idClickOnNotationListener)};b.prototype.getGameClickHandler=function(){return this.onDBGameClicked.bind(this)};b.prototype.onDBGameClicked=function(b,e){b.loadGameAsync(this.gameLoadedCallback.bind(this),e)};b.prototype.gameLoadedCallback=
        function(b){void 0!==b&&(this.loadSearchResultGame?this.loadSearchResultGame(b):(this.game.assign(b),this.game.gotoFirst()))};b.prototype.stepRandomGame=function(b){1E4>b&&this.makeRandomMove()&&!this.breakLoop&&setTimeout(function(){this.stepRandomGame(b+1)}.bind(this),5)};b.prototype.stepRetractAll=function(b){0<this.game.getMoveIndex()&&!this.breakLoop&&(this.game.gotoPrev(),setTimeout(function(){this.stepRetractAll()}.bind(this),5))};b.prototype.makeRandomMove=function(){0==this.legalMoves.length&&
    (this.legalMoves=this.getCurPos().V7());this.game.makeMove(this.legalMoves[Math.floor(Math.random()*this.legalMoves.length)]);return!0};b.prototype.getMySide=function(){if(this.Vk)return this.Vk.getMySide()};b.prototype.setMySide=function(b){this.Vk&&this.Vk.setMySide(b)};b.prototype.onReload=function(b){};b.prototype.reactToEnteredMove=function(b){try{if(this.game.getCurPos().isLegalMove(b)&&!this.Vk.reactToEnteredMove(b)){if(this.Vk.onEnteredMove(b)){if(this.game.gotoMove(b))return;var c=this.Vk.getMoveEnterType();
        this.nextMoveEnterType&&(c=this.nextMoveEnterType,this.nextMoveEnterType=null);var d=function(b,c){c!=CB.MoveEnterType.CANCEL&&(this.game.makeMove(b,c),this.checkIfTechnicalGameEnd())}.bind(this);c==CB.MoveEnterType.QUERY?(c=function(b,c,e,f){d(e,c)},CB.Forms&&CB.Forms.showMoveForm(this.game,this.game.getCurPos(),b,null,c)):d(b,c)}else this.game.fireOnCurPosChanged();this.Vk.onAfterMoveEntry(b)}}catch(g){CB.LogException("GK:ReactTo",g)}};b.prototype.markLastMove=function(b,e){this.boardWin&&this.boardWin.markLastMove(b||
        !this.animateBoard,e)};b.prototype.markSquare=function(b,e){this.boardWin&&this.boardWin.markSquare(b,e)};b.prototype.drawArrow=function(b,e,d){this.boardWin&&this.boardWin.drawArrow(b,e,d)};b.prototype.execAndAnimCurrMove=function(b){if(this.boardWin){var c=this.boardWin.animSteps.forMove;CB.System.isMobile()?this.boardWin.animSteps.forMove=b||4:this.boardWin.animSteps.forMove=b||10}this.game.gotoNext();this.boardWin&&(this.boardWin.animSteps.forMove=c)};b.prototype.retractAndAnimCurrMove=function(b){if(this.boardWin){var c=
        this.boardWin.animSteps.forMove;CB.System.isMobile()?this.boardWin.animSteps.forMove=b||2.5:this.boardWin.animSteps.forMove=b||6}this.game.gotoPrev();this.boardWin&&(this.boardWin.animSteps.forMove=c)};b.prototype.makeAndAnimMove=function(b,e){this.moveWithAnimation(function(){this.game.makeMove(b,CB.MoveEnterType.OVERWRITE_MAIN)}.bind(this),e)};b.prototype.moveWithAnimation=function(b,e){var c=this.boardWin.animSteps.forMove;CB.System.isMobile()?this.boardWin.animSteps.forMove=e||4:this.boardWin.animSteps.forMove=
        e||10;b();this.boardWin.animSteps.forMove=c;this.boardWin.callOnAnimFinished=function(){this.boardWin.redraw();this.boardWin.callOnAnimFinished=null}.bind(this)};b.prototype.setResult=function(b,e){this.game.setResult(b);this.Vk.onResult(b,e)};b.prototype.checkIfTechnicalGameEnd=function(){if(!this.isFinished()){var b={drawType:0},e=this.checkTechnicalResult(b);if(e!=CB.GameResultEnum.UNDEFINED){this.Vk.suppressTechnicalResult||this.setResult(e,CB.ResultFlags.TECHNICAL);if(this.onTechnicalGameEnd)this.onTechnicalGameEnd(e,
        b);return!0}}return!1};b.prototype.isFinished=function(){return this.game.hdr.getCBResult().isFinished()};b.prototype.isBTM=function(){return this.game.getCurPos().isBTM()};b.prototype.checkTechnicalResult=function(c){return b.staticCheckTechnicalResult(this.game,c)};b.staticCheckTechnicalResult=function(b,e){var c=(new CB.DrawChecker).checkGame(b),d=CB.GameResultEnum.UNDEFINED;switch(c){case CB.DrawType.STALEMATE:case CB.DrawType.MATERIAL:d=CB.GameResultEnum.DRAW;break;case CB.DrawType.MATE:d=b.getCurPos().isBTM()?
        CB.GameResultEnum.WHITE_WINS:CB.GameResultEnum.BLACK_WINS;break;case CB.DrawType.THREE_TIMES:case CB.DrawType.FIFTY_MOVES:d=CB.GameResultEnum.DRAW}e&&(e.drawType=c);return d};b.prototype._onGameNavigate=function(){this.Vk.onGameNavigate()};b.prototype._onGameMove=function(){this.Vk.onGameMove()};b.prototype._onGameCurPosChanged=function(){this.Vk.updateGamePos();this._updateAnnoField()};b.prototype._onGameChanged=function(b){this.Vk.updateGamePos(b);this._updateAnnoField()};b.prototype._onHeaderChanged=
        function(b){this.Vk.updateHeader()};b.prototype._onResetGame=function(){this.Vk.onResetGame();this.boardWin&&(this.boardWin.nextCurPosNoAnim=!0)};b.prototype._onClickInNotation=function(){this.Vk.onClickInNotation()};b.prototype._editAnno=function(b){this.viewLink&&(this.isPostAnnoEdit==b?this.viewLink.toggleAnnoField():this.viewLink.openAnnoField(),this.isPostAnnoEdit=b,this.viewLink.isAnnoFieldOpen()&&(this.game.getAnno(this.isPostAnnoEdit?CB.AnnoType.POSTTEXT:CB.AnnoType.PRETEXT),this._updateAnnoField()))};
    b.prototype.changeEngineLines=function(b){this.Vk.changeEngineLines(b)};b.prototype.onAnnoEnter=function(b,e){null!=b&&(this.Vk.onTextAnno(b,this.isPostAnnoEdit)&&(b.length?this.game.setAnno(this.isPostAnnoEdit?CB.AnnoType.POSTTEXT:CB.AnnoType.PRETEXT,new CB.TextAnno(b)):this.game.deleteAnno(this.isPostAnnoEdit?CB.AnnoType.POSTTEXT:CB.AnnoType.PRETEXT)),this.viewLink&&setTimeout(this.viewLink.closeAnnoField.bind(this.viewLink)))};b.prototype._updateAnnoField=function(){if(this.viewLink&&this.viewLink.isAnnoFieldOpen&&
        this.viewLink.isAnnoFieldOpen()){var b=this.game.getAnno(this.isPostAnnoEdit?CB.AnnoType.POSTTEXT:CB.AnnoType.PRETEXT);b?this.viewLink.setAnnoFieldText(b.getString()):this.viewLink.setAnnoFieldText("")}};b.prototype.addTextAnno=function(b){b&&b.length&&(this.game.getOrCreateCurrAnno().addPostText(b),this.game.fireOnChanged())};b.prototype.insertDiagram=function(){var b=this.game.getOrCreateCurrAnno();b.toggleDiagram();this.Vk.onTextAnno(b.getPostText()||"",!0)&&this.game.fireOnChanged()};b.prototype.deleteAnno=
        function(b){this.game.deleteAnno(b)};b.prototype.addSymbol=function(b){this.game.getOrCreateCurrAnno().addSymbol(b);this.game.fireOnAnnoChanged()};b.prototype.removeSymbol=function(b){this.game.getOrCreateCurrAnno().addSymbol(b);this.game.fireOnAnnoChanged()};b.prototype.hasTimeAnnos=function(){for(var b=0;b<this.game.getMoves().length-1;b++){var e=this.game.getMoves()[b].getAnno();if(void 0===e||null===e||void 0===e.getItem(CB.AnnoType.TIME))return!1}return 2<this.game.getMoves().length};b.prototype.addTimeAnno=
        function(b){b&&this.game.getOrCreateCurrAnno().setItem(CB.AnnoType.TIME,b)};b.prototype.addDiagram=function(){this.addTextAnno(CB.Annotation.DIAG_CHAR)};b.prototype.hasTraining=function(){for(var b=0;b<this.game.getMoves().length-1;b++){var e=this.game.getMoves()[b].getAnno();if(e&&e.getItem(CB.AnnoType.TRAINING))return!0}return!1};b.prototype.gotoFirstTrainingPosition=function(){for(var b=0;b<this.game.getMoves().length-1;b++){var e=this.game.getMoves()[b].getAnno();if(e){e.getItem(CB.AnnoType.TRAINING)&&
    this.game.gotoIndex(b+1);break}if(this.game.getMoves()[b].hasLines())break}};b.prototype.getMoveNo=function(){return this.game.getMoveNo()};b.prototype.execEngineMove=function(b){this.game.makeMove(b);this.markLastMove(!1);this.checkIfTechnicalGameEnd()};b.prototype.setIdGame=function(b){this.idGame=b;this.boardWin&&(this.boardWin.idGame=b)};b.prototype.getCurPos=function(){return this.game.getCurPos()};b.prototype.executeGameAction=function(b,e){var c=new CB.DataBuffer,d=!0;"TEXT"==b&&(d=!1);c.constructFromString(e,
        d);c.rewind();b=new CB.GameAction;b.fromDataBuf(c);b.isSetBoardOrientation()&&this.boardWin&&this.boardWin.setBlackIsBottom(1==b.nVal,!0);b.fillExecutedMove();c=this.game.getHeader().getWhite();b._doExecute(this.game);b=this.game.getHeader().getWhite();this.game.updateFromExtern();0!=c.localeCompare(b)&&this.game.updateHeaderFromExtern()};b.prototype.copyGameToClipboard=function(){this.toClipboard(this.game.toString())};b.prototype.toClipboard=function(b){if(window.clipboardData&&clipboardData.setData){if(this.boardWin){this.boardWin.addMessage("You may now paste this game as text everywhere.",
        !0);var c=this.boardWin;(new CB.Timer).runOnce(3E3,function(){c.destroyMessage()})}clipboardData.setData("Text",b)}};b.prototype.pasteGameFromClipboard=function(){if(window.clipboardData&&clipboardData.getData){var b=clipboardData.getData("Text");this.setPGN(b)}0<V15.Vf.userName.length&&(new CB.ActivityManager(V15.Vf.userName,V15.Vf.password)).getActivity(CB.ACTIVITYTYPE.ACTIVITY_CLIPBOARD_GAME,this.pastGameHandler.bind(this))};b.prototype.pastGameHandler=function(b,e){0!=b&&(this.setPGN(e),this.game.updateFromExtern())};
    b.prototype.startLine=function(){this.game.gotoPrev();this.nextMoveEnterType=CB.MoveEnterType.NEWLINE};return b}();"use strict";
CB.GameActionEnum={NOACTION:0,NEWGAME:1,SETGAME:2,GOTOMOVEINDEX:3,SETMOVE:4,MOVEDATA:5,SETANNOTATION:6,DELETELINE:7,PROMOTELINE:8,DELETEPREVIOUS:9,DELETEREMAINING:10,UNANNOTATE:11,ADDANNOTEXT:12,WEBORIGIN:13,SYNC:14,SETGAME2:15,SETGAMEMOVES:16,SETGAMEHEADER:17,SETBOARDORIENTATION:18,toString:function(d){for(var b in this)if(this[b]==d)return"GameAction: "+b;return"Unknown GameAction: "+d}};
CB.GameAction=function(){var d=function(){this.type=CB.GameActionEnum.NOACTION;this.nVal=0};d.prototype.fromDataBuf=function(b){this.type=b.V10();this.nVal=b.V10();switch(this.type){case CB.GameActionEnum.SETMOVE:this.moveRecord=new CB.MoveRecord;this.moveRecord.fromDataBuf(b);break;case CB.GameActionEnum.MOVEDATA:this.moveData=new CB.MoveData;this.moveData.fromDataBuf(b);break;case CB.GameActionEnum.SETGAME:this.setGame=new CB.Game;this.setGame.fromDataBuf(b);break;case CB.GameActionEnum.SETANNOTATION:case CB.GameActionEnum.ADDANNOTEXT:this.anno=
    new CB.Annotation;this.anno.fromDataBuf(b);break;case CB.GameActionEnum.SETGAME2:this.setGame=new CB.Game;this.setGame.read3(b);break;case CB.GameActionEnum.SETGAMEMOVES:this.moves=new CB.Moves;this.moves.fromDataBuf2(rBuf,rBuf.ReadInt());break;case CB.GameActionEnum.SETGAMEHEADER:this.header=new CB.Header,this.header.ReadFromDataBuffer(rBuf,0)}};d.prototype.Vz=function(b){b.Vx(this.type);b.Vx(this.nVal);switch(this.type){case CB.GameActionEnum.SETMOVE:this.moveRecord.Vz(b);break;case CB.GameActionEnum.MOVEDATA:this.moveData.Vz(b);
    break;case CB.GameActionEnum.SETGAME:this.setGame.Vz(b);break;case CB.GameActionEnum.SETANNOTATION:case CB.GameActionEnum.ADDANNOTEXT:this.anno.Vz(b)}};d.prototype.setMoveData=function(b){this.type=CB.GameActionEnum.MOVEDATA;this.moveData=b};d.prototype.addText=function(b){this.anno=new CB.Annotation;this.anno.addPostText(b);this.type=CB.GameActionEnum.ADDANNOTEXT};d.prototype.isMove=function(){return this.type==CB.GameActionEnum.MOVEDATA||this.type==CB.GameActionEnum.SETMOVE};d.prototype.isMoveData=
    function(){return this.type==CB.GameActionEnum.MOVEDATA};d.prototype.isGame=function(){return this.type==CB.GameActionEnum.SETGAME};d.prototype.isSetBoardOrientation=function(){return this.type==CB.GameActionEnum.SETBOARDORIENTATION};d.prototype.isAnno=function(){return this.type==CB.GameActionEnum.ADDANNOTEXT||this.type==CB.GameActionEnum.SETANNOTATION};d.prototype.getTimeCentiSecs=function(){if(this.moveData)return this.moveData.centiSecs};d.prototype.fillExecutedMove=function(){if(this.type==CB.GameActionEnum.SETMOVE)return new CB.Move(this.moveRecord.from,
    this.moveRecord.to,this.moveRecord.prom);if(this.type==CB.GameActionEnum.MOVEDATA)return new CB.Move(this.moveData.move[0],this.moveData.move[1],this.moveData.move[2],this.moveData.type)};d.prototype.execute=function(b,c){var e=!0;c&&this.shouldCheckControlMoveBefore()&&(e=this.isControlMoveOk(b,c));e&&(e=this._doExecute(b));e&&c&&this.shouldCheckControlMoveAfter()&&(e=this.isControlMoveOk(b,c));return e};d.prototype.toString=function(){var b=CB.GameActionEnum.toString(this.type);switch(this.type){default:return b;
    case CB.GameActionEnum.MOVEDATA:return"MoveData="+this.moveData;case CB.GameActionEnum.SETANNOTATION:return"SetAnno="+this.anno;case CB.GameActionEnum.ADDANNOTEXT:return"AddAnno="+this.anno;case CB.GameActionEnum.SETMOVE:return"SetMove="+this.nVal}};d.prototype._doExecute=function(b){var c=!0;switch(this.type){case CB.GameActionEnum.NEWGAME:b.reset();break;case CB.GameActionEnum.GOTOMOVEINDEX:b.gotoIndex(this.nVal);(c=this.nVal===b.getMoveIndex())||CB.LOG("GotoMoveIndex not ok");break;case CB.GameActionEnum.SETMOVE:var e=
    new CB.Move(this.moveRecord.from,this.moveRecord.to,this.moveRecord.prom);this.isValidMove(e,b.getCurPos())?(c=this.nVal,c===CB.MoveEnterType.QUERY&&b.getPlyNum()<b.getMoves().length&&(c=CB.MoveEnterType.OVERWRITE_MAIN),c=b.makeMove(e,c)):c=!1;break;case CB.GameActionEnum.MOVEDATA:c=this.executeMoveData(this.moveData,b);break;case CB.GameActionEnum.SETGAME2:case CB.GameActionEnum.SETGAME:b.assign(this.setGame);c=!0;break;case CB.GameActionEnum.SETANNOTATION:this.nVal||0==b.getMoveOffs()?b.getMoves().setAnno(this.anno):
    (e=b.getPreviousMove())&&e.setAnno(this.anno);b.fireOnChanged();break;case CB.GameActionEnum.DELETELINE:b.deleteLine();break;case CB.GameActionEnum.PROMOTELINE:b.promoteLine();break;case CB.GameActionEnum.DELETEPREVIOUS:b.deletePrevious();break;case CB.GameActionEnum.DELETEREMAINING:b.deleteRemaining();break;case CB.GameActionEnum.UNANNOTATE:b.unAnnotate();break;case CB.GameActionEnum.ADDANNOTEXT:(e=this.nVal||0==b.getMoveOffs()?b.getMoves().getAnno():b.getPreviousMove().getAnno())||(e=new CB.Annotation);
    this.anno.hasPreText()?e.addPreText(this.anno.getPreText()):this.anno.hasPostText()&&e.addPostText(this.anno.getPostText());this.nVal||0==b.getMoveOffs()?b.getMoves().setAnno(e):b.getPreviousMove().setAnno(e);b.fireOnChanged();break;case CB.GameActionEnum.SYNC:b.onSync(this.nVal);break;case CB.GameActionEnum.SETGAMEMOVES:b.setMoves(this.moves);break;case CB.GameActionEnum.SETGAMEHEADER:b.setHeader(this.header),b.fireOnChanged()}return c};d.prototype.shouldCheckControlMoveBefore=function(){return this.type==
    CB.GameActionEnum.SETMOVE||this.type==CB.GameActionEnum.MOVEDATA||this.type==CB.GameActionEnum.SETANNOTATION||this.type==CB.GameActionEnum.ADDANNOTEXT||this.type==CB.GameActionEnum.PROMOTELINE||this.type==CB.GameActionEnum.DELETEREMAINING};d.prototype.shouldCheckControlMoveAfter=function(){return this.type==CB.GameActionEnum.GOTOMOVEINDEX||this.type==CB.GameActionEnum.DELETEPREVIOUS||this.type==CB.GameActionEnum.DELETELINE};d.prototype.isControlMoveOk=function(b,c){return 0==b.getMoveOffs()||b.getPreviousMove()&&
    b.getPreviousMove().equals(c)};d.prototype.changesMoves=function(){return this.type==CB.GameActionEnum.SETMOVE||this.type==CB.GameActionEnum.MOVEDATA||this.type==CB.GameActionEnum.NEWGAME||this.type==CB.GameActionEnum.DELETELINE||this.type==CB.GameActionEnum.PROMOTELINE||this.type==CB.GameActionEnum.DELETEPREVIOUS||this.type==CB.GameActionEnum.DELETEREMAINING};d.prototype.executeMoveData=function(b,c){var e=!1;try{var d=new CB.Move(b.move[0],b.move[1],b.move[2]);this.isValidMove(d,c.getCurPos())&&
(c.enableEvents(!1),c.makeMove(d,CB.MoveEnterType.OVERWRITE_MAIN),c.getOrCreateCurrAnno().setItem(CB.AnnoType.TIME,new CB.TimeAnno(CB.TimeTools.getCBTimeOfCentiSecs(b.centiSecs))),c.enableEvents(!0),c.fireOnMove(),c.fireOnCurPosChanged(),e=!0)}catch(g){CB.LogException("GA::ExecMoveData",g)}return e};d.prototype.isValidMove=function(b,c){return c.isLegalMove(b)};return d}();"use strict";
CB.ScriptCommand=function(){var d=function(){this.time=0;this.action=this.type=""};d.prototype.fromString=function(b,c){for(var e="",d=0,g=0,h=0,k=0,l=0;l<b.length;l++)":"==b[l]?(0==d?g=parseInt(e,10):1==d?h=parseInt(e,10):2==d&&(k=parseInt(e,10)),e="",d++):e+=b[l];this.time=k+60*h+3600*g;l=c.search(":");-1!=l&&(this.type=c.substring(0,l),this.action=c.substring(l+1))};return d}();"use strict";
CB.DrawType={NOT_DECIDED:0,MATE:1,STALEMATE:2,MATERIAL:3,THREE_TIMES:4,FIFTY_MOVES:5,MOVES_290:6,DRAW:7,WHITE_WINS:8,BLACK_WINS:9,TWO_TIMES:10};
CB.DrawChecker=function(){var d=function(){};d.prototype.checkGame=function(b){var c=this.checkPos(b.getCurPos());if(c!=CB.DrawType.NOT_DECIDED)return c;if(5<=b.getPlyNum()){c=b.getCurPos().getCastleRights();for(var e=b.getMoves().length,d=Math.max(0,e-5),g=e-1;g>=d;g--){var h=b.getMoves()[g];if(h){if(!h.undo&&h.isValid()&&g<b.getPlyNum()-1){for(d=h=0;d<g;d++)b.getMoves()[d].undo&&h++;break}if(h.isTake()||h.isProm()||h.isPawn())return CB.DrawType.NOT_DECIDED}else return CB.DrawType.NOT_DECIDED}d=
    b.getCurPos().getEPCol();var k=b.getPlyNum()-100,l=1,m=ObjUtil.clone(b.getCurPos());for(g=e;0<g;--g){h=b.getMoves()[--g];if(!h||!h.undo)break;if(h.isTake()||h.isProm()||h.isPawn())break;if(b.getCurPos().getEPCol()!=d)break;if(g<=k)return CB.DrawType.FIFTY_MOVES;m.unmakeMove(h,h.undo);if(l&&c!=m.getCastleRights()&&(l=0,0>=k))break;if(0<g){h=b.getMoves()[--g];if(h.isTake()||h.isProm()||h.isPawn())break;if(b.getCurPos().getEPCol()!=d)break;if(g<=k)return CB.DrawType.FIFTY_MOVES;if(!h.undo)break;m.unmakeMove(h,
    h.undo);if(l){if(c!=m.getCastleRights()&&(l=0,0>=k))break;if(d==m.getEPCol()&&m.boardEquals(b.getCurPos().board)&&(l++,3<=l))return CB.DrawType.THREE_TIMES}}}}return CB.DrawType.NOT_DECIDED};d.prototype.checkPos=function(b){if(!b.hasLegals())return b.isCheck()?CB.DrawType.MATE:CB.DrawType.STALEMATE;for(var c=[0,0,0,0,0,0,0,0],e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=0,g=0,h=0;64>h;h++)c[b.board[h]&7]++,e[b.board[h]&15]++,(b.board[h]&7)==CB.Piece.BISHOP&&(b.board[h]&8?g=(h&1)==(h>>3&1)?g|1:g|2:d=(h&1)==
(h>>3&1)?d|1:d|2);return c[CB.Piece.QUEEN]||c[CB.Piece.ROOK]||c[CB.Piece.PAWN]||!(!c[CB.Piece.BISHOP]&&1>=c[CB.Piece.KNIGHT]||!c[CB.Piece.KNIGHT]&&(1>=c[CB.Piece.BISHOP]||3>d&&3>g&&(!d||!g||d==g)))?CB.DrawType.NOT_DECIDED:CB.DrawType.MATERIAL};d.prototype.canWin=function(b,c){var e=!1;try{var d=b.board,g=c==CB.Side.WHITE?0:CB.Side.SIDE_MASK;b=[];for(var h=0;16>h;h++)b[h]=0;for(h=0;64>h;h++)b[d[h]&15]++,d[h]&&(d[h]&CB.Side.SIDE_MASK)==g&&(d[h]&CB.Piece.PIECE_MASK)!=CB.Piece.KING&&(e=!0);if(e&!b[CB.Piece.W_PAWN]&&
    !b[CB.Piece.B_PAWN]){var k=c==CB.Side.WHITE?CB.Piece.WHITE:CB.Piece.BLACK;if(!(b[k|CB.Piece.QUEEN]||b[k|CB.Piece.ROOK]||1!=b[k|CB.Piece.BISHOP]+b[k|CB.Piece.KNIGHT]||b[CB.Piece.COLOUR-k|CB.Piece.BISHOP]||b[CB.Piece.COLOUR-k|CB.Piece.KNIGHT]))if(b[k|CB.Piece.BISHOP]){if(b[CB.Piece.COLOUR-k|CB.Piece.QUEEN]||b[CB.Piece.COLOUR-k|CB.Piece.ROOK])e=!1}else b[k|CB.Piece.KNIGHT]&&b[CB.Piece.COLOUR-k|CB.Piece.QUEEN]&&!b[CB.Piece.COLOUR-k|CB.Piece.ROOK]&&(e=!1)}}catch(l){e=!0,CB.LogException("CanWin",l)}return e};
    d.getStrDrawType=function(b){switch(b){default:case CB.DrawType.MATE:return"Mate";case CB.DrawType.STALEMATE:return"Stalemate";case CB.DrawType.MATERIAL:return"No Material";case CB.DrawType.THREE_TIMES:return"Threefold Rep";case CB.DrawType.FIFTY_MOVES:return"50 Moves Rule";case CB.DrawType.MOVES_290:return"290 Moves";case CB.DrawType.DRAW:return"Draw";case CB.DrawType.WHITE_WINS:return"WWin";case CB.DrawType.BLACK_WINS:return"BWin";case CB.DrawType.TWO_TIMES:return"Twofold Rep"}};return d}();"use strict";
CB.BaseClock=function(){var d=0,b=function(b){this.clockLink=b;this.updateTimer=new CB.Timer(this.update.bind(this));this.isBlack=!1;this.id=++d};b.prototype.onTimeOverstepped=function(b){this.clockLink.showTimeOverstepped(b)};b.prototype.setNoClock=function(){this.clockLink.setText("---",!1);this.clockLink.setText("---",!0)};b.prototype.start=function(){};b.prototype.stop=function(){};b.prototype.isRunning=function(){return!1};b.prototype.setToMove=function(b){this.isBlack=b};b.prototype.onMove=
    function(b){this.setToMove(b);this.start()};b.prototype.initFromGame=function(b){};b.prototype.onTimeOverstepped=function(b){this.clockLink.showTimeOverstepped(b)};b.prototype.update=function(){};return b}();"use strict";CB.namespace("CB.CMSIManager");
CB.CMSIManager=function(){var d=function(b,c){this.kernel=b;this.cmsFiles=[]};d.prototype.addFile=function(b){this.cmsFiles.push(b)};d.prototype.GetIntelligentFileName=function(b,c,e,d,g){b=(new Position(b)).toFen();return extractFileNameFromFen(b)+"x"+String(c)+"y"+String(e)+"v"+d+"u"+g};d.prototype.extractFileNameFromFen=function(b){for(var c=0;c<b.length;c++)"/"==b[c]&&(b="z");return b};d.prototype.extractFenFromFileName=function(b){b=b.replace(/z/g,"/");var c=b.search("x");return-1!=c&&8<b.substr(0,
    c).length?b.substr(0,c):""};d.prototype.extractMoveFromFileName=function(b){var c=b.search("x"),e=b.search("y"),d=b.search("v"),g=b.search("K"),h=b.search("k"),k=0,l=0;-1!=c&&-1!=e&&-1!=d&&d>e&&e>c&&-1!=g&&-1!=h&&(k=b.substr(c+1,e-c-1),b=b.substr(e+1,d-e-1),k=parseInt(k),l=parseInt(b));return new CB.Move(k,l,0,0)};d.prototype.extractStateFromFileName=function(b){var c=0,e=b.search("v"),d=b.search("u"),g=b.search("K"),h=b.search("k");-1!=e&&-1!=d&&-1!=g&&-1!=h&&d>e&&4>d-e&&(b=b.substr(e+1,d-e-1),c=
    parseInt(b));return c};d.prototype.extractPointsFromFileName=function(b){var c=0,e=b.search("u");-1!=e&&(b=b.substr(e+1),c=parseInt(b));return c};d.prototype.getPositionFromFileName=function(b){b=this.extractFenFromFileName(b);return b.length?new CB.Position(b):null};d.prototype.belongsToPosition=function(b,c){if(c=this.getPositionFromFileName(c)){c=c.toFEN();b=b.toFEN();for(var e=0,d=0;d<b.length&&!(c.length<d)&&c[d]==b[d];d++)if(" "==b[d]&&(e++,3==e))return!0}return!1};d.prototype.getNextFileName=
    function(b){var c=b.substr(b.length-3,3);c++;for(var e=0;e<this.cmsFiles.length;e++)if(c==this.cmsFiles[e].substr(this.cmsFiles[e].length-3,3))return this.cmsFiles[e];return b};d.prototype.getPreviousFileName=function(b){var c=b.substr(b.length-3,3);c--;0>c&&(c=0);for(var e=0;e<this.cmsFiles.length;e++)if(c==this.cmsFiles[e].substr(this.cmsFiles[e].length-3,3))return this.cmsFiles[e];return b};d.prototype.getFile=function(b){for(var c=0;c<this.cmsFiles.length;c++)if(-1!=this.cmsFiles[c].indexOf(b))return this.cmsFiles[c];
    return""};d.prototype.getNextQuestion=function(b){for(var c="",e=0,d=0;d<this.cmsFiles.length;d++)if(-1!=b.indexOf(this.cmsFiles[d])){e=d;break}for(d=e+1;d<this.cmsFiles.length;d++)if(1>=this.extractStateFromFileName(this.cmsFiles[d])){c=this.cmsFiles[d];break}return c};d.prototype.collectFiles=function(b){for(var c=[],e=0;e<this.cmsFiles.length;e++)this.belongsToPosition(b,this.cmsFiles[e])&&c.push(this.cmsFiles[e]);return c};d.prototype.getFilesForNotation=function(b){for(var c=0,e=0;e<this.cmsFiles.length;e++)if(-1!=
    this.cmsFiles[e].indexOf(b)){c=e+1;break}b=this.cmsFiles.length;for(e=c+1;e<this.cmsFiles.length;e++){var d=this.extractStateFromFileName(this.cmsFiles[e]);if(2!=d&&3!=d){b=e;break}}for(e=[];c<b;c++)d=this.extractMoveFromFileName(this.cmsFiles[c]),d.from!=d.to&&(d.fen=this.getPositionFromFileName(this.cmsFiles[c]).toFEN(),e.push(d));return e};return d}();"use strict";
CB.ClockParams=function(){var d=function(b,c){this.startMins=void 0!==b?b:0;this.incSecs=c||0;1>this.startMins&&0==this.incSecs&&(this.startMins=1);this.flags=this.addSecs=this.addMins=0};d.POOL_BLITZ=1;d.prototype.fromDataBuf=function(b){this.startMins=b.V10()&65535;this.incSecs=b.V10()&65535;this.addMins=b.V11();this.addSecs=b.V11();this.flags=b.V10()};d.prototype.Vz=function(b){b.Vx(this.startMins&65535);b.Vx(this.incSecs&65535);b.Vv(this.addMins);b.Vv(this.addSecs);b.Vx(this.flags)};d.prototype.toString=
    function(){return this.startMins+"m + "+this.incSecs+"s"};d.prototype.canBePoolBlitz=function(){return 0==this.addMins&&0==this.addSecs&&0==this.incSecs&&(1==this.startMins||3==this.startMins||5==this.startMins)};d.createFromSeekParams=function(b){var c=new CB.ClockParams(3,0);b&&(b=b.split(","),b.length&&(c.startMins=b[0],0==c.startMins&&(c.startMins=5),1<b.length&&(c.incSecs=b[1])));return c};d.prototype.getSortVal=function(){return 40*this.startMins+this.incSecs};d.prototype.calcRatingType=function(){return 900<
this.getAvGameTimeSeconds()?CB.Server.EloRating.SLOW:180<=this.getAvGameTimeSeconds()?CB.Server.EloRating.BLITZ:CB.Server.EloRating.BULLET};d.prototype.getGameTypeName=function(){switch(this.calcRatingType()){case CB.Server.EloRating.BULLET:return"Bullet";case CB.Server.EloRating.BLITZ:return"Blitz";case CB.Server.EloRating.SLOW:return"Slow"}};d.prototype.getAvGameTimeSeconds=function(){return 60*this.startMins+40*this.incSecs};d.prototype.isBlitz=function(){return this.calcRatingType()==CB.Server.EloRating.BLITZ};
    d.prototype.isBullet=function(){return this.calcRatingType()==CB.Server.EloRating.BULLET};d.prototype.isSlow=function(){return this.calcRatingType()==CB.Server.EloRating.SLOW};d.prototype.getStartSecs=function(){return 60*this.startMins};return d}();"use strict";CB.TimeTrouble={SLIGHTLY_BEHIND:-1,BEHIND:-2,CLEARLY_BEHIND:-3,LOSING_ON_TIME:-4,ABOUT_EVEN:0,SLIGHTLY_AHEAD:1,AHEAD:2,CLEARLY_AHEAD:3};
CB.ChessClock=function(){var d=1,b=function(b,e,f){CB.ChessClock.superClass.call(this,b);this.fnTimeout=e;this.fnWarnClock=f;this.result=CB.GameResultEnum.GAME_UNFINISHED;this.runsForward=!1;this.centiSecsBlack=this.centiSecsWhite=0;this.uniqueId=d++;this._isRunning=!1;this.mySide=null;this.warned=[]};CB.inherit(b,CB.BaseClock);b.prototype.getWTimeMilli=function(){return 10*this.centiSecsWhite};b.prototype.getBTimeMilli=function(){return 10*this.centiSecsBlack};b.prototype.destroy=function(){};b.prototype.reinit=
    function(){this.setClockParams(this.clockParams)};b.prototype.setClockParams=function(b){this.warned=[!1,!1];this.result=CB.GameResultEnum.GAME_UNFINISHED;b?(this.clockParams=b,this.centiSecsWhite=6E3*this.clockParams.startMins,this.centiSecsBlack=6E3*this.clockParams.startMins,0==this.clockParams.startMins&&(this.centiSecsBlack=this.centiSecsWhite=1E3),this.clockLink.showRestTime(new Date(10*this.centiSecsWhite),!1),this.clockLink.showRestTime(new Date(10*this.centiSecsBlack),!0),this.clockLink.setDisplayHours(3E3<
    this.clockParams.getAvGameTimeSeconds())):(this.setNoClock(),delete this.clockParams);delete this.startTime;delete this.expiredAtStop};b.prototype.setRunsForward=function(b){this.runsForward=b;this.clockLink.setRunsForward(b)};b.prototype.initFromGame=function(b){this.stop();if(this.clockParams){for(var c=6E3*this.clockParams.startMins,d=6E3*this.clockParams.startMins,g=this.runsForward?-1:1,h=0;h<b.getPlyNum();h++)if(h<b.getMoves().length){var k=b.getMoves()[h].getAnno();k&&(k=k.getItem(CB.AnnoType.TIME))&&
(h&1?(d-=g*k.getTimeIn100th(),d+=g*this.clockParams.incSecs*100):(c-=g*k.getTimeIn100th(),c+=g*this.clockParams.incSecs*100))}this.centiSecsWhite=c;this.centiSecsBlack=d;this.takeStartTime();this.isBlack=0!=(b.getMoves().length&1);this.clockLink.setToMove(this.isBlack);this.showTimes(c,d);b.isOnLastMove()&&(b.hdr.getCBResult().isFinished()?this.clockLink.showResult(b.hdr.getResult()):this.start())}};b.prototype.onResult=function(b){this.isFinished()||(this.result=b,this.stop(),this.clockLink.showResult(b),
    CB.LOG("Clock On result: "+this.result,"LogBold"))};b.prototype.unfinish=function(){this.result=CB.GameResultEnum.GAME_UNFINISHED};b.prototype.isFinished=function(){return this.result>=CB.GameResultEnum.BLACK_WINS&&this.result<=CB.GameResultEnum.LINE};b.prototype.setToMove=function(b){CB.LOG("Clock, setToMove, black= "+b);this.clockParams&&!this.isFinished()&&((this.isBlack=b)?this.centiSecsBlack+=100*this.clockParams.incSecs:this.centiSecsWhite+=100*this.clockParams.incSecs,this.takeStartTime(),
    this.clockLink.setToMove(b))};b.prototype.isRunning=function(){return this._isRunning};b.prototype.start=function(){this._isRunning||!this.clockParams||this.isFinished()||(this._isRunning=!0,this.takeStartTime(),this.showTimes(this.centiSecsWhite,this.centiSecsBlack),this.updateTimer.runOnce(1E3),delete this.expiredAtStop)};b.prototype.stop=function(){if(this._isRunning&&(this.updateTimer.stop(),this.startTime)){this._isRunning=!1;var b=(CB.getTick()-this.startTime+5)/10;this.expiredAtStop=b;this.isFinished()||
this.setExpired(b,this.isBlack)}};b.prototype.takeStartTime=function(){this.startTime=CB.getTick();this.restTimeAtStart=this.isBlack?this.centiSecsBlack:this.centiSecsWhite};b.prototype.getRestCentiSecs=function(b){return b?this.centiSecsBlack:this.centiSecsWhite};b.prototype.showTimes=function(b,e){0<=b?this.clockLink.showRestTime(new Date(10*b),!1):this.clockLink.showRestTime(-1,!1);0<=e?this.clockLink.showRestTime(new Date(10*e),!0):this.clockLink.showRestTime(-1,!0)};b.prototype.setExpired=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            e){if(this.clockParams)return this.clockLink.showCurrTime(new Date(10*b),e),this.clockLink.showCurrTime(new Date(10*b),e),b=this.runsForward?e?this.centiSecsBlack=this.restTimeAtStart+b:this.centiSecsWhite=this.restTimeAtStart+b:e?this.centiSecsBlack=this.restTimeAtStart-b:this.centiSecsWhite=this.restTimeAtStart-b,0>b?this.clockLink.showRestTime(-1,e):this.clockLink.showRestTime(new Date(10*b),e,this.getTimeTroubleIndex()),b};b.prototype.changeCurrMoveElapsedTime=function(b){if(this.clockParams&&
    !this.isFinished()){var c=(CB.getTick()-this.startTime+5)/10;this.startTime=CB.getTick()-10*b;this.restTimeAtStart-=b-c;this.updateTimer.stop();this.expiredAtStop=b;this.setExpired(b,this.isBlack);this.update()}};b.prototype.reset=function(){this.setClockParams(new CB.ClockParams(0,0))};b.prototype.getExpired=function(){return this.expiredAtStop?this.expiredAtStop:this.startTime?(CB.getTick()-this.startTime+5)/10:0};b.prototype.getStrRestTimes=function(){var c=b.getTimeString(new Date(10*this.centiSecsWhite)),
    e=b.getTimeString(new Date(10*this.centiSecsBlack)),d="";0<=this.centiSecsWhite&&(d=String.f("{0}={1}",lm.WHITE,c));c="";0<=this.centiSecsBlack&&(c=String.f("{0}={1}",lm.BLACK,e));(e=d)&&c&&(e+=", ");return e+c};b.prototype.createTimeAnno=function(){return new CB.TimeAnno(CB.TimeTools.getCBTimeOfCentiSecs(this.getExpired()))};b.prototype.setText=function(b,e){this.clockLink.setText(b,e)};b.prototype.update=function(){var b=(CB.getTick()-this.startTime+5)/10,e=this.setExpired(b,this.isBlack);if(0<
    e){this.clockLink.setDisplayCentiSecs(1E3>e);var d=1E3;1E3>e&&(d=100);this.updateTimer.runOnce(d);15<b/100&&b>e/3&&this.fnWarnClock&&!this.warned[this.isBlack?1:0]&&(this.fnWarnClock(this.isBlack),this.warned[this.isBlack?1:0]=!0)}else CB.LOG("Clock Timeout: "+this.uniqueId,"LogBold"),this.fnTimeout&&!this.isFinished()&&(this.clockLink.setText("TIME",this.isBlack),this.fnTimeout())};b.prototype.getTimeTroubleIndex=function(){if(null!=this.mySide){if(this.isBlack){var b=this.centiSecsBlack;var e=this.centiSecsWhite}else b=
    this.centiSecsWhite,e=this.centiSecsBlack;return Math.abs(b-e)<.1*Math.abs(b)&&2E3<b?CB.TimeTrouble.ABOUT_EVEN:b>e?b>1.2*e?b>2*e?CB.TimeTrouble.CLEARLY_AHEAD:CB.TimeTrouble.AHEAD:CB.TimeTrouble.SLIGHTLY_AHEAD:b<.7*e?b<.5*e?b<.3*e&&1E3>b?CB.TimeTrouble.LOSING_ON_TIME:CB.TimeTrouble.CLEARLY_BEHIND:CB.TimeTrouble.BEHIND:CB.TimeTrouble.SLIGHTLY_BEHIND}return 0};b.getTimeString=function(b,e,d){0>b&&(b=new Date(0));var c="";e&&(c=b.getUTCHours()+":");1E4>b.valueOf()&&!d?(e=b.getUTCSeconds(),b=Math.floor(b.getUTCMilliseconds()/
    100),c=e+"."+b+"s"):(e=b.getUTCMinutes(),1==e.toString().length&&0<e&&(e="0"+e),c+=e,e=Math.floor(b.getUTCSeconds()),1==e.toString().length&&(e="0"+e),c+=":"+e);return c};return b}();"use strict";CB=CB||{};
CB.AbstractPlayingMode=function(){var d=function(){};d.prototype.destroy=function(){};d.prototype.deleteClock=function(){};d.prototype.onTimeOverstepped=function(b){};d.prototype.onAnnotate=function(){this.saved=!1;return!0};d.prototype.onTextAnno=function(b,c){this.saved=!1;return!0};d.prototype.onInsertDiagram=function(){this.saved=!1;return!0};d.onEval=function(b){this.saved=!1;return!0};d.prototype.onPromoteLine=function(){this.saved=!1;return!0};d.prototype.onDeletePrevious=function(){this.saved=
    !1;return!0};d.prototype.onCutLine=function(){this.saved=!1;return!0};d.prototype.onDeleteLine=function(){this.saved=!1;return!0};d.prototype.onBeforeUnload=function(){};d.prototype.getMoveEnterType=function(){return CB.MoveEnterType.OVERWRITE_MAIN};d.prototype.mayNavigate=function(){return!0};d.prototype.mayGotoNext=function(){return!0};d.prototype.mayGotoEnd=function(){return!0};d.prototype.mayPageDown=function(){return!0};d.prototype.mayLoadGames=function(){return!0};d.prototype.onKeyDown=function(b){return!1};
    d.prototype.isAnalysis=function(){return!1};d.prototype.setAnalysis=function(b){};d.prototype.engineMoveNow=function(){return!1};d.prototype.onResetGame=function(){};d.prototype.beforeGameLoad=function(){this.saveAndReset();this.saved=!1};d.prototype.afterGameLoad=function(){};d.prototype.updateHeader=function(){};d.prototype.saveAndReset=function(){this.saveToCloud(!0);this.cntUpdates=0};d.prototype.onExit=function(){this.saveToCloud()};d.prototype.onEntry=function(){};d.prototype.shouldAnimatePosChange=
        function(){6;return CB.System.runsOnChessBaseDomain()||!CB.System.isNonCrossDomainIE()};d.prototype.saveToCloud=function(b){return V15.cloudMgr&&V15.cloudMgr.isConnected()&&!this.saved&&this.shouldSave(b)&&(6<this.kernel.game.getMoves().length||!this.kernel.game.isNormalInit())?(V15.cloudMgr.saveGameToClipboard(this.kernel.game),this.saved=!0):!1};d.prototype.shouldSave=function(){return!0};d.prototype.updateGamePos=function(){};d.prototype.onGameMove=function(){};d.prototype.onGameNavigate=function(){};
    d.prototype.onClickInNotation=function(){};d.prototype.toggleAnalysis=function(){};d.prototype.onPosInput=function(b){};d.prototype.onEnteredMove=function(b){return!0};d.prototype.onAfterMoveEntry=function(b){};d.prototype.onResult=function(b){};d.prototype.updateClockFromGame=function(){};d.prototype.startClock=function(){};d.prototype.stopClock=function(){};d.prototype.getAllowedColor=function(){return CB.AllowedColor.BOTH_COLORS};d.prototype.setLegals=function(b){};d.prototype.getMySide=function(){return null};
    d.prototype.setMySide=function(b){};d.prototype.userClosesBoard=function(){};d.prototype.setTimeControl=function(b){};d.prototype.setManualClock=function(){};d.prototype.setChessClock=function(){};d.prototype.resetGame=function(b){b.reset()};d.prototype.newGame=function(){};d.prototype.onPanelsReady=function(){};d.prototype.createGUIElements=function(b){};d.prototype.destroyGUIElements=function(b){};d.prototype.saveState=function(b){};d.prototype.loadState=function(b){};d.prototype.posLegalChecker=
        function(b){return b.isLegal()};d.prototype.reactToEnteredMove=function(b){return!1};d.prototype.blockLiveBookUpdate=function(b){};d.prototype.getFnLoadSearchResult=function(){return CB.CloudPlayingModeMixin?CB.CloudPlayingModeMixin.getFnLoadSearchResult():null};return d}();"use strict";CB=CB||{};
CB.PlayingMode=function(){var d=function(b){CB.PlayingMode.superClass.call(this);this.kernel=b;this.isAutoplay=!1};CB.inherit(d,CB.AbstractPlayingMode);d.prototype.loadGame=function(b){this.beforeGameLoad();this.kernel.game.assign(b);this.afterGameLoad()};d.prototype.destroy=function(){this.deleteClock()};d.prototype.deleteClock=function(){this.clock=null;this.manualClock&&(this.manualClock.stop(),delete this.manualClock);this.chessClock&&(this.chessClock.stop(),delete this.chessClock)};d.prototype.onTimeOverstepped=
    function(b){if(this.clock)this.clock.onTimeOverstepped(b)};d.prototype.onEnteredMove=function(b){this.clock&&this.clock.stop();return!0};d.prototype.isAnalysis=function(){return!0};d.prototype.initAnalysisEngine=function(b){try{"undefined"!==typeof V15&&!V15.analysisEngine&&CB.System.isDesktop()&&V15.config.useAnalysisEngines&&CB.AnalysisEngine&&(V15.analysisEngine=new CB.AnalysisEngine(b))}catch(c){CB.LogException("PM:initAnalysisEngine",c)}};d.prototype.initThreatEngine=function(b){try{this.threatEngine=
    new CB.EngineWrapper(0,"/Common/Chess/Engine/Enginemin.js",null,this),CB.System.isElectron()||this.threatEngine.load()}catch(c){CB.LogException("PM:initThreatEngine",c)}};d.prototype.onEnginePV=function(b,c){};d.prototype.onEngineMove=function(b,c){};d.prototype.getMoveEnterType=function(){return this.kernel.game.isLineEnd()?CB.MoveEnterType.NEWLINE:V15.allowMoveEntryDialog()?CB.MoveEnterType.QUERY:this.isAnalysis()?CB.MoveEnterType.NEWLINE:CB.MoveEnterType.OVERWRITE_MAIN};d.prototype.onResult=function(b){if(this.clock)this.clock.onResult(b)};
    d.prototype.updateClockFromGame=function(){this.clock&&this.clock.initFromGame(this.kernel.game)};d.prototype.startClock=function(){this.clock&&this.clock.start()};d.prototype.stopClock=function(){this.clock&&this.clock.stop()};d.prototype.getAllowedColor=function(){return CB.AllowedColor.BOTH_COLORS};d.prototype.onGameNavigate=function(){this.updateClockFromGame()};d.prototype.setManualClock=function(b,c,e){delete this.chessClock;this.kernel.boardWin&&this.kernel.boardWin.getClockDisplay()&&(this.clock&&
    this.clock.stop(),this.manualClock=new CB.ManualClock(this.kernel.boardWin.getClockDisplay()),this.manualClock.setTime(b,c,e),this.manualClock.onResult(this.kernel.game.hdr.getResult()),this.clock=this.manualClock)};d.prototype.updateHeader=function(){if(this.manualClock)this.manualClock.onResult(this.kernel.game.hdr.getResult())};d.prototype.setChessClock=function(b){delete this.manualClock;this.kernel.boardWin&&this.kernel.boardWin.hasClock()&&(this.chessClock=new CB.ChessClock(this.kernel.boardWin.getClockDisplay()),
        this.chessClock.setClockParams(b),b&&this.chessClock.initFromGame(this.kernel.game),this.clock=this.chessClock)};d.prototype.linkBoardHints=function(b){b.fnMarkSquaresOnButtonDown=this.getMarkedSquaresOnButtonDown.bind(this)};d.prototype.unlinkBoardHints=function(){this.kernel.boardWin&&(this.kernel.boardWin.fnMarkSquaresOnButtonDown=null)};d.prototype.getMarkedSquaresOnButtonDown=function(b){return this.genLegalSquareHints(b)};d.prototype.getLegalSqClr=function(){return"hsla( 0, 0%, 50%, 0.25 )"};
    d.prototype.genLegalSquareHints=function(b){var c=[];this.kernel.game.getCurPos().V7().forEach(function(e){e.from==b&&c.push({sq:e.to,clr:this.getLegalSqClr()})}.bind(this));return c};d.prototype.setIsAutoplay=function(b){this.isAutoplay=b};return d}();CB.ResultFlags={TECHNICAL:2,MY_TIME:4,RESIGN:8,OPP_RESIGN:16};"use strict";CB=CB||{};
CB.EngineHostMode=function(){var d=function(b,c){CB.PlayingMode.call(this,b);this.szPool=c||0;this.engines=[];this.nEngines=0;this.panEng=null};CB.inherit(d,CB.PlayingMode);d.prototype.loadEngineInstance=function(b,c,e){return new CB.EngineInstance(b,this.szPool,c,e)};d.prototype.changeEngineLines=function(b){var c=this.engines[0],e=c.getMultiPV();e=Math.max(e+b,1);this.stopAll();c.setMultiPV(e);this.goAll()};d.prototype.loadEngine=function(b){this.nEngines<b+1&&(this.nEngines=b+1);if(V15.panelMgr.openEnginePanel){var c=
    this.panEng=V15.panelMgr.openEnginePanel(b);if(c&&!this.engines[b]){var e=this.engines[b]=this.loadEngineInstance(V15.config.getEngineUrl()[b],b);c.setEngine(e);c.setAnalysis&&c.setAnalysis(this.isAnalysis());this.addOnBestMove(e);e.setTag(b)}}};d.prototype.isEngineLoaded=function(b){return!!this.engines[b]};d.prototype.unloadEngine=function(b){this.engines[b]&&(this.engines[b].exit(),delete this.engines[b])};d.prototype.onBestMove=function(b,c){this.kernel.game.getCurPos().isLegalMove(c.move)&&this.kernel.execEngineMove(c.move)};
    d.prototype.addOnBestMove=function(b){this.idOnBestMove||(this.idOnBestMove=b.addOnBestMoveListener(this.onBestMove.bind(this)))};d.prototype.removeOnBestMove=function(b){b.removeOnBestMoveListener(this.idOnBestMove);this.idOnBestMove=null};d.prototype.destroy=function(){this.stopAll();this.engines.forEach(function(b){b&&b.dispose()})};d.prototype.goAll=function(){this.engines.forEach(function(b){b&&b.go(this.kernel.game)}.bind(this))};d.prototype.stopAll=function(){this.engines.forEach(function(b){b&&
    b.stop()})};d.prototype.newGame=function(){this.stopAll();this.engines.forEach(function(b){b&&b.newGame()})};d.prototype.setEngineOff=d.prototype.stopAll;d.prototype.toggleHandicap=function(){this.setHandicap(!this.isHandicap())};d.prototype.setHandicap=function(b){};d.prototype.isHandicap=function(){return!1};d.prototype.getHandicap=function(){return 0};d.prototype.saveState=function(b){};d.prototype.loadState=function(b){};return d}();"use strict";
CB.MiniPlayMode=function(){var d={engineName:"Fritz"},b=function(c,e,h,k){h=h||{};this.nPlugin=k;this.options=ObjUtil.copyTo(d,h,!0);b.superClass.call(this,c);this.kernel=c;this.engineSide=null;this.engineAnswers=!0;this.engineTimeouter=new CB.Timer;this.clickHintTimer=new CB.Timer;this.animTimer=new CB.Timer;this.engUrl="https://pgn.chessbase.com/common/chess/engine/enginemin.js";this.engine=[];this.engine[0]=new CB.EngineWrapper(0,this.engUrl,null,this);this.engine[0].load();this.parseThinkTime(e.play||
    "700");this.suppressTechnicalResult=!0;this.hintMove=this.eval=null;this.saved=!1;this.clearBoardMsgTimer=new CB.Timer(this.clearBoardMsg.bind(this));this.execEngineMoveTimer=new CB.Timer;this.dataset=e;this.parseDataSet(e);this.engineStartTick=new CB.Tick;this.hintCnt=0};CB.inherit(b,CB.PlayingMode);b.prototype.destroy=function(){this.superClass.destroy.call(this);this.unlinkButtonDownHints();this.clickHintTimer&&this.clickHintTimer.stop();V15.analysisEngine&&(V15.analysisEngine.dispose(),V15.analysisEngine.unlinkPlayingMode(this))};
    b.prototype.onEnginePV=function(b,c){c&&(this.eval=c.eval,this.engineSide===CB.Side.BLACK&&(this.eval=-this.eval),c.pv&&2<=c.pv.moves.length&&(this.hintMove=new CB.Move,this.hintMove.fromJSON(c.pv.moves[1])));this.options.idDOMEngOut&&c.pv.moves.length&&(b=new CB.Move,b.fromJSON(c.pv.moves[0]),b=(new CB.NotationGenerator).getNota(b,this.kernel),$("#"+this.options.idDOMEngOut).text(b+" / "+c.maxDepth))};b.prototype.onEngineMove=function(b,c){this.shouldShowBusyCursor()&&this.kernel.boardWin.setBusy(!1);
        b=Math.max(0,1E3-this.engineStartTick.getExpiredMS());this.execEngineMoveTimer.runOnce(b,function(){this.execEngineMove(c)}.bind(this))};b.prototype.execEngineMove=function(b){var c=new CB.Move;c.fromJSON(b.move);this.kernel.game.getCurPos().isLegalMove(c)&&(this.kernel.execEngineMove(c),V15.analysisEngine&&V15.analysisEngine.engineGo(this.kernel),this.eval=b.eval,this.engineSide===CB.Side.BLACK&&(this.eval=-this.eval),this.checkEvalGoal())};b.prototype.getMoveEnterType=function(){return CB.MoveEnterType.OVERWRITE};
    b.prototype.onEntry=function(){};b.prototype.createGUIElements=function(b){this.boardWin=b;this.superClass.createGUIElements.call(this,b);this.kernel.onTechnicalGameEnd=this.onTechnicalGameEnd.bind(this);V15.analysisEngine?V15.analysisEngine.linkPlayingMode(this):this.linkButtonDownHints();this.dataset.solved&&this.addCheckMark();this.dataset.level&&this.addLevelMark(this.dataset.level);this.hasClickGoal()&&(this.boardWin.clickHandler=this.boardSquareClickHandler.bind(this))};b.prototype.boardSquareClickHandler=
        function(b){for(var c=0;c<this.goals.length;c++){var e=this.goals[c];if(e.isClickGoal()){var d=e.checkClick(b);if(null!=this.onGoalMetResult(e,d))break}}};b.prototype.linkButtonDownHints=function(){this.clickHintTimer||(this.clickHintTimer=new CB.Timer);this.kernel.boardWin.fnMarkSquaresOnButtonDown=this.getMarkedSquaresOnButtonDown.bind(this);this.startClickHintTimer&&(this.kernel.boardWin.fnSquareClick=this.startClickHintTimer.bind(this));this.kernel.boardWin.fnSquareChangeInMouseMove=function(){this.clickHintTimer.stop()}.bind(this);
        this.kernel.boardWin.fnSquareRelease=function(){this.clickHintTimer.stop()}.bind(this)};b.prototype.unlinkButtonDownHints=function(){this.kernel.boardWin.fnSquareClick=null;this.kernel.boardWin.fnMarkSquaresOnButtonDown=null};b.prototype.destroyGUIElements=function(b){this.superClass.destroyGUIElements.call(this,b)};b.prototype.restart=function(){this.goals&&this.goals.forEach(function(b){b.isClickGoal&&b.sqsVisited&&this.removeVisitedSquareMarks(b.sqsVisited)}.bind(this));var b=this.dataset.moves;
        b?(new CB.Position,this.kernel.game.assign(CB.PGN.parseGame(b)),this.kernel.game.gotoLast()):this.kernel.game.gotoFirst();this.hintMove=this.eval=null;this.kernel.boardWin.allowInput=!0;this.kernel.boardWin.destroyMessage();this.kernel.boardWin.destroySideIcon()};b.prototype.parseDataSet=function(b){this.parseGoals(b);this.parseVisualizations(b);this.parsePieceSquareTables(b);this.id=b.posid||"noid"};CB.Goal=function(){var b=function(){this.control="stop";this.reset()};b.prototype.reset=function(){this.countMet=
        0;this.feedBackDone=!1;this.sqsVisited=[]};b.prototype.isDone=function(){var b=this.getCountNeeded();return 0<b?this.countMet>=b:0<this.countMet};b.prototype.isMet=function(b,c){switch(this.command){default:return!1;case "piece":return this.checkPiece(b);case "move":return this.checkMove(b);case "firstmove":return this.checkFirstMove(b);case "journey":return this.checkJourney(b);case "mate":return this.checkForMate(b);case "stalemate":return this.checkForStaleMate(b);case "threefold":return this.checkForThreefold(b);
        case "check":return this.checkForCheck(b);case "notcheck":return this.checkForNotCheck(b);case "result":return this.checkForResult(b);case "countmoves":return this.checkCountMoves(b)}};b.prototype.isMateGoal=function(){return"mate"==this.command};b.prototype.isCheckGoal=function(){return"check"==this.command};b.prototype.isResultGoal=function(){return"result"==this.command||"mate"==this.command||"stalemate"==this.command};b.prototype.isClickGoal=function(){return"click"==this.command};b.prototype.checkClick=
        function(b){var c=this.params[0].match(/[a-h?][1-8?](,[a-h?][1-8?])*/);if(c&&c.length){c=c[0].split(",");for(var e=0;e<c.length;e++){var d=c[e];if(d.match(/\?/)){var f=-1,g=-1;"?"!=d.charAt(0)&&(f=CB.Square.colFromString(d.substr(0,1)));"?"!=d.charAt(1)&&(g=CB.Square.rowFromString(d.substr(1,1)));if(!(-1!=f&&CB.Square.getFile(b)!=f||-1!=g&&CB.Square.getRank(b)!=g||-1!=this.sqsVisited.indexOf(CB.Square.toString(b)))){this.sqsVisited.push(CB.Square.toString(b));var r=this.sqsVisited.length<c.length?
            this.sqsVisited.length.toString()+"/"+c.length.toString():!0;break}}else if(CB.Square.fromString(d)==b&&-1==this.sqsVisited.indexOf(d)){this.sqsVisited.push(d);r=this.sqsVisited.length<c.length?this.sqsVisited.length.toString()+"/"+c.length.toString():!0;break}}}return r};b.prototype.isEvalGoal=function(){return"eval"==this.command};b.prototype.isSuccessGoal=function(){return this.control.match(/success/i)||this.control.match(/count/i)};b.prototype.getCountNeeded=function(){var b=this.control.match(/count=([0-9])+/i);
        return b&&b.length?parseInt(b[1]):-1};b.prototype.getIcon=function(){var b=this.control.match(/-([a-z0-9]+)/i);if(b&&1<b.length)return CB.getCommonPath()+"Media/Emojis/"+b[1]+".png"};b.prototype.isStopAfterGoal=function(){if(this.control.match(/go/i))return!1;if(this.control.match(/stop/i)||this.control.match(/success/i))return!0;var b=this.getCountNeeded();if(0<b)return this.countMet>=b};b.prototype.checkPiece=function(b){if(this.params){var c=this.params[0];if(c.match(/[wb][KQBRNP?]/g)){var e=" KQNBRP?".split("").indexOf(this.params[0].charAt(1));
        if(1<=e){"b"==c.charAt(0)&&(e|=CB.Piece.SIDE_MASK);var d=c.match(/[a-h?][1-8?]/g);if(d&&1==d.length&&"b?"!=d[0]){var f=c.substr(2,2);d=CB.Square.fromString(f);if(f.match(/\?/))for(c=d=-1,"?"!=f.charAt(0)&&(d=CB.Square.colFromString(f.substr(0,1))),"?"!=f.charAt(1)&&(c=CB.Square.rowFromString(f.substr(1,1))),f=0;64>f;f++){if(-1==d||CB.Square.getFile(f)==d)if(-1==c||CB.Square.getRank(f)==c){var g=b.getCurPos().board[f];if(g==e||this.isJokerPieceOk(e,g))return!0}}else return b.getCurPos().board[d]==
            e}else if(d=c.match(/(x|!x)([KQNBRP])/))if(c=CB.Piece.fromString(d[2].charAt(0)),b=b.getLastMove(),"x"==d[1]&&(b.vct&CB.Piece.PIECE_MASK)==c&&(b.mvd==e||this.isJokerPieceOk(e,b.mvd))||"!x"==d[1]&&(b.vct&CB.Piece.PIECE_MASK)!=c&&(b.mvd==e||this.isJokerPieceOk(e,b.mvd)))return!0}}}};b.prototype.isJokerPieceOk=function(b,c){return(b&CB.Piece.PIECE_MASK)==CB.Piece.JOKER&&(c&CB.Piece.SIDE_MASK)==(b&CB.Piece.SIDE_MASK)};b.prototype.checkJourney=function(b){var c,e=this.params[0];if(e.match(/[wb][KQBRNP]/g)){var d=
        " KQNBRP".split("").indexOf(this.params[0].charAt(1));if(1<=d){"b"==e.charAt(0)&&(d|=CB.Piece.SIDE_MASK);var f=b.getLastMove();if(f&&b.getCurPos().board[f.to]!=d)return;if((e=e.match(/[a-h?][1-8?](,[a-h?][1-8?])*/))&&e.length)for(e=e[0].split(","),f=0;f<e.length;f++){var g=e[f];if(g.match(/\?/)){var r=-1,t=-1;"?"!=g.charAt(0)&&(r=CB.Square.colFromString(g.substr(0,1)));"?"!=g.charAt(1)&&(t=CB.Square.rowFromString(g.substr(1,1)));for(g=0;64>g;g++)if(!(-1!=r&&CB.Square.getFile(g)!=r||-1!=t&&CB.Square.getRank(g)!=
        t||b.getCurPos().board[g]!=d||-1!=this.sqsVisited.indexOf(CB.Square.toString(g))))return this.sqsVisited.push(CB.Square.toString(g)),c=this.sqsVisited.length<e.length?this.sqsVisited.length.toString()+"/"+e.length.toString():!0}else if(r=CB.Square.fromString(g),b.getCurPos().board[r]==d&&-1==this.sqsVisited.indexOf(g)){this.sqsVisited.push(g);c=this.sqsVisited.length<e.length?this.sqsVisited.length.toString()+"/"+e.length.toString():!0;break}}}}return c};b.prototype.checkFirstMove=function(b){return 1==
        b.getMainLine().length&&this.checkMove(b)};b.prototype.checkMove=function(b){if(this.params){var c=this.params[0];if(c.match(/[wb][KQBRNP]/g)){var e=" KQNBRP".split("").indexOf(this.params[0].charAt(1));if(1<=e&&("b"==c.charAt(0)&&(e|=CB.Piece.SIDE_MASK),(c=c.match(/([a-h][1-8])[-]?([a-h][1-8])/))&&3==c.length)){var d=b.getPreviousMove();if(d&&d.from==CB.Square.fromString(c[1])&&d.to==CB.Square.fromString(c[2])&&b.getCurPos().board[d.to]==e)return!0}}}};b.prototype.checkForMate=function(b){var c=
        this.params[0];if(c.match(/[wb]/)&&b.getCurPos().isMate()&&("w"==c.charAt(0)&&!b.getCurPos().getBTM()||"b"==c.charAt(0)&&b.getCurPos().getBTM()))return!0};b.prototype.checkForStaleMate=function(b){var c=this.params[0];if(c.match(/[wb]/)&&b.getCurPos().isStaleMate()&&("w"==c.charAt(0)&&!b.getCurPos().getBTM()||"b"==c.charAt(0)&&b.getCurPos().getBTM()))return!0};b.prototype.checkForThreefold=function(b){return(new CB.DrawChecker).checkGame(b)==CB.DrawType.THREE_TIMES};b.prototype.checkForCheck=function(b){if(b.getCurPos().isCheck())return!0};
        b.prototype.checkForNotCheck=function(b){if(!b.getCurPos().isCheck())return!0};b.prototype.checkForResult=function(b){switch(this.params[0]){case "1":case "draw":if(CB.GameKernel.staticCheckTechnicalResult(b,{})==CB.GameResultEnum.DRAW)return!0}return!1};b.prototype.checkCountMoves=function(b){var c=parseInt(this.params[0]);if(c)return b.getMainLine().length>=2*c};b.prototype.checkForEval=function(b){if(null!=b)switch(this.params[0]){case "draw":case "equal":case "1":return 60>Math.abs(b);case "whitewins":case "win":case "2":return 200<
            b;case "blackwins":case "loss":case "0":return-200>b;case "blackbetter":return-70>b;case "whitebetter":return 70<b;case "equalorwhitebetter":return-50<b;case "equalorblackbetter":return 50>b;case "whitemates":return 1E5<b;case "blackmates":return-1E5>b;case "whitenotmate":return-1E5<b;case "blacknotmate":return 1E5>b}};b.splitParams=function(b){var c=[],e=b.match(/\[([\S]+)\]/);e&&0<e.length?(c.push(b.substr(0,e.index)+e[0]),b=b.substr(e.index+e[0].length),b.split(",").forEach(function(b){b&&c.push(b)})):
            c=b.split(",");return c};return b}();b.prototype.parseGoals=function(b){this.goals=[];(b=b.goals)&&b.split(";").forEach(function(b){var c=b.split(":");b=new CB.Goal;b.command=c[0].trim();1<c.length&&(c=c[1].split("/"),c.length&&(b.params=CB.Goal.splitParams(c[0]),1<c.length&&(b.control=c[1]),2<c.length&&(b.msg=c[2]),3<c.length&&(b.reply=c[3])));this.goals.push(b)}.bind(this))};b.prototype.hasResultGoal=function(){var b=!1;this.goals&&this.goals.forEach(function(c){c.isResultGoal()&&(b=!0)});return b};
    b.prototype.hasClickGoal=function(){var b=!1;this.goals&&this.goals.forEach(function(c){c.isClickGoal()&&(b=!0)});return b};b.prototype.checkGoals=function(){var b=null;if(this.goals)for(var c=0;c<this.goals.length;c++){b=this.goals[c];var e=b.isMet(this.kernel.game);b=this.onGoalMetResult(b,e);if(null!=b)break}return b};b.prototype.onGoalMetResult=function(b,c){var e=CB.getCommonPath()+"Media/Ribbons/Reader/Check24.png",d=null;if(!b.isDone()&&c){if(!b.feedBackDone)if("string"==typeof c)this.showGoalMsg(c,
        1600,e),b.sqsVisited&&(b.isClickGoal()?this.addVisitedSquareMarks(b.sqsVisited):this.removeVisitedSquareMarks(b.sqsVisited));else{b.countMet++;c=b.getCountNeeded();d=b.msg||"Excellent, you reached your goal!";if(0>=c||b.countMet>=c){if(this.showGoalMsg(d,4500,b.getIcon()),b.feedBackDone=!0,b.isSuccessGoal())this.onGoalReached()}else this.showGoalMsg(b.countMet.toString()+"/"+c.toString()+"...",1500,e);b.sqsVisited&&b.isClickGoal()&&this.addVisitedSquareMarks(b.sqsVisited);if(this.isStopAfterGoal=
        b.isStopAfterGoal())this.kernel.boardWin.allowInput=!1}d=b}return d};b.prototype.showGoalMsg=function(b,c,e){b=this.replaceVariables(b);var d=b.split("$");if(1<d.length){b=d[0];var f=d[1]}this.clearBoardMsgTimer.stop();d=-1;f&&(d=f.match(/([wb][KQBRNP])/g),null!=d?(f="w"==d[0][0]?0:1,d=this.kernel.getCurPos().getPiecePos(CB.Piece.fromString(d[0][1]),f)):d=CB.Square.fromString(f));this.boardWin.addBubble(b,d,320,e);c&&this.clearBoardMsgTimer.runOnce(c)};b.prototype.replaceVariables=function(b){return b.replace("{NMoves}",
        Math.floor(this.kernel.game.getMoveNo()/2+1).toString())};b.prototype.onGoalReached=function(){this.stampCheckOk();if(window.playchessUser&&!this.postedSuccess){var b=this.id+"-"+this.kernel.game.getMoveNo();V15.resultPostBack.postSolved(window.playchessUser,b,1)}this.postedSuccess||CB.SendEvent("Goal",this.id);this.postedSuccess=!0};b.prototype.stampCheckOk=function(){this.animTimer.runOnce(300,function(){if(V15.chessAudio)V15.chessAudio.onWellDone();this.boardWin.destroySideIcon();this.addCheckMark()}.bind(this))};
    b.prototype.addCheckMark=function(){this.boardWin.addSideIcon({url:CB.getCommonPath()+"Media/Ribbons/Reader/Check48.png",cssClass:"cbBoardCheckMark",boardFract:12})};b.prototype.addLevelMark=function(b){this.boardWin.addSideIcon({url:CB.getCommonPath()+"Media/Ribbons/Reader/LevelHard64.png",cssClass:"cbBoardCheckMark",boardFract:12})};b.prototype.clearBoardMsg=function(){this.boardWin.destroyMessage()};b.prototype.showDiagramHelp=function(b){this.kernel.boardWin&&(0<this.kernel.game.getMainLine().length||
    !b||this.hintCnt?(this.kernel.boardWin.clearAll(),this.markHint()):b&&(b=CB.DiagramAnimationController.parseDiagramHelp(b),this.boardWin&&this.boardWin.addBubble(b.text,b.sq,400,b.icon),b.attrs&&this.boardWin&&this.boardWin.addAttributes(b.attrs),this.hintCnt++),this.launchClearHints())};b.prototype.showChoiceFeedback=function(b){b=CB.DiagramAnimationController.parseChoiceFeedback(b);this.boardWin&&this.boardWin.addAttributes(b);this.launchClearHints()};b.prototype.launchClearHints=function(){this.clearHintsTimer&&
    this.clearHintsTimer.stop();this.clearHintsTimer=new CB.Timer(function(){this.kernel.boardWin.clearAll()}.bind(this));this.clearHintsTimer.runOnce(4E3)};b.prototype.onHintMove=function(b){var c=CB.Hints.gen(this.kernel.game,b);if(this.hintCnt<c.length){if(c.length){for(var e=[],d=[],f=this.hintCnt;f<c.length&&f<this.hintCnt+1;f++)switch(c[f]){case CB.HintTypes.FROM:this.kernel.markSquare(b.from,"hsla( 120, 70%, 60%, 0.8 )");d.push(new CB.BoardColouredSquare(b.from,"hsla( 120, 70%, 60%, 0.8 )",!0));
        break;case CB.HintTypes.TO:d.push(new CB.BoardColouredSquare(b.to,"hsla( 120, 70%, 60%, 0.8 )",!0));break;case CB.HintTypes.PIECE:this.kernel.game.getCurPos().findSquaresOfPiece(this.kernel.game.getCurPos().board[b.from]).forEach(function(b){this.kernel.markSquare(b,"hsla( 130, 50%, 40%, 0.3 )")}.bind(this));break;case CB.HintTypes.CAPTURE:e.push("Capture something!");break;case CB.HintTypes.CHECK:e.push("Give a check!")}e.length&&(b=e.join(", "),this.boardWin.addBubble(b,-1,320,CB.getCommonPath()+
        "Media/Emojis/lightbulb.png"));d.length&&this.boardWin.addAttributes(d)}this.hintCnt++}else this.boardWin.drawArrow(b.from,b.to,"hsla( 120, 70%, 60%, 0.8 )",9,!1,[4,6]),this.hintCnt=0};b.prototype.parseVisualizations=function(b){this.visuals=[];b=b.visuals;var c;b&&b.split(";").forEach(function(b){b=b.split(":");var e={command:b[0]};1<b.length&&(e.params=b[1]);this.visuals.push(e);"threat"==e.command&&(c=!0)}.bind(this));c&&this.initThreatEngine()};b.prototype.markVisualizations=function(){if(this.visuals&&
        this.kernel.game.getPreviousMove()){var b=[];this.visuals.forEach(function(c){switch(c.command){case "check":this.kernel.getCurPos().isCheck()&&this.visualizeCheck(b,"hsla( 240, 70%, 60%, 0.7 )");break;case "mate":this.kernel.getCurPos().isMate()&&this.visualizeMate(b,"hsla( 240, 70%, 60%, 0.7 )");break;case "opposition":this.markOpposition(b);break;case "pawnsquare":this.markPawnSquare(b);break;case "threat":this.markThreat()}}.bind(this));if(b.length&&this.kernel.game){var c=this.kernel.game.getMoveBaggage()||
        {};c.attributes=b;this.kernel.game.setMoveBaggage(c)}}};b.prototype.visualizeCheck=function(b,c){if(this.kernel.game.getPreviousMove()){var e=this.kernel.getCurPos(),d=e.getKingsPos(e.getSideToMove());e.getAttacksTo(d,CB.Side.other(e.getSideToMove())).forEach(function(e){b.push(new CB.BoardArrow(e,d,c,8,[2,7]))})}};b.prototype.visualizeMate=function(b){var c=this.kernel.game.getPreviousMove();if(c){var e=this.kernel.getCurPos().getKingsPos(this.kernel.getCurPos().getSideToMove());b.push(new CB.BoardColouredSquare(e,
        "black"));c=this.kernel.game.getPreviousMove();b.push(new CB.BoardArrow(c.to,e,"hsla( 0, 75%, 50%, 0.8 )",8,[2,7]))}};b.prototype.markOpposition=function(b){if(CB.ChessKnowledge.isEndgame(this.kernel.getCurPos())){var c=this.kernel.game.getPreviousMove();if(c&&(c.mvd&CB.Piece.PIECE_MASK)==CB.Piece.KING){var e=this.kernel.getCurPos().getKingsPos(this.kernel.getCurPos().getSideToMove()),d=this.kernel.getCurPos().getKingsPos(CB.Side.other(this.kernel.getCurPos().getSideToMove()));if(e=CB.ChessKnowledge.getOpposition(e,
        d))e.forEach(function(c){0==this.kernel.getCurPos().board[c]&&b.push(new CB.BoardColouredSquare(c,"hsla( 10, 85%, 60%, 0.8 )"))}.bind(this)),b.push(new CB.BoardColouredSquare(c.to,CB.DiagramAnimationController.translateSquareColor("green",c.to)))}}};b.prototype.markPawnSquare=function(){};b.prototype.markThreat=function(){if(!this.isStopAfterGoal){var b=ObjUtil.clone(this.kernel.getCurPos());b.isCheck()||(b.sd=CB.Side.other(b.sd),this.threatEngine&&(this.threatEngine.sendNewPos(b),this.threatEngine.search(300)))}};
    b.prototype.initThreatEngine=function(){var b=this;this.threatEngine=new CB.EngineWrapper(2,this.engUrl,null,{onEnginePV:function(b,c){},onEngineMove:function(c,e){c=new CB.Move;c.fromJSON(e.move);b.onThreatMove(c)}});this.threatEngine.load()};b.prototype.markHint=function(){if(this.hintMove)this.onHintMove(this.hintMove);else this.hintEngine||this.initHintEngine(),this.hintEngine.sendNewPos(this.kernel.getCurPos()),this.hintEngine.search(500)};b.prototype.initHintEngine=function(){var b=this;this.hintEngine=
        new CB.EngineWrapper(2,this.engUrl,null,{onEnginePV:function(b,c){},onEngineMove:function(c,e){c=new CB.Move;c.fromJSON(e.move);b.onHintMove(c)}});this.hintEngine.load()};b.prototype.onThreatMove=function(b){this.boardWin.drawArrow(b.from,b.to,"hsla( 0, 80%, 50%, 0.75 )",9,!0,[5,5])};b.prototype.addVisitedSquareMarks=function(b){b.forEach(function(b){b=CB.Square.fromString(b);b=new CB.BoardColouredSquare(b,CB.DiagramAnimationController.translateSquareColor("blue",b),!0);this.boardWin.permanentAttributes.push(b)}.bind(this));
        this.boardWin.renderQueuedAttributes(!0)};b.prototype.removeVisitedSquareMarks=function(b){b.forEach(function(b){b=CB.Square.fromString(b);for(var c=0;c<this.boardWin.permanentAttributes.length;c++)this.boardWin.permanentAttributes[c].sq==b&&(this.boardWin.permanentAttributes.splice(c,1),c--)}.bind(this));this.boardWin.renderQueuedAttributes(!0)};b.prototype.checkResultGoal=function(){this.goals&&this.goals.forEach(function(b){if(b.isResultGoal()&&b.isMet(this.kernel.game))this.onGoalMet(b)}.bind(this))};
    b.prototype.checkEvalGoal=function(){this.goals&&null!=this.eval&&this.goals.forEach(function(b){!b.isDone()&&b.isEvalGoal()&&b.checkForEval(this.eval)&&(b.countMet++,this.onGoalMet(b))}.bind(this))};b.prototype.onGoalMet=function(b){b.msg&&this.showGoalMsg(b.msg,0,b.getIcon());this.isStopAfterGoal=b.isStopAfterGoal();if(b.isSuccessGoal())this.onGoalReached()};b.prototype.parsePieceSquareTables=function(b){var c=[];(b=b.pst)&&b.split(";").forEach(function(b){b=b.split(":");if(1<b.length){var e=b[0].match(/([wb][KQBRNP])/g);
        if(e&&1==e.length){var d={piece:e[0]},f=[];b[1].split(",").forEach(function(b){var c=b.match(/([a-h][1-8])=(-*[\d]+)/);if(c&&3==c.length)f.push({sq:CB.Square.fromString(c[1]),val:parseInt(c[2])});else if(b.match(/ahead/i))for(b="b"==d.piece.charAt(0),c=0;64>c;c++){var e=c&7;f.push({sq:c,val:b?100*(49-e*e):100*e*e})}});d.vals=f;c.push(d)}}});this.pieceSquareTables=c};b.prototype.onGameNavigate=function(){this.superClass.onGameNavigate.call(this);this.kernel.game.setResult(CB.GameResultEnum.UNDEFINED_RESULT);
        this.goals&&this.goals.forEach(function(b){b.reset()});this.engineSide=null;this.isStopAfterGoal=!1;this.kernel.boardWin.allowInput=!0;this.options.idDOMEngOut&&$("#"+this.options.idDOMEngOut).text("")};b.prototype.resetGame=function(b){V15.hasUrlGame()?this.kernel.fnInitGame(b):b.reset()};b.prototype.newGame=function(b){this.superClass.newGame.call(this);var c=this.kernel.game;c.gotoLast();this.engineAnswers=!0;c.isNormalInit()&&0==c.getMainLine().length?this.engineSide=CB.Side.other(this.kernel.boardWin.getSideToShow()):
        c.isNormalInit()||0!=c.getMainLine().length?this.engineSide=null:(this.engineSide=CB.Side.other(c.getCurPos().getSideToMove()),this.kernel.getCurPos().isMate()||this.kernel.getCurPos().isStaleMate()||this.kernel.boardWin.setBlackIsBottom(this.engineSide==CB.Side.WHITE));if(!CB.System.runsInIFrame()&&b)V15.chessAudio.onNewGame();null!=this.engineSide&&c.getCurPos().getSideToMove()!=this.engineSide&&V15.analysisEngine&&V15.analysisEngine.engineGo(this.kernel);this.boardWin.redraw()};b.prototype.setHeaderData=
        function(){var b=this.kernel.game.getHeader(),c=this.getUserName();this.engineSide==CB.Side.WHITE?(b.setWhite(this.options.engineName),b.setBlack(c)):(b.setWhite(c),b.setBlack(this.options.engineName))};b.prototype.getUserName=function(){var b=V15.Vf.userName;V15.isLoggedIn()&&b||(b=lm.GUEST);return b};b.prototype.levelToGameHeader=function(){this.kernel.game.hdr.event.event=this.getLevelStr();this.kernel.game.fireOnHeaderChanged()};b.prototype.getLevelStr=function(){return"Mini Play"};b.prototype.getAllowedColor=
        function(){return CB.AllowedColor.detFromOpponentSide(this.engineSide)};b.prototype.getMySide=function(){return null==this.engineSide?null:CB.Side.other(this.engineSide)};b.prototype.isAnalysis=function(){return!1};b.prototype.setAnalysis=function(b){throw Error("Cannot set analysis on playing mode");};b.prototype.setTimeControl=function(b){};b.WAIT_FOR_BEST_TIMEOUT=300;b.prototype.engineMoveNow=function(){};b.prototype.onEnteredMove=function(b){this.saved=!1;this.clickHintTimer.stop();try{V15.analysisEngine&&
    V15.analysisEngine.engineStop(),this.ponderHint=null,this.kernel.game.deleteRemaining(!0),null===this.engineSide&&(this.engineSide=CB.Side.other(this.kernel.getCurPos().getSideToMove()),this.setHeaderData()),this.kernel.boardWin.setBlackIsBottom(this.engineSide!==CB.Side.BLACK),this.superClass.onEnteredMove.call(this,b),this.kernel.game.hdr.setResult(CB.GameResultEnum.LINE)!=CB.GameResultEnum.LINE&&this.kernel.game.fireOnHeaderChanged()}catch(g){CB.LogException("AgEng::onEntrd",g)}return!0};b.prototype.startSearch=
        function(){this.kernel.getCurPos().isLegal()&&(null===this.engineSide&&(this.engineSide=this.kernel.getCurPos().getSideToMove()),this.kernel.getCurPos().getSideToMove()!=this.engineSide||this.isStopAfterGoal||(this.engineStartTick=new CB.Tick,this.engineGo(0)))};b.prototype.engineGo=function(b){this.shouldShowBusyCursor()&&this.kernel.boardWin.setBusy(!0);this.ponderHint=null;this.engine[b].sendNewGame(this.kernel.game,this.pieceSquareTables);this.engine[b].search(this.thinkTime,this.plyDepth)};b.prototype.parseThinkTime=
        function(b){this.thinkTime=1E3;var c=b.match(/(\d+)ply/);c?this.plyDepth=c[1]:b.match(/\d+/)&&(this.thinkTime=parseInt(b))};b.prototype.checkLiveBook=function(){};b.prototype.shouldShowBusyCursor=function(){return!1};b.prototype.onGameMove=function(){this.clearBoardAlways&&(this.kernel.boardWin.clearBoardAttributes(),this.kernel.boardWin.clearBaggageAttributes(),V15.panelMgr.currPluginIsAnimatedDiagram()&&this.kernel.boardWin.clearPermanentAttributes());V15.panelMgr.onUserMove(this.nPlugin);this.execEngineMoveTimer.stop();
        this.superClass.onGameMove.call(this);if(this.kernel.getCurPos().isLegal()&&this.engineAnswers){if(this.clock){CBDebug.assert(this.clock,"CLOCK NOT SET");this.clock.stop();var b=this.clock.createTimeAnno();this.kernel.addTimeAnno(b)}var c=this.checkGoals();this.markVisualizations();if(this.kernel.game.getCurPos().hasLegals())if(b=0,c&&c.reply&&null!=(b=c.reply.match(/([a-h][1-8])([a-h][1-8])([QBRN]*)/))){c=CB.Square.fromString(b[1]);b=CB.Square.fromString(b[2]);var e=new CB.Move(c,b);(new CB.Timer(function(){this.execEngineMoveTimer.runOnce(1E3,
            function(){this.kernel.game.getCurPos().isLegalMove(e)?this.kernel.execEngineMove(e):alert("Forced Reply illegal")}.bind(this))}.bind(this))).runOnce(10)}else this.startSearch()}};b.prototype.onResetGame=function(){};var c=new CB.Vr;b.prototype.updateGamePos=function(){this.hintCnt=0;this.execEngineMoveTimer.stop();c.exec(function(){}.bind(this),200)};b.prototype.onTechnicalGameEnd=function(b,c){if(b!=CB.GameResultEnum.DRAW||!c||c.drawType!=CB.DrawType.MATERIAL||this.kernel.getCurPos().isStaleMate())b=
        CB.GameResultEnum.toString(b),this.hasResultGoal()?this.checkResultGoal():(this.kernel.getCurPos().isMate()?b+=" ("+lm.MATE+")":this.kernel.getCurPos().isStaleMate()&&(b+=" ("+lm.STALEMATE+"!)"),this.boardWin&&(this.boardWin.addBubble(b,-1,250),this.clearBoardMsgTimer.stop()))};b.prototype.onResign=function(){var b=String.formatEx(lm.RESIGNS,"Fritz");V15.panelMgr.showBoardMessage(b,7E3);var c=this.engineSide==CB.Side.BLACK?CB.GameResultEnum.WHITE_WINS:CB.GameResultEnum.BLACK_WINS;this.kernel.addTextAnno(b);
        this.kernel.setResult(c)};b.prototype.onLosingLine=function(b,c){b=c.getEval()-b.getEval();300<b&&this.kernel.addSymbol(CB.AnnoMarkType.VERY_BAD);200<b&&this.kernel.addSymbol(CB.AnnoMarkType.BAD);100<b&&this.kernel.addSymbol(CB.AnnoMarkType.DUBIOUS)};b.prototype.userResigns=function(){if(!CB.GameResultEnum.isFinished(this.kernel.game.getResult())){var b=this.engineSide==CB.Side.WHITE?CB.GameResultEnum.WHITE_WINS:CB.GameResultEnum.BLACK_WINS;this.kernel.addTextAnno(String.formatEx(lm.RESIGNS,this.getUserName()));
        this.kernel.setResult(b)}};b.prototype.onAnalysisLine=function(b,c,e){};var e=new CB.HSLColor(100,60,45,.7);b.prototype.getMarkedSquaresOnButtonDown=function(b,c){return this.kernel.getCurPos().getSideToMove()==this.engineSide?[]:c&&!this.clickHintTimer.isActive()?this.getTargetSquareHints(b):this.genLegalSquareHints(b)};b.prototype.genLegalSquareHints=function(b){var c=[];this.kernel.game.getCurPos().V7().forEach(function(d){d.from==b&&c.push({sq:d.to,clr:e})});return c};b.prototype.startClickHintTimer=
        function(b){this.clickHintTimer.runOnce(600,function(){var c=this.getTargetSquareHints(b);this.kernel.boardWin.markSquares(c)}.bind(this))};b.prototype.getTargetSquareHints=function(b){if(this.kernel.getCurPos().getSideToMove()==this.engineSide)return[];var c=[];this.lbInfo&&this.lbInfo.moves.forEach(function(e){e.move.from==b&&70<e.getNGames()&&c.push({sq:e.move.to,clr:new CB.HSLColor(CB.HSLColor.BLUE,80,60,.8)})}.bind(this));V15.analysisEngine&&V15.analysisEngine.getHintSquaresOnButtonDown(b).forEach(function(b){for(var e=
        !1,d=0;!e&&d<c.length;d++)c[d].sq==b.sq&&(e=!0);e||c.push(b)});return c};return b}();
CB.SimpleEngineModeMixin=function(){return{toggleEngine:function(){if(this.isEngineLoaded(0))return this.unloadEngine(0),!1;this.loadEngine(0);this.updateGamePos();return!0},incNMultiVars:function(d){this.nMultiVars+=d;1>this.nMultiVars&&(this.nMultiVars=1);64<this.nMultiVars&&(this.nMultiVars=64)},goAll:function(){this.isInThreat=!1;this.engines.forEach(function(d){d.setMultiPV(this.nMultiVars);d&&(d.go(this.kernel.game,{infinite:!0}),d.fireOnThreat(!1))}.bind(this))},toggleThreat:function(){if(this.isInThreat)this.goAll();
    else{var d=ObjUtil.clone(this.kernel.game.cur);if(d.swapSide()){this.isInThreat=!0;var b=new CB.Game(d);this.engines.forEach(function(c){c.setMultiPV(this.nMultiVars);c&&(c.go(b,{infinite:!0}),c.fireOnThreat(!0))}.bind(this))}}},toggleAnalysisThreat:function(){if(V15.analysisEngine)if(this.isInThreat)V15.analysisEngine.engineGo(this.kernel),V15.analysisEngine.engine.fireOnThreat(!1);else{var d=ObjUtil.clone(this.kernel.game.cur);d.swapSide()&&(this.isInThreat=!0,d=new CB.Game(d),V15.analysisEngine.engine.setMultiPV(1),
        V15.analysisEngine.engine.go(d,{infinite:!0}),V15.analysisEngine.engine.fireOnThreat(!0))}}}}();"use strict";
CB.AnalysisMode=function(){var d=function h(b,d,g){h.superClass.call(this,b,CB.AnalysisMode.POOL_SIZE);this.kernel=b;this.maxEngine=d||1;this.currEngine=0;this.active=!0;this.liveBookTimer=new CB.Timer(this.liveBookTimeout.bind(this));this.posInfoTimer=new CB.Timer(this.posInfoTimerHdl.bind(this));"undefined"!=typeof V15&&!V15.analysisEngine&&CB.System.isDesktop()&&V15.config.useAnalysisEngines&&CB.AnalysisEngine&&CB.System.browserIsSafeForEngine()&&(V15.analysisEngine=new CB.AnalysisEngine);this.nMultiVars=
    1;this.clickHintTimeout=g?g.hintTimeout||500:500;this.fnCheckLiveBook=g&&g.liveBookSilent?this.checkLiveBook.bind(this):this.checkLiveBookWithPanel.bind(this);this.nBookTimeouts=0};CB.inherit(d,CB.EngineHostMode);CB.SimpleEngineModeMixin&&CB.mixin(d,CB.SimpleEngineModeMixin);d.POOL_SIZE=0;d.prototype.destroy=function(){V15.analysisEngine&&V15.analysisEngine.unlinkPlayingMode(this);this.superClass.destroy.call(this);V15.commands.fireChecked(CB.CommandIds.TOGGLE_ANALYSIS_ENGINE,!1)};d.prototype.onPanelsReady=
    function(){for(var b=0;b<this.maxEngine;b++)this.loadEngine(b);V15.commands.fireChecked(CB.CommandIds.TOGGLE_ANALYSIS_ENGINE,!0);this.panEng&&(this.idOnEngMove=this.panEng.addOnMoveEnteredListener(this.kernel.reactToEnteredMove.bind(this.kernel)))};d.prototype.createGUIElements=function(b){this.superClass.createGUIElements.call(this,b);b.shouldAnimatePosChange=this.shouldAnimatePosChange.bind(this);CB.System.isMobile()&&(b.animSteps={forMove:.3,forPosition:.2});V15.analysisEngine&&V15.analysisEngine.linkPlayingMode(this)};
    d.prototype.onResetGame=function(){this.nBookTimeouts=0};d.prototype.onEnteredMove=function(b){return this.fnAcceptMove?this.fnAcceptMove(b):!0};d.prototype.onExit=function(){this.superClass.onExit.call(this);V15.analysisEngine&&(V15.analysisEngine.engineStop(),V15.analysisEngine.clearLines())};d.prototype.onAfterMoveEntry=function(b){if(this.fnAfterMove)return this.fnAfterMove(b)};d.prototype.setEngineOff=function(){this.active=!1;this.superClass.setEngineOff.call(this)};d.prototype.isAnalysis=function(){return!0};
    d.prototype.setAnalysis=function(b){clearTimeout(this.timer);this.active=b;V15.commands.fireChecked(CB.CommandIds.TOGGLE_ANALYSIS_ENGINE,b);for(var e=0;e<this.nEngines;++e)b||void 0===this.engines[e]||this.engines[e].abort();b&&this.updateGamePos()};d.prototype.setTimeControl=function(b){throw Error("Cannot set search time on analysis playing mode");};d.prototype.toggleAnalysis=function(){this.setAnalysis(!0);for(var b=0;b<this.maxEngines;++b)this.loadEngine(b);this.updateGamePos()};d.prototype.pendingMoveNow=
        !1;d.prototype.engineMoveNow=function(){};d.ENGINE_DELAY=100;var b=new CB.Vr;d.prototype.gateUpdate=new CB.Vr;d.prototype.updateGamePos=function(){this.kernel==V15.panelMgr.getKernel()&&(this.stopAll(),V15.analysisEngine&&(V15.analysisEngine.engineStop(),V15.analysisEngine.clearLines()),this.isAutoplay||(b.exec(function(){this.active&&this.kernel.game.getCurPos().hasLegals()&&this.goAll()}.bind(this),d.ENGINE_DELAY),this.gateUpdate.exec(function(){this.fnCheckLiveBook();V15.analysisEngine&&V15.analysisEngine.engineGo(this.kernel)}.bind(this),
        400)))};d.prototype.checkLiveBookWithPanel=function(){V15.aTBLobby&&V15.aTBLobby.isLoggedIn()&&(CB.LOG("AlMode checkLivePan: "+this.kernel.game.hdr.toString()+" marker="+this.kernel.forceUpdateMarker,"LogGreen","anal"),this.updatePos&&this.updatePos.equals(this.kernel.game.getCurPos())&&!this.kernel.forceTBUpdate||(this.updatePos=ObjUtil.clone(this.kernel.game.getCurPos()),V15.panelMgr.tbBook&&(V15.panelMgr.tbBook.clear("Requesting moves..."),V15.panelMgr.tbBook.isVisible()&&V15.aTBLobby.requestAllMoves(this.kernel.game.getCurPos(),
        !1,!1,this.kernel.ticket),this.idLBListener||(this.idLBListener=V15.aTBLobby.addOnLiveBookListener(this.liveBookListener.bind(this))),this.idTBListener||(this.idTBListener=V15.aTBLobby.addOnTBDataListener(this.tbDataListener.bind(this))),this.liveBookTimer.runOnce(5E3),V15.aTBLobby.requestPosInfo(this.kernel.game.getCurPos()),this.posInfoTimer.isActive||this.posInfoTimer.runOnce(15E3)),this.kernel.forceTBUpdate=!1))};d.prototype.checkLiveBook=function(){this.shouldAccessLiveBook()?(CB.LOG("AlMode CheckLive: "+
        this.kernel.game.hdr.toString()+" marker="+this.kernel.forceUpdateMarker,"LogGreen","anal"),this.updatePos&&this.updatePos.equals(this.kernel.game.getCurPos())&&!this.kernel.forceTBUpdate||(this.updatePos=ObjUtil.clone(this.kernel.game.getCurPos()),V15.aTBLobby.requestAllMoves(this.kernel.game.getCurPos(),!1,!1,this.kernel.ticket),this.idLBListener||(this.idLBListener=V15.aTBLobby.addOnLiveBookListener(this.liveBookListener.bind(this))),this.idTBListener||(this.idTBListener=V15.aTBLobby.addOnTBDataListener(this.tbDataListener.bind(this))),
        this.liveBookTimer.runOnce(5E3),this.kernel.forceTBUpdate=!1)):V15.aTBLobby.fireOnLiveBookDisplay({ticket:this.kernel.ticket,moves:[]})};d.prototype.shouldAccessLiveBook=function(){var b=this.kernel.getCurPos();return 6<b.getPieces().length&&16>b.getPieces().length?!1:V15.aTBLobby&&V15.aTBLobby.isLoggedIn()&&(6>this.nBookTimeouts||10>this.kernel.game.getMoveNo())&&(60>this.kernel.game.getMoveNo()||6>=b.getPieces().length||2550<this.kernel.game.hdr.getMaxElo())};d.prototype.liveBookListener=function(b){V15.aTBLobby.fireOnLiveBookDisplay(b);
        this.liveBookTimer.stop();this.nBookTimeouts=0};d.prototype.tbDataListener=function(){};d.prototype.liveBookTimeout=function(){V15.panelMgr.tbBook&&V15.panelMgr.tbBook.setEmptyText(lm.FRESH_POSITION);this.nBookTimeouts++};d.prototype.posInfoTimerHdl=function(){V15.aTBLobby&&V15.aTBLobby.hasIdReceived&&V15.panelMgr.tbBook&&V15.aTBLobby.requestPosInfo(this.kernel.game.getCurPos())};d.prototype._engAnalysisTimeoutHdl=function(){this.active&&this.kernel.game.getCurPos().hasLegals()&&this.goAll()};d.prototype.getMoveEnterType=
        function(){return this.fnGetMoveEnterType?this.fnGetMoveEnterType():CB.MoveEnterType.NEWLINE};d.prototype.getMarkedSquaresOnButtonDown=function(b,d){return!d||this.clickHintTimer&&this.clickHintTimer.isActive()?this.genLegalSquareHints(b):this.getTargetSquareHints(b)};d.prototype.startClickHintTimer=function(b){this.kernel.game.getMoveOffs()<this.startMoveNo||(this.clickHintTimer||(this.clickHintTimer=new CB.Timer),this.clickHintTimer.runOnce(this.clickHintTimeout,function(){var e=this.getTargetSquareHints(b);
        this.kernel.boardWin.markSquares(e)}.bind(this)))};d.prototype.getLegalSqClr=function(){return"hsla( 0, 0%, 55%, 0.50 )"};d.prototype.getTargetSquareHints=function(b){var e=[];if(CB.Piece.side(this.kernel.getCurPos().board[b])!=this.kernel.getCurPos().getSideToMove())return e;V15.analysisEngine&&(b=V15.analysisEngine.getHintSquaresOnButtonDown(b),b.forEach(function(b){for(var d=!1,f=0;!d&&f<e.length;f++)e[f].sq==b.sq&&(d=!0);d||e.push(b)}),0!=b.length||V15.analysisEngine.running||V15.analysisEngine.engineGo(this.kernel));
        return e};d.prototype.onAnalysisLine=function(b,d,g){this.kernel.game.hasTBEval||(this.kernel.getCurPos().getBTM()&&(d=-d),this.kernel.game.fireOnEval(b,d,g))};d.prototype.toggleEngine=function(){if(this.isEngineLoaded(0))return this.unloadEngine(0),!1;this.loadEngine(0);this.updateGamePos();return!0};return d}();"use strict";
CB.AnnoType={POSTTEXT:2,SYMBOL:3,SQUARE_LIST:4,ARROW_LIST:5,DIAGRAM:6,TIME:7,DATE:8,TRAINING:9,BIGMAX:16,AUDIO:16,PICTURE:17,VIDEO:18,GAME_QUOTATION:19,PAWN_STRUCT:20,PIECE_PATH:21,MIDDLEGAME_CLASS:22,ENDGAME_CLASS:23,CRITICAL_POS:24,CORR:25,STREAM:26,CHESS_VARIANT:27,MAX:32,CAPTION:32,FRITZ_EVAL:33,MOVE_MEDAL:34,COLOR:35,TIME_CONTROL:36,SYNC:37,EVAL_PROFILE:38,AUDIO_STREAM:127,GENERIC:127,ANNO_BITS:127,PRE_BIT:128,toString:function(d){for(var b in this)if(this[b]==d)return"AnnoType: "+b;return"Unknown AnnoType: "+
        d}};CB.AnnoMarkType={NONE:0,GOOD:1,BAD:2,VERY_GOOD:3,VERY_BAD:4,INTERESTING:5,DUBIOUS:6,ONLY_MOVE:8,ZUGZWANG:22,MYMOVE:165,IMPORTANT:166,WHITE:167,BLACK:168,BOTH:169};CB.AnnoEvalType={NONE:0,EQUAL:11,UNCLEAR:13,BLACK_SLIGHTLY_BETTER:15,BLACK_BETTER:17,BLACK_WINS:19,WHITE_WINS:18,WHITE_BETTER:16,WHITE_SLIGHTLY_BETTER:14,COMPENSATION:44,COUNTERPLAY:132,INITIATIVE:36,ATTACK:40,ZEITNOT:138,DEVELOPMENT:32,NOVELTY:146};CB.TextType={TT_ANSI:0,TT_RTF:1,TT_HTML:2,TT_TOKEN:3,TT_JSON:4};
CB.AnnoType.PRETEXT=CB.AnnoType.PRE_BIT|CB.AnnoType.POSTTEXT;CB.AnnoType.PRE_SQUARE_LIST=CB.AnnoType.PRE_BIT|CB.AnnoType.SQUARE_LIST;CB.AnnoType.PRE_ARROW_LIST=CB.AnnoType.PRE_BIT|CB.AnnoType.ARROW_LIST;CB.Medal={BESTGAME:1,TOURN_DECISIVE:2,SAMPLE_OPENING:4,IMPORTANT_NOVELTY:8,PAWNSTRUCTURE:16,STRATEGY:32,TACTICS:64,ATTACK:128,DEFENSE:256,SACRIFICE:512,MATERIAL:1024,PIECEPLAY:2048,ENDGAME:4096,TACTICAL_BLUNDER:8192,STRATEGICAL_BLUNDER:16384,USER:32768};
var AnnoFactory={factory:function(d){return d in this?new this[d]:null}};function AnnoRec(){}AnnoRec.readHeader=function(d){return{inxMv:d.readBEInt24(),type:d.readByte(),len:d.readBEInt16()}};AnnoRec.writeHeader=function(d,b,c,e){d.writeBEInt24(b);d.writeByte(c);d.writeBEInt16(e)};AnnoRec.ANNO_HEAD_SIZE=6;
CB.TextAnno=function(){var d=function(b){this.textType=CB.TextType.TT_ANSI;this.m_str=b?b:""};d.prototype.getString=function(){return this.m_str};d.prototype.setString=function(b){this.m_str=b};d.prototype.toString=function(){return this.m_str};d.prototype.addText=function(b){this.m_str+=b};d.prototype.write=function(b,c){var e=AnnoRec.ANNO_HEAD_SIZE+2+this.m_str.length;b.Vi(e);AnnoRec.writeHeader(b,0,c,e);b.writeByte(this.textType||CB.TextType.TT_ANSI);b.writeByte(0);b.writeSizedString(this.m_str)};
    d.prototype.read=function(b,c){this.textType=c.readByte();c.readByte();this.m_str=c.readSizedString(b-2);CB.strUtil.mayBeUtf8(this.m_str)&&(this.m_str=CB.strUtil.decodeUTF8(this.m_str))};return d}();AnnoFactory[CB.AnnoType.POSTTEXT]=CB.TextAnno;AnnoFactory[CB.AnnoType.PRETEXT]=CB.TextAnno;
CB.SymbolsAnno=function(){var d=function(){};d.prototype=[];d.prototype.toString=function(){return"syms"};d.prototype.isExclusiveMark=function(b){return 1<=b&&6>=b};d.prototype.isExclusiveEval=function(b){return 11<=b&&19>=b||44==b};d.prototype.addSymbol=function(b){for(var c=0;c<this.length;c++)if(this.isExclusiveMark(this[c])&&this.isExclusiveMark(b)||this.isExclusiveEval(this[c])&&this.isExclusiveEval(b)){b!=this[c]&&this.push(b);this.splice(c,1);return}for(c=0;c<this.length;c++)if(b==this[c]){this.splice(c,
    1);return}this.push(b)};d.prototype.hasExclusiveEval=function(b){for(var c=0;c<this.length;c++)if(b==this[c]&&this.isExclusiveEval(b))return!0;return!1};d.prototype.getEval=function(){for(var b=0;b<this.length;b++)if(this.isExclusiveEval(this[b]))return this[b];return 0};d.prototype.removeMyMoveMark=function(){for(var b=0;b<this.length;b++)if(this[b]===CB.AnnoMarkType.MYMOVE){this.splice(b,1);break}};d.prototype.write=function(b){var c=AnnoRec.ANNO_HEAD_SIZE+this.length;b.Vi(c);AnnoRec.writeHeader(b,
    0,CB.AnnoType.SYMBOL,c);for(c=0;c<this.length;c++)b.writeByte(this[c])};d.prototype.read=function(b,c){for(var e=0;e<b;++e)this.push(c.readByte())};return d}();AnnoFactory[CB.AnnoType.SYMBOL]=CB.SymbolsAnno;CB.BoardColor={NONE:0,GREEN:1,YELLOW:2,RED:3,TRANSYELLOW:4};CB.BoardColor.fromChar=function(d){switch(d){case "R":return CB.BoardColor.RED;case "Y":return CB.BoardColor.YELLOW;case "G":return CB.BoardColor.GREEN;default:return CB.BoardColor.NONE}};
CB.BoardColor.fromString=function(d){switch(d){case "R":case "LR":return CB.BoardColor.RED;case "Y":return CB.BoardColor.YELLOW;case "LG":case "G":return CB.BoardColor.GREEN;default:return CB.BoardColor.GREEN}};CB.BoardColor.toChar=function(d){switch(d){case CB.BoardColor.RED:return"R";case CB.BoardColor.YELLOW:return"Y";case CB.BoardColor.GREEN:return"G"}return""};
CB.ColSq=function(){function d(b,c){this.field=b;this.color=c}d.STRING_LEN=3;d.prototype.init=function(b){this.color=CB.BoardColor.GREEN;this.field=CB.Square.A1;4==b.length?(this.color=CB.BoardColor.fromString(b.substring(0,2)),this.field=CB.Square.fromString(b.substring(2,4))):3==b.length&&(this.color=CB.BoardColor.fromChar(b[0]),this.field=CB.Square.fromString(b.substring(1)))};d.readFactory=createReadFactory(d);d.prototype.read=function(b){this.color=b.readByte();this.field=b.readByte();this.color--;
    this.field--};d.prototype.write=function(b){b.writeByte(this.color+1);b.writeByte(this.field+1)};d.prototype.toString=function(){return CB.BoardColor.toChar(this.color)+CB.Square.toString(this.field)};d.prototype.getColour=function(){switch(this.color){case CB.BoardColor.GREEN:return"hsla( 120, 65%, 50%, 0.75 )";case CB.BoardColor.YELLOW:return"hsla( 60, 65%, 50%, 0.8 )";case CB.BoardColor.RED:return"hsla( 0, 65%, 50%, 0.75 )"}};return d}();
CB.ColSqAnno=function(){var d=function(){};d.prototype=[];d.prototype.read=function(b,c){for(var e=0;e<b/2;e++){var d=new CB.ColSq(0,0);d.read(c);this.push(d)}};d.prototype.write=function(b){var c=AnnoRec.ANNO_HEAD_SIZE+2*this.length;b.Vi(c);AnnoRec.writeHeader(b,0,CB.AnnoType.SQUARE_LIST,c);for(c=0;c<this.length;c++)this[c].write(b)};d.prototype.toString=function(b){b||(b=",");return this.join(b)};return d}();AnnoFactory[CB.AnnoType.SQUARE_LIST]=CB.ColSqAnno;
CB.ColArrow=function(){var d=function(b,c,e){this.from=b;this.to=c;this.color=e};d.STRING_LEN=5;d.prototype.init=function(b){this.from=CB.Square.fromString(b.substring(1,3));this.to=CB.Square.fromString(b.substring(3,5));this.color=CB.BoardColor.fromChar(b[0])};d.readFactory=createReadFactory(d);d.prototype.read=function(b){this.color=b.readByte();this.from=b.readByte();this.to=b.readByte();this.color--;this.from--;this.to--};d.prototype.write=function(b){b.writeByte(this.color+1);b.writeByte(this.from+
    1);b.writeByte(this.to+1)};d.prototype.toString=function(){return CB.BoardColor.toChar(this.color)};d.prototype.getColour=function(){switch(this.color){case CB.BoardColor.GREEN:return"hsla( 120, 70%, 50%, 0.90 )";case CB.BoardColor.YELLOW:return"hsla( 50, 75%, 65%, 0.90 )";case CB.BoardColor.RED:return"hsla( 1, 85%, 45%, 0.90 )"}};return d}();
CB.ColArrowAnno=function(){var d=function(){};d.prototype=[];d.prototype.read=function(b,c){for(var e=0;e<b/3;e++){var d=new CB.ColArrow;d.read(c);this.push(d)}};d.prototype.write=function(b){var c=AnnoRec.ANNO_HEAD_SIZE+3*this.length;b.Vi(c);AnnoRec.writeHeader(b,0,CB.AnnoType.ARROW_LIST,c);for(c=0;c<this.length;c++)this[c].write(b)};d.prototype.toString=function(b){b||(b=",");return this.join(b)};return d}();AnnoFactory[CB.AnnoType.ARROW_LIST]=CB.ColArrowAnno;AnnoFactory[CB.AnnoType.DIAGRAM]=CB.TextAnno;
CB.EvalAnno=function(){var d=function(b,c){b&&(this.eval=b);c&&(this.depth=c)};d.prototype.eval=0;d.prototype.depth=0;d.prototype.toString=function(){return this.eval+"/"+this.depth};d.prototype.read=function(b,c){this.eval=c.V11();this.type=c.V11();this.depth=c.V11()};return d}();AnnoFactory[CB.AnnoType.FRITZ_EVAL]=CB.EvalAnno;
CB.TimeAnno=function(){var d=function(b){this.time=b||0};d.prototype.getString=function(){var b=this.time>>24,c=this.time>>16&255,e=this.time>>8&255,d=this.time&255,g="";0<b&&(g=b+":");0<c&&(10>c&&0<g.length&&(g+="0"),g+=c+":");10>e&&0<g.length&&(g+="0");0==c&&0==b&&10>e?(g+=e,b=Math.floor(d/10),0<b&&(g+="."+b)):(b=Math.round(e+d/50),60==b&&(b=59),g+=b);return g};d.prototype.fromCentiSecs=function(b){this.time=CB.TimeTools.getCBTimeOfCentiSecs(b)};d.prototype.toString=function(){return"Time: "+Math.round(this.getTimeIn100th()/
    100)+"s"};d.prototype.read=function(b,c){this.time=c.readBEInt32()};d.prototype.write=function(b){var c=AnnoRec.ANNO_HEAD_SIZE+4;b.Vi(c);AnnoRec.writeHeader(b,0,CB.AnnoType.TIME,c);b.writeBEInt32(this.time)};d.prototype.getTimeIn100th=function(){return 36E4*(this.time>>24)+6E3*(this.time>>16&255)+100*(this.time>>8&255)+(this.time&255)};return d}();AnnoFactory[CB.AnnoType.TIME]=CB.TimeAnno;
CB.TimeControlAnno=function(){var d=function(){};d.prototype.toString=function(){return"TC=NOTIMPL"};d.prototype.read=function(b,c){for(var e=0;e<b;e++)c.readByte()};return d}();AnnoFactory[CB.AnnoType.TIME_CONTROL]=CB.TimeControlAnno;
CB.SyncAnno=function(){var d=function(){this.data=[]};d.prototype.toString=function(){return"Sync"};d.prototype.read=function(b,c){for(var e=0;e<b;e++)this.data[e]=c.readByte()};d.prototype.write=function(b){var c=AnnoRec.ANNO_HEAD_SIZE+4;b.Vi(c);AnnoRec.writeHeader(b,0,CB.AnnoType.SYNC,c);var e=0;for(c=this.data.length;e<c;++e)b.writeByte(this.data[e])};return d}();AnnoFactory[CB.AnnoType.SYNC]=CB.SyncAnno;
CB.MoveMedalAnno=function(){var d=function(b){this.medal=b};d.prototype.toString=function(){return"Medal-"+this.medal};d.prototype.getString=function(){return this.toString()};d.prototype.getOneMedal=function(){return this.medal&CB.Medal.SACRIFICE?CB.Medal.SACRIFICE:this.medal&CB.Medal.ENDGAME?CB.Medal.ENDGAME:this.medal&CB.Medal.STRATEGY?CB.Medal.STRATEGY:this.medal&CB.Medal.TACTICAL_BLUNDER?CB.Medal.TACTICAL_BLUNDER:this.medal};d.prototype.read=function(b,c){this.medal=c.Vw()};d.prototype.write=
    function(b){var c=AnnoRec.ANNO_HEAD_SIZE+4;b.Vi(c);AnnoRec.writeHeader(b,0,CB.AnnoType.MOVE_MEDAL,c);b.Vh(this.medal)};return d}();AnnoFactory[CB.AnnoType.MOVE_MEDAL]=CB.MoveMedalAnno;
CB.EvalProfileAnno=function(){var d=function(b,c,e){this.first=b||0;this.last=c||0;this.evalArr=e||[];this.min=32767;this.max=-32767;this.detMinMax()};d.EV_INVALID=32767;d.prototype.detMinMax=function(){for(var b=0;b<this.evalArr.length;b++)this.evalArr[b]!=d.EV_INVALID&&(this.evalArr[b]>this.max&&(this.max=this.evalArr[b]),this.evalArr[b]<this.min&&(this.min=this.evalArr[b]))};d.prototype.range=function(){return Math.max(1,this.max-this.min)};d.prototype.toString=function(){return"MoveMedal"};d.prototype.isValid=
    function(){return this.last>this.first};d.prototype.read=function(b,c){this.evalArr=[];this.last=this.first=0;b=c.readBEInt16();if(600>b){for(var e=0;e<b;e++){var f=new ArrayBuffer(4),g=new DataView(f);g.setInt8(0,c.readByte());g.setInt8(1,c.readByte());g.setInt8(2,c.readByte());g.setInt8(3,c.readByte());f=g.getInt16(2);g.getInt8(1);g=g.getInt8(0);-1==g?this.evalArr.push(d.EV_INVALID):(1==g&&(f=0>f?-3E4+f:3E4-f),this.evalArr.push(f))}this.last=b-1}this.detMinMax()};d.readFactory=createReadFactory(d);
    d.prototype.write=function(b){var c=AnnoRec.ANNO_HEAD_SIZE+2+4*this.evalArr.length;b.Vi(c);AnnoRec.writeHeader(b,0,CB.AnnoType.EVAL_PROFILE,c);b.writeBEInt16(this.evalArr.length);for(c=0;c<this.evalArr.length;c++){var e=new ArrayBuffer(4);e=new DataView(e);this.evalArr[c]==d.EV_INVALID?(e.setInt8(0,255),e.setInt16(2,0)):(e.setInt8(0,0),e.setInt16(2,this.evalArr[c]));e.setInt8(1,0);b.writeBEInt32(e.getInt32(0))}};return d}();AnnoFactory[CB.AnnoType.EVAL_PROFILE]=CB.EvalProfileAnno;
CB.TrainingAnno=function(){var d=function(b){this.move=b;this.solved=!1;this.nHelpClicked=0;this.texts={};this.texts.en=={question:"",help:""}},b=["en","de","es","it"],c=[CB.Language.ENG,CB.Language.DEU,CB.Language.ESP,CB.Language.ITA];d.prototype.getQuestion=function(c){if(this.texts[c])return this.texts[c].question;for(c=0;c<b.length;c++)if(this.texts[b[c]])return this.texts[b[c]].question};d.prototype.getHelp=function(c){if(this.texts[c])return this.texts[c].help;for(c=0;c<b.length;c++)if(this.texts[b[c]])return this.texts[b[c]].help};
    d.prototype.toString=function(){return"Training"};d.prototype.decodeLocals=function(b){b.Vw();b.Vu();for(var c=b.Vu(),e=0;e<c&&10>e;e++){var d=this.decodeString(b),k=d.ln;k&&(this.texts[k]||(this.texts[k]={}),this.texts[k].question=d.str)}d=b.Vu();for(e=0;e<d&&10>e;e++)this.decodeString(b);c=b.Vu();for(e=0;e<c&&10>e;e++)if(d=this.decodeString(b),k=d.ln)this.texts[k]||(this.texts[k]={}),this.texts[k].help=d.str;d=b.Vu();for(e=0;e<d&&10>e;e++)this.decodeString(b)};d.prototype.readMoveInputItem=function(b){b.Vu();
        this.decodeLocals(b);for(var c=b.readByte(),e=0;e<c&&60>e;e++){var d=b.readByte(),k=b.readByte(),l=b.readByte();b.readByte();var m=b.Vu();0==e&&(this.move=new CB.Move(d,k,l));for(d=0;d<m;d++)this.decodeString(b)}};d.prototype.readMultipleChoiceItem=function(b){b.Vu();this.decodeLocals(b);for(var c=b.readByte(),e=0;e<c&&60>e;e++){b.readByte();for(var d=b.Vu(),k=0;k<d;k++)this.decodeString(b);d=b.Vu();for(k=0;k<d;k++)this.decodeString(b)}};d.prototype.read=function(b,c){c.Vu();switch(c.readByte()){case 1:this.readMoveInputItem(c);
        break;case 2:this.readMultipleChoiceItem(c)}};d.prototype.write=function(e){var d=new CB.DataBuffer;d.Vi(1);d.writeByte(1);var g=d.getPos();d.Vi(0);d.Vh(300);d.Vi(0);var h=d.getPos();d.Vi(0);for(var k=0,l=0;l<b.length;l++)this.texts[b[l]]&&this.texts[b[l]].question&&(k=this.encodeString(this.texts[b[l]].question,d,k,c[l]));d.writeAtPrevPos(h,function(){d.Vi(k)});d.Vi(0);var m=0;h=d.getPos();d.Vi(0);for(l=0;l<b.length;l++)this.texts[b[l]]&&this.texts[b[l]].help&&(m=this.encodeString(this.texts[b[l]].help,
        d,m,c[l]));d.writeAtPrevPos(h,function(){d.Vi(m)});d.Vi(0);d.writeByte(1);d.writeByte(this.move.from);d.writeByte(this.move.to);d.writeByte(this.move.prom);d.writeByte(5);d.Vi(0);var p=d.getPos();d.writeAtPrevPos(g,function(){d.Vi(p)});g=AnnoRec.ANNO_HEAD_SIZE+d.getSize();e.Vi(g);AnnoRec.writeHeader(e,0,CB.AnnoType.TRAINING,g);e.writeData(d)};d.prototype.decodeString=function(b){b.readByte();var c=b.readByte(),e=b.Vu();b=b.readSizedString(e);CB.strUtil.mayBeUtf8(b)&&(b=CB.strUtil.decodeUTF8(b));return{ln:CB.Language.getParamOfLanguageId(c),
        str:b}};d.prototype.encodeString=function(b,c,d,h){b&&(c.writeByte(h),c.writeByte(0),c.Vi(b.length),c.writeSizedString(b),d++);return d};return d}();AnnoFactory[CB.AnnoType.TRAINING]=CB.TrainingAnno;"use strict";
CB.SpecialGlyphs={NONE:0,GOOD_MOVE:1,BAD_MOVE:2,VERY_GOOD_MOVE:3,VERY_BAD_MOVE:4,SPECULATIVE_MOVE:5,DUBIOUS_MOVE:6,FORCED_MOVE:7,SINGULAR_MOVE:8,WORST_MOVE:9,DRAWN_POS:10,EQUAL_QUIET_POS:11,EQUAL_ACTIVE_POS:12,UNCLEAR_POS:13,W_SLIGHT_ADV:14,B_SLIGHT_ADV:15,W_MODER_ADV:16,B_MODER_ADV:17,W_DECIS_ADV:18,B_DECIS_ADV:19,W_CRASH_ADV:20,B_CRASH_ADV:21,W_ZUGZW:22,B_ZUGZW:23,W_SLIGHT_SPC:24,B_SLIGHT_SPC:25,W_MODER_SPC:26,B_MODER_SPC:27,W_DECIS_SPC:28,B_DECIS_SPC:29,W_SLIGHT_TEMP:30,B_SLIGHT_TEMP:31,W_MODER_TEMP:32,
    B_MODER_TEMP:33,W_DECIS_TEMP:34,B_DECIS_TEMP:35,W_INITIATIVE:36,B_INITIATIVE:37,W_LASTING_INITIATIVE:38,B_LASTING_INITIATIVE:39,W_ATTACK:40,B_ATTACK:41,W_INSUFF_COMP:42,B_INSUFF_COMP:43,W_SUFF_COMP:44,B_SUFF_COMP:45,W_GOOD_COMP:46,B_GOOD_COMP:47,W_SLIGHT_CENTER:48,B_SLIGHT_CENTER:49,W_MODER_CENTER:50,B_MODER_CENTER:51,W_DECIS_CENTER:52,B_DECIS_CENTER:53,W_SLIGHT_KS:54,B_SLIGHT_KS:55,W_MODER_KS:56,B_MODER_KS:57,W_DECIS_KS:58,B_DECIS_KS:59,W_SLIGHT_QS:60,B_SLIGHT_QS:61,W_MODER_QS:62,B_MODER_QS:63,W_DECIS_QS:64,
    B_DECIS_QS:65,W_BAD_FRST_RANK:66,B_BAD_FRST_RANK:67,W_GOOD_FRST_RANK:68,B_GOOD_FRST_RANK:69,W_BAD_PROTECTED_KING:70,B_BAD_PROTECTED_KING:71,W_GOOD_PROTECTED_KING:72,B_GOOD_PROTECTED_KING:73,W_BAD_PLACED_KING:74,B_BAD_PLACED_KING:75,W_GOOD_PLACED_KING:76,B_GOOD_PLACED_KING:77,W_VERY_WEAK_PAWNS:78,B_VERY_WEAK_PAWNS:79,W_MODER_WEAK_PAWNS:80,B_MODER_WEAK_PAWNS:81,W_MODER_STRONG_PAWNS:82,B_MODER_STRONG_PAWNS:83,W_VERY_STRONG_PAWNS:84,B_VERY_STRONG_PAWNS:85,W_BAD_KNIGHT:86,B_BAD_KNIGHT:87,W_GOOD_KNIGHT:88,
    B_GOOD_KNIGHT:89,W_BAD_BISHOP:90,B_BAD_BISHOP:91,W_GOOD_BISHOP:92,B_GOOD_BISHOP:93,W_BAD_ROOK:94,B_BAD_ROOK:95,W_GOOD_ROOK:96,B_GOOD_ROOK:97,W_BAD_QUEEN:98,B_BAD_QUEEN:99,W_GOOD_QUEEN:100,B_GOOD_QUEEN:101,W_BAD_PIECES:102,B_BAD_PIECES:103,W_GOOD_PIECES:104,B_GOOD_PIECES:105,W_OP_VERY_BAD:106,B_OP_VERY_BAD:107,W_OP_BAD:108,B_OP_BAD:109,W_OP_GOOD:110,B_OP_GOOD:111,W_OP_VERY_GOOD:112,B_OP_VERY_GOOD:113,W_MG_VERY_BAD:114,B_MG_VERY_BAD:115,W_MG_BAD:116,B_MG_BAD:117,W_MG_GOOD:118,B_MG_GOOD:119,W_MG_VERY_GOOD:120,
    B_MG_VERY_GOOD:121,W_EG_VERY_BAD:122,B_EG_VERY_BAD:123,W_EG_BAD:124,B_EG_BAD:125,W_EG_GOOD:126,B_EG_GOOD:127,W_EG_VERY_GOOD:128,B_EG_VERY_GOOD:129,W_SLIGHT_COUNTER:130,B_SLIGHT_COUNTER:131,W_MODER_COUNTER:132,B_MODER_COUNTER:133,W_DECIS_COUNTER:134,B_DECIS_COUNTER:135,W_MODER_ZEITNOT:136,B_MODER_ZEITNOT:137,W_SEVERE_ZEITNOT:138,B_SEVERE_ZEITNOT:139,WITH_IDEA:140,AIMED_AGAINST:141,BETTER_IS:142,WORSE_IS:143,EQUAL_IS:144,EDITORS_MARK:145,NOVELTY:146,WEAK_POINT:147,ENDGAME:148,LINE:149,DIAGONAL:150,
    W_BISHOP_PAIR:151,B_BISHOP_PAIR:152,OPP_COLOR_BISHOPS:153,SAME_COLOR_BISHOPS:154,W_UNITED_PAWNS:155,B_UNITED_PAWNS:156,W_SEPARATE_PAWNS:157,B_SEPARATE_PAWNS:158,W_DOUBLE_PAWNS:159,B_DOUBLE_PAWNS:160,W_PASSED_PAWNS:161,B_PASSED_PAWNS:162,W_MORE_PAWNS:163,B_MORE_PAWNS:164,MY_MOVE:165,IMPORTANT:166,WHITE:167,BLACK:168,BOTH:169};var Vp={};Vp[CB.SpecialGlyphs.NONE]="";Vp[CB.SpecialGlyphs.GOOD_MOVE]="!";Vp[CB.SpecialGlyphs.BAD_MOVE]="?";Vp[CB.SpecialGlyphs.VERY_GOOD_MOVE]="\u203c";
Vp[CB.SpecialGlyphs.VERY_BAD_MOVE]="??";Vp[CB.SpecialGlyphs.SPECULATIVE_MOVE]="!?";Vp[CB.SpecialGlyphs.DUBIOUS_MOVE]="?!";Vp[CB.SpecialGlyphs.FORCED_MOVE]="!";Vp[CB.SpecialGlyphs.SINGULAR_MOVE]="\ue021";Vp[CB.SpecialGlyphs.WORST_MOVE]="";Vp[CB.SpecialGlyphs.DRAWN_POS]="=";Vp[CB.SpecialGlyphs.EQUAL_QUIET_POS]="=";Vp[CB.SpecialGlyphs.EQUAL_ACTIVE_POS]="=";Vp[CB.SpecialGlyphs.UNCLEAR_POS]="\u221e";Vp[CB.SpecialGlyphs.W_SLIGHT_ADV]="\ue02f";Vp[CB.SpecialGlyphs.B_SLIGHT_ADV]="\ue02e";
Vp[CB.SpecialGlyphs.W_MODER_ADV]="\u00b1";Vp[CB.SpecialGlyphs.B_MODER_ADV]="\ue01a";Vp[CB.SpecialGlyphs.W_DECIS_ADV]="+-";Vp[CB.SpecialGlyphs.B_DECIS_ADV]="-+";Vp[CB.SpecialGlyphs.W_CRASH_ADV]="+-";Vp[CB.SpecialGlyphs.B_CRASH_ADV]="-+";Vp[CB.SpecialGlyphs.W_ZUGZW]="\ue01d";Vp[CB.SpecialGlyphs.B_ZUGZW]="\ue01d";Vp[CB.SpecialGlyphs.W_SLIGHT_SPC]="\ue023";Vp[CB.SpecialGlyphs.B_SLIGHT_SPC]="\ue023";Vp[CB.SpecialGlyphs.W_MODER_SPC]="\ue023";Vp[CB.SpecialGlyphs.B_MODER_SPC]="\ue023";
Vp[CB.SpecialGlyphs.W_DECIS_SPC]="\ue023";Vp[CB.SpecialGlyphs.B_DECIS_SPC]="\ue023";Vp[CB.SpecialGlyphs.W_SLIGHT_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.B_SLIGHT_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.W_MODER_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.B_MODER_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.W_DECIS_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.B_DECIS_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.W_INITIATIVE]="\ue012";Vp[CB.SpecialGlyphs.B_INITIATIVE]="\ue012";Vp[CB.SpecialGlyphs.W_LASTING_INITIATIVE]="\ue012";
Vp[CB.SpecialGlyphs.B_LASTING_INITIATIVE]="\ue012";Vp[CB.SpecialGlyphs.W_ATTACK]="\ue013";Vp[CB.SpecialGlyphs.B_ATTACK]="\ue013";Vp[CB.SpecialGlyphs.W_INSUFF_COMP]="\ue004\ue000";Vp[CB.SpecialGlyphs.B_INSUFF_COMP]="\ue004\ue000";Vp[CB.SpecialGlyphs.W_SUFF_COMP]="\ue000";Vp[CB.SpecialGlyphs.B_SUFF_COMP]="\ue000";Vp[CB.SpecialGlyphs.W_GOOD_COMP]="\ue000";Vp[CB.SpecialGlyphs.B_GOOD_COMP]="\ue000";Vp[CB.SpecialGlyphs.W_SLIGHT_CENTER]="\ue01e";Vp[CB.SpecialGlyphs.B_SLIGHT_CENTER]="\ue01e";
Vp[CB.SpecialGlyphs.W_MODER_CENTER]="\ue01e";Vp[CB.SpecialGlyphs.B_MODER_CENTER]="\ue01e";Vp[CB.SpecialGlyphs.W_DECIS_CENTER]="\ue01e";Vp[CB.SpecialGlyphs.B_DECIS_CENTER]="\ue01e";Vp[CB.SpecialGlyphs.W_SLIGHT_KS]="\ue00f";Vp[CB.SpecialGlyphs.B_SLIGHT_KS]="\ue00f";Vp[CB.SpecialGlyphs.W_MODER_KS]="\ue00f";Vp[CB.SpecialGlyphs.B_MODER_KS]="\ue00f";Vp[CB.SpecialGlyphs.W_DECIS_KS]="\ue00f";Vp[CB.SpecialGlyphs.B_DECIS_KS]="\ue00f";Vp[CB.SpecialGlyphs.W_SLIGHT_QS]="\ue00e";
Vp[CB.SpecialGlyphs.B_SLIGHT_QS]="\ue00e";Vp[CB.SpecialGlyphs.W_MODER_QS]="\ue00e";Vp[CB.SpecialGlyphs.B_MODER_QS]="\ue00e";Vp[CB.SpecialGlyphs.W_DECIS_QS]="\ue00e";Vp[CB.SpecialGlyphs.B_DECIS_QS]="\ue00e";Vp[CB.SpecialGlyphs.W_BAD_FRST_RANK]="\ue010\ue0181";Vp[CB.SpecialGlyphs.B_BAD_FRST_RANK]="\ue010\ue0188";Vp[CB.SpecialGlyphs.W_GOOD_FRST_RANK]="";Vp[CB.SpecialGlyphs.B_GOOD_FRST_RANK]="";Vp[CB.SpecialGlyphs.W_BAD_PROTECTED_KING]="\ue010\ue024";Vp[CB.SpecialGlyphs.B_BAD_PROTECTED_KING]="\ue010\ue024";
Vp[CB.SpecialGlyphs.W_GOOD_PROTECTED_KING]="";Vp[CB.SpecialGlyphs.B_GOOD_PROTECTED_KING]="";Vp[CB.SpecialGlyphs.W_BAD_PLACED_KING]="\ue010\ue024";Vp[CB.SpecialGlyphs.B_BAD_PLACED_KING]="\ue010\ue024";Vp[CB.SpecialGlyphs.W_GOOD_PLACED_KING]="";Vp[CB.SpecialGlyphs.B_GOOD_PLACED_KING]="";Vp[CB.SpecialGlyphs.W_VERY_WEAK_PAWNS]="\ue010\ue029";Vp[CB.SpecialGlyphs.B_VERY_WEAK_PAWNS]="\ue010\ue029";Vp[CB.SpecialGlyphs.W_MODER_WEAK_PAWNS]="\ue010\ue029";Vp[CB.SpecialGlyphs.B_MODER_WEAK_PAWNS]="\ue010\ue029";
Vp[CB.SpecialGlyphs.W_MODER_STRONG_PAWNS]="";Vp[CB.SpecialGlyphs.B_MODER_STRONG_PAWNS]="";Vp[CB.SpecialGlyphs.W_VERY_STRONG_PAWNS]="";Vp[CB.SpecialGlyphs.B_VERY_STRONG_PAWNS]="";Vp[CB.SpecialGlyphs.W_BAD_KNIGHT]="\ue010\ue028";Vp[CB.SpecialGlyphs.B_BAD_KNIGHT]="\ue010\ue028";Vp[CB.SpecialGlyphs.W_GOOD_KNIGHT]="";Vp[CB.SpecialGlyphs.B_GOOD_KNIGHT]="";Vp[CB.SpecialGlyphs.W_BAD_BISHOP]="\ue010\ue027";Vp[CB.SpecialGlyphs.B_BAD_BISHOP]="\ue010\ue027";Vp[CB.SpecialGlyphs.W_GOOD_BISHOP]="";
Vp[CB.SpecialGlyphs.B_GOOD_BISHOP]="";Vp[CB.SpecialGlyphs.W_BAD_ROOK]="\ue010\ue026";Vp[CB.SpecialGlyphs.B_BAD_ROOK]="\ue010\ue026";Vp[CB.SpecialGlyphs.W_GOOD_ROOK]="";Vp[CB.SpecialGlyphs.B_GOOD_ROOK]="";Vp[CB.SpecialGlyphs.W_BAD_QUEEN]="\ue010\ue025";Vp[CB.SpecialGlyphs.B_BAD_QUEEN]="\ue010\ue025";Vp[CB.SpecialGlyphs.W_GOOD_QUEEN]="";Vp[CB.SpecialGlyphs.B_GOOD_QUEEN]="";Vp[CB.SpecialGlyphs.W_BAD_PIECES]="";Vp[CB.SpecialGlyphs.B_BAD_PIECES]="";Vp[CB.SpecialGlyphs.W_GOOD_PIECES]="";
Vp[CB.SpecialGlyphs.B_GOOD_PIECES]="";Vp[CB.SpecialGlyphs.W_OP_VERY_BAD]="";Vp[CB.SpecialGlyphs.B_OP_VERY_BAD]="";Vp[CB.SpecialGlyphs.W_OP_BAD]="";Vp[CB.SpecialGlyphs.B_OP_BAD]="";Vp[CB.SpecialGlyphs.W_OP_GOOD]="";Vp[CB.SpecialGlyphs.B_OP_GOOD]="";Vp[CB.SpecialGlyphs.W_OP_VERY_GOOD]="";Vp[CB.SpecialGlyphs.B_OP_VERY_GOOD]="";Vp[CB.SpecialGlyphs.W_MG_VERY_BAD]="";Vp[CB.SpecialGlyphs.B_MG_VERY_BAD]="";Vp[CB.SpecialGlyphs.W_MG_BAD]="";Vp[CB.SpecialGlyphs.B_MG_BAD]="";Vp[CB.SpecialGlyphs.W_MG_GOOD]="";
Vp[CB.SpecialGlyphs.B_MG_GOOD]="";Vp[CB.SpecialGlyphs.W_MG_VERY_GOOD]="";Vp[CB.SpecialGlyphs.B_MG_VERY_GOOD]="";Vp[CB.SpecialGlyphs.W_EG_VERY_BAD]="\ue010\ue01f";Vp[CB.SpecialGlyphs.B_EG_VERY_BAD]="\ue010\ue01f";Vp[CB.SpecialGlyphs.W_EG_BAD]="\ue010\ue01f";Vp[CB.SpecialGlyphs.B_EG_BAD]="\ue010\ue01f";Vp[CB.SpecialGlyphs.W_EG_GOOD]="";Vp[CB.SpecialGlyphs.B_EG_GOOD]="";Vp[CB.SpecialGlyphs.W_EG_VERY_GOOD]="";Vp[CB.SpecialGlyphs.B_EG_VERY_GOOD]="";Vp[CB.SpecialGlyphs.W_SLIGHT_COUNTER]="\ue017";
Vp[CB.SpecialGlyphs.B_SLIGHT_COUNTER]="\ue017";Vp[CB.SpecialGlyphs.W_MODER_COUNTER]="\ue017";Vp[CB.SpecialGlyphs.B_MODER_COUNTER]="\ue017";Vp[CB.SpecialGlyphs.W_DECIS_COUNTER]="\ue017";Vp[CB.SpecialGlyphs.B_DECIS_COUNTER]="\ue017";Vp[CB.SpecialGlyphs.W_MODER_ZEITNOT]="\ue01c";Vp[CB.SpecialGlyphs.B_MODER_ZEITNOT]="\ue01c";Vp[CB.SpecialGlyphs.W_SEVERE_ZEITNOT]="\ue01c";Vp[CB.SpecialGlyphs.B_SEVERE_ZEITNOT]="\ue01c";Vp[CB.SpecialGlyphs.WITH_IDEA]="\u2206";Vp[CB.SpecialGlyphs.AIMED_AGAINST]="\ue022";
Vp[CB.SpecialGlyphs.BETTER_IS]="\ue020";Vp[CB.SpecialGlyphs.WORSE_IS]="\u2264";Vp[CB.SpecialGlyphs.EQUAL_IS]="=";Vp[CB.SpecialGlyphs.EDITORS_MARK]="RR";Vp[CB.SpecialGlyphs.NOVELTY]="N";Vp[CB.SpecialGlyphs.WEAK_POINT]="\ue010";Vp[CB.SpecialGlyphs.ENDGAME]="\ue01f";Vp[CB.SpecialGlyphs.LINE]="\ue018";Vp[CB.SpecialGlyphs.DIAGONAL]="\ue019";Vp[CB.SpecialGlyphs.W_BISHOP_PAIR]="\ue001";Vp[CB.SpecialGlyphs.B_BISHOP_PAIR]="\ue001";Vp[CB.SpecialGlyphs.OPP_COLOR_BISHOPS]="\ue002";
Vp[CB.SpecialGlyphs.SAME_COLOR_BISHOPS]="\ue003";Vp[CB.SpecialGlyphs.W_UNITED_PAWNS]="\ue02b";Vp[CB.SpecialGlyphs.B_UNITED_PAWNS]="\ue02b";Vp[CB.SpecialGlyphs.W_SEPARATE_PAWNS]="\ue02c";Vp[CB.SpecialGlyphs.B_SEPARATE_PAWNS]="\ue02c";Vp[CB.SpecialGlyphs.W_DOUBLE_PAWNS]="\ue007";Vp[CB.SpecialGlyphs.B_DOUBLE_PAWNS]="\ue007";Vp[CB.SpecialGlyphs.W_PASSED_PAWNS]="\ue008";Vp[CB.SpecialGlyphs.B_PASSED_PAWNS]="\ue008";Vp[CB.SpecialGlyphs.W_MORE_PAWNS]=">";Vp[CB.SpecialGlyphs.B_MORE_PAWNS]=">";
Vp[CB.SpecialGlyphs.MY_MOVE]="*";Vp[CB.SpecialGlyphs.IMPORTANT]="**";Vp[CB.SpecialGlyphs.WHITE]="";Vp[CB.SpecialGlyphs.BLACK]="";Vp[CB.SpecialGlyphs.BOTH]="";var PieceGlyphs={};PieceGlyphs[CB.Piece.PAWN]="\ue029";PieceGlyphs[CB.Piece.KNIGHT]="\ue028";PieceGlyphs[CB.Piece.BISHOP]="\ue027";PieceGlyphs[CB.Piece.ROOK]="\ue026";PieceGlyphs[CB.Piece.QUEEN]="\ue025";PieceGlyphs[CB.Piece.KING]="\ue024";var V2={};V2[CB.Piece.PAWN]="\u2659";V2[CB.Piece.KNIGHT]="\u2658";V2[CB.Piece.BISHOP]="\u2657";
V2[CB.Piece.ROOK]="\u2656";V2[CB.Piece.QUEEN]="\u2655";V2[CB.Piece.KING]="\u2654";Vp.getText=function(d){return Vp[d]};Vp.addTexts=function(d,b){var c={};c[GlyphType.MOVE_GLYPH]=c[GlyphType.PRE_GLYPH]=c[GlyphType.POST_GLYPH]="";for(var e=0,f=b.length;e<f;++e){var g=b[e],h=Vp.getText(g);c[GlyphType.getType(g)]+=h}return c[GlyphType.PRE_GLYPH]+d+c[GlyphType.MOVE_GLYPH]+c[GlyphType.POST_GLYPH]};CB.V4=ObjUtil.clone(CB.V1);CB.V4.arrStrPieces[CB.Piece.W_KING]=CB.V4.arrStrPieces[CB.Piece.B_KING]=PieceGlyphs[CB.Piece.KING];
CB.V4.arrStrPieces[CB.Piece.W_QUEEN]=CB.V4.arrStrPieces[CB.Piece.B_QUEEN]=PieceGlyphs[CB.Piece.QUEEN];CB.V4.arrStrPieces[CB.Piece.W_ROOK]=CB.V4.arrStrPieces[CB.Piece.B_ROOK]=PieceGlyphs[CB.Piece.ROOK];CB.V4.arrStrPieces[CB.Piece.W_BISHOP]=CB.V4.arrStrPieces[CB.Piece.B_BISHOP]=PieceGlyphs[CB.Piece.BISHOP];CB.V4.arrStrPieces[CB.Piece.W_KNIGHT]=CB.V4.arrStrPieces[CB.Piece.B_KNIGHT]=PieceGlyphs[CB.Piece.KNIGHT];CB.V4.arrStrPieces[CB.Piece.W_PAWN]=CB.V4.arrStrPieces[CB.Piece.B_PAWN]="";CB.UnicodeV4=ObjUtil.clone(CB.V1);
CB.UnicodeV4.arrStrPieces[CB.Piece.W_KING]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_KING]=V2[CB.Piece.KING];CB.UnicodeV4.arrStrPieces[CB.Piece.W_QUEEN]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_QUEEN]=V2[CB.Piece.QUEEN];CB.UnicodeV4.arrStrPieces[CB.Piece.W_ROOK]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_ROOK]=V2[CB.Piece.ROOK];CB.UnicodeV4.arrStrPieces[CB.Piece.W_BISHOP]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_BISHOP]=V2[CB.Piece.BISHOP];
CB.UnicodeV4.arrStrPieces[CB.Piece.W_KNIGHT]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_KNIGHT]=V2[CB.Piece.KNIGHT];CB.UnicodeV4.arrStrPieces[CB.Piece.W_PAWN]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_PAWN]="";
var GlyphType={PRE_GLYPH:0,MOVE_GLYPH:1,POST_GLYPH:2,getType:function(d){return d<=CB.SpecialGlyphs.WORST_MOVE||d>=CB.SpecialGlyphs.MY_MOVE&&d<=CB.SpecialGlyphs.BOTH||d===CB.SpecialGlyphs.W_ZUGZW||d===CB.SpecialGlyphs.B_ZUGZW?GlyphType.MOVE_GLYPH:d<=CB.SpecialGlyphs.B_SEVERE_ZEITNOT||d>=CB.SpecialGlyphs.NOVELTY?GlyphType.POST_GLYPH:GlyphType.PRE_GLYPH}};NotationLocalizations.glyphs=CB.V4;NotationLocalizations.uglyphs=CB.UnicodeV4;"use strict";
CB.TokenType={NONE:0,UNKNOWN:1,EOF:2,HEAD_OP:3,HEAD_CL:4,STR_VAR:5,STR_VAL:6,COMMENT:7,VAR_OP:8,VAR_CL:9,RES_STAR:10,RES_1_0:11,RES_0_1:12,RES_1_2:13,BUCK:14,CHECK:15,MATE:16,MOVE:17,ROCHADE:18,NULLMOVE:19,NUM:20,DOT:21,LONG_ROCHADE:22,SHORT_ROCHADE:23,BAD:24,VERY_BAD:25,GOOD:26,VERY_GOOD:27,BAD_GOOD:28,GOOD_BAD:29};function Token(d,b){this.type=d;b&&(this.str=b)}Token.prototype.type=CB.TokenType.UNKNOWN;Token.prototype.str="";
Token.prototype.toString=function(){var d=EnumToString(CB.TokenType,this.type);this.str&&(d+="("+this.str+")");return d};function V9(d){this.m_it=new StringIterator(d);this.m_it.Next()}V9.prototype.m_it=new StringIterator("");V9.prototype.m_inHeader=!1;
V9.prototype.nextToken=function(){this.m_it.skipWhile(Char.IsWhiteSpace,!0);if(this.m_it.isEOF())return new Token(CB.TokenType.EOF);var d=this.m_it.Current();this.m_it.Next();switch(d){case "X":case "#":return new Token(CB.TokenType.MATE);case "+":return new Token(CB.TokenType.CHECK);case "$":return new Token(CB.TokenType.BUCK);case "*":return new Token(CB.TokenType.RES_STAR,d);case "[":return this.m_inHeader=!0,new Token(CB.TokenType.HEAD_OP);case "]":return this.m_inHeader=!1,new Token(CB.TokenType.HEAD_CL);
    case "(":return new Token(CB.TokenType.VAR_OP);case ")":return new Token(CB.TokenType.VAR_CL);case ".":return new Token(CB.TokenType.DOT)}if(this.m_inHeader){if(Char.IsLetterOrDigit(d))return d+=this.m_it.AcceptWhile(Char.IsLetterOrDigit,!0),new Token(CB.TokenType.STR_VAR,d);if('"'===d)return d=this.m_it.AcceptUntil(Char.getIsChar("]"),!0),d=d.trim(),'"'===d.charAt(d.length-1)&&(d=d.slice(0,d.length-1)),new Token(CB.TokenType.STR_VAL,d)}if("{"===d)return d=this.m_it.AcceptUntil(Char.getIsChar("}"),
    !0),this.m_it.skipWhile(Char.getIsChar("}"),!0),new Token(CB.TokenType.COMMENT,d);if("0"===d){if(this.m_it.AcceptStr("-0-0",!0))return new Token(CB.TokenType.LONG_ROCHADE);if(this.m_it.AcceptStr("-0",!0))return new Token(CB.TokenType.SHORT_ROCHADE);if(this.m_it.AcceptStr("-1",!0))return new Token(CB.TokenType.RES_0_1)}if("O"===d){if(this.m_it.AcceptStr("-O-O",!0))return new Token(CB.TokenType.LONG_ROCHADE);if(this.m_it.AcceptStr("-O",!0))return new Token(CB.TokenType.SHORT_ROCHADE)}if("1"===d){if(this.m_it.AcceptStr("-0",
    !0))return new Token(CB.TokenType.RES_1_0);if(this.m_it.AcceptStr("/2-1/2",!0))return new Token(CB.TokenType.RES_1_2)}return Char.IsDigit(d)?(d+=this.m_it.AcceptWhile(Char.IsDigit,!0),new Token(CB.TokenType.NUM,d)):"-"===d&&this.m_it.AcceptChar("-",!0)?new Token(CB.TokenType.NULLMOVE):"?"===d?this.m_it.AcceptChar("?",!0)?new Token(CB.TokenType.VERY_BAD):this.m_it.AcceptChar("!",!0)?new Token(CB.TokenType.BAD_GOOD):new Token(CB.TokenType.BAD):"!"===d?this.m_it.AcceptChar("?",!0)?new Token(CB.TokenType.GOOD_BAD):
    this.m_it.AcceptChar("!",!0)?new Token(CB.TokenType.VERY_GOOD):new Token(CB.TokenType.GOOD):"Z"===d&&this.m_it.AcceptChar("0",!0)?new Token(CB.TokenType.NULLMOVE):V9.isMoveChar(d)?(d+=this.m_it.AcceptWhile(V9.isMoveChar,!0),new Token(CB.TokenType.MOVE,d)):new Token(CB.TokenType.UNKNOWN,d)};V9.isMoveChar=function(d){return"a"<=d&&"h">=d||"1"<=d&&"8">=d||"x"===d||"="===d||Char.IsUpperCaseLetter(d)&&CB.Piece.fromString(d)!==CB.Piece.NONE};
CB.PGNLexer=function(){var d=function(b){this.m_stm=new V9(b);this.m_last=null};d.prototype.peek=function(b){this.m_last||(this.m_last=this.m_stm.nextToken());return b&&b(this.m_last.type)?this.m_last:null};d.getIsType=function(b){return function(c){return c===b}};d.prototype.pop=function(b){if(b=this.peek(b))this.m_last=null;return b};d.prototype.popT=function(b){return this.pop(d.getIsType(b))};d.prototype.peekT=function(b){return this.peek(d.getIsType(b))};return d}();"use strict";
function PGNSubLine(){}PGNSubLine.prototype=[];
CB.PGNMove=function(){var d=function(b){this.m_strMove=null;this.m_isTake=this.m_isNullMove=this.m_isLongCastle=this.m_isShortCastle=this.m_isMate=this.m_isCheck=!1;this.m_prom=this.m_mvd=CB.Piece.NONE;this.m_to=this.m_rowTo=this.m_colTo=this.m_rowFrom=this.m_colFrom=-1;b&&(this.m_strMove=b,this.init(b))};d.g_regex=/^(K|Q|R|N|B)?([a-h]?)([1-8]?)(x?)([a-h])([1-8])(?:=?(K|Q|R|N|B))?$/;d.prototype.init=function(b){d.g_regex.exec(b)&&(this.m_mvd=CB.Piece.fromString(RegExp.$1),this.m_mvd=CB.Piece.nominal(this.m_mvd),
RegExp.$2&&(this.m_colFrom=CB.Square.colFromString(RegExp.$2)),RegExp.$3&&(this.m_rowFrom=CB.Square.rowFromString(RegExp.$3)),RegExp.$4&&(this.m_isTake=!0),RegExp.$5&&(this.m_colTo=CB.Square.colFromString(RegExp.$5)),RegExp.$6&&(this.m_rowTo=CB.Square.rowFromString(RegExp.$6)),RegExp.$7&&(this.m_prom=CB.Piece.fromString(RegExp.$7),this.m_prom=CB.Piece.nominal(this.m_prom)),0>this.m_rowFrom&&this.m_mvd===CB.Piece.NONE&&(this.m_mvd=CB.Piece.PAWN),0<=this.m_colTo&&0<=this.m_rowTo&&(this.m_to=CB.Square.I(this.m_colTo,
    this.m_rowTo)))};d.prototype.setNullMove=function(){this.m_isNullMove=!0};d.prototype.isNullMove=function(){return this.m_isNullMove};d.prototype.setLongCastling=function(){this.m_isLongCastle=!0};d.prototype.isLongCastling=function(){return this.m_isLongCastle};d.prototype.setShortCastling=function(){this.m_isShortCastle=!0};d.prototype.isShortCastling=function(){return this.m_isShortCastle};d.prototype.setCheck=function(b){this.m_isCheck=b};d.prototype.setMate=function(b){this.m_isMate=b};d.prototype.isTake=
    function(){return this.m_isTake};d.prototype.matches=function(b){var c=b.from;return this.m_to!==b.to||this.m_mvd!==CB.Piece.NONE&&(b=b.getMoved(),CB.Piece.nominal(b)!==this.m_mvd)?!1:this.matchesFrom(c)};d.prototype.matchesFrom=function(b){return 0<=this.m_colFrom&&this.m_colFrom!==CB.Square.C(b)||0<=this.m_rowFrom&&this.m_rowFrom!==CB.Square.R(b)?!1:!0};d.prototype.getMoved=function(){return this.m_mvd};d.prototype.getTo=function(){return this.m_to};d.prototype.getProm=function(){return this.m_prom};
    return d}();CB.PGNComment=function(){var d=function(b){this.m_strComment=b};d.prototype.m_strComment="";d.prototype.getComment=function(){return this.m_strComment};return d}();function PGNGlyph(d){this.m_glyph=d}PGNGlyph.prototype.m_glyph=0;PGNGlyph.prototype.getGlyph=function(){return this.m_glyph};function PGNMoveNum(d,b){this.m_num=d;this.m_isBlack=b}function PGNGame(){this.m_hdrs={};this.m_mainLine=new PGNSubLine}PGNGame.prototype.m_hdrs={};PGNGame.prototype.m_mainLine=new PGNSubLine;
PGNGame.prototype.getHeaders=function(){return this.m_hdrs};PGNGame.prototype.getMainLine=function(){return this.m_mainLine};
CB.PGNParser=function(){function d(b){switch(b){case CB.TokenType.BAD:return CB.SpecialGlyphs.BAD_MOVE;case CB.TokenType.BAD_GOOD:return CB.SpecialGlyphs.DUBIOUS_MOVE;case CB.TokenType.GOOD:return CB.SpecialGlyphs.GOOD_MOVE;case CB.TokenType.GOOD_BAD:return CB.SpecialGlyphs.SPECULATIVE_MOVE;case CB.TokenType.VERY_GOOD:return CB.SpecialGlyphs.VERY_GOOD_MOVE;case CB.TokenType.VERY_BAD:return CB.SpecialGlyphs.VERY_BAD_MOVE;default:return CB.SpecialGlyphs.NONE}}function b(b){return d(b)!==CB.SpecialGlyphs.NONE}
    var c=function(b){this.m_lexer=b?b:new CB.PGNLexer("")};c.prototype.acceptGame=function(){var b=new PGNGame;return this.acceptHeaders(b.m_hdrs)&&this.acceptGameNotation(b)?b:null};c.prototype.acceptGameNoMoves=function(){var b=new PGNGame;return this.acceptHeaders(b.m_hdrs)?b:null};c.prototype.acceptGameNotation=function(b){this.acceptNotation(b.m_mainLine);var c=this.acceptResult();null!=c&&(b.m_hdrs.result=c);return!0};c.isResultTokenType=function(b){return b===CB.TokenType.RES_0_1||b===CB.TokenType.RES_1_0||
        b===CB.TokenType.RES_1_2||b===CB.TokenType.RES_STAR};c.prototype.acceptResult=function(){var b=this.m_lexer.pop(c.isResultTokenType);if(b)switch(b.type){case CB.TokenType.RES_0_1:return CB.GameResultEnum.BLACK_WINS;case CB.TokenType.RES_1_0:return CB.GameResultEnum.WHITE_WINS;case CB.TokenType.RES_1_2:return CB.GameResultEnum.DRAW;case CB.TokenType.RES_STAR:return CB.GameResultEnum.LINE}return null};c.prototype.acceptNotation=function(b){for(var c=this.acceptNotaElem();null!=c;c=this.acceptNotaElem())b.push(c);
        return!0};c.prototype.acceptNotaElem=function(){var b=this.acceptMoveNum();return b||(b=this.acceptMove())||(b=this.acceptGlyph())||(b=this.acceptSubLine())?b:(b=this.acceptComment())?b:null};c.prototype.acceptGlyph=function(){if(this.m_lexer.popT(CB.TokenType.BUCK)){var c=this.m_lexer.popT(CB.TokenType.NUM);return new PGNGlyph(Number(c.str))}return(c=this.m_lexer.pop(b))?(c=d(c.type),new PGNGlyph(c)):null};c.prototype.acceptSubLine=function(){if(this.m_lexer.popT(CB.TokenType.VAR_OP)){var b=new PGNSubLine;
        this.acceptNotation(b);this.m_lexer.popT(CB.TokenType.VAR_CL);return b}return null};c.prototype.acceptComment=function(){var b=this.m_lexer.popT(CB.TokenType.COMMENT);return b?new CB.PGNComment(b.str):null};c.prototype.acceptMoveNum=function(){var b=this.m_lexer.popT(CB.TokenType.NUM);if(b){for(var c=0;this.m_lexer.popT(CB.TokenType.DOT);)++c;return new PGNMoveNum(Number(b.str),1<c)}return null};c.isMoveTokenType=function(b){return b===CB.TokenType.MOVE||b===CB.TokenType.LONG_ROCHADE||b===CB.TokenType.SHORT_ROCHADE||
        b===CB.TokenType.NULLMOVE};c.prototype.acceptMove=function(){var b=this.m_lexer.pop(c.isMoveTokenType);if(b){var e=new CB.PGNMove;switch(b.type){case CB.TokenType.MOVE:e.init(b.str);break;case CB.TokenType.LONG_ROCHADE:e.setLongCastling();break;case CB.TokenType.SHORT_ROCHADE:e.setShortCastling();break;case CB.TokenType.NULLMOVE:e.setNullMove()}if(b.type!==CB.TokenType.NULLMOVE){b=null!=this.m_lexer.popT(CB.TokenType.CHECK);var d=!1;b||(d=null!=this.m_lexer.popT(CB.TokenType.MATE));e.setCheck(b);
        e.setMate(d)}return e}return null};c.prototype.acceptHeaders=function(b){for(;this.acceptHeader(b););return!0};c.prototype.acceptHeader=function(b){if(this.m_lexer.popT(CB.TokenType.HEAD_OP)){var c=this.m_lexer.popT(CB.TokenType.STR_VAR),e=this.m_lexer.popT(CB.TokenType.STR_VAL);this.m_lexer.popT(CB.TokenType.HEAD_CL);c=c.str.toLowerCase();b[c]=e.str;return!0}return!1};c.toColSq=function(b){for(var c=new CB.ColSqAnno,e=0,d=b.length;e<d;++e){var f=b[e],m=new CB.ColSq;m.init(f);c.push(m)}return c};
    c.toColArrow=function(b){for(var c=new CB.ColArrowAnno,e=0,d=b.length;e<d;++e){var f=b[e],m=new CB.ColArrow;m.init(f);c.push(m)}return c};c.toDiag=function(b){var c="";0<b.length&&(c=b[0]);return new CB.TextAnno(c)};c.toTime=function(b){b=b[0].split(":");b=3600*Number(b[0])+60*Number(b[1])+Number(b[2]);var c=new CB.TimeAnno;c.fromCentiSecs(100*b);return c};c.toEval=function(b){var c=.01*Number(b[0]),e=0;1<b.length&&(e=Number(b[1]));return new CB.EvalAnno(c,e)};c.toTraining=function(b){var c=new CB.TrainingAnno;
        if(7<=b.length&&2==b[0].length){c.move=b[4];for(var e=0;e<b.length/7;e++)2==b[7*e].length&&(c.texts[b[7*e].toLowerCase()]={question:b[7*e+1],help:b[7*e+2]})}else c.move=b[3],c.texts.en={question:b[0],help:b[1]};c.fromPGN=!0;return c};c.toEvalProfile=function(b){var c=[];if(3<b.length){for(var e=parseInt(b[0]),d=parseInt(b[1]),f=0;f<d-e+1;f++)c.push(parseInt(b[f+2]));b=new CB.EvalProfileAnno(e,d,c);b.fromPGN=!0;return b}};c.toMedal=function(b){return new CB.MoveMedalAnno(parseInt(b[0]))};var e={cal:{func:c.toColArrow,
            type:CB.AnnoType.ARROW_LIST},csl:{func:c.toColSq,type:CB.AnnoType.SQUARE_LIST},dia:{func:c.toDiag,type:CB.AnnoType.DIAGRAM},eval:{func:c.toEval,type:CB.AnnoType.FRITZ_EVAL},emt:{func:c.toTime,type:CB.AnnoType.TIME},tqu:{func:c.toTraining,type:CB.AnnoType.TRAINING},mdl:{func:c.toMedal,type:CB.AnnoType.MOVE_MEDAL},evp:{func:c.toEvalProfile,type:CB.AnnoType.EVAL_PROFILE}};c.g_regexEval=/(-?(?:\d?\d\.\s?\d\d?)|(?:#\d+))\/\s?(\d+)/;c.toAnno=function(b,d){if(0<=d.indexOf("/")){var f=d.replace(/\r/g," ");
        f=f.replace(/\n/g," ");f=f.replace(/\s\s/g," ");var g=c.g_regexEval.exec(f);g&&(d=g[1],d=d.replace(/\s/g,""),d=0===d.indexOf("#")?32E3:0===d.indexOf("-#")?-32E3:Number(d),d=new CB.EvalAnno(d,Number(g[2])),b.setAnnoItem(CB.AnnoType.FRITZ_EVAL,d),d=g.index,g=g[0].length,d=f.substring(0,d)+f.substring(d+g))}if(0<=d.indexOf("[%")){f=[];d=PGNCommand.process(d,f);var l=0;for(g=f.length;l<g;++l){var m=f[l];if(m.m_cmd in e){var p=e[m.m_cmd],r=p.type;(m=p.func(m.m_args))&&b.setAnnoItem(r,m)}}}d&&b.setAnnoItem(CB.AnnoType.POSTTEXT,
        new CB.TextAnno(d))};return c}();
CB.PGN=function(){function d(b){return void 0===b?"":"?"===b?"":b}function b(b){return b&&"?"!==b}function c(c){var f=new CB.GameHeader;f.setWhite(d(c.white));f.setBlack(d(c.black));f.setEvent(d(c.event));f.setSite(d(c.site));f.setAnnotator(d(c.annotator));f.setECO(d(c.eco));var g=c.result;"string"===typeof g?f.setResult(CB.GameResultEnum.fromString(g)):f.setResult(g);f.setRoundStr(d(c.round));b(c.whiteelo)&&f.setEloWhite(parseInt(c.whiteelo));b(c.blackelo)&&f.setEloBlack(parseInt(c.blackelo));b(c.date)&&
f.setDateStr(c.date);b(c.timecontrol)&&f.setClockParams(e(c.timecontrol));b(c.plycount)&&(f.plyCount=parseInt(c.plycount)+1>>1);return f}function e(b){return(b=m.exec(b))?new CB.ClockParams(Number(b[1])/60,Number(b[2])):new CB.ClockParams}function f(b){var e=null,d=b.getHeaders();d.fen&&(e=d.fen);d=c(d);e=new CB.Position(e);b=b.getMainLine();b=k(e,b);b=new CB.Game(e,b);b.setHeader(d);return b}function g(b,c){if(b.isLongCastling()){var e=c.isWTM()?CB.Move.g_mvW000:CB.Move.g_mvB000;if(l.trustLegal||
    c.isLegalMove(e))return ObjUtil.clone(e)}if(b.isShortCastling()&&(e=c.isWTM()?CB.Move.g_mvW00:CB.Move.g_mvB00,l.trustLegal||c.isLegalMove(e)))return ObjUtil.clone(e);if(b.isNullMove())return new CB.Move;var d=b.getTo(),f=b.getMoved(),g=c.getSideToMove(),h=b.getProm();f!==CB.Piece.PAWN&&(h=CB.Piece.NONE);e=[];switch(f){case CB.Piece.KNIGHT:c.getKnightAttacksTo(d,g,e);break;case CB.Piece.BISHOP:c.getBishopAttacksTo(d,g,e);break;case CB.Piece.ROOK:c.getRookAttacksTo(d,g,e);break;case CB.Piece.QUEEN:c.getQueenAttacksTo(d,
    g,e);break;case CB.Piece.KING:c.getKingAttacksTo(d,g,e);break;case CB.Piece.PAWN:b.isTake()?(f=c.getPiece(d),f===CB.Piece.NONE&&d===c.getEPField()&&(f=c.getEPVictimField(),f=c.getPiece(f)),f!==CB.Piece.NONE&&CB.Piece.side(f)!==g&&c.getPawnAttacksTo(d,g,e)):(f=c.getPiece(d),f===CB.Piece.NONE&&c.getPawnMovesTo(d,g,e));break;default:return null}if(!e.length)return null;if(1===e.length&&l.trustLegal)return new CB.Move(e[0],d,h);b=b.matchesFrom.bind(b);e=e.filter(b);if(!e.length)return null;if(1===e.length&&
    l.trustLegal)return new CB.Move(e[0],d);b=e.map(function(b){return new CB.Move(b,d)});b=c.filterLegals(b);return b.length?1===b.length?b[0]:null:null}function h(b){for(var c=["\r\n","\n","\r"],e=0,d=c.length;e<d;++e){var f=c[e];if(0<=b.indexOf(f))return f}return null}function k(b,c){var e=ObjUtil.clone(b);b=new CB.MoveLine;for(var d=null,f=null,h=null,l=0,m=c.length;l<m;++l){var p=c[l];if(!(p instanceof PGNMoveNum))if(p instanceof CB.PGNMove){p=g(p,e);if(!p)break;d=e.makeMove(p);f=p;b.push(p);h&&
(h.m_strComment&&0==h.m_strComment.indexOf("[%")?CB.PGNParser.toAnno(f,h.getComment()):f.setAnnoItem(CB.AnnoType.PRETEXT,new CB.TextAnno(h.getComment())),h=null)}else if(p instanceof PGNSubLine){if(f){e.unmakeMove(f,d);p=k(e,p);f.addLine(p);var r=b.length-1;p.setParentLine(b);p.setParentMoveIndex(r);e.makeMove(f)}}else p instanceof CB.PGNComment?f?(p=p.getComment(),CB.PGNParser.toAnno(f,p)):h=p:p instanceof PGNGlyph&&f&&((r=f.getAnnoItem(CB.AnnoType.SYMBOL))||(r=new CB.SymbolsAnno),r.push(p.getGlyph()),
    f.setAnnoItem(CB.AnnoType.SYMBOL,r))}for(c=0;c<b.length-1;c++)b[c].hasAnno()&&b[c].getAnno().hasTraining()&&(e=b[c].getAnno().getTraining(),d=b[c+1],e.move=new CB.Move(d.from,d.to,d.prom));return b}var l={},m=/^(\d+)(?:\+(\d+))?$/;l.splitGames=function(b){var c=b.indexOf("[");-1==c&&(c=b.indexOf("1."));0<c&&(b=b.slice(c));c=[];var e=h(b);if(null==e)return[b];if("\r\n"===e){var d=b;if(0<=d.indexOf("\r\r")||0<=d.indexOf("\n\n"))b=b.replace(/\r\n/g,"\n"),b=b.replace(/\r/g,"\n"),e="\n"}d=e+e+"[";e=2*
    e.length;for(var f=0,g=b.indexOf(d,f);-1!=g&&f<b.length;g=b.indexOf(d,f))f=b.substring(f,g),c.push(f),f=g+e;f<b.length&&(b=b.substring(f),c.push(b));return c};var p=/\[(\w+)\s+"([\s\S]*?)"\]/g,r=/^\s*$/;l.repair=function(b){var c=h(b);c||(c="\r\n");for(var e=new StringBuilder,d=p.lastIndex=0,f;f=p.exec(b);){var g=f.index;d=b.substring(d,g);r.test(d)||(e.append(c),e.append(d.trim()),e.append(c),e.append(c));d=f[1];var k=f[2];k=k.replace(/\r/g," ");k=k.replace(/\n/g," ");e.appendFormat('[{0} "{1}"]',
    d,k);e.append(c);d=g+f[0].length}b=b.substring(d);r.test(b)||(e.append(c),e.append(b.trim()),e.append(c),e.append(c));return e.toString()};l.trustLegal=!0;l.parseGame=function(b){return b?(b=new CB.PGNLexer(b),(b=(new CB.PGNParser(b)).acceptGame())?f(b):null):new CB.Game};l.parseGameNoMoves=function(b){return b?(b=new CB.PGNLexer(b),(b=(new CB.PGNParser(b)).acceptGameNoMoves())?f(b):null):new CB.Game};l.parseHeader=function(b){b=new CB.PGNLexer(b);var e={};(new CB.PGNParser(b)).acceptHeaders(e);return e?
    c(e):null};return l}();var PGN=CB.PGN;function PGNCommand(d,b){d||(d="");b||(b=[]);this.m_cmd=d;this.m_args=b}PGNCommand.prototype.init=function(d,b){this.m_cmd=d;PGNCommand.initArgs(b,this.m_args)};
PGNCommand.initArgs=function(d,b){d=d.replace(/[\n]/g," ");d=d.replace(/[\r]/g,"");var c=/(".*?")|([-\w\n]+),|([-:\w\n]+)$/g;c.lastIndex=0;var e;do if(e=c.exec(d)){var f=e[1]||e[2]||e[3];if(f)'"'===f[0]&&(f=f.substring(1),'"'===f[f.length-1]&&(f=f.substring(0,f.length-1))),b.push(f),c.lastIndex===e.index&&++c.lastIndex,e=0<=e.index;else break}else break;while(e)};PGNCommand.g_regexWhole=/\[%(\w+)((?:"[^"]*"|[^"\]]*)*)\]/;
PGNCommand.process=function(d,b){for(;d;){var c=PGNCommand.g_regexWhole.exec(d);if(c){var e=new PGNCommand,f=c[0];e.init(c[1],c[2]);b.push(e);d=d.substring(0,c.index)+d.substring(c.index+f.length)}else break}return d};"use strict";CB.PGNLocalization=ObjUtil.copyTo(CB.V1,{strProm:"="},!0);
CB.PGNWriter=function(){function d(b,c){b.appendFormat("[%{0}",c);if(arguments.length-2){b.append(" ");for(var e=2;e<arguments.length;++e){var d=arguments[e];2<e&&b.append(",");b.append(d)}}b.appendFormat("]")}function b(c,e,k){for(var g=0;g<e.length;++g){var h=e[g],p=h.getMoved(),r=c,t=k,w=0==g,q=h.getAnno();if(h.hasAnno()){var u=r,y=q[CB.AnnoType.PRETEXT];y&&(u.append("{"),u.append(y.getString()),u.append("} "))}u=h.getMoved();if(w||CB.Piece.side(u)===CB.Side.WHITE)r.append(t),r.append("."),CB.Piece.side(u)===
CB.Side.BLACK&&r.append(".."),r.append(" ");w=f.getMoveNota(h);r.append(w);r.append(" ");if(h.hasAnno()){w=r;if(u=q.getItem(CB.AnnoType.SYMBOL)){y=0;for(var z=u.length;y<z;++y)w.appendFormat("${0} ",u[y])}u=q.count();q.hasItem(CB.AnnoType.SYMBOL)&&--u;q.hasItem(CB.AnnoType.PRETEXT)&&--u;if(u){w.append("{");if(y=q[CB.AnnoType.TIME]){u=w;y=y.getTimeIn100th();z=Math.floor(y/36E4);y-=36E4*z;var A=Math.floor(y/6E3);d(u,"emt",String.formatEx("{0}:{1}:{2}",z,A,Math.round((y-6E3*A)/100,1)))}(q=q[CB.AnnoType.POSTTEXT])&&
w.append(q.getString());w.append("} ")}}if(h.hasLines())for(w=0;w<h.getSubLinesCount();++w)r.append("("),q=h.getLine(w),b(r,q,t),r.append(")");CB.Piece.side(p)===CB.Side.BLACK&&++k}}function c(b,c,e){b.appendFormat('[{0} "{1}"]',c,e);b.append("\r\n")}var e={},f=new CB.NotationGenerator(CB.PGNLocalization);e.toPGN=function(e){var d=new StringBuilder,f=e.getHeader();c(d,"Event",f.getEvent());c(d,"White",f.getWhite());c(d,"Black",f.getBlack());c(d,"Site",f.getSite());c(d,"Round",f.getRoundStr());c(d,
    "Annotator",f.getAnnotator());c(d,"Result",f.getCBResult().toPGNString());c(d,"Date",f.getDateStr());f.getEloWhite()&&c(d,"WhiteElo",f.getEloWhite());f.getEloBlack()&&c(d,"BlackElo",f.getEloBlack());c(d,"PlyCount",e.getMainLine().length);if(!e.isNormalInit()){c(d,"Setup",1);var g=e.getStartPos().toFEN();c(d,"FEN",g)}if(f=f.getClockParams())g=f.getStartSecs().toString(),f.incSecs&&(g+="+"+f.incSecs),c(d,"TimeControl",g);d.append("\r\n");f=1;e.isNormalInit()||(f=e.getStartPos().getMoveNum());b(d,e.getMainLine(),
    f);d.append(e.hdr.getCBResult().toPGNString());d.append("\r\n");d.append("\r\n");return d.toString()};e.toUrlPGN=function(b){b=this.toPGN(b);for(var c=['Site "?"','Round "?"','Date "????.??.??"','Result "*"'],e=0;e<c.length;e++)b=b.replace("/["+c[e]+"/]/ig","");b=encodeURI(b);b=b.replace(/\.%20/ig,".");b=b.replace(/%0D%0A/ig,"%20");b=b.replace(/%20%20/ig,"%20");return b=b.replace(/%20%20/ig,"%20")};e.toFEN=function(b){var c=new StringBuilder;b=b.getCurPos().toFEN();c.append(b);return c.toString()};
    return e}();"use strict";
CB.Database=function(){var d=function(){this.nGames=0;this.games=[];this.headers=[];this.nUsers=0;this.setStartGameIndex(0);this.setPageSize(200);this.filterText=""};d.prototype.setupListeners=function(b){};d.prototype.incUsers=function(){this.nUsers++};d.prototype.decUsers=function(){this.nUsers--};d.prototype.getNUsers=function(){return this.nUsers};d.prototype.getCopySrcId=function(){};d.prototype.beginUse=function(){this.manager&&this.manager.beginUse(this)};d.prototype.endUse=function(){this.manager&&
this.manager.endUse(this)};d.prototype.importGames=function(b,c){alert("not implemented")};d.prototype.isLoadFromFile=function(){return!0};d.prototype.canSaveTo=function(){return!1};d.prototype.shouldShowLastGame=function(){return!1};d.prototype.getGameCount=function(){return this.nGames};d.prototype.getDisplayTitle=function(){return"Database"};d.prototype.isSortable=function(){return this.isLoadFromFile()};d.prototype.getHeaderJson=function(b){return{gameNo:b,white:"Not available",black:"",event:"",
    date:new CB.Date(0),result:"",eco:""}};d.prototype.loadHeadersJsonAsync=function(b,c,e){var d=[];for(CB.LOG("Headers Async: "+c+" - "+e);c<=e&&c<=this.getGameCount();c++){var g=this.getHeaderJson(c);d.push(g)}(new Ext.util.DelayedTask).delay(100,function(){b(d)})};d.prototype.getGame=function(b){return new CB.Game};d.prototype.loadGameAsync=function(b,c){var e=this.getGame(c);(new CB.Timer(function(){b(e)})).runOnce(10)};d.prototype.toggleDeleteMark=function(b){};d.prototype.toggleDeleteMarks=function(b){};
    d.prototype.removeDeletedGames=function(){};d.prototype.setSubSet=function(b){this.subSet=b};d.prototype.clearSubSet=function(){delete this.subSet};d.prototype.getSetSize=function(){return this.subSet?this.subSet.length:this.getGameCount()};d.prototype.getGameNoInSet=function(b){return this.subSet&&b<=this.subSet.length&&0<b?this.subSet[b-1]:b};d.prototype.getSetInxOfGameNo=function(b){if(this.subSet)for(var c=0;c<this.subSet.length;c++){if(this.subSet[c]==b)return c+1}else return b};d.prototype.setFilter=
        function(b){this.headers.filter(function(b){return void 0!==b}).length!=this.nGames&&this.manager?this.manager&&this.manager.requestFilterSet(this.getCopySrcId(),b):this.filterLocalHeaders(b)};d.prototype.clearFilter=function(){this.clearSubSet()};d.prototype.filterLocalHeaders=function(b){V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.showBusyMask("Searching locally ... ",null,2E4);b=new RegExp(b,"i");CB.LOG(b);CB.LOG(typeof b);for(var c=[],e=1;e<this.headers.length;e++)this.headers[e].matchesFilterVal(b)&&
    c.push(this.headers[e].nGame);V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.hideBusyMask();this.setSubSet(c)};d.prototype.sortHeaders=function(b,c){};d.prototype.getPageSize=function(){return this.pageSize};d.prototype.setPageSize=function(b){1>b&&(b=1);this.pageSize=b};d.prototype.getStartGameIndex=function(){return this.startGameIndex};d.prototype.setStartGameIndex=function(b){0>b&&(b=0);this.startGameIndex=b};d.prototype.getEndGameIndex=function(){var b=this.getStartGameIndex()+this.getPageSize();
        b>this.getSetSize()&&(b=this.getSetSize());return b};d.prototype.getPagedGamesHeadersJson=function(){for(var b=[],c=this.getStartGameIndex();c<this.getEndGameIndex();c++)if(this.subSet){if(this.subSet[c]<=this.getGameCount()){var e=this.getHeaderJson(this.subSet[c]);b.push(e)}}else e=this.getHeaderJson(c+1),b.push(e);return b};return d}();"use strict";
CB.PgnDatabase=function(){var d=function(b,c){this.pgn="";this.gameStrings=[];this.headers=[];this.games=[];this.loadFinished=!1;this.callbackOnLoaded=c;"string"==typeof b?this._fromText(b):(this._fromFile(b),this.fileName=b.name)};CB.inherit(d,CB.Database);d.prototype.getGameCount=function(){return this.gameStrings.length};d.prototype.getDisplayTitle=function(){return this.fileName};d.prototype.getCopySrcId=function(){return function(b){for(var c=[],e=0;e<b.length;e++){var d=this.getGame(b[e]);c.push(d)}return c}.bind(this)};
    d.prototype.getHeaderJson=function(b){if(0>=b)return null;void 0===this.headers[b]&&b<this.gameStrings.length+1&&(this.headers[b]=PGN.parseHeader(this.gameStrings[b-1]));var c=this.headers[b];return c?(c.nGame=b,c.toJson()):this.superClass.getHeaderJson(b)};d.prototype.loadHeadersJsonAsync=function(b,c,e){if(this.loadFinished)this.loadHeadersImpl(b,c,e);else{var d=this.callbackOnLoaded;this.callbackOnLoaded=function(){d&&d(this);this.loadHeadersImpl(b,c,e)}.bind(this)}};d.prototype.loadHeadersImpl=
        function(b,c,e){var d=[];for(CB.LOG("Headers Async: "+c+" - "+e);c<=e&&c<=this.getGameCount();c++){var g=this.getHeaderJson(c);d.push(g)}(new Ext.util.DelayedTask).delay(100,function(){b(d)})};d.prototype.getGame=function(b){return b?PGN.parseGame(this.gameStrings[b-1]):new CB.Game};d.prototype.importGames=function(b,c){alert("Sorry, you cannot save into a PGN database.")};d.prototype.toString=function(){for(var b="",c=1;c<=this.getGameCount();c++){var e=this.getGame(c);e=CB.PGNWriter.toPGN(e);b+=
        e}return b};d.prototype._fromText=function(b){this.gameStrings=PGN.splitGames(b);CB.LOG("Found in PGN "+this.gameStrings.length+" games");void 0!==this.callbackOnLoaded&&this.callbackOnLoaded(this);this.loadFinished=!0};d.prototype._fromFile=function(b){if("function"==typeof FileReader){var c=new FileReader;c.onloadend=function(){this._loadDone(c)}.bind(this);c.onerror=function(){this._loadError(c)}.bind(this);c.onprogress=function(){CB.LOG("On Progress")}.bind(this);c.onload=function(){CB.LOG("On Load")}.bind(this);
        c.readAsText(b)}};d.prototype._loadDone=function(b){b.result&&(this.gameStrings=PGN.splitGames(b.result),CB.LOG("Found in PGN "+this.gameStrings.length+" games"),void 0!==this.callbackOnLoaded&&this.callbackOnLoaded(this));this.loadFinished=!0};d.prototype._loadError=function(b){alert("Could not load file, sorry");this.loadFinished=!0};d.prototype.loadHeaderIfMissing=function(b){this.headers[b]||(this.headers[b]=PGN.parseHeader(this.gameStrings[b-1]),this.headers[b].nGame=b)};d.prototype.filterLocalHeaders=
        function(b){V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.showBusyMask("Searching locally ... ",null,2E4);b=new RegExp(b,"i");for(var c=[],e=1;e<=this.getGameCount();e++)this.loadHeaderIfMissing(e),this.headers[e].matchesFilterVal(b)&&c.push(this.headers[e].nGame);V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.hideBusyMask();this.setSubSet(c)};d.prototype.sortHeaders=function(b,c){V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.showBusyMask("Sorting ... ",null,2E4);for(var e=[],d=0;d<this.getSetSize();d++){var g=
        this.subSet?this.subSet[d]:d+1;this.loadHeaderIfMissing(g);e[d]=this.headers[g]}(function(b,c,e){b=b.sort(function(b,d){return e?b[c]>d[c]?1:b[c]<d[c]?-1:0:d[c]>b[c]?1:d[c]<b[c]?-1:0})})(e,b,c);b=[];for(d=0;d<e.length;d++)b.push(e[d].nGame);this.setSubSet(b);V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.hideBusyMask()};return d}();"use strict";CB.StreamingItemType={NONE:0,WMV:1,MP4:2,SMOOTHSTREAMING:4,THUMB:8,META:16,GAMEACTIONS:32,MPEGDASH:64,HLSV3:128,HLSV4:256};
CB.BroadcastStreamingItemEx=function(){var d=function(b,c){this.strUrl=b;this.type=c};d.prototype.fromDataBuf=function(b){this.strUrl=b.Vq(2048);this.type=b.V10()};return d}();"use strict";CB.StreamingDataFlags={NONE:0,LIVE:1};
CB.BroadcastStreamingDataEx=function(){var d=function(){this.items=[]};d.prototype.add=function(b){this.items.push(b)};d.prototype.fromDataBuf=function(b){this.nGameId=b.V10();for(var c=b.V10(),e=0;e<c;e++){var d=new CB.BroadcastStreamingItemEx;d.fromDataBuf(b);this.items.push(d)}this.nFlags=b.V10();this.nCosts=b.V10()};d.prototype.isLive=function(){return this.nFlags&CB.StreamingDataFlags.LIVE};d.prototype.getURL=function(b){for(var c="",e=0;e<this.items.length;e++)b&this.items[e].type&&(c=this.items[e].strUrl);
    return c};return d}();"use strict";CB.ChatStreamData=function(){var d=function(){};d.prototype.read=function(b){b.rewind();try{this.strMsg=b.V6(4096)}catch(c){CB.LogException("ChatStreamData Msg Len exception")}this.m_eWeight=b.V11();this.m_eColName=b.V11();this.m_eReserved=b.V11();this.m_eEmosound=b.V11();this.m_nFlags=b.V10();this.m_nTotalReceivers=b.V10();this.m_nChannel=b.V10();this.m_nReserved=b.V10();this.m_strSenderName=b.V6(50)};return d}();"use strict";
var RecorderState={RecordStopped:0,RecordNormal:1,RecordSolution:2,RecordGoodMove:3,RecordOtherMoves:4,RecordOtherMovesNoVideo:5};CB.MediaPlayerType={MediaPlayerUnknown:0,MediaPlayerWMV:1,MediaPlayerFlash:2,MediaPlayerHTML:3,MediaPlayerSL:4,MediaPlayerMPEGDASH:5,MediaPlayerAzure:6};
CB.VideoManager=function(){var d=CB.MediaPlayerType.MediaPlayerUnknown,b=0,c=function(b,c,g,h,k){this.videoUrl="";this.playerInstance=b;this.playerAuthenticated=!1;this.onGameActionHdl=h;this.onEndOfVideoHdl=k;this.gameActions=[];this.chatActions=[];this.el=g;this.gameHeaderStr="";CB.$(this.el).html("<div id='wmpHolder"+b+"' style='height:100%;'><iframe  style='width:100%;height:100%;' src='https://en.chessbase.com/playchess2/events.aspx/video'></iframe></div>");this.baseurl=V15.config.getVideoPortalUris()[0];
    d=c;this.determineBrowser()};c.prototype.cleanUp=function(){this.remove("MediaPlayer1")};c.prototype.remove=function(b){(b=document.getElementById(b))&&b.parentNode.removeChild(b)};c.prototype.getPlayerType=function(){return d};c.prototype.detectWMP=function(){};c.prototype.getWidth=function(){if(d==CB.MediaPlayerType.MediaPlayerAzure){var b=amp("azuremediaplayer");if(b)return b.width()}return 0};c.prototype.getHeight=function(){if(d==CB.MediaPlayerType.MediaPlayerAzure){var b=amp("azuremediaplayer");
    if(b)return b.height()}return 0};c.prototype.determineBrowser=function(){switch(d){case CB.MediaPlayerType.MediaPlayerAzure:this.prepareAzure();break;case CB.MediaPlayerType.MediaPlayerUnknown:this.prepareLegacy()}};c.prototype.prepareAzure=function(){d==CB.MediaPlayerType.MediaPlayerAzure&&this.setupAzureMediaPlayer()};c.prototype.prepareLegacy=function(){window.chrome&&window.chrome.webstore?this.setupHLS():CB.System.isMobile()?this.setupHTML():!this.isWindows()&&CB.System.isWebKit()?this.setupHTML():
    this.isWindows()?CB.System.isActivexEnabled()?(this.detectWMP(),null!=this.P&&this.P.version?this.setupWMV():this.setupHelp()):this.setupHLS():this.setupHTML()};c.prototype.isMp4Client=function(){var b=!1;CB.System.isActivexEnabled()&&(this.detectWMP(),null!=this.P&&this.P.version&&(b=!0));return!b};c.prototype.generateHTMLPlayer=function(b,c,d,h){b=document.getElementById(b);h='<video src="'+h+'" controls autoplay></video>';b&&(b.innerHTML=h);h=document.getElementsByTagName("video")[0];h.addEventListener("loadeddata",
    function(){}.bind(this));h.addEventListener("ended",function(){setTimeout(this.callGetNextIdAtEnd.bind(this),500)}.bind(this));return b};c.prototype.generateSLPlayer=function(b,c,d){};c.prototype.onError=function(){alert("onError")};c.prototype.generateHTMLHelp=function(b){if(b=document.getElementById(b))b.innerHTML='For instructions click on the <a href="http://play.chessbase.com/js/apps/playchess/playchesscms.html">link</a>';return b};c.prototype.stop=function(){if(d==CB.MediaPlayerType.MediaPlayerWMV){var b=
    document.getElementById("MediaPlayer1");null!=b&&null!=b.controls&&b.controls.stop()}};c.prototype.isWindows=function(){return-1!=navigator.appVersion.indexOf("Win")};c.prototype.autoPlay=function(){var b=CB.strUtil.getURLParam("autoplay"),c=!0;null!=b&&0<b.length&&(c="false"!=b);return c};c.prototype.generateAzureMediaPlayer=function(b,c,d,h){var e=this.autoPlay();this.videoUrl=h;CB.System.runsInIFrame()&&(e=!1);var f=CB.Language.getStrUserLanguage();b=document.getElementById(b);var g=document.getElementById("azuremediaplayer"+
    this.playerInstance);if(h&&0<h.length){if(null==g){var p={nativeControlsForTouch:!1,language:f,autoplay:e,controls:!0,width:d,height:c,poster:"",logo:{enabled:!1}};CB.System.isWebKit()&&(p={nativeControlsForTouch:!1,language:f,techOrder:["azureHtml5JS","html5","flashSS","silverlightSS"],controls:!0,autoplay:e,width:d,height:c,poster:"",logo:{enabled:!1},plugins:{ga:{eventsToTrack:"playerConfig loaded playTime percentsPlayed start end play pause error buffering fullscreen seek bitrate".split(" "),
            debug:!1}}});c="azuremediaplayer"+this.playerInstance;b.innerHTML=e?"<video  webkit-playsinline='true' playsinline='true' id='"+c+"' class='azuremediaplayer amp-default-skin' controls autoplay amp-big-play-centered tabindex='0'> </video>":"<video  webkit-playsinline='true' playsinline='true' id='"+c+"' class='azuremediaplayer amp-default-skin' controls amp-big-play-centered tabindex='0'> </video>";g=amp("azuremediaplayer"+this.playerInstance,p);amp("azuremediaplayer"+this.playerInstance).src([{src:h,
    type:"application/vnd.ms-sstr+xml"}]);amp("azuremediaplayer"+this.playerInstance).ready(function(){CB.$(".amp-logo")&&CB.$(".amp-logo").remove();CB.System.isIPhone()||CB.System.isIPad()||CB.System.runsInIFrame()||g.play()});g.addEventListener("error",function(){var b=g.error();if(b){var c=b.code>>28;b=(b.code&8388607)>>23;if(!CB.System.isIPhone()&&!CB.System.isIPad()){var e=this.getAzureError(g);alert("Sorry, There is a problem with the Video Player: "+e+c+","+b)}}}.bind(this));amp("azuremediaplayer"+
    this.playerInstance).removeEventListener("loadeddata");amp("azuremediaplayer"+this.playerInstance).addEventListener("loadeddata",function(){this.startTimer();this.getStartTimeFromDB()}.bind(this));amp("azuremediaplayer"+this.playerInstance).removeEventListener("loadedmetadata");amp("azuremediaplayer"+this.playerInstance).addEventListener("loadedmetadata",function(){}.bind(this));amp("azuremediaplayer"+this.playerInstance).isLive()||(amp("azuremediaplayer"+this.playerInstance).removeEventListener("ended"),
    amp("azuremediaplayer"+this.playerInstance).addEventListener("ended",function(){this.onEndOfVideoHdl(this.playerInstance,this.currentvideoid)}.bind(this)))}amp("azuremediaplayer"+this.playerInstance).src([{src:h,type:"application/vnd.ms-sstr+xml"}]);CB.System.isIPhone()||CB.System.isIPad()||e&&(CB.System.runsInIFrame()||amp("azuremediaplayer"+this.playerInstance).play());amp("azuremediaplayer"+this.playerInstance).controls(!0);amp("azuremediaplayer"+this.playerInstance).options({logo:{enabled:!1}})}return b};
    c.prototype.getAzureError=function(b){var c="Unknown Error: ";b.error().code&amp.errorCode.abortedErrStart?c="MEDIA_ERR_ABORTED: ":b.error().code&amp.errorCode.networkErrStart?c="MEDIA_ERR_NETWORK: ":b.error().code&amp.errorCode.decodeErrStart?c="MEDIA_ERR_DECODE: ":b.error().code&amp.errorCode.srcErrStart?c="MEDIA_ERR_SRC_NOT_SUPPORTED: ":b.error().code&amp.errorCode.encryptErrStart?c="MEDIA_ERR_ENCRYPTED errors: ":b.error().code&amp.errorCode.srcPlayerMismatchStart&&(c="SRC_PLAYER_MISMATCH error: ");
        return c};c.prototype.setupAzureMediaPlayer=function(){d=CB.MediaPlayerType.MediaPlayerAzure};c.prototype.setupNanoPlayer=function(){this.generateNanoPlayer("wmpHolder",240,320)};c.prototype.setupHTML=function(){CB.LOG("Setup HTML");d=CB.MediaPlayerType.MediaPlayerHTML};c.prototype.setupSL=function(b){};c.prototype.setupAzure=function(b){var c=320,e=320;if(!CB.$.get("azuremediaplayer"+this.playerInstance)){var d=this.generateHTMLHelp("wmpHolder"+this.playerInstance);d&&d.offsetParent&&(e=d.offsetParent.clientWidth,
        c=d.offsetParent.clientHeight)}CB.System.isHTTPS()&&(b=b.replace("http://","https://"));this.htmlHolder=this.generateAzureMediaPlayer("wmpHolder"+this.playerInstance,c,e,b)};c.prototype.setupHelp=function(){this.generateHTMLHelp("wmpHolder")};c.prototype.reportChannel=function(b){CB.LOG("RadionManager::ReportChannel");d==CB.MediaPlayerType.MediaPlayerHTML?(this.htmlHolder=this.generateHTMLPlayer("wmpHolder",240,320,"http://video.chessbase.com/js/hls"+b.sChannel+"/hls0.m3u8"),document.getElementsByTagName("video")[0].play()):
        d==CB.MediaPlayerType.MediaPlayerFlash&&(this.nChannel=b.sChannel,jwplayer("wmpHolder").load([{file:"http://video.chessbase.com/js/hls"+b.sChannel+"/hls2.m3u8"}]))};c.prototype.onLoadChat=function(b){b=JSON.parse(b);if(b.length)for(var c=0;c<b.length;c++){var e=b[c],d=new CB.ScriptCommand;d.time=e.Time;d.type=e.GameActionType;d.action=e.GameActionContent;this.chatActions.push(d)}};c.prototype.onCurGameChanged=function(){var b=this.gameKernel.getCurPos();if(this.cachepos)for(var c=0;c<this.cachepos.length;c++)if(b.equals(this.cachepos[c])){this.setStartTime(this.cachetime[c]);
        break}};c.prototype.b64_to_utf8=function(b){return decodeURIComponent(escape(window.atob(b)))};c.prototype.reportBroadcastStreamingData=function(b){CB.LOG("RadionManager::reportBroadcastStreamingData ");if(d==CB.MediaPlayerType.MediaPlayerWMV){b=b.getURL(CB.StreamingItemType.WMV);var c=document.getElementById("MediaPlayer1");c&&(c.URL=b,c.data=b)}else if(d==CB.MediaPlayerType.MediaPlayerAzure)b=b.getURL(CB.StreamingItemType.SMOOTHSTREAMING),0<b.length&&this.setupAzure(b);else if(d!=CB.StreamingItemType.SMOOTHSTREAMING)if(d==
        CB.MediaPlayerType.MediaPlayerHTML){b=b.getURL(CB.StreamingItemType.MP4);this.htmlHolder=this.generateHTMLPlayer("wmpHolder",240,320);if(c=document.getElementsByTagName("video")[0])c.src=b;c.play();this.doResize(c.offsetParent.clientWidth,c.offsetParent.clientHeight)}else d==CB.MediaPlayerType.MediaPlayerFlash&&(b=b.getURL(CB.StreamingItemType.MP4),jwplayer("wmpHolder").setup({file:b,image:"http://shop.chessbase.com/pics/p_6251",autostart:!0,width:"100%",height:"90%"}))};c.prototype.doResize=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  c){if(d==CB.MediaPlayerType.MediaPlayerAzure){if(document.getElementById("azuremediaplayer"+this.playerInstance)){var e=amp("azuremediaplayer"+this.playerInstance);e&&(e.height(),e.height(c),e.width(b))}}else if(d==CB.MediaPlayerType.MediaPlayerHTML){if(e=document.getElementsByTagName("video")[0])e.height=c,e.width=b}else if(e=document.getElementById("MediaPlayer1"))e.width=b,e.height=c;d==CB.MediaPlayerType.MediaPlayerFlash&&jwplayer("wmpHolder").resize(b,c-40)};c.prototype.onSync=function(b){document.getElementById("MediaPlayer1")};
    c.prototype.onScriptCommand=function(b,c){null!=this.gameKernel&&this.gameKernel.executeGameAction(b,c);if(null!=this.watchSessions)this.watchSessions.onGameActionFromStream(b,c)};c.prototype.getCurrentTime=function(){if(d==CB.MediaPlayerType.MediaPlayerAzure)try{var b=amp("azuremediaplayer"+this.playerInstance);if(b&&b.currentTime)return b.currentTime()}catch(f){return-1}else if(d==CB.MediaPlayerType.MediaPlayerWMV){if(b=document.getElementById("MediaPlayer1"),b.controls&&b.controls.currentPosition)return b.controls.currentPosition}else{if(d==
        CB.MediaPlayerType.MediaPlayerHTML)return document.getElementsByTagName("video")[0].currentTime;if(d!=CB.MediaPlayerType.MediaPlayerSL&&d==CB.MediaPlayerType.MediaPlayerFlash)return this.currenttime=jwplayer("wmpHolder").getPosition()}return 0};c.prototype.mustExecute=function(b,c){return b>=c&b<c+1};c.prototype.CMSGameActionsHandler=function(c){c=this.getCurrentTime();this.onGameActionHdl(this.playerInstance,c);var e=!1;if(!this.endEventFired){for(k=0;k<this.chatActions.length;k++)if(this.mustExecute(this.chatActions[k].time,
        c)){var d=this.chatActions[k].action;if(d){var h=new CB.DataBuffer;h.constructFromString(d,!0);h.rewind();(new CB.ChatStreamData).read(h)}}for(var k=0;k<this.gameActions.length;k++)if(this.mustExecute(this.gameActions[k].time,c)){if(0!=c)this.onScriptCommand(this.gameActions[k].type,this.gameActions[k].action);e=!0;if(60<=c-b){if(d=CB.$.get("videoid")){d=d.innerHTML;h=Math.floor(c)/60;h=Math.floor(h);this.endEventFired=!1;var l="",m=CB.$.get("userid");m&&(l=encodeURIComponent(m.innerHTML));1<h&&(CB.AJAX.load(this.baseurl+
        "Replay/AddSnippetViewed?id="+encodeURIComponent(d)+"&time="+h+"&user="+l,this.onSnippetViewed.bind(this),{responseType:"text"}),0!=this.gameHeaderStr.localeCompare(this.gameKernel.game.hdr.toString())&&(this.gameHeaderStr=this.gameKernel.game.hdr.toString(),this.gameKernel.Vk.saveToCloud(!0)))}b=c}}else if(e)break}};c.prototype.saveToCloud=function(){V15.cloudMgr&&V15.cloudMgr.isLoggedIn()&&V15.cloudMgr.saveGameToClipboard(this.gameKernel.game)};c.prototype.showTimedMessage=function(b,c){V15.panelMgr.showMessage(b);
        this.gameKernel.boardWin.addMessage(b,!0);(new CB.Timer(function(){this.gameKernel.boardWin.destroyMessage()}.bind(this))).runOnce(c)};c.prototype.showMessage=function(b){V15.panelMgr.showMessage(b);this.gameKernel.boardWin.addMessage(b,!0);(new CB.Timer(function(){this.gameKernel.boardWin.destroyMessage()}.bind(this))).runOnce(3E3)};c.prototype.onNextVideo=function(b){b=JSON.parse(b);var c=b.ID,e=b.MSG;2<e.length?this.showMessage(e):(b=b.STATE,"3"==b?(this.showMessage("please try again"),this.gameKernel.Vk.restoreMoveEnterPosition()):
        2<c.length&&("5"==b?window.location.href=this.baseurl+"Replay/Video?id="+c:(CB.$.set("videoid",c),this.loadVideoFromId(c))))};c.prototype.playSolution=function(b){this.showMessage("Solution");b=this.baseurl+"Replay/GetSolution?id="+encodeURIComponent(b);CB.AJAX.load(b,this.onGetSolution.bind(this),{responseType:"text"})};c.prototype.onGetSolution=function(b){b=JSON.parse(b);var c=b.ID;b=b.MSG;2<b.length?this.showMessage(b):this.loadVideoFromId(c)};c.prototype.disable=function(){amp("azuremediaplayer"+
        this.playerInstance).pause();amp("azuremediaplayer"+this.playerInstance).controls(!1)};c.prototype.onSnippetViewed=function(b){b=JSON.parse(b);d!=CB.MediaPlayerType.MediaPlayerAzure||this.playerAuthenticated||(0!=b.localeCompare("Ok")?(CB.$.set("videoid",""),0==b.localeCompare("Expert")?this.gameKernel.boardWin.addMessage("You have to purchase this video in order to watch it",!0):this.gameKernel.boardWin.addMessage("Please login with your Premium account",!0)):this.playerAuthenticated=!0)};c.prototype.renderPartial=
        function(b){b="Replay/RenderPartial?id="+encodeURIComponent(b);var c=new XMLHttpRequest;c.open("POST",this.baseurl,!0);c.setRequestHeader("Content-type","application/x-www-form-urlencoded");c.setRequestHeader("X-Requested-With","XMLHttpRequest");c.onload=function(){};c.send(b)};c.prototype.restart=function(){var b=amp("azuremediaplayer"+this.playerInstance);b&&b.currentTime(0)};c.prototype.setStartTime=function(b){if("0"!=b)if(d==CB.MediaPlayerType.MediaPlayerAzure){var c=amp("azuremediaplayer"+this.playerInstance);
        c&&c.currentTime(1*b)}else d==CB.MediaPlayerType.MediaPlayerWMV?(c=document.getElementById("MediaPlayer1"),c.controls&&c.controls.currentPosition&&(c.controls.currentPosition=b)):d==CB.MediaPlayerType.MediaPlayerHTML&&(document.getElementsByTagName("video")[0].currentTime=b);d==CB.MediaPlayerType.MediaPlayerAzure&&(CB.System.runsInIFrame()||this.play())};c.prototype.loadVideoFromId=function(b){this.currentvideoid=b;$.get(this.baseurl+"Replay/GetAllSmoothStreaming?id="+b,function(b){if(b){for(var c=
        new CB.BroadcastStreamingDataEx,e=0;e<b.length;e++){var d=b[e].URLType,f=b[e].URL;"SS"==d?(d=CB.strUtil.base64.decode(f),d=new CB.BroadcastStreamingItemEx(d,CB.StreamingItemType.SMOOTHSTREAMING),c.add(d)):"WMV"==d?(d=CB.strUtil.base64.decode(f),d=new CB.BroadcastStreamingItemEx(d,CB.StreamingItemType.WMV),c.add(d)):"MP4"==d?(d=CB.strUtil.base64.decode(f),d=new CB.BroadcastStreamingItemEx(d,CB.StreamingItemType.MP4),c.add(d)):"GA"==d&&(d=CB.strUtil.base64.decode(f),d=new CB.BroadcastStreamingItemEx(d,
        CB.StreamingItemType.GAMEACTIONS),c.add(d))}"function"==typeof getAllFinished&&getAllFinished();this.reportBroadcastStreamingData(c)}}.bind(this)).fail(function(){}.bind(this))};c.prototype.startTimer=function(){this.currenttime=0;null==this.myTimer&&(this.myTimer=setInterval(this.CMSGameActionsHandler.bind(this),1E3))};c.prototype.getStartTimeFromDB=function(){var b=CB.strUtil.getURLParam("gotopos");if(b){var c=CB.strUtil.getURLParam("id");c&&this.currentvideoid===c&&(new CB.Timer(function(){this.setStartTime(b)}.bind(this))).runOnce(1E3)}else{var d=
        CB.$.get("gotopos");if(d&&"0"!=d.innerHTML)(c=CB.$.get("videoid"))&&this.currentvideoid===c&&(new CB.Timer(function(){this.setStartTime(d.innerHTML)}.bind(this))).runOnce(1E3);else if(this.currentvideoid){c=this.currentvideoid;var h="";if(h=CB.$.get("userid"))h=h.innerHTML,c=this.baseurl+"Replay/GetStartTime?id="+encodeURIComponent(c)+"&user="+encodeURIComponent(h),$.get(c,function(b){b&&this.setStartTime(b)}.bind(this)).fail(function(){}.bind(this))}}};c.prototype.onWMV=function(b){b=b.substring(1,
        b.length-2);alert(b);b=CB.strUtil.base64.decode(b);var c=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.WMV);c.add(b);this.reportBroadcastStreamingData(c)};c.prototype.onGA=function(b){b=b.substring(1,b.length-2);alert(b);b=CB.strUtil.base64.decode(b);var c=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.GAMEACTIONS);c.add(b);this.reportBroadcastStreamingData(c)};c.prototype.onMP4=function(b){b=b.substring(1,b.length-
        2);alert(b);b=CB.strUtil.base64.decode(b);var c=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.MP4);c.add(b);this.reportBroadcastStreamingData(c)};c.prototype.pause=function(){amp("azuremediaplayer"+this.playerInstance).pause()};c.prototype.play=function(){if(amp&&this.playerInstance&&this.videoUrl){var b=amp("azuremediaplayer"+this.playerInstance);b&&b.play()}};c.prototype.autoTest=function(){amp("azuremediaplayer"+this.playerInstance).pause();this.autoTest=
        new CB.RadioTestManager(this.gameKernel);this.autoTest.start()};return c}();"use strict";
CB.VideoElement=function(){var d=function(b,c,e,d,g){this.aMediaplayer=CB.MediaPlayerType.MediaPlayerAzure;this.nInPage=b;this.hasListeners=!1;this.fnGetKernel=c;this.ticket=e;this.gaHandler=d;this.endvideoHandler=g;this.initState()};d.prototype.initElem=function(b){this.videoManager=new CB.VideoManager(this.nInPage,this.aMediaplayer,b,this.gaHandler,this.endvideoHandler)};d.prototype.initState=function(){};d.prototype.clear=function(){};d.prototype.onNewGame=function(){};d.prototype.resize=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         c){this.videoManager.doResize(b,c)};d.prototype.disable=function(){this.videoManager.disable()};Ve.initForListeners(d);return d}();CB.VideoElement.factory=function(d,b,c,e,f,g){b=new CB.VideoElement(b||0,c,e,f,g);b.initElem(d);return b};"use strict";
CB.LiveVideoManager=function(){var d="",b=function(b,e,d){this.onGameActionHdl=d;this.el=e;e=CB.$(this.el);this.nInstance=b;b="wmpHolder"+b;e.html("<div id='"+b+"' style='width:100%;height:100%;'></div>");this.name=b};b.prototype.setUrl=function(b){d=b;this.player&&this.player.pause();b="wmpHolder"+this.nInstance;this.remove(b);CB.$(this.el).html("<div id='"+b+"' style='width:100%;height:100%;'></div>");this.player=null;(new CB.Timer(function(){this.generateLivePlayer(this.name,200,800)}.bind(this))).runOnce(500)};
    b.prototype.cleanUp=function(){this.remove(this.myRadio)};b.prototype.remove=function(b){(b=document.getElementById(b))&&b.parentNode.removeChild(b)};b.prototype.generateLivePlayer=function(b,e,d){this.generateNanoPlayer(b,e,d)};b.prototype.generateNanoPlayer=function(b,e,f){e={source:{bintu:{apiurl:"https://bintu.nanocosmos.de:443",streamid:d}},playback:{autoplay:!0,muted:!1,metadata:!0},events:{onReady:function(b){},onPlay:function(b){},onPause:function(b){},onLoading:function(b){},onStartBuffering:function(b){},
            onStopBuffering:function(b){},onStats:function(b){},onError:function(b){try{b&&b.data&&b.data.message||JSON.stringify(b)}catch(h){}},onMetaData:function(b){if(b.data.handlerName&&"onCuePoint"===b.data.handlerName)this.onMetaData(b.data.message)}.bind(this)}};this.player||(this.player=new NanoPlayer(this.name));this.player.instance=this;this.player.setup(e).then(function(b){try{JSON.stringify(b)}catch(h){alert(h)}},function(b){alert(b);try{var c=JSON.stringify(b);"{}"===c&&(c=b.message);b=c}catch(k){}document.getElementById("status").innerText=
        "Setup Error: "+b});return b};b.prototype.onMetaData=function(b){this.onGameActionHdl(b,this.nInstance)};b.prototype.onCurGameChanged=function(){var b=this.gameKernel.getCurPos();if(this.cachepos)for(var e=0;e<this.cachepos.length;e++)b.equals(this.cachepos[e])&&this.setStartTime(this.cachetime[e])};b.prototype.b64_to_utf8=function(b){return decodeURIComponent(escape(window.atob(b)))};b.prototype.doResize=function(b,e){var c=document.getElementById("wmpHolder0");c&&(c.style.height=e+"px",c.style.width=
        b+"px")};b.prototype.onSync=function(b){document.getElementById("MediaPlayer1")};b.prototype.onScriptCommand=function(b,e){null!=this.gameKernel&&this.gameKernel.executeGameAction(b,e);if(null!=this.watchSessions)this.watchSessions.onGameActionFromStream(b,e)};b.prototype.play=function(){this.player&&this.player.play()};b.prototype.stop=function(){this.player?this.player.pause():alert("player not found (stop)")};b.prototype.showMessage=function(b){V15.panelMgr.showMessage(b);this.gameKernel.boardWin.addMessage(b,
        !0);(new CB.Timer(function(){this.gameKernel.boardWin.destroyMessage()}.bind(this))).runOnce(3E3)};b.prototype.onAll=function(b){};return b}();"use strict";
CB.LiveVideoElement=function(){var d=function(b,c,e,d,g){this.aMediaplayer=CB.MediaPlayerType.MediaPlayerAzure;this.nInPage=b;this.hasListeners=!1;this.fnGetKernel=c;this.ticket=e;this.gaHandler=d;this.endvideoHandler=g;this.initState()};d.prototype.initElem=function(b){this.videoManager=new CB.LiveVideoManager(this.nInPage,b,this.gaHandler)};d.prototype.initState=function(){};d.prototype.clear=function(){};d.prototype.onNewGame=function(){};d.prototype.resize=function(b,c){this.videoManager.doResize(b,
    c)};d.prototype.disable=function(){this.videoManager.disable()};d.prototype.setUrl=function(b){this.videoManager.setUrl(b)};Ve.initForListeners(d);return d}();CB.LiveVideoElement.factory=function(d,b,c,e,f){b=new CB.LiveVideoElement(b||0,c,e,f);b.initElem(d);return b};"use strict";RecorderState={RecordStopped:0,RecordNormal:1,RecordSolution:2,RecordGoodMove:3,RecordOtherMoves:4,RecordOtherMovesNoVideo:5};
CB.OfflineVideoManager=function(){var d=CB.MediaPlayerType.MediaPlayerUnknown,b=function(b,e,f,g,h){this.playerInstance=b;this.playerAuthenticated=!1;this.onGameActionHdl=g;this.onEndOfVideoHdl=h;this.gameActions=[];this.chatActions=[];this.el=f;this.gameHeaderStr="";CB.$(this.el).html("<div id='wmpHolder"+b+"'></div>");d=e;this.determineBrowser()};b.prototype.cleanUp=function(){this.remove("MediaPlayer1")};b.prototype.remove=function(b){(b=document.getElementById(b))&&b.parentNode.removeChild(b)};
    b.prototype.getPlayerType=function(){return d};b.prototype.determineBrowser=function(){this.prepareAzure()};b.prototype.prepareAzure=function(){this.setupAzureMediaPlayer()};b.prototype.isMp4Client=function(){var b=!1;CB.System.isActivexEnabled()&&(this.detectWMP(),null!=this.P&&this.P.version&&(b=!0));return!b};b.prototype.generateHTMLPlayer=function(b,e,d,g){this.currentvideoid=g;b=document.getElementById(b);g='<video controls playsinline autoplay poster="static/poster.png" id="video" src="'+g+
        '" type="video/mp4"></video>';b&&(b.innerHTML=g);var c=document.getElementsByTagName("video")[0];c&&(c.load(),c.addEventListener("loadeddata",function(){CB.System.isElectron()||0<c.currentSrc.length&&c.play()}.bind(this)),c.onloadstart=function(){this.showMessage("Loading...");CB.System.isElectron()||0<c.currentSrc.length&&c.play()}.bind(this),c.onprogress=function(){CB.System.isElectron()||this.showMessage("Processing...")}.bind(this),c.onwaiting=function(){CB.System.isElectron()||this.showMessage("Waiting...")}.bind(this),
        c.addEventListener("ended",function(){this.onEndOfVideoHdl(this.playerInstance,this.currentvideoid)}.bind(this)),CB.System.isElectron()||0<c.currentSrc.length&&c.play(),this.startTimer());return b};b.prototype.generateSLPlayer=function(b,e,d){};b.prototype.onError=function(){alert("onError")};b.prototype.generateHTMLHelp=function(b){if(b=document.getElementById(b))b.innerHTML='For instructions click on the <a href="http://play.chessbase.com/js/apps/playchess/playchesscms.html">link</a>';return b};
    b.prototype.stop=function(){var b=document.getElementsByTagName("video")[0];b&&(b.paused||b.pause())};b.prototype.getDuration=function(){var b=0,e=document.getElementsByTagName("video")[0];e&&(b=e.duration);return b};b.prototype.isWindows=function(){return-1!=navigator.appVersion.indexOf("Win")};b.prototype.autoPlay=function(){var b=CB.strUtil.getURLParam("autoplay"),e=!0;null!=b&&0<b.length&&(e="false"!=b);return e};b.prototype.disable=function(){var b=document.getElementById("wmpHolder0");b&&(b.innerHTML=
        '<video controls type="video/mp4"></video>')};b.prototype.setupAzureMediaPlayer=function(){d=CB.MediaPlayerType.MediaPlayerAzure};b.prototype.setupHTML=function(){CB.LOG("Setup HTML");d=CB.MediaPlayerType.MediaPlayerHTML};b.prototype.setupSL=function(b){};b.prototype.setupAzure=function(b){this.htmlHolder=this.generateHTMLPlayer("wmpHolder"+this.playerInstance,320,320,b)};b.prototype.onCurGameChanged=function(){var b=this.gameKernel.getCurPos();if(this.cachepos)for(var e=0;e<this.cachepos.length;e++)if(b.equals(this.cachepos[e])){this.setStartTime(this.cachetime[e]);
        break}};b.prototype.b64_to_utf8=function(b){return decodeURIComponent(escape(window.atob(b)))};b.prototype.setUrl=function(b){this.setupAzure(b)};b.prototype.doResize=function(b,e){if(d==CB.MediaPlayerType.MediaPlayerAzure){var c=document.getElementsByTagName("video")[0];c&&(c.height=e,c.width=b,$("video#video").css("height",e+"px"))}};b.prototype.onSync=function(b){document.getElementById("MediaPlayer1")};b.prototype.onScriptCommand=function(b,e){null!=this.gameKernel&&this.gameKernel.executeGameAction(b,
        e);if(null!=this.watchSessions)this.watchSessions.onGameActionFromStream(b,e)};b.prototype.getCurrentTime=function(){var b=document.getElementsByTagName("video")[0];return b?b.currentTime:0};b.prototype.setCurrentTime=function(b){var c=document.getElementsByTagName("video")[0];c&&(c.currentTime=b)};b.prototype.mustExecute=function(b,e){return b>=e&b<e+1};b.prototype.CMSGameActionsHandler=function(b){b=this.getCurrentTime();var c=document.getElementsByTagName("video")[0];if(c&&!c.paused)this.onGameActionHdl(this.playerInstance,
        b)};b.prototype.saveToCloud=function(){V15.cloudMgr&&V15.cloudMgr.isLoggedIn()&&V15.cloudMgr.saveGameToClipboard(this.gameKernel.game)};b.prototype.showTimedMessage=function(b,e){V15.panelMgr.showMessage(b);this.gameKernel.boardWin.addMessage(b,!0);(new CB.Timer(function(){this.gameKernel.boardWin.destroyMessage()}.bind(this))).runOnce(e)};b.prototype.showMessage=function(b){V15.panelMgr.showMessage(b);this.gameKernel&&(this.gameKernel.boardWin.addMessage(b,!0),(new CB.Timer(function(){this.gameKernel.boardWin.destroyMessage()}.bind(this))).runOnce(3E3))};
    b.prototype.startTimer=function(){this.currenttime=0;null==this.myTimer&&(this.myTimer=setInterval(this.CMSGameActionsHandler.bind(this),1E3))};b.prototype.onWMV=function(b){b=b.substring(1,b.length-2);b=CB.strUtil.base64.decode(b);var c=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.WMV);c.add(b);this.reportBroadcastStreamingData(c)};b.prototype.onGA=function(b){b=b.substring(1,b.length-2);b=CB.strUtil.base64.decode(b);var c=new CB.BroadcastStreamingDataEx;
        b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.GAMEACTIONS);c.add(b);this.reportBroadcastStreamingData(c)};b.prototype.onMP4=function(b){b=b.substring(1,b.length-2);b=CB.strUtil.base64.decode(b);var c=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.MP4);c.add(b);this.reportBroadcastStreamingData(c)};b.prototype.pause=function(){var b=document.getElementsByTagName("video")[0];b&&(b.paused?b.play():b.pause())};b.prototype.play=function(){var b=document.getElementsByTagName("video")[0];
        b&&b.play()};return b}();"use strict";
CB.OfflineVideoElement=function(){var d=function(b,c,e,d,g){this.aMediaplayer=CB.MediaPlayerType.MediaPlayerAzure;this.nInPage=b;this.hasListeners=!1;this.fnGetKernel=c;this.ticket=e;this.gaHandler=d;this.endvideoHandler=g;this.initState()};d.prototype.initElem=function(b){this.videoManager=new CB.OfflineVideoManager(this.nInPage,this.aMediaplayer,b,this.gaHandler,this.endvideoHandler)};d.prototype.initState=function(){};d.prototype.clear=function(){};d.prototype.onNewGame=function(){};d.prototype.resize=
    function(b,c){this.videoManager.doResize(b,c)};d.prototype.disable=function(){this.videoManager.disable()};d.prototype.setUrl=function(b){this.videoManager.setUrl(b)};Ve.initForListeners(d);return d}();CB.OfflineVideoElement.factory=function(d,b,c,e,f,g){b=new CB.OfflineVideoElement(b||0,c,e,f,g);b.initElem(d);return b};"use strict";CB.namespace("CB.BoardTextures");
CB.BoardTextures=function(){var d,b=function(b,c,e,d,f,p){this.localDB=localforage.createInstance({name:"Textures"});this.squaresW=this._loadBitmap(b);this.squaresB=this._loadBitmap(c);this.margin=this._loadBitmap(e);this.background=this._loadBitmap(d);this.callOnSquaresLoaded=function(){};this.callOnBackgroundLoaded=function(){};this.squaresB.callOnLoaded=this._onSquaresLoaded.bind(this);this.squaresW.callOnLoaded=this._onSquaresLoaded.bind(this);this.margin.callOnLoaded=this._onSquaresLoaded.bind(this);
    this.background.callOnLoaded=this._onBackgroundLoaded.bind(this);this.lastSizPix=0;this.cacheB=Array(64);this.cacheW=Array(64);this.clrCoordinates=f;this.clrMarginSepLine=p};b.prototype.destroy=function(){this.callOnSquaresLoaded=this.callOnBackgroundLoaded=null;this.removeAllListeners();this.abortCreateBackground();b.clearCache()};b.clearCache=function(){e=d=0;f={}};b.prototype.isBoardValid=function(){return this.squaresB.loaded&&this.squaresW.loaded&&this.margin.loaded};b.prototype.getSquare=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                c){try{var e=CB.Square.isDark(b);if(!(0>b||63<b))return c==this.lastSizPix?e?void 0===this.cacheB[b]&&(this.cacheB[b]=this._cutSquare(b,c,e)):void 0===this.cacheW[b]&&(this.cacheW[b]=this._cutSquare(b,c,e)):(this.lastSizPix=c,this.cacheB=Array(64),this.cacheW=Array(64),e?this.cacheB[b]=this._cutSquare(b,c,e):this.cacheW[b]=this._cutSquare(b,c,e)),e?this.cacheB[b]:this.cacheW[b]}catch(l){CB.LogException("Tex:getSquare",l)}};b.prototype.drawSquare=function(b,c,e,d){(c=this.getSquare(c,e))&&c.draw(b,
    d.x,d.y)};b.prototype.getMarkedSquare=function(b,c){var e=document.createElement("canvas");e.width=e.height=c;e=e.getContext("2d");this.getSquare(b,c).draw(e,0,0);e.lineWidth=Math.max(1,c/16);e.strokeStyle=this.getOriginSquareMarkerClr();b=c-e.lineWidth;CB.CanvasTools.drawRoundedRect(e,e.lineWidth/2,e.lineWidth/2,b,b,Math.max(1,b/4));b=new CB.Bitmap;b.copyFromCtx(e,0,0,c,c);return b};b.prototype.getOriginSquareMarkerClr=function(){return"hsla( 0, 10%, 10%, 0.4 )"};var c={};CB.PixelFilter&&(c=new CB.PixelFilter);
    var e=d=0;var f={};b.prototype.createBackground=function(b,h,k){V15.panelMgr.useBackgroundFilter()&&c&&600<h&&500<k&&this.background.loaded&&(this.background.drawTiled(b,0,0,h,k),b=b.getImageData(0,0,h,k),c.darkenCorners(b,function(b){d=b.width;e=b.height;f=b;this.fireOnBGReady()}.bind(this)))};b.prototype.abortCreateBackground=function(){c&&c.isRunning&&c.abort()};b.prototype.drawBackground=function(b,c,k){this.background.loaded&&(d==c&&e==k?b.putImageData(f,0,0):this.background.drawTiled(b,0,0,
        c,k))};b.prototype.getTexturesForPieceStyle=function(b){switch(b){default:return CB.CommandIds.BOARD2D_WOOD;case CB.CommandIds.PIECES2D_OLDSTYLE:return CB.CommandIds.BOARD2D_OLDWOOD;case CB.CommandIds.PIECES2D_CRYSTALS:return CB.CommandIds.BOARD2D_CRYSTALS;case CB.CommandIds.PIECES2D_CRYSTALS_WOOD:return CB.CommandIds.BOARD2D_CRYSTALS_WOOD;case CB.CommandIds.PIECES2D_USCF:return CB.CommandIds.BOARD2D_USCF;case CB.CommandIds.PIECES2D_HABSBURG:return CB.CommandIds.BOARD2D_HABSBURG;case CB.CommandIds.PIECES2D_WORLDCHESS:return CB.CommandIds.BOARD2D_WORLDCHESS;
        case CB.CommandIds.PIECES2D_FF:return CB.CommandIds.BOARD2D_FF;case CB.CommandIds.PIECES2D_BLUE:return CB.CommandIds.BOARD2D_BLUE}};b.prototype._loadBitmap=function(b){return CB.Bitmap.createFromDB(this.localDB,b)};b.prototype._storeInLocalDB=function(b){if(!b.url||0!=b.url.search("blob:")){var c=CB.CanvasTools.imgToBlob(b.image,b.width,b.height);if(c)try{this.localDB.setItem(b.url,c)}catch(k){CB.LogException("Tex::_storeInLocalDB",k)}}};b.prototype._cutSquare=function(b,c,e){try{var d=Math.min(this.squaresB.width,
        this.squaresB.height),f=c,g=55;CB.System.isMobile()&&(g=10);c<g?f=2*c:128<c&&(f=.5*c);if(this.squaresB&&this.squaresB.isValid()){var h=Math.floor((d-f)/7),k=83*CB.Square.getFile(b)%7*h,w=41*CB.Square.getRank(b)%7*h;0>k&&(k=0);0>w&&(w=0);var q=e?this.nYOffsBlack:0,u=new CB.Bitmap;this.ctx&&(c==f?u.copyFromCtx(this.ctx,k,w+q,c,c):u.copyScaledFromCtx(this.ctx,k,w+q,c,c,f,f));return u}}catch(y){CB.LogException("Tex:cutSquare",y)}};b.prototype._onSquaresLoaded=function(){this.squaresW.loaded&&this.squaresB.loaded&&
    this.margin.loaded&&(this.canvas=document.createElement("canvas"),this.canvas.width=Math.max(this.squaresW.width,this.squaresB.width),this.canvas.height=this.squaresW.height+this.squaresB.height,this.ctx=this.canvas.getContext("2d"),this.squaresW.draw(this.ctx,0,0),this.nYOffsBlack=this.squaresW.height,this.squaresB.draw(this.ctx,0,this.nYOffsBlack),this.callOnSquaresLoaded&&this.callOnSquaresLoaded(),this._storeInLocalDB(this.squaresW),this._storeInLocalDB(this.squaresB),this._storeInLocalDB(this.margin))};
    b.prototype._onBackgroundLoaded=function(){this.callOnBackgroundLoaded&&this.callOnBackgroundLoaded();this._storeInLocalDB(this.background)};Ve.initForListeners(b);Ve.addEvent(b,"BGReady");return b}();"use strict";
CB.PieceSpriteFactory=function(){var d,b=0,c=function(c,e,d){this.id=++b;this.localDB=localforage.createInstance({name:"Pieces"});c||(c="DiagramTTFritz");this.loaded=!1;this.sqSidePix=d;this.bitmapAll=new CB.Bitmap;this.onLoadedHandlers=new CB.Handlers(this);this.bitmapAll=CB.Bitmap.createFromDB(this.localDB,V15.mediaPathChess+"Pieces/"+c+e+".png");this.bitmapAll.callOnLoaded=this._onLoaded.bind(this);this.urlsW=Array(6);this.urlsB=Array(6);this.name=c},e=[];c.getCachedFactory=function(b,d){var f=
    e[d];f?f.nCacheUse++:(f=new CB.PieceSpriteFactory(b,d,d),f.nCacheUse=0,e[d]=f,c.checkCache(d));return f};c.checkCache=function(b){var c=0;e.forEach(function(){c++});if(6<c){for(var d=1E5,f=-1,l=0;l<e.length;l++)e[l]&&e[l].nCacheUse<d&&l!=b&&(d=e[l].nCacheUse,f=l);0<=f&&delete e[f]}};c.resetCache=function(){e=[]};c.prototype.isValid=function(){return void 0!==this.urlsW[0]};c.prototype.addOnLoadedHandler=function(b){return this.onLoadedHandlers.add(b)};c.prototype.removeOnLoadedHandler=function(b){this.onLoadedHandlers.remove(b)};
    c.prototype.createSprite=function(b){if(CB.Piece.side(b)==CB.Side.BLACK){var c=new CB.Sprite;c.fromUrl(this.urlsB[CB.Piece.nominal(b)-1]);c.piece=b;return c}c=new CB.Sprite;c.fromUrl(this.urlsW[CB.Piece.nominal(b)-1]);c.piece=b;return c};c.prototype.createPromoSprites=function(){this.ctx.clearRect(0,0,this.sqSidePix,this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.W_QUEEN-1)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,0,0,this.sqSidePix,this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.W_KNIGHT-
        1)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,0,.3*this.sqSidePix,.3*this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.W_BISHOP-1)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.W_ROOK-1)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,.6*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix);this.promoWhite=new CB.Sprite(this.ctx);this.promoWhite.fromUrl(this.canvas.toDataURL());
        this.ctx.clearRect(0,0,this.sqSidePix,this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.B_QUEEN-3)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,0,0,this.sqSidePix,this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.B_KNIGHT-3)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,0,.3*this.sqSidePix,.3*this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.B_BISHOP-3)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix);
        this.bitmapAll.draw(this.ctx,(CB.Piece.B_ROOK-3)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,.6*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix);this.promoBlack=new CB.Sprite(this.ctx);this.promoBlack.fromUrl(this.canvas.toDataURL())};c.prototype.getPromoSprite=function(b){return b==CB.Side.BLACK?this.promoBlack:this.promoWhite};c.prototype._onLoaded=function(){void 0===d&&(d=document.createElement("canvas"));this.canvas=d;this.canvas.width=this.sqSidePix;this.canvas.height=
        this.sqSidePix;this.ctx=this.canvas.getContext("2d");for(var b=0;6>b;b++)this.ctx.clearRect(0,0,this.sqSidePix,this.sqSidePix),this.bitmapAll.draw(this.ctx,b*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,0,0,this.sqSidePix,this.sqSidePix),this.urlsW[b]=this.canvas.toDataURL();for(b=6;12>b;b++)this.ctx.clearRect(0,0,this.sqSidePix,this.sqSidePix),this.bitmapAll.draw(this.ctx,b*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,0,0,this.sqSidePix,this.sqSidePix),this.urlsB[b-6]=this.canvas.toDataURL();
        this.loaded=!0;this.createPromoSprites();this.onLoadedHandlers.execute();this._storeInLocalDB(this.bitmapAll)};c.prototype._storeInLocalDB=function(b){if(!b.url||0!=b.url.search("blob:")){var c=CB.CanvasTools.imgToBlob(b.image,b.width,b.height);if(c)try{this.localDB.setItem(b.url,c)}catch(h){CB.LogException("PieceFact::_storeInLocalDB",h)}}};return c}();"use strict";var spriteCache=[];
CB.BoardSprites=function(){var d=function(){this.spritesOnSq=[];this.reservoir=[];this.blindSprites=[]};d.clearCache=function(){spriteCache=[]};d.prototype.initSprites=function(b){for(var c=[0,1,2,3,3,3,10,0,0,1,2,3,3,3,10,0,0],e=CB.Piece.W_KING;e<=CB.Piece.B_PAWN;e++){void 0==this.reservoir[e]&&(this.reservoir[e]=[]);for(var d=0;d<c[e];d++)this.reservoir[e].push(b.createSprite(e))}this.promoWhite=b.getPromoSprite(CB.Side.WHITE);this.promoBlack=b.getPromoSprite(CB.Side.BLACK);this.sqSidePix=b.sqSidePix;
    this.name=b.name};d.prototype.create=function(b){this.initSprites(b)};d.prototype.copy=function(b){for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])};d.prototype.setup=function(b,c,e){if(void 0!==b){if(this.spritesOnSq.length)for(var d=0;64>d;d++)void 0!==this.spritesOnSq[d]&&d!==e&&(this.reservoir[this.spritesOnSq[d].piece]&&this.reservoir[this.spritesOnSq[d].piece].push(this.spritesOnSq[d]),delete this.spritesOnSq[d]);for(d=0;64>d;d++){var g=c[d];g&&d!==e&&(this.spritesOnSq[d]=this.createSprite(b,
    g,d),this.spritesOnSq[d].deleteBackground())}}};d.prototype.changeBoard=function(b,c,e){if(void 0!==b&&0!=this.reservoir.length){for(var d=[],g=[],h=0;64>h;h+=1)0==c[h]||c[h]!=e[h]||void 0!==this.spritesOnSq[h]&&this.spritesOnSq[h].piece===c[h]||(CB.LOG("Repair sprite squares at "+h),void 0!==this.spritesOnSq[h]&&this._toReservoir(this.spritesOnSq[h]),this.spritesOnSq[h]=this.createSprite(b,c[h],h));for(h=0;64>h;h+=1)if(0!==c[h]&&c[h]!=e[h]){var k=this.spritesOnSq[h];k||(k=this.createSprite(b,c[h],
    h));g.push({square:h,piece:c[h],sprite:k});delete this.spritesOnSq[h]}h=[];for(k=1;2>=k;k++)for(var l=0;64>l;l+=1)if(0!=e[l]&&c[l]!=e[l]&&!h[l]){for(var m=!1,p=-1,r=99999,t=0;t<g.length&&!m;t++)if(void 0!=g[t]&&g[t].piece==e[l]&&(2==k||CB.Square.getFile(g[t].square)==CB.Square.getFile(l))){var w=CB.Square.getDist(g[t],l);w<r&&(r=w,p=t)}0<=p&&(this.spritesOnSq[l]=g[p].sprite,d.push(new CB.PieceAnimationJob(e[l],this.spritesOnSq[l],g[p].square,l,V15.Vb.getSquare(g[p].square,b.sqSidePix))),delete g[p],
    m=!0,h[l]=!0);m||2!=k||(this.spritesOnSq[l]=this.createSprite(b,e[l],l),d.push(new CB.PieceAnimationJob(e[l],this.spritesOnSq[l],-1,l,V15.Vb.getSquare(l,b.sqSidePix))))}for(t=0;t<g.length;t++)void 0!=g[t]&&(d.push(new CB.PieceAnimationJob(g[t].piece,g[t].sprite,g[t].square,-1,V15.Vb.getSquare(g[t].square,b.sqSidePix))),this._toReservoir(g[t].sprite),delete g[t]);return d}};d.prototype.set=function(b,c){CB.LOG("BoardSprites set: "+(b?b.piece:"")+", sq="+c);this.spritesOnSq[c]&&this._toReservoir(this.spritesOnSq[c]);
    b?this.spritesOnSq[c]=b:delete this.spritesOnSq[c]};d.prototype.giveBack=function(b){this._toReservoir(b)};d.prototype.createSprite=function(b,c,e){if(this.reservoir[c]&&0<this.reservoir[c].length){for(var d,g=!1,h=0;h<this.reservoir[c].length;h++)e==this.reservoir[c][h].lastSq&&((d=this.reservoir[c][h])&&(g=!0),this.reservoir[c].splice(h,1));g||((d=this.reservoir[c][0])||(d=b.createSprite(c)),this.reservoir[c].shift());d.piece=c;return d}CB.LOG("CB.Piece NOT in reservoir: "+CB.Square.getStr(e),"LogError");
    return b.createSprite(c)};d.prototype.getPromoSprite=function(b){return b==CB.Side.BLACK?this.promoBlack:this.promoWhite};d.prototype.getBlindSprite=function(b,c){this.blindSprites[c]||(this.blindSprites[c]=b.createSprite(c));return this.blindSprites[c]};d.prototype.isAllLoaded=function(){for(var b=0;64>b;b++)if(void 0!==this.spritesOnSq[b]&&!this.spritesOnSq[b].loaded)return!1;if(0==this.reservoir.length)return!1;for(b=CB.Piece.W_KING;b<=CB.Piece.B_PAWN;b++)for(var c=0;c<this.reservoir[b].length;c++)if(!this.reservoir[b][c]||
    !this.reservoir[b][c].loaded)return!1;return!0};d.prototype.change=function(b,c){void 0!==this.spritesOnSq[c]&&this._toReservoir(this.spritesOnSq[c]);this.spritesOnSq[c]=this.spritesOnSq[b];delete this.spritesOnSq[b]};d.prototype.promo=function(b,c,e,d){void 0!==this.spritesOnSq[c]&&this._toReservoir(this.spritesOnSq[c]);this.spritesOnSq[c]=this.createSprite(d,e);this.spritesOnSq[b].deleteBackground();this._toReservoir(this.spritesOnSq[b]);delete this.spritesOnSq[b]};d.prototype.enPassant=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           c,e){this.spritesOnSq[c]=this.spritesOnSq[b];this._toReservoir(this.spritesOnSq[e]);delete this.spritesOnSq[e];delete this.spritesOnSq[b]};d.prototype.deleteBackgrounds=function(){for(var b=0;64>b;b++)void 0!==this.spritesOnSq[b]&&this.spritesOnSq[b].deleteBackground();this.promoWhite&&this.promoWhite.deleteBackground();this.promoBlack&&this.promoBlack.deleteBackground()};d.prototype.getPiece=function(b){return this.spritesOnSq[b]};d.prototype._toReservoir=function(b){this.reservoir[b.piece].push(b)};
    d.prototype._getClickRect=function(b,c){return new CB.Rect(Math.floor(b.x-c/2),Math.floor(b.y-c/2),Math.floor(b.x+c/2),Math.floor(b.y+c/2))};return d}();
CB.PieceAnimationJob=function(){var d=function(b,c,e,d,g){CBDebug.assert(void 0!==c);this.piece=b;this.sprite=c;this.sqFrom=e;this.sqTo=d;this.textureSqTo=g;this.ptFrom=this.ptTo=new CB.Point(0,0)};d.prototype.isBoardAttribute=function(){return!1};d.prototype.isPieceAnim=!0;d.prototype.deleteBackground=function(){this.sprite.deleteBackground()};d.prototype.startAnimation=function(b,c){this.debug="started";this.sprite.hide(b);b=this.ptTo.subtract(this.ptFrom);var e=new CB.Vector(b.x,b.y);this.nAnimCountDown=
    Math.floor(e.getLength()/this.sprite.w*c+.5);this.isFirst=!0;5>this.nAnimCountDown&&(this.nAnimCountDown=5);this.vecDisplace=new CB.Vector(b.x/this.nAnimCountDown,b.y/this.nAnimCountDown);this.currPos=this.ptFrom;if(-1==this.sqFrom||-1==this.sqTo)this.nAnimCountDown=0;this.totCountDown=this.nAnimCountDown};d.prototype.loaded=function(){return this.sprite&&this.sprite.loaded};d.prototype.hide=function(b){if(this.sprite){var c=!1,e=Math.floor(this.sprite.w/2);this.isFirst&&-1!=this.sqFrom?void 0!==
    this.textureSqTo&&(this.textureSqTo.draw(b,this.ptFrom.x-e,this.ptFrom.y-e),this.sprite.saveBeforeMove(b,this.currPos),c=!0):-2==this.nAnimCountDown&&-1==this.sqFrom&&void 0!==this.textureSqTo&&(this.textureSqTo.draw(b,this.ptTo.x-e,this.ptTo.y-e),this.sprite.saveBeforeMove(b,this.currPos),c=!0);c||this.sprite.hide(b)}};d.prototype.show=function(b){this.sprite.show(b)};d.prototype.moveToNoSave=function(b,c){this.sprite.moveToNoSave(b,c)};d.prototype.moveTo=function(b,c){this.sprite.moveTo(b,c)};d.prototype.getPumpedW=
    function(){};d.prototype.getPumpedH=function(){};d.prototype.getPumpFactor=function(){if(this.totCountDown){var b=Math.min(1,(this.totCountDown-this.nAnimCountDown)/this.totCountDown);return.5>b?1+1*b:1+(1-b)}return 1};d.prototype.saveBeforeMove=function(b,c){this.sprite.saveBeforeMove(b,c)};d.prototype.getMoveClipRect=function(){return this.sprite.getMoveClipRect()};d.prototype.deleteBackground=function(){this.sprite.deleteBackground()};d.prototype.displace=function(b){b=this.limitSteps(b);this.currPos.x+=
    b*this.vecDisplace.x;this.currPos.y+=b*this.vecDisplace.y};d.prototype.prepNextStep=function(b){b=this.limitSteps(b);this.nAnimCountDown-=b;this.isFirst=!1;return-2>this.nAnimCountDown};d.prototype.canDelete=function(){return-2>this.nAnimCountDown};d.prototype.limitSteps=function(b){1>=this.nAnimCountDown?b=1:b>this.nAnimCountDown&&(b=this.nAnimCountDown);return b};d.prototype.isDeleteAtEnd=function(){return-1===this.sqTo};d.prototype.shouldHideInThisStep=function(){return-3<=this.nAnimCountDown&&
    void 0!==this.sprite};d.prototype.hasReachedEndPos=function(){return 0>=this.nAnimCountDown};d.prototype.isImmobileInThisStep=function(){return-1>=this.nAnimCountDown};d.prototype.getsInvisibleAtEnd=function(){return-2>=this.nAnimCountDown&&this.isDeleteAtEnd()};d.prototype.isStillMoving=function(){return 0<=this.nAnimCountDown};return d}();"use strict";
CB.BoardFunAnimations=function(){var d=function(b){this.board=b;this.happyRook=null;this.animSteps=ObjUtil.clone(b.animSteps)};d.prototype.cancelFun=function(b){(new CB.Timer(function(){this.board.animSteps=this.animSteps;this.board.redraw()}.bind(this))).runOnce(b)};d.prototype.happySize=d.prototype.defaultSize=64;d.prototype.stampHappy=function(){null==this.happyRook&&(this.happyRook=this.createFunSprite("Happy",this.happySize));var b=new CB.BitmapAnimationJob(this.happyRook,this.getHappyStart(),
    this.getHappyEnd());this.board.animSteps={forMove:3,forPosition:2};this.board.runFunAnimation([b]);this.cancelFun(3E3)};d.prototype.stampCheckOk=function(){null==this.checkMark&&(this.checkMark=this.createFunSprite("Check",this.defaultSize));var b=new CB.BitmapAnimationJob(this.checkMark,this.getHappyStart(),this.getHappyEnd());this.board.animSteps={forMove:4,forPosition:2};this.board.runFunAnimation([b]);this.cancelFun(3E3)};d.prototype.getHappyStart=function(){var b=this.board.getInnerRect().getTopLeft();
    b.x+=this.happySize;b.y+=this.happySize;return b};d.prototype.getHappyEnd=function(){var b=this.board.getInnerRect(),c=b.getTopLeft();c.x+=b.w/2;c.y+=b.h/2;return c};d.prototype.createFunSprite=function(b,c){b=V15.mediaPathChess+"Sprites/"+b+c.toString()+".png";c=new CB.Sprite;c.fromUrl(b);c.noShadow=!0;return c};return d}();
CB.BitmapAnimationJob=function(){var d=function(b,c,e){CBDebug.assert(void 0!==b);this.sprite=b;this.ptFrom=c;this.ptTo=e};d.prototype.isBoardAttribute=function(){return!1};d.prototype.deleteBackground=function(){this.sprite.deleteBackground()};d.prototype.copyBackground=function(b){this.sprite.saveBeforeMove(b,this.ptFrom)};d.prototype.startAnimation=function(b,c){this.debug="started";this.copyBackground(b);b=this.ptTo.subtract(this.ptFrom);var e=new CB.Vector(b.x,b.y);this.nAnimCountDown=Math.floor(e.getLength()/
    this.sprite.w*c+.5);this.isFirst=!0;5>this.nAnimCountDown&&(this.nAnimCountDown=5);this.vecDisplace=new CB.Vector(b.x/this.nAnimCountDown,b.y/this.nAnimCountDown);this.currPos=this.ptFrom};d.prototype.loaded=function(){return this.sprite&&this.sprite.loaded};d.prototype.hide=function(b){this.sprite&&this.sprite.hide(b)};d.prototype.show=function(b){this.sprite.show(b)};d.prototype.moveToNoSave=function(b,c){this.sprite.moveToNoSave(b,c)};d.prototype.moveTo=function(b,c){this.sprite.moveTo(b,c)};d.prototype.saveBeforeMove=
    function(b,c){this.sprite.saveBeforeMove(b,c)};d.prototype.getMoveClipRect=function(){return this.sprite.getMoveClipRect()};d.prototype.deleteBackground=function(){this.sprite.deleteBackground()};d.prototype.displace=function(b){b=this.limitSteps(b);this.currPos.x+=b*this.vecDisplace.x;this.currPos.y+=b*this.vecDisplace.y};d.prototype.prepNextStep=function(b){b=this.limitSteps(b);this.nAnimCountDown-=b;this.isFirst=!1;return-2>this.nAnimCountDown};d.prototype.canDelete=function(){return-2>this.nAnimCountDown};
    d.prototype.limitSteps=function(b){1>=this.nAnimCountDown?b=1:b>this.nAnimCountDown&&(b=this.nAnimCountDown);return b};d.prototype.isDeleteAtEnd=function(){return-1===this.sqTo};d.prototype.shouldHideInThisStep=function(){return-3<=this.nAnimCountDown&&void 0!==this.sprite};d.prototype.hasReachedEndPos=function(){return 0>=this.nAnimCountDown};d.prototype.isImmobileInThisStep=function(){return-1>=this.nAnimCountDown};d.prototype.getsInvisibleAtEnd=function(){return-2>=this.nAnimCountDown&&this.isDeleteAtEnd()};
    d.prototype.isStillMoving=function(){return 0<=this.nAnimCountDown};return d}();"use strict";var attrId=0;
CB.BoardArrow=function(){function d(b){return 0<b?1:0>b?-1:0}var b=function(b,c,d,h,k){this.from=b;this.to=c;this.rgba=d;this.lineWidthPercent=h;this.id=++attrId;this.dash=k};b.prototype.draw=function(c){c.save();var e=this.boardControl.getSquareCenterPos(this.from),g=this.boardControl.getSquareCenterPos(this.to),h=CB.Square.getFile(this.from),k=CB.Square.getRank(this.from),l=CB.Square.getFile(this.to),m=CB.Square.getRank(this.to);k=d(m-k);h=d(l-h);this.boardControl.blackIsBottom?(g.x+=h*this.boardControl.nSqPix/
    4,g.y-=k*this.boardControl.nSqPix/4):(g.x-=h*this.boardControl.nSqPix/4,g.y+=k*this.boardControl.nSqPix/4);h=.5*this.boardControl.nSqPix;this.lineWidthPercent?(c.lineWidth=Math.max(1,this.boardControl.nSqPix*this.lineWidthPercent*.01),h=5*c.lineWidth):c.lineWidth=Math.max(1,.09*this.boardControl.nSqPix);c.lineCap="round";this.rgba?b.setStrokeFillStyles(c,this.rgba,e.x,e.y,g.x,g.y):(l=b.getHslYellow(),c.strokeStyle=(new CB.HSLColor(l.h,l.s,l.l,.75)).toString(),c.fillStyle=(new CB.HSLColor(l.h,l.s,
    l.l,.9)).toString());b.drawArrow(c,e.x,e.y,g.x,g.y,3,1,Math.PI/8,h,.8*c.lineWidth,this.rgba,this.dash);c.restore();return this._getClipRect()};b.setStrokeFillStyles=function(b,c,d,h,k,l){if(c&&(c.alpha||c.hue)){d=b.createLinearGradient(d,h,k,l);var e=c.alpha;c.alpha=.15;d.addColorStop(0,c);c.alpha=.4;d.addColorStop(.4,c);c.alpha=.55;d.addColorStop(.6,c);c.alpha=e;d.addColorStop(1,c);b.strokeStyle=d;b.fillStyle=c}else c&&0==c.search("hsla")?(e=/hsla\(\s*(\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%,\s(.+)\)/g.exec(c),
    d=b.createLinearGradient(d,h,k,l),h=String.f("hsla( {0}, {1}%, {2}%, {3} )",e[1],e[2],e[3],"0.15"),k=String.f("hsla( {0}, {1}%, {2}%, {3} )",e[1],e[2],e[3],"0.4"),l=String.f("hsla( {0}, {1}%, {2}%, {3} )",e[1],e[2],e[3],.55*e[4]),e=String.f("hsla( {0}, {1}%, {2}%, {3} )",e[1],e[2],e[3],e[4]),d.addColorStop(0,h),d.addColorStop(.4,k),d.addColorStop(.6,l),d.addColorStop(1,e),b.strokeStyle=d,b.fillStyle=c):(b.fillStyle=c,b.strokeStyle=c)};b.prototype.undo=function(b){for(var c=CB.Square.getFile(this.from),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                e=CB.Square.getRank(this.from),h=CB.Square.getFile(this.to),k=CB.Square.getRank(this.to),l=d(k-e),m=d(h-c);c!=h||e!=k;){this.boardControl.restoreSquare(b,CB.Square.I(c,e));if(0!=m&&0!=l){var p=CB.Square.I(c+m,e),r=CB.Square.I(c,e+l);0<=p&&64>p&&this.boardControl.restoreSquare(b,p);0<=r&&64>r&&this.boardControl.restoreSquare(b,r)}c!=h&&(c+=m);e!=k&&(e+=l)}0<=c&&0<=e&&this.boardControl.restoreSquare(b,CB.Square.I(c,e));return this._getClipRect()};b.prototype._getClipRect=function(){var b=this.boardControl.getSquareRect(this.from);
    b=b.getUnion(this.boardControl.getSquareRect(this.to));if(this.lineWidthPercent){var c=this.boardControl.nSqPix*this.lineWidthPercent*.01;b.expand(c,c)}return b};b.prototype.toString=function(){return"Arrow: "+CB.Square.toString(this.from)+"-"+CB.Square.toString(this.to)};b.prototype.getId=function(){return"arrow"+this.from+this.to};var c=function(b,c,d,h,k,l,m,p){b.beginPath();b.moveTo(c,d);b.lineTo(h,k);b.lineTo(l,m);switch(p){case 0:p=Math.sqrt((l-c)*(l-c)+(m-d)*(m-d));b.arcTo(h,k,c,d,.55*p);b.fill();
    break;case 1:b.lineTo(c,d);b.fill();break;case 2:b.stroke();break;case 3:b.quadraticCurveTo((c+h+l)/3,(d+k+m)/3,c,d);b.fill();break;case 4:if(l==c)p=m-d,l=(h+c)/2,h=(h+c)/2,m=k+p/5,p=k-p/5;else{p=Math.sqrt((l-c)*(l-c)+(m-d)*(m-d));h=((c+l)/2+h)/2;k=((d+m)/2+k)/2;l=(m-d)/(l-c);p=p/(2*Math.sqrt(l*l+1))/5;var e=l*p;l=h-p;m=k-e;h+=p;p=k+e}b.bezierCurveTo(l,m,h,p,c,d);b.fill()}};c=function(b,c,d,h,k,l,m,p){b.beginPath();b.moveTo(c,d);b.lineTo(h,k);b.lineTo(l,m);switch(p){case 0:p=Math.sqrt((l-c)*(l-c)+
    (m-d)*(m-d));b.arcTo(h,k,c,d,.55*p);b.fill();break;case 1:b.lineTo(c,d);b.fill();break;case 2:b.stroke();break;case 3:b.quadraticCurveTo((c+h+l)/3,(d+k+m)/3,c,d);b.fill();break;case 4:if(l==c)p=m-d,l=(h+c)/2,h=(h+c)/2,m=k+p/5,p=k-p/5;else{p=Math.sqrt((l-c)*(l-c)+(m-d)*(m-d));h=((c+l)/2+h)/2;k=((d+m)/2+k)/2;l=(m-d)/(l-c);p=p/(2*Math.sqrt(l*l+1))/5;var e=l*p;l=h-p;m=k-e;h+=p;p=k+e}b.bezierCurveTo(l,m,h,p,c,d);b.fill()}};b.drawFree=function(b,c,d,h,k,l,m,p){b.save();b.lineWidth=l;b.lineCap="round";CB.BoardArrow.drawArrow(b,
    c,d,h,k,3,1,Math.PI/8,6*l,.8*b.lineWidth,m,p);b.restore()};b.drawArrow=function(e,d,g,h,k,l,m,p,r,t,w,q){l="undefined"!=typeof l?l:3;m="undefined"!=typeof m?m:1;p="undefined"!=typeof p?p:Math.PI/8;r="undefined"!=typeof r?r:10;t=t||0;var f="function"!=typeof l?c:l,y=h-d,z=k-g,A=Math.sqrt(y*y+z*z);if(0!=A){var C=Math.atan2(k-g,h-d),B=t*Math.cos(C);t*=Math.sin(C);A=(A-.76*r)/A;m&1?(y=d+y*A-B,z=g+z*A-t):(y=h,z=k);m&2?(B=d+(h-d)*(1-A),A=g+(k-g)*(1-A)):(B=d,A=g);e.save();w?b.setStrokeFillStyles(e,w,B,A,
    y,z):(w=e.createLinearGradient(B,A,y,z),t=b.getHslYellow(),w.addColorStop(0,(new CB.HSLColor(t.h,t.s,t.l,.2)).toString()),w.addColorStop(.2,(new CB.HSLColor(t.h,t.s,t.l,.35)).toString()),w.addColorStop(.65,(new CB.HSLColor(t.h,t.s,t.l,.55)).toString()),w.addColorStop(1,(new CB.HSLColor(t.h,t.s,t.l,.9)).toString()),e.strokeStyle=w);e.beginPath();q&&e.setLineDash(q);e.moveTo(B,A);e.lineTo(y,z);e.stroke();r=Math.abs(r/Math.cos(p));m&1&&(w=C+Math.PI+p,q=h+Math.cos(w)*r,w=k+Math.sin(w)*r,z=C+Math.PI-p,
    y=h+Math.cos(z)*r,z=k+Math.sin(z)*r,f(e,q,w,h,k,y,z,l));m&2&&(w=C+p,q=d+Math.cos(w)*r,w=g+Math.sin(w)*r,z=C-p,y=d+Math.cos(z)*r,z=g+Math.sin(z)*r,f(e,q,w,d,g,y,z,l));e.restore()}};b.getHslYellow=function(){return{h:40,s:90,l:60}};return b}();
CB.BoardColouredSquare=function(){var d=function(b,c,e){this.sq=b;this.rgba=c;this.isWholeSquare=e;this.id=++attrId};d.prototype.draw=function(b){return this.drawFrame(b)};d.prototype.drawFrame=function(b){var c=this.boardControl.getSquareCenterPos(this.sq);b.strokeStyle=this.rgba?b.fillStyle=this.rgba.toString():b.fillStyle="rgba( 255, 220, 10, 0.5 )";var e=16;this.isWholeSquare&&(e=10);b.lineWidth=Math.max(1,this.boardControl.nSqPix/e);this.boardControl.drawSquare(b,this.sq);e=this.boardControl.nSqPix-
    b.lineWidth;var d=e-0;CB.CanvasTools.drawRoundedRect(b,c.x-e/2,c.y-e/2,d,d,Math.max(1,d/3.5));this.boardControl.drawPiece(b,this.sq);return this._getClipRect()};d.prototype.drawWhole=function(b){var c=this.boardControl.getSquareCenterPos(this.sq);CB.Square.getFile(this.sq);CB.Square.getRank(this.sq);b.lineWidth=Math.max(1,.08*this.boardControl.nSqPix);this.rgba?b.strokeStyle=b.fillStyle=this.rgba:(b.strokeStyle="rgba( 255, 220, 10, 0.6 )",b.fillStyle="rgba( 255, 220, 10, 0.6 )");var e=.5*this.boardControl.nSqPix;
    b.fillRect(c.x-e,c.y-e,2*e,2*e);return this._getClipRect()};d.prototype.undo=function(b){var c=CB.Square.getFile(this.sq),e=CB.Square.getRank(this.sq);this.boardControl.restoreSquare(b,CB.Square.I(c,e));return this._getClipRect()};d.prototype._getClipRect=function(){return this.boardControl.getSquareRect(this.sq)};d.prototype.toString=function(){return"Sq="+CB.Square.toString(this.sq)+", Clr="+this.rgba};d.fromJson=function(b){this.sq=b.sq};d.prototype.getId=function(){return"square"+this.sq};return d}();
CB.BoardLinePoint=function(){var d=function(b,c,e){this.sq=b;this.corner=c;this.inside=e};d.stringToPoints=function(b){var c=[];if(b=b.match(/[a-h][1-8][t,b][l,r]/ig))for(var e=0;e<b.length;e++){var d=CB.Square.fromString(b[e].substr(0,2));c.push(new CB.BoardLinePoint(d,b[e].substr(2,2)))}return c};d.prototype.getXY=function(b,c){this.inside&&(c=0);var e=b.getPixPos(this.sq);b=b.nSqPix;switch(this.corner){case "tl":e.x-=c/2;e.y-=c/2;break;case "tr":e.x+=b+c/2;e.y-=c/2;break;case "bl":e.x-=c/2;e.y+=
    b+c/2;break;case "br":e.x+=b+c/2;e.y+=b+c/2;break;case "ct":e.x+=b/2;e.y+=b/2;break;case "bm":e.x+=b/2+c/2;e.y+=b+c/2;break;case "tm":e.x+=b/2+c/2;e.y-=c/2;break;case "lm":e.x-=c/2;e.y+=b/2+c/2;break;case "rm":e.x+=b+c/2,e.y+=b/2+c/2}return e};d.prototype.getClipRect=function(b,c){var e=b.getPixPos(this.sq);b=b.nSqPix;b+=2*c;e.x-=c;e.y-=c;c=new CB.Rect;c.fromTwoPoints(e.x,e.y,e.x+b,e.y+b);return c};d.prototype.toString=function(){return"Point: Sq="+CB.Square.toString(this.sq)+", Corner="+this.corner};
    d.prototype.getId=function(){return"point"+this.sq+this.corner};return d}();
CB.BoardLine=function(){var d=function(b,c,e,d){this.points=b||[];this.thickPercent=c||10;this.clr=e;this.dash=d;this.id=++attrId};d.prototype.draw=function(b){b.save();b.strokeStyle=this.clr?b.fillStyle=this.clr:b.fillStyle="hsla( 0, 50%, 70%, 0.6 )";b.lineCap="round";b.lineWidth=this.getLineWidthPixel();if(this.points.length){b.beginPath();this.dash&&this.dash.length&&b.setLineDash(this.dash);var c=this.points[0].getXY(this.boardControl,b.lineWidth);b.moveTo(c.x,c.y);for(var e=1;e<this.points.length;e++)c=
    this.points[e].getXY(this.boardControl,b.lineWidth),b.lineTo(c.x,c.y);b.stroke()}b.restore();return this._getClipRect()};d.prototype.undo=function(b){return this._getClipRect()};d.prototype.getLineWidthPixel=function(){return Math.max(1,this.boardControl.nSqPix*this.thickPercent/100)};d.prototype._getClipRect=function(){for(var b=null,c=0;c<this.points.length;c++)b=null==b?this.points[c].getClipRect(this.boardControl,this.getLineWidthPixel()):b.getUnion(this.points[c].getClipRect(this.boardControl,
    this.getLineWidthPixel()));return b};d.prototype.toString=function(){return"Line: "+this.clr.toString()+"/"+this.thickPercent};d.prototype.getId=function(){return"line"+this.points.join(",")};return d}();
CB.BoardZone=function(){var d=function(b,e,d,g,h,k,l){this.from=b;this.to=e;this.thick=d;this.clr=g;this.dash=h;this.boardControl=k;this.inside=l;this.init()};d.prototype.init=function(){this.edges=this.getEdgeSquares(this.from,this.to);this.id=this.getId();this.createLine()};d.prototype.getEdgeSquares=function(c,e){c=[c,e,8*Math.floor(c/8)+e%8,8*Math.floor(e/8)+c%8];b(c);return c};var b=function(b){b.sort(function(b,c){var e=Math.floor(b/8),d=Math.floor(c/8);return e!=d?e-d:b%8-c%8});b[2]=[b[3],
    b[3]=b[2]][0];b[2]==b[3]&&8>b[2]-b[1]&&(b[1]=[b[3],b[3]=b[1]][0])};d.prototype.createLine=function(){var b=["bl","tl","tr","br"];this.boardControl.blackIsBottom&&(b=["tr","br","bl","tl"]);b=b.map(function(b,c){return new CB.BoardLinePoint(this.edges[c],b,this.inside)}.bind(this));b.push(new CB.BoardLinePoint(this.edges[0],this.boardControl.blackIsBottom?"tr":"bl",this.inside));b=new CB.BoardLine(b,this.thick,this.clr,this.dash);b.boardControl=this.boardControl;this.line=b};d.prototype.draw=function(b){return this.line.draw(b)};
    d.prototype.undo=function(b,e){return this.line.undo(b,e)};d.prototype.toString=function(){return"Zone: "+this.edges.join(",")};d.prototype.getId=function(){return"zone"+this.edges.join(",")};d.fromLiteral=function(b,e){Object.setPrototypeOf(b,d.prototype);b.boardControl=e;b.init();return b};return d}();"use strict";
CB.BoardArea=function(){function d(b,e,d,g){var c=!1,f=d.event;void 0===f&&(f=d);for(d=0;d<b.length;d++)b[d]&&b[d].isInMyArea(g.x,g.y)&&(e.call(b[d],f,g),c=!0);return c}var b=function(b,e,d,g){this.cbcanvas=b;this.width=e;this.height=d;this.options=g;this.boards=[];this.shadows=[];b=CB.System.isFirefox()||CB.System.isSafari()||CB.System.runsInIFrame();if(!b&&!this.isTransparent()){for(e=0;4>e;e++)this.shadows[e]=new CB.DivElement(this.cbcanvas.canvas.parentElement,"BAreaShadow"+e),this.shadows[e].setVisible(!b&&
    0==e&&!V15.isBoardOnlyApp());this.shadows[0].setCssClass("BoardAreaShadowT");this.shadows[1].setCssClass("BoardAreaShadowR");this.shadows[2].setCssClass("BoardAreaShadowB");this.shadows[3].setCssClass("BoardAreaShadowL")}g&&g.suppressCalcGeometry||this.calcGeometry();this.idStyleListener=glSettings.addOnBoardStyleListener(function(){(new CB.Timer(function(){this.calcGeometry()}.bind(this))).runOnce(300)}.bind(this));V15.Vb.callOnBackgroundLoaded=this.onBackgroundTexturesLoaded.bind(this)};b.prototype.addBoard=
    function(b){this.boards.push(b);b.idBoardAreaHandler=b.onReadyHandlers.add(this.onBoardReady.bind(this))};b.prototype.removeBoard=function(b){b=this.getInxOfBoard(b);void 0!==b&&(b=this.boards.splice(b,1),b[0]&&b[0].destroy(),this.drawBackground(this.cbcanvas.bufferCtx),this.cbcanvas.requestRedraw(),CB.LOG("RemoveBoard: "+b[0].debugName))};b.prototype.getSizeRatio=function(){return this.width/this.height};b.prototype.onDestroyDOM=function(){this.removeAllBoards()};b.prototype.removeAllBoards=function(){for(var b=
    0;b<this.boards.length;b++)this.boards[b]&&this.boards[b].destroy();this.boards=[];this.calcGeometry()};b.prototype.setPosInput=function(b){this.boards=[];this.addBoard(b);this.drawBackground(this.cbcanvas.bufferCtx);this.calcGeometry()};b.prototype.removePosInput=function(b){this.boards=[];this.boards.push(b);this.calcGeometry();this.drawBackground(this.cbcanvas.bufferCtx);this.calcGeometry();this.cbcanvas.requestRedraw()};b.prototype.getInxOfBoard=function(b){for(var c=0;c<this.boards.length;c++)if(this.boards[c]&&
    this.boards[c].uniqueId==b.uniqueId)return c};b.prototype.draw=function(b){try{this.drawForeground(b),this.needsShadows=!1}catch(e){CB.LogException("AreaDraw",e)}};b.prototype.setBackgroundStyle=function(){this.cbcanvas.canvas.style.backgroundImage="url( '"+V15.Vb.background.url+"' )"};b.prototype.drawWood=function(b){for(var c=0;c<this.boards.length;c++)this.boards[c]&&this.boards[c].drawWood(b,this.boardHasShadow())};b.prototype.drawForeground=function(b){for(var c=0;c<this.boards.length;c++)this.boards[c]&&
this.boards[c].draw(b,this.boardHasShadow())};b.prototype.drawBackground=function(b){this.isTransparent()?this.needsShadows=!0:void 0!==b&&V15.Vb.background&&V15.Vb.background.loaded&&(V15.Vb.drawBackground(b,this.width,this.height),this.needsShadows=!0)};b.prototype.beforeResize=function(){for(var b=0;b<this.boards.length;b++)this.boards[b]&&this.boards[b].beforeResize()};b.prototype.resize=function(b,e){this.width=b;this.height=e;this.calcGeometry()};b.prototype.forceResize=function(){this.resize(this.width,
    this.height)};b.prototype.getInfoWin=function(){if(!this.infoWin){var b=$("<div class='cbBoardAreaInfo'><div id='idBoardAreaInfo'></div></div>");b.hide();$(this.cbcanvas.canvas.parentElement).parent().append(b);this.infoWin=b[0]}return this.infoWin};b.prototype.removeInfoWin=function(){this.infoWin&&$(this.infoWin).remove();delete this.infoWin};b.prototype.calcGeometry=function(){this.infoWin&&$(this.infoWin).hide();this.cbcanvas&&(this.bgListenerId&&V15.Vb.removeOnBGReadyListener(this.bgListenerId),
    this.bgListenerId=V15.Vb.addOnBGReadyListener(this.onBGReady.bind(this)),V15.Vb.createBackground(this.cbcanvas.ctx,this.width,this.height));this.boards.forEach(function(b){b.setTitleVisible(!1)});this.nBoardCallbacksExpected=this.boards.length;this.arrangeBoards();this.cbcanvas.block(!1);0===this.boards.length&&void 0!==this.cbcanvas.control&&this.cbcanvas.requestRedraw();var b=this.cbcanvas.pixToZoom(this.width),e=this.cbcanvas.pixToZoom(this.height),d=Math.min(e/50,10),g=Math.min(b/50,10);this.shadows&&
4==this.shadows.length&&(this.shadows[0].setPosSize(0,0,b,g),this.shadows[1].setPosSize(b-g,d,d,e-2*d),this.shadows[2].setPosSize(0,e-d,b,d),this.shadows[3].setPosSize(0,d,g,e-2*d));this.infoWin&&($(this.infoWin).css("width",b/2),b=this.height/10,$(this.infoWin).css("height",b),$(this.infoWin).css("position","absolute"),$(this.infoWin).css("top",this.height/60),$(this.infoWin).css("left",this.width/4))};b.prototype.onMouseDown=function(b,e){this.boards.length&&d(this.boards,this.boards[0].onMouseDown,
    b,e)};b.prototype.onContextMenu=function(b,e){this.boards.length&&d(this.boards,this.boards[0].onContextMenu,b,e)};b.prototype.onMouseUp=function(b,e){if(this.boards.length&&!d(this.boards,this.boards[0].onMouseUp,b,e)&&1==this.boards.length)this.boards[0].onMouseUp(b,e)};b.prototype.onMouseWheel=function(b,e){this.boards.length&&d(this.boards,this.boards[0].onMouseWheel,b,e)};b.prototype.onMouseMove=function(b,e){if(this.boards.length)if(1==this.boards.length)this.boards[0].onMouseMove(b,e);else d(this.boards,
    this.boards[0].onMouseMove,b,e)};b.prototype.onMouseEnter=function(b,e){this.boards.length&&d(this.boards,this.boards[0].onMouseEnter,b,e)};b.prototype.onMouseLeave=function(b,e){this.boards.length&&d(this.boards,this.boards[0].onMouseLeave,b,e)};b.prototype.onDoubleClick=function(b,e){};b.prototype.onBackgroundTexturesLoaded=function(){this.width&&this.cbcanvas&&V15.Vb.createBackground(this.cbcanvas.ctx,this.width,this.height);this.cbcanvas.onControlBackgroundReady();if(void 0!==this.onReady)this.onReady()};
    b.prototype.getClickPos=function(b){var c=this.cbcanvas.canvas.getBoundingClientRect();return new CB.Point(b.getX()-c.left,b.getY()-c.top)};b.prototype.getLayout=function(b,e,d){var c={w:10,nX:b,nY:1};if(0==b)return c;var f=Math.max(e,d);c.w=Math.round(Math.min(Math.min(e,d)-0,Math.floor(f/b)));if(0==c.w)return c;f==e?(c.nX=b,c.nY=1):(c.nX=1,c.nY=b);f=b;for(var k=1;k<=b;){var l=Math.floor(Math.min(e/f,d/k));c.w<l&&(c.w=l,c.nX=f,c.nY=k);k++;f=Math.floor(b/k);b!=f*k&&f++}1==f&&1<k&&1==b?(c.h=d,c.w=
        e):c.h=c.w;return c};b.prototype.arrangeBoards=function(){if(0!=this.boards.length){var b=this.width,e=this.height,d=0,g=0;this.infoWin&&(e-=this.height/8,g+=this.height/8);var h=0;if(1<this.boards.length&&this.options.splitLayout){var k=this.width-this.height;if(Math.abs(k)>.2*Math.max(this.width,this.height)&&0<k){d=this.width-k;var l=Math.min(d,this.height);b=k;g=6;e=l-2*g;h=1}}k=this.getLayout(this.boards.length-h,b,e);if(0!=k.w){b=Math.floor((b-k.nX*k.w)/(k.nX+1));e=Math.floor((e-k.nY*k.h)/(k.nY+
        1));var m=new CB.Size(k.w,k.h);if(1==this.boards.length)this.boards[0].setLeftSpace(b),this.boards[0].setPosSize(new CB.Point(b,0),m);else for(0<h&&(this.boards[0].setLeftSpace(b),this.boards[0].setTitleVisible(!0),this.boards[0].setPosSize(new CB.Point(0,0),new CB.Size(l,l))),l=0;l<k.nX;l++)for(var p=d+b+l*(b+k.w),r=0;r<k.nY;r++){var t=g+e+r*(e+k.w);h<this.boards.length&&(t=new CB.Point(p,t),this.boards[h].setLeftSpace(b),this.boards[h].setTitleVisible(!0),this.boards[h].setPosSize(t,m),h++)}}}};
    b.prototype.clearBackground=function(){CB.LOG("Area.ClearBackground","LogBold");this.drawBackground(this.cbcanvas.bufferCtx);this.cbcanvas.requestRedraw()};b.prototype.onBoardReady=function(b){--this.nBoardCallbacksExpected;0>=this.nBoardCallbacksExpected&&(CB.LOG("Area.OnBoardReady..redraw","LogBlue","board"),this.drawBackground(this.cbcanvas.bufferCtx),this.cbcanvas.requestRedraw(),this.boards.forEach(function(b){b.setTitleVisible(!0);void 0!==b.rightWin&&b.rightWin.setVisible(!0)}),this.nBoardCallbacksExpected=
        this.boards.length);this.infoWin&&$(this.infoWin).show()};b.prototype.onBGReady=function(){this.drawBackground(this.cbcanvas.bufferCtx);this.cbcanvas.requestRedraw()};b.prototype.isTransparent=function(){return this.options?this.options.transparent:!1};b.prototype.boardHasShadow=function(){return this.options?this.options.boardShadow&&this.needsShadows:this.needsShadows};return b}();"use strict";
CB.RawBoardControl=function(){var d=1,b=function(){this.options={};this.permanentAttributes=[]};b.prototype.init=function(b,c,e,k){this.cbcanvas||(this.cbcanvas=b,this.ptTopLeft={x:0,y:0},this.y=0,this.width=this.nBoardOuterW=c,this.height=this.nBoardOuterH=e,this.debugName=k,this.blackIsBottom=!1,this.allowInput=!0,this.enableEvaluation=!1,this.evaluation=0,this.enableCoordinates=!0,this.calcGeometry(),this.board=new CB.Board,this.moveEntry=new CB.MoveEntry(this),this.legalFromSquares={},this.pieceFontName=
    "DiagramTTFritz",this.boardSprites=new CB.BoardSprites,this.animation=new CB.Animation(this.cbcanvas),this.jobsWaitingForSpriteLoad=[],this.onReadyHandlers=new CB.Handlers(this),this.idPieceFactoryHandler=null,this.nMarginW=1,V15.Vb.callOnSquaresLoaded=this.onSquareTexturesLoaded.bind(this),this.uniqueId=d++,this.animSteps={forMove:.6,forPosition:1},this.resizeTimer=new CB.Timer(this.resizeHdl.bind(this)),this.animation.callOnAnimFinished=function(){this.currPiece&&this.buttonDown&&(this.currPiece.moveTo(this.cbcanvas.bufferCtx,
    this.currPiece.pos),this.cbcanvas.joinClipRect(this.currPiece.getMoveClipRect()));this.renderQueuedAttributes(!0);this.callOnAnimFinished&&this.callOnAnimFinished(this)}.bind(this),this.animation.callOnBeforeEveryStep=function(){this.currPiece&&this.buttonDown&&(this.currPiece.hide(this.cbcanvas.bufferCtx),this.currPiece.deleteBackground(),this.cbcanvas.joinClipRect(this.currPiece.getMoveClipRect()))}.bind(this),this.animation.callOnAfterEveryStep=function(){this.currPiece&&this.buttonDown&&(this.currPiece.moveTo(this.cbcanvas.bufferCtx,
    this.currPiece.pos),this.cbcanvas.joinClipRect(this.currPiece.getMoveClipRect()))}.bind(this))};b.prototype.destroy=function(){this.destroyTitle();this.destroyMessage();this.destroyRightWin();this.destroyBottomWin();this.destroySubTitle();this.onReadyHandlers.remove(this.idBoardAreaHandler);this.onReadyHandlers.empty();this.idStyleListener&&glSettings.removeOnBoardStyleListener(this.idStyleListener);this.setGame(null);this.enableEvaluation=!1;this.shouldAnimatePosChange=this.fnBoardClick=this.fnSquareRelease=
    this.fnSquareChangeInMouseMove=this.fnMarkSquaresOnButtonDown=this.fnSquareClick=null;this.pieceSpriteFactory&&null!=this.idPieceFactoryHandler&&this.pieceSpriteFactory.removeOnLoadedHandler(this.idPieceFactoryHandler);this.idPieceFactoryHandler=null};b.prototype.onRecycle=function(){};b.prototype.addStyleListener=function(){this.idStyleListener=glSettings.addOnBoardStyleListener(this.onBoardStyle.bind(this))};b.prototype.onBoardStyle=function(b,c){V15.setBoardTextures(CB.BoardTextures.prototype.getTexturesForPieceStyle(b));
    this.changeBoardStyle(b,c)};b.prototype.changeBoardStyle=function(b,c){CB.PieceSpriteFactory.resetCache();this.pieceFontName=c;this.nSqPix=0};b.prototype.setPosSize=function(b,c){this.ptSetPos=b;var e=new CB.Size(0,0),d=new CB.Size(0,0);void 0!==this.subTitleWin&&(d.h=this.cbcanvas.pixToZoom(7));this.ptTopLeft=new CB.Point(Math.round(b.x+e.w),Math.round(b.y+e.h));this.width=Math.round(c.w-e.w);this.height=Math.round(c.h-e.h-d.h);this.resize(this.width,this.height)};b.prototype.getPos=function(){return this.ptSetPos?
    this.ptSetPos:this.ptTopLeft};b.prototype.beforeResize=function(){this.titleWin&&this.titleWin.setVisible(!1)};b.prototype.resize=function(b,c){this.killAnimations();this.width=b;this.height=c;CB.LOG("RawBrd.RESIZE: w="+this.width+", h="+this.height,"LogBold","resize");b&&c?this.resizeTimer.runOnce(10):this.resizeTimer.stop();this.currPiece&&this.currPiece.deleteBackground()};b.prototype.resizeHdl=function(){this.resizeTimer.stop();this.killAnimations();this.renderedAttributes=[];var b=this.nSqPix;
    this.calcGeometry();b!=this.nSqPix||void 0===this.pieceSpriteFactory||this.rightWin?(this.boardSprites=new CB.BoardSprites,this.pieceSpriteFactory=this.createPieceSpriteFactory()):this.boardSprites.isAllLoaded()&&(this.boardSprites.deleteBackgrounds(),this.onReadyHandlers.count()?this.onReadyHandlers.execute():this.cbcanvas.requestRedraw());this.canShowTitle()?(this.titleWin.onResize(this),this.titleWin.setVisible(!0)):this.titleWin&&this.titleWin.setVisible(!1);if(void 0!==this.messageWin)this.messageWin.onResize(this);
    if(void 0!==this.rightWin)this.rightWin.onResize(this);void 0!==this.bottomWin&&(this.bottomWin.canShowIfHeight(this.height,this.cbcanvas)?(this.bottomWin.setVisible(!0),this.bottomWin.onResize(this)):this.bottomWin.setVisible(!1));this.subTitleWin&&(this.subTitleWin.onResize(this),this.subTitleWin.setVisible(!0))};b.prototype.createPieceSpriteFactory=function(){var b=CB.PieceSpriteFactory.getCachedFactory(this.pieceFontName,this.nSqPix);b.loaded?(this.idPieceFactoryHandler=null,(new CB.Timer(function(){this.createBoardSprites()}.bind(this))).runOnce(10)):
    this.idPieceFactoryHandler=b.addOnLoadedHandler(this.createBoardSprites.bind(this));return b};b.prototype.calcGeometry=function(){var b=this.height;if(this.options){var c=this.options.topDist||0;var e=this.options.bottomDist||0;!c&&this.options.marginDistDivisor&&(c=b/this.options.marginDistDivisor);!e&&this.options.marginDistDivisor&&(e=b/this.options.marginDistDivisor)}else c=V15.config.board2DTopOffset,e=V15.config.board2DBottomOffset;b-=c+e;c=0;this.canShowTitle()&&(c=this.titleWin.getDesiredHeight(this.height,
    this.cbcanvas),this.titleWin.getSpacingToBoard&&(c+=this.titleWin.getSpacingToBoard(this.height,this.cbcanvas)));b-=c;e=0;void 0!==this.bottomWin&&this.bottomWin.canShowIfHeight(this.height,this.cbcanvas)&&(e=this.bottomWin.getDesiredHeight(this.height,this.cbcanvas),this.bottomWin.confirmHeight(e,this.cbcanvas),e+=this.bottomWin.getSpacingToBoard(this.height,this.cbcanvas),b-=e);b=Math.round(b);var d=this.width,l=0;void 0!==this.rightWin&&(l=this.rightWin.getDesiredWidth(this.width,this.height,this.cbcanvas));
    d-=l;this.nBoardOuterW=Math.min(d-.056*d,b);this.options&&this.options.marginDistDivisor&&(this.nBoardOuterW-=Math.floor(this.nBoardOuterW/this.options.marginDistDivisor));this.enableCoordinates=480<=this.nBoardOuterW;this.options&&this.options.minWForCoordinates&&(this.enableCoordinates=this.nBoardOuterW>=this.options.minWForCoordinates);this.nMarginW=this.calcMarginW();this.nBoardInnerW=this.nBoardOuterW-2*this.nMarginW;this.nDesiredSqPix=this.nSqPix=Math.floor(this.nBoardInnerW/8);this.nSqPix=
        CB.RawBoardControl.getAvailSqPix(this.nDesiredSqPix);1>this.nSqPix&&(this.nSqPix=1);this.nBoardInnerW=8*this.nSqPix;this.nBoardOuterW=this.nBoardInnerW+2*this.nMarginW;this.sqOffs=0;this.x0=Math.floor(this.ptTopLeft.x+(this.width-this.nBoardOuterW-l)/2+.5);this.y0=Math.floor(this.ptTopLeft.y+c+Math.min((this.height-c-e-this.nBoardOuterW)/2,100));this.options&&this.options.shiftXPercent&&(this.x0=Math.floor(this.x0+this.nBoardOuterW*this.options.shiftXPercent/100))};b.getAvailSqPix=function(b){var c=
    [160,152,144,138,132,126,120,114,110,106,102,98,94,90,88,84,82,80,78,76,74,72,70,68,66,64,62,60,58,56,54,52,50,48,46,44,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,12,10,8],e;for(e=0;e<c.length;e++)if(b>=c[e]){b=c[e];break}e>=c.length&&(b=8);return b};b.prototype.calcMarginW=function(){return this.enableCoordinates?this.options&&this.options.bigCoords?Math.max(12,Math.round(Math.min(24,this.nBoardOuterW/25))):Math.max(6,Math.round(Math.min(16,this.nBoardOuterW/
    40))):Math.round(Math.min(12,this.nBoardOuterW/60))};b.prototype.setTitleText=function(b){this.titleWin&&this.titleWin.setText(b);this.debugName=b};b.prototype.addTitle=function(b,c,e){void 0===this.titleWin&&(this.titleWin=new CB.BoardTitle(this,b,function(b){this.fnBoardClick(this.uniqueId);b.preventDefault()}.bind(this),"",c,function(b){e(b)}));return this.titleWin};b.prototype.addLogo=function(b){void 0===this.titleWin&&(this.titleWin=new CB.BoardLogo(this,b));return this.titleWin};b.prototype.setTitleWin=
    function(b){this.destroyTitle();this.titleWin=b;this.resizeHdl()};b.prototype.setTitleAndBottom=function(b,c){this.destroyTitle();this.destroyBottomWin();this.titleWin=b;this.bottomWin=c};b.prototype.canShowTitle=function(){return window.V15&&V15.isBoardOnlyApp()?this.titleWin&&210<Math.min(this.height,this.width):this.titleWin&&100<Math.min(this.height,this.width)};b.prototype.setTitleVisible=function(b){this.canShowTitle()&&this.titleWin.setVisible(b)};b.prototype.addSubTitle=function(){this.subTitleWin||
(this.subTitleWin=new CB.BoardSubTitle(this),this.resizeTimer.runOnce(10));return this.subTitleWin};b.prototype.setLeftSpace=function(b){this.nLeftSpace=b};b.prototype.addPlayingClock=function(b){return this.elemClock=this.titleWin=new CB.PlayingClockElm(this,this.getOuterRect().h/16,b)};b.prototype.removePlayingClock=function(){this.elemClock&&(this.elemClock.destroy(),this.elemClock=null,this.destroyTitle(),this.titleWin=null)};b.prototype.destroyTitle=function(){this.titleWin&&this.titleWin.destroy();
    delete this.titleWin};b.prototype.destroySubTitle=function(){this.subTitleWin&&(this.subTitleWin.destroy(),delete this.subTitleWin)};b.prototype.destroyMessage=function(){this.messageWin&&this.messageWin.destroy();delete this.messageWin};b.prototype.destroyRightWin=function(){this.rightWin&&this.rightWin.destroy();delete this.rightWin};b.prototype.destroyBottomWin=function(){this.bottomWin&&this.bottomWin.destroy();delete this.bottomWin};b.prototype.hasClock=function(){return this.titleWin&&this.titleWin.getClock()};
    b.prototype.getClockDisplay=function(){if(this.titleWin)return this.titleWin.getClock()};b.prototype.addModalMessage=function(b){this.destroyMessage();return this.addMessage(b,!0,!0)};b.prototype.addMessage=function(b,c,e){if(this.messageWin||c)this.messageWin?this.messageWin.setText(b):(this.messageWin=new CB.BoardMessage(this,b,e),this.messageWin.setVisible(!0)),this.messageWin.onResize(this)};b.prototype.addBubble=function(b,c,e,d){this.messageWin&&(this.messageWin.destroy(),delete this.messageWin);
        this.messageWin=new CB.BoardBubble(b,c,e,d);this.messageWin.setVisible(!0);this.messageWin.onResize(this)};b.prototype.addRightWin=function(b){this.rightWin=b;this.rightWin.onResize(this)};b.prototype.addSideIcon=function(b){this.rightWin||(this.rightWin=new CB.BoardSideIcon(this,b),this.rightWin.getDesiredWidth(this.width,this.height,this.cbcanvas),this.rightWin.onResize(this))};b.prototype.destroySideIcon=function(){this.rightWin&&this.rightWin.destroy();delete this.rightWin};b.prototype.addBottomWin=
        function(b){if(this.bottomWin=b)this.bottomWin.onResize(this)};b.prototype.markAsSelected=function(b){V15.isBoardOnlyApp()||this.titleWin&&this.titleWin.markAsSelected(b)};b.prototype.onMouseEnter=function(b,c){this.getClickPos(c)};b.prototype.onContextMenu=function(b,c){};b.prototype.onMouseLeave=function(b,c){this.getClickPos(c)};var c=new CB.Vr,e=new CB.Vr;b.prototype.onMouseMove=function(b,d){d=this.getClickPos(d);if(this.enableEvaluation&&this.evaluation)if(this.evalBulgeRect&&this.evalBulgeRect.isInside(d.x,
        d.y)){var f=this.evaluation.strEval+"<br/><em>"+this.evaluation.strLine+"</em>";c.exec(function(){this.showEvalToolTip(new CB.Point(b.clientX,b.clientY),f)}.bind(this),200)}else this.hideEvalToolTip();this.toMoveRect&&this.toMoveRect.isInside(d.x,d.y)&&this._game?(f=this._game.getCurPos().getBTM()?lm.BLACKS_MOVE:lm.WHITES_MOVE,f+=", "+lm.CLICK_TO_FLIP_BOARD,e.exec(function(){this.showToMoveToolTip(new CB.Point(b.clientX,b.clientY),f)}.bind(this),200)):this.hideToMoveToolTip()};b.prototype.onMouseUp=
        function(b,c){b=this.getClickPos(c);this.toMoveRect&&this.toMoveRect.isInside(b.x,b.y)&&this.flipBoard()};b.prototype.showEvalToolTip=function(b,c){this.showToolTip("Eval",b,c,new CB.Size(190,40),e)};b.prototype.hideEvalToolTip=function(){this.hideToolTip("Eval",c)};b.prototype.showToMoveToolTip=function(b,c){this.showToolTip("ToMove",b,c,new CB.Size(140,35),e,2500)};b.prototype.showToolTip=function(b,c,e,d,l,m){var f=this;!f[b]&&e&&(V15.isBoardOnlyApp()&&(c.x=c.x-d.w-5),f[b]=new CB.ToolTip,f[b].setText(e),
        f[b].setPosSize(c,d),f[b].setVisible(!0),(new CB.Timer(function(){f.hideToolTip(b,l)}.bind(f))).runOnce(m||6E3))};b.prototype.hideToMoveToolTip=function(){this.hideToolTip("ToMove",e)};b.prototype.hideToolTip=function(b,c){c.stop();this[b]&&(this[b].destroy(),delete this[b])};b.prototype.movePieceToSq=function(b,c){this.moveSprite(b,this.getSquareCenterPos(c));b.lastSq=c};b.prototype.moveSprite=function(b,c){b.moveTo(this.cbcanvas.bufferCtx,c);this.cbcanvas.requestAnimation(b.getMoveClipRect())};
    b.prototype.hideSprite=function(b){b&&(b.hide(this.cbcanvas.bufferCtx),this.cbcanvas.requestAnimation(b.getMoveClipRect()))};b.prototype.getPromFromClickPos=function(b,c){b=this.getPixPos(b);return c.x<b.x+.7*this.nSqPix?CB.Piece.QUEEN:c.y<b.y+.3*this.nSqPix?CB.Piece.KNIGHT:c.y<b.y+.6*this.nSqPix?CB.Piece.BISHOP:CB.Piece.ROOK};b.prototype.setBoardAttributes=function(b,c){for(var e=0;e<b.length;e++);e=this.renderAttributes(b);b.length&&c&&this.cbcanvas.requestAnimation(e)};b.prototype.concatAttributes=
        function(b){if(this.renderedAttributes&&b)for(var c=0;c<b.length;c++)-1==this.renderedAttributes.indexOf(b[c])&&this.renderedAttributes.push(b[c]);else this.renderedAttributes=b};b.prototype.addAttributes=function(b,c){this.queueBoardAttributes(b,{eraseQueue:!0,renderNow:!0,requestAnimInRender:!0,permanent:c})};b.prototype.renderAttributes=function(b,c){this.concatAttributes(b);for(var e=null,d=0;d<b.length;d++){b[d].boardControl=this;var f=b[d].draw(c||this.cbcanvas.bufferCtx);e=e?e.getUnion(f):
        f}return e};b.prototype.undoAttributes=function(b){if(void 0!==this.renderedAttributes&&this.renderedAttributes.length){CB.LOG("Undo Attributes: len="+this.renderedAttributes.length,"LogBoard");for(var c=null,e=0;e<this.renderedAttributes.length;e++){for(var d=!1,f=0;!d&&f<this.permanentAttributes.length;f++)d=this.renderedAttributes[e].id==this.permanentAttributes[f].id||this.renderedAttributes[e].sq==this.permanentAttributes[f].sq&&"undefined"!=typeof this.renderedAttributes[e].sq;if(!d&&b&&this._game){var m=
        this._game.getMoveBaggage();if(m&&m.attributes)for(f=0;!d&&f<m.attributes.length;f++)d=this.renderedAttributes[e].id==m.attributes[f].id||this.renderedAttributes[e].sq==m.attributes[f].sq&&"undefined"!=typeof this.renderedAttributes[e].sq}d||(d=this.renderedAttributes[e].undo(this.cbcanvas.bufferCtx,function(b){return this.getPixPos(b)}.bind(this)),c=c?c.getUnion(d):d)}this.cbcanvas.requestAnimation(c);this.renderedAttributes=[].concat(this.permanentAttributes)}};b.prototype.queueBoardAttributes=
        function(b,c){if(c.permanent)if(2==c.permanent)for(var e=0;e<b.length;e++){for(var d=!1,f=0;!d&&f<this.permanentAttributes.length;f++)d=b[e].id==this.permanentAttributes[f].id;d||this.permanentAttributes.push(b[e])}else 1==c.permanent&&this._game&&(e=this._game.getMoveBaggage()||{},e.attributes=(e.attributes||[]).concat(b),this._game.setMoveBaggage(e));else this.queuedAttributes=!this.queuedAttributes||c&&c.eraseQueue?b:this.queuedAttributes.concat(b);c.renderNow&&!this.isAnimationUnderway()&&this.renderQueuedAttributes(c.requestAnimInRender,
            c.ctx)};b.prototype.removeAttributeById=function(b){for(var c=0;c<this.permanentAttributes.length;c++)this.permanentAttributes[c].id==b&&this.permanentAttributes.splice(c,1);this.redraw()};b.prototype.clearBaggageAttributes=function(){this._game.setMoveBaggage(null)};b.prototype.clearPermanentAttributes=function(){this.permanentAttributes=[]};b.prototype.clearBoardAttributes=function(){this.queuedAttributes=[]};b.prototype.renderQueuedAttributes=function(b,c){if(this.permanentAttributes){this.queuedAttributes=
        this.queuedAttributes||[];for(var e=0;e<this.permanentAttributes.length;e++)-1==this.queuedAttributes.indexOf(this.permanentAttributes[e])&&this.queuedAttributes.push(this.permanentAttributes[e])}this.queuedAttributes&&this.queuedAttributes.length&&(c=this.renderAttributes(this.queuedAttributes,c),b&&this.cbcanvas.requestAnimation(c,!0),this.queuedAttributes=[])};b.prototype.clearAll=function(){this.clearBoardAttributes();this.destroyMessage();this.redraw()};b.prototype.isAnimationUnderway=function(){return this.jobsWaitingForSpriteLoad.length||
        this.animation.jobs.length||this.animation.inAnimation};b.prototype.runFunAnimation=function(b){this.jobsWaitingForSpriteLoad=(this.jobsWaitingForSpriteLoad||[]).concat(b);this.animateWhenSpritesReady();this.funAnimJobs=(this.funAnimJobs||[]).concat(b)};b.prototype.undoFunAnimations=function(){this.funAnimJobs&&this.funAnimJobs.forEach(function(b){b.hide(this.cbcanvas.bufferCtx)}.bind(this));this.funAnimJobs=[]};b.prototype.animateCapture=function(b){this.hideSprite(this.currPiece);0<=b&&(this.drawSquare(this.cbcanvas.bufferCtx,
        b),this.currPiece.saveBackground(this.cbcanvas.bufferCtx),this.moveSprite(this.currPiece,this.getSquareCenterPos(b)))};b.prototype.animateFromTo=function(b,c,e,d){if(void 0!==b){var f=e.subtract(c);this.nAnimCount=d;this.posAnimTarget=e;this.vecAnimDisplace=new CB.Vector(f.x/this.nAnimCount,f.y/this.nAnimCount);this.animSprite=b;this.animCurrPos=c;b=new CB.Rect;b.fromTwoPoints(c.x,c.y,e.x,e.y);this.cbcanvas.joinClipRect(b);this.idRequestStepAnim=window.requestAnimationFrame(this.doAnimateStep.bind(this))}};
    b.prototype.doAnimateStep=function(){this.animSprite.moveTo(this.cbcanvas.bufferCtx,this.animCurrPos);this.animCurrPos=0===this.nAnimCount?this.posAnimTarget:this.animCurrPos.add(this.vecAnimDisplace);this.cbcanvas.joinClipRect(this.animSprite.getMoveClipRect());this.cbcanvas._drawDoubleBufferClipped();0<this.nAnimCount&&(this.idRequestStepAnim=window.requestAnimationFrame(this.doAnimateStep.bind(this)));this.nAnimCount--};b.prototype.loadedAll=function(){return void 0!==this.pieceSpriteFactory&&
    this.pieceSpriteFactory.loaded&&this.boardSprites.isAllLoaded()&&V15.Vb.isBoardValid()?!0:!1};b.prototype.resetInternalBoard=function(){this.board=new CB.Board};b.prototype.setBoard=function(b,c){if(this.blindMoves)this.blindSqs=b;else if(this.undoAttributes(),this.undoFunAnimations(),!ObjUtil.equals(b,this.board.sqs)&&1<this.nSqPix)if(this.loadedAll()){var e=!1;if(c&&this.canAnimate()){var d=this.boardSprites.changeBoard(this.pieceSpriteFactory,this.board.sqs,b);d&&d.length?(this.board.copyFrom(b),
        this.jobsWaitingForSpriteLoad=d,this.animateWhenSpritesReady(),this.checkCurrPieceCaptured(),e=this.isAnimated=!0):this.sqArrNotDrawn=b}e||(CB.LOG("Set Board, No Animation","LogRed","board"),c&&this.animation.currFPS&&this.animation.currFPS++,this.board.copyFrom(b),this.queuedAttributes=[],this.redraw(),this.isAnimated=!1);this.drawToMove(this.cbcanvas.bufferCtx,!1)}else this.board.copyFrom(b)};b.prototype.prepareFullRedraw=function(){delete this.currPiece;this.buttonDown=!1;this.killAnimations();
        this.cbcanvas.cancelAnimationFrames()};b.prototype.redraw=function(b){CB.LOG("Redraw","LogBoard","board");try{if(!(1>=this.nSqPix)){var c=-1;this.currPiece&&this.buttonDown&&-1!=this.fromSq&&(c=this.fromSq);this.boardSprites.setup(this.pieceSpriteFactory,this.board.sqs,c);this.killAnimations();this.jobsWaitingForSpriteLoad=[];this.currPiece&&this.buttonDown&&this.currPiece.deleteBackground();delete this.markedMove;if(!this.draw(this.cbcanvas.bufferCtx))return CB.LOG("Draw failed in redraw","LogError"),
        !1;this.currPiece&&this.buttonDown&&(-1!=this.fromSq&&"undefined"!=typeof this.fromSq&&this.drawSquare(this.cbcanvas.bufferCtx,this.fromSq),this.currPiece.moveTo(this.cbcanvas.bufferCtx,this.clickPos.add(this.clickOffs)));this.addBoardColourAndArrowsFromAnno(!0);this.renderQueuedAttributes(!1);if(!b){var e=this.getOuterRect();this.currPiece&&(e=e.getUnion(this.currPiece.getMoveClipRect()));this.cbcanvas.requestAnimation(e,!0)}this.sqArrNotDrawn=null;return!0}}catch(k){CB.LogException("BoardRedraw",
        k)}};b.prototype.checkCurrPieceCaptured=function(){this.currPiece&&-1!=this.fromSq&&this.board.sqs[this.fromSq]!=this.currPiece.piece&&(delete this.currPiece,this.fromSq=-1)};b.prototype.canAnimate=function(){return!this.animation.currFPS||this.animation.currFPS>V15.minFPS};b.prototype.killAnimations=function(){this.animation.kill();this.idRequestStepAnim&&(window.cancelAnimationFrame(this.idRequestStepAnim),this.idRequestStepAnim=0)};b.prototype.quickFinishAnimations=function(){this.animation.quickFinish();
        this.idRequestStepAnim&&(window.cancelAnimationFrame(this.idRequestStepAnim),this.idRequestStepAnim=0)};b.prototype.animateWhenSpritesReady=function(){function b(b,c,e){return 40>b.currFPS?30>b.currFPS?20>b.currFPS?.25:.5:Math.min(1,c.forMove):3>e?c.forMove:c.forPosition}for(var c=!0,e=0;e<this.jobsWaitingForSpriteLoad.length;e++)this.jobsWaitingForSpriteLoad[e].loaded()||(this.jobsWaitingForSpriteLoad[e].tryLoadCnt=(this.jobsWaitingForSpriteLoad[e].tryLoadCnt||0)+1,c=20<this.jobsWaitingForSpriteLoad[e].tryLoadCnt);
        if(c){for(e=0;e<this.jobsWaitingForSpriteLoad.length;e++)if(this.jobsWaitingForSpriteLoad[e].isPieceAnim){c=-1==this.jobsWaitingForSpriteLoad[e].sqFrom?this.getPieceRepositoryPos(this.jobsWaitingForSpriteLoad[e].piece):this.getSquareCenterPos(this.jobsWaitingForSpriteLoad[e].sqFrom);var d=-1==this.jobsWaitingForSpriteLoad[e].sqTo?this.getPieceRepositoryPos(this.jobsWaitingForSpriteLoad[e].piece):this.getSquareCenterPos(this.jobsWaitingForSpriteLoad[e].sqTo);this.jobsWaitingForSpriteLoad[e].ptFrom=
            c;this.jobsWaitingForSpriteLoad[e].ptTo=d}e=this.jobsWaitingForSpriteLoad;e.length&&this.animation.startMultiAnimation(e,b(this.animation,this.animSteps,e.length),this.getOuterRect());this.jobsWaitingForSpriteLoad=[]}else setTimeout(function(){this.animateWhenSpritesReady()}.bind(this),100)};b.prototype.draw=function(b,c){if(!isNaN(this.x0)&&1<this.nSqPix&&1<this.nDesiredSqPix){CB.LOG("Board Draw: ("+this.nSqPix+"/"+this.nDesiredSqPix+"): "+this.debugName,"LogBold","board");if(this.drawForeground(b,
        c))this.addBoardColourAndArrowsFromAnno(!1,this.cbcanvas.bufferCtx);else return!1;void 0!==this.drawExtras&&this.drawExtras(this.getOuterRect())}return!0};b.prototype.drawWood=function(b,c){return this.drawMargin(b,c)?this.drawSquares(b):!1};b.prototype.drawForeground=function(b,c){if(this.drawWood(b,c)&&this.pieceSpriteFactory&&this.pieceSpriteFactory.loaded)return this.drawPieces(b),!0};b.prototype.getInnerRect=function(){return new CB.Rect(this.x0+this.nMarginW,this.y0+this.nMarginW,this.x0+this.nMarginW+
        this.nBoardInnerW,this.y0+this.nMarginW+this.nBoardInnerW)};b.prototype.getOuterRect=function(){return new CB.Rect(this.x0,this.y0,this.x0+this.nBoardOuterW,this.y0+this.nBoardOuterW)};b.prototype.drawMargin=function(b,c){if(4>this.nBoardOuterW)return!0;try{return this.loadedAll()?(b.save(),c&&this.setDefaultShadow(b,.6),V15.Vb.margin.drawTiled(b,this.x0,this.y0,this.nBoardOuterW,this.nBoardOuterW),V15.Vb.clrMarginSepLine&&(b.lineWidth=1,CB.CanvasTools.drawRect(b,this.getInnerRect(),V15.Vb.clrMarginSepLine)),
        b.restore(),this.enableEvaluation&&this.drawEvalBulge(b,c,this.evaluation),this.enableCoordinates&&this.drawCoordinates(b),this.drawToMove(b),!0):!1}catch(h){CB.LogException("RawB:DrawMargin",h)}};b.prototype.drawCoordinates=function(b){b.save();var c=Math.round(.8*this.nMarginW);b.font=c+"px "+V15.config.defaultFont;var e=null;V15.Vb&&(e=V15.Vb.clrCoordinates);b.fillStyle=e||"yellow";e=b.measureText("A").width;var d=this.x0+(this.nMarginW-e)/2,f=this.y0+this.nSqPix/2+c/2+this.nMarginW-.2*c;V15.panelMgr&&
    V15.panelMgr.viewport&&V15.panelMgr.viewport.rtl&&(d+=8*this.nSqPix+this.nMarginW);for(var m=0;8>m;m++)this.blackIsBottom?b.fillText(m+1,d,f+m*this.nSqPix):b.fillText(8-m,d,f+m*this.nSqPix);d=this.x0+(this.nSqPix-e)/2+this.nMarginW+.1*e;f=this.y0+this.nBoardInnerW+this.nMarginW+(this.nMarginW-c)/2+c-.2*c;for(m=0;8>m;m++)this.blackIsBottom?b.fillText(String.fromCharCode(104-m),d+m*this.nSqPix,f):b.fillText(String.fromCharCode(97+m),d+m*this.nSqPix,f);b.restore()};b.prototype.drawToMove=function(b){if(this._game){this.drawToMoveBackground(b);
        b.save();var c=.34*this.getBulgeW(this.getOuterRect().w),e=this.x0+2*this.nMarginW+this.nBoardInnerW+.9*c,d=this.y0+this.nBoardInnerW+2*this.nMarginW-c-.02*this.nBoardInnerW;b.beginPath();b.arc(e,d,c,0,2*Math.PI,!1);var f=b.createRadialGradient(e-.3*c,d-.2*c,.1*c,e-.2*c,d-.2*c,c);this._game.getCurPos().getBTM()?(f.addColorStop(0,"rgba( 150, 150, 160, 1.0 )"),f.addColorStop(1,"rgba( 60, 30, 30, 1.0 )")):(f.addColorStop(0,"rgba( 250, 250, 255, 1.0 )"),f.addColorStop(1,"rgba( 220, 220, 225, 1.0 )"));
        b.fillStyle=f;b.lineWidth=0;this.setDefaultShadow(b,.8,2,3);b.fill();b.restore();this.toMoveRect=new CB.Rect(e-c,d-c,e+2*c,d+2*c);this.cbcanvas.requestAnimation(this.toMoveRect)}};b.prototype.getBulgeW=function(b){return Math.min(Math.max(.054*b,5),30)};b.prototype.drawToMoveBackground=function(b){var c=this.getOuterRect(),e=.09*c.h,d=this.getBulgeW(c.w),f=.4*e,m=new CB.Path,p=c.bottom-e,r=c.bottom;c=c.right;this.toMoveBulgeRect=new CB.Rect(c,p,c+d,p-e);m.push(new CB.Point(c,p));m.push(new CB.Point(d/
        8+c,f/4+p));m.push(new CB.Point(d/2+c,f/2+p));m.push(new CB.Point(3*d/4+c,3*f/4+p));m.push(new CB.Point(d+c,f+p));m.push(new CB.Point(d+c,r));m.push(new CB.Point(c,r));b.save();m.curve(b);e=V15.Vb.margin.getPattern(b);b.fillStyle=e||"brown";b.fill();b.restore()};b.prototype.setDefaultShadow=function(b,c,e,d){e=e||Math.max(1,Math.min(4,Math.round(Math.sqrt(this.nBoardOuterW/60))));b.shadowOffsetX=e;b.shadowOffsetY=e;b.shadowBlur=d||3*e;b.shadowColor="rgba( 60, 30, 15, "+c+" )";return e};b.prototype.displayEvaluation=
        function(b,c){var e=b!=this.enableEvaluation;this.enableEvaluation=b;this.evaluation=c;b&&e?(new CB.Timer(function(){this.resizeHdl();delete this.markedMove;this.markLastMove(!0)}.bind(this))).runOnce(500):b&&(this.drawEvalBulge(this.cbcanvas.bufferCtx,!1,this.evaluation),delete this.markedMove,this.cbcanvas.requestAnimation())};b.prototype.setEvaluationInvalid=function(){this.enableEvaluation&&this.evaluation&&(this.evaluation.isInvalid=!0,(new CB.Timer(function(){this.resizeHdl();delete this.markedMove;
        this.markLastMove(!0)}.bind(this))).runOnce(200))};b.prototype.displayCoordinates=function(b){this.enableCoordinates=b};b.prototype.drawEvalBulge=function(b,c,e){var d=this.getOuterRect();if(!(50>d.width)){this.evaluation=e;var f=.5*d.h,g=this.getBulgeW(d.w),h=.15*f,r=new CB.Path,t=d.top+(d.h-f)/2;d=d.right;this.evalBulgeRect=new CB.Rect(d,t,d+g,t+f);r.push(new CB.Point(d,t));r.push(new CB.Point(g/8+d,h/4+t));r.push(new CB.Point(g/2+d,h/2+t));r.push(new CB.Point(7*g/8+d,3*h/4+t));r.push(new CB.Point(g+
        d,h+t));var w=t+(f-h);r.push(new CB.Point(g+d,w));r.push(new CB.Point(7*g/8+d,h/4+w));r.push(new CB.Point(g/2+d,h/2+w));r.push(new CB.Point(g/8+d,3*h/4+w));r.push(new CB.Point(d,w+h));b.save();r.curve(b);r=V15.Vb.margin.getPattern(b);b.fillStyle=r||"brown";c&&this.setDefaultShadow(b,1);this.bulgeRect=new CB.Rect(d,t,d+g,t+f-2*h);b.fill();c=t+h+2;t=.35*g;d+=(g-t)/5;f=new CB.Rect(d,c,d+t,c+(f-2*h-4));h=b.createLinearGradient(f.left,f.top,f.right,f.top);this.scaleEval(e.value,.3,143);d=new CB.Color(216.75,
        216.75,216.75,1);c=new CB.Color(255,255,255,1);t=new CB.Color(191.25,191.25,191.25,1);h.addColorStop(0,d.toString());h.addColorStop(.3,c.toString());h.addColorStop(1,t.toString());b.lineWidth=f.w;b.strokeStyle=h;b.lineCap="round";this.setDefaultShadow(b,1,2,3);CB.CanvasTools.drawLine(b,f.left+f.w/2,f.top,f.left+f.w/2,f.bottom);b.shadowColor="black";this.setDefaultShadow(b,0,0,0);this.drawEvalMarker(b,0,"black",f);e.isInvalid||(e=-this.scaleEval(e.value,.7,333)*f.h/2+f.h/2+f.top,h=b.createLinearGradient(f.left+
        f.w/2,e-2,f.left+f.w/2,e+2),h.addColorStop(0,"rgba( 0, 220, 0, 1.0 )"),h.addColorStop(.4,"rgba( 0, 235, 0, 1.0 )"),h.addColorStop(1,"rgba( 0, 200, 0, 1.0 )"),b.strokeStyle=h,b.lineCap="round",b.lineWidth=Math.min(Math.max(2,g/2),7),this.setDefaultShadow(b,.6,1,2),CB.CanvasTools.drawLine(b,f.left+1,e,f.right+1,e));b.restore()}};b.prototype.drawEvalMarker=function(b,c,e,d){c=-this.scaleEval(100*c,.7,333)*d.h/2+d.h/2+d.top;b.strokeStyle=e;b.lineWidth=1;b.lineCap="";CB.CanvasTools.drawLine(b,d.left,c,
        d.right+1,c)};b.prototype.scaleEval=function(b,c,e){c=(Math.pow(c,.01*Math.abs(b))-1)/(c-1)*100;c>e&&(c=e);0>b&&(c=-c);return c/e};b.prototype.drawSquares=function(b){if(V15.Vb.isBoardValid()){for(var c=0;64>c;c++)V15.Vb.drawSquare(b,c,this.nSqPix,this.getPixPos(c));return!0}return!1};b.prototype.drawPieces=function(b){for(var c=0;64>c;c++){var e=this.boardSprites.getPiece(c);!e&&0<this.board.sqs[c]&&this.pieceSpriteFactory&&(CB.LOG("Emergency Draw: "+c,"LogError"),e=this.boardSprites.createSprite(this.pieceSpriteFactory,
        this.board.sqs[c],c));if(e){var d=this.getSquareCenterPos(c);e.moveToNoSave(b,d)}}};b.prototype.drawPiece=function(b,c){var e=this.boardSprites.getPiece(c);e&&(c=this.getSquareCenterPos(c),e.moveToNoSave(b,c))};b.prototype.restoreSquare=function(b,c){if(this.board.sqs[c]){var e=this.boardSprites.getPiece(c);e&&(V15.Vb.drawSquare(b,c,this.nSqPix,this.getPixPos(c)),e.moveToNoSave(b,this.getSquareCenterPos(c)),e.setBackground(V15.Vb.getSquare(c,this.nSqPix)))}else V15.Vb.drawSquare(b,c,this.nSqPix,this.getPixPos(c))};
    b.prototype.drawSquare=function(b,c){V15.Vb.drawSquare(b,c,this.nSqPix,this.getPixPos(c))};b.prototype.onSquareTexturesLoaded=function(){CB.LOG("Textures OK","","board")};b.prototype.createBoardSprites=function(){void 0!==this.pieceSpriteFactory&&(this.pieceSpriteFactory.isValid()?this.boardSprites.sqSidePix!==this.nSqPix&&(this.boardSprites.create(this.pieceSpriteFactory),this.boardSprites.setup(this.pieceSpriteFactory,this.board.sqs,this.getPixPos.bind(this)),setTimeout(this.drawIfAllReady.bind(this),
        300)):CB.LOG("PSpriteFactory not Valid Yet","LogRed","board"))};b.prototype.drawIfAllReady=function(){V15.Vb.isBoardValid()&&this.boardSprites.isAllLoaded()?(this.sqArrNotDrawn&&(CB.LOG("Set Buffered Board in DrawIfAllReady..","LogBold","board"),this.setBoard(this.sqArrNotDrawn,!1)),this.onReadyHandlers.count()?(CB.LOG("DRAWIFALLREADY - handlers","LogBold","board"),this.onReadyHandlers.execute()):(CB.LOG("DRAWIFALLREADY - redraw","LogBold","board"),this.cbcanvas.requestRedraw())):setTimeout(this.drawIfAllReady.bind(this),
        500)};b.prototype.isReady=function(){return V15.Vb.isBoardValid()&&this.boardSprites&&this.boardSprites.isAllLoaded()};b.prototype.getPixPos=function(b){var c=Math.floor(b/8);b%=8;this.blackIsBottom?(c=Math.floor(this.x0+this.nMarginW+this.sqOffs+(7-c)*this.nSqPix),b=Math.floor(this.y0+this.nMarginW+this.sqOffs+b*this.nSqPix)):(c=Math.floor(this.x0+this.nMarginW+this.sqOffs+c*this.nSqPix),b=Math.floor(this.y0+this.nMarginW+this.sqOffs+(7-b)*this.nSqPix));return new CB.Point(c,b)};b.prototype.getSquareRect=
        function(b){b=this.getPixPos(b);return new CB.Rect(b.x,b.y,b.x+this.nSqPix,b.y+this.nSqPix)};b.prototype.getSquareCenterPos=function(b){return this.getPixPos(b).add(this.getCenterOffs())};b.prototype.isInMyArea=function(b,c){var e=new CB.Rect,d=this.toMoveRect?this.toMoveRect.w:0;e.fromPosSize(new CB.Point(this.x0,this.y0),new CB.Size(this.width+d,this.height));return b>=e.left&&b<=e.right&&c>=e.top&&c<=e.bottom};b.prototype.getClickPos=function(b){ASSERT(void 0!==b.x);return new CB.Point(b.x,b.y)};
    b.prototype.getClickedSquare=function(b){var c=b.x-this.nMarginW-this.sqOffs-this.x0;b=b.y-this.nMarginW-this.sqOffs-this.y0;this.blackIsBottom?(c=7-Math.floor(c/this.nSqPix),b=Math.floor(b/this.nSqPix)):(c=Math.floor(c/this.nSqPix),b=7-Math.floor(b/this.nSqPix));return 0<=c&&8>c&&0<=b&&8>b?8*c+b:-1};b.prototype.getGenerousClipRect=function(b,c){var e=CB.Square.getFile(b);b=CB.Square.getRank(b);var d=CB.Square.getFile(c),f=CB.Square.getRank(c);c=Math.max(e,d);var g=Math.min(b,f);e=CB.Square.get64(Math.min(e,
        d),Math.max(b,f));b=CB.Square.get64(c,g);e=this.getPixPos(e);b=this.getPixPos(b);b.add(new CB.Point(this.nSqPix,this.nSqPix));d=new CB.Rect;d.fromTwoPoints(e.x,e.y,b.x,b.y);d.expand(this.nSqPix,this.nSqPix);return d};b.prototype.getCenterOffs=function(){return new CB.Point(Math.floor(this.nSqPix/2),Math.floor(this.nSqPix/2))};b.prototype.getOffsFromSqCenter=function(b){var c=this.getPixPos(this.getClickedSquare(b)).add(this.getCenterOffs());CB.LOG("Click="+b+", center="+c);CB.LOG("Diff="+b.subtract(c));
        return c.subtract(b)};b.prototype.getPieceRepositoryPos=function(b){return new CB.Point(-500,-500)};b.prototype.handleRightButtonDown=function(b,c){this.redrawBlindBoard()};b.prototype.redrawBlindBoard=function(){this.blindMoves&&(this.backBoard=this.board.sqs.slice(),this.board.copyFrom(this.blindSqs),this.redraw(!1),this.board.copyFrom(this.backBoard))};b.prototype.handleRightButtonUp=function(b,c){this.redraw(!1)};b.prototype.flipBoard=function(){this.setBlackIsBottom(!this.blackIsBottom,!0)};
    b.prototype.setBlackIsBottom=function(b,c){b!=this.blackIsBottom&&(this.blackIsBottom=b,this.killAnimations(),this.boardSprites.deleteBackgrounds(),c&&(this.destroyMessage(),this.prepareFullRedraw(),this.redraw(!0)),this.cbcanvas.requestRedraw(),this.titleWin&&this.titleWin.notifyBoardTurned&&this.titleWin.notifyBoardTurned(this),this.bottomWin&&this.bottomWin.notifyBoardTurned&&this.bottomWin.notifyBoardTurned(this))};b.prototype.getSideToShow=function(){return this.blackIsBottom?CB.Side.BLACK:CB.Side.WHITE};
    b.prototype.setSideToShow=function(b){b!==this.getSideToShow()&&this.flipBoard()};b.prototype.setLegalFromSquares=function(b){this.legalFromSquares=b};b.prototype._game=null;b.prototype.setGame=function(b){this.permanentAttributes=[];this.blindMoves||this.resetInternalBoard();this._game&&(this._game.removeOnCurPosChangedListener(this.idCurPosListener),this._game.removeOnChangedListener(this.idChangeListener),this._game.removeOnNavigateListener(this.idNavigate),this._game.removeOnMoveListener(this.idMove),
        this._game.removeOnHeaderChangedListener(this.idHeader));if(this._game=b){b=this._onGameCurPosChanged.bind(this);var c=this._onChanged.bind(this),e=this._onHeaderChanged.bind(this),d=this._onNavigate.bind(this),f=this._onMove.bind(this);this.idCurPosListener=this._game.addOnCurPosChangedListener(b);this.idChangeListener=this._game.addOnChangedListener(c);this.idNavigate=this._game.addOnNavigateListener(d);this.idMove=this._game.addOnMoveListener(f);this.idHeader=this._game.addOnHeaderChangedListener(e);
        this.idRest=this._game.addOnResetGameListener(this._onResetGame.bind(this));this._onGameCurPosChanged(this._game,this._game.getCurPos(),!1);this._onHeaderChanged()}};b.prototype.getGame=function(){return this._game};b.prototype._onGameCurPosChanged=function(b,c,e){CB.LOG("RawBoard._onCurPosChng","LogBoard","board");"undefined"==typeof e&&this.shouldAnimatePosChange&&(e=this.shouldAnimatePosChange());this.nextCurPosNoAnim&&(this.nextCurPosNoAnim=e=!1);b=!1;this.isAnimationUnderway()?(this._game&&this.setBoard(this._game.getCurPos().board,
        !1),CB.LOG("RawBoard._onCurPos::Redraw","","board"),b=!0):this._game&&this.setBoard(this._game.getCurPos().board,e);this.addBoardColourAndArrowsFromAnno();b&&this.markLastMove(!1);this.moveEntry.renderPreMoves()};b.prototype.shouldAnimatePosChange=function(){return!0};b.prototype._onChanged=function(){this.addBoardColourAndArrowsFromAnno()};b.prototype._onResetGame=function(){CB.LOG("RawBoard._onResetGame","LogBoard");this.moveEntry.clearPreMoves()};b.prototype._onHeaderChanged=function(){this.titleWin&&
    this.titleWin.displaysHeader&&this.setTitleText(this._game.hdr.getStrPlayers(this.nSqPix>this.cbcanvas.zoomToPix(42)))};b.prototype._onMove=function(b){CB.LOG("RawBoard._onMove ","LogBoard","board");if(this.moveEntry)this.moveEntry.onMove()};b.prototype._onNavigate=function(){this.markLastMove(!1)};b.prototype.addBoardColourAndArrowsFromAnno=function(b,c){var e=[].concat(this.permanentAttributes);if(this._game){var d=this._game.getAnno(CB.AnnoType.SQUARE_LIST);if(d)for(var f=0;f<d.length;f++){var g=
        new CB.BoardColouredSquare(d[f].field,d[f].getColour());g.fromAnno=!0;e.push(g)}if(d=this._game.getAnno(CB.AnnoType.ARROW_LIST))for(f=0;f<d.length;f++)g=new CB.BoardArrow(d[f].from,d[f].to,d[f].getColour()),g.fromAnno=!0,e.push(g)}this._game&&(f=this._game.getMoveBaggage())&&f.attributes&&(e=e.concat(f.attributes));0<e.length&&(f=!1,b||(f=!0,this.shouldAnimatePosChange&&(f=!this.shouldAnimatePosChange())),c&&(f=!0),this.removeLastAnnoAttribsFromQueue(),this.pieceSpriteFactory&&this.pieceSpriteFactory.loaded||
    (f=!1,c=null),this.queueBoardAttributes(e,{eraseQueue:!1,renderNow:f,requestAnimInRender:f,ctx:c}))};b.prototype.markLastMove=function(b,c){if(this._game&&this._game.mainLine.length){var e=this._game.getLastMove();e&&(e!=this.markedMove||c)&&(this.markedMove=e,c=new CB.BoardArrow(e.from,e.to),c.lastMove=!0,this.removeLastMarkedMoveFromQueue(),this.queueBoardAttributes([c],{eraseQueue:!1,renderNow:b||!this.canAnimate(),requestAnimInRender:!0}))}};b.prototype.removeLastMarkedMoveFromQueue=function(){if(this.queuedAttributes){var b=
        this.queuedAttributes.find(function(b){return b.lastMove});b=this.queuedAttributes.indexOf(b);0<=b&&this.queuedAttributes.splice(b,1)}};b.prototype.removeLastAnnoAttribsFromQueue=function(){if(this.queuedAttributes){do{var b=this.queuedAttributes.find(function(b){return b.fromAnno});var c=this.queuedAttributes.indexOf(b);0<=c&&this.queuedAttributes.splice(c,1)}while(b)}};b.prototype.markSquare=function(b,c,e,d,l){this.queueBoardAttributes([new CB.BoardColouredSquare(b,c,e)],{eraseQueue:!1,renderNow:!l,
        requestAnimInRender:!0,permanent:d})};b.prototype.drawArrow=function(b,c,e,d,l,m){"undefined"!==typeof b&&this.queueBoardAttributes([new CB.BoardArrow(b,c,e,d,m)],{eraseQueue:!0,renderNow:!0,requestAnimInRender:!0,permanent:l})};b.prototype.drawLine=function(b){this.queueBoardAttributes([b],{eraseQueue:!0,renderNow:!0,requestAnimInRender:!0,permanent:!0})};b.prototype.markSquares=function(b){this.currPiece&&(this.currPiece.hide(this.cbcanvas.bufferCtx),this.currPiece.deleteBackground());for(var c=
        0;c<b.length;c++)this.queueBoardAttributes([new CB.BoardColouredSquare(b[c].sq,b[c].clr)],{eraseQueue:!1,renderNow:c==b.length-1,requestAnimInRender:c==b.length-1});this.currPiece&&this.currPiece.moveTo(this.cbcanvas.bufferCtx,this.currPiece.pos)};b.prototype.restoreSquares=function(b){b.forEach(function(b){this.restoreSquare(this.cbcanvas.bufferCtx,b.sq);this.restoreSquare(this.cbcanvas.ctx,b.sq)}.bind(this))};return b}();"use strict";
CB.BoardControl=function(){var d=function(b,c,e,d,g){this.init(b,c,e,d);this.pieceFontName=CB.PieceFonts[glSettings.pieceStyleId];this.markedSqsOnButtonDown=[];this.options=g;this.pieceTouchSq=-1};CB.inherit(d,CB.RawBoardControl);d.prototype.getGame=function(){return this._game};d.prototype.onMouseDown=function(b,c){if(this._game){V15.Vb.abortCreateBackground();try{if(2==b.button)this.handleRightButtonDown(b,c);else if(!this.buttonDown&&(this.blindMoves||this.redraw(),this.destroyMessage(),new CB.Tick,
    this.buttonDown=!0,this.clickPos=this.getClickPos(c),this.clickOffs=this.getOffsFromSqCenter(this.clickPos),void 0!==this.fnBoardClick&&this.fnBoardClick(this.uniqueId,this.clickPos,b),this.allowInput)){var e=this.getClickedSquare(this.clickPos);this.moveEntry.clearAttributesOnMouseDown(e);-1!=e&&(this.blindMoves?this.flashBlindPiece(e):(this.currPiece=this.grabPiece(e,this.clickPos.add(this.clickOffs)),this.moveEntry.onSquareClicked(e)),this.fromSq=e,this.markedSqsOnButtonDown=[],this.fnMarkSquaresOnButtonDown&&
(this.markedSqsOnButtonDown=this.markedSqsOnButtonDown.concat(this.fnMarkSquaresOnButtonDown(e))),this.markSquares(this.markedSqsOnButtonDown),this.fnSquareClick&&this.fnSquareClick(e),(this.currPiece||this.hasPieceInAdjacentSquare(e))&&b.preventDefault())}}catch(f){CB.LogException("BoardDown",f)}}};d.prototype.hasPieceInAdjacentSquare=function(b){for(var c=[-7,-8,-9,-1,1,7,8,9],e=0;e<c.length;e++){var d=b+c[e];if(0<=d&&64>=d&&this.board.sqs[d])return!0}};d.prototype.onMouseUp=function(b,c){if(this._game)try{if(2==
    b.button)this.handleRightButtonUp(b,c);else if(this.getClickPos(c),this.buttonDown){this.buttonDown=!1;var e=this.clickPos=this.getClickPos(c),d=!1;if(this.allowInput){new CB.Tick;var g=this.getClickedSquare(e);if(-1==g){void 0!==this.currPiece&&(this.animateFromTo(this.currPiece,e,this.getSquareCenterPos(this.fromSq),2),delete this.currPiece);this.fromSq=-1;this.superClass.onMouseUp.call(this,b,c);return}if(this.blindMoves)g!=this.fromSq&&(this.toSq=g,this.prom=0,this.handlePromo(this.fromSq,this.toSq,
    e,!1),this.moveEntry.boardWinMoveEntered(this.fromSq,this.toSq,this.prom));else if(void 0!==this.currPiece||this.fromSq===this.moveEntry.getLastPreMoveToSq()||0==this.board.get(g)||0<=this.fromSq&&0==this.board.get(this.fromSq)){if(g!==this.fromSq){this.pieceTouchSq=-1;var h=this.moveEntry.isLegalOrPremove(this.board,this.fromSq,g);!h&&this.moveEntry.isLegal(this.board,g,this.fromSq)&&this.moveEntry.mayEnterBackwards(this.board,g)&&(c=g,g=this.fromSq,this.fromSq=c,h=!0,this.currPiece=this.grabPiece(this.fromSq,
    this.getSquareCenterPos(this.fromSq)));h?(this.toSq=g,this.prom=0,d=this.moveEntry.isPremove(this.board,this.fromSq,this.toSq),this.moveEntry.colorOk(this.board.get(this.fromSq))&&(this.board.get(g)&&!d&&this.animateCapture(g),this.handlePromo(this.fromSq,this.toSq,e,d)||this.handleEnPassant(this.fromSq,this.toSq,d)||(d||(this.boardSprites.change(this.fromSq,g),this.board.change(this.fromSq,g)),this.currPiece&&this.movePieceToSq(this.currPiece,g))),this.moveEntry.boardWinMoveEntered(this.fromSq,this.toSq,
    this.prom)||(this.currPiece&&(this.currPiece.moveTo(this.cbcanvas.bufferCtx,this.getSquareCenterPos(this.fromSq)),this.currPiece.lastSq=this.fromSq),d=!0,this.cbcanvas.requestAnimation(this.getGenerousClipRect(this.fromSq,this.toSq),!0))):this.currPiece&&this.animateFromTo(this.currPiece,e,this.getSquareCenterPos(this.fromSq),5);delete this.fromSq}else if(this.clickHandler)this.clickHandler(g);else if(this.currPiece)this.movePieceToSq(this.currPiece,g),this.moveEntry.isMyPiece(g)?this.pieceTouchSq=
    g:this.moveEntry.isOpponentPiece(g)&&(this.moveEntry.tryTwoClickMove(this.pieceTouchSq,g),this.pieceTouchSq=-1);else{if(!this.moveEntry.tryTwoClickMove(this.pieceTouchSq,g)&&!this.singleClickDisabled){var k=this.moveEntry.fillSingleClickMove(this.board,g);k.ok&&this.moveEntry.boardWinMoveEntered(k.from,g,0)}this.pieceTouchSq=-1}delete this.currPiece}b.preventDefault();this.fnSquareRelease&&this.fnSquareRelease(g)}else this.currPiece&&(this.animateFromTo(this.currPiece,e,this.getSquareCenterPos(this.fromSq),
    5),delete this.currPiece);this.fromSq=-1;this.markedSqsOnButtonDown.length&&(this.markedSqsOnButtonDown=[]);this.redraw();d&&this.moveEntry.renderPreMoves()}}catch(l){CB.LogException("BoardUp",l)}};d.prototype.onMouseWheel=function(b,c){};d.prototype.onMouseMove=function(b,c){try{if(this.allowInput){this.clickPos=this.getClickPos(c);var e=this.getClickedSquare(this.clickPos);this.moveSq=e;var d;if(this.isWhitePromoPawn(this.fromSq)){var g=e;7==CB.Square.getRank(g)&&(d=this.blindMoves||this.moveEntry.isLegalOrPremove(this.board,
    this.fromSq,g))}else this.isBlackPromoPawn(this.fromSq)&&(g=e,0==CB.Square.getRank(g)&&(d=this.blindMoves||this.moveEntry.isLegalOrPremove(this.board,this.fromSq,g)));d?(this.currPiece&&(this.hideSprite(this.currPiece),this.currPiece.saveBackground(this.cbcanvas.bufferCtx)),this.drawPromChoice(g),CB.LOG("Prom: "+g)):(void 0!==this.promoSprite&&(CB.LOG("Delete PromoSprite"),this.hideSprite(this.promoSprite),delete this.promoSprite,this.currPiece&&this.currPiece.deleteBackground()),this.currPiece&&
(this.animation.hideAll(),this.moveSprite(this.currPiece,this.clickPos.add(this.clickOffs)),this.animation.showAll()));if(void 0!==this.currPiece)b.preventDefault(),e!=this.fromSq&&this.fnSquareChangeInMouseMove&&this.fnSquareChangeInMouseMove(e);else if(!this.blindMoves){d=!1;if(0<=e){var h=this.board.get(e);h===CB.Piece.NONE||!this.moveEntry||this.moveEntry.getMySide()!=CB.Piece.side(h)&&null!==this.moveEntry.getMySide()||(b.target.style.cursor=this.busy?"wait":"pointer",d=!0)}d||(b.target.style.cursor=
    this.busy?"wait":"default")}}this.superClass.onMouseMove.call(this,b,c)}catch(k){CB.LogException("BMMove",k)}};d.prototype.isWhitePromoPawn=function(b){return(this.board.get(b)==CB.Piece.W_PAWN||this.blindMoves&&this.blindSqs&&this.blindSqs[b]==CB.Piece.W_PAWN)&&6==CB.Square.getRank(b)};d.prototype.isBlackPromoPawn=function(b){return(this.board.get(b)==CB.Piece.B_PAWN||this.blindMoves&&this.blindSqs&&this.blindSqs[b]==CB.Piece.B_PAWN)&&1==CB.Square.getRank(b)};d.prototype.handlePromo=function(b,c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      e,d){this.isWhitePromoPawn(b)?this.prom=this.getPromFromClickPos(c,e):this.isBlackPromoPawn(b)&&(this.prom=this.getPromFromClickPos(c,e)+CB.Side.SIDE_MASK);return this.prom?(d?(this.drawSquare(this.cbcanvas.bufferCtx,this.toSq),this.currPiece.deleteBackground(),this.cbcanvas.requestAnimation(this.getSquareRect(this.toSq))):(this.blindMoves||(this.boardSprites.promo(this.fromSq,this.toSq,this.prom,this.pieceSpriteFactory),this.board.promo(this.fromSq,this.toSq,this.prom)),this.drawSquare(this.cbcanvas.bufferCtx,
    this.toSq),this.blindMoves||(this.movePieceToSq(this.boardSprites.getPiece(this.toSq),this.toSq),this.drawSquare(this.cbcanvas.bufferCtx,this.fromSq))),delete this.promoSprite,!0):!1};d.prototype.drawPromChoice=function(b){void 0===this.promoSprite&&(this.promoSprite=this.boardSprites.getPromoSprite(CB.Piece.side(this.board.sqs[this.fromSq])));CB.LOG("Move Promo Sprite to: "+CB.Square.toString(b));this.movePieceToSq(this.promoSprite,b)};d.prototype.handleEnPassant=function(b,c,e){var d;this.board.get(b)==
CB.Piece.W_PAWN&&4==CB.Square.getRank(b)&&this.moveEntry.mayEnPassant(b,c)?d=CB.Square.get64(CB.Square.getFile(c),4):this.board.get(b)==CB.Piece.B_PAWN&&3==CB.Square.getRank(b)&&this.moveEntry.mayEnPassant(b,c)&&(d=CB.Square.get64(CB.Square.getFile(c),3));return void 0!==d?(e||(this.boardSprites.enPassant(b,c,d),this.board.enPassant(b,c,d),this.movePieceToSq(this.currPiece,this.toSq),this.drawSquare(this.cbcanvas.bufferCtx,d),this.cbcanvas.requestAnimation(this.getSquareRect(d))),!0):!1};d.prototype.markPreMove=
    function(b,c){this.queueBoardAttributes([new CB.BoardArrow(b,c,this.moveEntry.getPreMoveHsla())],{eraseQueue:!0,renderNow:!0,requestAnimInRender:!1})};d.prototype.grabPiece=function(b,c){var e=this.boardSprites.getPiece(b);e&&(e.fromSq=b);void 0===e&&b!==this.moveEntry.getLastPreMoveToSq()||!e||(e.pieceName=CB.Piece.toString(this.board.get(b)),CB.LOG(e.pieceName),e.hasBackground()?this.moveSprite(e,this.clickPos.add(this.clickOffs)):(e.pos=c,e.setBackground(V15.Vb.getSquare(b,this.nSqPix))));return e};
    d.prototype.flashBlindPiece=function(b){this.blindPiece=this.boardSprites.getBlindSprite(this.pieceSpriteFactory,this.blindSqs?this.blindSqs[b]:this.board.sqs[b]);var c=this.getSquareCenterPos(b);this.blindPiece.moveTo(this.cbcanvas.bufferCtx,c);this.cbcanvas.requestAnimation(this.getSquareRect(b));(new CB.Timer(function(){c.x+=2;c.y+=2;this.blindPiece.moveTo(this.cbcanvas.bufferCtx,c);this.cbcanvas.requestAnimation(this.getSquareRect(b));this.hideSprite(this.blindPiece);this.blindPiece=null}.bind(this))).runOnce(100)};
    d.prototype.setBusy=function(b){this.busy=b;this.cbcanvas.canvas.style.cursor=this.busy?"wait":"default"};d.prototype.test=function(){var b=["rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1","rnbqk2r/1p2bppp/p2p1n2/4p1B1/4P3/1NN5/PPP1BPPP/R2QK2R b KQkq - 0 8","4rk1r/pppb1ppp/2np4/8/3P4/2PBP3/PP1N2PP/R4RK1 w - - 0 15","b4rk1/p1p1qpp1/3p1n1p/4p3/4P2B/3P1N2/PRPQ1PPP/6K1 w - - 0 16","7r/3kp3/1p6/p1p1p3/3nP1p1/PPKPB1P1/5P2/R7 b - - 0 29"];this.testInx=void 0===this.testInx?0:this.testInx+1;this.testInx>
    b.length-1&&(this.testInx=0);this.execStr(b[this.testInx])};d.prototype.refreshMarkedSquares=function(){this.buttonDown&&this.fromSq&&this.fromSq==this.moveSq&&(this.markedSqsOnButtonDown&&this.markedSqsOnButtonDown.length&&this.restoreSquares(this.markedSqsOnButtonDown),this.markedSqsOnButtonDown=[],this.fnMarkSquaresOnButtonDown&&(this.markedSqsOnButtonDown=this.markedSqsOnButtonDown.concat(this.fnMarkSquaresOnButtonDown(this.fromSq,!0))),this.markSquares(this.markedSqsOnButtonDown))};d.prototype.execStr=
        function(b){b=new CB.Position(b);this.setBoard(b.board)};return d}();"use strict";
CB.ClockElement=function(){var d=function(b,c){this.colorActive=V15.config.clrActiveClock;this.colorActiveNormal=new CB.Color(220,250,190);this.colorActiveEmphasize=new CB.Color(50,110,0);this.colorInactive=new CB.Color(140,140,100);this.colorFinished=this.colorActive;this.background=new CB.DivElement(b,"clockBG");this.textWhite=new CB.DivElement(this.background,"clockW");this.textBlack=new CB.DivElement(this.background,"clockB");this.config=c?c:{border:1,borderClr:"black"};this.initText(this.textWhite);
    this.initText(this.textBlack);this.displayCentiSecs=!1;this.displayHours=!0;this.textWhite.setText("0:00:00");this.textBlack.setText("0:00:00");this.timerToMove=new CB.Timer(this.stopEmphasizeToMove.bind(this));this.runningClockId=0};d.prototype.destroy=function(){this.background.destroy()};d.prototype.setDisplayCentiSecs=function(b){this.displayCentiSecs=b};d.prototype.setDisplayHours=function(b){this.displayHours=b};d.prototype.setText=function(b,c){c?this.textBlack.setText(b):this.textWhite.setText(b)};
    d.prototype.setTextWhite=function(b){this.textWhite.setText(b)};d.prototype.setTextBlack=function(b){this.textBlack.setText(b)};d.prototype.setVisible=function(b){this.background.setVisible(b)};d.prototype.initText=function(b){b.setBackgroundColor(new CB.Color(0,0,0,.5));b.setColor(new CB.Color(255,255,255,.9));b.setBorder(this.config.border,this.config.borderClr);b.setTextAlign("center");b.setFontFamily(V15.config.defaultFont);b.elDOM.addEventListener("mousedown",function(b){b.preventDefault()})};
    d.prototype.setPosSize=function(b,c,e,d){var f=new CB.Rect(0,0,Math.round(e/2),d-1),h=new CB.Rect(Math.round(e/2),0,e,d-1);this.background.setPos(b,c);this.background.setSize(e,d);this.textWhite.setPos(f.left,f.top);this.textWhite.setSize(f.getSize().w,f.getSize().h);this.textBlack.setPos(h.left,h.top);this.textBlack.setSize(h.getSize().w,h.getSize().h);b=Math.round(.7*d);do this.textWhite.setFontSize(b),this.textBlack.setFontSize(b),--b,this.textWhite.setVerticalAlign((f.h-b)/2+2),this.textBlack.setVerticalAlign((f.h-
        b)/2+1);while(3<b&&(this.textWhite.getTextWidth()>f.w-5||this.textWhite.getTextHeight()>f.h-2));e=Math.max(1,Math.min(4,Math.round(Math.sqrt(e/100))));this.background.setBoxShadow(e,5*e,"rgba( 60, 30, 20, 0.6 )")};d.prototype.showResult=function(b){this.textWhite.setText(lm.RESULT+":");b==CB.GameResultEnum.UNDEFINED_RESULT?this.textBlack.setText(lm.ABORTED):this.textBlack.setText(CB.GameResultEnum.toString(b));this.textWhite.setColor(this.colorFinished);this.textBlack.setColor(this.colorFinished)};
    d.prototype.showTimeOverstepped=function(b){this.textWhite.setText("TIME")};d.prototype.setToMove=function(b){b?(this.textWhite.setColor(this.colorInactive),this.textBlack.setColor(this.colorActive)):(this.textWhite.setColor(this.colorActive),this.textBlack.setColor(this.colorInactive))};d.prototype.showRestTime=function(b,c){b=this.getTimeString(b);c?this.textBlack.setText(b):this.textWhite.setText(b)};d.prototype.showCurrTime=function(b,c){};d.prototype.setRunsForward=function(b){this.runsForward=
        b};d.prototype.emphasizeToMove=function(b){this.timerToMove.runOnce(b||8E3);this.textWhite.setBackgroundColor(this.colorActiveEmphasize);this.textBlack.setBackgroundColor(this.colorActiveEmphasize)};d.prototype.stopEmphasizeToMove=function(){this.textWhite.setBackgroundColor(new CB.Color(0,0,0,.5));this.textBlack.setBackgroundColor(new CB.Color(0,0,0,.5))};d.prototype.getTimeString=function(b){0>b&&(b=new Date(0));var c="";this.displayHours&&(c=b.getUTCHours()+":");if(4E3>b.valueOf()&&!this.runsForward){var e=
        b.getUTCSeconds();b=Math.floor(b.getUTCMilliseconds()/100);1<b.toString().length&&(b="0");c=e+"."+b}else e=b.getUTCMinutes(),1==e.toString().length&&(e="0"+e),c+=e,e=Math.floor(b.getUTCSeconds()),1==e.toString().length&&(e="0"+e),c+=":"+e;return c};return d}();"use strict";function LineStackItemHash(d){var b=d.getLine();d=d.getMovesToGo()|b.length<<8;0<b.length&&(d|=b[0].from<<16|b[0].to<<24);return d}
function LineStackItemEq(d,b){return d.getLine()===b.getLine()&&d.getMovesToGo()===b.getMovesToGo()}CB.cbNotationDefaults={game:null,useMatBalance:!0,useDiagrams:!0,useMedals:!0,useResult:!0,useColorMarkers:!0,useHeader:!0,moveClass:"",commentClass:"",resultClass:"",lineClass:"",colorMarkerClass:"",medalClass:"",isActive:!0,notationLocalization:null,setColorMarkersOnDiagrams:!0};
CB.NotaElement=function(){function d(b,c,e){c.append("<span class='");c.append(e);c.append("'>");c.append(b);c.append("</span>")}var b=function(b,c,e){this.notaHeaderElement=new CB.NotaHeaderElement(c);this.notaFooterElement=new CB.NotaFooterElement(c,e);this.elementId=0;this.panel=b;this.gateUpdate=new CB.Vr;this.stopAtMoves=[];this.nInPage=c;this.diagrams=[];this.reserveDiagrams=[]};b.prototype.panel=null;b.prototype.m_ng=null;b.prototype.m_selElem=null;b.prototype.m_active=!0;b.prototype.notaHeaderElement=
    null;b.prototype.initElem=function(b,c){this.elementId=b="string"==typeof b?b:b.id;b=CB.$("#"+b);if(this.elem=b.single()){b.parent();b.addClass("cbnota-container");this.precreateLayout();this._setOptions(c);this.scrollParent=CB.$(".nota-game",this.elem).single();b.on("dragover",this.onElementDragOver.bind(this)).on("dragenter",this.onElementDragEnter.bind(this)).on("drop",this.onElementDrop.bind(this)).on("mousewheel",this.onMouseWheel.bind(this)).on("DOMMouseScroll",this.onMouseWheel.bind(this));
    CB.Element.isEventSupported("touchstart")&&(b.on("touchstart",this.onButtonDown.bind(this)).on("touchend",this.onButtonUp.bind(this)).on("touchmove",this.onMouseMove.bind(this)).on("touchleave touchcancel",this.onMouseLeave.bind(this)),this.supportsTouch=!0);if(CB.Element.isEventSupported("mousedown"))b.on("mousedown",this.onButtonDown.bind(this)).on("mouseup",this.onButtonUp.bind(this)).on("mousemove",this.onMouseMove.bind(this)).on("mouseleave",this.onMouseLeave.bind(this)).on("dblclick",this.onDoubleClick.bind(this));
    CB.System.isSafari()&&$(".nota-game").css("padding-right","50px");b=CB.$("#nota-head-"+this.nInPage).single();this.header=new CB.DivElement(b,this.getHeaderId(),{append:!1});this.header.setVisible(this.m_useHeader);this.m_useHeader||$(b).hide();this.notaHeaderElement.initElem(this.getHeaderId(),c,null,this.nInPage);c.useMatBalance&&this.createMatBalance()}};b.prototype.destroy=function(){alert("NOTIMPL NotaEl")};b.prototype.createMatBalance=function(){if(null===CB.$.get(this.getFooterId())){var b=
    CB.$.get(this.elementId);if(b){var c=CB.$("#nota-foot-"+this.nInPage).single();this.footer=new CB.DivElement(c,this.getFooterId());this.footer.setVisible(!0);this.notaFooterElement.initElem(this.getFooterId())}}c=CB.$("#"+this.elementId);b&&c.removeClass("nomat")};b.prototype.getHeaderId=function(){return"theheader-"+this.nInPage};b.prototype.getFooterId=function(){return"thefooter-"+this.nInPage};b.prototype.destroyMatBalance=function(){var b=CB.$("#"+this.getFooterId()).single();b&&0<b.childNodes.length&&
(b.removeChild(b.childNodes[0]),this.footer=null,CB.$("#"+this.elementId).addClass("nomat"))};b.prototype.setUseMatBalance=function(b){(this.useMatBalance=b)?CB.$("#"+this.getFooterId()).show():CB.$("#"+this.getFooterId()).hide()};b.prototype._setOptions=function(b){b.notationLocalization=b.notationLocalization||lm.NOTA_LOCALIZATION;this.m_ng=new CB.NotationGenerator(b.notationLocalization);this.m_useDiagrams=b.useDiagrams;void 0!==b.diagramOptions&&(this.m_diagramOptions=b.diagramOptions);this.m_useHeader=
    b.useHeader;void 0!==b.useMatBalance&&(this.useMatBalance=b.useMatBalance);void 0!==b.useResult&&(this.m_useResult=b.useResult);this.m_active=b.isActive;this.m_options=b;b.game&&this.setGame(b.game)};b.prototype.setOptions=function(b){this._setOptions(b)};b.prototype.m_game=null;b.prototype.setGame=function(b){this.notaHeaderElement.setGame(b);this.m_game&&(this.m_game.removeOnMoveListener(this.m_inxOnMove),this.m_game.removeOnNavigateListener(this.m_inxOnNavigate),this.m_game.removeOnChangedListener(this.m_inxOnChanged),
    this.m_game.removeOnHeaderChangedListener(this.m_inxOnHeaderChanged),this.m_game.removeOnAnnoChangedListener(this.m_inxOnAnnoChanged),this.m_game.removeOnEvalListener(this.m_inxOnEval));this.m_game=b;this.m_inxOnMove=this.m_game.addOnMoveListener(this.onMove.bind(this));this.m_inxOnNavigate=this.m_game.addOnNavigateListener(this.onNavigate.bind(this));this.m_inxOnChanged=this.m_game.addOnChangedListener(this.onChanged.bind(this));this.m_inxOnHeaderChanged=this.m_game.addOnHeaderChangedListener(this.onHeaderChanged.bind(this));
    this.m_inxOnAnnoChanged=this.m_game.addOnAnnoChangedListener(this.onChanged.bind(this));this.m_inxOnEval=this.m_game.addOnEvalListener(this.onEval.bind(this));this.initSubElements();this.useMatBalance&&this.notaFooterElement.setGame(b);this.notaHeaderElement.setGame(b);this.evProfileControl&&this.evProfileControl.setEvalArr(b.getEvaluationProfile())};b.prototype.setSize=function(b,c){this.notaHeaderElement.onResize(b,c);this.resizeDiagrams();this.resizeEvProfile(b);this.onNavigate(!0)};b.prototype.getGame=
    function(){return this.m_game};b.prototype.onMove=function(){this.initSubElements();this.markCurLine()};b.prototype.onHeaderChanged=function(){};b.prototype.onChanged=function(){this.initSubElements();this.markCurLine()};b.prototype.onEval=function(b,c,e){var d;CB.Evaluation&&(d=CB.Evaluation.getEvalString(c));this.evProfileControl||this.notaFooterElement.setText(d+".")};b.prototype.onNavigate=function(b){b=b||!1;var c=this.FindMoveElement();this.setSelItem(c,b);this.markCurLine();this.scheduleUpdate(this);
    this.evProfileControl&&this.m_game.isOnMainLine()&&this.evProfileControl.markMove(this.m_game.getPlyNum())};b.prototype.ResultToStr=function(b){return CB.GameResultEnum.toString(b)};b.prototype.InitResult=function(c,e){(c=b.prototype.ResultToStr(c))&&d(c,e,"cbgame-result")};b.prototype.scheduleUpdate=function(b){this.gateUpdate.exec(function(){b.matcontrol&&(b.matcontrol.setPos(b.m_game.getCurPos()),b.matcontrol.render())}.bind(this),200)};b.prototype.getLayoutHtml=function(){return String.formatEx("<div class='nota-container'><div class='nota-head-container'><div class='nota-head' id='nota-head-{0}'></div></div><div class='nota-game-container'><div class='nota-ogame'><div class='nota-igame'><div class='nota-game' data-inx-game='{0}'></div></div></div></div><div class='nota-foot-container'><div class='nota-foot' id='nota-foot-{0}'></div></div></div>",
    this.nInPage)};b.prototype.precreateLayout=function(){CB.$(this.elem).html(this.getLayoutHtml())};b.prototype.initSubElements=function(){this.diagrams&&this.diagrams.forEach&&this.diagrams.forEach(function(b){b.boardArea.changeParentElDOM(null)});this.reserveDiagrams=this.reserveDiagrams.concat(this.diagrams);this.diagrams=[];"undefined"==typeof this.m_game&&(this.m_game=new CB.Game);var c=new StringBuilder,e=this.m_game.getHeader(),d=this.m_game.getMainLine(),k=this.m_game.getStartPos().getMoveNum(),
    l={lineCnt:0,nodeCnt:0,breakForTraining:!1,foldCnt:0};if(this.bSuppressNotationForCMSI)l=new CB.NotationGenerator,c=this.m_game.getCurPos().getMoveNum(),(e=this.m_game.getLastMove())?(l=l.getMoveNota(e,c),CB.$(".nota-game",this.elem).html(l)):CB.$(".nota-game",this.elem).html("Notation is hidden intentionally");else{b.initLine(this,d,0,0,k,0,c,l,0,0,0);this.m_useResult&&!l.breakForTraining&&this.InitResult(e.getResult(),c);CB.$(".nota-game",this.elem).html(c.toString());for(c=1;c<=l.foldCnt;c++)e=
    $("#fold"+c+this.nInPage),e.click(function(b){this.doOnFoldLine(b,function(b){b.toggle()})}.bind(this)),e.on("touchstart",function(b){this.doOnFoldLine(b,function(b){b.toggle()})}.bind(this)),e.on("fold",function(b){this.doOnFoldLine(b,function(b){b.hide()})}.bind(this)),e.on("unfold",function(b){this.doOnFoldLine(b,function(b){b.show()})}.bind(this));this.afterInitDiagrams();(new CB.Timer(function(){this.stopAtMoves&&0<this.stopAtMoves.length||this.createEvaluationProfile()}.bind(this))).runOnce(30);
    this.onNavigate(!0)}};b.prototype.doOnFoldLine=function(b,c){var e=b.currentTarget.dataset.line,d=$(String.f(".cbmove[data-linecnt='{0}']:not([data-inx-mv='0'])",e));c(d);var f=$(String.f(".cbcomment[data-linecnt='{0}']",e));c(f);e=$(String.f("[data-linecnt-this='{0}']",e));c(e);d.length&&(f=$(d[0]).parent().find(".cbcol-marker"),c(f));d.is(":visible")||e.is(":visible")?($(b.currentTarget).addClass("cbFoldBtn"),$(b.currentTarget).removeClass("cbUnFoldBtn"),$(b.currentTarget).parent().find(".cbUnFoldBtn").trigger("unfold")):
    ($(b.currentTarget).addClass("cbUnFoldBtn"),$(b.currentTarget).removeClass("cbFoldBtn"))};b.initLine=function(b,c,e,d,l,m,p,r,t,w,q){var f=++r.lineCnt,g=0;m||c.isAnnotated()&&(g=1);0===m&&(b.useMatBalance?b.createMatBalance():b.destroyMatBalance());var h=0,k=0,C=0;c.forEach(function(b){b.forAllMoves(function(b){h++;(b=b.getAnno())&&b[CB.AnnoType.POSTTEXT]&&(C+=b[CB.AnnoType.POSTTEXT].toString().length)});b.hasLines()&&k++});var B=6>=m&&(10<h+C/8||1<q)&&V15.config.hasFolding;if(1<=m&&B){var D=(++r.foldCnt).toString()+
    b.nInPage.toString();D=String.f("<span class='cbNodeBtn cbFoldBtn' data-line='{0}' data-level={2} id='{1}'></span>",f,"fold"+D,m)}p.appendFormat("<span class='cbline' data-inx-line='{0}' data-inx-mv-parent = '{1}' data-level='{2}' data-commented='{3}' data-linecnt-this='{4}' data-nodecnt-this='{5}' lastLine='{6}'>{7}",e,d,m,g,t,w,e===q-1?"1":"0",D);0===m&&b.createMovelessAnnoElement(c,p);e=!1;0<c.length&&(e=c[0].getSide()===CB.Side.WHITE);d=!0;t=0;for(q=c.length;t<q;++t){g=c[t];b.CreateMoveElements(g,
    t,c,l,e||d,m,p,r,f,w);if(r.breakForTraining)break;(e=!e)&&++l;d=g.hasLines()}p.append("</span>")};b.prototype.suppressNotationForCMSI=function(){this.bSuppressNotationForCMSI=!0;this.removeEvaluationProfile()};b.prototype.createMovelessAnnoElement=function(b,c){(b=b.getAnno())&&(b[CB.AnnoType.POSTTEXT]||b[CB.AnnoType.PRETEXT])&&b[CB.AnnoType.POSTTEXT]&&(b=b[CB.AnnoType.POSTTEXT].getString(),this.createCommentElements(b,0,0,c,0))};b.DIAG_CHAR="[#]";b.prototype.createCommentElementsWithDiags=function(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            e,d,k,l,m,p){if(c){if(0>c.indexOf(b.DIAG_CHAR))return this.createCommentElements(c,e,d,m,p);for(var f=0,g=c.indexOf(b.DIAG_CHAR);0<=g;g=c.indexOf(b.DIAG_CHAR,f))0<g-f&&(f=c.substring(f,g),this.createCommentElements(f,e,d,m,p)),this.wroteDiagram=this.createDiagElements("",e,d,k,l,m,p),f=g+b.DIAG_CHAR.length;f<c.length&&(f=c.substring(f),this.createCommentElements(f,e,d,m,p))}};b.prototype.createMedal=function(b,c,e,d,l){b&&(d.appendFormat("<span class='cbcomment cbmedal medal-{2}' data-inx-mv='{0}' data-linecnt='{1}'>",
    c,l,b),d.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp</span>"),d.append(" "))};b.prototype.createCommentElements=function(b,c,e,d,l){d.appendFormat("<span class='cbcomment' data-inx-mv='{0}' data-linecnt='{1}'>",c,l);d.append(CB.strUtil.escapeHtmlEntities(b));d.append("</span>");d.append(" ")};b.prototype.createTrainingElements=function(b,c,e,d,l,m){e=CB.Language.getStrUserLanguageTwoChars();d.appendFormat("<span class='cbcomment cbtraining' data-inx-mv='{0}' data-linecnt='{1}'>",c,l);d.append(CB.strUtil.escapeHtmlEntities(b.getQuestion(e)||
    lm.TRAINING_QUESTION));b.solved||(d.append('<div class="cbTrainingLinks">'),d.append(String.f('<span class="cbTrainingLink cbTrainingSolution" data-inx-mv="{0}" data-linecnt="{1}">{2}</span>',c,l,lm.TRAINING_SOLUTION)),1<=b.nHelpClicked?(d.appendFormat("<span class='cbcomment cbtraining cbtraininghelptext' data-inx-mv='{0}' data-linecnt='{1}'>",c,l),d.append(CB.strUtil.escapeHtmlEntities(b.getHelp(e)||"No help available")),d.append("</span>")):b.getHelp(e)&&d.append(String.f('<span class="cbTrainingLink cbTrainingHelp" data-inx-mv="{0}" data-linecnt="{1}">{2}</span>',
    c,l,lm.TRAINING_HELP)),d.append("</div>"));d.append("</span>");d.append(" ");return!b.solved};b.CreateGlyphableText=function(b,c,e){if(b.length){for(var f=!0,g=0,h=b.length;g<h;++g)if(57344<=b.charCodeAt(g)){f=!1;break}if(f)c.append(b);else{f=!1;var p="";g=0;for(h=b.length;g<h;++g){var r=b[g],t="\ue000"<=r;t===f?p+=r:(f?d(p,c,e):c.append(p),p=r,f=t)}p&&(f?d(p,c,e):c.append(p))}}};b.prototype.CreateGlyphableSpanText=function(c,e){e=document.createElement("span");b.CreateGlyphableText(c,e,"cbspec-glyph");
    return e};b.prototype.CreateMoveElements=function(c,e,d,k,l,m,p,r,t,w){var f=c.getAnno();f&&f[CB.AnnoType.PRETEXT]&&this.createCommentElementsWithDiags(f[CB.AnnoType.PRETEXT].getString(),e,d,f,!1,p,t);var g=k;l||this.wroteDiagram||(g=null);this.wroteDiagram=!1;l=this.m_ng.getMoveNota(c,g);if(f&&f[CB.AnnoType.SYMBOL]){g=f[CB.AnnoType.SYMBOL];for(var h=0;h<g.length;h++);l=Vp.addTexts(l,g)}0==e?p.appendFormat("<span class='cbmove' data-inx-mv = '{0}' data-linecnt = '{1}' data-nodecnt = '{2}'>",e,t,w):
    p.appendFormat("<span class='cbmove' data-inx-mv = '{0}' data-linecnt = '{1}'>",e,t);b.CreateGlyphableText(l,p,"cbspec-glyph");p.append("</span>");p.append(" ");f&&(f[CB.AnnoType.SQUARE_LIST]||f[CB.AnnoType.ARROW_LIST]?p.appendFormat("<span class='cbcol-marker' data-inx-mv='{0}'> </span>",e):f[CB.AnnoType.MOVE_MEDAL]&&p.appendFormat("<span class='cbmedal-marker' data-inx-mv='{0}'> </span>",e));p.append(" ");f&&f[CB.AnnoType.TIME]&&this.createCommentElementsWithDiags(f[CB.AnnoType.TIME].getString(),
    e,d,f,!0,p,t);f&&f[CB.AnnoType.MOVE_MEDAL]&&this.createMedal(f[CB.AnnoType.MOVE_MEDAL].getOneMedal(),e,d,p,t);f&&f[CB.AnnoType.POSTTEXT]&&this.createCommentElementsWithDiags(f[CB.AnnoType.POSTTEXT].getString(),e,d,f,!0,p,t);if(c.hasLines())for(c=c.getSubLines(),w=++r.nodeCnt,l=0,g=c.length;l<g;++l)b.initLine(this,c[l],l,e,k,m+1,p,r,t,w,g);f&&f[CB.AnnoType.TRAINING]&&(this.createDiagElements("Find the next move",e,d,f,!0,p,t),r.breakForTraining=this.createTrainingElements(f[CB.AnnoType.TRAINING],e,
    d,p,t,r));f&&f[CB.AnnoType.DIAGRAM]&&(k=f[CB.AnnoType.DIAGRAM].getString(),this.createDiagElements(k,e,d,f,!0,p,t))};b.prototype.createDiagElements=function(c,e,d,k,l,m,p){if(this.m_useDiagrams)return l||--e,d=this.m_game.getLinePos(d,e+1),this.m_options.setColorMarkersOnDiagrams||(k=null),k=b.toFenEx(d,k),m.appendFormat("<span class='cbdia' data-fen='{0}' data-legend='{1}' data-inx-mv='{2}' data-linecnt='{3}'>",k,c,e,p),m.append("</span>"),!0};b.toFenEx=function(b,c){b=b.toFEN();c&&c[CB.AnnoType.ARROW_LIST]&&
(b=b+";"+c[CB.AnnoType.ARROW_LIST].toString(";"));c&&c[CB.AnnoType.SQUARE_LIST]&&(b=b+";"+c[CB.AnnoType.SQUARE_LIST].toString(";"));return b};b.parseFenEx=function(b){b=b.split(";");for(var c=new Position(b[0]),e=new Annotation,d=new ColSqAnno,f=new ColArrowAnno,m=1,p=b.length;m<p;++m){var r=b[m];if(r.length==ColSq.STRING_LEN){var t=new ColSq;t.init(r);d.push(t)}else r.length==ColArrow.STRING_LEN&&(t=new ColArrow,t.init(r),f.push(t))}0<d.length&&e.setItem(AnnoType.SQUARE_LIST,d);0<f.length&&e.setItem(AnnoType.ARROW_LIST,
    f);return{anno:e,position:c}};b.prototype.removeClass=function(b){for(var c=Array.prototype.slice.call(document.getElementsByClassName(b)),e=0,d=c.length;e<d;e++){var f=c[e];f.className=f.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)","g"),"$1")}};b.prototype.setSelItem=function(b,e){if(null!==b){this.m_selElem&&(CB.$(this.m_selElem).removeClass("cbcur-move"),this.m_selElem=null);var d=CB.$(this.elem);e||b?(this.m_selElem=b,CB.$(this.m_selElem).addClass("cbcur-move"),!c&&this.m_selElem&&($(this.m_selElem).is(":visible")||
$(this.m_selElem).parents().children(".cbNodeBtn").trigger("unfold"),this.IsInPageVisible(this.m_selElem)||this.scrollIntoView(this.m_selElem)),c=!1):"scroll"!==d.css("overflow-y")&&window.scrollTo(notaElm.getX(),notaElm.getY())}};b.prototype.scrollCurElemIntoView=function(){if(this.m_selElem)return this.scrollIntoView(this.m_selElem)};b.prototype.blinkCurrElem=function(){this.blinkElem(this.m_selElem,"blinkShort")};b.prototype.blinkCurrElemMedium=function(){this.blinkElem(this.m_selElem,"blinkMedium")};
    b.prototype.blinkElem=function(b,c){b&&($(b).addClass(c),(new CB.Timer(function(){$(c).removeClass(c)}.bind(this))).runOnce(600))};b.prototype.emphasizeMove=function(){this.scrollCurElemIntoView();this.blinkElem(this.m_selElem,"blinkAnimation")};b.prototype.scrollIntoView=function(b){var c=b.offsetTop;b=c+b.offsetHeight;var e=this.scrollParent.scrollTop,d=this.scrollParent.clientHeight,f=e+d,m=this.scrollParent.scrollTop;c<e?this.scrollParent.scrollTop=Math.max(0,c-30):b>f&&(this.scrollParent.scrollTop=
        b-d);c=Math.abs(this.scrollParent.scrollTop-m);300<c&&this.blinkCurrElem();return 0<c};b.prototype.IsInPageVisible=function(b){var c=b.offsetTop;b=c+b.offsetHeight;var e=this.scrollParent.scrollTop,d=e+this.scrollParent.clientHeight;return c>=e&&b<=d};b.prototype.handleCursorDown=function(){var b=this.findMoveInAdjacentLine(this.m_selElem,!1);b&&(this.setSelItem(b),this.gameGotoElement(b))};b.prototype.handleCursorUp=function(){var b=this.findMoveInAdjacentLine(this.m_selElem,!0);b&&(this.setSelItem(b),
        this.gameGotoElement(b))};b.prototype.findMoveInAdjacentLine=function(b,c){if("undefined"!=typeof $&&b){b=$(b);var e=b.data("linecnt"),d=b.data("inx-mv");e=b.parent().find(String.f('[data-linecnt-this="{0}"][data-inx-mv-parent="{1}"]',e,d));if(e.length&&!c&&(d=$(e[0]).data("nodecnt-this"),e=$(e[0]).find(String.f('[data-nodecnt="{0}"][data-inx-mv="0"]',d)),e.length))return e[0];var f=b.offset().top,g=[],p=1E7;e=function(b,e){b=$(e).offset().top-f;(c?0>b:0<b)&&Math.abs(b)<=p&&(p=Math.abs(b),g.push(e))};
        c?$($(this.elem).find(".cbmove").get().reverse()).each(e):$(this.elem).find(".cbmove, .cbtraininghelptext").each(e);g.sort(function(b,c){return Math.abs($(b).offset().top-f)-Math.abs($(c).offset().top-f)});for(e=1;e<g.length;e++)if(c){if($(g[e]).offset().top<$(g[0]).offset().top){g.length=e;break}}else if($(g[e]).offset().top>$(g[0]).offset().top){g.length=e;break}b.offset();b.width();g.sort(function(b,c){return $(b).offset().left-$(c).offset().left});return g[0]}};b.prototype.findMoveInPrevLine=
        function(b,c){if("undefined"!=typeof $&&b){var e=null,d=1E7,f=0,g=$(b);$(b).prevAll().find(".cbmove").each(function(b,c){b=$(c).offset().top-g.offset().top;if(0>b){var h=Math.abs($(c).offset().left-g.offset().left);h<d&&(b==f||!e)&&(d=h,e=c,f=b)}}.bind(this));return e}};b.prototype.m_lastClicked=null;b.prototype.onMouseWheel=function(b){if(this.m_game&&this.m_active){var c="undefined"!=typeof b.wheelDelta?-b.wheelDelta:b.detail;"undefined"==typeof $&&(0>c?this.m_game.gotoPrev():this.m_game.gotoNext(),
        b.preventDefault())}};b.prototype.onButtonDown=function(b){this.ptTouchStart=this.ptTouchMove=new CB.Point(b);CB.LOG("ButtonDown:"+this.ptTouchStart);this.buttonDown=!0;this.isTouch="touchstart"==b.type};var c;b.prototype.onButtonUp=function(b){CB.LOG("ButtonUp");this.buttonDown=!1;this.ptTouchMove&&2!=b.button&&10>this.ptTouchMove.getDist(this.ptTouchStart)&&(c=!0,this.focus(),this.onElementClick(b)&&this.fireOnMoveTouched())};b.prototype.onDoubleClick=function(b){this.m_game.fireOnNotaDoubleClick()};
    b.prototype.onContextMenu=function(b){this.onElementClick(b);V15.panelMgr.execNotaContextMenu&&(V15.panelMgr.execNotaContextMenu(b),b.preventDefault())};b.prototype.focus=function(){V15.panelMgr&&V15.panelMgr.notaPanel&&V15.panelMgr.notaPanel.focus();var b=this.scrollParent;b?b.focus():alert("no parent for focus")};b.prototype.sign=function(b){return b?0>b?-1:1:0};var e=0<CB.System.getIEVersion()&&!CB.System.isMobile();b.prototype.onMouseMove=function(b){if(this.buttonDown&&!e){var c=(new CB.Point(b)).subtract(this.ptTouchMove);
        CB.LOG("Move: "+c);c.y/=Math.min(2,window.devicePixelRatio);this.scrollParent.scrollTop-=this.sign(c.y)*Math.pow(Math.abs(c.y),1.7)*.7;this.ptTouchMove=new CB.Point(b);if(0<c.y&&0==this.scrollParent.scrollTop||0>c.y&&this.scrollParent.scrollTop+this.scrollParent.clientHeight>=this.scrollParent.scrollHeight)return}b.preventDefault()};b.prototype.onMouseLeave=function(b){this.buttonDown=!1};b.prototype.onElementClick=function(b){if(!this.m_active||!this.m_game)return!1;var c=this.gameGotoElement(b.target);
        b.preventDefault();return c};b.prototype.gameGotoElement=function(b){var c=b;if(!$(c).is("[data-inx-mv]")&&((c=$(c).parents("[data-inx-mv]"))&&(c=c[0]),!c))return;this.m_lastClicked=c;var e=$(c).data("inx-mv"),d=0;++e;var f=[],m=!0,p=c.parentNode,r=b=!1;$(p).is(".cbLine ")||(p=$(c).parents(".cbline")[0]);$(c).is(".cbTrainingLink")&&(b=$(c).is(".cbTrainingSolution"),r=$(c).is(".cbTrainingHelp"));for(c=p;m;c=c.parentNode)d=Number(d),e=Number(e),f.push({inxLine:d,mvsToGo:e}),c&&c.getAttribute&&(m=CB.$(c),
        d=m.data("inx-line"),e=m.data("inx-mv-parent"),m=0!=m.data("level"));e=[];for(d=f.length-1;0<=d;--d)e.push(f[d]);this.m_game.gotoSimplePath(e);this.m_game.triggerOnClickInNotation();if(b||r)if(f=this.m_game.getAnno(CB.AnnoType.TRAINING)){b&&(f.solved=!0,CB.LogStats("Solution: "+this.m_game.hdr.getStrPlayers(!1,0)));r&&f.nHelpClicked++;this.onChanged();b&&this.m_game.gotoNext();if(r)for(b=0;3>b;b++)this.handleCursorDown();this.scrollParent.scrollTop+=60}return!0};b.prototype.markCurLine=function(){var b=
        this.m_selElem;if(b){var c=CB.$(b);if(!CB.$.is(b,"[data-inx-mv]")){b=c.parent("[data-inx-mv]");if(!b)return;c=CB.$(b)}var e=$("#"+this.elementId);this.clearCurLine(e);c=c.data("linecnt");1<c&&(e=e.find(String.formatEx('[data-linecnt="{0}"]',c)),e.addClass("cbcurline"),this.markParentCurLine(e,0));this.markAlternatives($(b))}};b.prototype.clearCurLine=function(b){b.find(".cbcurAlternative").removeClass("cbcurAlternative");b.find(".cbcurline").removeClass("cbcurline");b.find(".cbcurlineparent").removeClass("cbcurlineparent");
        for(var c=1;6>=c;c++)b.find(".cbcurnode"+c).removeClass("cbcurnode"+c)};b.prototype.markParentCurLine=function(b,c){if(b.length&&(b=$(b[0]).parent("[data-inx-mv-parent]"))){var e=parseInt($(b).data("inx-mv-parent")),d=$(b).data("linecnt-this"),f=$(b).data("nodecnt-this"),g=$(b).data("level");if(0<d){var p=$("#"+this.elementId);f=p.find(String.formatEx('[data-nodecnt="{0}"]',f));1<=f.length&&(6>g?f.addClass("cbcurnode"+g):f.addClass("cbcurnode6"));d=String.formatEx('[data-linecnt="{0}"]',d);p=p.find(d);
        for(d=0;d<p.length;d++){f=$(p[d]);var r=parseInt(f.data("inx-mv"));r<=e&&1<g&&(r<=e-1?f.addClass("cbcurlineparent"):f.addClass("cbcurnode"+g))}this.markParentCurLine($(b),++c)}}};b.prototype.markAlternatives=function(b){var c=b.data("linecnt"),e=b.data("inx-mv");b.parent().find(String.f('[data-linecnt-this="{0}"][data-inx-mv-parent="{1}"]',c,e)).each(function(b,c){b=$(c).data("nodecnt-this");$(c).find(String.f('[data-nodecnt="{0}"][data-inx-mv="0"]',b)).addClass("cbcurAlternative")})};b.prototype.FindMoveElement=
        function(b){if(this.m_game){var c=this.m_game.getSimplePath();b="";for(var e=0,d=0,f=c.length;d<f;++d){b&&(b+=">");var m=c[d],p=m.mvsToGo;b+=String.formatEx("span.cbline[data-level='{2}'][data-inx-line='{0}'][data-inx-mv-parent='{1}']",m.inxLine,e,d);d===f-1&&(b+=String.formatEx(">span.cbmove[data-inx-mv ='{0}']",p-1));e=p}c=0==b.length;b=String.f("div.nota-game[data-inx-game='{0}']>",this.nInPage)+b;return this.m_lastClicked&&CB.$.is(this.m_lastClicked,b)?this.m_lastClicked:!c&&(b=CB.$(b))&&1==b.length?
            b[0]:null}};b.prototype.afterInitDiagrams=function(){if("undefined"!=typeof $&&V15.panelMgr.createDiagramPlayingMode){var b=180;V15.panelMgr.getDiagHeight&&(b=V15.panelMgr.getDiagHeight($(this.elem).width()));var c=0;$("#"+this.elementId).find(".cbdia").each(function(e,d){if(0==$(d).find("div").length){$(d).width(1.1*b);$(d).height(b);var f=this.reserveDiagrams.pop();this.gameKernel=new CB.GameKernel(V15.panelMgr);var g={kernel:this.gameKernel,diagramDiv:d};g.kernel.setPlayingMode(V15.panelMgr.createDiagramPlayingMode(g.kernel));
        g.kernel.fnInitGame=function(){return function(b,c){c.boardWin&&(c.boardWin.allowInput=!1);b.reset();d&&(c=d.dataset.fen)&&(c=new CB.Position(c),b.assign(new CB.Game(c)))}}();var h=this.createDiv("diagarea",c);$(h).width(b);$(h).height(b);d.appendChild(h);f?(g.boardArea=f.boardArea,g.boardArea.changeParentElDOM(h),g.kernel.setBoardWin(g.boardArea.canvas.control.boards[0]),g.kernel.initGame()):(g.boardArea=new CB.CanvasParent(h),g.boardArea.createCanvas(g.kernel,{topDist:0,bottomDist:0,marginDistDivisor:26,
            shiftXPercent:-1.65,minWForCoordinates:220,transparent:!0,boardShadow:!1}),g.kernel.releaseCommandHandlers());g.boardArea.setSize(h.offsetWidth,h.offsetHeight);g.boardArea.setVisible(!0);this.diagrams.push(g);this.resizeDiagram(d,e);c++}}.bind(this))}};b.prototype.resizeDiagrams=function(){"undefined"!=typeof $&&$("#"+this.elementId).find(".cbdia").each(function(b,c){this.resizeDiagram(c,b)}.bind(this))};b.prototype.resizeDiagram=function(b,c){if(b&&"undefined"!=typeof $){var e=$(b).find("#diagarea"+
        c);b=e[0];var d=e.width();e=e.height();b&&this.diagrams[c]&&this.diagrams[c].boardArea&&this.diagrams[c].boardArea.setSize(d-1,e)}};b.prototype.createEvaluationProfile=function(){if(CB.EvalProfileControl){var b=$("#"+this.elementId),c=$("#idEvCanvas-"+this.nInPage),e=this.m_game.getEvaluationProfile();if(e&&e.isValid())if(c.length)this.evProfileControl&&this.evProfileControl.setEvalArr(e);else{c=b.find(".nota-game");var d=c.height();0==d&&(d=b.height());b.find(".nota-foot-container");var l=document.createElement("div");
        l.id="idEvCanvas-"+this.nInPage;l.className="cbevprofile";450<CB.System.zoomToPix(d)||CB.System.isMobile()&&CB.System.isPortraitScreen()||900<window.innerHeight?($(l).insertBefore(b.find(".nota-foot-container")),l.style.margin="0",l.style.boxShadow=""):c.append(l);this.evCanvas=b=new CB.CanvasParent(l);b.setVisible(!0);var m=this;b.createCanvas({createControl:function(b,c,d,f){m.evProfileControl=new CB.EvalProfileControl(b,c,d,"EvlProfile",f,function(b){m.m_game.gotoIndex(Math.min(b,m.m_game.mainLine.length));
                m.IsInPageVisible(m.m_selElem)||m.scrollIntoView(m.m_selElem)});m.evProfileControl.setEvalArr(e);return m.evProfileControl}},{});this.evProfileControl&&this.evCanvas&&this.evCanvas.setSize(this.setEvCanvasWidth,this.getEvProfileHeight())}else this.evProfileControl&&this.evProfileControl.reset()}};b.prototype.removeEvaluationProfile=function(){var b=$("#idEvCanvas-"+this.nInPage);b&&b.remove();delete this.evProfileControl};b.prototype.getEvProfileHeight=function(){var b=66;1150<window.innerHeight?
        b=80:800>window.innerHeight&&(b=600>window.innerHeight?45:55);return b};b.prototype.resizeEvProfile=function(b){this.setEvCanvasWidth=b-26;b=$("#idEvCanvas-"+this.nInPage).width();this.evCanvas&&(this.evCanvas.setSize(b,this.getEvProfileHeight()),this.setEvCanvasWidth=b)};b.prototype.createDiv=function(b,c){var e=document.createElement("div");e.id=b+c;e.className=b;return e};b.prototype.isActive=function(){return this.m_active};b.prototype.setActive=function(b){this.m_active=b};b.prototype.onElementDragOver=
        function(b){b.preventDefault()};b.prototype.onElementDragEnter=function(b){b.preventDefault()};b.prototype.onElementDrop=function(b){CB.LOG("Drop:"+b.dataTransfer);if(this.m_active){b.preventDefault();b=b.dataTransfer;var c=b.files;c.length?this.fromPGNFile(c[0]):(b=b.getData("text"))&&this.loadPGN(b)}};b.prototype.refoldToCurrentLine=function(){0==$(this.elem).find(".cbNodeBtn").length&&(this.initSubElements(),this.markCurLine());if(this.m_selElem){var b=$(this.m_selElem).parents().children(".cbNodeBtn");
        $(this.elem).find(".cbNodeBtn").not(b).each(function(b,c){$(c).trigger("fold")})}this.scrollCurElemIntoView()};b.prototype.unfoldAll=function(){V15.config.hasFolding=!0;var b=$(this.elem).find(".cbNodeBtn");0==b.length?(this.initSubElements(),this.markCurLine(),b=$(this.elem).find(".cbNodeBtn"),b.each(function(b,c){$(c).trigger("fold")})):$(".cbmove:hidden")[0]?b.length&&b.each(function(b,c){$(c).trigger("unfold")}):$(".cbNodeBtn").remove();this.scrollCurElemIntoView()};b.prototype.fromPGNFile=function(b){if("function"==
        typeof FileReader){var c=new FileReader;c.onloadend=function(){this.pgnLoadDone(c)}.bind(this);c.readAsText(b)}};b.prototype.pgnLoadDone=function(b){this.loadPGN(b.result)};b.prototype.loadPGN=function(b){this.m_game.merge&&this.m_game.merge(PGN.parseGame(b))};Ve.initForListeners(b);Ve.addEvent(b,"MoveTouched");return b}();
CB.NotaElement.factory=function(d,b,c,e,f){b=new CB.NotaElement(b,e||0,f);null==c&&(c=CB.cbNotationDefaults,c.useMatBalance=V15.panelMgr.useMatBalanceDefault());b.initElem(d,c);V15.panelMgr&&(V15.panelMgr.notaElement=b);return b};"use strict";
CB.NotaHeaderElement=function(){var d={},b=function(b){this.w=500;this.h=400;this.initTemplates(300,200);this.elementId=0;this.gateUpdate=new CB.Vr;this.EMPTY_PERSON=V15.mediaPath+"Buttons/Person.jpg";this.EMPTY_UNO=V15.mediaPathFlags+"Flags16/United nations.png";this.requestedBlack=this.requestedWhite="";this.nInPage=b;this.titleText="";this.PERSON_FORMAT="<a href='http://pbserver.chessbase.com/Player?name={4},{5}&year={6}&ref=JSReader' target='_blank'><img class = 'cbplayerimage' src='{0}' alt='{4}' height='{2}' width='{3}'  playid='{1}' ></a>";
    V15.config.playerPicLink&&(this.PERSON_FORMAT="<a href='"+V15.config.playerPicLink+"' target='_blank'><img class = 'cbplayerimage' src='{0}' alt='{4}' height='{2}' width='{3}'  playid='{1}' ></a>")};b.prototype.playerDataSource=null;b.prototype.panel=null;b.prototype.m_ng=null;b.prototype.m_selElem=null;b.prototype.m_active=!0;b.prototype.arrPlayer=[null,null];b.prototype.arrPortrait=[null,null];b.prototype.isCompact=function(b,c){return 380>b||240>c};b.prototype.isMoreCompact=function(b,c){return 300>
    b||150>c&&500>b};b.prototype.isVeryCompact=function(b,c){return 290>b||130>c&&360>b||80>c};b.prototype.isTiny=function(b,c){return 220>b||90>c&&300>b||70>c};b.prototype.isPracticallyInvisible=function(b,c){return 140>b||70>c};b.prototype.usePlayerBase=function(){return!this.isVeryCompact(this.w,this.h)};b.prototype.resetPlayerCache=function(){};b.prototype.initTemplates=function(b,d){this.w=b;this.h=d;if(this.titleText)if(b=[].concat(this.titleText),this.titleIcon){d=String.formatEx(c,this.titleIcon);
    var e='<div class="cbgame-header" id="ourheaderinside" ><table class="scroll notaTable" id="ourheader"><tr><td width="0%"><span class="cbplayerportrait">'+d+'</span></td><td width="0%"><span class="cbnota-title">'+b[0]+'</span></td><td width="0%"><span class="cbplayerportrait">'+d+"</span></td></tr>";for(d=1;d<b.length;d++)e+='<tr><td width="100%" colspan="3"><span class="cbnota-subtitle">'+b[d]+"</span></td></tr>";e+="</table></div>"}else e='<div class="cbgame-header" id="ourheaderinside" ><span class="cbnota-title">'+
    this.titleText+"</span></div>";else e=this.isPracticallyInvisible(b,d)?'<div class="cbgame-header-tiny" id="ourheaderinside"  style="visibility:hidden;display:none;" ></div>':this.isTiny(b,d)?'<div class="cbgame-header-tiny" id="ourheaderinside" ><table class="notaTable" id="ourheader"><tr><span class="cbmain-header-verycompact"><td width="45%" class="cbplayerwhite"><span class="cbplayertiny">{white.list}</span></td><tpl if="{black}"><td width="10%" class="cbresult"><span >{resultStr}</span></td><td width="45%" class="cbplayerblack"><span class="cbplayertiny">{black.list}</span></td></tpl></tr></table></div>':
    this.isVeryCompact(b,d)?'<div class="cbgame-header-verycompact" id="ourheaderinside" ><table class="notaTable" id="ourheader"><tr><span class="cbmain-header-verycompact"><td width="45%" class="cbplayerwhite"><span class="cbplayer">{white.list}</span><tpl if="{eloWhStr}"><span class="cbelocompact">{eloWhStr}</span></tpl></td><tpl if="{black}"><td width="10%" class="cbresult"><span >{resultStr}</span></td><td width="45%" class="cbplayerblack"><span class="cbplayer">{black.list}</span><tpl if="{eloBlStr}"><span class="cbelocompact">{eloBlStr}</span></tpl></td></tpl></tr></table></div>':
        this.isMoreCompact(b,d)?'<div class="cbgame-header-morecompact" id="ourheaderinside" ><table class="scroll notaTable" style="table-layout:fixed" id="ourheader"><tr><span class="cbmain-header"><td colspan="2"class="cbflagwhite-morecompact"><span class="cbplayernation">{country[0]}</span></td><td colspan="9" class="cbplayerwhite"><span class="cbplayer" >{white.list}</span><tpl if="{eloWhStr}"><span class="cbelocompact">{eloWhStr}</span></tpl></td><tpl if="{black}"><td colspan="2" class="cbresult"><span >{resultStr}</span></td><td colspan="9"  class="cbplayerblack"><span class="cbplayer">{black.list}</span><tpl if="{eloBlStr}"><span class="cbelocompact">{eloBlStr}</span></tpl></td></tpl><td colspan="2" class="cbflagblack-morecompact"><span class="cbplayernation">{country[1]}</span></td></tr></table></div>':
            this.isCompact(b,d)?'<div class="cbgame-header-compact" id="ourheaderinside" ><table class="scroll notaTable" style="table-layout:fixed" id="ourheader"><tr><span class="cbmain-header"><td colspan="9"class="cbplayerwhite"><span class="cbplayer" >{white.list}</span><tpl if="{eloWhStr}"><span class="cbelocompact">{eloWhStr}</span></tpl></td><tpl if="{black}"><td colspan="2" class="cbresult"><span >{resultStr}</span></td><td colspan="9"  class="cbplayerblack"><span class="cbplayer">{black.list}</span><tpl if="{eloBlStr}"><span class="cbelocompact">{eloBlStr}</span></tpl></td></tpl></tr><tr><td colspan="2" class="cbflagwhite"><span class="cbplayernation">{country[0]}</span></td><td colspan="1" class="cbfide cbfidecompact"><span>{titleWhStr}</span></td><td colspan="14" style="text-align:center"><tpl if="{event.event}"><span class="cbevent">{event.event}</span></tpl></td><td colspan="1" class="cbfide cbfidecompact"><span>{titleBlStr}</span></td><td colspan="2" class="cbflagblack"><span class="cbplayernation">{country[1]}</span></td></tr></table></div>':
                '<div class="cbgame-header" id="ourheaderinside" ><table class="scroll notaTable" id="ourheader" style="table-layout:fixed" ><tr><span class="cbmain-header"><td  class="cbplayerportrait" colspan="3" rowspan="2"><span >{portrait[0]}</span></td><td class="cbplayerwhite" colspan="8"><span class="cbplayer">{white}</span><tpl if="{eloWhStr}"><span class="cbelo">{eloWhStr}</span></tpl></td><tpl if="{black}"><td colspan="2" class="cbresult"><span >{resultStr}</span></td><td class="cbplayerblack" colspan="8"><span class="cbplayer">{black}</span><tpl if="{eloBlStr}"><span class="cbelo">{eloBlStr}</span></tpl></td><td class="cbplayerportrait" colspan="3" rowspan="2"><span>{portrait[1]}</span></td></tpl></tr><tr><td colspan="2" class="cbflagwhite" ><span class="cbplayernation">{country[0]}</span></td><td colspan="1" class="cbfide"><span>{titleWhStr}</span></td><td colspan="12" class="cbtourndata"><tpl if="{event.event}"><span class="cbevent">{event.event}</span></tpl><tpl if="{uniquePlace}"><br/><span class="cbsite">{uniquePlace}</span></tpl><tpl if="{event.dt}"><span class="cbeventdate">{dateStr}</span></tpl><tpl if="{annotator}"><span class="cbannotator">{annotatorStr}</span></tpl></td><td colspan="1" class="cbfide"><span>{titleBlStr}</span></td><td colspan="2" class="cbflagblack"<span class="cbplayernation">{country[1]}</span></td></tr></table></div>';
    this.headerTemplate=function(){return String.formatEx(e,this)}};var c="<img src='{0}' alt='' height='24' width='24'>";b.prototype.InitEmptyHeader=function(c){c=c||new CB.GameHeader;this.hdrItem=ObjUtil.clone(c);this.hdrItem.resultStr=b.ResultToStr(this.hdrItem.getResult());this.hdrItem.portrait=[null,null];this.hdrItem.country=[null,null];this.hdrItem.geoIpNation=[0,0];this.hdrItem.title=[null,null];c.nationWhite&&(this.hdrItem.geoIpNation[0]=c.nationWhite);c.nationBlack&&(this.hdrItem.geoIpNation[1]=
    c.nationBlack);return this.headerTemplate&&this.headerTemplate.apply?this.headerTemplate.apply(this.hdrItem):" --- "};b.prototype.InitHeader=function(b,c){this.displayOpening("");-1==this.hdrItem.event.event.search(this.hdrItem.event.site)&&(this.hdrItem.uniquePlace=this.hdrItem.event.site);-1!==this.hdrItem.annotator.search("Robot")&&(this.hdrItem.annotator="");this.usePlayerBase()&&b&&(this.displayOpening(b.eco),this.hdrItem.eloWhStr=0<b.eloWh?b.eloWh:"",this.hdrItem.eloBlStr=0<b.eloWh?b.eloBl:
    "",this.hdrItem.annotatorStr=b.annotator?"["+b.annotator+"]":"","[ChessBase]"==this.hdrItem.annotatorStr&&(this.hdrItem.annotatorStr=""),this.hdrItem.annotatorStr||(this.hdrItem.dateStr=b.date.toLocaleString()),this.prepareHeader(this.hdrItem),this.requestPlayerBase(),this.hdrItem.titleWhStr=this.getTitleStr(this.hdrItem,0),this.hdrItem.titleBlStr=this.getTitleStr(this.hdrItem,1),this.bRequestPlayerBase=!1);if(c){if(this.headerTemplate&&this.headerTemplate.apply)return this.headerTemplate.apply(this.hdrItem)}else if(this.headerInsideTemplate.apply)return this.headerInsideTemplate.apply(this.hdrItem);
    return b?b.toString():null};b.prototype.getTitleStr=function(b,c){if(b.title&&CB.Title)return CB.Title.getStr(b.title[c])};b.prototype.requestPlayerBase=function(){if(CB.LoginMode){var b=!1,c=this.hdrItem.getBlackKey();c=[this.hdrItem.getWhiteKey(),c];for(var g=CB.Side.WHITE;g<=CB.Side.BLACK;++g){var h=d[c[g]];h&&h.answered?(this.hdrItem.country[g]=h["country"+this.getFlagSize()],this.hdrItem.title[g]=h.title,g==CB.Side.WHITE?this.requestedWhite=this.hdrItem.white:this.requestedBlack=this.hdrItem.black):
    (this.hdrItem.geoIpNation[g]?(b=new CB.Nation(this.hdrItem.geoIpNation[g]),this.setHdrItemCountry(c[g],b,g)):this.hdrItem.country[g]=String.formatEx("<img src='{0}' alt='' height='16' width='16'>",this.EMPTY_UNO),b=this.bRequestPlayerBase&&(!h||!h.requested));h&&h.answered?(this.hdrItem.portrait[g]=h["portrait"+this.getPortraitSize()],!this.hdrItem.portrait[g]&&h.portrait32&&(this.hdrItem.portrait[g]=h.portrait32)):this.hdrItem.portrait[g]=String.formatEx("<img src='{0}' alt='' height='24' width='24' style='display:none'>",
    this.EMPTY_PERSON)}b&&this.gateUpdate.exec(function(){this.requestPlayerData()}.bind(this),500)}};b.prototype.prepareHeader=function(b){b.white.last=b.white.last.replace("-"," ");b.black.last=b.black.last.replace("-"," ");var c=b.white.first.search(/\./);0<c&&b.white.first&&(b.white.first=b.white.first.slice(0,c));c=b.black.first.search(/\./);0<c&&b.black.first&&(b.black.first=b.black.first.slice(0,c));b.getWhiteKey=function(){var b=this.white.last;this.white.first&&(b+=this.white.first.slice(0,1));
    return b};b.getBlackKey=function(){var b=this.black.last;this.black.first&&(b+=this.black.first.slice(0,1));return b}};b.prototype.requestPlayerData=function(){var b=this.m_game.getHeader();this.prepareHeader(b);var c=function(){if(V15.playerLobby){this.requestedWhite=b.getWhite();this.requestedBlack=b.getBlack();CB.LOG("Request: "+b.getWhite()+" / "+b.getBlack(),"","pb");var c=b.date.getYear();c||(c=CB.Date.getThisYear());b.white.last&&(V15.playerLobby.getPlayer(b.white.first,b.white.last,b.eloWh,
    c,this.onWhite.bind(this)),d[b.getWhiteKey()]||(d[b.getWhiteKey()]={}),d[b.getWhiteKey()].requested=!0);b.black.last&&(V15.playerLobby.getPlayer(b.black.first,b.black.last,b.eloBl,c,this.onBlack.bind(this)),d[b.getBlackKey()]||(d[b.getBlackKey()]={}),d[b.getBlackKey()].requested=!0)}else console.log("NoPB: "+b.white.last+"-"+b.black.last)}.bind(this);V15.playerLobby?c():(CB.LOG("PlayerLobby not connected yet","","pb"),(new CB.Timer(c)).runOnce(4E3))};b.prototype._onPlayer=function(c,f){if(c&&c.player){var e=
    c.player.getFirstName(),h=c.player.getLastName(),k=this.buildCacheKey(h,e);d[k]||(d[k]={});d[k].answered=!0;var l=c.player,m=new CB.Nation(0);this.arrPlayer[f]=l;l.m_NewCBPlayer&&(CB.LOG("OnPlayer: "+k,"","conn"),m=l.m_NewCBPlayer.m_HighData.m_aNation,m=new CB.Nation(m),l=l.m_NewCBPlayer.m_HighData.m_aTitle,this.hdrItem.title[f]=l,d[k].title=l,this.hdrItem.geoIpNation[f]||this.setHdrItemCountry(k,m,f));(c=c.pic)?(this.arrPortrait[f]="string"===typeof c?c:b.constructImageFromData(c),[34,40,48,64,80,
    100,120].forEach(function(b){var c=this.hdrItem.date.year;c||(c=CB.Date.getThisYear());c=String.formatEx(this.PERSON_FORMAT,this.arrPortrait[f],f,b*Math.SQRT2,b,h,e,c);b==this.getPortraitSize()&&(this.hdrItem.portrait[f]=c);d[k]["portrait"+b]=c}.bind(this))):this.isCompact(this.w,this.h)||this.isMoreCompact(this.w,this.h)||(c=this.getPortraitSize(),34==c||40==c?c=32:64<c&&(c=64),m=V15.mediaPathFlags+String.formatEx("Flags{0}/{1}.png",c,m.getStrFlag()),m=String.formatEx("<img src='{1}' alt='' height='{0}' width='{0}' style='vertical-align: {2};border:none;box-shadow:none' >",
    c,m,"top"),this.hdrItem.portrait[f]=d[k]["portrait"+c]=m,this.hdrItem.country[f]="",this.getFlagRaster().forEach(function(b){this.hdrItem.country[f]=" ";d[k]["country"+b]=" "}.bind(this)))}};b.prototype.buildCacheKey=function(b,c){if(c){var e=c.charAt(c.length-1);"0"<=e&&"9">=e&&(c=c.slice(0,c.length-1));b+=c.slice(0,1)}return b};b.prototype.setHdrItemCountry=function(b,c,g){if(c&&b&&(0==g||1==g)&&c.getStrFlag){var e=this.getFlagRaster();d[b]||(d[b]={});e.forEach(function(e){var f=V15.mediaPathFlags+
    String.formatEx("Flags{0}/{1}.png",e,c.getStrFlag());f=String.formatEx("<img src='{1}' alt='' height='{0}' width='{0}' style='vertical-align: {2};border:none;box-shadow:none' >",e,f,"middle");e==this.getFlagSize()&&(this.EMPTY_UNO=V15.mediaPathFlags+String.formatEx("Flags{0}/United nations.png",e),this.hdrItem.country[g]=f);d[b]["country"+e]=f}.bind(this))}};b.prototype.getFlagSize=function(){return 500>this.w||400>this.h?400>this.w||300>this.h?16:24:750<this.w&&560<this.h?48:32};b.prototype.getFlagRaster=
    function(){return[16,24,32,48,64]};b.prototype.getPortraitSize=function(){return 380<this.w&&260<this.h?450<this.w&&360<this.h?550<this.w&&450<this.h?650<this.w&&520<this.h?900<this.w?1E3<this.w?120:100:80:64:48:40:34};b.prototype.onWhite=function(b){CB.LOG("ON WHITE!");this._onPlayer(b,CB.Side.WHITE);this.scheduleUpdate(100)};b.prototype.onBlack=function(b){CB.LOG("ON BLACK!");this._onPlayer(b,CB.Side.BLACK);this.scheduleUpdate(100)};b.constructImageFromData=function(b){return CB.BinToString.ByteArrayToDataURI(b,
    "image/jpeg")};b.prototype.initElem=function(b,c){this.elementId=b;this._setOptions(c);b=CB.$("#"+b);if(CB.Element.isEventSupported("touchstart"))b.on("touchend",this.onButtonUp.bind(this));if(CB.Element.isEventSupported("mousedown"))b.on("mouseup",this.onButtonUp.bind(this));this.initSubElements()};b.prototype._setOptions=function(b){b.notationLocalization||(b.notationLocalization=CB.V1);this.m_ng=new CB.NotationGenerator(b.notationLocalization);this.m_useHeader=b.useHeader;this.m_useResult=b.useResult;
    this.m_active=b.isActive;this.m_options=b;b.game&&this.setGame(b.game)};b.prototype.setOptions=function(b){this._setOptions(b)};b.prototype.m_game=null;b.prototype.setGame=function(b){this.m_game&&(this.m_game.removeOnMoveListener(this.m_inxOnMove),this.m_game.removeOnNavigateListener(this.m_inxOnNavigate),this.m_game.removeOnChangedListener(this.m_inxOnChanged),this.m_game.removeOnHeaderChangedListener(this.m_inxOnHeaderChanged));if(this.m_game=b)this.m_inxOnMove=this.m_game.addOnMoveListener(this.onMove.bind(this)),
    this.m_inxOnNavigate=this.m_game.addOnNavigateListener(this.OnNavigate.bind(this)),this.m_inxOnChanged=this.m_game.addOnChangedListener(this.OnChanged.bind(this)),this.m_inxOnHeaderChanged=this.m_game.addOnHeaderChangedListener(this.onHeaderChanged.bind(this)),this.bRequestPlayerBase=!0;this.initSubElements()};b.prototype.getGame=function(){return this.m_game};b.prototype.onMove=function(){};b.prototype.OnChanged=function(){};b.prototype.onHeaderChanged=function(b){var c=null;this.m_game&&(c=this.m_game.getHeader());
    if(this.requestedWhite!==c.getWhite()||this.requestedBlack!==c.getBlack())this.bRequestPlayerBase=!0;b&&b.recalc&&(b=$("#notaEl").width(),c=$("#notaEl").height(),null==b&&(b=$("#notaEl"+this.nInPage).width(),c=$("#notaEl"+this.nInPage).height()),this.initTemplates(b,c));this.initSubElements()};b.prototype.OnNavigate=function(b){};b.ResultToStr=function(b){return b==CB.GameResultEnum.UNDEFINED_RESULT?"-":CB.GameResultEnum.toString(b)};b.prototype.displayOpening=function(b){3==b.length&&(this.hdrItem.eco=
    lm[b+"_ECO"])};b.prototype.scheduleUpdate=function(b){this.gateUpdate.exec(function(){this.updateSubElements();delete this.bRequestPlayerBase}.bind(this),b)};b.prototype.initSubElements=function(){var b=null;this.m_game&&(b=this.m_game.getHeader(),b.white.list=b.white.getListStr(1),b.black.list=b.black.getListStr(1));this.InitEmptyHeader(b,!0);b=this.InitHeader(b,!0);CB.$("#theheader-"+this.nInPage).html(b)};b.prototype.updateSubElements=function(){var b=null;this.m_game&&(b=this.m_game.getHeader());
    b=this.InitHeader(b,!0);CB.$("#theheader-"+this.nInPage).html(b)};b.prototype.focus=function(){};b.prototype.onMouseMove=function(b){b.preventDefault()};b.prototype.showPlayerDetails=function(b,c,d){"undefined"!==typeof Ext&&b&&!glSettings.inDialog()&&CB.Forms&&CB.Forms.showPlayer(b,c,d)};b.prototype.onButtonUp=function(b){};b.prototype.onElementClick=function(b){if(!(!this.m_active||600>window.innerHeight||700>window.innerWidth)){var c=b.target;CB.$.is(c,"[playid]")&&(c=CB.$(c).attr("playid"),this.showPlayerDetails(this.arrPlayer[c],
    0,this.arrPortrait[c]));b.preventDefault()}};b.prototype.isActive=function(){return this.m_active};b.prototype.setActive=function(b){this.m_active=b};b.prototype.onElementDragOver=function(b){b.preventDefault()};b.prototype.onElementDragEnter=function(b){b.preventDefault()};b.prototype.resize=function(b,c){CB.DOM.resize(this.elementId,b,c)};b.prototype.setTitleOnly=function(b,c){this.titleText=b;this.titleIcon=c;this.initTemplates(this.w,this.h);this.updateSubElements()};b.prototype.onResize=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              c){this.w=b;this.h=c;this.initTemplates(b,c);this.bRequestPlayerBase=!0;this.updateSubElements()};return b}();CB.NotaHeaderElement.factory=function(d,b){b=new CB.NotaHeaderElement(b);b.initElem(d,CB.cbNotationDefaults);return V15.panelMgr.notaHeaderElement=b};"use strict";
CB.NotaFooterElement=function(){var d=function(b,c){this.elementId=0;this.gateUpdate=new CB.Vr;this.matBalance=[];this.nInPage=b;this.ticket=c};d.prototype.panel=null;d.prototype.InitFooter=function(b){return this.generateHTML(b)};d.prototype.getPiece=function(b){return(CB.Side.toString(CB.Piece.side(b))+CB.Piece.toString(b)).toLowerCase()};d.TABLE_CELL_FMT='<span class="piece-{0}"></span>';d.TABLE_END_FMT="</div>";d.prototype.getTableStartFmt=function(){var b='<a href="'+(V15?V15.getAppUrl(V15.Vo.SWITCHAPP_DATABASE):
    "https://database.chessbase.com")+'" class="footer-book" id="footer-book{0}"></a><div class="footer-eval" id="footer-eval{0}"></div>';return b+'<div class="mat-balance">'};d.prototype.generateHTML=function(b){V15&&V15.config.externalCommonPath&&(d.TABLE_CELL_FMT='<span style="background-image: url( {1}Media/Buttons/{0}-16px.png );"></span>');for(b=0;6>b;b++);var c=String.formatEx(this.getTableStartFmt(),this.nInPage);for(b=0;6>b;b++)if(0<this.matBalance[b+1])for(var e=0;e<this.matBalance[b+1];e++)c+=
    String.formatEx(d.TABLE_CELL_FMT,this.getPiece(b+1),CB.getCommonPath());for(b=0;6>b;b++)if(0>this.matBalance[b+1])for(e=0;e<Math.abs(this.matBalance[b+1]);e++)c+=String.formatEx(d.TABLE_CELL_FMT,this.getPiece(b+9),CB.getCommonPath());return c+=d.TABLE_END_FMT};d.prototype.collapseHeader=function(){CB.$("#thefooter-"+this.nInPage).addClass("notafooter-container")};d.prototype.expandHeader=function(){CB.$("#thefooter-"+this.nInPage).addClass("notafooter-container")};d.prototype.initElem=function(b){this.collapseHeader();
    this.elementId=b;this.update()};d.prototype._setOptions=function(b){this.m_options=b;b.game&&this.setGame(b.game)};d.prototype.setOptions=function(b){this._setOptions(b)};d.prototype.m_game=null;d.prototype.setText=function(b){CB.$("#footer-eval"+this.nInPage).text(b)};d.prototype.setGame=function(b){this.m_game&&(this.m_game.removeOnMoveListener(this.m_inxOnMove),this.m_game.removeOnNavigateListener(this.m_inxOnNavigate),this.m_game.removeOnChangedListener(this.m_inxOnChanged));if(this.m_game=b)this.m_inxOnMove=
    this.m_game.addOnMoveListener(this.onMove.bind(this)),this.m_inxOnNavigate=this.m_game.addOnNavigateListener(this.OnNavigate.bind(this)),this.m_inxOnChanged=this.m_game.addOnChangedListener(this.OnChanged.bind(this))};d.prototype.getGame=function(){return this.m_game};d.prototype.onMove=function(){this.update()};d.prototype.OnChanged=function(){this.update()};d.prototype.OnNavigate=function(b){!this.liveBookListenerId&&V15.aTBLobby&&(this.liveBookListenerId=V15.aTBLobby.addOnLiveBookDisplayListener(this.liveBookListener.bind(this)));
    this.update()};d.prototype.update=function(){for(var b=[],c=0;16>c;c++)b[c]=0;if(null!==this.getGame()){var e=this.getGame().getCurPos();for(c=0;64>c;c++)b[e.board[c]]++}for(c=1;7>c;c++)this.matBalance[c]=b[c]-b[c+8];this.initSubElements()};d.prototype.scheduleUpdate=function(){this.gateUpdate.exec(function(){this.initSubElements()}.bind(this),200)};d.prototype.initSubElements=function(){var b=new StringBuilder;this.hasImbalance()&&CB.$(".footer-eval").text("");var c=this.InitFooter(!1);c.length&&
b.append(c);CB.$("#thefooter-"+this.nInPage).html(b.toString());b=(b=CB.$("#notaparent"+this.nInPage))&&b.single()&&360<b.single().clientHeight;this.hasImbalance()||b?CB.$("#thefooter-"+this.nInPage).show():CB.$("#thefooter-"+this.nInPage).hide()};d.prototype.hasImbalance=function(){for(var b=0;6>b;b++)if(0!=this.matBalance[b+1])return!0;return!1};d.prototype.focus=function(){};d.prototype.onElementDragOver=function(b){b.preventDefault()};d.prototype.onElementDragEnter=function(b){b.preventDefault()};
    d.prototype.resize=function(b,c){CB.DOM.resize(this.elementId,b,c)};d.prototype.liveBookListener=function(b){if(!CB.System.isElectron()&&b&&(!this.ticket||this.ticket==b.ticket)){for(var c=0,e=0;e<b.moves.length;e++)c+=b.moves[e].getNGames();c?CB.$("#footer-book"+this.nInPage).text(lm.LIVE_BOOK+": "+c+" "+lm.GAMES):CB.$("#footer-book"+this.nInPage).text("")}};return d}();
CB.NotaFooterElement.factory=function(d,b){b=new CB.NotaFooterElement(b);b.initElem(d,CB.cbNotationDefaults);return V15.panelMgr.NotaFooterElement=b};"use strict";
CB.BoardMessage=function(){var d=new CB.Color(0,0,0,.25),b=new CB.Color(255,255,250,.95),c=1,e=function(b,e,d){d=d||!1;this.uniqueId=c++;this.background=new CB.DivElement(document.body,"bMessageBG"+this.uniqueId);this.background.setZIndex(99999);this.textEl=new CB.DivElement(this.background,"bMessageText"+this.uniqueId);CB.$(this.background.elDOM).addClass("board-msg");d&&CB.$(this.background.elDOM).addClass("modal");b.messageWin=this;this.textEl.setText(e||"Empty Board Message");this.background.elDOM.addEventListener("mousedown",
    function(c){d||(b.destroyMessage(),c.preventDefault())});this.textEl.elDOM.addEventListener("mousemove",function(b){b.preventDefault()})};e.prototype.destroy=function(){this.background.destroy()};e.prototype.setText=function(b){this.textEl.setText(b)};e.prototype.setVisible=function(b){this.background.setVisible(b)};e.prototype.onResize=function(c){var e=c.cbcanvas.getBoundingClientRect(),f=new CB.Rect(e.left,e.top,e.left+e.width,e.top+e.height);c.cbcanvas.pixToZoomRect&&(f=c.cbcanvas.pixToZoomRect(c.getOuterRect()));
    var k=2;c.nSqPix&&(k=c.nSqPix);var l=Math.round(.7*f.w),m=Math.round(l/11),p=1;50<this.textEl.getText().length&&(m*=2.1,p=2);this.background.setPos((f.w-l)/2+f.left+e.left,(f.h-m)/2+f.top+e.top-m/2-(k-m)/2+window.pageYOffset);this.background.setSize(l,m);this.textEl.setPos(0,0);this.textEl.setSize(l,m);c.cbcanvas.pixToZoom&&this.textEl.setBorder(c.cbcanvas.pixToZoom(2),new CB.Color(0,0,0,.7));this.textEl.setBackgroundColor(d);this.textEl.setColor(b);400<l?this.textEl.setFontFamily("Roboto, Merriweather, Helvetica, sans-serif; font-stretch: expanded"):
        250>l&&this.textEl.setFontFamily("Roboto, Merriweather, Helvetica, sans-serif; font-stretch: condensed");c=Math.max(5,.9*m/p);do this.textEl.setFontSize(c),--c;while(5<c&&this.textEl.getTextWidth()>.95*l&&this.textEl.getTextHeight()>.95*m);this.textEl.setCenteredText()};return e}();
CB.BoardBubble=function(){var d=1,b=function(b,e,f,g,h){this.uniqueId=d++;this.square=e;if("undefined"==typeof this.square||null==this.square)this.square=-1;this.width=f||300;this.background=new CB.DivElement(document.body,"bBubbleBG"+this.uniqueId);$(this.background.elDOM).addClass("cbBoardBubble");this.setText(b,g);this.direction=h};b.TOP_RIGHT=0;b.BOTTOM_RIGHT=1;b.BOTTOM_LEFT=2;b.TOP_LEFT=3;b.prototype.destroy=function(){this.background.destroy()};b.prototype.setText=function(b,e){e?$(this.background.elDOM).html(String.f("{0}<img src='{1}' class='cbBoardBubbleIcon'>",
    b,e)):$(this.background.elDOM).text(b)};b.prototype.setVisible=function(b){this.background.setVisible(b)};b.prototype.onResize=function(c){var e=this.direction||this.calcBestDirection(c,this.square),d=c.cbcanvas.getBoundingClientRect();new CB.Rect(d.left,d.top,d.left+d.width,d.top+d.height);if(c.cbcanvas.pixToZoomRect&&c.cbcanvas.pixToZoom){var g=c.cbcanvas.pixToZoomRect(c.getOuterRect());var h=2;c.nSqPix&&(h=c.nSqPix);$(this.background.elDOM).css("max-width",this.width);var k=$(this.background.elDOM).outerWidth(),
    l=$(this.background.elDOM).outerHeight(),m=(g.w-k)/2+g.left+d.left;g=(g.h-l)/2+g.top+d.top-l/2-(2.5*h-l)/2+window.pageYOffset;if(-1!=this.square){g=c.cbcanvas.pixToZoomRect(c.getInnerRect());m=g.left+d.left;g=g.top+d.top+window.pageYOffset;d=this.square>>3;var p=7-(this.square&7);c.blackIsBottom&&(d=7-d,p=7-p);var r=c.cbcanvas.pixToZoom(8),t=c.cbcanvas.pixToZoom(40);switch(e){default:case b.TOP_RIGHT:m+=c.cbcanvas.pixToZoom((d+1)*h);m-=r;g+=c.cbcanvas.pixToZoom(p*h)-l;g-=t;break;case b.BOTTOM_RIGHT:m+=
    c.cbcanvas.pixToZoom((d+1)*h);m-=r;g+=c.cbcanvas.pixToZoom((p+1)*h);g+=t;break;case b.BOTTOM_LEFT:m+=c.cbcanvas.pixToZoom(d*h)-k;m+=r;g+=c.cbcanvas.pixToZoom((p+1)*h);g+=t;break;case b.TOP_LEFT:m+=c.cbcanvas.pixToZoom(d*h)-k,m+=r,g+=c.cbcanvas.pixToZoom(p*h)-l,g-=t}}else $(this.background.elDOM).removeClass("cbBoardBubbleTR cbBoardBubbleBR cbBoardBubbleTL cbBoardBubbleBL");if(m+k<window.innerWidth&&5<m&&-1!=this.square)switch(e){default:case b.TOP_RIGHT:$(this.background.elDOM).addClass("cbBoardBubbleTR");
    break;case b.TOP_LEFT:$(this.background.elDOM).addClass("cbBoardBubbleTL");break;case b.BOTTOM_RIGHT:$(this.background.elDOM).addClass("cbBoardBubbleBR");break;case b.BOTTOM_LEFT:$(this.background.elDOM).addClass("cbBoardBubbleBL")}else $(this.background.elDOM).removeClass("cbBoardBubbleTR cbBoardBubbleBR cbBoardBubbleTL cbBoardBubbleBL"),5>m&&(m=5),m+k>window.innerWidth&&(m=window.innerWidth-k);$(this.background.elDOM).css({position:"absolute",left:m+"px",top:g+"px"})}};b.prototype.calcBestDirection=
    function(c,e){var d=this.countCoveredPieces(c,e,b.TOP_RIGHT),g=this.countCoveredPieces(c,e,b.BOTTOM_RIGHT),h=this.countCoveredPieces(c,e,b.BOTTOM_LEFT);c=this.countCoveredPieces(c,e,b.TOP_LEFT);d=[d,g,h,c];g=-1;h=64;for(c=0;4>c;c++)d[c]<h&&(h=d[c],g=c);return g};b.prototype.countCoveredPieces=function(c,e,d){e=0;var f=this.square>>3,h=this.square&7;c.blackIsBottom&&(f=7-f,h=7-h);switch(d){default:case b.TOP_RIGHT:for(d=f+1;d<f+5&&8>d;d++)for(var k=h+1;k<h+3&&8>k;k++)0!=c.board.sqs[8*d+k]&&(e+=1,console.log(e));
    break;case b.BOTTOM_RIGHT:for(d=f+1;d<f+5&&8>d;d++)for(k=h-1;k>h-3&&0<k;k--)0!=c.board.sqs[8*d+k]&&e++;break;case b.BOTTOM_LEFT:for(d=f-1;d>f-5&&0<d;d--)for(k=h-1;k>h-3&&0<k;k--)0!=c.board.sqs[8*d+k]&&e++;break;case b.TOP_LEFT:for(d=f-1;d>f-5&&0<d;d--)for(k=h+1;k<h+3&&8>k;k++)0!=c.board.sqs[8*d+k]&&e++}return e};return b}();"use strict";
CB.DiagramAnimationController=function(){var d=function(b,c,e,d){this.pos=ObjUtil.clone(c);this.boardWin=e;this.diagDiv=d;this.parseAnimations(b);this.timer=new CB.Timer(this.timerHdl.bind(this));this.loopBeginInx=this.nAnim=0;this.timeScale=1;this.currBoard=ObjUtil.clone(this.pos.board);this.storeBoard=[];this.storeBoard[0]=ObjUtil.clone(this.pos.board);this.postedSuccess=!1};d.needsDiagramAnimButtons=function(b){var c=!1;b.forEach(function(b){if(b.match(/move:/i)||b.match(/beginloop/i))c=!0});return c};
    d.parseDiagramHelp=function(b){var c={text:"",icon:null,sq:-1,attrs:[]};b=b.split("/");for(var e=0;e<b.length;e++){var f=b[e].match(/text:(.+)/i);if(f)c.text=f[1];else{var g=b[e].match(/arrow:([a-h][1-8][a-h][1-8]),(\d+),(\w+)(,dash)?/i);if(g){f=CB.Square.fromString(g[1].substr(0,2));var p=CB.Square.fromString(g[1].substr(2,2)),r=null;g[4]&&(r=[4,8]);c.attrs.push(new CB.BoardArrow(f,p,CB.DiagramAnimationController.translateArrowColor(g[3]),parseInt(g[2]),r))}else if(g=b[e].match(/file:([a-h][1-8][a-h][1-8]),(\d+),(.+)/i))f=
        CB.Square.fromString(g[1].substr(0,2)),p=CB.Square.fromString(g[1].substr(2,2)),c.attrs.push(new CB.BoardLine(d.getFilePoints(f,p),parseInt(g[2]),CB.DiagramAnimationController.translateLineColor(g[3]),[2,10]));else if(g=b[e].match(/rank:([a-h][1-8][a-h][1-8]),(\d+),(.+)/i))f=CB.Square.fromString(g[1].substr(0,2)),p=CB.Square.fromString(g[1].substr(2,2)),c.attrs.push(new CB.BoardLine(d.getRankPoints(f,p),parseInt(g[2]),CB.DiagramAnimationController.translateLineColor(g[3]),[2,10]));else if(g=b[e].match(/diagonal:([a-h][1-8][a-h][1-8]),(\d+),(.+)/i))f=
        CB.Square.fromString(g[1].substr(0,2)),p=CB.Square.fromString(g[1].substr(2,2)),c.attrs.push(new CB.BoardLine(CB.DiagramAnimationController.getDiagonalPoints(f,p),parseInt(g[2]),CB.DiagramAnimationController.translateLineColor(g[3]),[2,15]));else if(f=b[e].match(/(mark|bigmark):(\[([a-h][1-8],?){2,}\]|[a-h][1-8]),(.{3,})/i))if(p=f[2],2<p.length){if(p=p.match(/([a-h][1-8])/g))for(g=0;g<p.length;g++)r=CB.Square.fromString(p[g]),c.attrs.push(new CB.BoardColouredSquare(r,CB.DiagramAnimationController.translateSquareColor(f[4],
        r),"bigmark"==f[1]))}else p=CB.Square.fromString(f[2]),c.attrs.push(new CB.BoardColouredSquare(p,CB.DiagramAnimationController.translateSquareColor(f[4],p),"bigmark"==f[1]));else if(r=b[e].match(/bubble:([a-h][1-8])/i))c.sq=CB.Square.fromString(r[1]);else if(f=b[e].match(/icon:(.+)/))c.icon=CB.getCommonPath()+"Media/Emojis/"+f[1]+".png";else if(f=b[e].match(/line:([a-h1-8tlbr-]+,(\d+),(.+))/))p=CB.BoardLinePoint.stringToPoints(f[1].split(",")[0]),c.attrs.push(new CB.BoardLine(p,f[2],CB.DiagramAnimationController.translateLineColor(f[3])))}}return c};
    d.parseChoiceFeedback=function(b){for(var c=[],e=0;e<b.length;e++){var f=b[e];switch(f.name){case "Mark":for(var g=0;g<f.squares.length;g++)c.push(new CB.BoardColouredSquare(f.squares[g].sq,d.translateSquareColor(f.color,f.squares[g].sq),3<f.thick));break;case "Arrow":c.push(new CB.BoardArrow(f.from.sq,f.to.sq,d.translateArrowColor(f.color),f.thick,f.dashed))}}return c};d.prototype.parseAnimations=function(b){this.animations=[];b.forEach(function(b){var c={},e="",d=b.indexOf(":");0<d?(c.command=b.substr(0,
        d),e=b.substr(d+1),c.command.indexOf("$")&&(b=c.command.split("$"),c.command=b[0],c.subCommand=b[1])):c.command=b;1<e.length&&(e=e.split("/"),1<e.length?(c.time=parseFloat(e[1].substr(0,e[1].length-1)),isNaN(c.time)&&(c.time=0),3<=e.length&&(c.icon=CB.getCommonPath()+"Media/Emojis/"+e[2]+".png")):c.time=0,this.isTextCommand(c.command)?c.params=[e[0]]:c.params=e[0].split(","));this.animations.push(c)}.bind(this))};d.prototype.setStartBoard=function(){this.boardWin.setBoard(this.pos.board);this.boardWin.redraw();
        this.currBoard=ObjUtil.clone(this.pos.board)};d.prototype.rewind=function(b){this.timer.stop();this.nAnim=0;this.setStartBoard();this.clearColors();this.boardWin.destroyMessage();this.boardWin.destroySideIcon();b&&this.drawInvariants();this.userMoved=!1};d.prototype.onUserMove=function(){this.userMoved=!0};d.prototype.play=function(){this.userMoved&&this.rewind();0==this.nAnim&&this.setStartBoard();this.timeScale=1;this.timer.runOnce(0);this.isSingleStep=!1;this.onPlay()};d.prototype.step=function(){this.userMoved&&
    this.rewind();0==this.nAnim&&this.setStartBoard();this.timeScale=1;this.isSingleStep=!0;this.timer.runOnce(0);this.onPlay()};d.prototype.stepBack=function(){this.userMoved&&this.rewind();this.timeScale=1;this.isSingleStep=!0;for(this.nAnim--;0<this.nAnim&&"move"!=this.animations[this.nAnim].command;)this.nAnim--;if(0>=this.nAnim)this.setStartBoard(),this.nAnim=0;else{var b=this.boardWin.animSteps;this.boardWin.animSteps={forMove:4,forPosition:4};this.boardWin.setBoard(this.storeBoard[this.nAnim],
        !0);this.boardWin.animSteps=b;this.currBoard=ObjUtil.clone(this.storeBoard[this.nAnim]);this.clearText();this.clearColors()}};d.prototype.fastForward=function(){this.timeScale*=2;this.timer.runOnce(0);this.isSingleStep=!1};d.prototype.pause=function(){this.timer.stop()};d.prototype.continue=function(){};d.prototype.restartLoop=function(){this.timer.stop();this.nAnim=this.loopBeginInx+1;this.setStartBoard();this.timer.runOnce(0)};d.prototype.onPlay=function(){};d.prototype.onSuccess=function(){this.postedSuccess||
    (this.boardWin.destroySideIcon(),this.boardWin.addSideIcon({url:CB.getCommonPath()+"Media/Ribbons/Reader/Check48.png",cssClass:"cbBoardCheckMark",boardFract:10}),this.dataset=this.diagDiv.dataset,this.id=this.dataset.posid||"noid",window.playchessUser&&V15.resultPostBack.postPlayed(window.playchessUser,this.id),this.postedSuccess||CB.SendEvent("Play",this.id),this.postedSuccess=!0)};d.prototype.drawInvariants=function(){for(var b=!1,c=0;c<this.animations.length;c++){var e=this.animations[c];if(0==
        e.time||9999==e.time){var f=2;9999==e.time&&(f=1);switch(e.command){case "title":this.setTitle(e.params[0]);break;case "legend":this.setLegend(e.params[0]);break;case "text":this.setText(e.params[0]);break;case "bubble":this.setBubble(e.subCommand,e.params,e.icon);break;case "mark":d.drawMarks(this.boardWin,e.params,!1,f);b=!0;break;case "bigmark":d.drawMarks(this.boardWin,e.params,!0,f);b=!0;break;case "line":d.drawLines(this.boardWin,e.params,f);b=!0;break;case "arrow":d.drawArrows(this.boardWin,
        e.params,f);b=!0;break;case "file":d.drawFile(this.boardWin,e.params,f);b=!0;break;case "rank":d.drawRank(this.boardWin,e.params,f);b=!0;break;case "diagonal":d.drawDiagonal(this.boardWin,e.params,f),b=!0}}else break}b&&this.boardWin.renderQueuedAttributes(!0)};d.prototype.setLegend=function(b){$(this.diagDiv).find(".diagText").text(b)};d.prototype.setText=function(b){this.boardWin.addBubble(b,"",320)};d.prototype.setBubble=function(b,c,e){var d=-1;b&&(d=CB.Square.fromString(b));this.boardWin.addBubble(c,
        d,320,e)};d.prototype.clearText=function(b){this.boardWin.destroyMessage()};d.prototype.setTitle=function(b){$(this.diagDiv).find(".diagTitle").text(b)};var b={red:"hsla( 0, 85%, 50%, 0.70 )",lightred:"hsla( 0, 100%, 70%, 0.70 )",green:"hsla( 90, 70%, 40%, 0.7 )",yellow:"hsla( 40, 90%, 60%, 0.75 )",blue:"hsla( 220, 60%, 50%, 0.65 )",orange:"hsla( 24, 90%, 50%, 0.65 )",gold:"hsla( 42, 97%, 53%, 0.65 )",brown:"hsla( 14, 32%, 38%, 0.65 )",white:"hsla( 0, 0%, 100%, 0.9 )",black:"hsla( 0, 0%, 0%, 0.9 )"},
        c={red:"hsla( 0, 80%, 50%, 0.7 )",lightred:"hsla( 0, 100%, 70%, 0.70 )",green:"hsla( 90, 75%, 45%, 0.7 )",yellow:"hsla( 40, 100%, 70%, 0.6 )",blue:"hsla( 220, 62%, 50%, 0.7 )",orange:"hsla( 24, 90%, 50%, 0.5 )",gold:"hsla( 42, 97%, 53%, 0.5 )",brown:"hsla( 14, 32%, 38%, 0.5 )",white:"hsla( 0, 0%, 100%, 0.9 )",black:"hsla( 0, 0%, 0%, 0.9 )"};d.drawMarks=function(c,e,f,l){var g=[];e.forEach(function(e){if(e.match(/[a-h][1-8]-[a-h][1-8]/i)){var h=0,k=0;e.charAt(3)>e.charAt(0)?h=1:e.charAt(3)<e.charAt(0)&&
        (h=-1);e.charAt(4)>e.charAt(1)?k=1:e.charAt(4)<e.charAt(1)&&(k=-1);for(var m=Math.max(Math.abs(e.charCodeAt(3)-e.charCodeAt(0)),Math.abs(e.charCodeAt(4)-e.charCodeAt(1))),q=CB.Square.colFromString(e.charAt(0)),u=CB.Square.rowFromString(e.charAt(1)),p=0;p<=m;p++)g.push(CB.Square.I(q+p*h,u+p*k))}else e.match(/[a-h][0-9]/i)?g.push(CB.Square.fromString(e)):(g.forEach(function(g){var h=d.translateSquareColor(e,g);h||(h=b.green);c.markSquare(g,h,f,l)}.bind(this)),g=[])}.bind(this))};d.translateSquareColor=
        function(e,d){return CB.Square.isDark(d)?c[e]:b[e]};d.prototype.clearColors=function(){this.boardWin.clearBaggageAttributes();this.boardWin.clearPermanentAttributes();this.boardWin.board.sqs=[];this.boardWin.setBoard(this.currBoard)};d.prototype.clearBoard=function(){this.boardWin.clearBaggageAttributes();this.boardWin.board.sqs=[];for(var b=0;64>b;b++)this.currBoard[b]=0;this.boardWin.setBoard(this.currBoard)};var e={red:"hsla( 0, 60%, 50%, 0.7 )",lightred:"hsla( 0, 100%, 70%, 0.70 )",green:"hsla( 90, 70%, 50%, 0.70 )",
        yellow:"hsla( 40, 90%, 65%, 0.80 )",blue:"hsla( 220, 70%, 50%, 0.7 )",orange:"hsla( 24, 90%, 50%, 0.7 )",gold:"hsla( 42, 97%, 53%, 0.7 )",brown:"hsla( 14, 32%, 38%, 0.7 )",white:"hsla( 0, 0%, 100%, 0.9 )",black:"hsla( 0, 0%, 0%, 0.9 )"};d.drawArrows=function(b,c,f){var g=[],h=[],k=0;c.forEach(function(c){if(c.match(/[a-h][1-8][a-h][1-8]/i))g.push(CB.Square.fromString(c.substr(0,2))),h.push(CB.Square.fromString(c.substr(2,2)));else if(c.charAt(0).match(/[0-9]/))k=parseInt(c);else{for(var l=0;l<g.length;l++){var m=
        c.split("+"),q=d.translateArrowColor(m[0]);q||(q=e.green);b.drawArrow(g[l],h[l],q,k,f,m[1]?[6,10]:null)}g=h=[];k=0}}.bind(this));for(c=0;c<g.length;c++)b.drawArrow(g[c],h[c],e.green,15,f)};d.translateArrowColor=function(b){return e[b]};var f={red:"hsla( 0, 80%, 50%, 0.75 )",lightred:"hsla( 0, 100%, 70%, 0.70 )",green:"hsla( 90, 75%, 50%, 0.65 )",yellow:"hsla( 40, 100%, 60%, 0.75 )",blue:"hsla( 220, 60%, 50%, 0.65 )",orange:"hsla( 24, 90%, 50%, 0.65 )",gold:"hsla( 42, 97%, 53%, 0.65 )",brown:"hsla( 14, 32%, 38%, 0.65 )",
        white:"hsla( 0, 0%, 100%, 0.9 )",black:"hsla( 0, 0%, 0%, 0.9 )"};d.translateLineColor=function(b){return e[b]};d.drawLines=function(b,c,e){var d=[],g=[],h=0;c.forEach(function(b){var c=b.match(/[a-h][1-8][t,b][l,r]/ig);if(c)for(b=0;b<c.length;b++){var e=CB.Square.fromString(c[b].substr(0,2));g.push(new CB.BoardLinePoint(e,c[b].substr(2,2)))}else if(b.charAt(0).match(/^[0-9]+$/))h=parseInt(b);else{c=b.split("+");(b=f[c[0]])||(b=f.green);e=[];switch(c[1]){default:case "dashed":c[1]&&(e=[6,12]);break;
        case "dotted":e=[3,10]}c=new CB.BoardLine(g,h,b,e);d.push(c);g=[];h=0}}.bind(this));b.addAttributes(d,e)};d.drawFile=function(b,c,e){var f=[],g=c[0];c=c[1]||"white";if(g){var h=CB.Square.fromString(g.substr(0,2));g=CB.Square.fromString(g.substr(2,2));f.push(new CB.BoardLine(d.getFilePoints(h,g),6,CB.DiagramAnimationController.translateLineColor(c)))}b.addAttributes(f,e)};d.drawRank=function(b,c,e){var f=[],g=c[0];c=c[1]||"white";if(g){var h=CB.Square.fromString(g.substr(0,2));g=CB.Square.fromString(g.substr(2,
        2));f.push(new CB.BoardLine(d.getRankPoints(h,g),6,CB.DiagramAnimationController.translateLineColor(c)))}b.addAttributes(f,e)};d.drawDiagonal=function(b,c,e){var d=[],f=c[0];c=c[1]||"white";if(f){var g=CB.Square.fromString(f.substr(0,2));f=CB.Square.fromString(f.substr(2,2));d.push(new CB.BoardLine(CB.DiagramAnimationController.getDiagonalPoints(g,f),10,CB.DiagramAnimationController.translateLineColor(c),[7,12]))}b.addAttributes(d,e)};d.getFilePoints=function(b,c){return[new CB.BoardLinePoint(b,"bl"),
        new CB.BoardLinePoint(c,"tl"),new CB.BoardLinePoint(c,"tr"),new CB.BoardLinePoint(b,"br"),new CB.BoardLinePoint(b,"bl")]};d.getRankPoints=function(b,c){return[new CB.BoardLinePoint(b,"bl"),new CB.BoardLinePoint(c,"br"),new CB.BoardLinePoint(c,"tr"),new CB.BoardLinePoint(b,"tl"),new CB.BoardLinePoint(b,"bl")]};d.getDiagonalPoints=function(b,c){var e=CB.Square.getFile(b),d=CB.Square.getRank(b),f=CB.Square.getFile(c),g=CB.Square.getRank(c);e<f?d<g?(e=["bl","lm","bm"],d=["tm","tr","rm"]):(e=["tl","tm",
        "lm"],d=["rm","br","bm"]):d<g?(e=["br","bm","rm"],d=["lm","tl","tm"]):(e=["tr","rm","tm"],d=["bm","bl","lm"]);return[new CB.BoardLinePoint(b,e[0]),new CB.BoardLinePoint(b,e[1]),new CB.BoardLinePoint(c,d[0]),new CB.BoardLinePoint(c,d[1]),new CB.BoardLinePoint(c,d[2]),new CB.BoardLinePoint(b,e[2]),new CB.BoardLinePoint(b,e[0])]};d.prototype.animMove=function(b,c){var d,f,g,h=!0;c.forEach(function(b){if(b.match(/[a-h][1-8][a-h\-][1-8\-]/i)){var c=b.substr(0,2);b=b.substr(2,2);d=CB.Square.fromString(c);
        "--"!=b?(f=CB.Square.fromString(b),this.currBoard[f]=this.currBoard[d]):h=!1;this.currBoard[d]=0}else if(b.match(/[wb][K,Q,N,B,R,P][a-h][1-8]/)){c="b"==b.charAt(0)?CB.Piece.COLOUR:0;var k=" KQNBRP".split("").indexOf(b.charAt(1));b=b.substr(2,2);f=CB.Square.fromString(b);this.currBoard[f]=k+c;h=!1}else g=e[b]}.bind(this));c=b.animSteps;b.animSteps={forMove:6,forPosition:2};b.setBoard(this.currBoard,!0);b.animSteps=c;g&&h&&b.drawArrow(d,f,g,10,!1)};d.prototype.shouldShowAnimButtons=function(){this.animations.forEach(function(b){if("move "==
        b.command)return!0})};d.prototype.timerHdl=function(){this.storeBoard[this.nAnim]=ObjUtil.clone(this.currBoard);var b=!1,c=this.animations[this.nAnim];switch(c.command){case "title":this.setTitle(c.params[0]);break;case "legend":this.setLegend(c.params[0]);break;case "text":this.setText(c.params[0]);break;case "bubble":this.setBubble(c.subCommand,c.params,c.icon);break;case "mark":d.drawMarks(this.boardWin,c.params,!1,!1);b=!0;break;case "bigmark":d.drawMarks(this.boardWin,c.params,!0,!1);b=!0;break;
        case "line":d.drawLines(this.boardWin,c.params,!1,!1);b=!0;break;case "clearcolor":this.clearColors();break;case "clearboard":this.clearBoard();break;case "cleartext":this.clearText();break;case "clearall":this.clearColors();this.clearText();break;case "arrow":d.drawArrows(this.boardWin,c.params,!1);b=!0;break;case "file":d.drawFile(this.boardWin,c.params,!1);b=!0;break;case "rank":d.drawRank(this.boardWin,c.params,!1);b=!0;break;case "diagonal":d.drawDiagonal(this.boardWin,c.params,!1);b=!0;break;
        case "move":this.animMove(this.boardWin,c.params);break;case "beginloop":this.loopBeginInx=this.nAnim;break;case "endloop":this.restartLoop();break;case "success":this.onSuccess()}b&&this.boardWin.renderQueuedAttributes(!0);if("endloop"==c.command||this.nAnim==this.animations.length-2)this.onSuccess();"endloop"!=c.command&&(this.nAnim++,this.nAnim>=this.animations.length?this.isSingleStep?this.anim--:this.nAnim=0:this.isSingleStep?this.skipInSingleStep(c.command)&&this.timer.runOnce(0):this.timer.runOnce(1E3*
        c.time/this.timeScale))};d.prototype.skipInSingleStep=function(b){return 0<="wait beginloop endloop legend cleartext clearcolor clearall arrow bigmark".split(" ").indexOf(b)};d.prototype.isTextCommand=function(b){return 0<=["legend","text","title","bubble"].indexOf(b)};return d}();"use strict";
CB.ChessAudioInstance=function(){var d=function(){this.enabled=!0};d.prototype._game=null;d.prototype.setGame=function(b){this._game&&this._game.removeOnMoveListener(this.idOnMove);(this._game=b)&&!V15.config.isSilentBoard&&(this.idOnMove=this._game.addOnMoveListener(this._onMove.bind(this)))};d.prototype.getGame=function(){return this._game};d.prototype.enable=function(b){this.enabled=b};d.prototype.sideToPlay={};d.prototype.sideToPlay[CB.Side.WHITE]=!0;d.prototype.sideToPlay[CB.Side.BLACK]=!0;d.prototype.enableSide=
    function(b,c){this.sideToPlay[b]=c};d.prototype._onMove=function(){var b=this._game.getCurPos(),c=this._game.getLastMove();if(c&&this.enabled&&V15&&V15.chessAudio)V15.chessAudio.onMove(c,b)};return d}();"use strict";
CB.ChessAudio=function(){var d=function(b,c){this.withTactics=c;this.folder=b;this.queue=new CB.AudioQueue;this.allAudios=[];this.loaded=!1;this.newGame=this.createAudio("Board/newgame");this.moveSounds=[];this.strongMoves=[];this.moveCaptures=[];this.strongCaptures=[];this.strongCaptures.push(this.createAudio("Board/CaptStrong"));this.castle=this.createAudio("Board/castle");this.winApplause=[];this.drawApplause=this.createAudio("Server/clapping");this.drawOfferEng=this.createAudio("Server/draw");
    this.drawOfferDeu=this.createAudio("Server/remis");this.ping=this.createAudio("Server/ping2");this.ringbell=this.createAudio("Server/ringbellonce");this.challengebell=this.createAudio("Server/ChallengeBell");this.playFaster=this.createAudio("Server/Feedback/faster");this.punches=[];this.grunts=[];this.myError=[];this.oppError=[];this.cheer=[];this.punishCap=[];this.punishNoCap=[];this.bestCap=[];this.bestNoCap=[];this.only=[];this.wellDone=[];this.alarm=this.createAudio("Server/Aooga")};d.prototype.stopAll=
    function(){this.queue.stopAll()};d.prototype.isEnabled=function(){return this.queue.isEnabled()};d.prototype.enable=function(b){return this.queue.enable(b)};d.prototype.loadAll=function(){new CB.Tick;this.individualApplause=this.createAudio("Server/IndividualApplause");for(var b=1;11>=b;b++)this.moveSounds.push(this.createAudio("Board/move"+b));for(b=1;15>=b;b++)this.moveCaptures.push(this.createAudio("Board/capture"+b));for(b=1;5>=b;b++)this.winApplause.push(this.createAudio("Server/winapplause"+
    b));this.winApplause.push(this.createAudio("Server/cheer1"));this.winApplause.push(this.createAudio("Server/cheer2"));this.winApplause.push(this.createAudio("Server/cheer3"));this.winApplause.push(this.createAudio("Server/cheer5"));if(this.withTactics){for(b=1;16>=b;b++)this.punches.push(this.createAudio("Server/punch"+b));for(b=1;8>=b;b++)this.grunts.push(this.createAudio("Server/grunt"+b));for(b=1;9>=b;b++)this.myError.push(this.createAudio("Server/MyError"+b));for(b=1;5>=b;b++)this.cheer.push(this.createAudio("Server/Cheer"+
    b))}if(V15.config.useAnalysisEngines||this.withTactics)for(b=1;5>=b;b++)this.oppError.push(this.createAudio("Server/OppError"+b));if(V15.config.useAnalysisEngines){var c=["Plop","CluckCluck","FistInHand","Snap"],e=["Marseillaise","Yes","SoftClapClap"],d=["Cluck","DoubleSnap","Drawlips"],g=["CuckooWhistle","Moan","Moan2"],h=["Exhale","sharpinhale","sssinhale"],k=["WellDone"];for(b=0;b<c.length;b++)this.punishCap.push(this.createAudio("Server/Feedback/"+c[b]));for(b=0;b<e.length;b++)this.punishNoCap.push(this.createAudio("Server/Feedback/"+
    e[b]));for(b=0;b<d.length;b++)this.bestCap.push(this.createAudio("Server/Feedback/"+d[b]));for(b=0;b<g.length;b++)this.bestNoCap.push(this.createAudio("Server/Feedback/"+g[b]));for(b=0;b<h.length;b++)this.only.push(this.createAudio("Server/Feedback/"+h[b]));for(b=0;b<k.length;b++)this.wellDone.push(this.createAudio("Server/Feedback/"+k[b]));for(b=1;2>=b;b++)this.strongMoves.push(this.createAudio("Board/moveStrong"+b))}(new CB.Timer(function(){new CB.Tick;this.allAudios.forEach(function(b){b.load()});
    this.allAudios=[];this.loaded=!0}.bind(this))).runOnce(1E3)};d.prototype.onMove=function(b,c){this.queue.stopAll();b.isTake()?b.isStrong?this.playStrongCapture():this.playCapture():b.isCastling()?this.playCastle():b.isStrong?this.playStrongMove():this.playMove()};d.prototype.playMove=function(){this.queue.push(this.moveSounds[Math.floor(Math.random()*this.moveSounds.length)])};d.prototype.playStrongMove=function(){this.queue.push(this.strongMoves[Math.floor(Math.random()*this.strongMoves.length)])};
    d.prototype.playCapture=function(){this.queue.push(this.moveCaptures[Math.floor(15*Math.random())])};d.prototype.playStrongCapture=function(){this.queue.push(this.strongCaptures[Math.floor(Math.random()*this.strongCaptures.length)])};d.prototype.playCastle=function(){this.queue.push(this.castle)};d.prototype.onWin=function(){this.queue.push(this.winApplause[Math.floor(9*Math.random())])};d.prototype.onDraw=function(){this.queue.push(this.drawApplause)};d.prototype.onPing=function(){this.queue.push(this.ping)};
    d.prototype.onIndividualApplause=function(){this.individualApplause&&this.queue.push(this.individualApplause)};d.prototype.onFightChallengeReceived=function(){this.queue.push(this.challengebell)};d.prototype.onFightStart=function(){this.queue.push(this.ringbell)};d.prototype.onFightMyCorrect=function(){this.queue.push(this.punches[Math.floor(14*Math.random())])};d.prototype.onFightOppCorrect=function(){this.queue.push(this.grunts[Math.floor(Math.random()*this.grunts.length)])};d.prototype.onFightMyWrong=
        function(){this.queue.push(this.myError[Math.floor(Math.random()*this.myError.length)])};d.prototype.onFightOppWrong=function(){this.queue.push(this.oppError[Math.floor(Math.random()*this.oppError.length)])};d.prototype.onFightCheer=function(){this.queue.push(this.cheer[Math.floor(Math.random()*this.cheer.length)])};d.prototype.warnPlayFaster=function(){this.queue.push(this.playFaster)};d.prototype.onPunishedBlunderCapture=function(){this.queue.push(this.punishCap[Math.floor(Math.random()*this.punishCap.length)])};
    d.prototype.onPunishedBlunderNoCapture=function(){this.queue.push(this.punishNoCap[Math.floor(Math.random()*this.punishNoCap.length)])};d.prototype.onBestMoveCapture=function(){this.queue.push(this.bestCap[Math.floor(Math.random()*this.bestCap.length)])};d.prototype.onBestMoveNoCapture=function(){this.queue.push(this.bestNoCap[Math.floor(Math.random()*this.bestNoCap.length)])};d.prototype.onOnlyMove=function(){this.queue.push(this.only[Math.floor(Math.random()*this.only.length)])};d.prototype.onWellDone=
        function(){this.queue.push(this.wellDone[Math.floor(Math.random()*this.wellDone.length)])};d.prototype.opponentOffersDraw=function(){CB.Language.getUserLanguageId()==CB.Language.DEU?this.queue.push(this.drawOfferDeu):this.queue.push(this.drawOfferEng)};d.prototype.onNewGame=function(){this.queue.push(this.newGame)};d.prototype.onDisconnect=function(){this.queue.push(this.alarm)};d.prototype.onThreat=function(){this.queue.push(this.alarm)};d.prototype.onIncomingChallenge=function(){this.queue.push(this.challengebell)};
    d.prototype.createAudio=function(b){b=new CB.Audio(this.folder+b,null,!0);this.allAudios.push(b);return b};return d}();"use strict";
CB.BoardBottomWin=function(){var d=function(b){this.config=b||{};this.config.hMinToShow=150;this.height=20};d.prototype.getDesiredHeight=function(b,c){return this.calcHeight(b,c)};d.prototype.calcHeight=function(b,c){c=c.zoomToPix(this.config.hMax);return Math.min(c,b/this.config.hScale)};d.prototype.confirmHeight=function(b,c){this.height=c.pixToZoom(b)};d.prototype.canShowIfHeight=function(b,c){return b>c.pixToZoom(this.config.hMinToShow)};d.prototype.getSpacingToBoard=function(b,c){return c?c.zoomToPix(this.config.spacing):
    0};d.prototype.getRect=function(b){var c=b.cbcanvas.canvas.getBoundingClientRect(),e=b.cbcanvas.pixToZoomRect(b.getOuterRect());e.h=this.height;var d=b.cbcanvas.pixToZoom(b.getOuterRect().h);e.move(c.left,c.top+d+b.cbcanvas.pixToZoom(this.config.spacing)-1);return e};return d}();
CB.BoardURL=function(){var d=1,b=function(c,e){b.superClass.call(this,e);this.uniqueId=d++;this.background=new CB.DivElement(document.body,"bBottomBG"+this.uniqueId);this.url=new CB.DivElement(this.background,"bBottomURL"+this.uniqueId);this.url.setURL(c.url,c.linkText,"BoardBottomURL",!0)};CB.inherit(b,CB.BoardBottomWin);b.prototype.onResize=function(b){var c=this.getRect(b),d=c.w;this.config.rightAlign&&(d-=b.nMarginW);this.background.setPos(c.left,c.top);this.background.setSize(d,c.h);this.url.setPos(0,
    0);this.url.setSize(d,c.h);this.url.elDOM.className="BoardBottomURL";this.url.setFontSize(c.h);this.url.setFontSize(Math.max(3,c.h));this.config.rightAlign?this.url.setRightAlign():this.url.setCenteredText();V15.config.versionChessBaseCom&&(this.url.linkNode.style.color="Black")};b.prototype.destroy=function(){this.background.destroy()};b.prototype.setVisible=function(b){this.background.setVisible(b)};return b}();
CB.BoardDoubleURL=function(){var d=1,b=function(c,e){b.superClass.call(this,e);this.uniqueId=d++;this.background=new CB.DivElement(document.body,"bBottomURLBG"+this.uniqueId);this.urlLeft=new CB.DivElement(this.background,"bBottomURLLeft"+this.uniqueId);this.urlLeft.setURL(c.urlLeft,c.linkTextLeft,"BoardBottomURL",!0);this.urlRight=new CB.DivElement(this.background,"bBottomURLRight"+this.uniqueId);this.urlRight.setURL(c.urlRight,c.linkTextRight,"BoardBottomURL",!0)};CB.inherit(b,CB.BoardBottomWin);
    b.prototype.onResize=function(b){var c=this.getRect(b);b=b.cbcanvas.pixToZoom(b.nMarginW);var d=c.w;d-=2*b;this.background.setPos(c.left,c.top);this.background.setSize(d,c.h);d/=2;this.urlLeft.setPos(b,0);this.urlLeft.setSize(d,c.h);this.urlLeft.elDOM.className="BoardBottomURL";this.urlLeft.setFontSize(Math.max(4,c.h));this.urlLeft.setLeftAlign();this.urlRight.setPos(d+b,0);this.urlRight.setSize(d,c.h);this.urlRight.elDOM.className="BoardBottomURL";this.urlRight.setFontSize(Math.max(4,c.h));this.urlRight.setRightAlign();
        if(V15.config.versionChessBaseCom||V15.config.transparent)this.urlLeft.linkNode.style.color="Black",this.urlRight.linkNode.style.color="Black"};b.prototype.destroy=function(){this.background.destroy()};b.prototype.setVisible=function(b){this.background.setVisible(b)};return b}();"use strict";
CB.BoardSideIcon=function(){var d=0,b=function(b,e){this.config=e;this.myId=++d;b=$(b.cbcanvas.canvas);this.img=$(String.f("<img src='{0}' class='{1}' id='cbBoardIcon{2}'/>",e.url,e.cssClass,this.myId));$(b).parent().append(this.img);$(this.img).css("position","absolute");this.width=this.height=32};b.prototype.destroy=function(){$("#cbBoardIcon"+this.myId).remove()};b.prototype.setVisible=function(b){b?$(this.img).show():$(this.img).hide()};b.prototype.getDesiredWidth=function(b,e,d){return this.width=
    this.height=this.calcWidth(b,d)};b.prototype.calcWidth=function(b,e){e=e.zoomToPix(48);return Math.min(e,b/this.config.boardFract)};b.prototype.onResize=function(b){var c=$(b.cbcanvas.canvas).offset().top,d=$(b.cbcanvas.canvas).offset().left,g=b.cbcanvas.pixToZoomRect(b.getOuterRect());g.move(d,c);$(this.img).css("transition","0");$(this.img).css({left:g.left,top:g.top+g.h/2,width:this.width,height:this.width});$(this.img).css("transition","left 0.8s, top 0.8s, width 0.5s, height 0.5s");(new CB.Timer(function(){$(this.img).css({left:g.left+
        g.w-this.width/4,top:g.top+this.height/10})}.bind(this))).runOnce(0)};return b}();"use strict";
CB.BoardTitle=function(){var d=new CB.Color(0,0,0,.3),b=new CB.Color(210,255,170,.75),c=new CB.Color(255,255,220,.9),e=1,f=function(b,f,k,l,m,p){this.board=b;this.uniqueId=e++;this.background=new CB.DivElement(b.cbcanvas.canvas.parentNode,"bTitleBG"+this.uniqueId);m||(this.clock=new CB.ClockElement(this.background));this.textEl=new CB.DivElement(this.background,"bTitleText"+this.uniqueId);CB.ToolButtons&&!V15.isBoardOnlyApp()&&(this.btnEl=new CB.CloseButton(this.background,"bCloseBtn"+this.uniqueId,
    this.onCloseClicked.bind(this)));b.titleWin=this;this.onBoardCloseClick=f;this.textEl.setText(l||"Waiting for game...");$(this.textEl.elDOM).on("click",k);$(this.textEl.elDOM).on("dblclick",p);this.clock&&($(this.clock.background.elDOM).on("click",k),$(this.clock.background.elDOM).on("dblclick",p));this.textEl.setBackgroundColor(d);this.textEl.setColor(c);this.textEl.setFontFamily(V15.config.defaultCondensedFont);$(this.textEl).css("cursor","pointer");this.h=Math.round(b.cbcanvas.pixToZoom(this.calcHeight(b.height)))};
    f.prototype.destroy=function(){this.background.destroy()};f.prototype.displaysHeader=!0;f.prototype.setText=function(b){this.textEl.setText(b);if(this.textW){b=this.getInitialFontH();do{this.textEl.setFontSize(b);--b;var c=this.textEl.getTextWidth();this.textEl.getTextHeight();CB.LOG("TitleW:"+c)}while(4<b&&(this.textEl.getTextWidth()>this.textW-4||this.textEl.getTextHeight()>this.h-2))}};f.prototype.setVisible=function(b){this.background.setVisible(b)};f.prototype._selected=!1;f.prototype.markAsSelected=
        function(e){this._selected!=e&&((this._selected=e)?(this.textEl.setBackgroundColor(b),this.textEl.setColor("black")):(this.textEl.setBackgroundColor(d),this.textEl.setColor(c)))};f.prototype.getClock=function(){return this.clock};f.prototype.getInitialFontH=function(){if(this.board){var b=Math.round(this.board.cbcanvas.pixToZoom(this.calcHeight(this.board.height)));b=Math.round(.65*b);8>b&&(b=8);return b}return 16};f.prototype.getDesiredHeight=function(b,c){return this.calcHeight(b)};f.prototype.calcHeight=
        function(b){var c=this.board?this.board.cbcanvas.zoomToPix(36):36;return Math.min(c,b/16)};f.prototype.onResize=function(b){this.board=b;b.cbcanvas.canvas.getBoundingClientRect();var c=b.cbcanvas.pixToZoomRect(b.getOuterRect()),e=Math.round(b.cbcanvas.pixToZoom(this.calcHeight(b.height))),d=e+1,f=this.getInitialFontH();this.h=e;c.move(-1,-this.h);c.h=this.h;this.btnW=this.btnEl?d:0;CB.System.isMobile()&&this.btnEl&&this.btnW<CB.System.pixToZoom(26)&&(this.btnW=CB.System.pixToZoom(26));this.clockW=
        this.clock?Math.min(260,.4*c.w):0;c.w--;this.textW=c.w-this.clockW-this.btnW;this.background.setPos(c.left,c.top);this.background.setSize(c.w,c.h);e=Math.max(1,Math.min(4,Math.round(Math.sqrt(c.w/100))));this.background.setBoxShadow(e,8*e,"rgba( 60, 30, 20, 0.5 )");this.clock&&this.clock.setPosSize(0,0,this.clockW,this.h);this.textEl.setPos(this.clockW,0);this.textEl.setSize(this.textW,this.h);this.textEl.setBorder(b.cbcanvas.pixToZoom(1),new CB.Color(0,0,0,1));this.markAsSelected(this._selected);
        this.textEl.setCenteredText();do this.textEl.setFontSize(f),--f,this.textEl.getTextWidth(),this.textEl.getTextHeight();while(4<f&&(this.textEl.getTextWidth()>this.textW||this.textEl.getTextHeight()>this.h-2));this.textEl.setVerticalAlign(!0);this.btnEl&&(this.btnEl.setPos(c.w-this.btnW,this.h-this.btnW),this.btnEl.setSize(this.btnW,this.btnW))};f.prototype.onCloseClicked=function(b){if(void 0!==this.onBoardCloseClick)this.onBoardCloseClick(b)};return f}();"use strict";
CB.MultiBoard=function(){var d=function(b,c,e,d){this.cbcanvas=b;this.boardArea=new CB.BoardArea(b,c,e,d);this.width=c;this.height=e;this.idStyleListener=glSettings.addOnBoardStyleListener(this.onBoardStyle.bind(this));this.keyDownHandlerId=V15.commands.registerkeyDownHandler(this)};d.prototype.destroy=function(){glSettings.removeOnBoardStyleListener(this.idStyleListener);V15.commands.unregisterkeyDownHandler(this.keyDownHandlerId)};d.prototype.onKeyDown=function(b){var c=!0;switch(b.getKey()){default:c=
    !1;break;case b.TAB:this.selectNextBoard()}return c};d.prototype.onBoardStyle=function(b,c){V15.setBoardTextures(CB.BoardTextures.prototype.getTexturesForPieceStyle(b));for(var e=0;e<this.boardArea.boards.length;e++)this.boardArea.boards[e].onBoardStyle(b,c);this.boardArea.calcGeometry()};d.prototype.addBoard=function(b,c,e){0==this.boardArea.boards.length&&this.boardArea.clearBackground();e||b.addTitle(function(){return this.onBoardCloseClick(b,c)}.bind(this),!1,function(b){return this.onDoubleClick(b)}.bind(this));
    V15.isBoardOnlyApp()&&V15.useBottomURL&&V15.GetBottomURLData&&100<window.innerHeight&&(b.bottomWin=new CB.BoardDoubleURL(V15.GetBottomURLData(),{hScale:25,hMax:16,spacing:3,rightAlign:!0}));b.fnBoardClick=this.onBoardClick.bind(this);e=!1;if(null!=c){b.idGame=c;for(var d=0;!e&&d<this.boardArea.boards.length;d++)e=this.boardArea.boards[d].idGame==c}e||this.boardArea.addBoard(b)};d.prototype.removeBoard=function(b){b&&(this.cbcanvas.block(!0),this.boardArea.removeBoard(b),this.boardArea.calcGeometry(),
    this.markSelectedBoard())};d.prototype.onDestroyDOM=function(){this.removeAllBoards()};d.prototype.removeAllBoards=function(){this.boardArea.removeAllBoards();this.cbcanvas.requestRedraw();this.drawBackground(this.cbcanvas.bufferCtx)};d.prototype.setNotation=function(b){this.notation=b};d.prototype.beforeResize=function(){this.boardArea.beforeResize()};d.prototype.resize=function(b,c){this.width=b;this.height=c;this.boardArea.resize(b,c);this.markSelectedBoard()};d.prototype.markSelectedBoard=function(){if(this.idSelected){var b=
    this.getBoardById(this.idSelected);b&&b.markAsSelected(!0)}};d.prototype.draw=function(b){this.boardArea.draw(b)};d.prototype.drawForeground=function(b){this.boardArea.drawForeground(b)};d.prototype.drawBackground=function(b){this.boardArea.drawBackground(b)};d.prototype.clearBackground=function(){};d.prototype.refreshBoards=function(){this.boardArea.calcGeometry();this.markSelectedBoard()};d.prototype.calcGeometry=function(){this.boardArea.calcGeometry()};d.prototype.onMouseDown=function(b,c){if(!V15.lobby.boardAreaClickHandler||
    0!=b.button&&"undefined"!=typeof b.button)this.boardArea.onMouseDown(b,c);else V15.lobby.boardAreaClickHandler(b)};d.prototype.onMouseUp=function(b,c){this.boardArea.onMouseUp(b,c)};d.prototype.onMouseMove=function(b,c){this.boardArea.onMouseMove(b,c)};d.prototype.onMouseWheel=function(b,c){};d.prototype.onMouseEnter=function(b,c){this.boardArea.onMouseEnter(b,c)};d.prototype.onMouseLeave=function(b,c){this.boardArea.onMouseLeave(b,c)};d.prototype.onDoubleClick=function(b){if(this.onDblClick){var c=
    this.getBoardById(this.idSelected);this.onDblClick(c.idGame,b)}V15.lobby.boardAreaDClickHandler&&0==b.button&&V15.lobby.boardAreaDClickHandler(b)};d.prototype.toggleAnnoField=function(){};d.prototype.openAnnoField=function(){};d.prototype.isAnnoFieldOpen=function(){};d.prototype.closeAnnoField=function(){};d.prototype.setAnnoFieldText=function(b){};d.prototype.outEngineMsg=function(b,c){};d.prototype.onBoardCloseClick=function(b,c){this.removeBoard(b);if(void 0!==this.onCloseBoard)this.onCloseBoard(c)};
    d.prototype.onBoardClick=function(b,c,e){if(b!=this.clickedBoardId){e=this.getBoardById(b);this.mark(e);if(void 0!==this.onClickBoard)this.onClickBoard(e.idGame,c);this.clickedBoardId=b}};d.prototype.markBoard=function(b){b<this.boardArea.boards.length&&this.mark(this.boardArea.boards[b])};d.prototype.mark=function(b){var c=this.getBoardById(this.idSelected);c&&c!==b&&c.markAsSelected(!1);b?(b.markAsSelected(!0),this.idSelected=b.uniqueId):this.idSelected=-1};d.prototype.markBoardByGameId=function(b){b=
        this.getBoardByGameId(b);this.mark(b)};d.prototype.selectNextBoard=function(){var b=this.idSelected,c=this.boardArea.boards.findIndex(function(c){return c.uniqueId==b});0<=c&&(c+=1,c>=this.boardArea.boards.length&&(c=0));this.markBoard(c);if(this.onClickBoard&&this.boardArea.boards[c])this.onClickBoard(this.boardArea.boards[c].idGame)};d.prototype.getBoardByGameId=function(b){return this.boardArea.boards.find(function(c){return c.idGame==b})};d.prototype.getBoardById=function(b){if(b)return this.boardArea.boards.find(function(c){return c.uniqueId==
        b})};return d}();"use strict";
CB.ChatElement=function(){var d=function(b,c){this.nInPage=b;this.fnOnEnter=c;this.myTabInx=1;this.nClubRoomPlayers=this.nReceivers=0};d.prototype.initElem=function(b,c){this.options=c;this.elementId=b="string"==typeof b?b:$(b).attr("id");b=$("#"+b);b.addClass("cbChatContainer");b[0].style.position="relative";this.elem=b[0];c=document.createElement("div");c.id=this.elementId+"-out";var e=document.createElement("input");e.id=this.elementId+"-in";e.placeholder="Please log in with your ChessBase Account to type chat here.";this.createTitle();
    b.append(c);b.append(e);c=$(c);e=$(e);c[0].style.width="calc( 100% - 2px )";c[0].style.height="100%";c.addClass("cbChatOut");e.addClass("cbChatInp");c[0].style.width="calc( 100% - 8px) ";if(this.options.toolbar){var d=$(String.f('<div class="{0}" id="{1}-tb"></div>',"cbChatToolBar",this.elementId));b.append(d);this._initToolBar(d)}e.keypress(this.inputKeypress.bind(this));e.focus(this.onFocus.bind(this));e.blur(this.onBlur.bind(this));if(this.elem&&(c.on("mousewheel",this.onMouseWheel.bind(this)).on("DOMMouseScroll",
        this.onMouseWheel.bind(this)),CB.Element.isEventSupported("touchstart")&&(c.on("touchstart",this.onButtonDown.bind(this)).on("touchend",this.onButtonUp.bind(this)).on("touchleave touchcancel",this.onMouseLeave.bind(this)),this.supportsTouch=!0),CB.Element.isEventSupported("mousedown")))c.on("mousedown",this.onButtonDown.bind(this)).on("mouseup",this.onButtonUp.bind(this)).on("mouseleave",this.onMouseLeave.bind(this)).on("dblclick",this.onDoubleClick.bind(this));b.resize(this.resize.bind(this));var g;
    this.options&&this.options.noInvite||(g=this.isOnLiveChess()?this.getInviteLoginText():"Click <a href=https://live.chessbase.com/Logon?returnurl="+encodeURIComponent(document.location)+' target="_blank">here to login</a> with your free ChessBase Account and type chat below.');this._addLine(g,"cbChatLine cbChatSeparator");this.addListeners()};d.prototype.addListeners=function(){V15.lobby&&(V15.lobby.addOnPlayersAddedListener(this.onPlayersAdded.bind(this)),V15.lobby.addOnPlayersRemovedListener(this.onPlayersRemoved.bind(this)))};
    d.prototype.onPlayersAdded=function(b){V15.lobby&&V15.lobby.isInSpecialRoom()&&this.setNClubRoomPlayers(this.nClubRoomPlayers+b.length)};d.prototype.onPlayersRemoved=function(b){V15.lobby&&V15.lobby.isInSpecialRoom()&&this.setNClubRoomPlayers(Math.max(0,this.nClubRoomPlayers-b.length))};d.prototype.setNChannelReceivers=function(b){V15.lobby.isInSpecialRoom()||(this.nChannelReceivers=this.nReceivers=b,this.setInputPlaceHolder())};d.prototype.setNClubRoomPlayers=function(b){this.nClubRoomPlayers=this.nReceivers=
        b;this.setInputPlaceHolder()};d.prototype.setNKibitzChatReceivers=function(b){this.nKibitzReceivers=this.nReceivers=b;this.setInputPlaceHolder()};d.prototype.createTitle=function(){var b=$(String.f('<div id="{0}-title" class="cbChatTitle">Chat And Info</div>',this.elementId));$(this.elem).append(b)};d.prototype.setTitle=function(b){$("#"+this.elementId+"-title").text(b)};d.prototype.setFnSendChat=function(b){this.fnOnEnter=b};d.prototype.getInviteLoginText=function(){return'<a href="https://live.chessbase.com/logon?returnurl='+
        encodeURIComponent(document.location)+'">Log in</a> with your free ChessBase Account and type chat below.'};d.prototype.isOnLiveChess=function(){return-1!=document.URL.search(/live.chessbase.com/i)||-1!=document.URL.search(/live.playchess.com/i)};d.prototype.$Out=function(){return $("#"+this.elementId+"-out")};d.prototype.$In=function(){return $("#"+this.elementId+"-in")};d.prototype.toGeneralChat=function(){this.setTitle(String.f("{0} ({1})",lm.CHAT,lm.TO_ALL));this.options.toolbar&&$("#radBtnall"+
        this.nInPage).length&&($("#radBtnall"+this.nInPage).jqxRadioButton("check"),$("#radBtnopp"+this.nInPage).jqxRadioButton("uncheck"),$("#radBtnSpanopp"+this.nInPage).text(lm.TO_OPPONENT),$("#radBtnSpanopp"+this.nInPage).jqxRadioButton("disable"))};d.prototype.toKibitzerChat=function(){this.setTitle(lm.TO_KIBITZERS);this.options.toolbar&&$("#radBtnall"+this.nInPage).length&&(this.toKibitzers=!0,this.toOpponent=this.toPlayer=!1,$("#radBtnopp"+this.nInPage).jqxRadioButton("check"),$("#radBtnSpanopp"+this.nInPage).text(lm.TO_KIBITZERS),
        $("#radBtnall"+this.nInPage).jqxRadioButton("uncheck"))};d.prototype.toOpponentChat=function(b){this.toPlayer=this.toKibitzers=!1;this.toOpponent=!0;this.signalIndividualChat(b);this.fnOnEnter=this.options.sendOpponent};d.prototype.signalIndividualChat=function(b){this.setTitle("Chat with "+b);this.options.toolbar&&$("#radBtnall"+this.nInPage).length&&($("#radBtnopp"+this.nInPage).jqxRadioButton("check"),$("#radBtnall"+this.nInPage).jqxRadioButton("uncheck"),$("#radBtnSpanopp"+this.nInPage).text("-> "+
        b),this.receiverName=b)};d.prototype.setReceiverId=function(b,c){if(c=c||V15.lobby.lists.clientNameMap[b])this.toKibitzers=!1,this.toPlayer=!0,this.toOpponent=!1,this.signalIndividualChat(c),this.fnOnEnter=this.options.sendPlayer,this.idReceiver=b};d.prototype.sendTokenChat=function(b,c){this.toPlayer&&this.idReceiver?(this.outMyGameChat(c),V15.lobby.sendChat(c,this.idReceiver,b)):this.toOpponent&&(this.outMyGameChat(c),V15.lobby.playingSession.sendTokenChat(b,c))};d.prototype._fnReceiverClick=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    c){this.fnOnEnter=null;if(c)switch(b){case "opp":case "one":this.toKibitzers?(this.nReceivers=this.nKibitzReceivers,this.fnOnEnter=this.options.sendKibitzers):(this.nReceivers=1,this.toPlayer?this.fnOnEnter=this.options.sendPlayer:this.receiverName&&(this.fnOnEnter=this.options.sendOpponent));this.fnOnEnter?this.setInputPlaceHolder():this.setInputPlaceHolderMsg(lm.PLEASE_SELECT_RECEIVER);break;case "all":this.setTitle(lm.TO_ALL),V15.lobby.isInClubRoom()?this.nReceivers=this.nClubRoomPlayers:this.nReceivers=
        this.nChannelReceivers,this.setInputPlaceHolder(),this.fnOnEnter=this.options.sendGeneral}return null!=this.fnOnEnter};d.prototype.resize=function(){var b=0;this.options.toolbar&&(b=32);var c=$("#"+this.elementId),e=$("#"+this.elementId+"-title"),d=$("#"+this.elementId+"-in"),g=$("#"+this.elementId+"-out"),h=g.width();d[0].style.width=h-8+"px";d.height(20);c=c.height();d=d.outerHeight(!0);e=e.outerHeight(!0);e=c-e-d-b;0>e&&(e=10);g[0].style.height=e+"px";g[0].style.width="100%";g=$("#"+this.elementId+
        "-tb");g.length&&(g[0].style.height=b+"px")};d.prototype.hasFocus=function(){return $("#"+this.elementId+"-in").is(":focus")};d.prototype.onFocus=function(b){this._hasFocus=!0};d.prototype.onBlur=function(b){this._hasFocus=!1};d.prototype.inputKeypress=function(b){13==b.keyCode&&(b=this.$In().val())&&(this.fnOnEnter&&this.fnOnEnter(this.nInPage,b),this.$In().val(""))};d.prototype.onButtonDown=function(b){this.buttonDown=!0};d.prototype.onButtonUp=function(b){this.buttonDown=!1};d.prototype.onDoubleClick=
        function(b){};d.prototype.onMouseWheel=function(b){};d.prototype.onMouseLeave=function(b){this.buttonDown=!1};d.prototype.out=function(b,c,e){"string"===typeof b?this.add(b,c,e):b.isToChannel()||b.isToGroup()?this.addChannelMsg(b):b.isOpponentChat?this.addIndividualMsg(b):b.isToSession()?this.addGameMsg(b):b.isPrivate()||b.isToIndividuals()?this.addIndividualMsg(b):this.add(b.toString(),c)};d.prototype.outHtml=function(b){this._addLine(b);this._scrollToEnd()};d.prototype.outMyChannelChat=function(b){b=
        String.formatEx('<span class="cbChannelSender">-> To All:</span><span class="cbChannelChat cbMyChat">{0}</span>',b);this._addLine(b,"cbChatBubble cbChatRight");this._scrollToEnd()};d.prototype.outMyGameChat=function(b){b=String.formatEx('<span class="cbGameChatSender">-> {1}</span><span class="cbGameChat cbMyChat">{0}</span>',b,this.receiverName);this._addLine(b,"cbChatBubble cbChatRight");this._scrollToEnd()};d.prototype.addChannelMsg=function(b){if(b.isToGroup()||!V15.lobby.isInSpecialRoom())b=
        String.formatEx('<span class="cbChannelSender">{0} (To All): </span><span class="cbChannelChat">{1}</span>',b.strSender,b.strMsg),this._addLine(b,"cbChatBubble cbChatLeft cbChannelBubble"),this._scrollToEnd()};d.prototype.addGameMsg=function(b){b=String.formatEx('<span class="cbGameChatSender">{0}:</span><span class="cbGameChat">{1}</span>',b.strSender,b.strMsg);this._addLine(b,"cbChatBubble cbChatLeft");this._scrollToEnd()};d.lineId=0;d.prototype.addIndividualMsg=function(b){var c="chatLine"+(++d.lineId).toString();
        c=String.formatEx('<span id="{2}"><span class="cbGameChatSender">{0}:</span><span class="cbGameChat">{1}</span></span>',b.strSender,b.strMsg,c);c=this._addLine(c,"cbChatBubble cbChatLeft");this._scrollToEnd();$(c).click(function(){V15.lobby.lists.registerClientName(b.idSender,b.strSender);this.setReceiverId(b.idSender)}.bind(this));V15.panelMgr.signalIncomingChat(b.strSender)};d.prototype._scrollToEnd=function(){var b=$("#"+this.elementId+"-out"),c=b.offset().top,e=b.scrollTop(),d=b.find("div").last().offset().top;
        b.scrollTop(d-c+e)};d.prototype.add=function(b,c,e){if(b){var d=$("#"+this.elementId+"-out"),g=!1;e&&(e=d.find("div").last(),e.length&&(e.text(e.text()+b),g=!0));g||(g=document.createElement("div"),$(g).text(b),$(g).addClass("cbChatLine"),$(g).addClass(c),d.append(g));this._scrollToEnd()}};d.prototype.addKibitzChat=function(b,c,e,d,g,h){if(b||g)this.addOriginLine(b,c,d,g),b=$($.parseHTML(e)).text(),d=this._addLine(b,"cbChatLine"),$(d).addClass("cbChatSeparator"),b=$("#"+this.elementId+"-out"),c=b.offset().top,
        e=b.scrollTop(),h&&(h=$(d).offset().top,b.scrollTop(h-c+e))};d.prototype.addOriginLine=function(b,c,e,d){var f="";c&&c.white?(f=c.white.getListStr(1),(c=c.black.getListStr(1))&&(f+="-"+c)):"String "==typeof c&&(f=c);c="";var h="cbSessionName";e&&e.idGame&&(c=String.formatEx('onClick = "V15.panelMgr.addGameById( {0}, {1}, {2} );"',this.nInPage,e.idGame,e.mvInx),h="cbChatGameLink");e="cbSender";b==this.user&&(e+=" cbChatUserName cbBigUserName");b=d?String.formatEx('<span class="cbSessionName {2}"{1}>{0}:</span>',
        f,c,h):String.formatEx('<span class="{4}">{0}:</span><span class="cbSessionName {3}"{2}>({1})</span>',b,f,c,h,e);f="cbChatOrigin";d&&(f+=" cbAutoChat");this._addLine(b,f)};d.prototype.clear=function(){$("#"+this.elementId+"-out").html("")};d.prototype.outLoginOk=function(b){this.out("");this.user=b;b=String.formatEx("{0}<span class='cbChatUserName'>{1}</span>","Hello, ",b);this._addLine(b,"cbChatLoginOk cbChatSeparator");this.setInputPlaceHolder()};d.prototype.setInputPlaceHolder=function(){var b=
        lm.TYPE_CHAT_HERE;this.nReceivers&&(b+=" ("+this.nReceivers+" "+lm.RECEIVERS+")");this.setInputPlaceHolderMsg(b)};d.prototype.setInputPlaceHolderMsg=function(b){var c=$("#"+this.elementId+"-in");c&&c.attr("placeholder",b)};d.prototype.inviteLogin=function(){var b=this.getInviteLoginText();this._addLine(b,"cbChatLine")};d.prototype._addLine=function(b,c){var e=$("#"+this.elementId+"-out"),d=document.createElement("div");c&&$(d).addClass(c);$(d).html(b);e.append(d);return d};d.prototype._initToolBar=
        function(b){var c=this;$(b).jqxToolBar({width:"100%",tools:"custom | custom | button",theme:V15.config.jqxTheme,initTools:function(b,d,g){switch(d){case 0:return c._createRadioButton(g,lm.TO_OPPONENT,"opp",160,22,!1);case 1:return c._createRadioButton(g,lm.TO_ALL,"all",160,22,!0);case 2:g.jqxButton({width:130,height:22}),g.text("Shortcuts"),g.click(function(b){c._fnReceiverClick("opp",!0)&&(c.signalIndividualChat(c.receiverName),V15.panelMgr.openChatMenu(b,g,50))})}}})};d.prototype._createRadioButton=
        function(b,c,e,d,g,h){c=$(String.f("<div id={1}><span id={2}>{0}</span></div>",c,"radBtn"+e+this.nInPage,"radBtnSpan"+e+this.nInPage));b.append(c);c.jqxRadioButton({width:d,height:g,checked:h});var f=this;c.on("change",function(b){f._fnReceiverClick(e,b.args.checked)})};d.prototype.onTabSelect=function(b){b.args.item==this.myTabInx&&this._scrollToEnd()};return d}();CB.ChatElement.factory=function(d,b,c,e){b=new CB.ChatElement(b||0,c);b.initElem(d,e);return b};"use strict";
CB.LiveBookElement=function(){var d=function(b,c,d){this.nInPage=b;this.hasListeners=!1;this.fnGetKernel=c;this.ticket=d;this.stampToday=CB.TBrainMove.getTimeStampToday();this.entries=[];this.config={minVisits:5};this.curMove=0;this.initListeners()};d.prototype.initElem=function(b,c){this.elementId=b="string"==typeof b?b:b.id;b=$("#"+b);b.addClass("cbBookContainer");this.elem=b[0];this.createGrid()};d.prototype.resize=function(){$(this.elem).jsGrid("option","fields",this.getGridFields($(this.elem).width()));
    $(this.elem).jsGrid("option","height","100%");$(this.elem).jsGrid("option","width","100%");this.hasListeners||this.initListeners();$(this.elem).jsGrid("refresh")};d.prototype.createGrid=function(){$(this.elem).jsGrid({width:"400px",height:"100%",heading:!0,filtering:!1,editing:!1,inserting:!1,updateOnResize:!0,sorting:!0,autoload:!0,noDataContent:"Replay and check the LiveBook here",rowClick:function(b){},controller:{loadData:function(b){b=[];for(var c=0;c<this.entries.length;c++){var e={Move:this.entries[c].line,
            N:this.entries[c].getStrNGames(),Visits:this.entries[c].getStrNVisits(),Players:this.entries[c].getPlayers(),Result:this.entries[c].getStrResult(),Elo:this.entries[c].getStrElo()};b.push(e)}return b}.bind(this)},fields:this.getGridFields()});this.gridCreated=!0};d.prototype.getNGamesItemTemplate=function(c,d){if(this.curMove<b||this.isStandard)return"-"==c?String.formatEx('<span class="jsg-liveVisits">({0})</span>',d.Visits):c;c="https://live.chessbase.com/logon?returnurl="+encodeURIComponent(document.location);
    return String.formatEx('<a class="jsg-premiumRequired" href="{0}">Login</a>',c)};d.prototype.getPlayersItemTemplate=function(b,d){if(0==this.curMove&&!this.isPremium)return"---";if(this.curMove<c||this.isPremium)return b;if(this.isStandard)return String.formatEx('<a class="jsg-premiumRequired" href="{0}">Premium Required</a>',"https://account.chessbase.com/en/matrix");b="https://live.chessbase.com/logon?returnurl="+encodeURIComponent(document.location);return String.formatEx('<a class="jsg-premiumRequired" href="{0}">Premium Required</a>',
    b)};d.prototype.getGridFields=function(b){if(380>(b||400))return[{name:"Move",type:"text",width:30,css:"jsg-liveMove"},{name:"N",type:"number",width:25,css:"jsg-liveNGames",itemTemplate:this.getNGamesItemTemplate.bind(this)},{name:"Result",type:"number",width:25,css:"jsg-liveResult"},{name:"Elo",type:"number",width:20,css:"jsg-liveElo"}];b=[{name:"Move",type:"text",width:18,css:"jsg-liveMove"},{name:"N",type:"number",width:16,css:"jsg-liveNGames",itemTemplate:this.getNGamesItemTemplate.bind(this)},
    {name:"Result",type:"number",width:10,css:"jsg-liveResult"},{name:"Elo",type:"number",width:8,css:"jsg-liveElo"}];return b=b.concat([{name:"Players",type:"text",width:50,css:"jsg-livePlayers",itemTemplate:this.getPlayersItemTemplate.bind(this)}])};d.prototype.isVisible=function(){return $(this.elem).is(":visible")};var b=12,c=7;d.prototype.liveBookListener=function(b){if(!this.ticket||this.ticket==b.ticket)if(this.entries=[],$(this.elem).jsGrid("option","noDataContent","Position not in LiveBook"),
    !this.isVisible())this.lbInfo=b;else if(this.fnGetKernel()&&this.fnGetKernel().getCurPos){if(b.moves.length){var c=b.moves,e=this.fnGetKernel().getCurPos(),d=e.getSideToMove();6>=e.getPieces().length&&(b.sorted||CB.TBrainMoveList.sortEval(c,d==CB.Side.BLACK));if(!this.fnGetKernel())return;this.curMove=this.fnGetKernel().getCurPos().getPlyNum();for(c=e=0;c<b.moves.length;c++)e+=b.moves[c].getNVisits();this.stampToday=CB.TBrainMove.getTimeStampToday();e=6>=this.fnGetKernel().getCurPos().getPieces().length;
    this.entries=[];for(c=0;c<b.moves.length;c++)if(d=b.moves[c],e||this.passesMoveFilter(d)){var k=d.getMoveRecord();d={line:this.generateLine(b.position,k),nGames:d.m_performanceStats.getNGames(),Result:Math.round(d.m_performanceStats.getFPercent(b.position.isBTM()))+"%",elo:Math.round(d.m_performanceStats.getSortEloAv()),from:k.from,to:k.to,players:[],eval:d.getNEval(),nVisits:d.getNVisits(),getStrElo:function(){return this.elo?this.elo:""},getStrNGames:function(){return this.nGames?this.nGames.toLocaleString(CB.Language.getStrUserLanguage(),
            {maximumFractionDigits:0}):"-"},getStrNVisits:function(){return this.nVisits?this.nVisits.toLocaleString(CB.Language.getStrUserLanguage(),{maximumFractionDigits:0}):""},getPlayers:function(){for(var b=[],c=0;c<this.players.length&&4>c;c++){var e=this.players[c].name;1600<window.innerWidth&&0==b.length&&this.players[c].year&&(e+=" ("+this.players[c].year+")");b.push(e)}return b.join(", ")},getStrResult:function(){if(this.nGames)return this.Result;var b=this.eval;if(29750<Math.abs(b)){var c="#"+(3E4-
            Math.abs(b));0>b&&(c="-"+c);return c}c="";0<b&&(c="+");return c+(.01*b).toFixed(2)}};this.entries.push(d)}this.entries=this.entries.sort(function(b,c){return c.nGames==b.nGames?c.nVisits-b.nVisits:c.nGames-b.nGames});this.searchOnlineDB()}$(this.elem).jsGrid("loadData")}};d.prototype.passesMoveFilter=function(b){var c=this.config.minVisits||2;return(0<b.getNGames()||300>this.stampToday-b.m_nTimeStamp||b.isMyMove)&&(b.getNVisits()>=c||b.hasEval())};d.prototype.searchOnlineDB=function(){if(V15.onlineLobby&&
    V15.panelMgr.usesOnlineDB&&V15.panelMgr.usesOnlineDB()&&this.isPremium){V15.onlineLobby.isConnected()||V15.onlineLobby.connect();var b=new CB.SearchMask;b.setSearchBoard(this.fnGetKernel().game.getCurPos().board,this.fnGetKernel().game.getCurPos().getSideToMove());b.setUseBoard(!0);V15.onlineLobby.search(b,100,this.fnGetKernel().game.getMoveNo())}};d.prototype.onDBGamesListener=function(b){if(this.isVisible()){for(var c=!1,e=0;e<this.entries.length;e++)this.entries[e].players=[];for(var d=0;d<b.length;d++)if(b[d].nFlags&
    CB.OnlineEntryEnum.FLAGS_ONLINE_GAME&&V15.onlineLobby.firstMove<b[d].aGame.getCurLine().length){var k=b[d].aGame.getCurLine()[V15.onlineLobby.firstMove];for(e=0;e<this.entries.length;e++)if(this.entries[e].from==k.from&&this.entries[e].to==k.to){var l="",m=0,p=b[d].aGame.hdr.date.year;V15.onlineLobby.firstMove&1?(l=b[d].aGame.hdr.black.getListStr(0),m=b[d].aGame.hdr.eloWh):(l=b[d].aGame.hdr.white.getListStr(0),m=b[d].aGame.hdr.eloBl);for(var r=!1,t=0;!r&&t<this.entries[e].players.length;t++)r=this.entries[e].players[t].name==
    l;if(!r){this.entries[e].players.push({name:l,elo:m,year:p});c=!0;break}}}if(c){for(e=0;e<this.entries.length;e++)this.entries[e].players=this.entries[e].players.sort(function(b,c){return c.elo-b.elo}).filter(function(b){return 2400<b.elo}),8<this.entries[e].players.length&&(this.entries[e].players.length=8),this.entries[e].players=this.entries[e].players.sort(function(b,c){return c.year==b.year?c.elo-b.elo:c.year-b.year});$(this.elem).jsGrid("render")}}};d.prototype.generateLine=function(b,c){b=
    this.convertJSONLine(ObjUtil.clone(b),c);c=new CB.NotationGenerator(CB.V1);for(var e="",d=this.fnGetKernel().game.getStartPos().getBTM(),f=0;f<b.length;f++){var l=c.getMoveNota(b[f]),m=c.getStrMoveNumInLine(f,this.fnGetKernel().getCurPos().getPlyNum(),d);e+=m+l;f<b.length-1&&(e+=" ")}return e};d.prototype.convertJSONLine=function(b,c){var e=[];b.isLegalMove(c)&&(b.preCalcCtx(c),b.makeMove(c),b.postCalcCtx(c,!0),e.push(c));return e};d.prototype.loginListener=function(b){};d.prototype.onAccountTypeListener=
    function(b){this.isPremium=3==b.type;this.isStandard=2==b.type||3==b.type};d.prototype.initListeners=function(){V15.aTBLobby&&(this.hasListeners=!0,V15.aTBLobby.addOnLiveBookDisplayListener(this.liveBookListener.bind(this)));V15.onlineLobby&&V15.onlineLobby.addOnGamesListener(this.onDBGamesListener.bind(this));V15.addOnAccountTypeListener(this.onAccountTypeListener.bind(this))};return d}();CB.LiveBookElement.factory=function(d,b,c,e){b=new CB.LiveBookElement(b||0,c,e);b.initElem(d);return b};"use strict";
CB.EvalProfileControl=function(){var d=function(b,e,d,g,h,k){this.init(b,e,d,g);this.options=h;this.gotoMove=k;this.nMove=0},b=1;d.prototype.onDestroyDOM=function(){};d.prototype.reset=function(){this.evArr&&(this.evArr.first=0,this.evArr.last=1,this.evArr.evalArr=[CB.EvalProfileAnno.EV_INVALID,CB.EvalProfileAnno.EV_INVALID]);this.redraw()};d.prototype.redraw=function(){this.cbcanvas.requestRedraw()};d.prototype.setEvalArr=function(b){b?(this.evArr=ObjUtil.clone(b),this.cbcanvas.requestRedraw()):
    this.reset()};d.prototype.init=function(c,e,d,g){this.debugName=g;this.cbcanvas=c;this.calcGeometry();this.uniqueId=b++;this.resizeTimer=new CB.Timer(this.resizeHdl.bind(this))};d.prototype.resize=function(b,e){this.width=b;this.height=e;b&&e?this.resizeTimer.runOnce(5):this.resizeTimer.stop()};d.prototype.calcGeometry=function(){};d.prototype.resizeHdl=function(){this.width&&this.height&&this.cbcanvas.requestRedraw()};d.prototype.onMouseDown=function(b,e){};d.prototype.onMouseUp=function(b,e){b=
    (e.x-this.getDist())/this.getBinWidth();this.gotoMove(Math.floor(b))};d.prototype.onMouseWheel=function(b,e){};d.prototype.onMouseMove=function(b,e){};d.prototype.onDoubleClick=function(b,e){};d.prototype.onMouseEnter=function(b,e){};d.prototype.onMouseLeave=function(b,e){};d.prototype.drawForeground=function(b){};d.prototype.markMove=function(b){this.nMove=b;this.width&&this.height&&this.cbcanvas.requestRedraw()};d.prototype.draw=function(b){this.evArr&&(CB.LOG("DRAW EVALPROFILE","LogRed"),this.fillBG(b),
    this.drawXAxis(b),this.drawYAxis(b),this.drawValues(b),this.drawMoveMarker(b))};d.prototype.getDist=function(){return Math.max(2,this.height/16)};d.prototype.getYMiddle=function(){return Math.ceil((this.height-2*this.getDist())/2)};d.prototype.getHalfRange=function(){var b=this.evArr.range()/2;b=Math.floor(100*(b/100+1));200>b&&(b=200);1200<b&&(b=1200);return b};d.prototype.getYValue=function(b){if(32767==b)return 0;var c=this.getHalfRange(),d=0<b?1:0>b?-1:0;Math.abs(b)>c&&(b=c);b=0==b?0:Math.abs(b);
    c=Math.abs(c);return(this.height-2*this.getDist())/2*(b/c)*d};d.prototype.fillBG=function(b){if(this.width&&this.height){var c=b.createLinearGradient(0,0,this.width,this.height);c.addColorStop(0,"hsla( 0, 0%,  97%, 1.0 )");c.addColorStop(1,"hsla( 0, 0%, 99%, 1.0 )");b.fillStyle=c;CB.CanvasTools.fillRect(b,new CB.Rect(0,0,this.width,this.height))}};d.prototype.drawXAxis=function(b){var c=this.getDist(),d=this.getYMiddle()+1,g=this.width-this.getDist();b.strokeStyle="black";b.lineWidth=2;b.lineCap=
    "round";CB.CanvasTools.drawLine(b,c,d,g,d)};d.prototype.drawYAxis=function(b){var c=this.getDist()-2,d=this.getDist(),g=d+this.height-2*this.getDist();b.strokeStyle="black";b.lineWidth=2;b.lineCap="round";CB.CanvasTools.drawLine(b,c,d,c,g)};d.prototype.getBinWidth=function(){if(!this.evArr)return 1;var b=Math.max(30,this.evArr.last+1);return Math.max(1,(this.width-2*this.getDist())/b)};d.prototype.drawMoveMarker=function(b){var c=(this.nMove+0)*this.getBinWidth()+this.getDist(),d=new CB.Rect(c,0,
    c+this.getBinWidth(),0+this.height);CB.LOG("evR="+d.toString());b.fillStyle="hsla( 30, 3%, 30%, 0.16 )";CB.CanvasTools.fillRect(b,d);d=this.cbcanvas.zoomToPix(10);b.font=String.formatEx("{0}px Roboto",d);b.fillStyle="black";var g=this.evArr.evalArr[this.nMove-this.evArr.first],h=.27*this.height;d=this.getYMiddle()-h;0<=g&&(d=this.getYMiddle()+h);h="";"undefined"!=typeof g&&g!=CB.EvalProfileAnno.EV_INVALID&&(h=(g/100).toFixed(2),h+=", "+CB.Evaluation.getEvalString(g));if(h){g=b.measureText(h).width;
    var k=-this.getBinWidth();c+k+g>this.width&&(k=this.width-g-c-5);b.fillText(h,c+k,d)}};d.prototype.drawValues=function(b){var c=this.getBinWidth();b.strokeStyle="hsla( 0, 0%, 0%, 0.4 )";b.fillStyle="green";b.lineWidth=1;for(var d=0;d<this.evArr.last-this.evArr.first+1;d++){var g=Math.round((this.evArr.first+d)*c+this.getDist()),h=Math.round(g+c),k=this.getYMiddle(),l=this.evArr.evalArr[d],m=this.getYValue(l);m&&(b.fillStyle=0>m?28E3<Math.abs(l)?"hsla( 0, 30%, 30%, 1.0 )":"red":28E3<Math.abs(l)?"hsla( 120, 30%, 25%, 1.0 )":
    "green",l=Math.round(this.getYMiddle()-m),l<k&&(m=l,l=k,k=m),g=new CB.Rect(g,k,h,l),CB.LOG("evR="+g.toString()),CB.CanvasTools.fillRect(b,g),b.strokeStyle="black",CB.CanvasTools.drawRect(b,g))}};return d}();
CB.VersionCodeEnum={JSPLAYCHESS:1101,JSLIVEBLITZ:1102,JSCBONLINE:1103,JSOPENINGS:1104,JSPREMIUM:1105,JSFRITZ:1106,JSTEST:1107,JSMYGAMES:1108,JSPLAYERDB:1109,JSTACTICS:1110,JSTACTICSBOARD:1111,JSCBONLINEBOARD:1112,JSPREMIUMBOARD:1113,JSENDGAMES:1114,JSLIVE:1115,JSREADER:1116,JSPLAY:1117,JSSTUDY:1118,JSINTERACTIVEFRITZ:1119,JSPLUGIN:1120,JSCBOFFLINE:1121,toString:function(d){for(a in CB.VersionCodeEnum)if(CB.VersionCodeEnum[a]==d)return a;return d}};
CB.VersionCode=function(){var d=function(b,c,e,d){this.nFamily=void 0!==b?b:CB.VersionCodeEnum.JSPLAYCHESS;this.nMajor=void 0!==c?c:0;this.nMinor=void 0!==e?e:0;this.nBeta=void 0!==d?d:0};d.prototype.Vz=function(b){b.Vv(this.nFamily);b.Vv(this.nMajor);b.Vv(this.nMinor);b.Vv(this.nBeta);b.Vv(83);b.Vv(0);b.Vx(0);b.Vv(0);b.Vv(0)};d.prototype.toString=function(){return this.familyToString(this.nFamily)+" "+this.getStrVersion()};d.prototype.getStrVersion=function(){var b=this.nMajor+"."+this.nMinor;this.nBeta&&
(b+="."+this.nBeta);CB.System.isCordova()&&(b+="c");CB.System.browserIsSafeForEngine()&&(b+="e");CB.System.isMobile()&&(b+="m");return b};d.prototype.familyToString=function(b){switch(b){default:return CB.VersionCodeEnum.toString(b);case CB.VersionCodeEnum.JSPLAYCHESS:return"Playchess";case CB.VersionCodeEnum.JSLIVEBLITZ:return"LiveBlitz";case CB.VersionCodeEnum.JSCBONLINE:return"OnlineDB";case CB.VersionCodeEnum.JSOPENINGS:return"Openings";case CB.VersionCodeEnum.JSFRITZ:return"Fritz";case CB.VersionCodeEnum.JSMYGAMES:return"MyGames";
    case CB.VersionCodeEnum.JSTRAINING:return"Training";case CB.VersionCodeEnum.JSENDGAMES:return"Endgames";case CB.VersionCodeEnum.JSLIVE:return"Live";case CB.VersionCodeEnum.JSREADER:return"Reader";case CB.VersionCodeEnum.JSPLAY:return"Play";case CB.VersionCodeEnum.JSSTUDY:return"Study"}};d.prototype.GetNCompressedVersion64=function(){return this.nFamily<<48|this.nMajor<<32|this.nMinor<<16|this.nBeta};return d}();
CB.SockMsgId={NONE:0,WIN_INVALID_PASSWORD:17,WIN_ACCESS_DENIED:42,ALIVE:7001,LOGON:7002,LOGOFF:7003,YOUR_ID:7004,INVALID_PASSWORD:7005,RECONNECT_OK:7006,CLIENTPING:7007,CLIENTECHO:7008,BINDERTIMEOUT:7009,ALREADYLOGGEDON:7010,FORCE_LOGOFF:7011,INVALIDPASSWORD:7012,YOUR_LOGINTOKEN:7013,ACCOUNT_LOCKOUT:7014,IAMALIVE:7015,LOGIN_OTHER_MACHINE:7016,KICKEDOUT_OTHER_MACHINE:7017,IDLE_CLIENT_LOGOFF:7018,CHAT:7020,STARTTYPINGCHAT:7021,ALERT:7022,PING_BY_NAME:7023,RESPOND_PING_BY_NAME:7024,USER:7030,QUERY_SERVERALIVE:7040,
    SERVER_IS_ALIVE:7041,TEST:7042,CLIENTLIST:7050,ADDCLIENTS:7051,REMOVECLIENTS:7052,CLIENTDATACHANGE:7053,LISTFRAGMENTRECEIVED:7054,LISTUPDATECHANGE:7055,CLIENTDATACHANGELIST:7056,SESSIONSTATUSCHANGELIST:7057,REQUESTCLIENTLIST:7058,GROUPSTATUSCHANGE:7060,CHANGEGROUP:7061,DEFAULTGROUPS:7062,CHANNELDATA:7070,CHANNELSTATUSCHANGE:7071,REQUESTCHANNELS:7072,JOINCHANNEL:7073,GETBROADCASTURLS:7074,BROADCASTURLS_DATA:7075,GETGEOLEADERBOARD:7076,GEOLEADERBOARD_DATA:7077,GETFRIENDSLEADERBOARD:7078,GETFRIENDSLEADERBOARD_REPLY:7079,
    REQUEST_STATISTICS:7080,STATISTICS_DATA:7081,RELAYFRIENDSMESSAGE:7082,FRIENDSMESSAGE_DATA:7083,GETACTIVEHLSSTREAMS:7084,GETACTIVEHLSSTREAMS_REPLY:7085,GROUPHTMLCHANGED:7086,REQUESTCLIENTDATA:7087,CLIENTDATA:7088,REQUESTBROADCASTURLSEX:7089,REQUESTBROADCASTURLSEX_DATA:7090,REQUESTGROUPS:7091,GROUPSDATA:7092,QUERY_ONLINE_DB:7100,REQUEST_ONLINE_DB_GAMES:7101,REQUEST_ONLINE_DB_HEADERS:7102,REQUEST_ONLINE_DB_STATISTICS:7103,REQUEST_ONLINE_DB_USER_INFO:7104,REQUEST_ONLINE_DB_ADMIN_INFO:7105,ONLINE_DB_NUMBERS:7106,
    ONLINE_DB_GAMES:7107,ONLINE_DB_HEADERS:7108,ONLINE_DB_STATISTICS:7109,ONLINE_DB_MAINTENANCE:7110,ONLINE_DB_USER_INFO:7111,ONLINE_DB_ADMIN_INFO:7112,MAINTENANCE_ONLINE_DB_UPDATE:7113,PLAYER_BASE_USER:7200,TERABRAIN_USER:7300,TERABRAIN_ERROR:7301,TERABRAIN_MAINTENANCE:7302,REQUEST_TERABRAIN_POSITION:7303,TERABRAIN_REQUEST:7304,TERABRAIN_ENGINE_SEARCHDATA:7305,TERABRAIN_BOOKINFO:7306,TERABRAIN_TABLEDATA:7307,CLOUD_USER:7400,TRAINING_USER:7401,ANALYSIS_USER:7402,LIVE_USER:7403,toString:function(d){for(var b in this)if(this[b]==
        d)return"SockMsg:"+b;return"Unknown SockMsg: "+d},toNumString:function(d){return"SockMsgId="+d}};
CB.WebSockMessage=function(){var d=function(b){this.type=b||CB.SockMsgId.NONE;this._init()};d.prototype.getType=function(){return this.type};d.prototype.setType=function(b){this.type=b};d.prototype.getUserType=function(){return this.userType};d.prototype.setUserType=function(b){this.userType=b};d.prototype.getIdReceiver=function(){return this.idReceiver};d.prototype.setIdReceiver=function(b){this.idReceiver=b};d.prototype.Vj=function(){return this.idSender};d.prototype.Vm=function(b){this.idSender=
    b};d.prototype.setVal=function(b){this.nVal=b};d.prototype.getVal=function(){return this.nVal};d.prototype.address=function(b,c){this.idSender=b;this.idReceiver=c};d.prototype.getBuf=function(){return this.buf};d.prototype.fillSendArrBuf=function(b){var c=16;b&&(c+=4);c=new ArrayBuffer(c+this.buf.getWriteSize());var e=new DataView(c);e.setInt16(0,this.type);e.setInt32(2,this.nVal);e.setInt32(6,this.idSender);e.setInt16(10,this.userType);e.setInt32(12,this.idReceiver);b?(e.setInt32(16,this.msgId),
    this.buf.writeToDataView(e,20)):this.buf.writeToDataView(e,16);return c};d.prototype.fromReceiveBuf=function(b){if(16<=b.byteLength){var c=new DataView(b);this.type=c.getInt16(0);this.nVal=c.getInt32(2);this.idSender=c.getInt32(6);this.userType=c.getInt16(10);this.idReceiver=c.getInt32(12);20<=b.byteLength&&(this.buf.readFromDataView(c,16),this.buf.rewind())}else throw Error("Illegal Message received");};d.prototype.toString=function(){var b="",c;for(c in CB.SockMsgId)if(this.type==CB.SockMsgId[c]){b+=
    c;break}this.userType&&(b+=", usr="+this.userType);b+=", sender="+this.idSender+", receiver="+this.idReceiver;this.buf.getSize()&&(b+=", bufsize="+this.buf.getSize());return b};d.prototype._init=function(){this.nVal=this.idSender=this.idReceiver=this.userType=0;this.buf=new CB.DataBuffer;this.msgId=0};return d}();CB.LoginMode={NORMAL:1,GUEST:2};CB.LogoffType={DEFAULT:0,REMOVE_WATCHER:1,RESIGN:2,ABORT:3};CB.LoginFlags={YES2CHESS:32,HASWEBSOCKIDS:128,IS_WEAK_GUEST:1024,SPRINT_REQUESTS_NEXT_POS:2048};
CB.LogonData=function(){var d=function(b,c,e,d,g,h){this.strName=b;this.strPass=c;this.nMode=e;this.version=V15.versionCode;this.guid=d;this.language=CB.Language.getStrUserLanguage();this.codepage=CB.System.getWindowsCodePage();this.strRoom="";this.strRoomUrl=document.referrer;this.token=g||"";this.app=h||"";this.flags=0;this.documentUrl=""};d.prototype.Vc=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.LOGON);c.address(CB.ConnectId.UNKNOWN,CB.ConnectId.SERVER);c.getBuf().Vx(this.nMode);this.version.Vz(c.getBuf());
    var e=this.strName;CB.strUtil.hasASCIIgreater127(e)&&!CB.strUtil.mayBeUtf8(e)&&(e=CB.strUtil.encodeUTF8(e));var d=this.strPass;CB.strUtil.hasASCIIgreater127(d)&&!CB.strUtil.mayBeUtf8(d)&&(e=CB.strUtil.encodeUTF8(d));c.getBuf().V8(e);c.getBuf().V8(d);this.guid.Vz(c.getBuf());c.getBuf().V5(this.language);c.getBuf().V5(navigator.platform);c.getBuf().Vx(this.codepage);c.getBuf().V8(this.strRoom);c.getBuf().V5(this.token);c.getBuf().V8(0<this.strRoom.length?this.strRoomUrl:"");c.getBuf().V5(this.app);
    b&&(this.flags|=CB.LoginFlags.HASWEBSOCKIDS);c.getBuf().Vx(this.flags);c.getBuf().V5(navigator.appVersion);c.getBuf().V5(this.documentUrl);return c};d.prototype.setIsBeginner=function(){this.flags|=CB.LoginFlags.IS_WEAK_GUEST};d.prototype.setRequestsSprintPos=function(){this.flags|=CB.LoginFlags.SPRINT_REQUESTS_NEXT_POS};return d}();"use strict";
CB.YourIdData=function(){var d=function(){this.nId=CB.ConnectId.NONE;this.nIdCMSArchive=this.nIdBroadcastGroup=this.nIdDefaultPlayingGroup=0;this.strUserId=this.strToken="";this.nFlags=this.Vl=0};d.prototype.fromSocketsMsg=function(b){b.getBuf().rewind();this.nIdDefaultPlayingGroup=b.getBuf().V10();this.nIdBroadcastGroup=b.getBuf().V10();this.nId=b.getBuf().V10();this.nIdCMSArchiv=b.getBuf().V10();this.strToken=b.getBuf().V6(200);this.Vl=b.getBuf().V11();this.strUserId=b.getBuf().V6(200);this.nFlags=
    b.getBuf().V10()};d.prototype.isFromBridge=function(){return 0!==(this.nFlags&2)};return d}();
CB.ChatData=function(){var d=function(){this.idReceiver=this.idSender=CB.ConnectId.NONE;this.eColName=this.eWeight=0;this.strMsg="";this.eSound=0;this.strSender="";this.nTotalReceivers=this.flags=this.nChannel=0;this.arrReceivers=[];this.token=0};d.prototype.chatFlags={ITALIC:1,UNDERLINE:2,UTF8:256,AUTOMATIC:4096,TO_GROUP:8192,TO_OBSERVERS:16384,TO_CHANNEL:32768,TO_INDIVIDUALS:65536,TO_OBSERVERSANDPLAYERS:131072,TO_SESSION:262144};d.YELLOW=14;d.prototype.Vc=function(){var b=new CB.WebSockMessage(CB.SockMsgId.CHAT);
    b.address(this.idSender,this.idReceiver);var c=b.getBuf();c.Vv(this.eWeight);c.Vv(this.eColName);c.V5(this.strMsg);c.Vv(this.eSound);c.V5(this.strSender);c.Vx(this.nChannel);c.Vx(this.nTotalReceivers);c.Vx(this.flags);if(this.isToIndividuals()){c.Vx(this.arrReceivers.length);for(var e=0;e<this.arrReceivers.length;e++)c.Vx(this.arrReceivers[e])}c.Vh(this.token);return b};d.prototype.fromSocketsMsg=function(b){var c=b.getBuf();this.idReceiver=b.getIdReceiver();this.idSender=b.Vj();c.rewind();this.eWeight=
    c.V11();this.eColName=c.V11();try{this.strMsg=c.V6(1E3)}catch(f){CB.LogException("Chat Msg Len exception, sender="+this.idSender)}this.eSound=c.V11();try{this.strSender=c.V6(210)}catch(f){CB.LogException("Chat Sender exception, msg="+this.strMsg+", sender="+this.idSender)}this.nChannel=c.V10();this.nTotalReceivers=c.V10();this.flags=c.V10();if(this.isToIndividuals()){b=c.V10();for(var e=0;e<b&&500>e;e++)this.arrReceivers.push(c.V10())}this.token=c.Vw()};d.prototype.toString=function(){var b="";0<
this.strSender.length&&(b+="<em>"+this.strSender+":</em> ");return b+=this.strMsg};d.prototype.isPrivate=function(){return 0==this.flags};d.prototype.isToIndividuals=function(){return 0!=(this.flags&this.chatFlags.TO_INDIVIDUALS)};d.prototype.setToIndividuals=function(b){CB.setFlag(this,this.chatFlags.TO_INDIVIDUALS,b)};d.prototype.isToChannel=function(){return 0!=(this.flags&this.chatFlags.TO_CHANNEL)};d.prototype.setToChannel=function(b){CB.setFlag(this,this.chatFlags.TO_CHANNEL,b)};d.prototype.isToSession=
    function(){return CB.isFlag(this.flags,this.chatFlags.TO_SESSION)};d.prototype.setToSession=function(b){CB.setFlag(this,this.chatFlags.TO_SESSION,b)};d.prototype.isToObservers=function(){return CB.isFlag(this.flags,this.chatFlags.TO_OBSERVERS)};d.prototype.setToObservers=function(b){CB.setFlag(this,this.chatFlags.TO_OBSERVERS,b)};d.prototype.getIdSession=function(){return this.nChannel};d.prototype.setToGroup=function(b){CB.setFlag(this,this.chatFlags.TO_GROUP,b)};d.prototype.isToGroup=function(){return 0!=
    (this.flags&this.chatFlags.TO_GROUP)};d.prototype.setIdSession=function(b){this.nChannel=b};d.prototype.setChannel=function(b){this.nChannel=b;this.setToChannel(!0)};d.prototype.setAutomatic=function(b){CB.setFlag(this,this.chatFlags.AUTOMATIC,b)};d.prototype.isAutomatic=function(){return 0!=(this.flags&this.chatFlags.AUTOMATIC)};d.prototype.setReceivers=function(b){b.length?(this.idReceiver=b[0],this.arrReceivers=b):(this.idReceiver=b,this.arrReceivers.push(b))};d.prototype.autoTests=function(){window.chat=
    new d;chat.eColName=2;chat.eWeight=1;chat.eSound=3;chat.nChannel=4;chat.nTotalReceivers=5;chat.strMsg="Hello World!";chat.strSender="Doktor Schiwago";var b=chat.Vc();window.chat2=new d;chat2.fromSocketsMsg(b);return chat2.strMsg!==chat.strMsg?"test failed":"test OK"};return d}();CB.ConnectId={NONE:0,UNKNOWN:0,SERVER:1};CB.SockState={CONNECTING:0,CONNECTED:1,CLOSING:2,CLOSED:3};
CB.Connection=function(){var d=function(b,c){this.connectId=CB.ConnectId.NONE;this.uris=[].concat(c);this.nUri=0;V15&&void 0!=V15.config.nBridge&&V15.config.nBridge<this.uris.length&&(this.nUri=V15.config.nBridge);this.wsUri=this.uris[this.nUri];this.msgsWaitingToSend=new CB.Queue;this.msgsWaitingToSendNoId=new CB.Queue;this.onYourId=function(b){};this.onClose=function(b){};this.isFirstConnect=!0;this.firstConnectTries=0;this.onConnectionLoss=function(){};this.onServerDown=function(){};this.lobby=
    b;this.Va=0;this.error=!1;this.isActiveTicker=new CB.Tick;this.weAreAliveTicker=new CB.Tick;this.tryTimer=new CB.Timer(this.periodicHandler.bind(this));this.tryTimerPeriod=200;this.msgCnt=0};d.prototype.open=function(){try{this.socket&&this.socket.close();this.socket=new WebSocket(this.wsUri);var b=this;this.error=!1;this.socket.onopen=function(){for(;!b.msgsWaitingToSendNoId.empty();)b.socket.readyState==CB.SockState.CONNECTED?b.sendMessage(b.msgsWaitingToSendNoId.pop(),!0):(b.msgsWaitingToSendNoId.pop(),
    CB.LOG("YOU DID SOMETHING BAD, YOU ARE SENDING BUT HAVE NOT WAITED FOR CONNECTION TO COMPLETE","LogException"));for(;!b.msgsWaitingToSend.empty();)b.socket.readyState==CB.SockState.CONNECTED?b.sendMessage(b.msgsWaitingToSend.pop(),!1):(b.msgsWaitingToSend.pop(),CB.LOG("YOU DID SOMETHING BAD, YOU ARE SENDING BUT HAVE NOT WAITED FOR CONNECTION TO COMPLETE","LogException"));CB.LOG("Connected to "+b.wsUri,"","conn");console.log("Connected:"+b.wsUri);this.tryTimerPeriod=200;(new CB.Timer(function(){b.lobby.onConnect()})).runOnce(20)};
    this.socket.onclose=function(c){5;b.onClose(b);if(void 0!==b.onBroken)b.onBroken();1E3<c.Code&&(V15.LogConnection(b.lobby.getName()+"-Close="+c.Code),console.log("Close: "+closeCodes[c.Code]))};this.socket.onerror=function(c){CB.LOG("OnError  : "+b.wsUri,"LogError","conn");console.log("Error: "+b.wsUri+" "+c);b.isFirstConnect&&1<b.uris.length&&4>++b.firstConnectTries?(b.switchConnection(),b.open()):(b.error=!0,b.onSocketError(b))};this.socket.onmessage=function(c){b.tryTimer.stop();if(c.data instanceof
        ArrayBuffer){var e=new CB.WebSockMessage;try{e.fromReceiveBuf(c.data)}catch(f){EXCEPTION(f.toString())}b.V0(e);b.weAreAliveTicker.start()}else CB.LOG(c.data,"","conn"),console.log("RESPONSE: "+c.data);b.Va=0}}catch(c){CB.LogException("Conn",c)}};d.prototype.close=function(){CB.LOG("Close Conn"+this.wsUri,"","conn");(this.isConnected()||this.isConnecting())&&this.socket.close();this.tryTimer.stop()};d.prototype.isConnected=function(){return this.socket&&this.socket.readyState==CB.SockState.CONNECTED};
    d.prototype.isConnecting=function(){return this.socket&&this.socket.readyState==CB.SockState.CONNECTING};d.prototype.onSocketError=function(){this.isFirstConnect?(this.onServerDown(),this.lobby.periodicPingTimer&&this.lobby.periodicPingTimer.stop(),this.tryTimer.runPeriodic(3E4)):(this.onConnectionLoss(),this.tryTimer.runPeriodic(this.tryTimerPeriod))};d.prototype.V0=function(b){this.isFirstConnect=!1;var c=!0;switch(b.getType()){default:c=!1;break;case CB.SockMsgId.YOUR_ID:this.handleYourId(b);break;
        case CB.SockMsgId.ALIVE:c=!1}c||this.lobby.handleReceived(b)};d.prototype.handleYourId=function(b){var c=new CB.YourIdData;c.fromSocketsMsg(b);this.connectId=c.nId;this.lobby.idReceived(c);this.onYourId(this)};d.prototype.sendMessage=function(b,c){if(this.socket){if(!b.getType())throw Error("Sending invalid sockMsg");b.msgId=c?0:++this.msgCnt;b.getIdReceiver()==CB.ConnectId.NONE&&b.setIdReceiver(CB.ConnectId.SERVER);b.Vm(this.connectId);this.socket.readyState==CB.SockState.CONNECTED?(this.socket.binaryType=
        "arraybuffer",b=b.fillSendArrBuf(!c),this.socket.send(b)):this.socket.readyState==CB.SockState.CONNECTING?(c?this.msgsWaitingToSendNoId.push(b):this.msgsWaitingToSend.push(b),CB.LOG("MSGs WAITING TO SEND="+this.msgsWaitingToSend.getLength(),"LogRed")):this.socket.readyState!=CB.SockState.CLOSING&&this.socket.readyState!=CB.SockState.CLOSED&&(this.error=!0,this.onSocketError())}};d.prototype.sendText=function(b){this.socket&&1==this.socket.readyState?(console.log("SENT: "+b),this.socket.send(b)):CB.LOG("Connection not open")};
    d.prototype.breakForTesting=function(){CB.LOG("Break Connection for Testing");this.close()};d.prototype.periodicHandler=function(){CB.LOG("Conn Periodic, retries="+this.Va+", "+this.lobby.connectId,"","conn");this.tryTimer.runPeriodic(1E4);this.socket&&this.socket.readyState!=CB.SockState.CONNECTED&&this.error&&(this.Va+=1,1<=this.Va&&(this.isFirstConnect||6<this.Va)&&this.switchConnection(),this.lobby.pingServer&&this.lobby.pingServer(!0,1==this.Va?2E3:6E3,!0),5<this.Va&&this.tryTimer.runPeriodic(5E4+
        3E4*Math.random()))};d.prototype.switchConnection=function(){this.nUri++;if(this.uris&&this.uris.length&&(this.nUri>=this.uris.length&&(this.nUri=0),CB.LOG("nUri: "+this.nUri,"","conn"),this.wsUri=this.uris[this.nUri],CB.LOG("Switch Conn: "+this.wsUri,"","conn"),console.log("Switch Conn: "+this.wsUri),this.lobby.onSwitchConn))this.lobby.onSwitchConn(this.nUri)};return d}();
CB.ClientParams=function(){var d=function(b){this.guid=new CBGuid;this.password=this.userName="";this.stayLoggedIn=!0;var c="ClientGUID"+b,e=null,d=window;d.localStorage?e=d.localStorage:d.sessionStorage&&(e=d.sessionStorage);if(e&&e[c]){b=JSON.parse(e[c]);for(var g in b)this.guid[g]=b[g]}else this.guid=new CBGuid,this.guid.fromRandom(b),e&&(e[c]=JSON.stringify(this.guid))};d.prototype.toString=function(){return"User="+this.userName+", mode="+this.loginMode};d.prototype.saveLogin=function(){this.save("user",
    this.userName)};d.prototype.loadLogin=function(){this.userName=this.load("user")};d.prototype.getSessionStorage=function(){var b=null,c=window;c.sessionStorage?b=c.sessionStorage:c.localStorage&&(b=c.localStorage);return b};d.prototype.storeRoom=function(b,c,e,d){this.room=b;this.set("room",b);this.set("roomurl",c);this.set("banner",e);this.set("roomtext",d)};d.prototype.clearRoom=function(){this.room="";this.set("room","");this.set("roomurl","");this.set("banner","");this.set("gradient","");this.set("roomtext",
    "")};d.prototype.storeBanner=function(b,c){this.set("banner",b);this.set("gradient",c)};d.prototype.storeSeek=function(b){this.set("seek",b)};d.prototype.store=function(b,c){this.getSessionStorage()[c]=b};d.prototype.get=function(b){return this.getSessionStorage()[b]||""};d.prototype.set=function(b,c){this.getSessionStorage()[b]=c};d.prototype.load=function(b){return window.localStorage?window.localStorage[b]||"":""};d.prototype.save=function(b,c){window.localStorage&&(window.localStorage[b]=c)};
    d.prototype.isKibitz=function(){return this.get("kibitz")};d.prototype.startEngine=function(){if(!CB.System.isMobile()){var b=this.get("layout");return b&&0<=b.search("engine")}};d.prototype.hasLayout=function(){return this.get("layout")};d.prototype.shouldDisplayBoardUrls=function(){return this.isKibitz()&&this.noRibbons()};d.prototype.noRibbons=function(){var b=this.get("layout");return b&&0<=b.search("nomenu")};d.prototype.noPlayers=function(){var b=this.get("layout");return b&&0<=b.search("noplayers")};
    d.prototype.noLists=function(){return!0};d.prototype.receiveSeeksAlways=function(){return!1};d.prototype.noChat=function(){var b=this.get("layout");return b&&0<=b.search("nochat")};d.prototype.noBook=function(){var b=this.get("layout");return b&&0<=b.search("nobook")};d.prototype.noNota=function(){var b=this.get("layout");return b&&0<=b.search("nonota")};d.prototype.getRoom=function(){return this.get("room")};d.prototype.getRoomUrl=function(){return this.get("roomurl")};d.prototype.getRoomText=function(){return this.get("roomtext")};
    d.prototype.getBanner=function(){return this.get("banner")};d.prototype.getGradient=function(){return this.get("gradient")};d.prototype.getPlay=function(){return this.get("play")};d.prototype.isPlay=function(){return this.get("play")};d.prototype.prepareLoginChange=function(){var b={banner:this.getBanner(),gradient:this.getGradient(),room:this.getRoom(),roomUrl:this.getRoomUrl()};this.keepStateAccrossLogin(b)};d.prototype.afterLoginChange=function(){var b=this.getStateAcrossLogin();b&&(this.resetStateAfterLogin(),
        this.storeBanner(b.banner,b.gradient))};d.prototype.keepStateAccrossLogin=function(b){b=JSON.stringify(b);window.localStorage&&(window.localStorage.AcrossLogin=b)};d.prototype.resetStateAfterLogin=function(b){window.localStorage&&delete window.localStorage.AcrossLogin};d.prototype.getStateAcrossLogin=function(){if(window.localStorage){var b=window.localStorage.AcrossLogin;if(b)return JSON.parse(b)}};d.prototype.clearLoginCookies=function(b){this.loginToken="";b||CB.DOM.clearCookie("AccountName64");
        CB.DOM.clearCookie("AccountToken");CB.DOM.clearCookie("AccountMode");CB.DOM.setCookie("CBCOMMON","")};d.prototype.clearCBCommonCookie=function(){CB.DOM.setCookie("CBCOMMON","")};d.prototype.rememberLoginToken=function(){this.stayLoggedIn&&this.loginToken?CB.DOM.setCookie("AccountToken",this.loginToken):CB.LOG("RememberLoginToken, stayLoggedIn="+this.stayLoggedIn+"="+this.loginToken)};d.prototype.clearLoginToken=function(){CB.DOM.clearCookie("AccountToken");this.loginToken=""};d.prototype.hasUserAndPass=
        function(){return this.userName&&"guest"!=this.userName&&(this.loginToken||this.password)};d.prototype.requestTokenWithPassword=function(b){!this.loginToken&&this.password&&this.loginMode==CB.LoginMode.NORMAL&&(new CB.Timer(function(){(new CB.AccountsManager(b)).pwLogin(this.userName,this.password,function(b){b&&b.Token&&(this.loginToken=unescape(b.Token),this.rememberLoginToken(),CB.DOM.setAccountNameCookie(this.userName),CB.DOM.setCookie("AccountMode",CB.LoginMode.NORMAL))}.bind(this))}.bind(this))).runOnce(100)};
    return d}();"use strict";CB.namespace("CB.Server.LogOffReason");CB.Server.LogOffReason={MAINTENANCE:0,ADMIN_ACTION:1,DOUBLE_LOGIN:2,IDLE_CLIENT:3};CB.namespace("CB.Server.Connector");
CB.Server.Connector=function(){var d=function(){this.hasIdReceived=!1;this.pingServerPeriodMS=12E3;this.reconnectBaseTime=5E3;this.bufferedMsgs=[];this.isFirstConn=!0;this.name="...";this.pingCount=this.connectCount=0;this.logClientEcho=this.silentServerPing=!0};d.prototype.create=function(b,c,e,d,l){this.pingTimer=new CB.Timer(this.onServerPingTimeout.bind(this));this.user=c;this.utf8User=CB.strUtil.encodeUTF8(c);this.pass=e;this.conn=new CB.Connection(this,b);this.loginMode=d;this.token=l;this.pingStart=
    CB.getTick();this.Va=0;this.timerReconnect=new CB.Timer;this.nMyLagMS=3E3;this.conn.onConnectionLoss=this.onConnLoss.bind(this);this.conn.onServerDown=this.hdlOnServerDown.bind(this);this.boundLoginOk=!1;d!=CB.LoginMode.GUEST&&CB.DOM.setAccountNameCookie(c);this.periodicPingTimer=new CB.Timer(this.periodicPingHandler.bind(this))};d.prototype.hdlOnServerDown=function(b){if(void 0!==this.onServerDown)this.onServerDown();this.hasIdReceived=!1};d.prototype.onConnLoss=function(b){if(void 0!==this.onConnBroken)this.onConnBroken();
    this.hasIdReceived=!1;this.onServerNotAlive()};d.prototype.getName=function(){return"Connector"};d.prototype.connectUser=function(b,c,e,d){this.pingTimer&&this.pingTimer.stop();this.userLoggedOff=this.forcedLogOff=!1;this.pingTimer=new CB.Timer(this.onServerPingTimeout.bind(this));this.isConnected()&&this.hasIdReceived&&this.logOff();this.onChangeLogin();this.user=b;this.utf8User=CB.strUtil.encodeUTF8(this.user);this.pass=c;this.token=d;this.loginMode=e;this.pingStart=CB.getTick();this.Va=0;this.timerReconnect=
    new CB.Timer;this.nMyLagMS=3E3;(new CB.Timer(this.connectFresh())).runOnce(100);e!=CB.LoginMode.GUEST&&CB.DOM.setAccountNameCookie(b)};var b=new CB.Vr;d.prototype.reconnectUser=function(){b.exec(function(){this.loginMode=this.pass?CB.LoginMode.NORMAL:CB.LoginMode.GUEST;this.connectUser(this.user,this.pass,this.loginMode,this.token);this.Va++;this.timerReconnect.stop()}.bind(this),10*this.Va)};d.prototype.connectFresh=function(){this.conn.close();this.hasIdReceived=!1;this.connect()};d.prototype.connect=
    function(){this.conn&&(this.boundLoginOk=this.hasIdReceived=!1,this.conn.close(),this.conn.open(),this.isSilent()||this.statusMsg(lm.CONNECTING,"LogBold"),this.periodicPingTimer.runPeriodic(this.pingServerPeriodMS),this.connectCount++)};d.prototype.isConnected=function(){return this.conn?this.conn.isConnected():!1};d.prototype.isConnecting=function(){return this.conn?this.conn.isConnecting():!1};d.prototype.isLoggedIn=function(){return this.boundLoginOk&&this.isConnected()};d.prototype.wasLoggedIn=
    function(){return!this.isFirstConn&&!this.isConnected()};d.prototype.hasSockMsgIds=function(){return!1};d.prototype.logonGuest=function(){this.isSilent()||(this.logIntoChat(this.getWaitForServerMsg(),"LogGreen","conn"),this.statusMsg(this.getWaitForServerMsg(),"LogGreen","conn"));var b=V15.Vf.guid;CB.System.runsInIFrame()&&b.fromRandom(10);b=this.createLogonData(b,!0);this.modifyLoginData(b);this.sendNoId(b.Vc(this.hasSockMsgIds()));this.userLoggedOff=!1};d.prototype.logon=function(){if(!this.hasIdReceived){this.boundLoginOk=
    !1;this.isSilent()||(this.logIntoChat(this.getWaitForServerMsg(),"LogGreen","conn"),this.statusMsg(this.getWaitForServerMsg(),"LogGreen","conn"));var b=this.createLogonData(V15.Vf.guid,!1);this.modifyLoginData(b);this.sendNoId(b.Vc(this.hasSockMsgIds()));this.userLoggedOff=!1}};d.prototype.modifyLoginData=function(b){};d.prototype.createLogonData=function(b,c){return c?new CB.LogonData("Guest","Pass",CB.LoginMode.GUEST,b):new CB.LogonData(this.user,this.pass,CB.LoginMode.NORMAL,b,this.token)};d.prototype.clearLoginCookies=
    function(){V15.Vf&&V15.Vf.clearLoginCookies(!0)};d.prototype.getWaitForServerMsg=function(){return"Waiting for Server"};d.prototype.logOff=function(){CB.LOG(this.name+" - ConnectorLogOff:"+this.user+" "+this.loginMode,"LogBold");this.periodicPingTimer&&this.periodicPingTimer.stop();if(this.hasIdReceived&&this.isConnected()){var b=new CB.WebSockMessage(CB.SockMsgId.LOGOFF);b.address(this.conn.connectId,CB.ConnectId.SERVER);b.buf.Vx(0);this.send(b);this.loginMode=CB.LoginMode.GUEST}this.onLogOff()};
    d.prototype.onLogOff=function(){this.periodicPingTimer&&this.periodicPingTimer.stop();this.hasIdReceived=this.boundLoginOk=!1;this.userLoggedOff=!0};d.prototype.onChangeLogin=function(){};d.prototype.changeLogin=function(){V15.Vf&&V15.Vf.prepareLoginChange&&V15.Vf.prepareLoginChange();this.logOff(!0);window.location.replace(V15.getLoginUrl())};d.prototype.handleBinderTimeout=function(){this.logIntoChat("Sorry, cannot reach the "+this.name+"server. It is in maintenance. Please try again in 15 minutes.",
        "LogBold");this.conn.close();this.clearLoginCookies()};var c=new CB.Vr;d.prototype.pingServer=function(b,e,d){if(this.forcedLogOff)this.statusMsg(lm.PLEASE_LOGIN_SHORT);else if(this.conn&&this.conn.error&&!this.conn.isConnected()&&this.connect(),this.hasIdReceived||d)50<this.pingCount++||c.exec(function(){this.sendSimple(CB.SockMsgId.QUERY_SERVERALIVE);b||this.logIntoChat("Testing Connection to Server");this.pingStart=CB.getTick();this.pingTimer.isActive()||this.pingTimer.runOnce(e||6E3);this.silentServerPing=
        b;this.periodicPingTimer.runPeriodic(this.pingServerPeriodMS)}.bind(this),500)};d.prototype.onServerPingTimeout=function(){this.isSilent()||this.statusMsg(lm.RECONNECT);this.connect()};d.prototype.periodicPingHandler=function(){var b=this.conn.weAreAliveTicker.getExpiredMS();if(b>this.getMaxConnSilenceMS()&&(this.pingServer(!0,this.getConnTimeOutMS(),!0),b>this.getMaxConnSilenceMS()+this.periodicPingTimer.getTimeoutMs()))this.onServerNotAlive(b)};d.prototype.onServerNotAlive=function(b){};d.prototype.getConnTimeOutMS=
        function(){return 6E3};d.prototype.getMaxConnSilenceMS=function(){return 2E4};d.prototype.handleServerIsAlive=function(b){b=CB.getTick()-this.pingStart;this.nMyLagMS=b/2;if(!this.silentServerPing){this.logIntoChat("Ping="+b+"ms");if(V15.chessAudio)V15.chessAudio.onPing();this.isSilent()||this.statusMsg("Server OK")}if(this.onServerAlive)this.onServerAlive(b);this.pingTimer.stop();this.pingCount=0};d.prototype.handleAreYouAlive=function(){this.sendSimple(CB.SockMsgId.IAMALIVE)};d.prototype.pingPlayer=
        function(b){this.sendSimple(CB.SockMsgId.CLIENTPING,b);this.pingStart=CB.getTick()};d.prototype.pingPlayerByName=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.PING_BY_NAME);c.address(this.conn.connectId,CB.ConnectId.SERVER);c.buf.V5(b);this.send(c);this.pingStart=CB.getTick()};d.prototype.handleRespondPingByName=function(b){b.getBuf().V6(200);b.getBuf().readInt()};d.prototype.handleForceLogoff=function(b){this.conn.tryTimer.stop();var c="Possibly for maintenance.";switch(b.getBuf().V10()){case CB.Server.LogOffReason.ADMIN_ACTION:c=
        "Administrator action.";break;case CB.Server.LogOffReason.MAINTENANCE:c="Planned server maintenance in progress.";break;case CB.Server.LogOffReason.DOUBLE_LOGIN:c="Double Login.";break;case CB.Server.LogOffReason.IDLE_CLIENT:c="User inactive."}V15.config.silentServers||this.displayForceLogOffMsg(c);this.forcedLogOff=!0;this.onLogOff()};d.prototype.displayForceLogOffMsg=function(b){this.statusMsg("Server logged you off: "+b,"LogForceLogOff")};d.prototype.notifyUserActivity=function(){};d.prototype.getNId=
        function(){return this.conn.connectId};d.prototype.getNIdBound=function(){return void 0!==this.idBound?this.idBound:0};d.prototype.isGuest=function(){return this.client?this.client.isGuest():this.loginMode==CB.LoginMode.NORMAL&&this.hasIdReceived?!1:!0};d.prototype.isPremium=function(){return this.isGuest?!1:this.client.isPremium()};d.prototype.signalOnConnect=function(){};d.prototype.onConnect=function(){this.signalOnConnect();this.reconnectBaseTime=5E3;this.pingTimer.stop();this.loginMode!=CB.LoginMode.NORMAL||
    V15.forceGuestLogon()?this.logonGuest():this.logon()};d.prototype.idReceived=function(b){CB.LOG(this.name+" - idReceived: "+b.nId,"","conn");this.hasIdReceived=!0;this.Va=0;this.timerReconnect.stop();this.isFirstConn=!1;this.Vl=b.Vl;b.strToken&&!V15.Vf.loginToken&&(V15.Vf.loginToken=b.strToken,V15.Vf.rememberLoginToken());b.strUserId&&"guest"!=b.strUserId.toLowerCase()&&(this.user=CB.strUtil.decodeUTF8(b.strUserId),V15.Vf.userName=this.user,this.utf8User=b.strUserId,this.loginMode==CB.LoginMode.NORMAL&&
    CB.DOM.setCodedCookie("AccountBackName64",this.user));this.onIdReceived(b);if(V15.panelMgr.onLoggedIn)V15.panelMgr.onLoggedIn(this.loginMode==CB.LoginMode.NORMAL);this.bufferedMsgs.forEach(function(b){this.send(b)}.bind(this));this.bufferedMsgs=[]};d.prototype.onIdReceived=function(){};d.prototype.handleReceivedByConnector=function(b){var c=!0;switch(b.getType()){default:c=!1;break;case CB.SockMsgId.ALIVE:this.handleAreYouAlive(b);break;case CB.SockMsgId.BINDERTIMEOUT:this.handleBinderTimeout();break;
        case CB.SockMsgId.INVALID_PASSWORD:case CB.SockMsgId.INVALIDPASSWORD:this.handleInvalidPassword();break;case CB.SockMsgId.ACCOUNT_LOCKOUT:this.handleAccountLockout();break;case CB.SockMsgId.ALREADYLOGGEDON:this.onAlreadyLoggedOn();break;case CB.SockMsgId.LOGIN_OTHER_MACHINE:this.onLoginOtherMachine();break;case CB.SockMsgId.KICKEDOUT_OTHER_MACHINE:this.onKickedOutOtherMachine();break;case CB.SockMsgId.SERVER_IS_ALIVE:this.handleServerIsAlive(b);break;case CB.SockMsgId.CLIENTPING:this.handleClientPing(b);
            break;case CB.SockMsgId.CLIENTECHO:this.handleClientEcho(b);break;case CB.SockMsgId.RESPOND_PING_BY_NAME:this.handleRespondPingByName(b);break;case CB.SockMsgId.FORCE_LOGOFF:this.handleForceLogoff(b);break;case CB.SockMsgId.YOUR_LOGINTOKEN:this.handleLoginToken(b);case CB.SockMsgId.IDLE_CLIENT_LOGOFF:}return c};d.prototype.handleInvalidPassword=function(){this.statusMsg("Sorry, your account '"+this.user+"' or your password is not valid.","LogError");this.hasIdReceived=!1;this.clearLoginCookies();
        this.pingTimer.stop();this.periodicPingTimer.stop();if(this.onInvalidPassword)this.onInvalidPassword();else alert("Sorry, your password is not valid")};d.prototype.handleAccountLockout=function(){this.statusMsg("Sorry, your account is currently locked. Please wait one hour...","LogError");this.hasIdReceived=!1;this.clearLoginCookies();alert("Account currently locked.")};d.prototype.handleLoginToken=function(b){var c=b.getBuf().V10(),e=b.getBuf().V6(200);this.token=e;this.Vl=b.getBuf().V10();b=b.getBuf().V6(200);
        CB.LOG("nBoundId="+c+", token="+e+", account="+this.Vl,"LogBlue","conn");V15.Vf.loginToken=e;b&&(this.user=V15.Vf.userName=CB.strUtil.decodeUTF8(b),this.utf8User=b);V15.Vf.rememberLoginToken();CB.DOM.setCookie("AccountMode","1");if(this.onLoginToken)this.onLoginToken(e)};d.prototype.onAlreadyLoggedOn=function(){this.statusMsg("Already logged on: "+this.user+". Please log off or wait a few minutes.","LogBold");alert("Already logged on: "+this.user);CB.ToolButtons&&CB.ToolButtons.hideBusyMask()};d.prototype.onKickedOutOtherMachine=
        function(){CB.ToolButtons&&CB.ToolButtons.hideBusyMask()};d.prototype.onLoginOtherMachine=function(){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();this.timerReconnect.stop();this.periodicPingTimer.stop()};d.prototype.manageAccount=function(){this.hasIdReceived&&(this.logOff(),window.location.replace(V15.getManageAccountUrl()+"?user="+V15.Vf.userCoded+"&token="+V15.Vf.loginToken))};d.prototype.isSilent=function(){return!0};d.prototype.logIntoChat=function(b,c,e){this.isSilent()||(void 0===c&&(c="LogIntoChat"),
    V15.panelMgr.chatOut&&b&&V15.panelMgr.chatOut(b.toString(),c,e))};d.prototype.statusMsg=function(b,c,e){V15.panelMgr.statusMsg?V15.panelMgr.statusMsg(b):this.logIntoChat(b,c,e)};d.prototype.handleClientPing=function(b){this.sendSimple(CB.SockMsgId.CLIENTECHO,b.Vj())};d.prototype.handleClientEcho=function(b){var c=CB.getTick()-this.pingStart;this.logClientEcho&&this.logIntoChat("Ping "+this.lists.clientNameMap[b.Vj()]+"="+c+"ms");this.pingTimer.stop();this.fnOnClientEcho&&b.Vj()!=this.getNIdBound()&&
    this.fnOnClientEcho(b.Vj());return c};d.prototype.handleContinuousSelfEcho=function(b){};var e={};d.prototype.sendSimple=function(b,c){e=new CB.WebSockMessage(b);b=c;b||(b=CB.ConnectId.SERVER);e.address(this.getNId(),b);this.send(e)};d.prototype.send=function(b,c){if(!this.forcedLogOff&&!this.userLoggedOff)try{0==b.Vj()&&b.Vm(this.getNId()),0==b.getIdReceiver()&&b.setIdReceiver(CB.ConnectId.SERVER),this.conn.sendMessage(b,!this.hasSockMsgIds()),this.conn.error&&this.statusMsg(this.name+" not connected...",
        "LogCAPError"),this.conn.error&&c&&this.bufferedMsgs.push(b),this.conn.isConnected()||this.initiateReconnect()}catch(h){CB.LOG(h.toString()),this.initiateReconnect()}};d.prototype.sendNoId=function(b){try{0==b.Vj()&&b.Vm(this.getNId()),0==b.getIdReceiver()&&b.setIdReceiver(CB.ConnectId.SERVER),this.conn.sendMessage(b,!0),this.conn.isConnected()||this.initiateReconnect()}catch(g){CB.LOG(g.toString()),this.initiateReconnect()}};d.prototype.initiateReconnect=function(){if(!this.timerReconnect.isActive()&&
        !this.inTorture&&(CB.LOG(this.name+" initiate reconn."),this.timerReconnect.runOnce(Math.min(6E4,this.reconnectBaseTime+1E3*this.Va),function(){this.pingServer(!0)}.bind(this)),this.Va++,3==this.Va))this.onDisconnectAlarm()};d.prototype.onDisconnectAlarm=function(){};return d}();"use strict";
CB.CloudDatabase=function(){var d=function(b,c,e){this.cloudId=b;this.manager=this.cloudManager=e;this.nGames=c;this.resetCaches();this.idHeaderListener=this.cloudManager.addOnHeadersChangedListener(this.onHeadersChanged.bind(this));this.idGameListener=this.cloudManager.addOnGameChangedListener(this.onGameChanged.bind(this));this.idGameNosListener=this.cloudManager.addOnGamesChangedByGameNoListener(this.onChangedByGameNo.bind(this));this.idHeaderNosListener=this.cloudManager.addOnHeadersChangedByGameNoListener(this.onChangedByGameNo.bind(this));
    this.idGameAppendedListener=this.cloudManager.addOnGameAppendedListener(this.onGameAppended.bind(this));this.idChangeLoginListener=this.cloudManager.addOnChangeLoginListener(this.onChangeLogin.bind(this));this.idReorganizedListener=this.cloudManager.addOnReorganizedListener(this.onReorganized.bind(this));this.idDeletedListener=this.cloudManager.addOnDeletedListener(this.onDeleted.bind(this));this.dbItem=this.cloudManager.getCloudDBItem(this.cloudId);CB.LOG("Created: "+this,"LogGreen")};CB.inherit(d,
    CB.Database);d.prototype.destroy=function(){CB.LOG("Destroy: "+this,"LogRed");this.cloudManager.removeOnHeadersChangedListener(this.idHeaderListener);this.cloudManager.removeOnGameChangedListener(this.idGameListener);this.cloudManager.removeOnGamesChangedByGameNoListener(this.idGameNosListener);this.cloudManager.removeOnHeadersChangedByGameNoListener(this.idHeaderNosListener);this.cloudManager.removeOnGameAppendedListener(this.idGameAppendedListener);this.cloudManager.removeOnChangeLoginListener(this.idChangeLoginListener);
    this.cloudManager.removeOnReorganizedListener(this.idReorganizedListener);this.cloudManager.removeOnDeletedListener(this.idDeletedListener);this.requestedHeaderNums=[]};d.prototype.toString=function(){return this.dbItem.title+"/"+this.cloudId};d.prototype.isLoadFromFile=function(){return!1};d.prototype.canSaveTo=function(){return!0};d.prototype.shouldShowLastGame=function(){return this.dbItem&&this.dbItem.type==CB.CloudDBType.CLIPBOARD};d.prototype.setupListeners=function(b){void 0===b.idHeaderListener&&
(b.idHeaderListener=this.addOnGameHeadersChangedListener(b.onGameHeadersChanged.bind(b)));void 0===b.idDBLengthListener&&(b.idDBLengthListener=this.addOnDBLengthListener(b.onDBLengthListener.bind(b)));void 0===b.idDBDeletedListener&&(b.idDBDeletedListener=this.addOnDBDeletedListener(b.onDBDeletedListener.bind(b)));b.removeListeners=function(){this.removeOnGameHeadersChangedListener(b.idHeaderListener);this.removeOnDBLengthListener(b.idDBLengthListener);this.removeOnDBDeletedListener(b.idDBDeletedListener);
    delete b.idHeaderListener;delete b.idDBLengthListener;delete b.idDBDeletedListener}.bind(this)};d.prototype.resetCaches=function(){this.headers=[];this.requestedHeaderNums=[];this.pendingHeaderJobs=[];this.pendingGameJobs=[]};d.prototype.getGameCount=function(){return this.nGames};d.prototype.setSubSet=function(b){this.superClass.setSubSet.call(this,b);this.fireOnDBLength(this.getSetSize())};d.prototype.clearSubSet=function(){this.superClass.clearSubSet.call(this,arguments);this.fireOnDBLength(this.getGameCount())};
    d.prototype.getCopySrcId=function(){return this.cloudId};d.prototype.getDisplayTitle=function(){return"Cloud: "+CB.strUtil.decodeUTF8(this.dbItem.owner+" - "+this.dbItem.title)};d.prototype.getHeaderJson=function(b){if(1>b||b>this.nGames)ASSERT(0);else{if(void 0===this.headers[b]){this.requestedHeaderNums[b]||(this.requestedHeaderNums[b]=1,this.cloudManager.loadHeader(this.cloudId,b));var c=new CB.GameHeader;this.fillPlaceHolderHeader(c,b);c.nGame=b;this.headers[b]=c;void 0===this.headers[b].loadCnt?
        this.headers[b].loadCnt=0:this.headers[b].loadCnt++}else c=this.headers[b];return c.toJson()}};d.prototype.loadHeadersJsonAsync=function(b,c,e){e>this.getSetSize()&&(e=this.getSetSize());if(this.checkPendingHeaderJob(c,e))CB.LOG("Job already underway: "+c+"-"+e);else{CB.LOG("Cl-Load Hdrs Async: "+c+" - "+e);var d=this;b={first:c,last:e,jsons:[],callback:b,count:0,calls:1,complete:function(){return this.count==this.last-this.first+1},addHeader:function(b){var c=d.getSetInxOfGameNo(b.nGame);c>=this.first&&
        c<=this.last&&!this.jsons[c-this.first]&&(this.jsons[c-this.first]=b.toJson(),this.count++)},timeOut:function(){for(var b=0;b<this.last-this.first+1;b++)if(!this.jsons[b]){var c=new CB.GameHeader;d.fillPlaceHolderHeader(c,d.getGameNoInSet(b+1));this.jsons[b]=c.toJson()}try{for(b=0;b<this.calls;b++)this.callback(this.jsons)}catch(l){CB.LOG("JobTimeOutException: "+l,"LogException")}this.timeout=!0}};this.pendingHeaderJobs.push(b);b.timer=new CB.Timer(b.timeOut.bind(b));for(e<c?b.timer.runOnce(100):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b.timer.runOnce(1E4);c<=e&&c<=this.getSetSize();c++)if(b=this.getGameNoInSet(c)){if(!this.requestedHeaderNums[b]&&(this.requestedHeaderNums[b]=1,this.cloudManager.loadHeader(this.cloudId,b),void 0===this.headers[b])){var g=new CB.GameHeader;this.fillPlaceHolderHeader(g);g.nGame=b;this.headers[b]=g}this.headers[b].loadCnt=0}}};d.prototype.checkPendingHeaderJob=function(b,c){for(var e=0;e<this.pendingHeaderJobs.length;e++){var d=this.pendingHeaderJobs[e];if(d&&d.first<=b&&d.last>=c&&!d.timeout)return this.pendingHeaderJobs[e].calls++,
        !0}return!1};d.prototype.onHeadersChanged=function(b){for(var c=0;c<b.length;c++)b[c].header.loadCnt=void 0!==this.headers[b[c].nGame]?++this.headers[b[c].nGame].loadCnt:0,this.headers[b[c].nGame]=b[c].header,this.requestedHeaderNums[b[c].nGame]=0;for(var e=0;e<this.pendingHeaderJobs.length;e++)if(this.pendingHeaderJobs[e])for(c=0;c<b.length;c++)this.pendingHeaderJobs[e].addHeader(b[c].header);for(e=0;e<this.pendingHeaderJobs.length;e++)if(this.pendingHeaderJobs[e]&&this.pendingHeaderJobs[e].complete()){c=
        this.pendingHeaderJobs[e];CB.LOG("Complete Job: "+c.first+" - "+c.last);this.pendingHeaderJobs[e].timer.stop();try{for(var d=0;d<c.calls;d++)this.pendingHeaderJobs[e].callback(this.pendingHeaderJobs[e].jsons)}catch(g){CB.LOG("PendingJ: "+g,"LogException")}CB.LOG("Complete J after callback: "+c.first+" - "+c.last);delete this.pendingHeaderJobs[e]}c=!1;for(e=0;c&&e<this.pendingHeaderJobs.length;e++)this.pendingHeaderJobs[e]&&this.pendingHeaderJobs[e].timeout&&(c=!1);c&&(this.pendingHeaderJobs=[]);this.fireOnGameHeadersChanged(b)};
    d.prototype.fillPlaceHolderHeader=function(b,c){b.white=new CB.PlayerData("Waiting for Server...");b.loadCnt=0;b.nGame=c};d.prototype.getGame=function(b){return new CB.Game};d.prototype.loadGameAsync=function(b,c){if(!(c>this.getGameCount())){CB.LOG("Cloud Game: "+c);var e=this;b={gameNo:c,game:new CB.Game,callback:b,loaded:!1,setGame:function(b){b.getGameNo()==c&&(this.game=b,this.loaded=!0)},timeOut:function(){for(var b=0;b<this.last-this.first+1;b++)if(!this.jsons[b]){var c=new CB.GameHeader;e.fillPlaceHolderHeader(c);
            this.game.setHeader(c);this.loaded=!0}CB.LOG("Timeout Job: "+this.first+" - "+this.last);this.callback(this.game);this.timeout=!0}};b.timer=new CB.Timer(b.timeOut.bind(b));b.timer.runOnce(1E4);this.pendingGameJobs.push(b);this.cloudManager.loadGame(this.cloudId,c)}};d.prototype.onGameChanged=function(b){if(b.cloudId==this.cloudId){for(var c=0;c<this.pendingGameJobs.length;c++)this.pendingGameJobs[c]&&this.pendingGameJobs[c].setGame(b.game);for(c=0;c<this.pendingGameJobs.length;c++)this.pendingGameJobs[c]&&
    this.pendingGameJobs[c].loaded&&(CB.LOG("Complete Game Job"),this.pendingGameJobs[c].timer.stop(),this.pendingGameJobs[c].callback(this.pendingGameJobs[c].game),delete this.pendingGameJobs[c]);CB.LOG("...CloudDB OnGameChanged");this.reorgJobs(this.pendingGameJobs)}};d.prototype.onChangedByGameNo=function(b){if(b.cloudId==this.cloudId){for(var c=this.nGames,e=0;e<b.gameNos.length;e++)b.gameNos[e]>this.nGames&&(this.nGames=b.gameNos[e]);this.nGames>c&&this.clearSubSet();for(e=0;e<b.gameNos.length;e++)b.gameNos[e]<=
    this.nGames&&this.cloudManager.loadHeader(this.cloudId,b.gameNos[e])}};d.prototype.onGameAppended=function(b){b.cloudId==this.cloudId&&(this.nGames++,this.requestedHeaderNums=[],this.clearSubSet())};d.prototype.onChangeLogin=function(){this.fireOnDBDeleted()};d.prototype.onReorganized=function(b){b.cloudId==this.cloudId&&(this.nGames=b.nNewLen,this.requestedHeaderNums=[],0<this.filterText.length&&this.setFilter(this.filterText),this.fireOnDBLength(this.nGames))};d.prototype.onDeleted=function(b){b.cloudId==
    this.cloudId&&this.fireOnDBDeleted()};d.prototype.toggleDeleteMark=function(b){if(this.headers[b]){var c=!this.headers[b].deleted;this.headers[b].setDeleted(c);void 0===this.headers[b].loadCnt?this.headers[b].loadCnt=0:this.headers[b].loadCnt++;var e=new CB.Server.HeaderResponse(this.cloudId,b,0,this.headers[b]);this.fireOnGameHeadersChanged([e]);this.cloudManager.sendMarkAsDeleted(this.cloudId,[b],[c])}};d.prototype.toggleDeleteMarks=function(b){for(var c=[],e=[],d=0;d<b.length;d++){var g=b[d];if(this.headers[g]){var h=
        !this.headers[g].deleted;this.headers[g].setDeleted(h);void 0===this.headers[g].loadCnt?this.headers[g].loadCnt=0:this.headers[g].loadCnt++;var k=new CB.Server.HeaderResponse(this.cloudId,g,0,this.headers[g]);this.fireOnGameHeadersChanged([k]);c.push(g);e.push(h)}}this.cloudManager.sendMarkAsDeleted(this.cloudId,c,e)};d.prototype.removeDeletedGames=function(){this.resetCaches();this.cloudManager.reorgOnServer(this.cloudId)};d.prototype.reorgJobs=function(b){for(var c=!0,e=0;c&&e<b.length;e++)b[e]&&
    b[e].timeout&&(c=!1)};d.prototype.importGames=function(b,c){"number"==typeof b?this.cloudManager.copyGamesTo(b,this.cloudId,c):"function"==typeof b&&(b=b(c),this.cloudManager.saveGames(this.cloudId,b))};Ve.initForListeners(d);Ve.addEvent(d,"GameHeadersChanged");Ve.addEvent(d,"DBLength");Ve.addEvent(d,"DBDeleted");return d}();"use strict";CB.CloudDBType={NONE:0,REP_WHITE:1,REP_BLACK:2,OWN_GAMES:3,PLAYCHESS:4,TACTICTRAINING:5,OPENINGS_BACKUP:6,TRAININGPOSITIONS:7,AGAINSTFRITZ:8,CLIPBOARD:9};
CB.CloudDBItem=function(){var d=function(){this.propFlags.CLOUDDBITEM_ALLRIGHTS=this.propFlags.CLOUDDBITEM_MAY_VIEW|this.propFlags.CLOUDDBITEM_MAY_LOAD|this.propFlags.CLOUDDBITEM_MAY_SAVE|this.propFlags.CLOUDDBITEM_MAY_ADMIN|this.propFlags.CLOUDDBITEM_OWNER};d.prototype.propFlags={CLOUDDBITEM_SHARED:1,CLOUDDBITEM_MAY_VIEW:131072,CLOUDDBITEM_MAY_LOAD:262144,CLOUDDBITEM_MAY_SAVE:524288,CLOUDDBITEM_MAY_ADMIN:1048576,CLOUDDBITEM_OWNER:2097152};d.prototype.fromDataBuf=function(b){b.beginSizedRead();this.name=
    b.V6(100);this.title=b.V6(200);this.owner=b.V6(100);this.nGames=b.V10();this.dateAccessed=b.Vs();this.nUsage=b.V10();this.cloudId=b.readUint64();this.allFileSize=b.Vy();this.dateCreated=b.Vs();this.flags=b.V10();this.type=b.V10();b.endSizedRead()};d.prototype.toString=function(){return this.name+", "+this.title+", "+this.owner+", nGames="+this.nGames+", type="+this.type};d.DBNAME_EXISTS=-1;d.QUOTA_EXCEEDED=-2;d.TOO_MANY_DATABASES=-3;d.CREATE_DB_OK=0;d.TYPE_AGAINSTFRITZ=8;return d}();
CB.CloudDBItemList=function(){var d=function(){this.items=[]};d.prototype.size=function(){return this.items.length};d.prototype.fromDataBuf=function(b){this.items=[];for(var c=b.Vw(),e=0;e<c&&200>e;e++){var d=new CB.CloudDBItem;d.fromDataBuf(b);this.items.push(d)}};d.prototype.getById=function(b){for(var c=0;c<this.items.length;c++)if(this.items[c].cloudId==b)return this.items[c]};d.prototype.getIdByType=function(b){for(var c=0;c<this.items.length;c++)if(this.items[c].type==b)return this.items[c].cloudId;
    return 0};d.prototype.removeById=function(b){for(var c=0;c<this.items.length;c++)if(this.items[c].cloudId==b){this.items.splice(c,1);break}};d.prototype.containsName=function(b){for(var c=0;c<this.items.length;c++)if(this.items[c].name.toLowerCase()==b.toLowerCase())return!0;return!1};return d}();CB.CloudGame=function(){var d=function(b){this.game=b;this.time=new CB.DateAndTime(0)};d.prototype.Vz=function(b){this.game.hdr.compactToDataBuf(b);b.Vx(0);this.game.writeGameOnly2(b);this.time.Vz(b)};return d}();
"use strict";CB.namespace("CB.Server.HeaderRequest");
CB.Server.HeaderRequest=function(){var d=function(b,c,e){this.cloudId=b;this.nGame=c;this.dateAndTime=e};d.prototype.fromDataBuf=function(b){b.beginSizedRead();this.cloudId=b.Vw();b.Vw();this.nGame=b.V10();this.dateAndTime=new CB.DateAndTime;this.dateAndTime.fromDataBuf(b);b.endSizedRead()};d.prototype.Vz=function(b){b.beginSizedWrite();b.Vh(this.cloudId);b.Vh(0);b.Vx(this.nGame);void 0===this.dateAndTime&&(this.dateAndTime=new CB.DateAndTime(0));this.dateAndTime.Vz(b);b.endSizedWrite()};d.prototype.setEquals=
    function(b){return this.cloudId==b.cloudId&&this.nGame==b.nGame&&this.dateAndTime==b.dateAndTime};d.prototype.setGreater=function(b){return this.cloudId==b.cloudId?this.nGame==b.nGame?this.dateAndTime>b.dateAndTime:this.nGame>b.nGame:this.cloudId>b.cloudId};return d}();CB.Server.HeaderResponseType={HEADER:0,REQUEST_GAME:1,UPTODATE:2,NOT_AVAILABLE:3};
CB.Server.HeaderResponse=function(){var d=function(b,c,e,d){this.cloudId=b;this.nGame=c;this.eType=e;this.header=d};d.prototype.fromDataBuf=function(b){b.beginSizedRead();this.cloudId=b.V10();this.nGame=b.V10();this.eType=b.V10();switch(this.eType){case CB.Server.HeaderResponseType.HEADER:this.header=new CB.GameHeader,this.header.compactFromDataBuf(b),(new CB.DateAndTime).fromDataBuf(b)}b.endSizedRead()};return d}();"use strict";CB.namespace("CB.Server.CloudManager");
CB.CloudUserMsgId={NONE:0,REQUEST_DATABASES:1600,RESPOND_DATABASES:1601,REQUEST_MULTIPLE_HEADERS:1602,RESPOND_MULTIPLE_HEADERS:1603,CLIENTREQUEST_GAME:1604,SERVERRESPOND_GAME:1605,APPEND_GAME:1606,NOTIFY_HEADER_CHANGED:1607,NOTIFY_GAME_CHANGED:1608,NOTIFY_DB_REORGANIZED:1609,NOTIFY_DB_DELETED:1610,DISK_USED:1611,INC_USAGE:1612,CONFIRM_GAME:1613,RENAME_TITLE_TO_CLIENT:1614,CONFIRM_MULTIPLE_HEADERS:1615,CREATE_CLOUD_DB:1616,CLOUD_DB_CREATED:1617,DELETE_CLOUD_DB:1618,CLOUDDB_DELETE_FINISHED:1619,SET_DELETE_MARK:1620,
    REORG_CLOUD_DB:1621,CLOUDDB_REORG_FINISHED:1622,COPY_GAMES_TO:1623,NOTIFY_COPY_DONE:1624,COPY_GAMES_FINISHED:1625,SEARCH_GAMES:1626,SEARCH_RESULT:1627,GAMES_TO_SERVER:1628,CONFIRM_GAMES_TO_SERVER:1629,STORE_POS_AND_MOVES:1630,CHECK_POS_AND_MOVES:1631,RESPOND_POS_AND_MOVES:1632,REMOVE_FROM_MYMOVES:1633,LOAD_MY_MOVES:1634,RESPOND_ALL_MYMOVES:1635,REMOVE_WHOLE_TREE:1636,RESPOND_TREE_REMOVED:1637,MAKE_MAIN_MOVEORDER:1638,STORE_EVAL:1639,UPLOAD_GAME:1640,STORE_TEXT:1641,NOTIFY_PLAYED:1642,START_DRILL:1643,
    UNLEARN_WHOLE_TREE:1644,RESPOND_TREE_UNLEARNED:1645,RESPOND_COUNT_MYMOVES:1647,NOTIFY_MYMOVES_CHANGED:1648,STOP_DRILL:1649,SAVE_TO_CLIPBOARD:1650,SERVER_REQUESTGAME:1656,toString:function(d){for(var b in this)if(this[b]==d)return b;return"Unknown CloudUserMsgId: "+d},toNumString:function(d){return"CloudId="+d}};CB.PosAndMoveFlags={MY_BLACK:1,MY_WHITE:2,MOVE_WHITE:4,MOVE_BLACK:8,REP_IMPORTANT:16,REP_EXCLUDE:32,WITH_TEXT:64,DRILLED:128,DELETED:256,WHITE:6,BLACK:9,MOVE:12,MYMOVE:3};
CB.Server.CloudManager=function(){var d=function(){this.setRequestedHeaders=new CB.Set;this.timerSend=new CB.Timer;this.selectedCloudId=0;this.mapDBs={};this.headerResponseReceiver=new CB.VectorSender(function(b){this.send(b)}.bind(this));this.gameSender=new CB.VectorSender(function(b){this.send(b)}.bind(this));this.autoOpenDB=!1;this.lastMyMovesLoadMode=this.myMovesLoadMode=CB.GetMovesType.NONE;this.name="cloud"};CB.inherit(d,CB.Server.Connector);d.prototype.createLobby=function(b,e,d,g,h){this.create(b,
    e,d,g,h)};d.prototype.getName=function(){return"CloudMgr"};d.prototype.onChangeLogin=function(){this.fireOnChangeLogin();this.closeAllDatabases();V15.setLoggedIn(this.isLoggedIn())};d.prototype.onLoginToken=function(){this.logIntoChat("Connected to CloudServer","","conn");this.boundLoginOk=!0;V15.shouldRequestCloudDBsOnLogin()?this.requestDatabases():CB.ToolButtons&&CB.ToolButtons.hideBusyMask();this.loginMode!=CB.LoginMode.GUEST&&(V15.setLoggedIn(!0),V15.panelMgr.getKernel()&&this.checkPosAndMoves(V15.panelMgr.getKernel().getCurPos()),
V15.config.silentCloud||V15.panelMgr.showMessage(String.formatEx(lm.LOGIN_WELCOME,this.user),2E3));V15.showAccountType(this.Vl);V15.panelMgr.study&&0==V15.panelMgr.savedStudyToCloud&&(V15.panelMgr.gameKernel.Vk.saveToCloud(V15.panelMgr.study),V15.panelMgr.savedStudyToCloud=!0)};d.prototype.onIdReceived=function(){!V15.config.silentCloud&&CB.ToolButtons&&CB.ToolButtons.showBusyMask("Requesting databases ... ",null,5E3)};d.prototype.onLogOff=function(){this.superClass.onLogOff.apply(this,arguments)};
    d.prototype.logIntoChat=function(b,e,d){5};d.prototype.testYesNo=function(b){CB.LOG("YesNo="+b)};d.prototype.test=function(){};d.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b))try{switch(b.getType()){default:TRACE("Unhandled: "+b.toString());break;case CB.SockMsgId.DEFAULTGROUPS:this.logIntoChat("Connected to CloudServer");this.boundLoginOk=!0;alert("Default Groups not expected...");break;case CB.SockMsgId.CLOUD_USER:this.handleCloudMsg(b);break;case CB.SockMsgId.INVALIDPASSWORD:this.clearLoginCookies()}}catch(e){b=
        CB.SockMsgId.toNumString(b.getType()),CB.LogException(b,e)}};d.prototype.handleChat=function(b){V15.panelMgr.chatOut(chat.toString())};d.prototype.isLoggedIn=function(){return this.boundLoginOk&&this.isConnected()};d.prototype.handleCloudMsg=function(b){try{switch(b.getUserType()){default:TRACE("Unhandled Cloud Msg: "+b.toString());break;case CB.CloudUserMsgId.RESPOND_DATABASES:this.handleRespondDatabases(b);break;case CB.CloudUserMsgId.RESPOND_MULTIPLE_HEADERS:this.handleRespondMultipleHeaders(b);
        break;case CB.CloudUserMsgId.SERVERRESPOND_GAME:this.handleServerRespondGame(b);break;case CB.CloudUserMsgId.NOTIFY_GAME_CHANGED:this.handleGamesChanged(b);break;case CB.CloudUserMsgId.NOTIFY_HEADER_CHANGED:this.handleHeaderChanged(b);break;case CB.CloudUserMsgId.NOTIFY_DB_REORGANIZED:case CB.CloudUserMsgId.NOTIFY_COPY_DONE:this.handleNotifyDBReorganized(b);break;case CB.CloudUserMsgId.COPY_GAMES_FINISHED:this.handleCopyGamesFinished(b);break;case CB.CloudUserMsgId.NOTIFY_DB_DELETED:this.handleDBDeleted(b);
        break;case CB.CloudUserMsgId.DISK_USED:this.handleDiskUsed(b);break;case CB.CloudUserMsgId.CONFIRM_GAME:break;case CB.CloudUserMsgId.CONFIRM_GAMES_TO_SERVER:this.handleConfirmGamesToServer(b);break;case CB.CloudUserMsgId.RENAME_TITLE_TO_CLIENT:this.handleRenameTitle(b);break;case CB.CloudUserMsgId.CLOUD_DB_CREATED:this.handleDBCreated(b);break;case CB.CloudUserMsgId.CLOUDDB_DELETE_FINISHED:this.deletionFinished(b);break;case CB.CloudUserMsgId.CLOUDDB_REORG_FINISHED:this.reorgFinished(b);break;case CB.CloudUserMsgId.SEARCH_RESULT:this.searchResult(b);
        break;case CB.CloudUserMsgId.RESPOND_POS_AND_MOVES:this.respondPosAndMoves(b);break;case CB.CloudUserMsgId.RESPOND_ALL_MYMOVES:this.respondAllMyMoves(b);break;case CB.CloudUserMsgId.RESPOND_TREE_REMOVED:this.respondTreeRemoved(b);break;case CB.CloudUserMsgId.RESPOND_TREE_UNLEARNED:this.respondTreeUnlearned(b);break;case CB.CloudUserMsgId.RESPOND_COUNT_MYMOVES:this.respondCountMyMoves(b);break;case CB.CloudUserMsgId.NOTIFY_MYMOVES_CHANGED:this.notifyMyMovesChanged(b);case CB.CloudUserMsgId.SERVER_REQUESTGAME:}}catch(e){b=
        CB.CloudUserMsgId.toNumString(b.getUserType()),CB.LogException(b,e)}};d.prototype.handleReconnectOk=function(b){};d.prototype.requestDatabases=function(){var b=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);b.setUserType(CB.CloudUserMsgId.REQUEST_DATABASES);var e=this.user;this.loginMode==CB.LoginMode.GUEST&&(e="Guest");b.getBuf().V5(e);b.getBuf().Vx(CB.System.getWindowsCodePage());this.send(b)};d.prototype.handleRespondDatabases=function(b){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();this.cloudDBItemList=
        new CB.CloudDBItemList;this.cloudDBItemList.fromDataBuf(b.getBuf());var c=b.getBuf().Vw(),d=b.getBuf().Vw(),g=b.getBuf().Vw(),h=b.getBuf().Vw();b.getBuf().Vw();this.logIntoChat("Received Databases... qKB="+c+", siz= "+d+", maxDB="+g+", lastDBId="+h);V15.config.silentCloud||(0!=h&&this.autoOpenDB?this.cloudDatabaseSelected(h,!0):V15.panelMgr.openDatabasePanel&&V15.panelMgr.selectCloudDatabase(this.user,this.cloudDBItemList,this.cloudDatabaseSelected.bind(this)));this.autoOpenDB=!1};d.prototype.getCloudDBItem=
        function(b){return this.cloudDBItemList.getById(b)};d.prototype.cloudDatabaseSelected=function(b,e){if(0<=b){this.selectedCloudId&&this.endUse(this.selectedCloudId);var c=this.cloudDBItemList.getById(b);if(c){var d=this.openCloudDatabase(c);V15.panelMgr.showDatabase(d);if(e&&("Clipboard"==c.name||"CloudClip"==c.name)&&V15.panelMgr.gameKernel)V15.panelMgr.gameKernel.onDBGameClicked(d,d.nGames);this.callAfterDBSelected&&((new CB.Timer(this.callAfterDBSelected)).runOnce(100),this.callAfterDBSelected=
        null)}this.selectedCloudId=b;this.incDBUsage(b)}else this.selectedCloudId=0};d.prototype.setCallAfterDBSelected=function(b){this.callAfterDBSelected=b};d.prototype.openCloudDatabaseById=function(b){if(b=this.cloudDBItemList.getById(b))return this.openCloudDatabase(b)};d.prototype.openCloudDatabase=function(b){if(void 0!==this.mapDBs[b.cloudId])return this.beginUse(this.mapDBs[b.cloudId]),this.mapDBs[b.cloudId];b=new CB.CloudDatabase(b.cloudId,b.nGames,this);this.beginUse(b);return b};d.prototype.beginUse=
        function(b){void 0==this.mapDBs[b.cloudId]&&(this.mapDBs[b.cloudId]=b);this.mapDBs[b.cloudId].incUsers()};d.prototype.endUse=function(b){"object"===typeof b?b=b.cloudId:ASSERT("number"===typeof b);void 0!==this.mapDBs[b]&&(this.mapDBs[b].decUsers(),0>=this.mapDBs[b].getNUsers()&&(this.mapDBs[b].destroy(),delete this.mapDBs[b]))};d.prototype.closeAllDatabases=function(){for(var b in this.mapDBs)this.mapDBs.hasOwnProperty(b)&&(this.mapDBs[b].destroy(),delete this.mapDBs[b])};d.prototype.incDBUsage=
        function(b){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(CB.CloudUserMsgId.INC_USAGE);c.getBuf().Vh(b);c.getBuf().Vh(0);this.send(c)};d.prototype.createDatabase=function(b){if(this.cloudDBItemList.containsName(b))alert(b+" exists.");else if(!this.isGuest()){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(CB.CloudUserMsgId.CREATE_CLOUD_DB);c.getBuf().V5(b);c.getBuf().Vx(CB.System.getWindowsCodePage());V15.Vf.guid.Vz(c.getBuf());this.send(c)}};d.prototype.handleDBCreated=
        function(b){var c=b.getBuf().V10();b.getBuf().Vw();b.getBuf().Vw();b.getBuf().V6(100);switch(c){case CB.CloudDBItem.DBNAME_EXISTS:alert("Name Exists");break;case CB.CloudDBItem.QUOTA_EXCEEDED:alert("Disk Space insufficient");break;case CB.CloudDBItem.TOO_MANY_DATABASES:alert("Too many databases ");break;case CB.CloudDBItem.CREATE_DB_OK:this.requestDatabases()}};d.prototype.deleteDatabase=function(){V15.panelMgr.selectCloudDatabase(this.user,this.cloudDBItemList,this.dbSelectedForDelete.bind(this))};
    d.prototype.dbSelectedForDelete=function(b){if(b&&CB.Forms){var c=this.getCloudDBItem(b);if(c){var d="<strong>"+CB.strUtil.decodeUTF8(c.title)+"</strong>";d+="</br></br>"+c.nGames+" games";d+="</br></br> Owner="+CB.strUtil.decodeUTF8(c.owner);CB.Forms.Confirm("Please confirm deletion of this database:",d,function(c){if("yes"==c||"ok"==c)c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER),c.setUserType(CB.CloudUserMsgId.DELETE_CLOUD_DB),c.getBuf().Vh(b),c.getBuf().Vh(0),this.send(c),this.bQuotaExceeded=
        !1,this.fireOnDeleted({cloudId:b}),this.endUse(b),this.selectedCloudId==b&&(this.selectedCloudId=0)}.bind(this))}}};d.prototype.deletionFinished=function(b){var c=b.getBuf().Vw();b.getBuf().Vw();b.getBuf().V6(100);this.cloudDBItemList.removeById(c)};d.prototype.handleRespondMultipleHeaders=function(b){b=this.headerResponseReceiver.receiveVector(b,CB.SockMsgId.CLOUD_USER,CB.CloudUserMsgId.CONFIRM_MULTIPLE_HEADERS,function(b){var c=new CB.Server.HeaderResponse;c.fromDataBuf(b);return c});b.overhead.V14();
        this.logIntoChat("Received Multiple Headers: "+b.vec.length);for(var c=[],d=0;d<b.vec.length&&1E3>d;d++){var g=b.vec[d];switch(g.eType){default:throw"URTyp";case CB.Server.HeaderResponseType.HEADER:c.push(g);case CB.Server.HeaderResponseType.UPTODATE:case CB.Server.HeaderResponseType.REQUEST_GAME:case CB.Server.HeaderResponseTyp_AVAILABLE:}}c.length&&this.fireOnHeadersChanged(c)};d.prototype.loadHeader=function(b,e,d){void 0==e&&alert("nGame");this.setRequestedHeaders.insert(new CB.Server.HeaderRequest(b,
        e,d));40<this.setRequestedHeaders.size()?this.sendHeaderRequests():this.timerSend.runOnce(500,this.sendHeaderRequests.bind(this))};d.prototype.sendHeaderRequests=function(){var b=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);b.setUserType(CB.CloudUserMsgId.REQUEST_MULTIPLE_HEADERS);b.getBuf().Vx(this.setRequestedHeaders.size());for(var e=0;e<this.setRequestedHeaders.size()&&100>e;e++)this.setRequestedHeaders.getElements()[e].Vz(b.getBuf());this.send(b);this.setRequestedHeaders.clear()};d.prototype.loadGame=
        function(b,e,d){d=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);d.setUserType(CB.CloudUserMsgId.CLIENTREQUEST_GAME);d.getBuf().Vh(b);d.getBuf().Vh(0);d.getBuf().Vx(e);(new CB.DateAndTime(0)).Vz(d.getBuf());this.send(d)};d.prototype.handleServerRespondGame=function(b){var c=b.getBuf().Vw();b.getBuf().Vw();var d=b.getBuf().V10();b=this.gameFromBuf(b.getBuf());b.replaceDBId=c;b.replaceGameNo=d;this.fireOnGameChanged({cloudId:c,game:b})};d.prototype.handleGamesChanged=function(b){var c=b.getBuf().Vw();
        b.getBuf().Vw();for(var d=b.getBuf().V10(),g=[],h=0;h<d&&1E3>h;h++){var k=b.getBuf().V10();g.push(k)}this.fireOnGamesChangedByGameNo({cloudId:c,gameNos:g})};d.prototype.handleHeaderChanged=function(b){var c=b.getBuf().Vw();b.getBuf().Vw();for(var d=[],g=b.getBuf().V10(),h=0;h<g&&100>h;h++)d.push(b.getBuf().V10());this.fireOnHeadersChangedByGameNo({cloudId:c,gameNos:d})};d.prototype.handleNotifyDBReorganized=function(b){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();var c=b.getBuf().Vw();b.getBuf().Vw();
        if(b.getBuf().V10()){b=b.getBuf().V10();var d=this.cloudDBItemList.getById(c);d&&(d.nGames=b);this.fireOnReorganized({cloudId:c,nNewLen:b})}};d.prototype.handleCopyGamesFinished=function(b){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();var c=b.getBuf().Vw();b.getBuf().Vw();b.getBuf().V6(100);b=b.getBuf().V10();this.callAfterDBSelected=null;var d=this.cloudDBItemList.getById(c);d&&(d.nGames=b);this.fireOnReorganized({cloudId:c,nNewLen:b})};d.prototype.handleDBDeleted=function(b){var c=b.getBuf().Vw();
        b.getBuf().Vw();this.fireOnDeleted({cloudId:c});this.endUse(c)};d.prototype.sendMarkAsDeleted=function(b,e,d){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(CB.CloudUserMsgId.SET_DELETE_MARK);c.getBuf().Vh(b);c.getBuf().Vh(0);c.getBuf().Vx(e.length);for(b=0;b<e.length;b++)c.getBuf().Vx(e[b]),c.getBuf().V13(d[b]);V15.Vf.guid.Vz(c.getBuf());(new CB.DateAndTime(0)).Vz(c.getBuf());this.send(c)};d.prototype.reorgOnServer=function(b){if(!this.isGuest()){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);
        c.setUserType(CB.CloudUserMsgId.REORG_CLOUD_DB);c.getBuf().Vh(b);c.getBuf().Vh(0);V15.Vf.guid.Vz(c.getBuf());this.send(c);(b=this.cloudDBItemList.getById(b))&&CB.ToolButtons&&CB.ToolButtons.showBusyMask("Cleaning Up "+b.name,null,2E4)}};d.prototype.reorgFinished=function(b){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();var c=b.getBuf().Vw();b.getBuf().Vw();b.getBuf().V6(100);b=b.getBuf().V10();this.callAfterDBSelected=null;var d=this.cloudDBItemList.getById(c);d&&(d.nGames=b);this.fireOnReorganized({cloudId:c,
        nNewLen:b})};d.prototype.copyGamesTo=function(b,e,d){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(CB.CloudUserMsgId.COPY_GAMES_TO);c.getBuf().Vh(b);c.getBuf().Vh(0);c.getBuf().Vh(e);c.getBuf().Vh(0);V15.Vf.guid.Vz(c.getBuf());c.getBuf().Vx(d.length);for(b=0;b<d.length;b++)c.getBuf().Vx(d[b]);this.send(c);CB.ToolButtons&&CB.ToolButtons.showBusyMask("Copying games ... ",null,2E4)};d.prototype.requestFilterSet=function(b,e){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(CB.CloudUserMsgId.SEARCH_GAMES);
        c.getBuf().Vh(b);c.getBuf().Vh(0);c.getBuf().Vn(e);V15.Vf.guid.Vz(c.getBuf());this.send(c);CB.ToolButtons&&CB.ToolButtons.showBusyMask("Searching on Server ... ",null,2E4)};d.prototype.searchResult=function(b){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();var c=b.getBuf().Vw();b.getBuf().Vw();for(var d=b.getBuf().V10(),g=[],h=0;h<d&&1E4>h;h++){var k=b.getBuf().V10();g.push(k)}(b=this.cloudDBItemList.getById(c))&&this.openCloudDatabase(b).setSubSet(g)};d.prototype.handleDiskUsed=function(b){b.getBuf().Vw();
        b.getBuf().Vw()};d.prototype.handleRenameTitle=function(b){b.getBuf().Vw();b.getBuf().Vw();this.requestDatabases()};d.prototype.gameFromBuf=function(b){var c=new CB.Game,d=new CB.GameHeader;d.compactFromDataBuf(b);b.V10();c.readGameOnly2(b);c.setHeader(d);return c};d.prototype.gameToBuf=function(b,e){e.hdr.compactToDataBuf(b);b.Vx(0);e.writeGameOnly2(b);return e};d.prototype.saveGame=function(b,e){if(this.selectedCloudId){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(CB.CloudUserMsgId.APPEND_GAME);
        c.getBuf().Vh(this.selectedCloudId);c.getBuf().Vh(0);void 0!==e?c.getBuf().Vx(e):c.getBuf().Vx(0);V15.Vf.guid.Vz(c.getBuf());(new CB.DateAndTime(0)).Vz(c.getBuf());this.gameToBuf(c.getBuf(),b);if(void 0===e){var d=this.openCloudDatabaseById(this.selectedCloudId);d&&(b.replaceDBId=this.selectedCloudId,b.replaceGameNo=d.getGameCount()+1)}this.send(c);void 0!==e?this.fireOnGamesChangedByGameNo({cloudId:this.selectedCloudId,gameNos:[e]}):this.fireOnGameAppended({cloudId:this.selectedCloudId})}};d.prototype.replaceGame=
        function(b){this.canReplaceGame(b)?this.saveGame(b,b.replaceGameNo):this.saveGame(b)};d.prototype.canReplaceGame=function(b){return b.replaceDBId&&b.replaceDBId==this.selectedCloudId&&0<b.replaceGameNo};d.prototype.saveGames=function(b,e){for(var c=[],d=0;d<e.length;d++)c.push(new CB.CloudGame(e[d]));d=new CB.DataBuffer;d.writeFakeInt64(b);V15.Vf.guid.Vz(d);e.length&&(CB.ToolButtons&&CB.ToolButtons.showBusyMask("Saving Games ... ",null,1E3),this.gameSender.sendVector(this.getNId(),CB.ConnectId.SERVER,
        c,2E4,CB.SockMsgId.CLOUD_USER,CB.CloudUserMsgId.GAMES_TO_SERVER,d,function(b,c){c.Vz(b)}))};var b=new CB.Vr;d.prototype.handleConfirmGamesToServer=function(c){c=this.gameSender.handleConfirmBunch(c);var e=this.cloudDBItemList.getById(this.selectedCloudId);e&&(e.nGames+=c,b.exec(function(){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();this.fireOnReorganized({cloudId:this.selectedCloudId,nNewLen:e.nGames})}.bind(this),2E3))};d.prototype.storePosAndMoves=function(b,e){var c=this.createMsg(CB.CloudUserMsgId.STORE_POS_AND_MOVES);
        this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(e);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.storeEval=function(b,e){var c=this.createMsg(CB.CloudUserMsgId.STORE_EVAL);this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(e);b=CB.PosAndMoveFlags.MOVE_WHITE;this.isMovesLoadedFor(!0)&&(b=CB.PosAndMoveFlags.MOVE_BLACK);c.getBuf().Vx(b);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.storeText=function(b,e){var c=this.createMsg(CB.CloudUserMsgId.STORE_TEXT);this.gameToBuf(c.getBuf(),
        b);c.getBuf().V5(CB.strUtil.encodeUTF8(e));b=CB.PosAndMoveFlags.MOVE_WHITE;this.isMovesLoadedFor(!0)&&(b=CB.PosAndMoveFlags.MOVE_BLACK);c.getBuf().Vx(b);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.notifyPlayed=function(b,e,d){var c=this.createMsg(CB.CloudUserMsgId.NOTIFY_PLAYED);b.write(c.getBuf());e.write2(c.getBuf());c.getBuf().V13(d);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.uploadToMyMoves=function(b){var c=this.createMsg(CB.CloudUserMsgId.UPLOAD_GAME);
        this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.makeMainMoveOrder=function(b){var c=this.createMsg(CB.CloudUserMsgId.MAKE_MAIN_MOVEORDER);this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.removeFromMyMoves=function(b,e){var c=this.createMsg(CB.CloudUserMsgId.REMOVE_FROM_MYMOVES);b.write(c.getBuf());delete e.annos;(new CB.Move(e.from,e.to,e.prom)).write2(c.getBuf());c.getBuf().Vx(CB.System.getWindowsCodePage());
        this.send(c)};d.prototype.removeWholeTree=function(b,e,d){var c=this.createMsg(CB.CloudUserMsgId.REMOVE_WHOLE_TREE);b.write(c.getBuf());e.write2(c.getBuf());c.getBuf().Vx(d);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.respondTreeRemoved=function(b){var c=b.getBuf().Vw();b.getBuf().V10();CB.LOG("Removed: "+c+" moves.","LogBold");this.reloadMyMoves();V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.FORCE_UPDATE);1<c&&V15.panelMgr.showMessage(c+" "+lm.MOVES_UNMARKED,4E3)};
    d.prototype.respondTreeUnlearned=function(b){var c=b.getBuf().Vw();b.getBuf().V10();V15.panelMgr.showMessage(c+" "+lm.MOVES_UNLEARNED,4E3)};d.prototype.unlearnWholeTree=function(b,e,d){var c=this.createMsg(CB.CloudUserMsgId.UNLEARN_WHOLE_TREE);b.write(c.getBuf());e.write2(c.getBuf());c.getBuf().Vx(d);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.respondCountMyMoves=function(b){};d.prototype.checkPosAndMoves=function(b,e,d){var c=this.createMsg(CB.CloudUserMsgId.CHECK_POS_AND_MOVES);
        b.write(c.getBuf());c.getBuf().V13(e?!0:!1);c.getBuf().writeInt(d||0);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c,!0)};d.prototype.respondPosAndMoves=function(b){var c=new CB.Position;c.read(b.getBuf());for(var d=b.getBuf().V10(),g=[],h=[],k=0;k<d&&200>k;k++){var l=new CB.Move;l.read2(b.getBuf());h=b.getBuf().Vw();var m=b.getBuf().V10(),p=b.getBuf().readUint8(),r=b.getBuf().V6(300),t=b.getBuf().readUint8(),w=b.getBuf().Vu(),q=b.getBuf().readUint8();g.push({move:l,visits:h,flags:m,eval:p,
        correct:t,txt:r,date:w,learnPercent:q})}d={count:0,total:0,drilled:0,learned:0,quote:0,toString:function(){return"Stats: cnt="+this.count+", total="+this.total+", drilled="+this.drilled+", learned="+this.learned},getPercent:function(){return this.total?Math.round(100*this.quote/this.total):0}};d.count=b.getBuf().Vw();d.total=b.getBuf().Vw();d.drilled=b.getBuf().Vw();d.learned=b.getBuf().Vw();d.quote=b.getBuf().readFloat64();this.fireOnMyMoves({position:c,moves:g,stats:d})};d.prototype.loadMyMoves=
        function(b,e){this.lastLoadMyMovesStartGame=e;V15.panelMgr.blockLiveBookUpdates&&V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.BLOCKED);var c=this.createMsg(CB.CloudUserMsgId.LOAD_MY_MOVES);c.getBuf().Vx(b);this.gameToBuf(c.getBuf(),e);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.reloadMyMoves=function(){this.lastLoadMyMovesStartGame||(this.lastLoadMyMovesStartGame=new CB.Game);this.loadMyMoves(this.lastMyMovesLoadMode,this.lastLoadMyMovesStartGame)};d.prototype.respondAllMyMoves=
        function(b){var c=this.gameFromBuf(b.getBuf()),d=b.getBuf().Vw();5;b=b.getBuf().V10();switch(b){case CB.GetMovesType.ALL:var g="Both Colors";break;case CB.GetMovesType.WHITE:g="White";break;case CB.GetMovesType.BLACK:g="Black"}c.hdr.white=new CB.PlayerData("","My Moves");c.hdr.black=new CB.PlayerData("",g);0==d?(c="No Marked Moves Found.",b!=CB.GetMovesType.ALL&&(c=g+" - "+c),V15.panelMgr.showMessage(c,5E3),V15.panelMgr.shakeMarkButton(),c=new CB.Game):V15.panelMgr.stopShakeMarkButton();V15.panelMgr.loadGame(c);
            V15.panelMgr.setLayoutMyMoves(!0,b==CB.GetMovesType.BLACK);this.lastMyMovesLoadMode=this.myMovesLoadMode=b;V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.NOT_BLOCKED)};d.prototype.notifyMyMovesChanged=function(b){V15.notifyMyMovesChanged()};d.prototype.startDrill=function(b,e){var c=this.createMsg(CB.CloudUserMsgId.START_DRILL);b.write(c.getBuf());c.getBuf().Vx(e);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.stopDrill=function(){var b=this.createMsg(CB.CloudUserMsgId.STOP_DRILL);
        b.getBuf().Vx(CB.System.getWindowsCodePage());this.send(b)};d.prototype.saveGameToClipboard=function(b){if(!(3>b.getMainLine().length&&b.isNormalInit())){var c=this.createMsg(CB.CloudUserMsgId.SAVE_TO_CLIPBOARD);this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)}};d.prototype.createMsg=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(b);b=this.user;this.loginMode==CB.LoginMode.GUEST&&(b="Guest");c.getBuf().V5(CB.strUtil.encodeUTF8(b));
        return c};d.prototype.onResetGame=function(){this.myMovesLoadMode=-1};d.prototype.isMovesLoadedForAny=function(){return 0<=this.myMovesLoadMode};d.prototype.isMovesLoadedFor=function(b){switch(this.myMovesLoadMode){default:return!1;case CB.GetMovesType.ALL:return!0;case CB.GetMovesType.BLACK:return b;case CB.GetMovesType.WHITE:return!b}};d.prototype.displayForceLogOffMsg=function(b){var c=V15.panelMgr.getKernel();c&&c.boardWin&&!V15.config.silentCloud&&c.boardWin.addMessage("Server logged you off: "+
        b,!0)};Ve.initForListeners(d);Ve.addEvent(d,"HeadersChanged");Ve.addEvent(d,"HeadersChangedByGameNo");Ve.addEvent(d,"GameChanged");Ve.addEvent(d,"GamesChangedByGameNo");Ve.addEvent(d,"GameAppended");Ve.addEvent(d,"ChangeLogin");Ve.addEvent(d,"Reorganized");Ve.addEvent(d,"Deleted");Ve.addEvent(d,"MyMoves");return d}();"use strict";CB.namespace("CB.Server.MyMovesManager");
CB.CloudUserMsgId={NONE:0,REQUEST_DATABASES:1600,RESPOND_DATABASES:1601,REQUEST_MULTIPLE_HEADERS:1602,RESPOND_MULTIPLE_HEADERS:1603,CLIENTREQUEST_GAME:1604,SERVERRESPOND_GAME:1605,APPEND_GAME:1606,NOTIFY_HEADER_CHANGED:1607,NOTIFY_GAME_CHANGED:1608,NOTIFY_DB_REORGANIZED:1609,NOTIFY_DB_DELETED:1610,DISK_USED:1611,INC_USAGE:1612,CONFIRM_GAME:1613,RENAME_TITLE_TO_CLIENT:1614,CONFIRM_MULTIPLE_HEADERS:1615,CREATE_CLOUD_DB:1616,CLOUD_DB_CREATED:1617,DELETE_CLOUD_DB:1618,CLOUDDB_DELETE_FINISHED:1619,SET_DELETE_MARK:1620,
    REORG_CLOUD_DB:1621,CLOUDDB_REORG_FINISHED:1622,COPY_GAMES_TO:1623,NOTIFY_COPY_DONE:1624,COPY_GAMES_FINISHED:1625,SEARCH_GAMES:1626,SEARCH_RESULT:1627,GAMES_TO_SERVER:1628,CONFIRM_GAMES_TO_SERVER:1629,STORE_POS_AND_MOVES:1630,CHECK_POS_AND_MOVES:1631,RESPOND_POS_AND_MOVES:1632,REMOVE_FROM_MYMOVES:1633,LOAD_MY_MOVES:1634,RESPOND_ALL_MYMOVES:1635,REMOVE_WHOLE_TREE:1636,RESPOND_TREE_REMOVED:1637,MAKE_MAIN_MOVEORDER:1638,STORE_EVAL:1639,UPLOAD_GAME:1640,STORE_TEXT:1641,NOTIFY_PLAYED:1642,START_DRILL:1643,
    UNLEARN_WHOLE_TREE:1644,RESPOND_TREE_UNLEARNED:1645,RESPOND_COUNT_MYMOVES:1647,NOTIFY_MYMOVES_CHANGED:1648,STOP_DRILL:1649,SAVE_TO_CLIPBOARD:1650,LOAD_ALL_MYMOVES_EX:1651,COUNT_MYMOVES_EX:1652,CHECK_POS_AND_MOVES_EX:1653,REQUEST_REPERTOIRELIST:1654,RESPOND_REPERTOIRELIST:1655,SERVER_REQUESTGAME:1656,NOTIFY_MYMOVES_CHANGED_CONFIRM:1657,REQUEST_DRILL_STATISTICS:1658,RESPOND_DRILL_STATISTICS:1659,DRILL_INCREMENT:1660,toString:function(d){for(var b in this)if(this[b]==d)return b;return"Unknown CloudUserMsgId: "+
        d},toNumString:function(d){return"MyMovesId="+d}};CB.PosAndMoveFlags={MY_BLACK:1,MY_WHITE:2,MOVE_WHITE:4,MOVE_BLACK:8,REP_IMPORTANT:16,REP_EXCLUDE:32,WITH_TEXT:64,DRILLED:128,DELETED:256,WHITE:6,BLACK:9,MOVE:12,MYMOVE:3};
CB.Server.MyMovesManager=function(){var d=function(){this.setRequestedHeaders=new CB.Set;this.timerSend=new CB.Timer;this.selectedMyMovesId=0;this.mapDBs={};this.headerResponseReceiver=new CB.VectorSender(function(b){this.send(b)}.bind(this));this.gameSender=new CB.VectorSender(function(b){this.send(b)}.bind(this));this.autoOpenDB=!1;this.lastMyMovesLoadMode=this.myMovesLoadMode=CB.GetMovesType.NONE;this.name="MyMoves";this.myMoves=[]};CB.inherit(d,CB.Server.Connector);d.prototype.createLobby=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           c,e,d,g){this.create(b,c,e,d,g)};d.prototype.getName=function(){return"MyMovesMgr"};d.prototype.onChangeLogin=function(){V15.setLoggedIn(this.isLoggedIn())};d.prototype.onLoginToken=function(){this.logIntoChat("Connected to MyMovesServer","","conn");this.boundLoginOk=!0;this.loginMode!==CB.LoginMode.GUEST&&(V15.setLoggedIn(!0),V15.panelMgr.getKernel()&&this.checkPosAndMoves(V15.panelMgr.getKernel().getCurPos()));V15.showAccountType(this.Vl)};d.prototype.onIdReceived=function(b){b.isFromBridge()||
(this.boundLoginOk=!0,this.loginMode!==CB.LoginMode.GUEST?b.strUserId&&(V15.Vf.userName=CB.strUtil.decodeUTF8(b.strUserId),this.user=CB.strUtil.decodeUTF8(b.strUserId),this.utf8User=b.strUserId,b.strToken&&(V15.Vf.loginToken=b.strToken,CB.DOM.setCookie("AccountMode",CB.LoginMode.NORMAL),V15.Vf.rememberLoginToken(),this.Vl=b.Vl,V15.setLoggedIn(!0),V15.showAccountType(this.Vl),this.loadRepFromUrl()||V15.panelMgr.getKernel()&&this.checkPosAndMoves(V15.panelMgr.getKernel().getCurPos())),this.fnOnIdReceived&&
this.fnOnIdReceived()):(this.user="Guest"+this.getNId(),this.utf8User="Guest"+this.getNId()))};d.prototype.loadRepFromUrl=function(){if(!this.hasLoadedRepFromUrl&&V15.urlParams&&V15.urlParams.repName&&V15.urlParams.repPath){this.hasLoadedRepFromUrl=!0;var b=new CB.RepertoireItem;b.name=V15.urlParams.repName;b.path=V15.urlParams.repPath;b.global=!0;b.eMode=parseInt(V15.urlParams.repMode);b.eLevel=0;(new CB.Timer).runOnce(10,function(){this.setAndLoadMyMovesByName(b,new CB.Game)}.bind(this));return!0}};
    d.prototype.onLogOff=function(){this.superClass.onLogOff.apply(this,arguments)};d.prototype.logIntoChat=function(b,c,e){5};d.prototype.testYesNo=function(b){CB.LOG("YesNo="+b)};d.prototype.test=function(){};d.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b))try{switch(b.getType()){default:TRACE("Unhandled: "+b.toString());break;case CB.SockMsgId.DEFAULTGROUPS:this.logIntoChat("Connected to MyMovesServer");this.boundLoginOk=!0;alert("Default Groups not expected...");break;
        case CB.SockMsgId.CLOUD_USER:this.handleMyMovesMsg(b);break;case CB.SockMsgId.INVALIDPASSWORD:this.clearLoginCookies()}}catch(c){b=CB.SockMsgId.toNumString(b.getType()),CB.LogException(b,c)}};d.prototype.handleChat=function(b){V15.panelMgr.chatOut(chat.toString())};d.prototype.isLoggedIn=function(){return this.boundLoginOk&&this.isConnected()};d.prototype.handleMyMovesMsg=function(b){try{switch(b.getUserType()){default:TRACE("Unhandled MyMoves Msg: "+b.toString());break;case CB.CloudUserMsgId.DISK_USED:this.handleDiskUsed(b);
        break;case CB.CloudUserMsgId.RESPOND_POS_AND_MOVES:this.respondPosAndMoves(b);break;case CB.CloudUserMsgId.RESPOND_ALL_MYMOVES:this.respondAllMyMoves(b);break;case CB.CloudUserMsgId.RESPOND_TREE_REMOVED:this.respondTreeRemoved(b);break;case CB.CloudUserMsgId.RESPOND_TREE_UNLEARNED:this.respondTreeUnlearned(b);break;case CB.CloudUserMsgId.RESPOND_COUNT_MYMOVES:break;case CB.CloudUserMsgId.NOTIFY_MYMOVES_CHANGED:this.notifyMyMovesChanged(b);break;case CB.CloudUserMsgId.NOTIFY_MYMOVES_CHANGED_CONFIRM:break;
        case CB.CloudUserMsgId.RESPOND_REPERTOIRELIST:this.handleRepertoireList(b);break;case CB.CloudUserMsgId.NOTIFY_GAME_CHANGED:break;case CB.CloudUserMsgId.RESPOND_DRILL_STATISTICS:this.handleDrillStatistics(b);break;case CB.CloudUserMsgId.DRILL_INCREMENT:this.handleDrillIncrement(b)}}catch(c){b=CB.CloudUserMsgId.toNumString(b.getUserType()),CB.LogException(b,c)}};d.prototype.handleReconnectOk=function(b){};d.prototype.handleDiskUsed=function(b){b.getBuf().Vw();b.getBuf().Vw()};d.prototype.gameFromBuf=
        function(b){var c=new CB.Game,e=new CB.GameHeader;e.compactFromDataBuf(b);b.V10();c.readGameOnly2(b);c.setHeader(e);return c};d.prototype.gameToBuf=function(b,c){c.hdr.compactToDataBuf(b);b.Vx(0);c.writeGameOnly2(b);return c};d.prototype.storePosAndMoves=function(b,c){var e=this.createMsg(CB.CloudUserMsgId.STORE_POS_AND_MOVES);this.gameToBuf(e.getBuf(),b);e.getBuf().Vx(c);e.getBuf().Vx(CB.System.getWindowsCodePage());this.send(e)};d.prototype.storeEval=function(b,c){var e=this.createMsg(CB.CloudUserMsgId.STORE_EVAL);
        this.gameToBuf(e.getBuf(),b);e.getBuf().Vx(c);b=CB.PosAndMoveFlags.MOVE_WHITE;this.isMovesLoadedFor(!0)&&(b=CB.PosAndMoveFlags.MOVE_BLACK);e.getBuf().Vx(b);e.getBuf().Vx(CB.System.getWindowsCodePage());this.send(e)};d.prototype.storeText=function(b,c){var e=this.createMsg(CB.CloudUserMsgId.STORE_TEXT);this.gameToBuf(e.getBuf(),b);e.getBuf().V5(CB.strUtil.encodeUTF8(c));b=CB.PosAndMoveFlags.MOVE_WHITE;this.isMovesLoadedFor(!0)&&(b=CB.PosAndMoveFlags.MOVE_BLACK);e.getBuf().Vx(b);e.getBuf().Vx(CB.System.getWindowsCodePage());
        this.send(e)};d.prototype.notifyPlayed=function(b,c,e){var d=this.createMsg(CB.CloudUserMsgId.NOTIFY_PLAYED);b.write(d.getBuf());c.write2(d.getBuf());d.getBuf().V13(e);d.getBuf().Vx(CB.System.getWindowsCodePage());this.send(d)};d.prototype.uploadToMyMoves=function(b){var c=this.createMsg(CB.CloudUserMsgId.UPLOAD_GAME);this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.makeMainMoveOrder=function(b){var c=this.createMsg(CB.CloudUserMsgId.MAKE_MAIN_MOVEORDER);
        this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};d.prototype.removeFromMyMoves=function(b,c){if(c&&this.isMovesLoadedForAny()){var e=this.createMsg(CB.CloudUserMsgId.REMOVE_FROM_MYMOVES);b.write(e.getBuf());delete c.annos;(new CB.Move(c.from,c.to,c.prom)).write2(e.getBuf());e.getBuf().Vx(CB.System.getWindowsCodePage());this.send(e)}};d.prototype.removeWholeTree=function(b,c,e){var d=this.createMsg(CB.CloudUserMsgId.REMOVE_WHOLE_TREE);b.write(d.getBuf());c.write2(d.getBuf());
        d.getBuf().Vx(e);d.getBuf().Vx(CB.System.getWindowsCodePage());this.send(d)};d.prototype.respondTreeRemoved=function(b){var c=b.getBuf().Vw();b.getBuf().V10();CB.LOG("Removed: "+c+" moves.","LogBold");this.reloadMyMoves();V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.FORCE_UPDATE);1<c&&V15.panelMgr.showMessage(c+" "+lm.MOVES_UNMARKED,4E3)};d.prototype.respondTreeUnlearned=function(b){var c=b.getBuf().Vw();b.getBuf().V10();V15.panelMgr.showMessage(c+" "+lm.MOVES_UNLEARNED,4E3)};d.prototype.unlearnWholeTree=
        function(b,c,e){var d=this.createMsg(CB.CloudUserMsgId.UNLEARN_WHOLE_TREE);b.write(d.getBuf());c.write2(d.getBuf());d.getBuf().Vx(e);d.getBuf().Vx(CB.System.getWindowsCodePage());this.send(d)};d.prototype.respondCountMyMoves=function(b){};d.prototype.checkPosAndMoves=function(b,c,e){var d=this.createMsg(CB.CloudUserMsgId.CHECK_POS_AND_MOVES);b.write(d.getBuf());d.getBuf().V13(c?!0:!1);d.getBuf().writeInt(e||0);d.getBuf().Vx(CB.System.getWindowsCodePage());this.send(d,!0)};d.prototype.checkPosAndMovesEx=
        function(b,c,e){if(!this.currRepListItem)return this.checkPosAndMoves(b,c,e);var d=this.createMsg(CB.CloudUserMsgId.CHECK_POS_AND_MOVES_EX);this.repListItemToPosMovesId(this.currRepListItem,d.getBuf());b.write(d.getBuf());d.getBuf().V13(c?!0:!1);d.getBuf().writeInt(e||0);d.getBuf().Vx(CB.System.getWindowsCodePage());this.send(d,!0)};d.prototype.respondPosAndMoves=function(b){var c=new CB.Position;c.read(b.getBuf());for(var e=b.getBuf().V10(),d=[],g=0;g<e&&200>g;g++){var h=new CB.Move;h.read2(b.getBuf());
        var k=b.getBuf().Vw(),l=b.getBuf().V10(),m=b.getBuf().readUint8(),p=b.getBuf().V6(300),r=b.getBuf().readUint8(),t=b.getBuf().Vu(),w=b.getBuf().readUint8();d.push({move:h,visits:k,flags:l,eval:m,correct:r,txt:p,date:t,learnPercent:w})}e={count:0,total:0,drilled:0,learned:0,quote:0,toString:function(){return"Stats: cnt="+this.count+", total="+this.total+", drilled="+this.drilled+", learned="+this.learned},getPercent:function(){return this.total?Math.round(100*this.quote/this.total):0}};e.count=b.getBuf().Vw();
        e.total=b.getBuf().Vw();e.drilled=b.getBuf().Vw();e.learned=b.getBuf().Vw();e.quote=b.getBuf().readFloat64();this.fireOnMyMoves({position:c,moves:d,stats:e})};d.prototype.setAndLoadMyMovesByName=function(b,c){this.myMovesLoadMode<CB.GetMovesType.GLOBAL_WHITE&&(c=new CB.Game);this.currRepListItem=b;this.myMovesLoadMode=0===b.eMode?CB.GetMovesType.GLOBAL_WHITE:CB.GetMovesType.GLOBAL_BLACK;V15.panelMgr.blockLiveBookUpdates&&V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.BLOCKED);var e=this.createMsg(CB.CloudUserMsgId.LOAD_ALL_MYMOVES_EX);
        this.repListItemToPosMovesId(b,e.getBuf());e.getBuf().Vx(this.myMovesLoadMode);this.gameToBuf(e.getBuf(),c);e.getBuf().Vx(CB.System.getWindowsCodePage());this.send(e)};d.prototype.reloadGlobalMyMoves=function(b,c,e){if(this.currRepListItem&&this.currRepListItem.path&&this.currRepListItem.name){var d=this.currRepListItem.path.split("\\")[0];this.currRepListItem.path=this.makeServerPath(d,b,c,this.currRepListItem.eMode);this.setAndLoadMyMovesByName(this.currRepListItem,e)}};d.prototype.makeServerPath=
        function(b,c,e,d){switch(c){case CB.RepDepth.EASY:b+="\\Easy";break;case CB.RepDepth.CLUB:b+="\\Club";break;case CB.RepDepth.TOURNAMENT:b+="\\Tourn";break;case CB.RepDepth.MASTER:b+="\\Profi"}switch(e){case CB.RepStyle.FASHION:b+="-Fashion";break;case CB.RepStyle.SIDELINES:b+="-SideLines"}1===d?b=b+="-Black":0===d&&(b=b+="-White");return b};d.prototype.repListItemToPosMovesId=function(b,c){c.V5(b.name);c.V5(b.path);c.V13(b.global)};d.prototype.loadCurrentMyMoves=function(b,c){this.currRepListItem&&
    b>=CB.GetMovesType.GLOBAL_WHITE?this.setAndLoadMyMovesByName(this.currRepListItem,c):this.loadMyMoves(b,c)};d.prototype.loadMyMoves=function(b,c,e){this.currRepListItem=null;this.loadMyMovesHdl=e;this.doLoadMyMoves(b,new CB.Game)};d.prototype.doLoadMyMoves=function(b,c){this.lastLoadMyMovesStartGame=c;V15.panelMgr.blockLiveBookUpdates&&V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.BLOCKED);var e=this.createMsg(CB.CloudUserMsgId.LOAD_MY_MOVES);e.getBuf().Vx(b);this.gameToBuf(e.getBuf(),c);e.getBuf().Vx(CB.System.getWindowsCodePage());
        this.send(e)};d.prototype.annoLatestMyMovesMove=function(b){var c=-1,e=-1;this.myMoves[1]&&(c=b.findInTree(this.myMoves[1]));this.myMoves[2]&&(e=b.findInTree(this.myMoves[2]));var d=function(b,c,e){3<c&&(b.gotoIndex(c),b=b.getOrCreateCurrAnno(),e?b.addPostText("My Moves - Black"):b.addPostText("My Moves - White"))};d(b,c,!1);d(b,e,!0);return Math.max(c,e)};d.prototype.resetGame=function(){var b=V15.panelMgr.getKernel();b&&b.game.assign(new CB.Game);this.lastLoadMyMovesStartGame=new CB.Game};d.prototype.reloadMyMoves=
        function(){this.lastLoadMyMovesStartGame||(this.lastLoadMyMovesStartGame=new CB.Game);this.loadMyMoves(this.lastMyMovesLoadMode,this.lastLoadMyMovesStartGame)};d.prototype.respondAllMyMoves=function(b){var c=this.gameFromBuf(b.getBuf()),e=b.getBuf().Vw();b=b.getBuf().V10();switch(b){case CB.GetMovesType.ALL:var d="Both Colors";break;case CB.GetMovesType.WHITE:d="White";break;case CB.GetMovesType.BLACK:d="Black"}c.hdr.white=new CB.PlayerData("","My Moves");c.hdr.black=new CB.PlayerData("",d);0==e?
        (c="No Marked Moves Found.",b!=CB.GetMovesType.ALL&&b<CB.GetMovesType.GLOBAL_WHITE&&(c=d+" - "+c),V15.panelMgr.showMessage(c,5E3),V15.panelMgr.shakeMarkButton&&V15.panelMgr.shakeMarkButton(),c=new CB.Game):V15.panelMgr.stopShakeMarkButton&&V15.panelMgr.stopShakeMarkButton();b>=CB.GetMovesType.GLOBAL_WHITE&&this.removeAllMyMoveAnnos(c);V15.panelMgr.loadGame(c);this.myMovesLoadMode=b;var g;this.currRepListItem&&(g=this.currRepListItem.getNotaHeaderTitleLines());V15.panelMgr.setLayoutMyMoves&&V15.panelMgr.setLayoutMyMoves(!0,
        b,g);this.lastMyMovesLoadMode=b;V15.panelMgr.blockLiveBookUpdates&&V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.NOT_BLOCKED);this.loadMyMovesHdl&&(this.loadMyMovesHdl(),delete this.loadMyMovesHdl);this.myMoves[b]=c};d.prototype.removeAllMyMoveAnnos=function(b){b.forAllMoves(function(b){(b=b.getAnno())&&(b=b.getSymbol())&&b.removeMyMoveMark()})};d.prototype.notifyMyMovesChanged=function(b){V15.notifyMyMovesChanged()};d.prototype.startDrill=function(b,c){var e=this.createMsg(CB.CloudUserMsgId.START_DRILL);
        b.write(e.getBuf());e.getBuf().Vx(c);e.getBuf().Vx(CB.System.getWindowsCodePage());this.send(e);this.drillStats={positions:0,visited:0,memScore:0,getPercent:function(){return this.positions?Math.round(100*this.memScore/this.positions):0},getVisitedPercent:function(){return this.positions?Math.round(100*this.visited/this.positions):0}};this.requestDrillStatistics(b,c===CB.GetMovesType.BLACK)};d.prototype.stopDrill=function(){var b=this.createMsg(CB.CloudUserMsgId.STOP_DRILL);b.getBuf().Vx(CB.System.getWindowsCodePage());
        this.send(b)};d.prototype.requestRepertoireList=function(b){var c=this.createMsg(CB.CloudUserMsgId.REQUEST_REPERTOIRELIST);this.repListItemToPosMovesId({name:"",path:"",global:!0},c.getBuf());c.getBuf().Vx(b?1:0);this.send(c)};d.prototype.handleRepertoireList=function(b){var c=new CB.RepertoireItemList;c.fromDataBuf(b.getBuf());b=b.getBuf().V14();this.fireOnRepertoires({list:c,black:b})};d.prototype.requestDrillStatistics=function(b,c){c=c?CB.GetMovesType.BLACK:CB.GetMovesType.WHITE;var e=this.createMsg(CB.CloudUserMsgId.REQUEST_DRILL_STATISTICS);
        b.write(e.getBuf());e.getBuf().writeInt(c);this.send(e)};d.prototype.handleDrillStatistics=function(b){b=b.getBuf();b.beginSizedRead();this.drillStats.positions=b.Vw();this.drillStats.visited=b.Vw();this.drillStats.memScore=b.readFloat64();b.endSizedRead();V15.panelMgr.scorePanel.showDrillStats(this.drillStats)};d.prototype.handleDrillIncrement=function(b){if(this.drillStats){b=b.getBuf();b.beginSizedRead();var c=b.readFloat64(),e=b.Vw();this.drillStats.visited+=e;this.drillStats.memScore+=c;b.endSizedRead();
        V15.panelMgr.scorePanel.showDrillStats(this.drillStats)}};d.prototype.createMsg=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(b);b=this.user;this.loginMode==CB.LoginMode.GUEST&&(b="Guest");c.getBuf().V5(CB.strUtil.encodeUTF8(b));return c};d.prototype.onResetGame=function(){this.myMovesLoadMode=CB.GetMovesType.NONE};d.prototype.isMovesLoadedForAny=function(){return this.myMovesLoadMode>=CB.GetMovesType.ALL&&this.myMovesLoadMode<CB.GetMovesType.GLOBAL_WHITE};d.prototype.getLoadedMovesSide=
        function(){switch(this.lastMyMovesLoadMode){default:return CB.Side.NONE;case CB.GetMovesType.ALL:case CB.GetMovesType.WHITE:case CB.GetMovesType.GLOBAL_WHITE:return CB.Side.WHITE;case CB.GetMovesType.BLACK:case CB.GetMovesType.GLOBAL_BLACK:return CB.Side.BLACK}};d.prototype.isMovesLoadedFor=function(b){switch(this.myMovesLoadMode){default:return!1;case CB.GetMovesType.ALL:return!0;case CB.GetMovesType.BLACK:return b;case CB.GetMovesType.WHITE:return!b}};d.prototype.displayForceLogOffMsg=function(b){var c=
        V15.panelMgr.getKernel();c&&c.boardWin&&c.boardWin.addMessage("Server logged you off: "+b,!0)};Ve.initForListeners(d);Ve.addEvent(d,"MyMoves");Ve.addEvent(d,"Repertoires");return d}();"use strict";CB.namespace("CB.DOM");CB.DOM.get=function(d){return document.getElementById(d)};
CB.DOM.inputAdd=function(d,b){d=document.createTextNode(d);var c=document.createElement("div");void 0!==b&&(c.className=b);document.body.appendChild(c);c.appendChild(d);void 0!==CB.input?document.body.insertBefore(c,CB.input):document.body.appendChild(c)};CB.DOM.add=function(d,b,c){var e=document.createElement("div");b&&b.length?(b=document.createElement(b),b.innerText=d):b=document.createTextNode(d);void 0!==c&&(e.className=c);e.appendChild(b);document.body.appendChild(e)};
CB.DOM.addUrl=function(d,b,c){var e=document.createElement("div"),f=document.createElement("a");f.href=d;f.target="_blank";b&&b.length&&(f.textContent=b);void 0!==c&&(e.className=c);e.appendChild(f);document.body.appendChild(e)};CB.DOM.addBr=function(){var d=document.createElement("br");document.body.appendChild(d)};
CB.DOM.insertBefore=function(d,b,c){d=document.createTextNode(d);var e=document.createElement("div");e.className=void 0!==c?c:"Text";document.body.appendChild(e);e.appendChild(d);void 0!==document.getElementById(b)?document.body.insertBefore(e,document.getElementById(b)):document.body.appendChild(e)};CB.DOM.getCookie=function(d){for(var b=document.cookie.split(";"),c=0;c<b.length;c++){var e=b[c].split("="),f=e[0].trim();e=1<e.length?e[1]:"";if(f==d)return decodeURIComponent(e)}return""};
CB.DOM.codeAccountName=function(d){return CB.strUtil.base64.encode(CB.strUtil.htmlEncode(d))};CB.DOM.setAccountNameCookie=function(d){"guest"!=d&&this.setCodedCookie("AccountName64",d)};CB.DOM.getAccountNameCookie=function(d){return this.getCodedCookie("AccountName64",d)};CB.DOM.setCodedCookie=function(d,b){CB.DOM.setCookie(d,this.codeAccountName(b))};
CB.DOM.getCodedCookie=function(d,b){d=CB.DOM.getCookie(d);d=CB.strUtil.base64.decode(d);b&&(d=CB.strUtil.htmlDecode(d),d=d.replace("%25","%"),d=d.replace("%20"," "));return d};CB.DOM.setCookie=function(d,b){var c=new Date;if(b){c.setYear(c.getFullYear()+1);var e=c.toGMTString()}else e="Thu, 01 Jan 1970 00:00:01 GMT";c=".chessbase.com";-1!=document.URL.search(/localhost/i)&&(c="localhost");d=d+"="+encodeURIComponent(b)+";expires="+e+";path=/;";c.length&&(d+="domain="+c+";");document.cookie=d+"SameSite=Lax;"};
CB.DOM.clearCookie=function(d){CB.DOM.setCookie(d,"")};CB.DOM.addCls=function(d,b){void 0!==d&&(d.className=0<d.className.length?d.className+(" "+b):b)};CB.DOM.removeCls=function(d,b){void 0!==d&&(d.className=d.className.replace(new RegExp("\b"+b+"\b"),""))};CB.DOM.resize=function(d,b,c){if("string"===typeof d||"number"===typeof d)d=document.getElementById(d);void 0!==d&&(d.style.width=b,d.style.height=c)};
CB.DOM.setText=function(d,b){d&&("undefined"==typeof d.textContent?d.innerText=b:d.textContent=b)};function textOut(d,b){CB.Logger?CB.LOG(d,b):(CB.DOM.add(d,"",b),void 0!==CB.input&&CB.input.scrollIntoView())}function TRACE(d){V15.config.debug&&textOut(d,"LogTrace")}function EXCEPTION(d,b){void 0!==b&&(d+=" ("+b+")");textOut(d,"LogException")}function CHAT(d){textOut(d,"LogChat")}
CB.CSS=function(){var d={},b;d.getStyleSheet=function(){if(void 0===b){var c=document.createElement("style");c.setAttribute("media","screen");c.appendChild(document.createTextNode(""));document.head.appendChild(c);b=c.sheet}return b};d.createStyleSheet=function(b){var c=document.createElement("style");c.id=b;c.setAttribute("media","screen");c.appendChild(document.createTextNode(""));document.head.appendChild(c);return c.sheet};d.addRules=function(b,c){try{void 0!==d.getStyleSheet().addRule?d.getStyleSheet().addRule(b,
    c):d.getStyleSheet().insertRule(b+" { "+c+" }",d.getStyleSheet().cssRules.length)}catch(g){CB.LogException("CSS:addRules",g)}};d.getGradToRight=function(b,c){return"background-image:linear-gradient( to right,"+b+","+c+")"};d.getCenteredText=function(){return"display:block;margin-left:auto;margin-right:auto;text-align:center"};d.getHeader=function(b,c,d){return d?"<"+b+' style="'+d+'">'+c+"</"+b+">":"<"+b+">"+c+"</"+b+">"};d.findKeyframesRule=function(b){for(var c=d.getStyleSheet(),e=0;e<c.cssRules.length;++e)if(c.cssRules[e].type==
    window.CSSRule.KEYFRAMES_RULE&&c.cssRules[e].name==b)return c.cssRules[e];e=CB.System.isWebKit()?"-webkit-":"";void 0===c.insertRule?c.addRule("@"+e+"keyframes "+b+"{ 0% { top: 10px } 100% { top: 30px } }"):c.insertRule("@"+e+"keyframes "+b+"{ 0% { top: 10px } 100% { top: 30px } }",c.cssRules.length);for(e=0;e<c.cssRules.length;++e)if(c.cssRules[e].type==window.CSSRule.KEYFRAMES_RULE&&c.cssRules[e].name==b)return c.cssRules[e];return null};var c={};d.addIcon=function(b){b=[].concat(b);for(var e=0;e<
b.length;e++)1<b[e].length&&void 0==c[b[e]]&&(CB.CSS.getStyleSheet().insertRule("."+b[e]+"{ background-image: url( "+V15.config.getRibbonPath()+b[e]+".png ) !important; }",0),c[b[e]]=1)};return d}();"use strict";
CB.$=function(){function d(b){var c=document.createElement("div");c.innerHTML=b;return c.childNodes}function b(b){l.prototype[b]=function(){return this.arr[b].apply(this,arguments)}}function c(b){l.prototype[b]=function(c){this.on(b,c)}}var e=/^#(\w|-)+$/,f=/^.(\w|-)+$/,g=/^\w+$/,h=/^\[(\w|-)+\]$/,k=/^<.*>$/,l=function(b,c){var f=[];if(null!=b&&""!=b)if("string"===typeof b){c=c||document;var h=(new l(c)).single();b=b.trim();b.startsWith(">")?(f=b.replace(">","").trim(),f=(new l(f,h)).arr.filter(function(b){return b.parentNode==
    h})):e.test(b)?(b=b.substring(1),f=(f=document.getElementById(b))?[f]:[]):g.test(b)?f=h.getElementsByTagName(b):k.test(b)?f=d(b):h&&(f=h.querySelectorAll(b,h))}else"object"===typeof b&&(f=b.proloJQ?b.arr:[b]);this.length=f.length;this.arr=[];for(b=0;b<f.length;++b)this[b]=f[b],this.arr.push(f[b]);this.proloJQ=!0};b("indexOf");b("find");b("findIndex");b("find");b("some");b("every");b("map");b("filter");b("reduce");b("forEach");l.prototype.single=function(){return 1===this.arr.length?this.arr[0]:null};
    l.prototype.first=function(){return this.arr[0]};l.prototype.last=function(){return this.arr[this.arr.length-1]};l.prototype.addClass=function(b){this.forEach(function(c){c.classList&&c.classList.add(b)});return this};l.prototype.removeClass=function(b){b?this.forEach(function(c){c.classList&&c.classList.remove(b)}):this.forEach(function(b){b.className=""});return this};l.prototype.toggleClass=function(b){this.forEach(function(c){c.classList&&c.classList.toggle(b)});return this};l.prototype.hide=
        function(){this.forEach(function(b){if("none"!==b.style.display){var c=b.style.display;b.oldDisplay="none"!=c?c:"block";b.style.display="none"}})};l.prototype.show=function(){this.forEach(function(b){b.style.display&&"none"!==b.style.display||(b.style.display=b.oldDisplay||"block",delete b.oldDisplay)})};l.prototype.setDisplay=function(b){this.forEach(function(c){c.style.display=b})};l.prototype.toggle=function(b){b?this.show():this.hide()};l.prototype.parent=function(b){for(var c=this.single().parentNode;null!=
    c;c=c.parentNode)if(r.is(c,b))return c;return null};l.prototype.on=function(b,c){this.forEach(function(e){e.addEventListener(b,c)});return this};l.prototype.off=function(b,c){this.forEach(function(e){e.removeEventListener(b,c)});return this};c("mousemove");c("mousedown");c("mouseup");c("click");l.prototype.html=function(b){if(void 0===b)return this.single().innerHTML;this.forEach(function(c){c.innerHTML=b});return this};l.prototype.text=function(b){if(void 0===b)return this.single().textContent?this.single().textContent:
        this.single().innerHTML;this.forEach(function(c){c.textContent?c.textContent=b:c.innerText=b});return this};l.prototype.prependTo=function(b){var c=(new l(b)).single();this.forEach(function(b){c.insertBefore(b,c.firstChild)})};l.prototype.prepend=function(b){var c=new l(b);this.forEach(function(b){c.prependTo(b)})};l.prototype.appendTo=function(b){var c=(new l(b)).single();this.forEach(function(b){c.appendChild(b)});return this};l.prototype.append=function(b){var c=new l(b);this.forEach(function(b){c.appendTo(b)});
        return this};l.prototype.insertBefore=function(b){var c=new l(b);this.forEach(function(b){c.forEach(function(c){c.parentNode&&c.parentNode.insertBefore(b,c)})});return this};l.prototype.empty=function(){this.html("");return this};l.prototype.remove=function(){this.forEach(function(b){b.parentNode&&b.parentNode.removeChild(b)});return this};l.prototype.attr=function(b,c){if(void 0===c){var e=this.single().attributes[b];return e?e.value:null}this.forEach(function(e){e.setAttribute(b,c)});return this};
    l.prototype.data=function(b,c){return this.attr("data-"+b,c)};var m=/^[+-]?(([0-9]*\.[0-9]+)|[0-9]+)/,p="marginTop marginBottom marginLeft marginRight paddingTop paddingBottom paddingLeft paddingRight height width minHeight minWidth maxHeight maxWidth borderWidth left top bottom right".split(" ");l.prototype.css=function(b,c){if(b&&"object"==typeof b&&!c){for(var e in b)b.hasOwnProperty(e)&&this.css(e,b[e]);return this}var d=minusToCamel(b);if(void 0===c)return this.arr.length?getComputedStyle(this.arr[0])[d]:
        null;this.forEach(function(b){var e=c;null==e&&(e="");e=e.toString();var f=e;var g=m.exec(f);g?(g=g[0],f=f.substring(g.length),f={val:parseFloat(g),unit:f}):f=null;f&&!f.unit&&(e+=0<=p.indexOf(d)?"px":"");b.style[d]=e});return this};l.prototype.position=function(){return{top:parseFloat(this.css("top")),left:parseFloat(this.css("left"))}};var r=function(b,c){return ObjUtil.isFunction(b)&&!c?(r.addOnReadyListener(b),null):new l(b,c)};Ve.initInstForListeners(r);Ve.addInstEvent(r,"Ready");(new l(document)).on("DOMContentLoaded",
        function(b){r.fireOnReady()});r.is=function(b,c,d){return b?c?f.test(c)?(c=c.replace(".",""),b.classList&&b.classList.contains(c)):e.test(c)?(c=c.replace("#",""),b.id===c):g.test(c)?b.tagName==c:h.test(c)?(c=c.replace("[",""),c=c.replace("]",""),b.attributes&&b.hasAttribute(c)):0<=r(c,d).indexOf(b):!0:!1};r.get=function(b){return r("#"+b).single()};r.set=function(b,c){r("#"+b).single().innerHTML=c};r.fn=l.prototype;return r}();"use strict";
CB.Element=function(){var d=0,b={append:!0},c=function(c,e,h,k){c&&(void 0===this.elDOM&&(this.elDOM=document.createElement(c)),c=k||{},c=ObjUtil.copyTo(b,c,!0),this.uniqueId||(this.uniqueId=++d),this.childs=[],this.isChild=!1,void 0!==e?e instanceof CB.Element?(this.parentDOM=e.elDOM,e.addChild(this),this.isChild=!0):this.parentDOM=e:this.parentDOM=document.body,this.elDOM.id=h?h:"CBEl"+this.uniqueId,this.debug=this.elDOM.id,e=c.append,this.parentDOM&&(e?this.parentDOM.appendChild(this.elDOM):this.parentDOM.insertBefore(this.elDOM,
    this.parentDOM.firstChild)),this.style=this.elDOM.style,this.setVisible(!1))};c.prototype.destroy=function(){this.destroyed||(this.childs.forEach(function(b,c){this.childs[c]&&this.childs[c].destroy()}.bind(this)),void 0!==this.extJSEl&&this.elDOM.removeChild(this.extJSEl.getEl().dom),this.parentDOM.removeChild(this.elDOM),this.destroyed=!0)};c.prototype.changeParentElDOM=function(b){if(this.isChild)throw"!Change parent ElDom on Child El ";this.parentDOM&&this.parentDOM.contains(this.elDOM)&&this.parentDOM.removeChild(this.elDOM);
    (this.parentDOM=b)&&this.parentDOM.appendChild(this.elDOM)};c.prototype.addChild=function(b){this.childs[b.uniqueId]=b};c.prototype.removeChild=function(b){delete this.childs[b.uniqueId]};c.prototype.destroyChilds=function(){this.childs.forEach(function(b,c){this.childs[c]&&this.childs[c].destroy()}.bind(this));this.childs=[]};c.prototype.setVisible=function(b){this.style.visibility=b?"visible":"hidden";this.childs.forEach(function(c,e){this.childs[e]&&this.childs[e].setVisible(b)}.bind(this));void 0!==
this.extJSEl&&(b?this.extJSEl.show():this.extJSEl.hide())};c.prototype.isVisible=function(){return"visible"==this.style.visibility};c.prototype.setRect=function(b){this.setPos(b.topLeft.x,b.topLeft.y);this.setSize(b.w,b.h)};c.prototype.setRelativePos=function(){this.style.position="relative"};c.prototype.setPos=function(b,c){b=Math.floor(b);c=Math.floor(c);this.x=b;this.y=c;this.style.position="absolute";this.style.left=Math.round(b)+"px";this.style.top=Math.round(c)+"px"};c.prototype.setSize=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           c){b=Math.floor(b);c=Math.floor(c);this.w=b;this.h=c;this.elDOM.width=b;this.elDOM.height=c;this.style.width=b+"px";this.style.height=c+"px";void 0!==this.extJSEl&&(this.extJSEl.setWidth(b),this.extJSEl.setHeight(c));this.vAlign&&(this.style.lineHeight=c+"px");this.onResize()};c.prototype.onResize=function(){};c.prototype.setHeight=function(b){this.h=b=Math.floor(b);this.style.height=b+"px";void 0!==this.extJSEl&&this.extJSEl.setHeight(b)};c.prototype.setPosSize=function(b,c,e,d){this.setPos(b,c);
    this.setSize(e,d)};c.prototype.setZIndex=function(b){this.style.zIndex=b};c.prototype.setBorder=function(b,c,e){b=Math.floor(b);this.style.borderWidth=b+"px";void 0!==c&&(this.style.borderColor=c);this.style.borderStyle=void 0!==e?e:"solid"};c.prototype.setCssClass=function(b){this.elDOM.className=b};c.prototype.setBoxShadow=function(b,c,e){this.style.boxShadow=b+"px "+b+"px "+c+"px 0px "+e};c.prototype.setRounded=function(b){b=Math.floor(b);this.style.borderRadius=b+"px"};c.prototype.setBackgroundColor=
    function(b){this.backgroundColor=b.toString();this.style.backgroundColor=b.toString()};c.prototype.setColor=function(b){this.style.color=b.toString()};c.prototype.setMargin=function(b){this.style.margin=b+"px"};c.prototype.setPadding=function(b){this.style.padding=b+"px"};c.prototype.setZIndex=function(b){this.style.zIndex=b};c.prototype.setExtJSElement=function(b){this.extJSEl=b};c.enablePointerEvents=function(b,c){b.style.pointerEvents=c?"all":"none"};c.prototype.setClickHandler=function(b){this.elDOM.addEventListener("click",
    b)};c.prototype.setHandler=function(b,c){this.elDOM.addEventListener(b,c)};c.prototype.getDomElement=function(){return this.elDOM};c.addClass=function(b,c){if(!b.className||0>b.className.indexOf(c))b.className+=" "+c};c.removeClass=function(b,c){b.className=b.className.replace(c,"");b.className=b.className.replace(/\s+/g," ")};var e={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};c.isEventSupported=function(b){var c=document.createElement(e[b]||"div");
    b="on"+b;var d=b in c;d||(c.setAttribute(b,"return;"),d="function"==typeof c[b]);return d};c.prototype.setWoodenBackground=function(){this.elDOM.style.background="#101010";this.elDOM.style.backgroundImage="url( "+CB.getCommonPath()+"Media/Chess/OrangeBrighterSoft.jpg )";this.elDOM.style.backgroundSize="100% 100%";this.elDOM.style.backgroundRepeat="no-repeat";this.elDOM.style.backgroundPosition="bottom left"};return c}();"use strict";
CB.DivElement=function(){var d=function(b,c,e){CB.DivElement.superClass.call(this,"div",b,c,e)};CB.inherit(d,CB.Element);d.prototype.setImage=function(b,c,e){void 0===this.imageNode?(this.imageNode=document.createElement("img"),this.imageNode.setAttribute("src",b),this.imageNode.setAttribute("flag","alternate text"),this.imageNode.setAttribute("height",e+"px"),this.imageNode.setAttribute("width",c+"px"),this.elDOM.appendChild(this.imageNode)):this.imageNode.setAttribute("src",b)};d.prototype.setCssClass=
    function(b){this.elDOM.className=b};d.prototype.setText=function(b){"undefined"!=typeof b&&(void 0===this.textNode&&(this.textNode=document.createElement("span"),this.textNode.style.display="inline-block",this.elDOM.appendChild(this.textNode),this.textNode.style.cursor="pointer"),b=b.toString(),b.replace(/</g,"("),b.replace(/>/g,")"),this.textNode.textContent?this.textNode.textContent=b:this.textNode.innerText?this.textNode.innerText=b:this.textNode.innerHTML=b)};d.prototype.setTextAlign=function(b){this.style.textAlign=
    b;this.textNode&&(this.textNode.textAlign=b)};d.prototype.getText=function(){if(this.textNode){if(this.textNode.textContent)return this.textNode.textContent;if(this.textNode.innerText)return this.textNode.innerText}return""};d.prototype.setZIndex=function(b){this.style.zIndex=b};d.prototype.setFontSize=function(b){if(b)void 0!==this.linkNode?this.linkNode.style.fontSize=Math.round(b)+"px":(this.textNode&&(this.textNode.style.fontSize=Math.round(b)+"px"),this.style.fontSize=Math.round(b)+"px",this.fontH=
    Math.round(b),this.centeredText&&this.setCenteredText());else throw Error("FontSize = 0");};d.prototype.setFontFamily=function(b){this.style.fontFamily=b;this.textNode&&(this.textNode.style.fontFamily=b)};d.prototype.setFontWeight=function(b){this.style.fontWeight=b};d.prototype.setVerticalAlign=function(b){void 0===this.textNode&&this.setText(" ");void 0!==this.textNode&&(this.textNode.style.verticalAlign=b,this.textNode.style.display="inline-block",this.textNode.style.lineHeight="normal",void 0!==
this.h&&(this.style.lineHeight=this.h+"px"))};d.prototype.setCenteredText=function(){this.setTextAlign("center");this.setVerticalAlign("middle");this.centeredText=!0;this.style.display="block";this.vAlign=!0};d.prototype.setRightAlign=function(){this.setAlign("right")};d.prototype.setLeftAlign=function(){this.setAlign("left")};d.prototype.setAlign=function(b){this.setTextAlign(b);this.setVerticalAlign("middle");this.centeredText=!1;this.style.display="block"};d.prototype.getTextWidth=function(){return void 0!==
this.textNode?this.textNode.clientWidth:0};d.prototype.getTextHeight=function(){return void 0!==this.textNode?this.textNode.clientHeight:0};d.prototype.setHoverBright=function(){$(this.elDOM).hover(function(){$(this).css("filter","brightness(108%)")},function(){$(this).css("filter","brightness(100%)")})};d.prototype.setURL=function(b,c,e,d){void 0===this.linkNode&&(this.linkNode=document.createElement("a"),this.elDOM.appendChild(this.linkNode));this.linkNode.href=b;this.linkNode.target="_blank";c&&
c.length&&(this.linkNode.textContent?this.linkNode.textContent=c:this.linkNode.innerText=c);e&&e.length&&(this.linkNode.className=e);d&&this.linkNode.setAttribute("onclick","if ( typeof ( ga ) !== 'undefined' && CB.System.runsOnChessBaseDomain() ) ga( 'send', 'event', 'link', \""+(c+'");'))};return d}();"use strict";
CB.ToolTip=function(){var d=new CB.Color(255,255,248,.95),b=new CB.Color(0,0,0,.9),c=1,e=function(){this.uniqueId=c++;this.background=new CB.DivElement(document.body,"bTTipBG"+this.uniqueId);this.textEl=new CB.DivElement(this.background,"bSTTipText"+this.uniqueId);this.background.elDOM.style.zIndex=99999;this.textEl.setBackgroundColor(d);this.textEl.setColor(b);this.textEl.setFontFamily("Roboto, Helvetica, sans-serif")};e.prototype.destroy=function(){this.background.destroy()};e.prototype.setText=
    function(b){this.textEl.setText(b)};e.prototype.setVisible=function(b){this.background.setVisible(b)};e.prototype.setPosSize=function(b,c){var e=Math.max(8,Math.round(.4*c.h)),d=new CB.Rect(b.x,b.y,b.x+c.w,b.y+c.h),f=c.w,g=(d.w-f)/2;d.w=f;d.move(g,0);this.background.setPos(b.x,b.y);this.background.setSize(c.w,c.h);d=Math.max(1,Math.min(4,Math.round(Math.sqrt(c.w/100))));this.background.setBoxShadow(d,8*d,"rgba( 60, 30, 20, 0.3 )");this.textEl.setPos(0,0);this.textEl.setSize(c.w,c.h);this.textEl.setBorder(1,
    new CB.Color(0,0,0,.5));this.textEl.setRounded(4);this.textEl.setCenteredText();do this.textEl.setFontSize(e),--e;while(4<e&&(this.textEl.getTextWidth()>f||this.textEl.getTextHeight()>c.h-3));CB.LOG("ToolTip: pos="+b.x+", "+b.y)};return e}();"use strict";
CB.CanvasElement=function(){var d=function(b,c){CB.CanvasElement.superClass.call(this,"canvas",b,c);this._uniqueId=c};CB.inherit(d,CB.Element);d.prototype.setCssClass=function(b){this.elDOM.className=b};d.prototype.setCanvasSize=function(b,c){this.elDOM.width=b;this.elDOM.height=c};d.prototype.render=function(){};d.prototype.setWoodenBackground=function(){this.elDOM.style.background="#101010";this.elDOM.style.backgroundImage="url( "+CB.getCommonPath()+"Media/Chess/OrangeBrighterSoft.jpg )";this.elDOM.style.backgroundSize=
    "100% 100%";this.elDOM.style.backgroundRepeat="no-repeat";this.elDOM.style.backgroundPosition="bottom left"};return d}();"use strict";
CB.CanvasParent=function(){var d=1,b=function(b){this.uniqueId=d++;this.background=new CB.DivElement(b,"aCanvParentBG"+this.uniqueId);this.background.setRelativePos();this.canvasEl=new CB.CanvasElement(this.background,"aCanvParentCanvas"+this.uniqueId)};b.prototype.createCanvas=function(b,e){return this.canvas=new CB.Canvas2D(this.canvasEl.elDOM.id,b,e)};b.prototype.changeParent=function(b){this.background.elDOM.parentElement.removeChild(this.background.elDOM);b&&b.appendChild(this.background.elDOM)};
    b.prototype.getElDom=function(){return this.background.elDOM};b.prototype.changeParentElDOM=function(b){this.background.changeParentElDOM(b)};b.prototype.setVisible=function(b){this.background.setVisible(b)};b.prototype.setPosSize=function(b,e,d,g){this.background.setPosSize(b,e,d,g);this.canvasEl.setPosSize(0,0,d,g);this.canvas&&this.canvas.resize(d,g)};b.prototype.setSize=function(b,e){this.background.setSize(b,e);this.canvasEl.setSize(b,e);this.canvas&&this.canvas.resize(b,e)};b.prototype.setWoodenBackground=
        function(){this.background.setWoodenBackground()};return b}();"use strict";
CB.CanvasParent3D=function(){var d=function(b,c){this.div=new CB.DivElement(b,"boardarea");CB.$("#boardarea").css("visibility","visible");this.canvasId=c};d.prototype.createCanvas=function(b,c){CB.$("#3d").css("visibility","visible");this.canvas=new CB.ThreeJSNoExtJs(this.div.elDOM.id,b,function(){c&&c()}.bind(this));return this};d.prototype.createCanvasInit=function(){this.canvas.canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!1);this.canvas.canvas.addEventListener("mousemove",this.onMouseMove.bind(this),
    !1);this.canvas.canvas.addEventListener("mouseup",this.onMouseUp.bind(this),!1);this.control=new CB.BoardArea3D(this.canvas,1,1)};d.prototype.onMouseDown=function(b){this.control.onMouseDown(b)};d.prototype.onMouseUp=function(b){this.control.onMouseUp(b)};d.prototype.onMouseMove=function(b){this.control.onMouseMove(b)};d.prototype.setVisible=function(b){};d.prototype.setPosSize=function(b,c,e,d){this.canvas&&this.canvas.resize(e,d)};d.prototype.setWoodenBackground=function(){};d.prototype.resize=
    function(b,c){this.canvas&&this.canvas.resize(b,c)};d.prototype.mousewheel=function(b,c){};d.prototype.DOMMouseScroll=function(b){};return d}();"use strict";CB.namespace("CB.UIElement");
CB.UIElement=function(){var d=function(b,c,e){CB.UIElement.superClass.call(this,b,c,e);this.elDOM&&(this.elDOM.className="cb-button",this.elDOM.addEventListener("mousedown",this.onMouseDown.bind(this)),this.elDOM.addEventListener("mouseup",this.onMouseUp.bind(this)),this.elDOM.addEventListener("mouseover",this.onMouseOver.bind(this)),this.elDOM.addEventListener("mouseleave",this.onMouseLeave.bind(this)))};CB.inherit(d,CB.Element);d.prototype.setText=function(b){b.replace(/</g,"(");b.replace(/>/g,
    ")");this.elDOM.innerHTML=b};d.prototype.setEnabled=function(b){this.elDOM.disabled=!b};d.prototype.getEnabled=function(){return!this.elDOM.disabled};d.prototype.setHandler=function(b){this.elDOM.addEventListener("click",function(c){b(c)})};d.prototype.setBackgroundColor=function(b){this.backgroundColor=b.toString();this.style.backgroundColor=b.toString()};d.prototype.setHoverColor=function(b){this.hoverColor=b.toString()};d.prototype.setClickColor=function(b){this.clickColor=b.toString()};d.prototype.onMouseDown=
    function(){this.clickColor&&(this.style.backgroundColor=this.clickColor)};d.prototype.onMouseUp=function(){this.hoverColor?this.style.backgroundColor=this.hoverColor:this.backgroundColor&&(this.style.backgroundColor=this.backgroundColor)};d.prototype.onMouseOver=function(){this.hoverColor&&(this.style.backgroundColor=this.hoverColor)};d.prototype.onMouseLeave=function(){this.backgroundColor&&(this.style.backgroundColor=this.backgroundColor)};d.prototype.setColor=function(b){this.style.color=b.toString()};
    return d}();"use strict";CB.namespace("CB.Button");
CB.Button=function(){var d=function(b,c,e){b&&(CB.Button.superClass.call(this,"button",b,c),this.elDOM.className=e||"cb-button")};CB.inherit(d,CB.Element);d.prototype.setImage=function(b){this.style.backgroundImage="url( "+b+")";this.style.backgroundRepeat="no-repeat";this.style.backgroundPosition="center"};d.prototype.setHandler=function(b){this.elDOM.addEventListener("click",b)};d.prototype.setText=function(b){var c=this.elDOM;c&&("undefined"==typeof c.textContent?c.innerText=b:c.textContent=b)};
    d.prototype.setEnabled=function(b){this.elDOM.disabled=!b};return d}();
CB.CloseButton=function(){var d=function(b,c,e){CB.CloseButton.superClass.call(this,b,c,"cb-CloseButton");this.textNode=document.createElement("span");this.textNode.style.display="inline-block";"undefined"!=typeof this.textNode.textContent?this.textNode.textContent="X":this.textNode.innerText="X";this.textNode.style.textAlign="centered";this.textNode.style.verticalAlign="middle";this.textNode.style.cursor="default";this.textNode.style.fontFamily="Roboto, Helvetica, sans-serif";this.elDOM.appendChild(this.textNode);
    e&&this.setHandler(e)};CB.inherit(d,CB.Button);d.prototype.onResize=function(){var b=Math.round(.8*this.h);this.style.fontSize=b+"px";this.textNode.style.fontSize=b+"px";this.textNode.style.lineHeight=this.h+"px"};return d}();"use strict";CB.namespace("CB.CheckBox");
CB.CheckBox=function(){var d=function(b,c){CB.CheckBox.superClass.call(this,"form",b,c);this.checkId=this.elDOM.id+"-chk";this.htmlFirstPart='<input type="checkbox" id='+this.checkId+" />";this.elDOM&&(this.elDOM.innerHTML=this.htmlFirstPart)};CB.inherit(d,CB.Element);d.prototype.setChecked=function(b){var c=document.getElementById(this.checkId);c.checked=c.defaultChecked=b};d.prototype.getChecked=function(){return document.getElementById(this.checkId).checked};d.prototype.setEnabled=function(b){document.getElementById(this.checkId).disabled=
    !b};d.prototype.getEnabled=function(){return!document.getElementById(this.checkId).disabled};d.prototype.setText=function(b){b.replace(/</g,"(");b.replace(/>/g,")");this.elDOM&&(this.elDOM.innerHTML=this.htmlFirstPart+b)};return d}();"use strict";
CB.Canvas2D=function(){var d=function(b,c,e){this.canvas=document.getElementById(b);if(null===this.canvas)throw Error("ID "+b+" not found.");this.ctx=this.canvas.getContext("2d");this._createDoubleBuffer(b);this._addListeners(b);this.idDOM=b;this.zoomRatio=this.calcZoomRatio();this.control=c.createControl(this,this.canvas.width,this.canvas.height,e);if(c.onControlReady)c.onControlReady(this.control);this.resizeTimer=new CB.Timer(this.resizeHdl.bind(this))};d.prototype.destroyDOM=function(){this.resizeTimer.stop();
    this.el&&null!=this.el.destroy&&this.el.destroy();this.control.onDestroyDOM()};d.prototype.drawLine=function(b,c){this.ctx.beginPath();this.ctx.moveTo(b.x,b.y);this.ctx.lineTo(c.x,c.y);this.ctx.stroke()};d.prototype.drawText=function(b,c,e,d){void 0!==d&&(this.ctx.fillStyle=d);void 0!==e&&(this.ctx.font=e+"px sans serif");this.ctx.fillText(c,b.x,b.y)};d.drawEllipse=function(b,c,e,d,g){b.save();b.beginPath();b.translate(c-d,e-g);b.scale(d,g);b.arc(1,1,1,0,2*Math.PI,!1);b.restore();b.lineWidth=5;b.stroke()};
    d.prototype.resize=function(b,c){5>b&&(b=5);5>c&&(c=5);this.blockResize||(this.control&&this.control.beforeResize&&this.control.beforeResize(),this.resizeTimer.runOnce(10,function(){this.resizeHdl(b,c)}.bind(this)))};d.prototype.setBlockResize=function(b){this.blockResize=b};d.prototype.onMouseDown=function(b){CB.LOG("Mouse Down: "+b.pageX+", "+b.pageY,"","mouse");var c=this.zoomToPixEvent(b),e=new CB.Rect;e.fromRect(this.canvas.getBoundingClientRect());CB.LOG("Scaled: "+c.x+", "+c.y+", boundRect="+
        e);this.control.onMouseDown(b,c);return!1};d.prototype.onContextMenu=function(b){CB.LOG("ContextMenu: "+b.pageX+", "+b.pageY,"","mouse");var c=this.zoomToPixEvent(b),e=new CB.Rect;e.fromRect(this.canvas.getBoundingClientRect());CB.LOG("Scaled: "+c.x+", "+c.y+", boundRect="+e,"","mouse");if(this.control.onContextMenu)this.control.onContextMenu(b,c);b.preventDefault();return!1};d.prototype.onMouseUp=function(b){CB.LOG("Mouse Up","","mouse");var c=this.zoomToPixEvent(b);this.control.onMouseUp(b,c);return!1};
    d.prototype.onMouseMove=function(b){var c=this.zoomToPixEvent(b);this.control.onMouseMove(b,c);return!1};d.prototype.onMouseWheel=function(b){var c=this.zoomToPixEvent(b);this.control.onMouseWheel(b,c)};d.prototype.onDoubleClick=function(b){var c=this.zoomToPixEvent(b);CB.LOG("DCLICK:"+this.getClickPos(c),"","mouse");this.getClickPos(c);this.control.onDoubleClick(b,c)};d.prototype.onMouseEnter=function(b){var c=this.zoomToPixEvent(b);this.control.onMouseEnter(b,c)};d.prototype.onMouseLeave=function(b){var c=
        this.zoomToPixEvent(b);this.control.onMouseLeave(b,c)};d.prototype.onTouchStart=function(b){if(!this.isDefaultPrevented(b)){CB.LOG("Touch Start","","touch");b.touches&&(this.touchStartX=b.touches[0].clientX,this.touchStartY=b.touches[0].clientY);var c=this.zoomToPixEvent(b);this.control.onMouseDown(b,c)}};d.prototype.onTouchEnd=function(b){if(!this.isDefaultPrevented(b)){delete this.touchStartX;CB.LOG("Touch End","","touch");var c=this.zoomToPixEvent(b);this.control.onMouseUp(b,c)}};d.prototype.onTouchMove=
        function(b){if(!this.isDefaultPrevented(b)){CB.LOG("Touch Move","","touch");var c=this.zoomToPixEvent(b);this.control.onMouseMove(b,c);delete this.touchStartX}};d.prototype.isDefaultPrevented=function(b){return void 0!==b.parentEvent&&void 0!==b.parentEvent.browserEvent?b.parentEvent.browserEvent.defaultPrevented:b.defaultPrevented};d.prototype.onTouchLeave=function(b){delete this.touchStartX};d.prototype.onTouchCancel=function(b){delete this.touchStartX;CB.LOG("Touch Cancel","","touch")};d.prototype.onKeyDown=
        function(b){CB.LOG("Key Down")};d.prototype.onKeyUp=function(b){CB.LOG("Key Up")};d.prototype.onKeyPress=function(b){CB.LOG("Key Press")};d.prototype.zoomToPixEvent=function(b){return b.touches&&b.touches.length?new CB.Point(this.zoomToPixX(b.touches[0].pageX),this.zoomToPixY(b.touches[0].pageY)):b.changedTouches&&b.changedTouches.length?new CB.Point(this.zoomToPixX(b.changedTouches[0].pageX),this.zoomToPixY(b.changedTouches[0].pageY)):new CB.Point(this.zoomToPixX(b.pageX),this.zoomToPixY(b.pageY))};
    d.prototype.zoomToPixX=function(b){return(b-this.canvas.getBoundingClientRect().left-window.pageXOffset)*this.zoomRatio};d.prototype.zoomToPixY=function(b){return(b-this.canvas.getBoundingClientRect().top-window.pageYOffset)*this.zoomRatio};d.prototype.pixToZoomX=function(b){return this.canvas.getBoundingClientRect().left-window.pageXOffset+b/this.zoomRatio};d.prototype.pixToZoomY=function(b){return this.canvas.getBoundingClientRect().top-window.pageYOffset+x/this.zoomRatio};d.prototype.zoomToPix=
        function(b){return this.zoomRatio?b/this.zoomRatio:b};d.prototype.pixToZoom=function(b){return this.zoomRatio?b/this.zoomRatio:b};d.prototype.zoomToPix=function(b){return this.zoomRatio?b*this.zoomRatio:b};d.prototype.zoomToPixRect=function(b){var c=this.zoomToPix(b.left),e=this.zoomToPix(b.top);return new CB.Rect(c,e,c+b.w*this.zoomRatio,e+b.h*this.zoomRatio)};d.prototype.pixToZoomRect=function(b){var c=this.pixToZoom(b.left),e=this.pixToZoom(b.top);return new CB.Rect(c,e,c+b.w/this.zoomRatio,e+
        b.h/this.zoomRatio)};d.prototype.getClickPos=function(b){var c=this.canvas.getBoundingClientRect();return new CB.Point(b.getX()-c.left,b.getY()-c.top)};d.prototype.getBoundingClientRect=function(){var b=this.canvas.getBoundingClientRect();return new CB.Rect(b.left,b.top,b.right,b.bottom)};d.prototype.execStr=function(b){};d.prototype._addListeners=function(b){b=CB.$.get(b);b=CB.$(b);CB.Element.isEventSupported("touchstart")&&(b.on("touchstart",this.onTouchStart.bind(this)),b.on("touchend",this.onTouchEnd.bind(this)),
        b.on("touchmove",this.onTouchMove.bind(this)),b.on("touchcancel",this.onTouchCancel.bind(this)),b.on("touchleave",this.onTouchLeave.bind(this)));CB.Element.isEventSupported("mousedown")&&(b.on("mousedown",this.onMouseDown.bind(this)),b.on("mouseup",this.onMouseUp.bind(this)),b.on("mousemove",this.onMouseMove.bind(this)),b.on("mousewheel",this.onMouseWheel.bind(this)),b.on("mouseenter",this.onMouseEnter.bind(this)),b.on("mouseleave",this.onMouseLeave.bind(this)),b.on("dblclick",this.onDoubleClick.bind(this)));
        if(CB.Element.isEventSupported("contextmenu"))b.on("contextmenu",this.onContextMenu.bind(this));b.on("keydown",this.onKeyDown.bind(this));b.on("keyup",this.onKeyUp.bind(this));b.on("keypress",this.onKeyPress.bind(this))};d.prototype._createDoubleBuffer=function(b){this.buffer=document.createElement("canvas");this.buffer.width=this.canvas.width;this.buffer.height=this.canvas.height;this.bufferCtx=this.buffer.getContext("2d")};d.prototype.cutClipRect=function(b){this.clipRect=this.clipRect?this.clipRect.getCutAtBoundary(b):
        b};d.prototype._drawDoubleBufferClipped=function(){this.ctx.save();this.clipRect?CB.CanvasTools.clipRect(this.ctx,this.clipRect):CB.CanvasTools.clipRect(this.ctx,new CB.Rect(1,1,this.canvas.width-1,this.canvas.height-1));this.ctx.globalCompositeOperation="copy";try{this.ctx.drawImage(this.buffer,0,0)}catch(b){}this.ctx.restore();delete this.clipRect;this.dirty=!1;this.requestIdClipped=null};d.prototype._drawDoubleBuffer=function(){CB.LOG("DrawDBuff");var b=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation=
        "copy";this.ctx.drawImage(this.buffer,0,0);this.ctx.globalCompositeOperation=b;this.dirty=!1;delete this.clipRect;this.requestId=null};d.prototype.joinClipRect=function(b){this.clipRect=this.clipRect?this.clipRect.getUnion(b):b};d.prototype.cancelAnimationFrames=function(){this.requestIdClipped&&window.cancelAnimationFrame(this.requestIdClipped);this.requestId&&window.cancelAnimationFrame(this.requestId)};d.prototype.block=function(b){this.blocked=b};d.prototype.requestAnimation=function(b){this.blocked||
    1>this.canvas.width||1>this.canvas.height||(b?(this.joinClipRect(b),this.dirty=!0,this.requestIdClipped&&window.cancelAnimationFrame(this.requestIdClipped),this.requestIdClipped=window.requestAnimationFrame(this._drawDoubleBufferClipped.bind(this))):(this.dirty=!0,this.requestId&&(CB.LOG("Cancel Anim="+this.requestIdClipped),window.cancelAnimationFrame(this.requestId)),this.requestIdClipped&&window.cancelAnimationFrame(this.requestIdClipped),this.clipRect=new CB.Rect(1,1,this.canvas.width,this.canvas.height),
        this.requestId=window.requestAnimationFrame(this._drawDoubleBufferClipped.bind(this))))};d.prototype.onControlForegroundReady=function(){this.control.drawForeground(this.bufferCtx)};d.prototype.onControlBackgroundReady=function(){this.control&&this.control.drawWood&&this.control.drawWood(this.bufferCtx)};d.prototype.resizeHdl=function(b,c){b=Math.floor(b);c=Math.floor(c);this.scaleToBrowserZoom(b,c)||(this.clipRect=this.lastClipRect=new CB.Rect(0,b,0,c),this.zoomRatio=1,this.setCanvasSizeNonZoomed(this.canvas,
        b,c),this.setCanvasSizeNonZoomed(this.buffer,b,c),this.control&&this.control.resize(b,c))};d.prototype.setCanvasSizeNonZoomed=function(b,c,e){b.width=c;b.height=e;b.style.width=c+"px";b.style.height=e+"px"};d.prototype.scaleToBrowserZoom=function(b,c){return 1!=this.calcZoomRatio()?(this.clipRect=this.lastClipRect=new CB.Rect(0,b,0,c),this.zoomRatio=this.calcZoomRatio(),this.scaleCanvas(this.canvas,this.ctx,b,c,this.zoomRatio),this.scaleCanvas(this.buffer,this.bufferCtx,b,c,this.zoomRatio),this.control.resize(b*
        this.zoomRatio,c*this.zoomRatio),!0):!1};d.prototype.calcZoomRatio=function(){var b=window.devicePixelRatio;b=Math.min(3,b);CB.System.overrideDeviceZoom(b);return b};d.prototype.scaleCanvas=function(b,c,e,d,g){b.width=Math.round(e*g);b.height=Math.round(d*g);b.style.width=e+"px";b.style.height=d+"px";CB.LOG("CanvasWH="+b.width+", "+b.height,"","canv")};d.prototype.getBackStorePixelRatio=function(){return this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||
        this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1};d.prototype.getDevicePixelRatio=function(){alert(0);return window.devicePixelRatio};d.prototype.hide=function(){this.canvas.style.visibility="hidden"};d.prototype.show=function(){this.canvas.style.visibility="visible"};d.prototype.requestRedraw=function(){this.blocked||(delete this.clipRect,this.control&&this.control.draw(this.bufferCtx),this.requestAnimation(new CB.Rect(1,1,this.canvas.width-1,this.canvas.height-1),!0))};return d}();
(function(){for(var d=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];for(c=0;c<b.length&&!window.cancelAnimationFrame;++c)window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          c){var e=(new Date).getTime(),f=Math.max(0,16-(e-d));c=window.setTimeout(function(){b(e+f)},f);d=e+f;return c});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(b){clearTimeout(b)})})();"use strict";
CB.Storage=function(){var d=function(){window.localStorage?this.storage=window.localStorage:window.sessionStorage&&(this.storage=window.sessionStorage)};d.prototype.save=function(b,c){c&&void 0!==this.storage&&(this.storage[b]=JSON.stringify(c))};d.prototype.load=function(b){if(void 0!==this.storage&&this.storage[b]&&"undefined"!==this.storage[b])return JSON.parse(this.storage[b])};return d}();"use strict";
CB.Audio=function(){var d=1,b=function(b,e,f){this.audio=document.createElement("audio");var c=this.getFormat();this.ok=!1;c?(this.url=b+c,this.audio.addEventListener("canplay",this.onCanPlay.bind(this),!1),this.audio.addEventListener("canplaythrough",this.onCanPlayThrough.bind(this),!1),this.audio.addEventListener("ended",this.onEnded.bind(this),!1),this.audio.addEventListener("error",this.onError.bind(this),!1),this.audio.addEventListener("abort",this.onError.bind(this),!1),this.audio.src=b+c,this.fnEnded=
    e,this.isQueued=this.canPlay=!1,this.uniqueId=d++,f?this.audio.preload="none":(this.audio.preload="metadata",this.audio.load(),this.ok=!0)):(CB.LOG("Audio not supported","LogError"),this.url="!format!")};b.prototype.load=function(){this.audio.load();this.ok=!0};b.prototype.toString=function(){return this.url};b.prototype.play=function(){try{this.audio.play()}catch(c){console.log(c)}};b.prototype.pause=function(){this.audio.pause()};b.prototype.onCanPlay=function(){};b.prototype.onCanPlayThrough=function(){};
    b.prototype.onEnded=function(){this.fnEnded&&this.fnEnded(this.uniqueId)};b.prototype.onError=function(){};b.prototype.getFormat=function(){if(this.audio.canPlayType){var b=this.audio.canPlayType("audio/mpeg");if(""!=b)return".mp3";b=this.audio.canPlayType("audio/ogg");if(""!=b)return".ogg"}return""};return b}();
CB.AudioQueue=function(){var d=function(){this.queue=[];this.nextId=0;this.enabled=!0};d.prototype.push=function(b){if(this.enabled&&b){var c=b;"string"==typeof b&&(c=new CB.Audio(b));c.fnEnded=this.callBackPlayed.bind(this);c.ok&&this.queue.push(c);1==this.queue.length&&c.play()}};d.prototype.enable=function(b){(this.enabled=b)||this.stopAll()};d.prototype.isEnabled=function(){return this.enabled};d.prototype.stopAll=function(){this.currPlaying&&this.currPlaying.pause();for(var b=0;b<this.queue.length;b++)this.queue[b]&&
this.queue[b].pause();this.queue=[];delete this.currPlaying};Object.defineProperty(d.prototype,"length",{get:function(){return this.queue.length},set:function(b){this.queue.length>b&&this.queue.splice(0,this.queue.length-b)},enumerable:!0});d.prototype.callBackPlayed=function(b){for(var c=0;c<this.queue.length;c++)if(this.queue[c]&&this.queue[c].uniqueId==b){c<this.queue.length-1&&this.queue[c+1].play();this.queue.splice(c,1);break}};return d}();"use strict";
CB.Canvas3D=function(){var d=function(b,c){this.control=c.createControl3D(b,0,0);if(c.onControlReady)c.onControlReady(this.control);this._addListeners(b);this.resizeTimer=new CB.Timer(this.resizeHdl.bind(this))};d.prototype.onThreeRender=function(b,c){this.control.onThreeRender(b,c)};d.prototype.dispose=function(){this.control.dispose()};d.prototype.drawLine=function(b,c){};d.prototype.drawText=function(b,c,e,d){};d.prototype.resize=function(b,c){this.width=b;this.height=c;this.blockResize||this.resizeTimer.runOnce(100,
    function(){this.resizeHdl(b,c)}.bind(this))};d.prototype.renderScene=function(){};d.prototype.resizeHdl=function(b,c){b=Math.floor(b);c=Math.floor(c);this.control.resize(b,c)};d.prototype.block=function(b){this.blocked=b};d.prototype.setBlockResize=function(b){this.blockResize=b};d.prototype.onTouchStart=function(b){this.control.onTouchStart(b)};d.prototype.onTouchEnd=function(b){this.control.onTouchEnd(b)};d.prototype.onTouchMove=function(b){this.control.onTouchMove(b)};d.prototype.onTouchCancel=
    function(b){this.control.onTouchCancel(b)};d.prototype.onTouchLeave=function(b){this.control.onTouchLeave(b)};d.prototype.onMouseDown=function(b){this.control.onMouseDown(b)};d.prototype.onMouseUp=function(b){this.control.onMouseUp(b)};d.prototype.onMouseMove=function(b){this.control.onMouseMove(b)};d.prototype.onMouseWheel=function(b){CB.LOG("Wheel:"+b.getWheelDelta())};d.prototype.onDoubleClick=function(b){CB.LOG("DCLICK:"+this.getClickPos(b));this.getClickPos(b);this.control.onDoubleClick(b)};
    d.prototype.onMouseEnter=function(b){this.control.onMouseEnter(b)};d.prototype.onMouseLeave=function(b){this.control.onMouseLeave(b)};d.prototype.onKeyDown=function(b){CB.LOG("Key Down")};d.prototype.onKeyUp=function(b){CB.LOG("Key Up")};d.prototype.onKeyPress=function(b){CB.LOG("Key Press")};d.prototype.getClickPos=function(b){var c=this.canvas.getBoundingClientRect();return new CB.Point(b.getX()-c.left,b.getY()-c.top)};d.prototype.getBoundingClientRect=function(){var b=this.canvas.getBoundingClientRect();
        return new CB.Rect(b.left,b.top,b.right,b.bottom)};d.prototype.execStr=function(b){};d.prototype._addListeners=function(b){CB.Element.isEventSupported("touchstart")&&(b.canvas.addEventListener("touchstart",this.onTouchStart.bind(this),!1),b.canvas.addEventListener("touchend",this.onTouchEnd.bind(this),!1),b.canvas.addEventListener("touchmove",this.onTouchMove.bind(this),!1),b.canvas.addEventListener("touchcancel",this.onTouchCancel.bind(this),!1),b.canvas.addEventListener("touchleave",this.onTouchLeave.bind(this),
        !1));b.canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!1);b.canvas.addEventListener("mousemove",this.onMouseMove.bind(this),!1);b.canvas.addEventListener("mouseup",this.onMouseUp.bind(this),!1)};d.prototype.cutClipRect=function(b){this.clipRect=this.clipRect?this.clipRect.getCutAtBoundary(b):b};d.prototype.joinClipRect=function(b){this.clipRect=this.clipRect?this.clipRect.getUnion(b):b};d.prototype.requestAnimation=function(b,c){};d.prototype.onControlForegroundReady=function(){CB.LOG("onControlForegroundReady");
        this.control.drawForeground(this.ctx);this.control.drawForeground(this.bufferCtx)};d.prototype.onControlBackgroundReady=function(){this.control.draw(this.ctx);this.control.draw(this.bufferCtx)};d.prototype.requestRedraw=function(){this.renderScene()};d.prototype.pixToZoom=function(b){return this.zoomRatio?b/this.zoomRatio:b};d.prototype.zoomToPix=function(b){return this.zoomRatio?b*this.zoomRatio:b};d.prototype.zoomToPixRect=function(b){var c=this.zoomToPix(b.left),e=this.zoomToPix(b.top);return new CB.Rect(c,
        e,c+b.w*this.zoomRatio,e+b.h*this.zoomRatio)};d.prototype.pixToZoomRect=function(b){var c=this.pixToZoom(b.left),e=this.pixToZoom(b.top);return new CB.Rect(c,e,c+b.w/this.zoomRatio,e+b.h/this.zoomRatio)};return d}();
(function(){for(var d=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];for(c=0;c<b.length&&!window.cancelAnimationFrame;++c)window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          c){var e=(new Date).getTime(),f=Math.max(0,16-(e-d));c=window.setTimeout(function(){b(e+f)},f);d=e+f;return c});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(b){clearTimeout(b)})})();"use strict";
CB.Queue=function(){var d=function(){this.nOffset=0;this.queue=[]};d.prototype={getLength:function(){return this.queue.length-this.nOffset},empty:function(){return 0==this.queue.length},push:function(b){this.queue.push(b)},pop:function(){if(0!=this.queue.length){var b=this.queue[this.nOffset];2*++this.nOffset>=this.queue.length&&(this.queue=this.queue.slice(this.nOffset),this.nOffset=0);return b}},front:function(){return 0<this.queue.length?this.queue[this.nOffset]:void 0}};return d}();"use strict";
CB.BinToString={StringToByteArray:function(d,b){for(var c=0,e=0,f=0,g=0;g<b.length;g++){var h=b[g].charCodeAt(0);if(63>h||126<h)return 1;h-=63;2>=e?(f|=h<<2-e,e+=6,8<=e&&(e-=8,d[c++]=f&255,f=0)):(e-=2,f|=h>>e,d[c++]=f&255,f=h<<8-e)}return c},ByteArrayToString:function(d,b){var c="";if(0<b){for(var e=[],f=0,g=0,h=0;g<b;)2>=h?(e[f++]=63+(d[g]>>2-h&63)&255,h+=6,8<=h&&(g++,h-=8)):(h-=2,e[f]=d[g]<<h&63,g++,g<b?e[f]|=d[g]>>8-h&63:h=0,e[f++]+=63);for(d=e[f]=0;d<f;d++)c+=String.fromCharCode(e[d])}else c=
        "";return c},ByteArrayToBase64:function(d){for(var b="",c,e,f,g,h,k,l=0;l<d.length;)c=d[l++],e=d[l++],f=d[l++],g=c>>2,c=(c&3)<<4|e>>4,h=(e&15)<<2|f>>6,k=f&63,isNaN(e)?h=k=64:isNaN(f)&&(k=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);
        return b},ByteArrayToDataURI:function(d,b){d=this.ByteArrayToBase64(d);return"data:"+b+";charset=utf-8;base64,"+d}};"use strict";CB.LineEvalType={LOWERBOUND:1,UPPERBOUND:2,EXACT:3};
CB.EngineValue=function(){var d={MATE_VALUE:3E4,MATE_THRESHOLD:28E3,MOVE_VALUE:28E3,MOVE_THRESHOLD:26E3};d.MIN_VALUE=-d.MATE_VALUE;d.MAX_VALUE=d.MATE_VALUE;d.getMateEval=function(b){return 0>b?-d.MATE_VALUE-b:d.MATE_VALUE-b};d.getMovesToMate=function(b){return b>-d.MATE_THRESHOLD||b<d.MATE_THRESHOLD?-1:0>b?b-d.MATE_THRESHOLD:d.MATE_THRESHOLD-b};return d}();
CB.EvaluationGrade=function(){var d={EV_TOTALLY_WINNING:200,EV_WINNING:140,EV_ADVANTAGE:70,EV_SLIGHT_ADVANTAGE:25};d.EV_TOTALLY_LOSING=-d.EV_TOTALLY_WINNING;d.EV_LOSING=-d.EV_WINNING;d.EV_DISADVANTAGE=-d.EV_ADVANTAGE;d.EV_SLIGHT_DISADVANTAGE=-d.EV_SLIGHT_ADVANTAGE;d.getGlyph=function(b){return b>=d.EV_WINNING?CB.SpecialGlyphs.W_DECIS_ADV:b>=d.EV_ADVANTAGE?CB.SpecialGlyphs.W_MODER_ADV:b>d.EV_SLIGHT_ADVANTAGE?CB.SpecialGlyphs.W_SLIGHT_ADV:b>=d.EV_SLIGHT_DISADVANTAGE?CB.SpecialGlyphs.EQUAL_ACTIVE_POS:
    b>d.EV_DISADVANTAGE?CB.SpecialGlyphs.B_SLIGHT_ADV:b>d.EV_LOSING?CB.SpecialGlyphs.B_MODER_ADV:CB.SpecialGlyphs.B_DECIS_ADV};return d}();CB.PredefinedEngineOptions={MultiPV:"MultiPV",Ponder:"Ponder"};
CB.EngineInstance=function(){var d={getPosString:function(b){var c="position startpos";b.isNormalInit()||(c="position fen "+b.getStartPos().toFEN());b=b.getCurLineCut();if(0<b.length){c+=" moves";for(var d=0;d<b.length;++d)c+=" "+b[d].toString()}return c},getGoString:function(b){var c=new StringBuilder;c.append("go ");b=b||{};b.depth?c.appendFormat("depth {0} ",b.depth):b.moveTime&&c.appendFormat("movetime {0} ",Math.round(b.moveTime));b.wTime&&c.appendFormat("wtime {0} ",Math.round(b.wTime));b.bTime&&
    c.appendFormat("btime {0} ",Math.round(b.bTime));(b.infinite||ObjUtil.isEmpty(b))&&c.appendFormat("infinite ");return c.toString()},getSetOptionString:function(b,e){b=String.formatEx("setoption name {0}",b);"undefined"!==typeof e&&(b+=String.formatEx(" value {0}",e));return b}},b=function(c,e,d,g){console.log(c);CB.LOG(c);this.url=c;this.worker=null;this.calculating=!1;this.tag=d||null;this.name=g;this.szPool=e;this.pool=[];this.cur=null;this.lines=[];this.meta={name:"",author:""};this.metaDone=!1;
    this.szPool&&(this.idPoolTimeout=setInterval(this._poolTimeout.bind(this),b.POOL_TIMEOUT));this.engOptionVals=CB.EngineInstance._createPreDefaultOptions();0<this.szPool&&this._pushWorker();this.id=++b.engineCount;this.minDepthForFire=0};b.engineCount=0;b._createPreDefaultOptions=function(){var b={};b[CB.PredefinedEngineOptions.MultiPV]=1;b[CB.PredefinedEngineOptions.Ponder]="false";return b};b.prototype.setMinDepthForFire=function(b){this.minDepthForFire=b};b.prototype.getTag=function(){return this.tag};
    b.prototype.setTag=function(b){this.tag=b};b.prototype._killWorker=function(){CBDebug.assert(null!=this.worker);CBDebug.assert(this.calculating);this.calculating=!1;this.worker.terminate();this.worker=null;this.loadingWorker=!1};b.prototype._handleBestMove=function(b){b=b.split(" ");var c=CB.Move.fromString(b[1]),d;"ponder"==b[2]&&(d=CB.Move.fromString(b[3]));this.calculating=!1;this.fireOnBestMove(this,{move:c,ponder:d})};b.prototype._handleInfo=function(b){for(var c=b.split(" "),d=b=null,g=null,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           h=1,k=null,l=null,m=null,p=null,r=null,t=null,w=CB.LineEvalType.EXACT,q=!1,u=1;u<c.length;++u)switch(c[u]){case "depth":b=parseInt(c[++u]);break;case "seldepth":d=parseInt(c[++u]);break;case "nps":l=parseInt(c[++u]);break;case "nodes":m=parseInt(c[++u]);break;case "score":var y=c[++u];g=parseInt(c[++u]);switch(y){case "mate":q=!0}break;case "time":p=parseInt(c[++u]);break;case "currmovenumber":t=parseInt(c[++u]);break;case "currmove":y=c[++u];r=CB.Move.fromString(y);break;case "lowerbound":w=CB.LineEvalType.LOWERBOUND;
        break;case "upperbound":w=CB.LineEvalType.UPPERBOUND;break;case "multipv":h=parseInt(c[++u]);break;case "pv":for(k=[],++u;u<c.length;++u)if(y=c[u],CB.Move.isValidString(y))k.push(CB.Move.fromString(y));else{--u;break}}d=d||b;b&&b>this.minDepthForFire&&this.fireOnInfo(this,b,d,m,l,p);r&&(this.linesOnly||this.fireOnCurMove(this,t,r));k&&(this.lines[h-1]=k,b>this.minDepthForFire||2>=b)&&(c=ObjUtil.clone(k),this.fireOnLine(this,b,d,w,q,g,h,c,{handicapStyle:0,analysis:this.currGoOptions&&this.currGoOptions.infinite}))};
    b.g_regexMeta=/^id (\w+) (.*)$/i;b.prototype._handleIdInfo=function(c){this.metaDone||(c=b.g_regexMeta.exec(c))&&c.length&&(this.meta[c[1]]=c[2])};b.prototype._handleUCIOK=function(b){this.metaDone||(this.metaDone=!0,this.linesOnly||this.fireOnUCIInfo(this))};b.prototype._handle=function(b){"readyok"!==b&&("uciok"===b?this._handleUCIOK():b.startsWith("id")?this._handleIdInfo(b):b.startsWith("option")||(b.startsWith("bestmove")?this._handleBestMove(b):b.startsWith("info")&&this._handleInfo(b)))};b.prototype._onMessage=
        function(b){this.loadingWorker=!1;this._handle(b.data)};b.prototype._post=function(b){try{this.worker&&this.worker.postMessage(b)}catch(e){CB.LogException("Post",e)}};b.POOL_TIMEOUT=4E3;b.prototype.pool=[];b.prototype._getWorker=function(){if(0==this.pool.length)try{return new Worker(this.url)}catch(c){alert("Engine: "+c)}return this.pool.pop()};b.prototype._poolTimeout=function(){this.pool.length>=this.szPool||this._pushWorker()};b.prototype._pushWorker=function(){try{CB.EngineInstance.isAjax?this._startWorkerAjax(function(b){this.pool.push(b)}.bind(this)):
        this.pool.push(new Worker(this.url))}catch(c){CB.LogException("Engine "+this.url,c)}};b.prototype._startWorker=function(){try{if(this.worker=this._getWorker())this.worker.onmessage=this._onMessage.bind(this),this._post("uci"),this._post("isready"),this._sendPendingOptions()}catch(c){CB.LogException("Start this.url",c)}};b.prototype.go=function(b,e){this.currGoOptions=e||{infinite:!0};this.stop();this.calculating=!0;this.linesOnly||this.fireOnSearchStart();if(this.worker||this.loadingWorker)CB.LOG("Go, Worker already there");
    else{this.loadingWorker=!0;if(CB.EngineInstance.isAjax){this._startWorkerAjax(function(b){return function(c){this.loadingWorker=!1;this.worker=c;this.worker.onmessage=this._onMessage.bind(this);this._post("uci");this._post("isready");this._sendPendingOptions();c=d.getPosString(b);var e=d.getGoString(this.currGoOptions);""!=e&&(this.cur=ObjUtil.clone(b.getCurPos()),this.lines=[],this._post(c),this._post(e))}.bind(this)}.call(this,b));return}this._startWorker()}e=d.getPosString(b);var c=d.getGoString(this.currGoOptions);
        ""!=c&&(this.cur=ObjUtil.clone(b.getCurPos()),this.lines=[],this._post(e),this._post(c))};b.prototype.getCurPos=function(){return this.cur};b.prototype.getLines=function(){return this.lines};b.prototype.getBestMove=function(){return 0==this.lines.length||0==this.lines[0].length?null:this.lines[0][0]};b.prototype.stop=function(){this.worker&&this.calculating&&(this._post("quit"),this._killWorker())};b.prototype.getName=function(){return this.meta.name};b.prototype.isCalculating=function(){return this.calculating};
    b.prototype.setHighestMoveInBook=function(){};b.prototype.newGame=function(){this.worker&&!this.calculating&&this._post("ucinewgame");this.linesOnly||this.fireOnNewGame()};b.prototype.dispose=function(){if(this.szPool){if(this.pool.length)for(var b=0;b<this.pool.length;++b)this.pool[b].terminate();clearInterval(this.idPoolTimeout)}this.removeAllListeners()};b.prototype.exit=function(){this.stop();this.dispose();this.fireOnExit()};b.prototype.engOptionVals=null;b.prototype.setOption=function(b,e){this.engOptionVals[b]=
        e;this.worker&&this._post(d.getSetOptionString(b,e))};b.prototype.getOption=function(b){return this.engOptionVals[b]};b.prototype.setMultiPV=function(b){this.setOption(CB.PredefinedEngineOptions.MultiPV,b)};b.prototype.getMultiPV=function(){return this.getOption(CB.PredefinedEngineOptions.MultiPV)};b.prototype.clearHash=function(){};b.prototype.setPonder=function(b){this.setOption(CB.PredefinedEngineOptions.Ponder,b?"true":"false")};b.prototype.offerDrawToEngine=function(){return!1};b.prototype._sendPendingOptions=
        function(){for(var b in this.engOptionVals)this.engOptionVals.hasOwnProperty(b)&&this._post(d.getSetOptionString(b,this.engOptionVals[b]))};b.prototype._startWorkerAjax=function(b){var c="https://pgn.chessbase.com/common/chess/engine/df14/df14AjaxData.js";V15.canRunWebAssembly()&&(c="https://pgn.chessbase.com/common/chess/engine/webasm/fritzajax3.js");$.ajax({url:c,type:"GET",data:{},async:!0,cache:!0,processData:!1,success:function(c){c=new Blob([c],{type:"application/javascript"});c=new Worker(URL.createObjectURL(c));
            b(c)}})};Ve.initForListeners(b);Ve.addEvent(b,"Line");Ve.addEvent(b,"LosingLine");Ve.addEvent(b,"CurMove");Ve.addEvent(b,"CurLine");Ve.addEvent(b,"Info");Ve.addEvent(b,"BestMove");Ve.addEvent(b,"UCIInfo");Ve.addEvent(b,"NewGame");Ve.addEvent(b,"SearchStart");Ve.addEvent(b,"Exit");Ve.addEvent(b,"Threat");return b}();"use strict";
CB.AnalysisEngine=function(){var d={},b=function(c){c=c||{};this.options=ObjUtil.copyTo(d,c,!0);this.szPool=0;V15.canRunWebAssembly()&&(this.szPool=4);this.loadEngineInstance();this.id=++b.engineCount};b.engineCount=0;b.prototype.destroy=function(){};b.prototype.loadEngineInstance=function(){this.engine=new CB.EngineInstance(V15.config.getEngineUrl()[0],this.szPool,1,"Analysis");this.options.minDepthForFire&&this.engine.setMinDepthForFire(this.options.minDepthForFire);this.idOnLine=this.engine.addOnLineListener(this._onLine.bind(this))};
    b.prototype.onGameNavigate=function(){};b.prototype.engineGo=function(b){this._resetGoState();this.kernel=b;this.engine.setMultiPV(this._getNVarsToCalc());this.engine.go(this.kernel.game,{infinite:!0});this.engine.fireOnThreat(!1);this.running=!0};b.prototype.threatGo=function(b){this._resetGoState();this.engine.setMultiPV(2);this.engine.go(b,{infinite:!0});this.running=!0};b.prototype.engineStop=function(){this.engine.stop();this.running=!1};b.prototype.clearLines=function(){this._resetGoState()};
    b.prototype.dispose=function(){this.engine.exit()};b.prototype.linkPlayingMode=function(b){b.getMarkedSquaresOnButtonDown&&(b.clickHintTimer||(b.clickHintTimer=new CB.Timer),b.kernel.boardWin.fnMarkSquaresOnButtonDown=b.getMarkedSquaresOnButtonDown.bind(b),b.startClickHintTimer&&(b.kernel.boardWin.fnSquareClick=b.startClickHintTimer.bind(b)),b.kernel.boardWin.fnSquareChangeInMouseMove=function(){b.clickHintTimer&&b.clickHintTimer.stop()}.bind(b),b.kernel.boardWin.fnSquareRelease=function(){b.clickHintTimer&&
    b.clickHintTimer.stop()}.bind(b),b.idOnLineListener||(b.idOnLineListener=this.addOnLineListener(b.onAnalysisLine.bind(b)),b.kernel.boardWin.idOnLineListener||(b.kernel.boardWin.idOnLineListener=this.addOnLineListener(b.kernel.boardWin.refreshMarkedSquares.bind(b.kernel.boardWin)))))};b.prototype.unlinkPlayingMode=function(b){b.clickHintTimer&&b.clickHintTimer.stop();b.kernel.boardWin&&(b.kernel.boardWin.fnSquareClick=null,b.kernel.boardWin.fnMarkSquaresOnButtonDown=null,this.removeOnLineListener(b.kernel.boardWin.idOnLineListener),
        b.kernel.boardWin.idOnLineListener=null);this.removeOnLineListener(b.idOnLineListener);b.idOnLineListener=null};b.prototype.linkPlayingModeForThreat=function(b){b.idOnThreatLineListener||(b.idOnThreatLineListener=this.addOnLineListener(b.onThreatLine.bind(b)))};b.prototype.unlinkPlayingModeForThreat=function(b){this.removeOnLineListener(b.idOnThreatLineListener);b.idOnThreatLineListener=null};b.prototype._getNVarsToCalc=function(){return this.nFixedVars?this.nFixedVars:128};b.prototype.getHintSquaresOnButtonDown=
        function(b){var c=[];if(0<this.lastDepth){var d=CB.AnalysisEngine.linesToArray(this.curLines[this.lastDepth-1]);d.sort(function(b,c){return c.getEval()-b.getEval()});if(!d.length)return c;var g=d[0].getEval();d.forEach(function(e){var d=e.getEval();e.getMove().from==b&&c.push({sq:e.getMove().to,clr:this._getTargetSqClr(d,g),txt:g-d})}.bind(this))}return c};b.prototype.getCounterMoveTo=function(b,e){if(0<this.lastDepth){var c=CB.AnalysisEngine.linesToArray(this.curLines[this.lastDepth-1]);c.sort(function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     c){return c.getEval()-b.getEval()});if(c.length)for(var d=c[0].getEval(),h=0;h<c.length;h++){var k=c[h],l=k.getEval();if(k.getMove(0).from==b&&k.getMove(0).to==e)return{from:k.getMove(1).from,to:k.getMove(1).to,clr:this._getTargetSqClr(l,d)}}}};b.prototype._getTargetSqClr=function(b,e){if(23E3<Math.abs(b))return new CB.HSLColor(0,0,0,.6);b=e-b;e=.55+.15;e=[[2E4,0,95,55,1],[1E3,3,95,50,.9],[700,4,95,48,.9],[400,12,95,47,.9],[300,14,95,46,.9],[250,18,95,46,e],[200,19,95,45,.9],[170,20,90,60,.9],[140,
        24,90,60,.9],[120,28,90,60,.9],[100,30,90,60,.9],[90,34,90,45,.9],[80,38,90,45,e],[70,46,90,45,e],[60,50,90,45,e],[50,65,90,45,e],[40,70,90,45,.55],[30,75,90,45,.55],[20,80,90,45,.55],[15,90,90,45,.55],[10,100,90,45,.55],[7,110,90,45,.55],[5,115,90,42,.7],[0,120,90,42,.74]];for(var c=0;c<e.length;c++)if(b>=e[c][0])return new CB.HSLColor(e[c][1],e[c][2],e[c][3],e[c][4]);return new CB.HSLColor(CB.HSLColor.GREEN,90,40,.6)};b.prototype._resetGoState=function(){this.curLines=[];this.baseLines={};this.depthLines=
        [];this.depthArrLines=[];this.lastDepth=1;this.bestAt1Ply=null};b.prototype._onLine=function(b,e,d,g,h,k,l,m){if(g==CB.LineEvalType.EXACT){if(e>this.lastDepth){this.maxPVNum=0;0<this.lastDepth&&this.curLines[this.lastDepth]&&this.storeLines(ObjUtil.clone(this.curLines[this.lastDepth]),this.lastDepth);if(this.lastDepth&&this.depthArrLines[this.lastDepth]&&this.depthArrLines[this.lastDepth].length){if(1<this.depthArrLines[this.lastDepth].length){var c=this.depthArrLines[this.lastDepth][1];var f=this.depthArrLines[this.lastDepth][1].getEval()}(!this.options.minDepthForFire||
        this.lastDepth>=this.options.minDepthForFire||1==this.lastDepth)&&this.fireOnLine(this.lastDepth,this.depthArrLines[this.lastDepth][0].getEval(),this.depthArrLines[this.lastDepth][0],f,c)}this.lastDepth=e;(20<=e||(CB.System.isMobile()||CB.System.runsInIFrame())&&8<=e)&&this.engineStop()}h&&(k=CB.EngineValue.getMateEval(k));b=new CB.EvaluatedLine(m,k);this.curLines[this.lastDepth]||(this.curLines[this.lastDepth]={});this.curLines[this.lastDepth][b.key()]=b}};b.prototype.storeLines=function(b,e){this.depthLines[e]=
        b;this.depthArrLines[e]=CB.AnalysisEngine.linesToArray(b)};b.linesToArray=function(b){var c=[],d;for(d in b)b.hasOwnProperty(d)&&c.push(b[d]);c.sort(function(b,c){return c.getEval()-b.getEval()});for(b=0;b<c.length;b++)c[b].lineNumber=b;c.getNLinesInEvalRange=function(b){for(var c=0,d=this[0].getEval(),e=1;e<this.length&&!(d-this[e].getEval()>b);e++)c++;return c};c.hasClearlyBest=function(b){return 1==c.length?!0:c[0].getEval()-c[1].getEval()>=b};return c};b.prototype.getBestMove=function(){if(3<
        this.lastDepth){var b=CB.AnalysisEngine.linesToArray(this.curLines[this.lastDepth]);b.sort(function(b,c){return c.getEval()-b.getEval()});return b[0].getMove()}};Ve.initForListeners(b);Ve.addEvent(b,"Line");return b}();"use strict";
CB.Evaluation=function(){var d=function(b){this.val=b};d.getEvalString=function(b){return 2E4<b?lm.WHITE_MATES:420<b?lm.WHITE_CLEARLY_WINNING:350<b?lm.WHITE_WINNING:250<b?lm.WHITE_DECISIVE:130<b?lm.WHITE_CLEARLY_BETTER:80<b?lm.WHITE_BETTER:40<b?lm.WHITE_SLIGHTLY:22<b?lm.WHITE_EDGE:-2E4>b?lm.BLACK_MATES:-420>b?lm.BLACK_CLEARLY_WINNING:-350>b?lm.BLACK_WINNING:-250>b?lm.BLACK_DECISIVE:-130>b?lm.BLACK_CLEARLY_BETTER:-80>b?lm.BLACK_BETTER:-40>b?lm.BLACK_SLIGHTLY:-22>b?lm.BLACK_EDGE:lm.EQUAL_POS};d.getEmoticonUrl=
    function(b){b=d.getEmo(b);return CB.getCommonPath()+String.f("Media/Emojis/Fritz/Fritz{0}.png",b)};d.getSmilingEmoticonUrl=function(){return d.getEmoticonUrl(81)};d.getEmo=function(b){return 2E4<b?"Mates":420<b?"ClearlyWins":350<b?"Wins":250<b?"Decisive":130<b?"ClearlyBetter":80<b?"Better":40<b?"SlightlyBetter":22<b?"Equal":-420>b?"ClearlyLosing":-350>b?"Losing":-250>b?"DecisivelyWorse":-130>b?"ClearlyWorse":-80>b?"Worse":-40>b?"SlightlyWorse":"Equal"};d.prototype.toString=function(){return d.getEvalString(this.val)};
    return d}();"use strict";CB.EvaluatedLine=function(){var d=function(b,c){this.line=b;this.eval=c};d.prototype.getEval=function(){return this.eval};d.prototype.getLine=function(){return this.line};d.prototype.length=function(){return this.line.length};d.prototype.getMove=function(b){return this.line[b||0]};d.prototype.key=function(){return this.getMove().toString()};d.prototype.toString=function(){return String.formatEx("{eval}: {line}",this)};return d}();"use strict";
CB.EngineWrapper=function(){var d=function(b,c,d,f){this.nEngine=b;this.url=c;this.engine={};this.viewLink=d;this.gameLink=f};d.prototype.load=function(){var b=this;try{b.url.match(/http/i)?$.ajax({url:b.url,type:"GET",data:{},async:!0,cache:!0,processData:!1,success:function(c){c=new Blob([c],{type:"application/javascript"});b.engine=new Worker(URL.createObjectURL(c));b.engine.onmessage=d.prototype.onMessage.bind(b);b.engine.error=d.prototype.onError.bind(b);b.engine.postMessage({cmd:"reset"});b.isRunning=
        !1}}):(this.engine=new Worker(this.url),this.engine.onmessage=d.prototype.onMessage.bind(this),this.engine.error=d.prototype.onError.bind(this),this.engine.postMessage({cmd:"reset"}),this.isRunning=!1)}catch(c){}};d.prototype.unLoad=function(){this.abort()};d.prototype.newGame=function(){this.abort();this.engine.postMessage({cmd:"reset"})};d.prototype.makeMove=function(b){this.engine.postMessage({cmd:"move",move:b.toJSON()})};d.prototype.search=function(b,c){this.isRunning=!0;this.engine.postMessage({cmd:"search",
    timeout:b,maxdepth:c})};d.prototype.sendNewPos=function(b){this.abort();b=b.toFEN();this.engine.postMessage({cmd:"position",fen:b});this.viewLink&&this.viewLink.clearEngineOutput(this.nEngine)};d.prototype.sendNewGame=function(b,c){this.abort();this.engine.postMessage({cmd:"reset"});if(!b.isNormalInit()){var d={cmd:"position",fen:b.getStartPos().toFEN()};c.forEach(function(b){d[b.piece+"Table"]=this.getStrExternTable(b.vals)}.bind(this));this.engine.postMessage(d)}for(c=0;c<b.mainLine.length;c++){var f=
    b.mainLine[c].toJSON();this.engine.postMessage({cmd:"move",move:f})}this.viewLink&&this.viewLink.clearEngineOutput(this.nEngine)};d.prototype.analyse=function(b){this.abort();b=b.toFEN();this.engine.postMessage({cmd:"position",fen:b});this.engine.postMessage({cmd:"analyze"});this.isRunning=!0;this.viewLink&&this.viewLink.clearEngineOutput(this.nEngine)};d.prototype.abort=function(){this.isRunning&&(this.engine.terminate(),this.isRunning=!1,this.load())};d.prototype.onMessage=function(b){if("pv"==
    b.data.id)this.gameLink.onEnginePV(this.nEngine,b.data);else"move"==b.data.id&&(this.gameLink.onEngineMove(this.nEngine,b.data),this.isRunning=!1)};d.prototype.onError=function(b){CB.LOG("Error: "+b.message);alert(b)};d.prototype.genGoodSquaresForWhitePieceEval=function(b,c){};d.prototype.getStrExternTable=function(b){for(var c=Array(64),d=0;64>d;d++)c[d]=0;b.forEach(function(b){var d=CB.Square.getRank(b.sq),e=CB.Square.getFile(b.sq);c[8*(7-d)+e]=b.val});return JSON.stringify(c)};d.prototype.getStrExternEval=
    function(){return""};return d}();"use strict";
CB.EngineLinesElement=function(){function d(b){if(b.handicap){var c=CB.Handicap.getTypeStr(b.handicap);return String.formatEx("{5}: {0}, {1} {2} {3}={4}s",c,lm.DEPTH,b.depth,lm.TIME,idiv(b.totalTime,1E3),lm.LEVEL)}return String.formatEx(lm.ENG_SEARCH_INFO_FMT,b.depth,b.maxDepth,idiv(b.nps,1E3),idiv(b.totalTime,1E3))}function b(b){var c=CB.$(b.target),d=c.data("pv");d=d.trim();d=d.split(" ").map(CB.Move.fromString);c=c.parent("[data-pos]");c=CB.$(c);c=new CB.Position(c.data("pos"));d=new CB.Game(c,
    d);d=CB.PGNWriter.toPGN(d);b.dataTransfer.setData("text",d)}function c(c,e,h){if(CB.$(".pv",c)){c.on("dragstart",b);CB.$(".pv",c).text(e.pv.lineStr);CB.$(".pvnum",c).text(e.num);if(!(e.analysis||h||CB.System.isMobile()||CB.System.runsInIFrame())){var f=String.f("<img src='{0}'/>",CB.Evaluation.getSmilingEmoticonUrl());CB.$(".evImage",c).html(f)}if(e.evalStr&&e.handicap)e.handicap&&CB.$(".evStr",c).text(e.evalStr),h||CB.System.isMobile()||CB.System.runsInIFrame()||(f=String.f("<img src='{0}'/>",CB.Evaluation.getEmoticonUrl(e.eval)),
    CB.$(".evImage",c).html(f));else{var g=new StringBuilder;CB.NotaElement.CreateGlyphableText(e.symbol,g,"cbspec-glyph");h=g.toString();CB.$(".symbol",c).html(h)}c.data("pvnum",e.num);c.data("depth",e.depth);c.data("mv",e.pv[0].toString());g=new StringBuilder;e.handicap?g.appendFormat("{0}",e.pv[0]):e.pv.forEach(function(b){g.appendFormat("{0} ",b)});c.data("pv",g.toString());c.removeClass("outdated");CB.$(".engine-info-text").hide();e=d(e);CB.$(".data",c).text(e)}}var e=function(b){this.nInPage=b||
    0;this.initState()};e.INIT_HTML=e.LINE_HTML="<div class='line'><div class='nota'><span class='pvnum'></span><span class='symbol'></span><span class='pv'></span></div><div class='evImage'></div><div class='data'></div><div class='evStr'></div></div>";e.defaultOptions={scrollLines:!0};e.prototype.getInitHTML=function(b){return String.f("<div class='lines-container' id='lines-container-{0}'><div class='engine-lines' id='engine-lines-{0}' ><div class='data-common' id='data-common-{0}'></div></div></div><div class='engine-info-text' id='engine-info-text-{0}'></div>",
    b)};e.prototype.initElem=function(b,c){this.options=ObjUtil.copyTo(e.defaultOptions,c||{},!0);this.el=b;CB.$(this.el).html(this.getInitHTML(this.nInPage));b=CB.$("#engine-lines-"+this.nInPage,this.el);this.elLines=b.single();this.elContainer=CB.$("#lines-container-"+this.nInPage,this.el).single();CB.$("#data-common-"+this.nInPage).html(this.options.loadingTitle||"<br/>"+lm.LOADING_ENGINE);b.on("click",this.onLinesClick.bind(this));CB.$("#engine-info-text-"+this.nInPage).hide();this.scrollParent=this.elContainer};
    e.prototype.initState=function(){this.lastDepth=this.lastPos=this.lastTime=this.lastNodes=this.lastNps=null};e.prototype.setEngine=function(b){if(this.engine){var c=this.engine;c.engine&&(c=c.engine);this.idOnLine&&(c.removeOnLineListener(this.idOnLine),c.removeOnLosingLineListener(this.idOnLosingLine),c.removeOnInfoListener(this.idOnInfo),c.removeOnNewGameListener(this.idOnNewGame),c.removeOnSearchStartListener(this.idOnSearchStart),c.removeOnExitListener(this.idOnExit),c.removeOnThreatListener(this.idOnThreat))}if(this.engine=
        b)c=this.engine,c.engine&&!c.addOnLosingLineListener&&(c=c.engine),c&&c.addOnLineListener&&(this.idOnLine=c.addOnLineListener(this.onEngineLine.bind(this)),this.idOnLosingLine=c.addOnLosingLineListener(this.onLosingLine.bind(this)),this.idOnInfo=c.addOnInfoListener(this.onEngineInfo.bind(this)),this.idOnNewGame=c.addOnNewGameListener(this.onNewGame.bind(this)),this.idOnSearchStart=c.addOnSearchStartListener(this.onSearchStart.bind(this)),this.idOnExit=c.addOnExitListener(this.onExit.bind(this)),this.idOnThreat=
        c.addOnThreatListener(this.onThreat.bind(this)))};e.prototype.onLinesClick=function(b){b.preventDefault();var c=b.target;b=CB.$(c);CB.$.is(c,".line")||(c=b.parent(".line"));c&&(b=CB.$(c).data("mv"),CB.Move.isValidString(b)&&(b=CB.Move.fromString(b),this.fireOnMoveEntered(b)))};e.prototype.clear=function(){$(this.elLines).find(".line").remove();$(this.elLines).find("#data-common-"+this.nInPage).empty()};e.prototype.onNewGame=function(){this.clear()};e.prototype.displayInfo=function(b,c){this.clear();
        this.switchLinesToInfo();this.setInfoText(b,c)};e.prototype.onSearchStart=function(b){this.clear();this.switchLinesToInfo();this.setInfoText("Calculating ...","startSearch")};e.prototype.onExit=function(b){this.clear();this.switchLinesToInfo();this.setInfoText("Engine Stopped.","engineStopped")};e.prototype.onThreat=function(b){b?$("#engine-lines-"+this.nInPage).addClass("cbEngineThreat"):$("#engine-lines-"+this.nInPage).removeClass("cbEngineThreat")};e.prototype.onEngineInfo=function(b,c,d,e,l,m){this.lastNps=
        l||this.lastNps;this.lastNodes=e||this.lastNodes;this.lastTime=m||this.lastTime};e.prototype.onEngineLine=function(b,c,d,e,l,m,p,r,t){this.switchInfoToLines();this.hideInfo();if(e===CB.LineEvalType.EXACT){e=b.getMultiPV();CB.$(this.elLines).data("lines",e);e=1<e;b=b.getCurPos();var f=b.toFEN();$(this.elLines).data("pos",f);(this.lastPos&&!b.equals(this.lastPos)||this.lastDepth&&this.lastDepth>c)&&this.clear();e||this.options.scrollLines||this.clear();e&&1==p&&CB.$(".line",this.elLines).addClass("outdated");
        this.lastPos=b;this.lastDepth=c;CB.Game.initLine(b,r);var g=new CB.NotationGenerator(lm.NOTA_LOCALIZATION);t.analysis||(r=r.slice(0,1));f=g.getLineNota(b,r);var h=m;l?(0>h&&(h=-h),h=g.getLocalization().strMate+h):(b.isWTM()||(h=-h),h=(h/100).toFixed(2));f=t.analysis?"("+h+") "+f:" "+f;d={id:"pv",line:r,pv:r,eval:m,evalStr:CB.Evaluation&&!l?CB.Evaluation.getEvalString(100*h)+".":"",nps:this.lastNps,depth:c,maxDepth:d,totalTime:this.lastTime,handicap:t.handicapStyle,analysis:t.analysis,num:p};d.pv.lineStr=
            f;l&&(m=0>m?-Number.MAX_VALUE:Number.MAX_VALUE);l=m;b.isBTM()&&(l=-l);l=CB.EvaluationGrade.getGlyph(l);l=Vp.getText(l);d.symbol=l;this.outCommonData(d);this.outLine(d,e,c);e||this.scrollBottom();CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.updateTouchBarInfo(d.evalStr)}};e.prototype.onLosingLine=function(b,c){this.showInfo()};e.prototype.scrollBottom=function(){this.scrollParent&&(this.scrollParent.scrollTop=this.scrollParent.scrollHeight)};e.prototype.outCommonData=
        function(b){CB.$("#data-common-"+this.nInPage,this.elLines).text(d(b))};e.prototype.showInfo=function(){CB.$("#engine-info-text-"+this.nInPage).show()};e.prototype.hideInfo=function(){CB.$("#engine-info-text-"+this.nInPage).hide()};e.prototype.switchInfoToLines=function(){CB.$("#engine-info-text-"+this.nInPage).hide();CB.$("#lines-container-"+this.nInPage).show()};e.prototype.switchLinesToInfo=function(){CB.$("#engine-info-text-"+this.nInPage).show();CB.$("#lines-container-"+this.nInPage).hide()};
    e.prototype.setInfoText=function(b,c){CB.$("#engine-info-text-"+this.nInPage).text(b);CB.$("#engine-info-text-"+this.nInPage).removeClass("findStrong");c&&CB.$("#engine-info-text-"+this.nInPage).addClass(c);CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.updateTouchBarInfo(b)};e.prototype.outLine=function(b,d){var f=CB.$("#data-common-"+this.nInPage,this.elLines);d?(d=String.formatEx(".line[data-pvnum='{0}']",b.num),d=CB.$(d),0==d.length&&(d=CB.$(e.LINE_HTML),d.insertBefore(f)),
        c(d,b,!0)):(d=CB.$(e.LINE_HTML),c(d,b,!1),d.insertBefore(f))};Ve.initForListeners(e);Ve.addEvent(e,"MoveEntered");return e}();"use strict";
CB.AutoEnginePanelMgrMixin=function(){return{autoEngPanel:null,_autoShowEngine:!1,getAutoEngPanel:function(){return this.autoEngPanel},setAutoShowEngine:function(d){this._autoShowEngine!==d&&(this._autoShowEngine=d,this.toggleEnginePanel(d))},getAutoShowEngine:function(){return this._autoShowEngine},toggleAutoShowEngine:function(){this._autoShowEngine=!this._autoShowEngine;this.toggleEnginePanel(this._autoShowEngine);return this._autoShowEngine},toggleEnginePanel:function(d){V15.commands.fireChecked(CB.CommandIds.TOGGLE_ANALYSIS_AUTO_ENGINE,
        d);var b=this.getEngPanelLocation(),c=b.region;b=b.container;d?(this.autoEngPanel||(this.autoEngPanel=CB.Panels.createAutoEnginePanel(0,{h:CB.System.pixToZoom(.26*window.innerHeight),region:c,autoInit:!0,active:!0})),this.beforeShowAutoEngPanel(),b.contains(this.autoEngPanel)||(b.add(this.autoEngPanel),b.updateLayout())):this.autoEngPanel&&(b.remove(this.autoEngPanel,!0),this.afterHideAutoEngPanel(),this.autoEngPanel.setGame(null),this.autoEngPanel.disposeEngine(),this.autoEngPanel=null);return this.autoEngPanel},
    beforeShowAutoEngPanel:function(){},afterHideAutoEngPanel:function(){}}}();CB.AutoEngineAppMixin=function(){}();CB.AutoEngineGUIElements=function(){return{createAutoEngineBtn:function(d){return CB.ToolButtons.toggleBtn(d,lm.ANALYSIS_ENGINE,"Engine",CB.CommandIds.TOGGLE_ANALYSIS_AUTO_ENGINE,lm.ANALYSIS_ENGINE,CB.Weight(4),"RunningEngine")},createToolBarEngineBtn:function(){return CB.ToolButtons.smallBtn("","Engine16",CB.CommandIds.TOGGLE_ANALYSIS_AUTO_ENGINE,lm.ANALYSIS_ENGINE)}}}();"use strict";
CB.HintTypes={NONE:0,FROM:1,TO:2,CAPTURE:3,CHECK:4,PIECE:5,MATE_THREAT:9,GARDEZ_QUEEN:16,NUM:9,toString:function(d){if("string"==typeof d)return d;CB.HintTypes.msgs||(CB.HintTypes.msgs=["","From","To",lm.CAPTURE_SOMETHING,lm.GIVE_CHECK,"Piece","","","","Threaten mate","","","","","","","Attack the queen"]);if(CB.HintTypes.msgs[d])return CB.HintTypes.msgs[d];for(var b in this)if(this[b]==d)return b;return"Unknown HintType: "+d}};
CB.Hints=function(){var d=function(){};d.engUrl="/Common/Chess/Engine/Enginemin.js";d.engine=new CB.EngineWrapper(0,d.engUrl,null,d);CB.System.isElectron()||d.engine.load();d.gen=function(b,c){for(var d=[],f=[],g=0;g<CB.HintTypes.NUM;g++)f[g]=0;b=b.getCurPos();var h=b.V7(),k=!1;for(g=0;g<h.length;g++){var l=h[g];b.preSetMinCtx(l);c.from==l.from&&f[CB.HintTypes.FROM]++;c.from==l.from&&f[CB.HintTypes.TO]++;c.mvd==l.mvd&&c.from!=l.from&&f[CB.HintTypes.PIECE]++;l.vct&&f[CB.HintTypes.CAPTURE]++;var m=
    new CB.Position;m.copy(b);m.makeMove(l);m.isCheck()&&(f[CB.HintTypes.CHECK]++,l.equals(c)&&(k=!0))}2<=f[CB.HintTypes.CHECK]&&k&&d.push(CB.HintTypes.CHECK);3<=f[CB.HintTypes.CAPTURE]&&c.vct&&d.push(CB.HintTypes.CAPTURE);4<=f[CB.HintTypes.PIECE]?d.push(CB.HintTypes.PIECE):3<=f[CB.HintTypes.FROM]&&(c.piece&CB.Piece.PIECE_MASK)!=CB.Piece.PAWN&&d.push(CB.HintTypes.FROM);3<=f[CB.HintTypes.TO_SQ]&&d.push(CB.HintTypes.TO_SQ);return d};d.genAsync=function(b,c,e,f){for(var g=[],h=[],k=0;k<CB.HintTypes.NUM;k++)h[k]=
    0;var l=b.getCurPos(),m=l.V7(),p=!1;for(k=0;k<m.length;k++){var r=m[k];l.preSetMinCtx(r);c.from==r.from&&h[CB.HintTypes.FROM]++;c.from==r.from&&h[CB.HintTypes.TO]++;c.mvd==r.mvd&&c.from!=r.from&&h[CB.HintTypes.PIECE]++;r.vct&&h[CB.HintTypes.CAPTURE]++;var t=new CB.Position;t.copy(l);t.makeMove(r);t.isCheck()&&(h[CB.HintTypes.CHECK]++,r.equals(c)&&(p=!0))}2<=h[CB.HintTypes.CHECK]&&p&&g.push(CB.HintTypes.CHECK);2<=h[CB.HintTypes.CAPTURE]&&c.vct&&g.push(CB.HintTypes.CAPTURE);3<=h[CB.HintTypes.PIECE]?
    g.push(CB.HintTypes.PIECE):2<=h[CB.HintTypes.FROM]&&(c.piece&CB.Piece.PIECE_MASK)!=CB.Piece.PAWN&&g.push(CB.HintTypes.FROM);2<=h[CB.HintTypes.TO_SQ]&&g.push(CB.HintTypes.TO_SQ);g.length||g.push(CB.HintTypes.PIECE);d.continueAsync(b,c,e,g,f)};d.continueAsync=function(b,c,e,f,g){var h=b.getCurPos(),k=ObjUtil.clone(h);k.makeMove(c);k.canMakeNullMove()&&k.makeNullMove();k.isLegal()?(d.fnAfterSearch=function(b,m){h.getSideToMove()===CB.Side.BLACK&&(b=-b);2E4<b&&(f=[CB.HintTypes.MATE_THREAT].concat(f));
    var l=new CB.Move;m.moves[0]&&(l.fromJSON(m.moves[0]),(k.board[l.to]&CB.Piece.PIECE_MASK)==CB.Piece.QUEEN&&500<b&&(f=[CB.HintTypes.GARDEZ_QUEEN].concat(f)),f.length||(b=d.genMovingPieceHint(h,e,c,!1))&&f.push(b));f&&g(f)},d.engine.sendNewPos(k),d.engine.search(100,2)):g(f)};d.onEnginePV=function(b,c){d.fnAfterSearch&&d.fnAfterSearch(c.eval,c.pv)};d.onEngineMove=function(b,c){};d.getStrPieceHint=function(b){var c=lm.MOVE_IMP+" ";switch(b&CB.Piece.PIECE_MASK){case CB.Piece.KING:c+=lm.YOUR_KING_ACC;
    break;case CB.Piece.QUEEN:c+=lm.YOUR_QUEEN_ACC;break;case CB.Piece.ROOK:c+=lm.YOUR_ROOK_ACC;break;case CB.Piece.KNIGHT:c+=lm.YOUR_KNIGHT_ACC;break;case CB.Piece.BISHOP:c+=lm.YOUR_BISHOP_ACC;break;case CB.Piece.PAWN:c+=lm.YOUR_PAWN_ACC}return c};d.getYourPieceAcc=function(b,c){switch(b&CB.Piece.PIECE_MASK){case CB.Piece.KING:return lm.YOUR_KING_ACC;case CB.Piece.QUEEN:return lm.YOUR_QUEEN_ACC;case CB.Piece.ROOK:return lm.YOUR_ROOK_ACC;case CB.Piece.KNIGHT:return lm.YOUR_KNIGHT_ACC;case CB.Piece.BISHOP:return lm.YOUR_BISHOP_ACC;
    case CB.Piece.PAWN:return lm.YOUR_PAWN_ACC}};d.getStrPieceOnSqHint=function(b,c){return this.getStrPieceHint(b)+" "+CB.Square.toString(c)};d.display=function(b,c,d,f,g){if(d.length){for(var e=[],k=0;k<d.length;k++)d[k]===CB.HintTypes.FROM?(f(b.from),this.showFromSqHint(c,b.from,g,f)):d[k]==CB.HintTypes.TO?f(b.to):d[k]==CB.HintTypes.PIECE?(c.findSquaresOfPiece(c.board[b.from]).forEach(function(b){f&&f(b,"hsla( 130, 50%, 40%, 0.35 )")}.bind(this)),this.showPieceHint(c.board[b.from],g)):e.push(CB.HintTypes.toString(d[k]));
    e.length&&(e.join(", "),g(e))}};d.displayHint=function(b,c,d,f,g){"string"===typeof d?g(d):d===CB.HintTypes.FROM?(f&&f(b.from),this.showFromSqHint(c,b.from,g,f)):d===CB.HintTypes.TO?f&&f(b.to):d===CB.HintTypes.PIECE?(c.findSquaresOfPiece(c.board[b.from]).forEach(function(b){f&&f(b,"hsla( 130, 50%, 40%, 0.35 )")}.bind(this)),this.showPieceHint(c.board[b.from],g)):(b=CB.HintTypes.toString(d),g(b))};d.showFromSqHint=function(b,c,d,f){f&&f(c);d(CB.Hints.getStrPieceOnSqHint(b.board[c],c)+".")};d.showPieceHint=
    function(b,c){c(CB.Hints.getStrPieceHint(b)+".")};d.genMovingPieceHint=function(b,c,e,f){var g=b.getBTM(),h=b.board[e.from],k=CB.Square.R(e.from),l=CB.Square.R(e.to);if((g?l>=CB.Square.R_7&&k<CB.Square.R_5:l<=CB.Square.R_2&&k>CB.Square.R_4)&&!e.vct)return"Retreat a piece";if(e.isCastling())return"Castle";switch(h&CB.Piece.PIECE_MASK){case CB.Piece.KING:var m=d.genKingHints(b,c,h,e,f);break;case CB.Piece.PAWN:m=d.genPawnHints(b,c,h,e,f);break;case CB.Piece.BISHOP:m=d.genBishopHints(b,c,h,e,f);break;
    case CB.Piece.KNIGHT:m=d.genKnightHints(b,c,h,e,f);break;case CB.Piece.ROOK:m=d.genRookHints(b,c,h,e,f);break;case CB.Piece.QUEEN:m=d.genQueenHints(b,c,h,e)}return m};d.genQueenHints=function(b,c,e,f){c=d.getYourPieceAcc(e);4<d.countMovesOf(b,CB.Piece.QUEEN)&&(.5>Math.random()?c=CB.Square.isLight(f.to)?d.getYourPieceAcc(e)+" to a light square.":d.getYourPieceAcc(e)+" to a dark square.":(CB.Square.F(f.from)==CB.Square.F(f.to)&&d.getYourPieceAcc(e),c=CB.Square.R(f.from)==CB.Square.R(f.to)?d.getYourPieceAcc(e)+
    " horizontally.":d.getYourPieceAcc(e)+" diagonally"));return"Move "+c};d.genKingHints=function(b,c,e,f){c="";if(3<=d.countMovesOf(b,CB.Piece.KING)){var g=d.getRankDiff(f,b.getBTM());b=d.getFileDiff(f,b.getBTM());var h=CB.Square.F(f.from);f=CB.Square.F(f.to);0!=g&&(0==b||.5>Math.random())?0<g?c="Advance "+d.getYourPieceAcc(e):0>g&&(c="Retreat "+d.getYourPieceAcc(e)):0!=b&&CB.Square.isCenterFile(f)&&!CB.Square.isCenterFile(h)?c="Centralize "+d.getYourPieceAcc(e):0!=b&&0==g&&(c="Move your king sideways")}return c};
    d.genPawnHints=function(b,c,e,f){var g;12>=b.getMoveNum()?g="Move your "+CB.Square.colToString(CB.Square.F(f.from))+"-pawn":2==d.getRankDiff(f,b.getBTM())?g="Make a double step with your pawn":3<d.countMovesOf(b,CB.Piece.PAWN)&&(g=CB.Square.isCenterFile(f.from)?"Move your center pawn":CB.Square.F(f.from)<CB.Square.C_E?"Move your pawn on the queens side":"Move your pawn on the kings side");return g};d.genBishopHints=function(b,c,e,f){var g=b.getBTM();2==b.countPieces(CB.Piece.BISHOP|(g?CB.Piece.COLOUR:
        0))?(e=CB.Square.isLight(f.from)?"Move your light squared bishop":"Move your dark squared bishop",24>=b.getMoveNum()&&(g&&CB.Square.R(f.from)==CB.Square.R_8||!g&&CB.Square.R(f.from)==CB.Square.R_1)&&(e=d.genDevelopBishopHint(b,c,f))):e=0>d.getRankDiff(f,b.getBTM())?"Retreat your bishop":"Advance your bishop";return e};d.genDevelopBishopHint=function(b,c,e){if(b.getBTM()){var f=CB.Square.F8;var g=CB.Square.C8;var h=CB.Square.G8;var k=CB.Square.B8;var l=CB.Piece.B_KNIGHT}else f=CB.Square.F1,g=CB.Square.C1,
        h=CB.Square.G1,k=CB.Square.B1,l=CB.Piece.W_KNIGHT;if(e.from==f)if(b.board[h]==l)var m="Develop your king's side";else{if(d.isCastleMove(c[2],CB.Square.C_G)||d.isCastleMove(c[4],CB.Square.C_G))m="Prepare to castle"}else if(e.from==g)if(b.board[k]==l)m="Develop your queen's side";else if(d.isCastleMove(c[2],CB.Square.C_C)||d.isCastleMove(c[4],CB.Square.C_C))m="Prepare to castle";return m};d.genKnightHints=function(b,c,e,f){var g;c=b.getBTM();12>=b.getMoveNum()&&(CB.Square.C(f.from)==CB.Square.C_B?g=
        "Develop your queen's knight":CB.Square.C(f.from)==CB.Square.C_G&&(g="Develop your king's knight"));g||(CB.Square.IsCenterSquare(f.to)?g="Centralize your knight":(b=d.getRankDiff(f,c),g=2==b?"Advance your knight":-2==b?"Retreat your knight":"Move your knight sideways"));return g};d.genRookHints=function(b,c,e,f){if(3<d.countMovesOf(b,CB.Piece.ROOK)){var g=b.getBTM();var h=d.genDoubleRooksHint(b,c,f);if(!h){c=b.countPieces(CB.Piece.W_PAWN)+b.countPieces(CB.Piece.B_PAWN);e=d.getRankDiff(b,g);g=d.getFileDiff(b,
        g);var k=CB.Square.F(f.from);f=CB.Square.F(f.to);10<=c&&(!d.isOpenFile(b,k)&&d.isOpenFile(b,f)?h="Move your rook to an open file":0==g?h=3<=e?"Advance your rook":-3>=e?"Retreat your rook":"Move your rook vertically":0==e&&(h=CB.Square.isCenterFile(f)&&!CB.Square.isCenterFile(k)?"Centralize your rook":"Move your rook horizontally"))}}return h};d.isOpenFile=function(b,c){for(var d=0;8>d;d++)if((b.board[8*c+d]&CB.Piece.PIECE_MASK)==CB.Piece.PAWN)return!1;return!0};d.isClosedFile=function(b,c){for(var d=
        0;8>d;d++)if(b.board[8*file+d]==(CB.Piece.PAWN|(c?CB.Piece.BLACK:0)))return!0;return!1};d.hasRookInFile=function(b,c,d){c=CB.Square.F(c);for(var e=0;8>e;e++)if(b.board[8*c+e]==CB.Piece.ROOK|(d?CB.Piece.BLACK:0))return!0;return!1};d.genDoubleRooksHint=function(b,c,e){if(d.isOpenFile(b,CB.Square.F(e.to))&&d.hasRookInFile(b,e.to,b.getBTM()))var f="Double your rooks";else if(b=CB.Square.F(e.to),CB.Square.F(e.from)==b)for(var g=2;g<c.length&&6>g;g+=2){var h=c[g];h.mvd&CB.Piece.PIECE_MASK==CB.Piece.ROOK&&
    CB.Square.F(h.to)==b&&CB.Square.F(h.from)!=b&&h.from!=e.to&&(f="Prepare to double rooks")}return f};d.isCastleMove=function(b,c){return(b.mvd&CB.Piece.PIECE_MASK)==CB.Piece.KING&&CB.Square.F(b.to)==c&&CB.Square.F(b.from)==CB.Square.C_G};d.countMovesOf=function(b,c){var d=0;b.V7().forEach(function(e){(b.board[e.from]&CB.Piece.PIECE_MASK)==c&&d++});return d};d.getRankDiff=function(b,c){return c?CB.Square.R(b.from)-CB.Square.R(b.to):CB.Square.R(b.to)-CB.Square.R(b.from)};d.getFileDiff=function(b,c){return c?
        CB.Square.F(b.from)-CB.Square.F(b.to):CB.Square.F(b.to)-CB.Square.F(b.from)};d.isVerticalMove=function(b){return CB.Square.F(b.from)==CB.Square.F(b.to)};d.isHorizontalMove=function(b){return CB.Square.R(b.from)==CB.Square.R(b.to)};return d}();"use strict";
CB.Commands=function(){var d=function(){this.uniqueKeyDownHandlerId=this.uniqueCommandHandlerId=0;this.commandHandlers=[];this.keyDownHandlers=[];this.toggleButtons={};this.disableShortCutCounter=0;this.curStateChange={}};d.prototype.registerCommandHandler=function(b){this.uniqueCommandHandlerId+=1;this.commandHandlers[this.uniqueCommandHandlerId]=b;return this.uniqueCommandHandlerId};d.prototype.unregisterCommandHandler=function(b){delete this.commandHandlers[b]};d.prototype.commandHandler=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         c){try{for(var d=0;d<this.commandHandlers.length&&(void 0===this.commandHandlers[d]||!this.commandHandlers[d].execCommand(b,c));d++);}catch(f){b=V15.Vo.toNumString(b),CB.LogException(b,f)}};d.prototype.onFileSelect=function(b,c){for(var d=0;d<this.commandHandlers.length;d++)if(void 0!==this.commandHandlers[d]&&this.commandHandlers[d].onFileSelect)this.commandHandlers[d].onFileSelect(b,c)};d.prototype.onTextFieldChange=function(b,c){CB.LOG("TextFieldChange: "+b+", "+c);for(var d=0;d<this.commandHandlers.length;d++)if(void 0!==
    this.commandHandlers[d]&&this.commandHandlers[d].onTextFieldChange)this.commandHandlers[d].onTextFieldChange(b,c)};d.prototype.onRegisterField=function(b,c){for(var d=0;d<this.commandHandlers.length;d++)if(void 0!==this.commandHandlers[d]&&this.commandHandlers[d].onRegisterField)this.commandHandlers[d].onRegisterField(b,c)};d.prototype.addPressedButton=function(b,c){};d.prototype.handleKeyPressed=function(b){};d.prototype.registerkeyDownHandler=function(b){this.uniqueKeyDownHandlerId+=1;this.keyDownHandlers[this.uniqueKeyDownHandlerId]=
    b;return this.uniqueKeyDownHandlerId};d.prototype.unregisterkeyDownHandler=function(b){delete this.keyDownHandlers[b]};d.prototype.handleKeyDown=function(b){try{if(0>=this.disableShortCutCounter)for(var c=0;c<this.keyDownHandlers.length;c++){if(void 0!==this.keyDownHandlers[c]&&this.keyDownHandlers[c].onKeyDown(b)){b.stopEvent();break}}else CB.LOG("KeyHandlers disabled: "+this.disableShortCutCounter,"LogError")}catch(e){CB.LogException("KeyDown="+b.getKey(),e)}return!0};d.prototype.execCommandLine=
    function(b){for(var c=0;c<this.commandHandlers.length&&(void 0===this.commandHandlers[c]||!this.commandHandlers[c].execCommandLine||!this.commandHandlers[c].execCommandLine(b));c++);};d.prototype.enableShortCuts=function(){--this.disableShortCutCounter;0>this.disableShortCutCounter&&CBDebug.assert("Shortcut counter");CB.LOG("EnableShortcuts="+this.disableShortCutCounter)};d.prototype.disableShortCuts=function(){this.disableShortCutCounter+=1;CB.LOG("DisableShortcuts="+this.disableShortCutCounter,
    "LogError LogBold")};d.prototype.getCurStateChange=function(){return this.curStateChange};d.prototype.fireChecked=function(b,c){this.curStateChange={id:b,state:c};this.fireOnChecked()};d.prototype.fireEnabledChanged=function(b,c){this.curStateChange={id:b,state:c};this.fireOnEnabledChanged()};d.prototype.fireVisibleChanged=function(b,c){this.curStateChange={id:b,state:c};this.fireOnVisibleChanged()};Ve.initForListeners(d);Ve.addEvent(d,"Checked",function(){return[this.getCurStateChange()]});Ve.addEvent(d,
    "EnabledChanged",function(){return[this.getCurStateChange()]});Ve.addEvent(d,"VisibleChanged",function(){return[this.getCurStateChange()]});return d}();
CB.CommandIds={NONE:0,FLIP_BOARD:1,NEW_GAME:2,TAKEBACK:3,EXECMOVE:4,TOGGLE_ANALYSIS_ENGINE:5,SETUP_POSITION:6,ENGINE_MOVE_NOW:7,TOGGLE_ANALYSIS_AUTO_ENGINE:8,ENGINE_HINT:9,ADD_POST_TEXT:10,ADD_PRE_TEXT:11,PROMOTE_LINE:12,DELETE_LINE:13,CUT_LINE:14,MARK_GOOD:15,MARK_BAD:16,MARK_VERYGOOD:17,MARK_VERYBAD:18,MARK_INTERESTING:19,MARK_DUBIOUS:20,WHITE_WINS:30,WHITE_BETTER:31,WHITE_SLIGHTLY:32,EQUAL:33,UNCLEAR:34,BLACK_WINS:36,BLACK_BETTER:37,BLACK_SLIGHTLY:38,COMPENSATION:35,INSERT_DIAGRAM:39,DELETE_PREVIOUS_MOVES:40,
    OPEN_PGN_DATABASE:60,OPEN_CMS:63,ENGINE_PLUS_LINE:70,ENGINE_MINUS_LINE:71,DOWNLOAD_PGN:75,START_LINE:80,PIECES2D_FRITZ:100,PIECES2D_CRYSTALS:101,PIECES2D_CRYSTALS_WOOD:115,PIECES2D_USCF:102,PIECES2D_OLDSTYLE:103,PIECES2D_HABSBURG:104,PIECES2D_WORLDCHESS:105,PIECES2D_BLUE:106,PIECES2D_FF:107,PIECES3D_FRITZ:120,PIECES3D_MODERN:121,PIECES3D_ROOM:122,PIECES3D_BALLOON:123,PIECES3D_METAL:124,PIECES3D_FUTURE:125,PIECES3D_BLACKWHITE:126,PIECES3D_CHARACTER:127,PIECES_LAST:128,TOGGLE_PIECES:140,BOARD2D_WOOD:200,
    BOARD2D_CRYSTALS:201,BOARD2D_CRYSTALS_WOOD:202,BOARD2D_USCF:203,BOARD2D_OLDWOOD:204,BOARD2D_HABSBURG:205,BOARD2D_FF:206,BOARD2D_WORLDCHESS:207,BOARD2D_BLUE:208,GO_BACK:210,GO_HOME:211,CMS_SOLUTION:212,CMS_TRYAGAIN:213,CMS_PREVIOUS:214,CMS_NEXT:215,PLAYERDB_TEST:231,SEND_FEEDBACK:240,GAME_COPYTOCLIPBOARD:250,GAME_PASTEFROMCLIPBOARD:251,SWITCHAPP_PLAY:260,SWITCHAPP_LIVE:261,SWITCHAPP_DATABASE:262,SWITCHAPP_MYGAMES:263,SWITCHAPP_FRITZ:264,SWITCHAPP_FF:265,SWITCHAPP_TACTICS:266,SWITCHAPP_OPENINGS:267,
    SWITCHAPP_VIDEO:268,SWITCHAPP_NEWS:269,LOGIN:300,LOGOUT:301,CHANGE_PASSWORD:302,MANAGE_ACCOUNT:303,MANAGE_FRIENDS:304,INVITE_FRIEND:305,HELP:306,TOGGLE_HANDICAP:400,LANG_ENGLISH:400,LANG_DEUTSCH:401,LANG_ESPANOL:402,LANG_DUTCH:403,LANG_ROMANIAN:404,LANG_CHINESE:405,LANG_FRENCH:406,LANG_RUSSIAN:407,LANG_NORWEGIAN:408,LANG_POLISH:409,LANG_ITALIAN:410,LANG_HEBREW:411,LANG_CATALAN:412,LANG_TURKISH:413,LANG_SLOWENIAN:414,LANG_GREEK:415,LANG_UKRAINIAN:416,LANG_VIETNAMESE:417,LANG_ARABIC:418,LANG_SERBIAN:419,
    LANG_LITHUANIAN:420,LANG_PORTUGUESE:421,LANG_FARSI:422,LANG_GAELIC:423,LANG_CROATIAN:424,LANG_CZECH:425,LANG_HINDI:426,TRANSLATE_PAGE:500,TEST:9999,toNumString:function(d){return"CommandId="+d}};CB.getCommonPath=function(){return CB.System.isElectron()?"Common/":"/Common/"};
CB.AppConfigDebug={externalCommonPath:!1,getEngineUrl:function(){return V15.canRunWebAssembly()?(CB.EngineInstance.isAjax=!0,["https://pgn.chessbase.com/common/chess/engine/webasm/fritzajax3.js"]):["/Common/Chess/Engine/df14/df14.js"]},getExternalCommonPath:function(){return CB.System.isElectron()?"file://Common/":"https://pgn.chessbase.com/common/"},getRibbonPath:function(){return CB.getCommonPath()+"Media/Ribbons/"},getPlaychessUris:function(){return["ws://playserver.chessbase.com:7000"]},getLiveUris:function(){return https?
        ["wss://liveserver.chessbase.com:6008"]:["ws://liveserver.chessbase.com:7001"]},getLiveResult:function(){var d=CB.System.isHTTPS();return[(d?"https":"http")+"://liveserver.chessbase.com:"+(d?6009:80)]},getDBBridgeUris:function(){return CB.System.isHTTPS()?["wss://dbserver.chessbase.com:443"]:["ws://dbserver.chessbase.com:7000"]},getCloudServerUris:function(){return CB.System.isHTTPS()?["wss://cloudserver.chessbase.com:6008"]:["ws://cloudserver.chessbase.com:7000"]},getMyMovesServerUris:function(){return CB.System.isHTTPS()?
        ["wss://mymovesserver.chessbase.com:443"]:["ws://mymovesserver.chessbase.com:7001"]},getTrainingUris:function(){return CB.System.isHTTPS()?["wss://trainingserver.chessbase.com:443"]:["ws://trainingserver.chessbase.com:7000","wss://trainingserver.chessbase.com:6008"]},getPlBridgeUris:function(){return CB.System.isHTTPS()?["wss://pbridge.chessbase.com:443"]:["ws://pbridge.chessbase.com:7000"]},getTbBridgeUris:function(){return CB.System.isHTTPS()?["wss://tbridge.chessbase.com:6008","wss://tbridge2.chessbase.com:6008"]:
        ["ws://tbridge2.chessbase.com:7000","ws://tbridge.chessbase.com:7000"]},getAccountUris:function(){return CB.System.isHTTPS()?["https://users.chessbase.com","https://usersback.chessbase.com"]:["http://users.chessbase.com","http://usersback.chessbase.com"]},getVideoPortalUris:function(){return CB.System.isHTTPS()?["https://videos.chessbase.com/"]:CB.System.runsOnChessBaseDomain()?["http://videos.chessbase.com/"]:["http://localhost:49599/"]},loginWebUrl:"http://account.chessbase.com",createAccountWebUrl:"https://live.chessbase.com/createAccount",
    createAccountWebUrl2:"https://live.chessbase.com/createAccount",resetPasswordWebUrl:"http://account.chessbase.com/en/pwd-recovery",resetPasswordWebUrl2:"http://account.chessbase.com/{0}/pwd-recovery",versionChessBaseCom:!1,editAccountUrl:"http://account.chessbase.com/{0}/me",helpUrl:"http://help.chessbase.com/Apps/{0}/index.html",getFlagPath:function(d){return CB.getCommonPath()+"Media/FlagsIso/"+d+"/"},has3DBoard:!1,board2DTopOffset:0,board2DBottomOffset:0,useAnalysisEngines:!0,debug:!0,jqxTheme:"chessbase",
    defaultFont:"Roboto, sans serif",defaultCondensedFont:"Roboto Condensed, Arial Narrow, sans serif",boardBG:CB.getCommonPath()+"media/chess/OrangeBrighterSoftBacklightLessSatur.jpg",imgSuffix:"",clrActiveClock:new CB.Color(220,250,190),bgActiveClock:"hsla( 240, 20%, 10%, 1.0 )"};
CB.AppConfigRelease=ObjUtil.copyTo(CB.AppConfigDebug,{release:!0,loginWebUrl:"http://account.chessbase.com",getEngineUrl:function(){return V15.canRunWebAssembly()?(CB.EngineInstance.isAjax=!0,["https://pgn.chessbase.com/common/chess/engine/webasm/fritzajax3.js"]):["/Common/Chess/Engine/df14/df14.js"]},getPlaychessUris:function(){return CB.System.isHTTPS()?["wss://cbridge2.chessbase.com:6008","wss://playserver.chessbase.com:443","wss://cbridge3.chessbase.com:443","wss://cbridge4.chessbase.com:6008"]:
        ["ws://cbridge2.chessbase.com:7000","ws://playserver.chessbase.com:7000","wss://cbridge3.chessbase.com:443","ws://cbridge4.chessbase.com:7000"]},getMyMovesServerUris:function(){return CB.System.isHTTPS()?["wss://mymovesserver.chessbase.com:443"]:["ws://mymovesserver.chessbase.com:7001"]},getTrainingUris:function(){return CB.System.isHTTPS()?["wss://trainingserver2.chessbase.com:443","wss://trainingserver.chessbase.com:6008"]:["wss://trainingserver2.chessbase.com:443","wss://trainingserver.chessbase.com:6008",
        "ws://trainingserver2.chessbase.com:7000"]},getDBBridgeUris:function(){return CB.System.isHTTPS()?["wss://dbserver.chessbase.com:443"]:["ws://dbserver.chessbase.com:7000"]},getCloudServerUris:function(){return CB.System.isHTTPS()?["wss://cloudserver.chessbase.com:6008"]:["ws://cloudserver.chessbase.com:7000"]},getAccountUris:function(){return CB.System.isHTTPS()?["https://users.chessbase.com"]:["http://users.chessbase.com"]},getLiveUris:function(){return["wss://liveserver.chessbase.com:6008"]},getLiveResult:function(){var d=
        CB.System.isHTTPS();return[(d?"https":"http")+"://liveserver.chessbase.com:"+(d?6009:80)]},createAccountWebUrl:"https://account.chessbase.com/en/create-account",createAccountWebUrl2:"https://account.chessbase.com/{0}/create-account",resetPasswordWebUrl:"http://account.chessbase.com/en/pwd-recovery",resetPasswordWebUrl2:"http://account.chessbase.com/{0}/pwd-recovery",editAccountUrl:"http://account.chessbase.com/{0}/me",debug:!1},!0);
CB.ChessApp=function(){var d=function(){void 0===this.config&&(this.config=CB.AppConfigRelease);this.mediaPath=CB.getCommonPath()+"Media/";this.mediaPathChess=this.mediaPath+"Chess/";this.mediaPathFlags="https://pgn.chessbase.com/common/media/Flags/";this.minFPS=16;document.onmousemove=this.resetIdle.bind(this);document.onkeypress=this.resetIdle.bind(this);this.idleTimer=new CB.Timer;this.lastActionTick=new CB.Tick;this.loggedIn=!1;this.appName=this.appTitle="ChessBase App";this.acc={name:"Free",
    type:0};window.localforage&&localforage.config({driver:localforage.INDEXEDDB,name:"ChessBase",version:1,storeName:"CBCache"})};d.prototype.initInstance=function(){this.commands=new CB.Commands;glSettings=new CB.GlobalSettings;this._initResources();this.idleTimer.runPeriodic(6E4,this.onIdle.bind(this));this.extendCommandIds(CB.CommandIds,this.getAppSpecificCommandIds());this.commandHandlerId=this.commands.registerCommandHandler(this);this.detLanguage();CB.System.isMobile()||V15.initToolTips();window.onerror=
    function(b,d,f,g,h){var c="Main";0<=d.search("df14")&&(c="Engine");d=String.formatEx("line={0}, col={1}, typ={2}",f,g,c);h&&h.stack&&(d+="/"+h.stack);CB.LogException(b,d);"Engine"==h&&V15&&V15.panelMgr&&V15.panelMgr.showMessage("Sorry, cannot load the engine, please use the Chrome Browser or Firefox")};this.initAnalytics()};d.prototype.exitInstance=function(){glSettings.destroy()};d.prototype.detLanguage=function(){this.setLanguageFromUrlParam()};d.prototype.setLanguageFromUrlParam=function(){var b=
    CB.strUtil.getURLParam("lang");b&&(b=CB.Language.getLanguageIdOfParam(b),glSettings.languageCommandId=glSettings.getCommandIdOfLanguage(b));"undefined"!=typeof glSettings.languageCommandId?glSettings.changeLanguage(glSettings.languageCommandId):this.changeLanguage(CB.Language.getUserLanguageId())};d.prototype.overrideLanguageFromPlugin=function(b){if(b=this.getPluginLanguage(b))b=CB.Language.getLanguageIdOfParam(b),glSettings.languageCommandId=glSettings.getCommandIdOfLanguage(b)};d.prototype.getPluginLanguage=
    function(b){b=$(b);if(b.length)return b[0].dataset.language};d.prototype.initAnalytics=function(){"undefined"!==typeof ga&&ga("set","anonymizeIp",!0)};d.prototype.isBoardOnlyApp=function(){return!1};d.prototype.getLoginUrl=function(){return this.config.loginWebUrl};d.prototype.getManageAccountUrl=function(){return this.config.loginWebUrl+"en/me"};d.prototype._initResources=function(){glSettings.boardTextureId||(glSettings.boardTextureId=this.getDefaultBoardCmdId());var b=glSettings.boardTextureId;
    glSettings.boardTextureId=void 0;this.setBoardTextures(b);this.config.delayAudioInit||(this.chessAudio=new CB.ChessAudio(V15.config.getExternalCommonPath()+"Media/Sounds/",!0))};d.prototype.getDefaultBoardCmdId=function(){return CB.CommandIds.BOARD2D_WOOD};d.prototype.setBoardTextures=function(b){this.Vb&&this.Vb.destroy();if(glSettings.boardTextureId!=b)switch(b){default:b=CB.CommandIds.BOARD2D_WOOD;case CB.CommandIds.BOARD2D_WOOD:case CB.CommandIds.BOARD2D_CRYSTALS_WOOD:case CB.CommandIds.BOARD2D_USCF:case CB.CommandIds.BOARD2D_OLDWOOD:this.Vb=
    new CB.BoardTextures(this.mediaPathChess+"LightSquaresCoolerBrighterSofter.jpg",this.mediaPathChess+"DarkSquaresLessSatur.png",this.mediaPathChess+"MarginBrighter.jpg",this.mediaPathChess+"OrangeBrighterSoftBacklightLessSatur.jpg","gold","black");break;case CB.CommandIds.BOARD2D_CRYSTALS:this.Vb=new CB.BoardTextures(this.mediaPathChess+"WhiteMarbleCut.jpg",this.mediaPathChess+"GreyMarble.jpg",this.mediaPathChess+"DarkMarginCut.jpg",this.mediaPathChess+"WhiteMarbleBack.jpg");break;case CB.CommandIds.BOARD2D_HABSBURG:this.Vb=
    new CB.BoardTextures(this.mediaPathChess+"LightSquaresCooler.png",this.mediaPathChess+"DarkSquaresOrange.png",this.mediaPathChess+"MarginBrighter.jpg",this.mediaPathChess+"OrangeBrighterSoftBacklight.jpg");break;case CB.CommandIds.BOARD2D_FF:this.Vb=new CB.BoardTextures(this.mediaPathChess+"LightSquaresFFTex.png",this.mediaPathChess+"DarkSquaresFFTex.png",this.mediaPathChess+"MarginFF.png",this.mediaPathChess+"BackgroundFF.png");break;case CB.CommandIds.BOARD2D_WORLDCHESS:this.Vb=new CB.BoardTextures(this.mediaPathChess+
    "WorldChessLightSquares.jpg",this.mediaPathChess+"WorldChessDarkSquares.jpg",this.mediaPathChess+"WorldChessDarkSquares.jpg",this.mediaPathChess+"WorldChessBackground.jpg","white","white");break;case CB.CommandIds.BOARD2D_BLUE:this.Vb=new CB.BoardTextures(this.mediaPathChess+"BlueLightSquares.jpg",this.mediaPathChess+"BlueDarkSquares.jpg",this.mediaPathChess+"BlueDarkSquares.jpg",this.mediaPathChess+"BlueBackground.jpg","white","white")}glSettings.boardTextureId=b};d.prototype.boardMenuBtn=function(b){return V15.config.has3DBoard?
    CB.ToolButtons.menuBtn(b,lm.BOARDS,"Board2DSquares",[lm.BOARD_FRITZ,lm.BOARD_CRYSTALS,lm.BOARD_CRYSTALS+" (Wood)",lm.BOARD_USCF,lm.BOARD_OLDSTYLE,lm.BOARD_HABSBURG,"-",lm.BOARD3D_FRITZ,lm.BOARD3D_MODERN,lm.BOARD3D_ROOM,lm.BOARD3D_BALLOON,lm.BOARD3D_METAL,lm.BOARD3D_FUTURE,lm.BOARD3D_BLACKWHITE],"wQFritz16 wQCrystals16 wQCrystals16 wQUSCF16 wQOldstyle16 wQHabsburg16  Fritz16 Modern16 Room16 Balloon16 Metal16 Future16 BlackWhite16".split(" "),[CB.CommandIds.PIECES2D_FRITZ,CB.CommandIds.PIECES2D_CRYSTALS,
        CB.CommandIds.PIECES2D_CRYSTALS_WOOD,CB.CommandIds.PIECES2D_USCF,CB.CommandIds.PIECES2D_OLDSTYLE,CB.CommandIds.PIECES2D_HABSBURG,null,CB.CommandIds.PIECES3D_FRITZ,CB.CommandIds.PIECES3D_MODERN,CB.CommandIds.PIECES3D_ROOM,CB.CommandIds.PIECES3D_BALLOON,CB.CommandIds.PIECES3D_METAL,CB.CommandIds.PIECES3D_FUTURE,CB.CommandIds.PIECES3D_BLACKWHITE],void 0,"",CB.Weight(8)):CB.ToolButtons.menuBtn(b,lm.BOARDS,"Board2DSquares",[lm.BOARD_FRITZ,lm.BOARD_CRYSTALS,lm.BOARD_CRYSTALS+"(Wood)",lm.BOARD_USCF,lm.BOARD_OLDSTYLE,
        lm.BOARD_HABSBURG],"wQFritz16 wQCrystals16 wQCrystals16 wQUSCF16 wQOldstyle16 wQHabsburg16".split(" "),[CB.CommandIds.PIECES2D_FRITZ,CB.CommandIds.PIECES2D_CRYSTALS,CB.CommandIds.PIECES2D_CRYSTALS_WOOD,CB.CommandIds.PIECES2D_USCF,CB.CommandIds.PIECES2D_OLDSTYLE,CB.CommandIds.PIECES2D_HABSBURG],void 0,"",CB.Weight(12))};d.prototype.switchAppMenuBtn=function(b){return!CB.System.isMobile()||1E3<window.innerWidth||1E3<window.innerHeight?CB.ToolButtons.menuBtn(b,lm.OTHER_TOOLS,"SwitchApp",[lm.MENU_PLAYCHESS_TOOL,
    "Live Chess",lm.MENU_TACTICS_TOOL,lm.MENU_VIDEO_TOOL,lm.MENU_FRITZ_TOOL,lm.MENU_OPENINGS_TOOL,lm.MENU_DATABASE_TOOL,lm.MENU_MYGAMES_TOOL,lm.MENU_FRITZ_CHESSTER_TOOL,"News"],"WebAppPlay16 WebAppLive16 WebAppTactics16 WebAppVideos16 WebAppFritz16 WebAppOpenings16 WebAppDatabase16 WebAppMyGames16 WebAppFF16 WebAppNews16".split(" "),[CB.CommandIds.SWITCHAPP_PLAY,CB.CommandIds.SWITCHAPP_LIVE,CB.CommandIds.SWITCHAPP_TACTICS,CB.CommandIds.SWITCHAPP_VIDEO,CB.CommandIds.SWITCHAPP_FRITZ,CB.CommandIds.SWITCHAPP_OPENINGS,
    CB.CommandIds.SWITCHAPP_DATABASE,CB.CommandIds.SWITCHAPP_MYGAMES,CB.CommandIds.SWITCHAPP_FF,CB.CommandIds.SWITCHAPP_NEWS],void 0,"",CB.Weight(1)):CB.ToolButtons.menuBtn(b,lm.OTHER_TOOLS,"SwitchApp",[lm.MENU_PLAYCHESS_TOOL,lm.MENU_TACTICS_TOOL,lm.MENU_DATABASE_TOOL,lm.MENU_OPENINGS_TOOL,lm.MENU_VIDEO_TOOL,lm.MENU_FRITZ_TOOL],"WebAppPlay16 WebAppTactics16 WebAppDatabase16 WebAppOpenings16 WebAppVideos16 WebAppFritz16".split(" "),[CB.CommandIds.SWITCHAPP_PLAY,CB.CommandIds.SWITCHAPP_TACTICS,CB.CommandIds.SWITCHAPP_DATABASE,
    CB.CommandIds.SWITCHAPP_OPENINGS,CB.CommandIds.SWITCHAPP_VIDEO,CB.CommandIds.SWITCHAPP_FRITZ],void 0,"",CB.Weight(1))};d.prototype.loginMenuBtn=function(b){return CB.ToolButtons.menuBtn(b,lm.LOGIN,"Login",[lm.LOGIN,lm.LOGOUT,lm.CHANGE_PASSWORD,lm.ACCOUNT,lm.INVITE_FRIEND],["Login16","Logout16","ChangePassword16","Account16","MailGames16"],[CB.CommandIds.LOGIN,CB.CommandIds.LOGOUT,CB.CommandIds.CHANGE_PASSWORD,CB.CommandIds.MANAGE_ACCOUNT,CB.CommandIds.INVITE_FRIEND],void 0,"",CB.Weight(16))};d.prototype.getAvailableLanguages=
    function(){return[CB.Language.ENG,CB.Language.DEU,CB.Language.ESP,CB.Language.NED,CB.Language.ROM,CB.Language.CHN,CB.Language.FRA,CB.Language.RUS,CB.Language.NOR,CB.Language.POL,CB.Language.ITA,CB.Language.HEB,CB.Language.CAT,CB.Language.TRK,CB.Language.SLO,CB.Language.GRK,CB.Language.UKR,CB.Language.VIE,CB.Language.ARA,CB.Language.SER,CB.Language.LIT,CB.Language.BRA,CB.Language.FAR,CB.Language.GAL,CB.Language.CRO,CB.Language.CZE,CB.Language.HIN]};d.prototype.languageBtn=function(b){var c=this.getAvailableLanguages(),
    d=CB.Language.getNativeLangNames(c);d.push("Your Language Here!");var g=CB.Language.getFlagNames(c);g.push(CB.Language.getRibbonFlagName(CB.Language.UN));c=glSettings.getLanguageCommandIds(c);c.push(CB.CommandIds.TRANSLATE_PAGE);b=CB.ToolButtons.menuBtn(b,lm.LANGUAGE,"",d,g,c,void 0,"",CB.Weight(14),!0);glSettings.languageBtn=b;glSettings.languageCommandId?glSettings.changeLangButtonFlag(glSettings.languageCommandId):b.changeFlagIcon(CB.Language.getRibbonFlagName(CB.Language.getUserLanguageId()));
    return b};d.prototype.getLocalizationArr=function(b){var c=[];CB.Loc.Playchess&&CB.Loc.Playchess[b]&&c.push(CB.Loc.Playchess[b]);CB.Loc.Chess[b]?(CB.LOG("Chess.Localization="+b+" ok","","loc"),c.push(CB.Loc.Chess[b])):CB.LOG("Chess.Localization="+b+" not found");CB.LOG("locArr for "+b+"="+c.join(","),"","loc");return c};d.prototype.changeLanguage=function(b){var c=this.getLocalizationArr("ENG");(b=this.getLocalizationArr(CB.Language.getInternalName(b)))&&(c=c.concat(b));glLoc=new CB.Localization(c)};
    d.prototype.resetIdle=function(){this.lastActionTick.start()};d.prototype.isIdle=function(){return 12E4<this.lastActionTick.getExpiredMS()};d.prototype.allowMoveEntryDialog=function(){return!1};var b=!1;d.prototype.onIdle=function(){this.isIdle()?(this.idleFunc&&this.idleFunc(),b=!0):(b&&this.notIdleFunc&&this.notIdleFunc(),b=!1)};d.prototype.initToolTips=function(){"undefined"!==typeof Ext&&Ext.QuickTips.init()};d.prototype.getCommandIdFromVersionCode=function(){var b=0;switch(V15.versionCode.nFamily){case CB.VersionCodeEnum.JSPLAYCHESS:b=
        V15.Vo.SWITCHAPP_PLAY;break;case CB.VersionCodeEnum.JSREADER:b=V15.Vo.SWITCHAPP_LIVE;break;case CB.VersionCodeEnum.JSCBONLINE:b=V15.Vo.SWITCHAPP_DATABASE;break;case CB.VersionCodeEnum.JSPREMIUM:b=V15.Vo.SWITCHAPP_PLAY;break;case CB.VersionCodeEnum.JSFRITZ:b=V15.Vo.SWITCHAPP_FRITZ;break;case CB.VersionCodeEnum.JSMYGAMES:b=V15.Vo.SWITCHAPP_MYGAMES;break;case CB.VersionCodeEnum.JSTRAINING:b=V15.Vo.SWITCHAPP_TACTICS;break;case CB.VersionCodeEnum.JSOPENINGS:b=V15.Vo.SWITCHAPP_OPENINGS}return b};d.prototype.getAppUrl=
        function(b){var c="http://www.chessbase.com";switch(b){case V15.Vo.SWITCHAPP_PLAY:c="http://play.chessbase.com";break;case V15.Vo.SWITCHAPP_LIVE:c="http://live.chessbase.com";break;case V15.Vo.SWITCHAPP_TACTICS:c="http://tactics.chessbase.com";break;case V15.Vo.SWITCHAPP_DATABASE:c="https://database.chessbase.com";break;case V15.Vo.SWITCHAPP_MYGAMES:c="http://mygames.chessbase.com";break;case V15.Vo.SWITCHAPP_OPENINGS:c="http://mymoves.chessbase.com";break;case V15.Vo.SWITCHAPP_FRITZ:c="http://fritz.chessbase.com";
            break;case V15.Vo.SWITCHAPP_VIDEO:c="http://videos.chessbase.com";break;case V15.Vo.SWITCHAPP_FF:c=CB.Language.getUserLanguageId()==CB.Language.DEU?"http://fritzundfertig.chessbase.com":"http://fritzandchesster.chessbase.com";break;case V15.Vo.SWITCHAPP_NEWS:c=CB.Language.getUserLanguageId()==CB.Language.DEU?"http://de.chessbase.com":"http://en.chessbase.com"}return c};d.prototype.execCommand=function(b){try{var c=!0;switch(b){default:c=!1;break;case void 0:break;case V15.Vo.SWITCHAPP_PLAY:case V15.Vo.SWITCHAPP_LIVE:case V15.Vo.SWITCHAPP_DATABASE:case V15.Vo.SWITCHAPP_MYGAMES:case V15.Vo.SWITCHAPP_FRITZ:case V15.Vo.SWITCHAPP_FF:case V15.Vo.SWITCHAPP_TACTICS:case V15.Vo.SWITCHAPP_OPENINGS:case V15.Vo.SWITCHAPP_VIDEO:case V15.Vo.SWITCHAPP_NEWS:var d=
        this.getAppUrl(b);break;case V15.Vo.LOGOUT:this.setLoggedIn(!1);break;case CB.CommandIds.CHANGE_PASSWORD:this.changePassword();break;case CB.CommandIds.MANAGE_ACCOUNT:d=String.formatEx(this.config.editAccountUrl,CB.Language.getParamOfLanguageId(glSettings.getLanguageId()));break;case CB.CommandIds.MANAGE_FRIENDS:this.manageFriends();break;case CB.CommandIds.INVITE_FRIEND:this.inviteFriend();break;case CB.CommandIds.HELP:this.openHelp()}d&&(window.location=d+"?ref="+this.appName+"&lang="+CB.Language.getParamOfLanguageId(glSettings.getLanguageId()))}catch(g){b=
        V15.Vo.toNumString(b),CB.LogException(b,g)}return c};d.prototype.extendCommandIds=function(b,d){if(d){for(var c in b)b.hasOwnProperty(c)&&void 0===d[c]&&(d[c]=b[c]);this.Vo=d}};d.prototype.setLoggedIn=function(b){this.loggedIn=b;b||(V15.Vf.loginToken="",V15.Vf.loginMode=CB.LoginMode.GUEST,CB.DOM.clearCookie("AccountToken"),CB.DOM.clearCookie("AccountMode"),V15.Vf.clearCBCommonCookie());CB.LOG("LoggedIN = "+b,"","acc");b?b:V15.showAccountType(0);this.fireOnLogin(b)};d.prototype.changePassword=function(){V15.Vf.userName?
        CB.Forms.changePassword(V15.Vf.userName,this.changePasswordHandler.bind(this),{}):alert("Please Login First")};d.prototype.changePasswordHandler=function(b,d){CB.LOG(b+"/"+d);(new CB.AccountsManager(V15.shortAppName)).changePassword(V15.Vf.userName,b,d,V15.Vf.loginToken,this.changePWOkHandler)};d.prototype.changePWOkHandler=function(b){CB.LOG(b);b&&1==b.ResultType?alert("Password changed."):alert("Could not change password")};d.prototype.hasUserName=function(){var b=CB.DOM.getAccountNameCookie(!0)||
        V15.Vf.userName;return 0<b.length&&"guest"!=b};d.prototype.manageFriends=function(){(new CB.AccountsManager(V15.shortAppName)).getFriends(V15.Vf.userName,V15.Vf.loginToken,"0",this.getFriendsOkHandler)};d.prototype.getFriendsOkHandler=function(b){CB.LOG(b);if(b&&"OK"==b.Result){for(var c=new CB.AccountsManager(V15.shortAppName),f=[],g=0;g<b.users.length;g++){var h=new CB.ManageFriendsEntry(b.users[g]);f.push(h)}CB.Forms.showManageFriendsList(c,"Friends",f,d.prototype.setFriends)}};d.prototype.setFriends=
        function(b,e){b.setFriends(V15.Vf.userName,V15.Vf.loginToken,"0",e,d.prototype.setFriendsOkHandler)};d.prototype.setFriendsOkHandler=function(b){CB.LOG(b)};d.prototype.inviteFriend=function(){var b=this.getCommandIdFromVersionCode(V15.versionCode.nFamily);b=d.prototype.getAppUrl(b);b="mailto:%20&subject="+escape(this.shortAppName)+"&body="+escape("Join me using "+this.appName+" "+b);window.location.href=b};d.prototype.showAdvertising=function(){};d.prototype.openHelp=function(){var b=String.formatEx(this.config.helpUrl,
        CB.Language.getHelpParamOfLanguageId(glSettings.getLanguageId()));window.open(b,"_blank")};d.prototype.getAccountType=function(){return this.acc&&this.acc.type?this.acc.type:0};d.prototype.isPremium=function(){return 3<=this.getAccountType()};d.prototype.isLoggedIn=function(){return 2<=this.getAccountType()};d.prototype.animatedBoard=function(){return!0};d.prototype.isExtJS=function(){return"undefined"!=typeof Ext};d.prototype.allowMoveEntryDialog=function(){return this.isExtJS()};d.prototype.forceGuestLogon=
        function(){return CB.System.runsInIFrame()||V15.Vf.noRibbons()};d.prototype.showAccountType=function(b){this.acc={name:"Free",type:b};switch(b){case 0:case 1:this.acc.name="Free";break;case 2:this.acc.name="Standard";break;case 3:this.acc.name="Premium"}this.fireOnAccountType(this.acc)};d.prototype.passToFritzOnline=function(b){V15.saveGameToLocalStorage();var c=ObjUtil.clone(b);c.deleteRemaining();c.unAnnotate();c=CB.PGNWriter.toUrlPGN(c);b=2E3<c.length?"?fen="+b.getCurPos().toFEN():"?pgn="+c;window.location=
        "http://fritz.chessbase.com"+b+"&ref=pgn"};d.prototype.saveGameToLocalStorage=function(b){if(this.panelMgr.getKernel&&this.panelMgr.getKernel()&&CB.PGNWriter){var c=this.panelMgr.getKernel().game,d=CB.PGNWriter.toPGN(c),g=encodeURI(d);if(3900<g.length||b)b=ObjUtil.clone(c),b.unAnnotate(),d=CB.PGNWriter.toPGN(b);g=encodeURI(d);3900>g.length&&(CB.DOM.setCookie("CBLastGame",d),CB.DOM.setCookie("CBLastMoveIndex",c.getMoveIndex()),c.replaceGameNo&&(CB.DOM.setCookie("CBLastGameNo",c.replaceGameNo),CB.DOM.setCookie("CBLastGameDBId",
        c.replaceDBId)));V15.Vf.save("CBLastGame",d)}};d.prototype.loadGameFromLocalStorage=function(){if((!V15.urlParams||!V15.urlParams.pgn&&!V15.urlParams.buf64)&&this.panelMgr.getKernel&&this.panelMgr.getKernel()&&PGN){var b=CB.DOM.getCookie("CBLastGame"),d="",f="";b?(d=CB.DOM.getCookie("CBLastGameNo"),f=CB.DOM.getCookie("CBLastGameDBId")):b=V15.Vf.load("CBLastGame");if(b)return b=PGN.parseGame(b),"My Moves"!=b.hdr.white.last&&(d&&f&&(b.replaceGameNo=parseInt(d),b.replaceDBId=parseInt(f)),b.getCurPos().isLegal()&&
    (this.panelMgr.getKernel().game.assign(b),(d=CB.DOM.getCookie("CBLastMoveIndex"))&&this.panelMgr.getKernel().game.gotoIndex(d))),!0}};d.prototype.tryLogin=function(b){V15.Vf.userName=CB.DOM.getAccountNameCookie(!0)||V15.Vf.userName;V15.Vf.loginToken=CB.DOM.getCookie("AccountToken");if(V15.Vf.loginToken&&V15.Vf.userName&&"guest"!=V15.Vf.userName)return(new CB.AccountsManager(V15.shortAppName)).tokenLogin(V15.Vf.userName,V15.Vf.loginToken,b),!0;V15.Vf.clearCBCommonCookie();5;return!1};d.prototype.tryUserPassLogin=
        function(b){return V15.Vf.hasUserAndPass()?((new CB.AccountsManager(V15.shortAppName)).pwLogin(V15.Vf.userName,V15.Vf.password,b),!0):!1};d.prototype.debugLogin=function(){5};d.prototype.connectPlayerLobby=function(b){V15.playerLobby=new CB.Server.PlayerLobby;V15.playerLobby.create(V15.config.getPlBridgeUris(),"Guest","",CB.LoginMode.GUEST);b&&V15.playerLobby.connect()};d.prototype.logOffPlayerLobby=function(){V15.playerLobby&&V15.playerLobby.logOff()};d.prototype.connectTeraBrainLobby=function(){V15.aTBLobby=
        new CB.Server.TeraBrainLobby;V15.aTBLobby.create(V15.config.getTbBridgeUris(),"Guest","",CB.LoginMode.GUEST);V15.aTBLobby.connect()};d.prototype.logOffTeraBrainLobby=function(){V15.aTBLobby&&V15.aTBLobby.logOff()};d.prototype.connectOnlineDBLobby=function(b){V15.onlineLobby=new CB.Server.OnlineLobby;V15.onlineLobby.createLobby(V15.config.getDBBridgeUris(),"Guest","",CB.LoginMode.GUEST);b&&V15.onlineLobby.connect()};d.prototype.logOffOnlineLobby=function(){V15.onlineLobby&&V15.onlineLobby.logOff()};
    d.prototype.setExternalCommonPath=function(b){CB.getCommonPath=function(){return CB.System.isElectron()?"Common/":"https://pgn.chessbase.com/common/"};this.config.externalCommonPath=!0;this.mediaPath=CB.getCommonPath()+"Media/";this.mediaPathChess=this.mediaPath+"Chess/";b.engine&&(b=CB.System.getIEVersion(),CB.EngineInstance.isAjax=12<=b||!b,this.config.getEngineUrl=function(){return CB.EngineInstance.isAjax&&!CB.System.isElectron()?CB.System.canRunWebAssembly()?["https://pgn.chessbase.com/Common/Chess/Engine/WebAsm/FritzAjax3.js"]:
        ["https://pgn.chessbase.com/Common/Chess/Engine/df14/df14ajaxdata.js"]:CB.System.canRunWebAssembly()?["/Common/Chess/Engine/WebAsm/Fritz.js"]:["/Common/Chess/Engine/df14/df14.js"]})};d.prototype.getUserFromUrl=function(){var b=CB.strUtil.getURLParam("user"),d=CB.strUtil.getURLParam("pass");return b.length&&d.length?(V15.Vf.userCoded=b,b=CB.strUtil.base64.decode(b),d=CB.strUtil.base64.decode(d),b=CB.strUtil.htmlDecode(b),V15.Vf.userName=b,V15.Vf.password=d,V15.Vf.loginMode=CB.LoginMode.NORMAL,!0):
        !1};d.prototype.isPlugin=function(){return!1};d.prototype.canRunWebAssembly=function(){return CB.System.canRunWebAssembly()};Ve.initForListeners(d);Ve.addEvent(d,"Login");Ve.addEvent(d,"AccountType");return d}();CB.PieceFonts={};CB.PieceFonts[CB.CommandIds.PIECES2D_FRITZ]="DiagramTTFritz";CB.PieceFonts[CB.CommandIds.PIECES2D_CRYSTALS]="DiagramTTCrystals";CB.PieceFonts[CB.CommandIds.PIECES2D_CRYSTALS_WOOD]="DiagramTTCrystals";CB.PieceFonts[CB.CommandIds.PIECES2D_USCF]="DiagramTTUSCF";
CB.PieceFonts[CB.CommandIds.PIECES2D_OLDSTYLE]="DiagramTTOldstyle";CB.PieceFonts[CB.CommandIds.PIECES2D_HABSBURG]="DiagramTTHabsburg";CB.PieceFonts[CB.CommandIds.PIECES2D_WORLDCHESS]="DiagramTTWorldChess";CB.PieceFonts[CB.CommandIds.PIECES2D_BLUE]="DiagramTTFritz";CB.PieceFonts[CB.CommandIds.PIECES3D_FRITZ]="Fritz";CB.PieceFonts[CB.CommandIds.PIECES3D_MODERN]="Modern";CB.PieceFonts[CB.CommandIds.PIECES3D_ROOM]="Room";CB.PieceFonts[CB.CommandIds.PIECES3D_BALLOON]="Balloon";
CB.PieceFonts[CB.CommandIds.PIECES3D_METAL]="Metal";CB.PieceFonts[CB.CommandIds.PIECES3D_FUTURE]="Future";CB.PieceFonts[CB.CommandIds.PIECES3D_BLACKWHITE]="BlackWhite";CB.PieceFonts[CB.CommandIds.PIECES3D_CHARACTER]="Character";
function buildOldBrowserLandingPage(){CB.LogBrowser("Old");CB.DOM.add("www.playchess.com","h1","NonMobiH1");CB.DOM.add("Play chess and kibitz grand master games","h3","NonMobiH3");CB.DOM.addBr();CB.DOM.add("We are sorry, your browser needs an update.","","NonMobiBody");CB.DOM.add("Please install the latest version.","","NonMobiBody");CB.DOM.addBr();CB.DOM.add("We recommend using Chrome or Firefox. Thank you!","","NonMobiBody");CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addUrl("http://www.playchess.com",
    "www.playchess.com","NonMobiLink");CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();navigator.userAgent&&CB.DOM.add(navigator.userAgent,"","NonMobiBody")}
CB.LogException=function(d,b,c){var e=b?b.toString():"---";if("undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()){CB.System.isMobile()&&(e+=" (mob)",CB.System.getAndroidVersion()?e+=", andr="+CB.System.getAndroidVersion():CB.System.getiOSVersion()&&(e+=", ios="+CB.System.getiOSVersion()));var f="catch";V15&&(e+=", ver="+V15.versionCode.getStrVersion(),f+=V15.versionCode.getStrVersion());var g=d+", "+e;b&&(b.lineNumber&&(g+=", line="+b.lineNumber),b.columnNumber&&(g+=", col="+b.columnNumber),
b.stack&&(c=b.stack));ga("send","event",f,g,c)}console.log(d+", "+e)};CB.LogStats=function(d){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event","Stats",d)};function padInt(d,b){d="000000000"+d;return d.substr(d.length-b)}CB.LogReplayed=function(d,b){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event","Replayed",d,"",padInt(b,6))};
CB.LogBrowser=function(d){5;"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event","Browser",d)};CB.LogConnection=function(d){5;"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event","Connect",d)};
CB.LogVersion=function(){if("undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&(ga("send","event","Version",V15.versionCode.toString()),glSettings&&"undefined"!=typeof glSettings.languageCommandId)){var d=glSettings.getLanguageIdOfCommandId(glSettings.languageCommandId);ga("send","event","Lang",CB.Language.getParamOfLanguageId(d))}};CB.LogConversion=function(d){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","pageview","Goal/"+d)};
CB.LogPage=function(d){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","pageview",d)};CB.SendEvent=function(d,b,c){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event",d,b,c)};CB.SendEvent=function(d,b,c){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event",d,b,c)};CB.PostSpiegelEvent=function(){};"use strict";
CB.GlobalSettings=function(){var d=function(){this.commandHandlerId=V15.commands.registerCommandHandler(this);this.keyDownHandlerId=V15.commands.registerkeyDownHandler(this);this.boardTextureId=V15.config.defaultBoardTextureId||CB.CommandIds.BOARD2D_WOOD;this.pieceStyleId=CB.CommandIds.PIECES2D_FRITZ;this.pieceStyleId3D=CB.CommandIds.PIECES3D_FRITZ;this.load();V15.config.forceBoardTextureId&&(this.pieceStyleId=V15.config.forcePieceStyleId,this.boardTextureId=V15.config.forceBoardTextureId);this.b3dSelected=
    !1};d.prototype.destroy=function(){V15.commands.unregisterCommandHandler(this.commandHandlerId);V15.commands.unregisterkeyDownHandler(this.keyDownHandlerId);this.save()};d.prototype.save=function(){var b=new CB.Storage;b.save("pieceStyleId",this.pieceStyleId);b.save("boardTextureId",this.boardTextureId);b.save("pieceStyleId3D",this.pieceStyleId3D);b.save("langCommandId",this.languageCommandId)};d.prototype.load=function(){var b=new CB.Storage;this.pieceStyleId=b.load("pieceStyleId");this.pieceStyleId3D=
    b.load("pieceStyleId3D");this.boardTextureId=b.load("boardTextureId");this.languageCommandId=b.load("langCommandId")};d.prototype.isBlueBoard=function(){return this.boardTextureId==CB.CommandIds.BOARD2D_BLUE};d.prototype.sendFeedback=function(b,d){(new CB.FeedbackManager).send(b,d)};var b=new CB.Vr;d.prototype.execCommand=function(c){try{switch(c){case CB.CommandIds.SEND_FEEDBACK:glSettings.inDialog()||CB.Forms.showFeedbackForm(this.sendFeedback);break;case CB.CommandIds.LANG_ENGLISH:case CB.CommandIds.LANG_DEUTSCH:case CB.CommandIds.LANG_ESPANOL:case CB.CommandIds.LANG_DUTCH:case CB.CommandIds.LANG_ROMANIAN:case CB.CommandIds.LANG_CHINESE:case CB.CommandIds.LANG_FRENCH:case CB.CommandIds.LANG_RUSSIAN:case CB.CommandIds.LANG_NORWEGIAN:case CB.CommandIds.LANG_POLISH:case CB.CommandIds.LANG_ITALIAN:case CB.CommandIds.LANG_HEBREW:case CB.CommandIds.LANG_CATALAN:case CB.CommandIds.LANG_TURKISH:case CB.CommandIds.LANG_SLOWENIAN:case CB.CommandIds.LANG_GREEK:case CB.CommandIds.LANG_UKRAINIAN:case CB.CommandIds.LANG_VIETNAMESE:case CB.CommandIds.LANG_ARABIC:case CB.CommandIds.LANG_SERBIAN:case CB.CommandIds.LANG_LITHUANIAN:case CB.CommandIds.LANG_PORTUGUESE:case CB.CommandIds.LANG_FARSI:case CB.CommandIds.LANG_GAELIC:case CB.CommandIds.LANG_CROATIAN:case CB.CommandIds.LANG_CZECH:case CB.CommandIds.LANG_HINDI:this.changeLanguage(c);
    break;case CB.CommandIds.TRANSLATE_PAGE:window.open("https://docu.chessbase.com/translate.html","_blank");break;case CB.CommandIds.PIECES2D_FRITZ:case CB.CommandIds.PIECES2D_CRYSTALS:case CB.CommandIds.PIECES2D_CRYSTALS_WOOD:case CB.CommandIds.PIECES2D_USCF:case CB.CommandIds.PIECES2D_OLDSTYLE:case CB.CommandIds.PIECES2D_HABSBURG:case CB.CommandIds.PIECES2D_WORLDCHESS:case CB.CommandIds.PIECES2D_BLUE:case CB.CommandIds.PIECES2D_FF:this.changeBoardStyle(c);break;case CB.CommandIds.TOGGLE_PIECES:b.exec(this.nextBoardStyle(),
    3E3);break;case CB.CommandIds.PIECES3D_FRITZ:case CB.CommandIds.PIECES3D_MODERN:case CB.CommandIds.PIECES3D_ROOM:case CB.CommandIds.PIECES3D_BALLOON:case CB.CommandIds.PIECES3D_METAL:case CB.CommandIds.PIECES3D_FUTURE:case CB.CommandIds.PIECES3D_BLACKWHITE:case CB.CommandIds.PIECES3D_CHARACTER:CB.System.isWebGlCapable()?this.change3DBoardStyle(c):(alert(lm.BROWSER_DOESNT_SUPPORT_3D),this.changeBoardStyle(CB.CommandIds.PIECES2D_FRITZ))}}catch(e){c=V15.Vo.toNumString(c),CB.LogException(c,e)}};d.prototype.onKeyDown=
    function(b){return!1};d.prototype.onFileSelect=function(b,d){return!1};d.prototype.setIsDialogActive=function(b){V15.panelMgr.setIsFormOpen(b)};d.prototype.inDialog=function(){return V15.panelMgr.getIsFormOpen()};d.prototype.change3DBoardStyle=function(b){V15.panelMgr.deleteCanvasPanel&&(this.b3dSelected?V15.panelMgr.deleteCanvasPanel3D():V15.panelMgr.deleteCanvasPanel(),this.b3dSelected=!0,this.pieceFontName3D=CB.PieceFonts[b],this.pieceStyleId3D=b,V15.panelMgr.addCanvasPanel3D())};d.prototype.changeBoardStyle=
    function(b){this.b3dSelected&&(this.b3dSelected=!1,V15.panelMgr.deleteCanvasPanel3D(),V15.panelMgr.addCanvasPanel());CB.BoardSprites.clearCache();this.pieceFontName=CB.PieceFonts[b];this.pieceStyleId=b;this.fireOnBoardStyle(b,this.pieceFontName)};d.prototype.nextBoardStyle=function(){this.pieceStyleId=this.pieceStyleId?this.pieceStyleId+1:CB.CommandIds.PIECES2D_FRITZ+1;this.pieceStyleId>=CB.CommandIds.PIECES_LAST&&(this.pieceStyleId=CB.CommandIds.PIECES2D_FRITZ);!V15.config.has3DBoard&&this.pieceStyleId>=
CB.CommandIds.PIECES3D_FRITZ&&(this.pieceStyleId=CB.CommandIds.PIECES2D_FRITZ);this.pieceStyleId>=CB.CommandIds.PIECES3D_FRITZ?CB.System.isWebGlCapable()?this.change3DBoardStyle(this.pieceStyleId):this.changeBoardStyle(this.pieceStyleId):this.changeBoardStyle(this.pieceStyleId)};d.prototype.changeLanguage=function(b){var c=this.languageCommandId;this.changeLangButtonFlag(b);this.languageCommandId=b;V15.changeLanguage(this.getLanguageIdOfCommandId(b));V15.appUrl&&c!=b&&(this.save(),window.location=
    V15.appUrl+"?lang="+CB.Language.getParamOfLanguageId(glSettings.getLanguageId()))};d.prototype.changeLangButtonFlag=function(b){this.languageBtn&&this.languageBtn.changeFlagIcon(CB.Language.getRibbonFlagName(this.getLanguageIdOfCommandId(b)))};d.prototype.getLanguageIdOfCommandId=function(b){switch(b){default:alert("languageId: "+b);case CB.CommandIds.LANG_ENGLISH:return CB.Language.ENG;case CB.CommandIds.LANG_DEUTSCH:return CB.Language.GER;case CB.CommandIds.LANG_ESPANOL:return CB.Language.ESP;case CB.CommandIds.LANG_DUTCH:return CB.Language.NED;
    case CB.CommandIds.LANG_ROMANIAN:return CB.Language.ROM;case CB.CommandIds.LANG_CHINESE:return CB.Language.CHN;case CB.CommandIds.LANG_FRENCH:return CB.Language.FRA;case CB.CommandIds.LANG_RUSSIAN:return CB.Language.RUS;case CB.CommandIds.LANG_NORWEGIAN:return CB.Language.NOR;case CB.CommandIds.LANG_POLISH:return CB.Language.POL;case CB.CommandIds.LANG_ITALIAN:return CB.Language.ITA;case CB.CommandIds.LANG_HEBREW:return CB.Language.HEB;case CB.CommandIds.LANG_CATALAN:return CB.Language.CAT;case CB.CommandIds.LANG_TURKISH:return CB.Language.TRK;
    case CB.CommandIds.LANG_SLOWENIAN:return CB.Language.SLO;case CB.CommandIds.LANG_GREEK:return CB.Language.GRK;case CB.CommandIds.LANG_UKRAINIAN:return CB.Language.UKR;case CB.CommandIds.LANG_VIETNAMESE:return CB.Language.VIE;case CB.CommandIds.LANG_ARABIC:return CB.Language.ARA;case CB.CommandIds.LANG_SERBIAN:return CB.Language.SER;case CB.CommandIds.LANG_LITHUANIAN:return CB.Language.LIT;case CB.CommandIds.LANG_PORTUGUESE:return CB.Language.BRA;case CB.CommandIds.LANG_FARSI:return CB.Language.FAR;
    case CB.CommandIds.LANG_GAELIC:return CB.Language.GAL;case CB.CommandIds.LANG_CROATIAN:return CB.Language.CRO;case CB.CommandIds.LANG_CZECH:return CB.Language.CZE;case CB.CommandIds.LANG_HINDI:return CB.Language.HIN}};d.prototype.getCommandIdOfLanguage=function(b){switch(b){default:case CB.Language.ENG:return CB.CommandIds.LANG_ENGLISH;case CB.Language.GER:return CB.CommandIds.LANG_DEUTSCH;case CB.Language.ESP:return CB.CommandIds.LANG_ESPANOL;case CB.Language.NED:return CB.CommandIds.LANG_DUTCH;
    case CB.Language.ROM:return CB.CommandIds.LANG_ROMANIAN;case CB.Language.CHN:return CB.CommandIds.LANG_CHINESE;case CB.Language.FRA:return CB.CommandIds.LANG_FRENCH;case CB.Language.RUS:return CB.CommandIds.LANG_RUSSIAN;case CB.Language.NOR:return CB.CommandIds.LANG_NORWEGIAN;case CB.Language.POL:return CB.CommandIds.LANG_POLISH;case CB.Language.ITA:return CB.CommandIds.LANG_ITALIAN;case CB.Language.HEB:return CB.CommandIds.LANG_HEBREW;case CB.Language.CAT:return CB.CommandIds.LANG_CATALAN;case CB.Language.TRK:return CB.CommandIds.LANG_TURKISH;
    case CB.Language.SLO:return CB.CommandIds.LANG_SLOWENIAN;case CB.Language.UKR:return CB.CommandIds.LANG_UKRAINIAN;case CB.Language.GRK:return CB.CommandIds.LANG_GREEK;case CB.Language.VIE:return CB.CommandIds.LANG_VIETNAMESE;case CB.Language.ARA:return CB.CommandIds.LANG_ARABIC;case CB.Language.SER:return CB.CommandIds.LANG_SERBIAN;case CB.Language.LIT:return CB.CommandIds.LANG_LITHUANIAN;case CB.Language.BRA:return CB.CommandIds.LANG_PORTUGUESE;case CB.Language.FAR:return CB.CommandIds.LANG_FARSI;
    case CB.Language.GAL:return CB.CommandIds.LANG_GAELIC;case CB.Language.CRO:return CB.CommandIds.LANG_CROATIAN;case CB.Language.CZE:return CB.CommandIds.LANG_CZECH;case CB.Language.HIN:return CB.CommandIds.LANG_HINDI}};d.prototype.getLanguageCommandIds=function(b){var c=[];b.forEach(function(b){c.push(this.getCommandIdOfLanguage(b))}.bind(this));return c};d.prototype.isRTLLanguage=function(){return this.languageCommandId&&(this.languageCommandId==CB.CommandIds.LANG_HEBREW||this.languageCommandId==
    CB.CommandIds.LANG_ARABIC||this.languageCommandId==CB.CommandIds.LANG_FARSI)};d.prototype.getLanguageId=function(){return this.languageCommandId?this.getLanguageIdOfCommandId(this.languageCommandId):CB.Language.getUserLanguageId()};Ve.initForListeners(d);Ve.addEvent(d,"BoardStyle");Ve.addEvent(d,"BoardStyle3D");return d}();var glSettings;"use strict";
CB.FeedbackManager=function(){var d=function(){};d.prototype.send=function(b,c){this.strAddress=b;this.strComment=c;b=CB.LoginMode.GUEST;CB.Server.PlayerLobby?(this.aPlayerLobby=new CB.Server.PlayerLobby(V15.config.getPlBridgeUris(),"Guest","",b),this.aPlayerLobby.connect(this.onConnected,this)):alert("Thank you")};d.prototype.onConnected=function(b){b.aPlayerLobby&&(b.aPlayerLobby.sendFeedback(b.strAddress,b.strComment,this.feedbackReceived),b.aPlayerLobby.logOff(),alert("Thank you"))};d.prototype.feedbackReceived=
    function(b){};return d}();
CB.AccountPanelMgrMixin=function(){return{onLogin:function(){CB.LOG("Login="+V15.isLoggedIn());this.gameKernel&&this.gameKernel.game.fireOnChanged({forceUpdate:!0});this.setLoginHtml(V15.isLoggedIn())},setLoginHtml:function(d){if(this.infoPanel){if(d)this.infoPanel.setHeight(450<window.innerHeight?28:20),Ext.apply(this.infoPanel,{overflowY:"auto"}),this.infoPanel.update('<div class="CBInfoLoggedIn">'+this.getLoggedInHtml()+"</div>"),this.infoPanel.setBodyStyle(this.getLoginInfoGradient()+";color:white;text-transform:uppercase");
    else{var b=window.innerHeight/3;this.eastContainer&&this.eastContainer.el&&(b=this.eastContainer.getHeight());CB.System.isMobile()&&900>window.innerHeight?this.infoPanel.setHeight(Math.min(b,120)):this.infoPanel.setHeight(Math.min(b,160));Ext.apply(this.infoPanel,{overflowY:"scroll"});this.infoPanel.update('<div class="CBInfoNotLoggedIn">'+this.getPleaseLoginHtml()+"</div>");this.infoPanel.setBodyStyle(CB.CSS.getGradToRight("rgba(254, 254,252,255)","rgba( 251, 251,247,255)")+";color:black;text-transform:none;")}this.infoPanel.loggedIn=
        d;V15.Vf.noLists()&&this.infoPanel.el&&this.infoPanel.setVisible(!1)}},getLoginInfoGradient:function(){return CB.CSS.getGradToRight("rgba(6, 216,19,255)","rgba(24, 147,23,255)")},getGuestInfoGradient:function(){return CB.CSS.getGradToRight("hsl( 120, 15%, 30% )","hsl( 0, 15%, 20% )")},getPleaseLoginHtml:function(d){d=CB.CSS.getHeader("h3",lm.LOGIN_PLEASE_LOGIN,"margin-top:4px");d+=this.getLoginInviteHeader()+"<br/>";if(!CB.System.isMobile()||900<window.innerHeight)d+=this.getFunctionalityText()+"<br/>",
        d+=lm.LOGIN_ACCOUNT_FREE+"<br/><br/>";CB.System.isCordova()||(d+=this.genCreateAccountLink());return d},genCreateAccountLink:function(){return'<a href="'+V15.config.createAccountWebUrl+'" style="color:#8B0A16">'+lm.LOGIN_CREATE_LINK+"</a>"},getLoggedInHtml:function(){return String.f(lm.LOGIN_WELCOME,V15.Vf.userName)},getLoginInviteHeader:function(){return String.f(lm.GENERAL_INVITE,V15.appTitle)},getFunctionalityText:function(){return lm.PLEASE_LOGIN},resizeInfoPanel:function(){var d=!1;if(this.infoPanel&&
        this.infoPanel.el)if(this.infoPanel.loggedIn){var b=22;450<window.innerHeight&&(b=650<window.innerHeight?30:26);this.infoPanel.setHeight(b);d=!0}else this.eastContainer&&(b=Math.min(220,Math.max(20,.3*this.eastContainer.getHeight())),this.infoPanel.setHeight(b));return d}}}();
CB.AccountAppMixin=function(){return{accountLogin:function(d,b){V15.Vf.userName=CB.DOM.getAccountNameCookie(!0)||V15.Vf.userName;V15.Vf.loginToken=CB.DOM.getCookie("AccountToken");if(!d&&V15.Vf.loginToken&&V15.Vf.userName&&"guest"!=V15.Vf.userName)d=new CB.AccountsManager(V15.shortAppName),V15.Vf.userName&&"guest"!=V15.Vf.userName&&V15.Vf.password?d.pwLogin(V15.Vf.userName,V15.Vf.password,this.receiveTokenHandler.bind(this)):d.tokenLogin(V15.Vf.userName,V15.Vf.loginToken,this.tokenLoginHandler.bind(this));
    else this.onRequestLogin(b)},onRequestLogin:function(d){this.enterLoginForm(d)},enterLoginForm:function(d,b){V15.panelMgr.showAccountsForm(d,"",b)},tokenLoginHandler:function(d){d&&1!=d.ResultType&&!d.timeout?(this.setLoggedIn(!1),this.enterLoginForm()):d.timeout?(CB.DOM.clearCookie("AccountToken"),this.setLoggedIn(!1)):(this.setLoggedIn(!0),this.onTokenLoginOk(),V15.showAccountType(d.Subscription));this.loginPending=!1},onTokenLoginOk:function(){},receiveTokenHandler:function(d){if(d&&d.Token){var b=
        unescape(d.Token);V15.Vf.loginToken=b;CB.LOG("AccToken = "+b,"","acc");V15.Vf.rememberLoginToken();d.userId&&1==d.ResultType&&(V15.Vf.userName=d.userId);CB.DOM.setAccountNameCookie(V15.Vf.userName);this.setLoggedIn(!0);CB.ToolButtons&&CB.ToolButtons.showBusyMask("Logged in OK: "+V15.Vf.userName);CB.Timer.launch(function(){CB.ToolButtons&&CB.ToolButtons.hideBusyMask()},600);this.onTokenLoginOk()}else{CB.LOG("No Token Received in token handler");if(d&&1!=d.Result&&!d.timeout&&!d.error)this.onInvalidToken();
        d.timeout&&CB.DOM.clearCookie("AccountToken","");this.setLoggedIn(!1);this.loginPending=!1}},onInvalidToken:function(){V15.panelMgr.showAccountsForm()?V15.panelMgr.showAccountsForm(lm.PW_INVALID,V15.Vf.userName):this.enterLoginForm(String.formatEx(lm.PW_INVALID,V15.Vf.userName))},isLoggedIn:function(){return this.loggedIn||this.loginPending},setLoggedIn:function(d){this.superClass.setLoggedIn.apply(this,arguments);d?document.title=this.appTitle+" - "+V15.Vf.userName:(document.title=this.appTitle+
        " - not logged in",this.loginPending=!1)}}}();"use strict";CB.FilterFlagsEnum={OLSM_NULL:0,OLSM_USE_BOARD:1,OLSM_WINS:16,OLSM_DRAWS:32,OLSM_LOSSES:64,OLSM_WINS_ONLY:128,OLSM_WHITE:256,OLSM_BLACK:512,OLSM_IGNORE_COLORS:1024,OLSM_BEST_GAMES:4096,OLSM_USE_MATERIAL:8192};
CB.SearchMask=function(){var d=function(){this.init()};d.prototype.ELO_NONE=0;d.prototype.YEAR_NONE=0;d.prototype.m_strWhMask="";d.prototype.m_strBlMask="";d.prototype.m_strTournMask="";d.prototype.m_strTitle="";d.prototype.m_strPlaceMask="";d.prototype.freeText="";d.prototype.m_nMinECO=0;d.prototype.m_nMaxECO=65535;d.prototype.m_iMinYear=0;d.prototype.m_iMaxYear=3E3;d.prototype.m_iWhiteMinElo=0;d.prototype.m_iBlackMinElo=0;d.prototype.m_board=new CB.Board;d.prototype.m_eSideToMove=0;d.prototype.m_nFlags=
    CB.FilterFlagsEnum.OLSM_WINS|CB.FilterFlagsEnum.OLSM_DRAWS|CB.FilterFlagsEnum.OLSM_LOSSES|CB.FilterFlagsEnum.OLSM_WHITE|CB.FilterFlagsEnum.OLSM_BLACK;d.prototype.init=function(b){};d.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();b.writeByte(1);b.V5(this.m_strWhMask);b.V5(this.m_strBlMask);b.V5(this.m_strTitle);b.V5(this.m_strPlaceMask);b.writeInt(this.m_iMinYear);b.writeInt(this.m_iMaxYear);b.writeInt(this.m_iWhiteMinElo);b.writeInt(this.m_iBlackMinElo);b.Vi(this.m_nMinECO);b.Vi(this.m_nMaxECO);
    b.writeInt(this.m_nFlags);if(this.getUseBoard()){b.writeByte(this.m_eSideToMove);for(var c=0;64>c;c++)b.writeByte(this.m_board[c])}b.V5(this.freeText);b.endSizedWrite()};d.prototype.setSearchBoard=function(b,c,d){this.m_board=b;this.m_eSideToMove=c};d.prototype.SETFLAG=function(b,c){this.m_nFlags=c?this.m_nFlags|b:this.m_nFlags&~b};d.prototype.ISFLAG=function(b){return 0!=(this.m_nFlags&b)};d.prototype.setIgnoreColors=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_IGNORE_COLORS,b)};d.prototype.setUseBoard=
    function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_USE_BOARD,b)};d.prototype.getUseBoard=function(){return this.ISFLAG(CB.FilterFlagsEnum.OLSM_USE_BOARD)};d.prototype.setUseMaterial=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_USE_MATERIAL,b)};d.prototype.getUseMaterial=function(){return this.ISFLAG(CB.FilterFlagsEnum.OLSM_USE_MATERIAL)};d.prototype.setWins=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_WINS,b)};d.prototype.setDraws=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_DRAWS,b)};d.prototype.setLosses=
    function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_LOSSES,b)};d.prototype.setWhite=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_WHITE,b)};d.prototype.setBlack=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_BLACK,b)};d.prototype.setGoodGames=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_BEST_GAMES,b)};d.prototype.setFreeText=function(b){this.freeText=b};d.prototype.parseFreeText=function(){var b="",c=this.freeText.split(" "),d=0;if(1<c.length)for(var f=0;f<c.length;f++)c[f].replace(" ",""),
    isNaN(c[f])?(b&&(b+=" "),b+=c[f]):d=c[f];0<d&&(this.freeText=b,this.m_iMinYear=this.m_iMaxYear=d)};d.prototype.toString=function(){return"searchmask="+this.freeText+" board= "+m_board.toString()};return d}();"use strict";
CB.OnlineStatEntry=function(){var d=function(){this.clear()};d=function(b){this.moves=[];this.strScore=this.strGames=this.strMoves="";this.iLastYear=0;null!=b&&(this.strMoveNr=b.nota,this.aMove=new CB.Move(b.from,b.to,b.prom))};d.prototype.iLastYear;d.prototype.nWhiteEloSum=0;d.prototype.nBlackEloSum=0;d.prototype.nWhiteEloCount=0;d.prototype.nBlackEloCount=0;d.prototype.nLosses=0;d.prototype.nDraws=0;d.prototype.nWins=0;d.prototype.nGames=0;d.prototype.nDate=0;d.prototype.score=0;d.prototype.strMoveNr=
    "?";d.prototype.moves=[];d.prototype.aMove=new CB.Move;d.prototype.clear=function(){nGames=nDate=nLosses=nDraws=nWins=nWhiteEloCount=nBlackEloCount=nWhiteEloSum=nBlackEloSum=0;this.moves=[]};d.prototype.getMove=function(b){return b<this.moves.length?this.moves[b]:new CB.Move};d.prototype.getNMoves=function(){return this.moves.length};d.prototype.getNWhiteEloAv=function(){return 0<this.nWhiteEloCount?Math.round(this.nWhiteEloSum/this.nWhiteEloCount):0};d.prototype.getNBlackEloAv=function(){return 0<
this.nBlackEloCount?Math.round(this.nBlackEloSum/this.nBlackEloCount):0};d.prototype.getNEloAv=function(b){return b==CB.Side.WHITE?this.getNWhiteEloAv():this.getNBlackEloAv()};d.prototype.V3=function(b,c){b.beginSizedRead();this.nGames=b.Vw();this.strGames=this.nGames.toString();this.nDate=b.Vw();this.iLastYear=(new CB.Date(this.nDate)).year>>9;this.nLosses=b.Vw();this.nDraws=b.Vw();this.nWins=b.Vw();b.Vw();this.nWhiteEloCount=b.Vw();this.nWhiteEloSum=b.Vy();this.nBlackEloCount=b.Vw();this.nBlackEloSum=
    b.Vy();var d=b.readUint8();if(0<d){var f=new CB.NumBoard;f.init(c.board,f.FORMAT_1);for(var g=new CB.NotationGenerator(lm.NOTA_LOCALIZATION),h=new CB.MoveCoder,k=0;k<d;++k){var l=h.decode(b.readUint8(),k);if(0<l&&l<f.FULL_MOVE_INFO){var m=new CB.Position;c.copyTo(m);var p=new CB.Move;f.decode(p,l,m.getBTM());m.isLegalMove(p)&&(m.preCalcCtx(p),m.makeMove(p),m.postCalcCtx(p,!0),l=g.getMoveNota(p),p.nota=l,this.moves.push(p))}}}b.endSizedRead();return!0};return d}();"use strict";
CB.OnlineStatistics=function(){var d=function(){this.vecStat=[]};d.prototype.clear=function(){this.vecStat=[]};d.prototype.V3=function(b,c){this.clear();var d=b.Vw(),f=c.toFEN(),g=new CB.Position(f);if(0<d&&(f=new CB.OnlineStatEntry,f.V3(b,g),--d,0<d))for(g=0;g<f.getNMoves()&&0<d;++g,--d){var h=c.toFEN();h=new CB.Position(h);var k=f.getMove(g);h.preCalcCtx(k);h.makeMove(k);h.postCalcCtx(k,!0);k=new CB.OnlineStatEntry(k);k.V3(b,h);this.vecStat.push(k)}return!0};d.prototype.getEntry=function(b){return this.vecStat[b]};
    d.prototype.Count=function(){return this.vecStat.length};return d}();"use strict";CB.OnlineEntryEnum={FLAGS_ONLINE_NONE:0,FLAGS_ONLINE_ID:1,FLAGS_ONLINE_HEADER:2,FLAGS_ONLINE_GAME:2,toString:function(d){for(var b in this)if(this[b]==d)return"OnlneEntryId: "+b;return"Unknown OnlineEntryId: "+d}};CB.OnlineEntry=function(){var d=function(){this.aGame=new CB.Game};d.prototype.aGame;d.prototype.aHeader;d.prototype.aDB;d.prototype.nGameNr;d.prototype.nFlags;return d}();"use strict";
CB.GameEncoder=function(){var d=function(){};d.prototype.numBits=[1,6,6,5,5,5,3,1,1,6,6,5,5,5,3,1];d.prototype.theBits=[0,32,34,18,20,22,6,0,0,33,35,19,21,23,7,0];d.prototype.isUniqe=[0,255,255,255,255,255,6,14,255,255,255,255,255,255,255,255,255,255,3,11,4,12,5,13,255,255,255,255,255,255,255,255,1,9,2,10,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];d.prototype.moveDecode18=[90,170,153,97,156,120,48,246,217,33,251,89,244,117,179,
    207,138,229,61,134,20,71,41,42,47,157,19,128,51,253,27,168,57,178,205,242,200,185,0,139,132,58,106,30,59,86,194,64,214,53,10,84,5,186,72,131,85,11,100,103,243,191,212,6,29,225,177,38,227,180,160,143,215,122,95,187,199,236,226,88,175,119,218,184,209,222,98,163,62,83,142,112,65,166,174,167,16,197,137,189,66,32,107,255,74,79,123,155,34,46,75,76,196,245,249,173,221,210,198,39,223,44,224,4,231,9,111,109,96,182,146,70,94,69,23,254,172,145,93,234,56,36,102,148,115,55,108,105,21,220,40,77,150,99,114,181,
    37,63,144,110,235,158,202,211,240,101,91,149,12,43,15,68,248,125,219,7,49,67,17,206,203,193,1,171,104,232,228,113,26,247,28,129,204,147,216,80,195,165,3,140,161,116,208,183,31,241,22,130,118,78,151,82,87,121,8,252,35,192,213,133,14,45,54,50,250,176,73,126,60,201,169,25,13,92,190,233,81,230,127,135,162,152,164,141,124,154,238,239,24,136,188,237,159,52,2,18];d.prototype.HUFF_960=128;d.prototype.HUFF_CASTLE=64;d.prototype.HUFF_EP=32;d.prototype.decodeMove2=function(b,c){var d=[];d[0]=CB.Piece.QUEEN;
    d[1]=CB.Piece.ROOK;d[2]=CB.Piece.BISHOP;d[3]=CB.Piece.KNIGHT;b.From=c>>6&63;b.To=c>>0&63;b.SetProm(d[c>>12&3]);b.SetMoveType(0);return!0};d.prototype.decode=function(b,c){var d=!1,f=c.getPos()-4;c.rewind();for(var g=[],h=0;h<f;h++)g[h]=c.readUint8();if(0<f&&g[0]<=f){c=new CB.Position;0<g[0]?(HuffToPos3(c,g,f),b.setStartPosition(c),d=g[0],CBDebug.assert(!1)):(b.getStartPos().NormalInit=!0,d=1);h=new CB.NumBoard;for(h.init(c.board,h.FORMAT_1);d<f;){var k=new CB.Move,l=this.moveDecode18[g[d]]-d;++d;
    if(l>=h.FULL_MOVE_INFO)if(l==h.FULL_MOVE_INFO){if(d+2>f)break;l=this.moveDecode18[g[d]]-d;++d;l|=this.moveDecode18[g[d]]-d<<8;++d;decodeMove2(k,l)}else break;else 0<l&&h.decode(k,l,c.getBTM());this.addMoveInfo(c,k);b.makeMove(k);h.execute(k,c)}d=!0}return d};d.prototype.posToHuff3=function(b,c,d){var e;varindex=0;c[index]=0;index++;c[index]=0;b.GetBTM()&&(c[index]=128);var g=0;var h=1;for(e=2;64>g;g++){var k=b[g]&15;h+=numBits[k];if(8<h){c[index]|=theBits[k]>>h-8;if(++e>d)return ERRCODE.EC_CANCEL;
    index++;c[index]=0;h-=8}c[index]|=theBits[k]<<8-h;if(8<=h){h=0;if(++e>d)return ERRCODE.EC_CANCEL;index++;c[index]=0}}k=g=0;0<b.GetCastleRights()&&(k|=HUFF_CASTLE,g+=4);0<b.GetCPPEPFile()&&(k|=HUFF_EP,g+=3);if(0<g){if(8<h+g){if(++e>d)return ERRCODE.EC_CANCEL;index++;c[index]=0}0<b.GetCastleRights()?(c[index]|=b.GetCastleRights()&15,0<b.GetCPPEPFile()&&(c[index]|=(b.GetCPPEPFile()-1&7)<<4)):0<b.GetCPPEPFile()&&(c[index]|=b.GetCPPEPFile()-1&7)}else 0==h&&--e;c[index]=e|k;return ERRCODE.EC_OK};d.prototype.huffToPos3=
    function(b,c,d){var e,g=0,h;for(e=0;64>e;e++)b[e]=0;e=c[g]&(HUFF_960|HUFF_CASTLE|HUFF_EP);var k=c[g]&31;if(8<k&&k<d){0<(e&HUFF_CASTLE)?(b.SetCastleRights(c[k-1]&15),0<(e&HUFF_EP)?b.setCPPEPFile((c[k-1]>>4&7)+1):b.setCPPEPFile(0)):(b.SetCastleRights(CB.CastleRights.NONE),0<(e&HUFF_EP)?b.setCPPEPFile((c[k-1]&7)+1):b.setCPPEPFile(0));g++;b.SetSideToMove(0<(c[g]&128)?CB.Side.BLACK:CB.Side.WHITE);e=0;d=1;for(h=64;64>e&&d<k;e++){var l=0,m=0;do l<<=1,0<(c[g]&h)&&(l|=1),m++,h>>=1,0==h&&(h=128,g++,d++);while(255==
    isUniqe[l]&&6>m);if(255==isUniqe[l])break;b[e]=CB.Piece(isUniqe[l])}if(64>e)return b.SetGroundPos(),ERRCODE.EC_CANCEL}else return b.SetGroundPos(),ERRCODE.EC_CANCEL;b.FindKings();return ERRCODE.EC_OK};d.prototype.addMoveInfo=function(b,c){b.preCalcCtx(c);b.makeMove(c);b.postCalcCtx(c,!0)};return d}();CB.NumBoardImpl=function(){var d=function(){};d.prototype.numBoard=[];d.prototype.piecePos=[];return d}();
CB.NumBoard=function(){var d=function(){this.numBoard=this.m_aImpl.numBoard;this;piecePos=this.m_aImpl.piecePos};d.prototype.MOVE_EP=16;d.prototype.MOVE_DOUBLE=32;d.prototype.MOVE_PROM=64;d.prototype.moveOffs_Chess=[0,0,0,0,0,0,0,4,2,1,0,0,0,0,0,3,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,6,7,0,0,0,0,0,5,0,0,1,2,3,4,5,6,7,14,1,0,0,0,6,21,8,0,15,0,0,0,22,7,9,0,0,16,0,23,0,0,10,0,0,0,17,0,0,0,11,0,0,25,0,18,0,0,12,3,26,0,0,0,19,4,13,27,2,0,0,0,5,20,0,0,1,0,0,0,
    1,0,0,2,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,2];d.prototype.moveOffs2=[0,0,0,0,0,0,0,4,2,1,0,0,0,0,0,3,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,6,7,0,0,0,0,0,5,0,0,1,2,3,4,5,6,7,14,1,0,0,0,6,21,8,0,15,0,0,0,22,7,9,0,0,16,0,23,0,0,10,0,0,0,17,0,0,0,11,0,0,25,0,18,0,0,12,3,26,0,0,0,19,4,13,27,2,0,0,0,5,20,0,0,1,0,0,0,1,0,0,2,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,2];d.prototype.tableOffs_Chess=[0,0,1,1,1,1,2,0,0,0,1,1,1,1,2,0];d.prototype.tableOffs2=[0,0,1,1,1,1,2,0,0,0,1,1,1,1,2,0];d.prototype.wPawnOffs_Chess=111;d.prototype.pieceMov_Chess=[0,1,9,8,15,7,63,56,57,16,48,1,2,3,4,5,6,7,8,16,24,32,40,48,56,9,18,27,36,45,54,63,15,22,29,36,43,50,57,1,2,3,4,5,6,7,8,16,24,32,40,48,56,1,2,3,4,5,6,7,8,16,24,32,40,48,56,9,18,27,36,45,54,63,15,22,29,36,43,50,57,9,18,27,36,45,54,63,15,22,29,36,43,50,57,17,10,58,49,55,62,14,23,17,10,
    58,49,55,62,14,23,1,2,9,57,1,2,9,57,1,2,9,57,1,2,9,57,1,2,9,57,1,2,9,57,1,2,9,57,1,2,9,57,1,2,3,4,5,6,7,8,16,24,32,40,48,56,9,18,27,36,45,54,63,15,22,29,36,43,50,57,1,2,3,4,5,6,7,8,16,24,32,40,48,56,9,18,27,36,45,54,63,15,22,29,36,43,50,57,1,2,3,4,5,6,7,8,16,24,32,40,48,56,9,18,27,36,45,54,63,15,22,29,36,43,50,57,17,10,58,49,55,62,14,23,0,0,1,9,8,15,7,63,56,57,16,48];d.prototype.bPawnMov_Chess=[7,6,63,15,7,6,63,15,7,6,63,15,7,6,63,15,7,6,63,15,7,6,63,15,7,6,63,15,7,6,63,15];d.prototype.pieceNum_Chess=
    [0,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,5,5,5,5,5,5,5,5,5,5,5,5,5,5,21,21,21,21,21,21,21,21,21,21,21,21,21,21,4,4,4,4,4,4,4,4,4,4,4,4,4,4,20,20,20,20,20,20,20,20,20,20,20,20,20,20,3,3,3,3,3,3,3,3,19,19,19,19,19,19,19,19,6,6,6,6,22,22,22,22,38,38,38,38,54,54,54,54,70,70,70,70,86,86,86,86,102,102,102,102,118,118,118,118,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
        34,34,34,34,34,34,34,34,37,37,37,37,37,37,37,37,37,37,37,37,37,37,36,36,36,36,36,36,36,36,36,36,36,36,36,36,35,35,35,35,35,35,35,35,0,0,17,17,17,17,17,17,17,17,17,17];d.prototype.pieceOffs_Chess=[0,1,11,95,53,39,111,0,0,1,11,95,53,39,111,0,0,237,143,103,67,53,115,0,0,237,143,103,67,53,115,0,0,0,171,227,199,199,119,0,0,0,171,227,199,199,119,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0,127,0,0,0,0,0,0,0,127,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,139,
    0,0,0,0,0,0,0,139,0];d.prototype.pieceInx_Chess=[0,24,0,1,2,3,26,0,0,25,12,13,14,15,27,0,0,42,4,5,6,7,28,0,0,43,16,17,18,19,29,0,0,0,8,9,10,11,30,0,0,0,20,21,22,23,31,0,0,0,0,0,0,0,32,0,0,0,0,0,0,0,33,0,0,0,0,0,0,0,34,0,0,0,0,0,0,0,35,0,0,0,0,0,0,0,36,0,0,0,0,0,0,0,37,0,0,0,0,0,0,0,38,0,0,0,0,0,0,0,39,0,0,0,0,0,0,0,40,0,0,0,0,0,0,0,41,0];d.prototype.maxPiece_Chess=[0,16,48,48,48,48,128,0,0,16,48,48,48,48,128,0];d.prototype.maxPiece_MultiKing=[0,32,48,48,48,48,128,0,0,32,48,48,48,48,128,0];d.prototype.moveOffs=
    [];d.prototype.tableOffs=[];d.prototype.pieceMov=[];d.prototype.pieceNum=[];d.prototype.bPawnMov=[];d.prototype.pieceOffs=[];d.prototype.pieceInx=[];d.prototype.maxPiece=[];d.prototype.wPawnOffs=0;d.prototype.FORMAT_0=0;d.prototype.FORMAT_1=1;d.prototype.FULL_MOVE_INFO=235;d.prototype.CB_ORIGIN1=236;d.prototype.KING2_START=237;d.prototype.KING2_END=246;d.prototype.CB_LINE_START=254;d.prototype.CB_LINE_END=255;d.prototype.IsMultiByte=function(b){return b==FULL_MOVE_INFO};d.prototype.m_aImpl=new CB.NumBoardImpl;
    d.prototype.numBoard=[];d.prototype.piecePos=[];d.prototype.MOVEPIECE=function(b,c){b&&b<this.maxPiece[b&CB.Piece.PIECE_MASK]&&(this.piecePos[this.pieceInx[b]]=c)};d.prototype.init=function(b,c){var d=[],f;this.moveOffs=this.moveOffs_Chess;this.tableOffs=this.tableOffs_Chess;this.pieceMov=this.pieceMov_Chess;this.pieceNum=this.pieceNum_Chess;this.bPawnMov=this.bPawnMov_Chess;this.pieceOffs=this.pieceOffs_Chess;this.pieceInx=this.pieceInx_Chess;this.maxPiece=this.maxPiece_Chess;this.wPawnOffs=this.wPawnOffs_Chess;
        for(f=0;48>f;f++)this.piecePos[f]=255;for(f=0;16>f;f++)d[f]=f;switch(c){case this.FORMAT_1:for(f=63;0<=f;f--)c=b[f]&15,0<c?(this.numBoard[f]=d[c],d[c]<this.maxPiece[c&CB.Piece.PIECE_MASK]&&(this.piecePos[this.pieceInx[d[c]]]=f,d[c]+=16),CBDebug.assert(0<this.numBoard[f])):this.numBoard[f]=0;break;default:for(f=0;64>f;f++)c=b[f],0<c?(this.numBoard[f]=d[c],d[c]<maxPiece[c&CB.Piece.PIECE_MASK]&&(this.piecePos[pieceInx[d[c]]]=f,d[c]+=16),CBDebug.assert(0<this.numBoard[f])):this.numBoard[f]=0}};d.prototype.promote=
        function(b,c){for(c|=uint(b&Chess.COLOUR);c<maxPiece[c&15];){if(255==piecePos[pieceInx[c]]){piecePos[pieceInx[c]]=piecePos[pieceInx[b]];break}c+=16}numBoard[piecePos[pieceInx[b]]]=c;piecePos[pieceInx[b]]=255;return 0};d.prototype.capture=function(b){if(b)if((b&CB.Piece.PIECE_MASK)==CB.Piece.PAWN)this.MOVEPIECE(b,255);else if(b<this.maxPiece[b&15]){this.MOVEPIECE(b,255);for(var c=this.maxPiece[b&15]-16,d=b;d<c;d+=16){this.piecePos[this.pieceInx[d]]=this.piecePos[this.pieceInx[d+16]];if(255==this.piecePos[this.pieceInx[d]])break;
        this.numBoard[this.piecePos[this.pieceInx[d]]]=d;this.piecePos[this.pieceInx[d+16]]=255}if(255!=this.piecePos[this.pieceInx[c|b&15]])for(b=this.maxPiece[b&15]|b&15,d=0;64>d;d++)if(this.numBoard[d]==b){this.piecePos[this.pieceInx[b-16]]=d;this.numBoard[d]=b-16;break}}return 0};d.prototype.execute=function(b,c){if(!b.IsNullMove){var d=b.from,f=b.to,g=this.numBoard[d],h=this.numBoard[f];g||CBDebug.assert("no piece to move");this.numBoard[f]=this.numBoard[d];this.numBoard[d]=0;this.MOVEPIECE(g,f);h&&
    (h&CB.Piece.PIECE_MASK)!=CB.Piece.KING&&this.capture(h);if(b.isCastling()||b.isProm())b.isProm()?b.IsProm()&&this.promote(g,b.prom):b.isCastling()&&(c.getBTM()?b.isLongCastling()?(this.MOVEPIECE(this.numBoard[CB.Square.A8],f+(CB.Square.B8-CB.Square.A8)),this.numBoard[f+(CB.Square.B8-CB.Square.A8)]=this.numBoard[CB.Square.A8],this.numBoard[CB.Square.A8]=0):b.isShortCastling()&&(this.MOVEPIECE(this.numBoard[CB.Square.H8],CB.Square.F8),this.numBoard[CB.Square.F8]=this.numBoard[CB.Square.H8],this.numBoard[CB.Square.H8]=
        0):b.isLongCastling()?(this.MOVEPIECE(this.numBoard[CB.Square.A1],f+(CB.Square.B1-CB.Square.A1)),this.numBoard[f+(CB.Square.B1-CB.Square.A1)]=this.numBoard[CB.Square.A1],this.numBoard[CB.Square.A1]=0):b.isShortCastling()&&(this.MOVEPIECE(this.numBoard[CB.Square.H1],CB.Square.F1),this.numBoard[CB.Square.F1]=this.numBoard[CB.Square.H1],this.numBoard[CB.Square.H1]=0));for(b=0;64>b;b++)this.numBoard[b]&&this.numBoard[b]<this.maxPiece[this.numBoard[b]&7]&&this.piecePos[this.pieceInx[this.numBoard[b]]]!=
    b&&DUMP("(1) Inx corrupted: "+String(b))}};d.prototype.encode=function(b,c){CBDebug.assert(0<numBoard[b.from]);if(0<numBoard[b.from]&&numBoard[b.from]<maxPiece[b.CB.Piece.Nominal()]){c=(b.to&56)-(b.from&56)&56|(b.To&7)-(b.From&7)&7;c=pieceOffs[numBoard[b.from]]+moveOffs[64*tableOffs[b.CB.Piece.Nominal()]+c];CBDebug.assert(c<FULL_MOVE_INFO||16<maxPiece[CB.Piece.KING]&&c>=KING2_START&&c<=KING2_END);var d=new CB.Move;Decode(d,c,(numBoard[b.fr]&Chess.COLOUR)==Chess.COLOUR);CBDebug.assert(d.From==b.From&&
        d.To==b.To)}};d.prototype.decode=function(b,c,d){CBDebug.assert(c<this.FULL_MOVE_INFO||16<this.maxPiece[CB.Piece.KING]&&c>=this.KING2_START&&c<=this.KING2_END);var e=this.pieceMov[c],g=this.pieceNum[c];d&&(g|=CB.Side.SIDE_MASK,(g&CB.Piece.PIECE_MASK)==CB.Piece.PAWN&&(e=this.bPawnMov[c-this.wPawnOffs]));b.from=this.piecePos[this.pieceInx[g]]&63;b.to=(b.from&56)+(e&56)&56|b.from+e&7;b.prom=0;for(b=b.type=0;64>b;b++)0!=this.numBoard[b]&&this.numBoard[b]<this.maxPiece[this.numBoard[b]&CB.Piece.PIECE_MASK]&&
    this.piecePos[this.pieceInx[this.numBoard[b]]]!=b&&CBDebug.assert(!1)};return d}();
CB.MoveCoder=function(){var d=function(){};d.prototype.moveEncode19=[115,113,245,122,119,36,91,210,93,137,56,239,159,205,160,142,246,17,125,46,62,241,57,130,39,88,11,70,204,118,173,135,54,30,199,68,154,186,55,27,168,53,175,123,52,49,129,221,206,1,73,169,18,209,58,165,183,72,31,198,251,6,63,2,101,229,136,32,60,71,41,37,110,250,197,51,43,150,105,163,238,26,191,116,249,207,208,75,215,40,158,111,120,134,234,67,176,86,121,185,124,83,240,24,89,244,13,196,223,78,38,231,103,79,171,145,184,151,149,69,188,
    181,161,0,195,44,5,178,172,174,66,133,80,217,254,236,146,132,157,235,96,242,140,87,74,247,100,219,95,99,187,224,85,255,155,22,237,192,148,126,141,167,189,139,180,20,47,23,182,222,179,131,220,3,253,200,127,7,16,33,214,152,211,42,14,97,64,45,77,227,19,29,248,153,156,112,147,109,61,233,225,218,81,144,213,59,84,9,166,104,76,194,228,232,212,48,177,252,203,143,34,10,162,35,98,106,65,90,25,190,193,138,128,92,230,4,15,107,21,243,201,108,102,12,202,114,94,28,216,164,117,82,226,170,8,50];d.prototype.moveDecode19=
    [123,49,63,173,235,126,61,177,254,207,221,26,243,106,184,236,178,17,52,190,165,238,155,167,103,228,81,39,247,191,33,58,67,179,220,223,5,71,110,24,89,70,183,76,125,187,19,166,215,45,255,75,44,41,32,38,10,22,54,205,68,198,20,62,186,226,130,95,35,119,27,69,57,50,144,87,210,188,109,113,132,202,251,101,206,152,97,143,25,104,227,6,233,8,246,148,140,185,224,149,146,64,242,112,209,78,225,237,241,197,72,91,195,1,245,0,83,250,29,4,92,98,3,43,100,18,159,176,232,46,23,171,137,131,93,31,66,9,231,163,142,160,15,
        219,203,115,136,196,158,118,77,117,181,193,36,154,194,138,90,12,14,122,222,79,249,55,208,161,40,51,253,114,128,30,129,42,96,216,127,170,164,121,168,56,116,99,37,150,120,162,229,82,157,230,211,124,107,74,59,34,175,240,244,218,28,13,48,85,86,53,7,182,214,204,180,88,248,133,201,147,172,47,169,108,151,200,252,189,212,65,234,111,213,199,94,139,135,156,80,11,102,21,141,239,105,2,16,145,192,84,73,60,217,174,134,153];d.prototype.decode=function(b,c){return this.moveEncode19[b-c]};d.prototype.decode=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 c){return this.moveDecode19[b]+c};return d}();"use strict";CB.namespace("CB.Server.OnlineLobby");CB.OnlineDBUserMsgId={NONE:0,REQUEST_AUTOCOMPLETE:1350,AUTOCOMPLETE:1351,toString:function(d){for(var b in this)if(this[b]==d)return b;return"Unknown OnlineDBUserMsgId: "+d}};
CB.Server.OnlineLobby=function(){var d=function(){this.idGroup=0;this.maxGames=100;this.firstMove=0;this.name="OnlineDB"};CB.inherit(d,CB.Server.Connector);d.prototype.createLobby=function(b,d,f,g){this.create(b,d,f,g)};d.prototype.testYesNo=function(b){CB.LOG("YesNo="+b)};d.prototype.games=[];d.prototype.statboard=new CB.Board;d.prototype.statside=0;var b;d.prototype.getStatistics=function(c,d){if(0<this.getNId()){V15.panelMgr.dbBook&&V15.panelMgr.dbBook.startupdate();b=this;b.statboard=new CB.Board;
    for(var e=0;64>e;e++)b.statboard[e]=c[e];this.statside=d;e=new CB.WebSockMessage(CB.SockMsgId.REQUEST_ONLINE_DB_STATISTICS);e.buf.beginSizedWrite();e.buf.writeByte(d);for(d=0;64>d;d++)e.buf.writeByte(c[d]);e.buf.endSizedWrite();this.send(e)}};d.prototype.search=function(b,d,f){V15.panelMgr.dbGames&&V15.panelMgr.dbGames.startupdate();var c=new CB.WebSockMessage(CB.SockMsgId.QUERY_ONLINE_DB);this.games=[];this.games.length=0;b.parseFreeText();b.writeToDataBuffer(c.buf);this.maxGames=d||50;this.firstMove=
    f||0;this.send(c)};d.prototype.getHeaders=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.REQUEST_ONLINE_DB_HEADERS);c.buf.Vh(b.length);for(var d=0;d<b.length;d++)c.buf.Vh(b[d]);this.send(c)};d.prototype.getOneGame=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.REQUEST_ONLINE_DB_GAMES);c.setVal(1);c.buf.Vh(1);c.buf.Vh(b);this.send(c)};d.prototype.getGames=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.REQUEST_ONLINE_DB_GAMES);c.setVal(2);c.buf.Vh(b.length);for(var d=0;d<b.length;d++)c.buf.Vh(b[d]);
    this.send(c)};d.prototype.requestInfo=function(){var b=new CB.WebSockMessage(CB.SockMsgId.REQUEST_ONLINE_DB_USER_INFO);this.send(b)};d.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b))try{switch(b.getType()){default:TRACE("Unhandled: "+b.toString());break;case CB.SockMsgId.DEFAULTGROUPS:this.requestInfo();break;case CB.SockMsgId.ONLINE_DB_STATISTICS:this.handleOnlineStatistics(b);break;case CB.SockMsgId.ONLINE_DB_USER_INFO:this.handleOnlineDBUserInfo(b);break;case CB.SockMsgId.ONLINE_DB_NUMBERS:this.handleOnlineDBNumbers(b);
    break;case CB.SockMsgId.ONLINE_DB_GAMES:this.handleGames(b);break;case CB.SockMsgId.ONLINE_DB_HEADERS:this.handleHeaders(b);break;case CB.SockMsgId.USER:this.handleUserMsg(b)}}catch(e){CB.LogException(CB.SockMsgId.toNumString(b.getType()),e)}};d.prototype.handleHeaders=function(b){b=b.getBuf();for(var c=[],d=b.Vw(),g=0;g<d;g++){b.beginSizedRead();var h=b.Vw(),k=new CB.DataBuffer;if(0<h){for(var l=b.Vw(),m=0;m<l;m++)k.writeUint8(b.readUint8());l=new CB.Game;if(!this.loadHeader(l,k))break;for(k=0;k<
this.games.length;k++)if(this.games[(k+g)%this.games.length].aGameNr==h){this.games[(k+g)%this.games.length].aGame.hdr=l.hdr;this.games[(k+g)%this.games.length].nFlags=CB.OnlineEntryEnum.FLAGS_ONLINE_HEADER;c.push(this.games[(k+g)%this.games.length]);break}}b.endSizedRead()}this.fireOnGames(c)};d.prototype.handleGames=function(b){var c=b.getBuf(),d=c.Vw();if(1==d&&1==b.getVal())c.beginSizedRead(),b=c.Vw(),0<b&&(d=new CB.Game,this.readGame(d,c)&&V15.panelMgr.loadGame(d)),c.endSizedRead();else{for(var g=
    [],h=0;h<d;h++){c.beginSizedRead();b=c.Vw();if(0<b){var k=new CB.Game;if(this.readGame(k,c,b))g.push({aGame:k,aGameNr:b,nFlags:CB.OnlineEntryEnum.FLAGS_ONLINE_HEADER|CB.OnlineEntryEnum.FLAGS_ONLINE_GAME});else break}c.endSizedRead()}this.fireOnGames(g)}};d.prototype.handleOnlineDBNumbers=function(b){b=b.getBuf();var c=b.Vw();b.Vw();for(var d=0;d<c&&d<this.maxGames;d++){var g=b.Vw();if(0<g){var h=new CB.OnlineEntry;h.nFlags=CB.OnlineEntryEnum.FLAGS_ONLINE_ID;h.aGameNr=g;this.games.push(h)}}if(V15.panelMgr&&
    V15.panelMgr.setGames)V15.panelMgr.setGames(this.games);else if(V15.panelMgr.usesOnlineDB&&V15.panelMgr.usesOnlineDB()){b=[];for(c=0;c<this.games.length;c++)this.games[c].nFlags==CB.OnlineEntryEnum.FLAGS_ONLINE_ID&&b.push(this.games[c].aGameNr);0<b.length&&V15.onlineLobby.getGames(b)}};d.prototype.handleOnlineStatistics=function(c){c=c.getBuf();for(var d=new CB.Position,f=0;64>f;f++)d.board[f]=b.statboard[f];d.sd=b.statside;f=new CB.OnlineStatistics;f.V3(c,d);this.fireOnStatistics(f)};d.prototype.handleOnlineDBUserInfo=
    function(b){this.nGamesInDatabase=b.getBuf().Vw();b=new CB.SearchMask;var c=0;if(this.getGameForFirstSearch){var d=this.getGameForFirstSearch();c=d.getCurPos().getPlyNum()}else d=new CB.Game;var g=decodeURIComponent(CB.strUtil.trimQuotes(CB.strUtil.getURLParam("search")));g?b.freeText=g:(b.setSearchBoard(d.getCurPos().board,d.getCurPos().getSideToMove()),b.setUseBoard(!0));this.search(b,50,c)};d.prototype.handleUserMsg=function(b){try{switch(b.getUserType()){default:CB.LOG("UserMsg="+CB.UserMsgId.toString(b.getUserType()));
    break;case CB.OnlineDBUserMsgId.AUTOCOMPLETE:this.handleAutoComplete(b)}}catch(e){CB.LogException(CB.UserMsgId.toNumString(b.getUserType()),e)}};d.prototype.requestAutoComplete=function(b,d,f){this.autoCompleteCallbackFn=d;this.combo=f;b=new CB.GameAutoCompleteRequest(b,CB.GameAutoCompleteEnum.ACR_LASTNAME);d=new CB.WebSockMessage(CB.SockMsgId.USER);b.write(d.buf);d.setUserType(CB.OnlineDBUserMsgId.REQUEST_AUTOCOMPLETE);this.send(d)};d.prototype.handleAutoComplete=function(b){var c=new CB.GameAutoCompleteAnswer;
    c.read(b.getBuf());this.autoCompleteCallbackFn(this.combo,c)};d.prototype.readGame=function(b,d,f){try{return b.read2(d)}catch(g){console.log(g)}return!1};d.prototype.loadHeader=function(b,d){try{return d.rewind(),b.hdr.read(d),!0}catch(f){CB.LogException("OL-LH:"+f)}return!1};d.prototype.handleChat=function(b){V15.panelMgr.chatOut(chat.toString())};d.prototype.handleReconnectOk=function(b){};Ve.initForListeners(d);Ve.addEvent(d,"Statistics");Ve.addEvent(d,"Games");return d}();"use strict";
CB.GameAutoCompleteEnum={ACR_NONE:0,ACR_LASTNAME:1,ACR_FIRSTNAME:2,ACR_EVENT:4,ACR_SITE:8,toString:function(d){for(var b in this)if(this[b]==d)return"GameAutoCompleteId: "+b;return"Unknown GameAutoCompleteId: "+d}};CB.GameAutoCompleteRequest=function(){var d=function(b,c){this.m_strRequest=b;this.m_nFlags=c};d.prototype.write=function(b){b.beginSizedWrite();b.Vx(this.m_nFlags);b.Vn(this.m_strRequest);b.endSizedWrite()};return d}();
CB.GameAutoCompleteAnswer=function(){var d=function(){};d.prototype.read=function(b){this.data=[];b.beginSizedRead();for(var c=b.V10(),d=0;d<c;d++){var f=b.Vq(80);this.data.push(f)}b.endSizedRead()};return d}();
CB.LocalPlayerBase=function(){var d=function(){this.instance=localforage.createInstance({name:"Player"})};d.prototype.instance=null;d.prototype.createDatabase=function(){};d.prototype.setPlayer=function(b,c,d){d?c=this.getLastNameKey(d)+","+this.getFirstNameKey(c):(c=b.player.player.m_NewCBPlayer.m_aKey,c=this.getLastNameKey(c.m_sLastName)+","+this.getFirstNameKey(c.m_sFirstName));this.instance.setItem(c,b)};d.prototype.beginGetPlayer=function(b,c,d,f,g,h){b=this.getFirstNameKey(b);c=this.getLastNameKey(c);
    this.instance.getItem(c+","+b).then(function(b){b?g(b):h("Player not found")})};d.prototype.getPlayer=function(b,c,d,f){b=this.getFirstNameKey(b);c=this.getLastNameKey(c);return this.instance.getItem(c+","+b)};d.prototype.getFirstNameKey=function(b){return b?b.split(/[\s-]/gi)[0]:""};d.prototype.getLastNameKey=function(b){return b.replace(/[\s-]/gi,"")};return d}();"use strict";CB.namespace("CB.Server.PlayerLobby");
CB.Server.PlayerLobby=function(){var d=function(){this.name="Players";this.idPictureTicket=this.idCandidateTicket=this.idPlayerTicket=0;this.playerContext={};this.reconnectBaseTime=6E4;this.localPB=new CB.LocalPlayerBase;this.requestQueue=[];this.connectTries=0};CB.inherit(d,CB.Server.Connector);d.prototype.requestQueue=null;d.prototype.connect=function(b,d){this.callbackfnConnected=b;this.superClass.connect.apply(this,arguments)};d.prototype.logon=function(){if(!this.hasIdReceived){var b=new CB.LogonData(this.user,
    this.pass,CB.LoginMode.NORMAL,V15.Vf.guid);this.send(b.Vc())}};d.prototype.logOff=function(){if(this.hasIdReceived&&!this.loggedOff){var b=new CB.WebSockMessage(CB.SockMsgId.LOGOFF);b.address(this.conn.connectId,CB.ConnectId.SERVER);b.buf.Vx(0);this.send(b);this.pingTimer.stop();this.loggedOff=!0}};new CB.Vr;d.prototype.notifyUserActivity=function(){};d.prototype.getNId=function(){return this.conn.connectId};d.prototype.getNIdBound=function(){return this.idBound};d.prototype.isGuest=function(){return this.client?
    this.client.isGuest():!0};d.prototype.onConnect=function(){this.pingTimer.stop();this.loginMode==CB.LoginMode.GUEST?this.logonGuest():this.logon()};d.prototype.sendFeedback=function(b,d,f){this.callbackFeedback=f;f=new CB.WebSockMessage(CB.SockMsgId.PLAYER_BASE_USER);f.setUserType(CB.PlayerUserMsgId.SEND_FEEDBACK);f.buf.Vn(b);f.buf.Vn(d);f.buf.Vx(V15.versionCode.nFamily);f.buf.Vn(CB.Language.getStrUserLanguage());this.send(f)};d.prototype.localPB=null;d.prototype.byteArrayToBase64=function(b){var c=
    "";b=new Uint8Array(b);for(var d=b.byteLength,g=0;g<d;g++)c+=String.fromCharCode(b[g]);return window.btoa(c)};d.prototype.Base64ToByteArray=function(b){b=window.atob(b);for(var c=b.length,d=new Uint8Array(c),g=0;g<c;g++)d[g]=b.charCodeAt(g);return d.buffer};d.prototype.addToStorage=function(b,d,f){this.localPB.setPlayer({player:b,created:new Date},d,f)};var b=function(b,d){b=b.player;var c=new CB.Player;c.m_NewCBPlayer=new CB.NewCBPlayer;c.m_NewCBPlayer.m_aKey=new CB.PlayerKey;c.m_NewCBPlayer.m_HighData=
    new CB.HighPlayerData;c.setFirstName(b.player.m_NewCBPlayer.m_aKey.m_sFirstName);c.setLastName(b.player.m_NewCBPlayer.m_aKey.m_sLastName);c.setNation(b.player.m_NewCBPlayer.m_HighData.m_aNation);c.setTitle(b.player.m_NewCBPlayer.m_HighData.m_aTitle);d({player:c,pic:b.pic})};d.prototype.getLocalPlayer=function(c,d,f,g){this.localPB.beginGetPlayer(c,d,0,0,function(c){var d=c.created;d.setDate(d.getDate()+1);d>new Date?b(c,f):g()},g)};d.prototype.getPlayer=function(c,d,f,g,h,k){var e=function(b){12>
++this.connectTries&&(this.isLoggedIn()||this.conn.isConnected()||this.conn.isConnecting()||this.connect(),this.requestWithTicket(c,d,f,g,function(b){this.addToStorage(b,c,d);h(b)}.bind(this)),k&&k())}.bind(this);this.localPB.beginGetPlayer(c,d,f,g,function(c){var d=c.created;d.setMonth(d.getMonth()+1)>new Date?b(c,h):e()}.bind(this),e.bind(this))};d.prototype.workRequestQueue=function(){for(;0<this.requestQueue.length;)this.requestQueue.pop()()};d.prototype.requestMultiPlayerInfo=function(b,d,f){if(this.boundLoginOk){this.idPlayerTicket++;
    var c=this;this.playerContext[this.idPlayerTicket]={fnCallback:function(e){for(var f=0;f<e.length;f++)e[f].found&&c.addToStorage(e[f],b[f].firstName,b[f].lastName);d(e)}};var e=new CB.WebSockMessage(CB.SockMsgId.PLAYER_BASE_USER);f?e.setUserType(CB.PlayerUserMsgId.QUERY_JS_MULTI_PLAYER_WITH_PIC):e.setUserType(CB.PlayerUserMsgId.QUERY_JS_MULTI_PLAYER_INFO);e.buf.Vh(this.idPlayerTicket);var k=new CB.DataBuffer;k.Vh(b.length);for(var l=0;l<b.length;l++)k.Vn(String.formatEx("{0}#{1}",b[l].lastName,b[l].firstName)),
        k.Vh(b[l].elo);e.buf.writeDataBuffer(k);this.send(e)}else!this.isLoggedIn()&&4>++this.connectTries&&!this.conn.isConnected()&&!this.conn.isConnecting()&&this.connect(),this.requestQueue.push(function(){this.requestMultiPlayerInfo(b,d,f)}.bind(this))};d.prototype.requestWithTicket=function(b,d,f,g,h){if(this.boundLoginOk){CB.LOG("PBReq="+d,"","pb");this.idPlayerTicket++;this.playerContext[this.idPlayerTicket]={fnCallback:h,elo:f,year:g,player:{},pic:null};var c=new CB.WebSockMessage(CB.SockMsgId.PLAYER_BASE_USER);
    c.setUserType(CB.PlayerUserMsgId.QUERY_JS_PLAYER_BY_NAME_AND_ELO);c.buf.Vh(this.idPlayerTicket);c.buf.Vn(b);c.buf.Vn(d);c.buf.Vh(f);c.buf.Vh(g);this.send(c)}else this.requestQueue.push(function(){this.requestWithTicket(b,d,f,g,h)}.bind(this)),CB.LOG("PlayerLobby no boundLogin")};d.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b)){CB.LOG("PBReply="+b.getType()+"/"+b.getUserType(),"","pb");try{switch(b.getType()){default:TRACE("Unhandled: "+b.toString());break;case CB.SockMsgId.DEFAULTGROUPS:this.boundLoginOk=
    !0;this.callbackfnConnected&&this.callbackfnConnected();this.workRequestQueue();this.fireOnConnected();break;case CB.SockMsgId.BINDERTIMEOUT:break;case CB.SockMsgId.INVALIDPASSWORD:break;case CB.SockMsgId.ALREADYLOGGEDON:break;case CB.SockMsgId.CHAT:this.handleChat(b);break;case CB.SockMsgId.RECONNECT_OK:this.handleReconnectOk(b);break;case CB.SockMsgId.PLAYER_BASE_USER:this.handleUserMsg(b)}}catch(e){b=CB.SockMsgId.toNumString(b.getType()),CB.LogException(b,e)}}};d.prototype.handleUserMsg=function(b){try{switch(b.getUserType()){default:CB.LOG("UserMsg="+
    CB.PlayerUserMsgId.toString(b.getUserType()));break;case CB.PlayerUserMsgId.ANS_JS_PLAYER_BY_NAME_AND_ELO:this.handleFillJSPlayer(b);break;case CB.PlayerUserMsgId.SEND_FEEDBACK_ANS:this.handleFeedback(b);break;case CB.PlayerUserMsgId.ANS_JS_PLAYER_MULTI_PLAYER_INFO:this.handleFillJSPlayerArray(b);break;case CB.PlayerUserMsgId.ANS_JS_MULTI_PLAYER_WITH_PIC:this.handleFillJSPlayerArrayWithPics(b)}}catch(e){b=CB.PlayerUserMsgId.toNumString(b.getUserType()),CB.LogException(b,e)}};d.prototype.handleMultiNationInfo=
    function(b){this.handleTicket(b)};d.prototype.handleFillPlayerItemByNameAndThumb=function(b){this.handleTicket(b)};d.prototype.handleMultiPlayerItemBNat=function(b){this.handleTicket(b)};d.prototype.handleGetBatchId=function(b){this.handleTicket(b)};d.prototype.handleCurrentPBVersion=function(b){b.getBuf().Vw()};d.prototype.handleFillPlayerByCSID=function(b){this.handleTicket(b)};d.prototype.handleFillJSPlayer=function(b){b=b.getBuf();var c=b.Vw(),d=new CB.Player;d.m_NewCBPlayer=new CB.NewCBPlayer;
    d.m_NewCBPlayer.m_aKey=new CB.PlayerKey;d.m_NewCBPlayer.m_HighData=new CB.HighPlayerData;var g=b.V14();CB.LOG("JSPlayer: found="+g,"LogBlue","pb");if(g)if(d.setFirstName(b.Vq(100)),d.setLastName(b.Vq(100)),b.readInt(),d.setNation(b.readInt()),d.setTitle(b.readShort()),0!=b.readInt()){g=b.Vw();CB.LOG("JSPlayer: found Picture, size="+g,"LogBlue","pb");for(var h=[],k=0;k<g;k++)h.push(b.readUint8());this.playerContext[c].fnCallback({player:d,pic:h})}else this.playerContext[c].fnCallback({player:d})};
    d.prototype.handleFillJSPlayerArray=function(b){b=b.getBuf();var c=b.Vw();b.V10();for(var d=[];b.nPos<b.nSize;){var g=new CB.Player;g.m_NewCBPlayer=new CB.NewCBPlayer;g.m_NewCBPlayer.m_aKey=new CB.PlayerKey;g.m_NewCBPlayer.m_HighData=new CB.HighPlayerData;var h=b.V14();g.setLastName(b.Vq(100));g.setFirstName(b.Vq(100));b.Vw();g.setNation(b.Vw());g.setTitle(b.readShort());d.push({found:h,player:g})}this.playerContext[c].fnCallback(d)};d.prototype.handleFillJSPlayerArrayWithPics=function(b){b=b.getBuf();
        var c=b.Vw();b.Vw();for(var d=[];b.nPos<b.nSize;){var g=new CB.Player;g.m_NewCBPlayer=new CB.NewCBPlayer;g.m_NewCBPlayer.m_aKey=new CB.PlayerKey;g.m_NewCBPlayer.m_HighData=new CB.HighPlayerData;var h=b.V14();g.setLastName(b.Vq(100));g.setFirstName(b.Vq(100));b.Vw();g.setNation(b.Vw());g.setTitle(b.readShort());var k=null;if(0!=b.V10()){var l=b.Vw();k=[];for(var m=0;m<l;m++)k.push(b.readUint8())}d.push({found:h,player:g,pic:k})}this.playerContext[c].fnCallback(d)};d.prototype.handleTicket=function(b){b=
        b.getBuf();if(1==b.Vw()){b.Vw();b.Vw();var c=new CB.Player;c.V3(b);this.callbackPlayer(c,this.me)}else{b.Vw();if(2==b.Vw()){var d=b.Vw();c=[];for(var g=0;g<d;g++)c.push(b.ReadByte())}this.callbackPortrait(c,this.me)}};d.prototype.handleFeedback=function(b){alert("thanks")};d.prototype.handleChat=function(b){var c=new CB.ChatData;c.fromSocketsMsg(b);c.isToSession()?(b=this.watchSessions.getTitleOfSession(c.getIdSession()),b.length&&(c.strMsg="("+b+"): "+c.strMsg),V15.panelMgr.chatOut(c.toString(),
        "LogKibitzChat")):V15.panelMgr.chatOut(c.toString())};d.prototype.handleReconnectOk=function(b){var c=b.getBuf().readInt();CB.LOG("Reconnect OK, groupId="+c+", N="+b.getVal()+" idRecv="+b.getIdReceiver(),"Bold");this.fireOnConnected()};d.prototype.logIntoChat=function(){};d.prototype.send=function(b){try{0==b.Vj()&&b.Vm(this.getNId()),0==b.getIdReceiver()&&b.setIdReceiver(CB.ConnectId.SERVER),this.conn.sendMessage(b,!0)}catch(e){CB.LOG(e.toString()),this.timerReconnect.isActive()||this.inTorture||
    (this.timerReconnect.runOnce(Math.min(6E4,5E3+1E3*this.Va),function(){this.pingServer(!0)}.bind(this)),this.Va++)}};Ve.initForListeners(d);d.prototype.sendRandomMessage=function(){for(var b=0;10>b;b++)switch(Math.floor(15*Math.random())){case 0:this.pingServer();break;case 1:this.changeGroup(13);break;case 2:this.changeGroup(14);break;case 3:this.requestChannels();break;case 4:this.updatePlayerStatus();break;case 5:this.lists.requestGameList(!0);break;case 7:this.lists.onShowPlayers();this.lists.onHideGames();
        break;case 8:this.lists.onShowGames();this.lists.onHidePlayers();break;case 9:case 10:case 11:case 12:var d=new CB.WebSockMessage(7E3+Math.floor(100*Math.random()));d.address(this.getNId(),CB.ConnectId.SERVER);d.getType()!=CB.SockMsgId.LOGOFF&&d.getType()!=CB.SockMsgId.LOGON&&this.send(d);break;case 13:case 14:d=new CB.WebSockMessage(CB.SockMsgId.USER),d.setUserType(1E3+Math.floor(100*Math.random())),d.address(this.getNId(),CB.ConnectId.SERVER),this.send(d)}};Ve.initForListeners(d);Ve.addEvent(d,
        "Connected");return d}();"use strict";CB.Candidate=function(){var d=function(){};d.prototype.read=function(b){this.strLastName=b.Vq(100);this.strFirstName=b.Vq(100);this.aNation=b.Vw();this.nElo=b.Vw()};return d}();"use strict";
CB.HighPlayerData=function(){var d=function(){};d.prototype.V3=function(b){this.setDeathDate(b.Vs());this.setCurrentTitle(new CB.Title(b.Vu()));this.setNation(b.Vu());this.setBornNation(b.Vu());this.setIsMale(b.V14())};d.prototype.setDeathDate=function(b){this.m_aDeathDate=b};d.prototype.getDeathDate=function(){return this.m_aDeathDate};d.prototype.getCurrentTitle=function(){return this.m_aTitle};d.prototype.setCurrentTitle=function(b){this.m_aTitle=b};d.prototype.getNation=function(){return this.m_aNation};
    d.prototype.setNation=function(b){this.m_aNation=b};d.prototype.getBornNation=function(){return this.m_aBornNation};d.prototype.setBornNation=function(b){this.m_aBornNation=b};d.prototype.getIsMale=function(){return this.m_isMale};d.prototype.setIsMale=function(b){this.m_isMale=b};return d}();"use strict";
CB.LowPlayerData=function(){var d=function(){};d.prototype.read=function(b){this.m_Titles=[];this.m_TitleDate=[];this.m_OtherNations=[];this.m_ChangeDate=[];for(var c=0;5>c;c++){var d=new CB.Title(b.Vu());this.m_Titles.push(d);d=b.Vs();this.m_TitleDate.push(d)}this.m_ChangedBornNation=b.Vs();for(c=0;10>c;c++)d=b.Vu(),this.m_OtherNations.push(d),d=b.Vs(),this.m_ChangeDate.push(d)};d.prototype.getPrevTitle=function(b){return m_Titles[b]};d.prototype.setPrevTitle=function(b,c){m_Titles[b]=c};d.prototype.getPrevTitleDate=
    function(b){return m_TitleDate[b]};d.prototype.setPrevTitleDate=function(b,c){m_TitleDate[b]=c};d.prototype.getChangedBornNation=function(){return m_ChangedBornNation};d.prototype.setChangedBornNation=function(b){m_ChangedBornNation=b};d.prototype.getNextNation=function(b){return m_OtherNations[b]};d.prototype.setNextNation=function(b,c){m_OtherNations[b]=c};d.prototype.getNextChangedDate=function(b){return m_ChangeDate[b]};d.prototype.setNextChangedDate=function(b,c){m_ChangeDate[b]=c};d.prototype.getMaxTitles=
    function(){return 5};d.prototype.getMaxNations=function(){return 10};return d}();"use strict";
CB.NewCBPlayer=function(){var d=function(){this.m_aKey=new CB.PlayerKey};d.prototype.V3=function(b,c){this.m_aKey=new CB.PlayerKey;if(0<(c&CB.Player.prototype.PL.PL_DATA_KEY)&&!this.m_aKey.V3(b))return!1;this.m_HighData=new CB.HighPlayerData;0<(c&CB.Player.prototype.PL.PL_DATA_HIGH)&&this.m_HighData.V3(b);this.m_LowData=new CB.LowPlayerData;0<(c&CB.Player.prototype.PL.PL_DATA_LOW)&&this.m_LowData.read(b);return!0};d.prototype.getLastName=function(){return this.m_aKey.getLastName()};d.prototype.setLastName=
    function(b){this.m_aKey.setLastName(b)};d.prototype.getFirstName=function(){return this.m_aKey.getFirstName()};d.prototype.setFirstName=function(b){this.m_aKey.setFirstName(b)};d.prototype.setKey=function(b){this.m_aKey=b};d.prototype.getKey=function(){return this.m_aKey};d.prototype.getRHighPlayerData=function(){return this.m_HighData};d.prototype.getRLowPlayerData=function(){return this.m_LowData};d.prototype.getMaxTitles=function(){return this.GetRLowPlayerData().getMaxTitles()};d.prototype.getMaxNations=
    function(){return this.GetRLowPlayerData().getMaxNations()};return d}();"use strict";
CB.Player=function(){var d=function(){};d.prototype.PFN={PFN_RAW:0,PFN_ARR:1,PFN_BMP:2};d.prototype.PL={PL_DATA_KEY:1,PL_DATA_HIGH:2,PL_DATA_LOW:4,PL_DATA_ELO:8,PL_DATA_ONE_ELO:16,PL_DATA_PICS:32,PL_DATA_ONE_PIC:64};d.prototype.PL_DATA_ALL=d.prototype.PL.PL_DATA_KEY+d.prototype.PL.PL_DATA_HIGH+d.prototype.PL.PL_DATA_LOW+d.prototype.PL.PL_DATA_ELO+d.prototype.PL.PL_DATA_PICS;d.prototype.V3=function(b){try{b.beginSizedRead(),this.m_nDataMask=b.V10(),this.m_NewCBPlayer=new CB.NewCBPlayer,this.m_NewCBPlayer.V3(b,
    this.m_nDataMask),this.m_EloArray=new CB.EloArray,0<(this.m_nDataMask&this.PL.PL_DATA_ELO)?this.m_EloArray.V3(b):0<(this.m_nDataMask&this.PL.PL_DATA_ONE_ELO)&&this.m_EloArray.readLatestFromDataBuffer(b),this.m_MMNameArray=new CB.MMNameArray,0<(this.m_nDataMask&this.PL.PL_DATA_PICS)?this.m_MMNameArray.V3(b):0<(this.m_nDataMask&this.PL.PL_DATA_ONE_PIC)&&this.m_MMNameArray.V3(b),this.setModifyDate(b.Vs()),b.endSizedRead()}catch(c){return!1}return!0};d.prototype.getRPlayerKey=function(){return this.m_NewCBPlayer.GetKey()};
    d.prototype.getCBId=function(){return this.m_NewCBPlayer.GetKey().GetCBId()};d.prototype.setCBId=function(b){this.m_NewCBPlayer.GetKey().SetCBId(b)};d.prototype.getMediaId=function(){return this.m_nMediaId};d.prototype.setMediaId=function(b){this.m_nMediaId=b};d.prototype.getRKey=function(){return this.m_NewCBPlayer.GetKey()};d.prototype.getRNewCBPlayer=function(){return this.m_NewCBPlayer};d.prototype.getREloArray=function(){return this.m_EloArray};d.prototype.getRMMNameArray=function(){return this.m_MMNameArray};
    d.prototype.hasFotos=function(){return 0<this.m_MMNameArray.Count()};d.prototype.getFirstName=function(){return this.m_NewCBPlayer.getFirstName()};d.prototype.setFirstName=function(b){this.m_NewCBPlayer.setFirstName(b)};d.prototype.setFirstName2=function(b){this.m_NewCBPlayer.setFirstName(b)};d.prototype.getLastName=function(){return this.m_NewCBPlayer.getLastName()};d.prototype.setLastName=function(b){this.m_NewCBPlayer.setLastName(b)};d.prototype.getBirthDate=function(){return this.getRPlayerKey().GetBirthDate()};
    d.prototype.setBirthDate=function(b){this.getRPlayerKey().setBirthDate(b)};d.prototype.getIdenticalCount=function(){return this.getRPlayerKey().getIdenticalCount()};d.prototype.getTitle=function(){return this.m_NewCBPlayer.getRHighPlayerData().getCurrentTitle()};d.prototype.setTitle=function(b){this.m_NewCBPlayer.getRHighPlayerData().setCurrentTitle(b)};d.prototype.getNation=function(){return this.m_NewCBPlayer.getRHighPlayerData().GetNation()};d.prototype.setNation=function(b){this.m_NewCBPlayer.getRHighPlayerData().setNation(b)};
    d.prototype.getBornNation=function(){return this.m_NewCBPlayer.getRHighPlayerData().getBornNation()};d.prototype.getDeathDate=function(){return this.m_NewCBPlayer.getRHighPlayerData().GetDeathDate()};d.prototype.setDeathDate=function(b){this.m_NewCBPlayer.getRHighPlayerData().setDeathDate(b)};d.prototype.getIsMal=function(){return this.m_NewCBPlayer.getRHighPlayerData().getIsMale()};d.prototype.setIsMale=function(b){this.m_NewCBPlayer.getRHighPlayerData().setIsMale(b)};d.prototype.setDataMask=function(b){this.m_nDataMask=
        b};d.prototype.getDataMask=function(){return this.m_nDataMask};d.prototype.getVersion=function(){return this.m_nVersion};d.prototype.setDateCached=function(b){this.m_dCached=b};d.prototype.getDateCached=function(){return this.m_dCached};d.prototype.setModifyDate=function(b){this.m_aModifyDate=b};d.prototype.getModifyDate=function(){return this.m_aModifyDate};return d}();"use strict";
CB.PlayerKey=function(){var d=function(b,c){this.m_nIdenticalCount=0;this.m_nCBId=-1;this.m_sFirstName=b;this.m_sLastName=c};d.prototype.write=function(b){b.Vn(this.m_sLastName);b.Vn(this.m_sFirstName);b.Vg(this.m_aBirthDate);b.Vi(this.m_nIdenticalCount);b.Vh(this.m_nCBId)};d.prototype.V3=function(b){this.m_sLastName=b.Vq(100);this.m_sFirstName=b.Vq(100);this.m_aBirthDate=b.Vs();this.m_nIdenticalCount=b.Vu();this.m_nCBId=b.Vw();return!0};d.prototype.getStr=function(){var b=m_sLastName;return b+=", "+
    m_sFirstName};d.prototype.getCheckSum=function(){for(var b=0,c=0;c<m_sLastName.Length;c++)b+=m_sLastName[c];for(c=0;c<m_sFirstName.Length;c++)b+=m_sFirstName[c];b+=m_aBirthDate.GetYear();return b+=m_nIdenticalCount};d.prototype.getFirstName=function(){return this.m_sFirstName};d.prototype.setFirstName=function(b){this.m_sFirstName=b};d.prototype.getLastName=function(){return this.m_sLastName};d.prototype.setLastName=function(b){this.m_sLastName=b};d.prototype.getBirthDate=function(){return this.m_aBirthDate};
    d.prototype.setBirthDate=function(b){this.m_aBirthDate=b};d.prototype.getIdenticalCount=function(){return this.m_nIdenticalCount};d.prototype.setIdenticalCount=function(b){this.m_nIdenticalCount=b};d.prototype.incIdenticalCount=function(){this.m_nIdenticalCount++};d.prototype.getCBId=function(){return this.m_nCBId};d.prototype.setCBId=function(b){this.m_nCBId=b};d.prototype.m_aBirthDate=new CB.Date;return d}();
CB.PlayerUserMsgId={QUERY_MULTI_NATION_INFO:1300,QUERY_FILL_PLAYERITEM_BY_NAME_AND_THUMB:1301,QUERY_FILL_PLAYERITEM_BY_NAME:1302,QUERY_FILL_MULTIPLAYERITEM_BNAT:1303,QUERY_GET_BATCH_ID:1304,QUERY_CURRENT_PB_VERSION:1305,QUERY_FILL_PLAYER_BY_CBID:1306,QUERY_FILL_CANDIDATES_ARRAY:1307,QUERY_FILL_PICTURE:1308,ANS_MULTI_NATION_INFO:1309,ANS_FILL_PLAYERITEM_BY_NAME_AND_THUMB:1310,ANS_FILL_PLAYERITEM_BY_NAME:1311,ANS_FILL_MULTIPLAYERITEM_BNAT:1312,ANS_GET_BATCH_ID:1313,ANS_CURRENT_PB_VERSION:1314,ANS_FILL_PLAYER_BY_CBID:1315,
    ANS_FILL_CANDIDATES_ARRAY:1316,ANS_FILL_PICTURE:1317,SEND_FEEDBACK:1320,SEND_FEEDBACK_ANS:1321,QUERY_JS_PLAYER_BY_NAME_AND_ELO:1322,ANS_JS_PLAYER_BY_NAME_AND_ELO:1323,QUERY_JS_MULTI_PLAYER_INFO:1324,ANS_JS_PLAYER_MULTI_PLAYER_INFO:1325,QUERY_JS_MULTI_PLAYER_WITH_PIC:1326,ANS_JS_MULTI_PLAYER_WITH_PIC:1327,toString:function(d){for(var b in this)if(this[b]==d)return b;return"Unknown PBUserMsgId: "+d},toNumString:function(d){return"PlUserMsgId="+d}};"use strict";
CB.EloArray=function(){var d=function(){};d.prototype.V3=function(b){b.beginSizedRead();this.clear();var c=b.Vw();if(4096<c)return!1;if(0<c)for(var d=b.V14(),f=0;f<c;f++){var g=new CB.EloNumber(d);g.V3(b);this.vecElo.push(g)}b.endSizedRead();return!0};d.prototype.readLatestFromDataBuffer=function(b){return this.ReadFromDataBuffer(b)};d.prototype.clear=function(){this.vecElo?this.vecElo.clear():this.vecElo=[]};d.prototype.getTrendStr=function(b){for(var c=this.count()-1,d="",f=0;f<b;f++){var g=c-1;
    if(0<=g){for(var h=this.vecElo[c].getDate().month;0<=g&&6>Math.abs(h-this.vecElo[g].getDate().month);)g--;0<=g&&(c=this.vecElo[c].getNElo()-this.vecElo[g].getNElo(),d=10<=Math.abs(c)?0<c?"+"+d:"-"+d:"0"+d);c=g}}return d.length==b?d:""};d.prototype.getNBestElo=function(b){b=this.vecElo[0].getNElo();this.vecElo[0].getDate();for(var c=0;c<this.vecElo.length;c++){var d=this.vecElo[c];d.getNElo()>b&&(b=d.getNElo(),d.getDate())}return b};d.prototype.getNWorstElo=function(b){b=this.vecElo[0].getNElo();this.vecElo[0].getDate();
    for(var c=0;c<this.vecElo.length;c++){var d=this.vecElo[c];d.getNElo()<b&&(b=d.getNElo(),d.getDate())}return b};d.prototype.getApproxElo=function(b,c){for(var d=0,f=0,g=0;g<this.vecElo.length;g++){var h=this.vecElo[g];h.getDate().getYear()>=b&&h.getDate().getYear()<=c&&(d+=h.getNElo(),f++)}return 0<f?d/f:0};d.prototype.getBestMatchEloByDate=function(b){b=0;0<this.vecElo.length&&(b=this.vecElo[this.vecElo.length-1].getNElo());return b};d.prototype.count=function(){return this.vecElo.length};d.prototype.get=
    function(b){return b<this.vecElo.length?this.vecElo[b]:new EloNumber};return d}();"use strict";CB.EloNumber=function(){var d=function(b){this.bOld=b};d.prototype.V3=function(b){b.beginSizedRead();this.nRatingId=b.Vw();this.nElo=b.Vu();this.aDate=b.Vs();this.bFide=b.V14();this.aRating=new CB.ExtRatingType12;this.aRating.V3(b);this.nRank=b.Vw();b.endSizedRead()};d.prototype.getDate=function(){return this.aDate};d.prototype.getNElo=function(){return this.aRating.getRating()};return d}();"use strict";
CB.ExtRatingType12=function(){var d=function(){};d.prototype.V3=function(b){this.nFlags=b.Vu();this.nRating=b.Vu();this.aNation=b.readUint8();this.sProvider=b.Vu();return!0};d.prototype.getRating=function(){return this.nRating};return d}();"use strict";
CB.MMNameArray=function(){var d=function(){};d.prototype.V3=function(b){var c=b.Vu();this.clear();for(var d=0;d<c;d++){var f=new CB.PLMMRecord;f.V3(b);this.append(f)}};d.prototype.getRecord=function(b){return this.vecMM[b]};d.prototype.append=function(b){this.vecMM.push(b)};d.prototype.count=function(){return this.vecMM.Count};d.prototype.clear=function(){this.vecMM?this.vecMM.clear():this.vecMM=[]};return d}();"use strict";
CB.PLMMRecord=function(){var d=function(){};d.prototype.V3=function(b){this.nSerial=b.Vw();this.aDate=b.Vs();this.nMediaType=b.Vu();this.sName=b.V6(100);this.sAuthor=b.V6(100);this.sLocation=b.V6(100);this.isExact=b.V14()};d.prototype.writeToDataBuffer=function(b){b.Vh(this.nSerial);b.Vg(this.aDate);b.Vi(this.nMediaType);b.V5(this.sName);b.V5(this.sAuthor);b.V5(this.sLocation);b.V13(this.isExact)};return d}();"use strict";
CB.Title=function(){var d=function(b){this.eTitleCode=b};d.prototype.Code={CBTC_NONE:0,CBTC_MARKED:1,CBTC_HGM:2,CBTC_WFM:4,CBTC_WIM:8,CBTC_FM:16,CBTC_IM:32,CBTC_WWCH:64,CBTC_WCH:128};d.prototype.Code.CBTC_WGM=d.prototype.Code.CBTC_WIM|d.prototype.Code.CBTC_WFM;d.prototype.Code.CBTC_GM=d.prototype.Code.CBTC_IM|d.prototype.Code.CBTC_FM;d.getStr=function(b){if((b&d.prototype.Code.CBTC_GM)==d.prototype.Code.CBTC_GM)return"GM";if((b&d.prototype.Code.CBTC_WGM)==d.prototype.Code.CBTC_WGM)return"WGM";if(b&
    d.prototype.Code.CBTC_WCH)return"WCH";if(b&d.prototype.Code.CBTC_WWCH)return"WWCH";if(b&d.prototype.Code.CBTC_WIM)return"WIM";if(b&d.prototype.Code.CBTC_WFM)return"WFM";if(b&d.prototype.Code.CBTC_IM)return"IM";if(b&d.prototype.Code.CBTC_FM)return"FM";if(b&d.prototype.Code.CBTC_HGM)return"HGM"};d.prototype.getAllTitles=function(){var b="";0<(this.eTitleCode&d.prototype.Code.CBTC_WCH)&&(b+="WCH, ");0<(this.eTitleCode&d.prototype.Code.CBTC_WWCH)&&(b+="WWCH, ");(this.eTitleCode&d.prototype.Code.CBTC_GM)==
d.prototype.Code.CBTC_GM?b+="GM, ":0<(this.eTitleCode&d.prototype.Code.CBTC_IM)?b+="IM, ":0<(this.eTitleCode&d.prototype.Code.CBTC_FM)&&(b+="FM, ");(this.eTitleCode&d.prototype.Code.CBTC_WGM)==d.prototype.Code.CBTC_WGM?b+="WGM, ":0<(this.eTitleCode&d.prototype.Code.CBTC_WIM)?b+="WIM, ":0<(this.eTitleCode&d.prototype.Code.CBTC_WFM)&&(b+="WFM, ");0<(this.eTitleCode&d.prototype.Code.CBTC_HGM)&&(b+="HGM, ");0<(this.eTitleCode&d.prototype.Code.CBTC_MARKED)&&(b+="VIP, ");return b};return d}();"use strict";
CB.ChessKnowledge=function(){var d=function(){};d.isEndgame=function(b){var c=CB.Attack.sumMaterial(b,CB.Side.WHITE),d=CB.Attack.sumMaterial(b,CB.Side.BLACK);return 12>b.getPieces().length&&2100>c+d};d.getOpposition=function(b,c){var d=CB.Square.getFile(b),f=CB.Square.getFile(c);b=CB.Square.getRank(b);c=CB.Square.getRank(c);if(d==f&&2==Math.abs(b-c)){var g=[];b>c?(0<=d-1&&8>c+1&&g.push(8*(d-1)+c+1),8>c+1&&g.push(8*(d+0)+c+1),8>d+1&&8>c+1&&g.push(8*(d+1)+c+1)):(0<=d-1&&8>b+1&&g.push(8*(d-1)+b+1),8>
b+1&&g.push(8*(d+0)+b+1),8>d+1&&8>b+1&&g.push(8*(d+1)+b+1));return g}if(b==c&&2==Math.abs(d-f))return g=[],d>f?(8>f+1&&0<=c-1&&g.push(8*(f+1)+c-1),8>f+1&&g.push(8*(f+1)+c+0),8>f+1&&8>c+1&&g.push(8*(f+1)+c+1)):(8>d+1&&0<=c-1&&g.push(8*(d+1)+c-1),8>d+1&&g.push(8*(d+1)+c+0),8>d+1&&8>c+1&&g.push(8*(d+1)+c+1)),g};return d}();"use strict";
CB.CPUInfo=function(){var d=function(){this.m_nLogicalCores=this.m_nPhysicalCores=this.m_nPhysicalProcs=this.m_nNumaNode=0};d.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();b.Vh(this.m_nNumaNodes);b.Vh(this.m_nPhysicalProcs);b.Vh(this.m_nPhysicalCores);b.Vh(this.m_nLogicalCores);b.endSizedWrite();return!0};return d}();
CB.PosTree=function(){var d=function(){};d.prototype.numBits=[1,6,6,5,5,5,3,1,1,6,6,5,5,5,3,1];d.prototype.theBits=[0,32,34,18,20,22,6,0,0,33,35,19,21,23,7,0];d.prototype.isUniqe=[0,255,255,255,255,255,6,14,255,255,255,255,255,255,255,255,255,255,3,11,4,12,5,13,255,255,255,255,255,255,255,255,1,9,2,10,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];d.prototype.HUFF_960=128;d.prototype.HUFF_CASTLE=64;d.prototype.HUFF_EP=32;d.prototype.posToHuff3=
    function(b,c,d){var e,g=0;c[g]=0;g++;c[g]=0;b.getBTM()&&(c[g]=128);var h=0;var k=1;for(e=2;64>h;h++){var l=b.board[h]&15;k+=this.numBits[l];if(8<k){c[g]|=this.theBits[l]>>k-8;if(++e>d)return 1;g++;c[g]=0;k-=8}c[g]|=this.theBits[l]<<8-k;if(8<=k){k=0;if(++e>d)return 1;g++;c[g]=0}}l=h=0;0<b.getCastleRights()&&(l|=this.HUFF_CASTLE,h+=4);0<b.getCPPEPFile()&&(l|=this.HUFF_EP,h+=3);if(0<h){if(8<k+h){if(++e>d)return 1;g++;c[g]=0}0<b.getCastleRights()?(c[g]|=b.getCastleRights()&15,0<b.getCPPEPFile()&&(c[g]|=
        (b.getCPPEPFile()-1&7)<<4)):0<b.getCPPEPFile()&&(c[g]|=b.getCPPEPFile()-1&7)}else 0==k&&--e;c[0]=e|l;for(b=0;b<=g;b++)c[b]&=255;return 0};d.prototype.huff3ToPos=function(b,c,d){var e,g=0,h;b.ep=CB.Position.NOEP;for(e=0;64>e;e++)b.board[e]=0;e=c[g]&(this.HUFF_960|this.HUFF_CASTLE|this.HUFF_EP);var k=c[g]&31;if(8<k&&k<d){0<(e&this.HUFF_CASTLE)?(b.setCastleRights(c[k-1]&15),b.ep=0<(e&this.HUFF_EP)?c[k-1]>>4&7:CB.Position.NOEP):(b.setCastleRights(CB.CastleRights.NONE),b.ep=0<(e&this.HUFF_EP)?c[k-1]&7:
    CB.Position.NOEP);g++;0<(c[g]&128)?b.setBTM(!0):b.setBTM(!1);e=0;d=1;for(h=64;64>e&&d<k;e++){var l=0,m=0;do l<<=1,0<(c[g]&h)&&(l|=1),m++,h>>=1,0==h&&(h=128,g++,d++);while(255==this.isUniqe[l]&&6>m);if(255==this.isUniqe[l])break;b.board[e]=this.isUniqe[l]}if(64>e)return b.initStartPos(),1}else return b.initStartPos(),1;return 0};return d}();"use strict";
CB.HashPosition=function(){var d=function(b){this.m_cPos=[];for(var c=0;24>c;c++)this.m_cPos.push(0);b&&(new CB.PosTree).posToHuff3(b,this.m_cPos,this.m_cPos.length)};d.prototype.Len=function(){return this.m_cPos[0]&31};d.prototype.IsSet=function(){return 0!=this.m_cPos[0]};d.prototype.Clear=function(){for(var b=0;b<m_cPos.Length;b++)this.m_cPos[b]=0};d.prototype.GetBTM=function(){return 0!=(this.m_cPos[1]&128)};d.prototype.HashPosition=function(b,c){};d.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();
    b.writeByteArray(this.m_cPos,this.m_cPos.length);b.endSizedWrite();return!0};d.prototype.V3=function(b){b.beginSizedRead();for(var c=0;c<this.m_cPos.length;c++)this.m_cPos[c]=b.readByte();b.endSizedRead();return!1};d.prototype.getPosition=function(){var b=new CB.PosTree,c=new CB.Position;b.huff3ToPos(c,this.m_cPos,this.m_cPos.length);return c};d.prototype.FillPos=function(b){};d.prototype.SetPos=function(b){};d.prototype.Normalize=function(b){};d.prototype.UnNormalize=function(b){};d.prototype.IsStartPosition=
    function(){return!1};d.prototype.IsFinalPosition=function(){return!1};d.prototype.GetStartPos=function(){return m_sStartPosition};return d}();"use strict";
CB.HashTableData=function(){var d=function(){this.m_nIdDiscoverer=0;this.pos=new CB.HashPosition;this.move=[]};d.emptyFactory=function(){for(var b=new CB.HashTableData,c=0;c<CB.TBRAIN.HASH_LINE_CNT;c++)b.move.push(new CB.HashMoveData);return b};d.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();pos.writeToDataBuffer(b);b.writeUShort(CB.TBRAIN.HASH_LINE_CNT);for(var c=0;c<CB.TBRAIN.HASH_LINE_CNT;++c)m_aMove[c].writeToDataBuffer(b);b.Vt(m_nPopularity);b.writeUnsigned(m_nIdDiscoverer);b.writeInt(m_nFlags);
    b.writeUnsigned(TBrainConstants.CALCTIME_REASONABLE_THRESH);b.writeUnsigned(TBrainConstants.CALCTIME_DISCOVERY);b.writeUnsigned(TBrainConstants.CALCTIME_DONATION);b.writeUnsigned(TBrainConstants.CALCTIME_DEEP);b.writeUnsigned(m_nGames);b.wndSizedWrite();return!0};d.prototype.V3=function(b){b.beginSizedRead();this.pos.V3(b);for(var c=b.Vu(),d=0;d<CB.TBrainMove.prototype.HASH_LINE_CNT&&d<c;++d)null==this.move[d]&&(this.move[d]=new CB.HashMoveData),this.move[d].V3(b);this.m_nPopularity=b.readUint64();
    this.m_nIdDiscoverer=b.Vw();this.m_nFlags=b.Vw();this.m_nReasonableThresh=b.Vw();this.m_nDiscoveryThresh=b.Vw();this.m_nDonationThresh=b.Vw();this.m_nDeepAnalysisThresh=b.Vw();0==this.m_nDeepAnalysisThresh&&(this.m_nDeepAnalysisThresh=TBrainMove.prototype.CALCTIME_DEEP);this.m_nGames=b.Vu();b.endSizedRead();return!0};d.prototype.clear=function(){for(var b=0;b<TBRAIN.HASH_LINE_CNT;++b)m_aMove[b].clear();pos.Clear();m_nGames=m_nPopularity=m_nFlags=m_nIdDiscoverer=0};d.generateLine=function(b,c,d,f){f=
    f||3;var e="",h=[];if(c&&c.m_aLine){h=this.convertToCBMoveLine(ObjUtil.clone(b),c.m_aLine);b=new CB.NotationGenerator(CB.V1);c=d.game.getStartPos().getBTM();for(var k=0;k<h.length&&k<f;k++)if(h[k].from!=h[k].to){var l=b.getMoveNota(h[k]),m=b.getStrMoveNumInLine(k,d.getCurPos().getPlyNum(),c);e+=m+l;k<h.length-1&&(e+=" ")}}return{line:h,lineNota:e}};d.convertToCBMoveLine=function(b,c){for(var d=[],f=0;f<c.length;f++){var g=new CB.Move(c[f]&63,c[f]>>6&63,c[f]>>12&7);b.isLegalMove(g)&&(b.preCalcCtx(g),
    b.makeMove(g),b.postCalcCtx(g,!0),d.push(g))}return d};d.prototype.Dump=function(){};d.prototype.Count=function(){return TBRAIN.HASH_LINE_CNT};d.prototype.Empty=function(){return m_aMove[0].Empty()};d.prototype.FillPos=function(b){pos.FillPos(b)};d.prototype.GetHashPosition=function(){return pos};d.prototype.GetMove=function(b){CBDebug.assert(b<TBRAIN.HASH_LINE_CNT);return b<TBRAIN.HASH_LINE_CNT?m_aMove[b]:m_aMove[0]};d.prototype.SetMove=function(b,c){CBDebug.assert(c<TBRAIN.HASH_LINE_CNT);c<TBRAIN.HASH_LINE_CNT&&
(m_aMove[c]=b)};d.prototype.GetNPopularity=function(){return m_nPopularity};d.prototype.SetNPopularity=function(b){m_nPopularity=b};d.prototype.GetNGames=function(){return m_nGames};d.prototype.GetNIdDiscoverer=function(){return m_nIdDiscoverer};d.prototype.SetNIdDiscoverer=function(b){m_nIdDiscoverer=b};d.prototype.IsDiscovered=function(){return ISFLAG(1)};d.prototype.SetIsDiscovered=function(b){SETFLAG(1,b)};d.prototype.GetNReasonableThresh=function(){return m_nReasonableThresh};d.prototype.GetNDiscoveryThresh=
    function(){return m_nDiscoveryThresh};d.prototype.GetNDonationThresh=function(){return m_nDonationThresh};d.prototype.GetNDeepAnalysisThresh=function(){return m_nDeepAnalysisThresh};return d}();"use strict";
CB.MachineInfo=function(){var d=function(){this.m_aCPUInfo=new CB.CPUInfo;this.m_nFlags=this.m_nSpeed=0};d.prototype.read=function(b){};d.prototype.GetCPUInfo=function(){return this.m_aCPUInfo};d.prototype.IsValid=function(){return 0<this.m_nSpeed};d.prototype.GetNSpeed=function(){return m_nSpeed};d.prototype.SetNSpeed=function(b){m_nSpeed=b};d.prototype.HasHyperThreading=function(){return ISFLAG(1)};d.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();this.m_aCPUInfo.writeToDataBuffer(b);
    b.Vh(this.m_nSpeed);b.Vh(this.m_nFlags);b.endSizedWrite();return!0};d.prototype.ReadFromDataBuffer=function(b){return!0};d.prototype.CreateMachineGuid=function(){var b=new CBGuid;b.CreateFromHardware();return b};return d}();"use strict";
CB.ClientMachineInfo=function(){var d=function(){};CB.inherit(d,CB.MachineInfo);d.prototype.read=function(b){this.strLastName=b.Vq(100);this.strFirstName=b.Vq(100);this.aNation=b.Vw();this.nElo=b.Vw()};d.prototype.Init=function(){m_nSpeed=s_nSpeed;s_bInited=!0};d.prototype.GetNSpeed=function(){s_bInited&&0!=s_nSpeed||(Init(),0==s_nSpeed&&(s_nSpeed=1E5));return s_nSpeed};return d}();"use strict";
CB.GamePerformanceStats=function(){var d=function(){};d.prototype.initEmpty=function(){this.strFirstName=this.strLastName="";this.m_nResultSum=this.m_nResultCount=this.m_nEloSum=this.m_nEloCount=this.nElo=this.aNation=0};d.prototype.read=function(b){this.strLastName=b.Vq(100);this.strFirstName=b.Vq(100);this.aNation=b.Vw();this.nElo=b.Vw()};d.prototype.plus=function(b,c){b=new d(b);b.m_nEloCount+=c.m_nEloCount;var e=b.m_nEloSum+c.m_nEloSum;e>uint.MaxValue-1E4?(b.m_nEloSum=uint(e/2),b.m_nEloCount/=
    2):b.m_nEloSum=e;e=b.m_nResultSum+c.m_nResultSum;c=b.m_nResultCount+c.m_nResultCount;e>uint.MaxValue-1E4||c>uint.MaxValue-1E4?(b.m_nResultSum=e/2,b.m_nResultCount=c/2):(b.m_nResultSum=e,b.m_nResultCount=c);return b};d.prototype.writeToDataBuffer=function(b){b.WriteUnsigned(m_nEloSum);b.WriteUnsigned(m_nEloCount);b.WriteUnsigned(m_nResultSum);b.WriteUnsigned(m_nResultCount)};d.prototype.V3=function(b){this.m_nEloSum=b.Vw();this.m_nEloCount=b.Vw();this.m_nResultSum=b.Vw();this.m_nResultCount=b.Vw();
    return!0};d.prototype.getSortResult=function(){return 0!=m_nResultCount?500*m_nResultSum/m_nResultCount:0};d.prototype.getSortEloAv=function(){return 0!=this.m_nEloCount?this.m_nEloSum/this.m_nEloCount:0};d.prototype.getFPercent=function(b){return 0!=this.m_nResultCount?b?100-50*this.m_nResultSum/this.m_nResultCount:50*this.m_nResultSum/this.m_nResultCount:0};d.prototype.getNGames=function(){return Math.max(this.m_nEloCount,this.m_nResultCount)};return d}();"use strict";
CB.HashMoveData=function(){var d=function(){this.m_aLine=[0]};d.prototype.read=function(b){};d.prototype.WriteToDataBuffer=function(b){return!0};d.prototype.V3=function(b){b.beginSizedRead();this.m_nConfidence=b.Vw();this.m_nEval=b.V11();this.m_nDepth=b.readByte();this.m_nFlags=b.readByte();for(var c=b.Vu(),d=0;d<CB.TBrainMove.prototype.HASH_LINE_LEN&&d<c;++d)this.m_aLine[d]=b.Vu();this.m_nEngineId=b.Vw();this.m_nUserId=b.Vw();this.m_nTimeStamp=b.Vu();this.m_nCalcDepth=b.Vu();this.m_bReasonableDepth=
    b.V14();this.m_nRankingListWeight=b.Vw();b.endSizedRead();return!0};d.prototype.Empty=function(){return!0};d.prototype.MovesEqualTo=function(b){return!1};d.prototype.ToString=function(){for(var b=0;b<HASH_LINE_LEN;++b);return"??"};d.prototype.SetTimeStamp=function(b){m_nTimeStamp=TBrainTimeStamp.DateToUShort(b)};d.prototype.GetTimeStamp=function(){return TBrainTimeStamp.UShortToDate(m_nTimeStamp)};d.prototype.Test=function(b,c){return!1};d.prototype.fillVariation=function(b,c){return!1};d.prototype.FillEvaluation=
    function(b,c){return!0};d.prototype.SetMove=function(b,c){return!1};d.prototype.FillMove=function(b,c){return!1};d.prototype.IsMate=function(){return 29E3<Math.Abs(m_nEval)};d.prototype.GetNCalcDepthPercent=function(b){return 0!=GetNCalcDepth()?100*b/GetNCalcDepth()+.5:0};d.prototype.Count=function(){return TBRAIN.HASH_LINE_LEN};d.prototype.Clear=function(){};d.prototype.GetNEval=function(){return 0};d.prototype.setNEval=function(b){m_nEval=b;SETFLAG(TBRAIN.EVAL_MOVE_NO,!1)};d.prototype.GetNMoveNo=
    function(){return 0};d.prototype.SetNMoveNo=function(b){m_nEval=b;SETFLAG(TBRAIN.EVAL_MOVE_NO,!0)};d.prototype.GetNDepth=function(){return m_nDepth};d.prototype.SetNDepth=function(b){m_nDepth=b};d.prototype.GetNConfidence=function(){return m_nConfidence};d.prototype.SetNConfidence=function(b){m_nConfidence=b};d.prototype.GetMove=function(b){return 0};d.prototype.SetMove=function(b,c){};d.prototype.IsEval=function(){return!ISFLAG(TBRAIN.EVAL_MOVE_NO)};d.prototype.IsMoveNo=function(){return ISFLAG(TBRAIN.EVAL_MOVE_NO)};
    d.prototype.etNEngineId=function(){return m_nEngineId};d.prototype.SetNEngineId=function(b){m_nEngineId=b};d.prototype.GetNUserId=function(){return m_nUserId};d.prototype.SetNUserId=function(b){m_nUserId=b};d.prototype.UserIsLogin=function(){return ISFLAG(TBRAIN.USER_IS_LOGIN)};d.prototype.SetUserIsLogin=function(b){SETFLAG(TBRAIN.USER_IS_LOGIN,b)};d.prototype.SetNTimeStamp=function(b){m_nTimeStamp=b};d.prototype.GetNCalcDepth=function(){return m_nCalcDepth};d.prototype.IsReasonableDepth=function(){return m_bReasonableDepth};
    d.prototype.SetIsReasonableDepth=function(b){m_bReasonableDepth=b};d.prototype.IsDisco=function(){return m_nCalcDepth>=TBrainConstants.CALCTIME_DISCOVERY};d.prototype.IsDeep=function(){return m_nCalcDepth>=TBrainConstants.CALCTIME_DEEP};d.prototype.GetRankingListWeight=function(){return m_nRankingListWeight};d.prototype.SetRankingListWeight=function(b){m_nRankingListWeight=b};return d}();"use strict";
CB.HashTableRequest=function(){var d=function(){this.m_aMachineGuid=new CBGuid;this.m_nCpus=this.m_nSecs=this.m_nFlags=0;this.m_nVariations=1;this.m_nNodes=this.m_nMoveNo=this.m_nHashSize=0;this.m_fMachineFact=this.m_fEngineFact=1};d.prototype.GetFormFactor=function(){return 0};d.prototype.GetFCalcDepth=function(b){return 0};d.prototype.GetNCalcTime=function(){return TBServerBinder(GetFCalcDepth(uint(m_nSecs+1))*m_fEngineFact*m_fMachineFact)};d.prototype.GetNTodaysTimeStamp=function(){return TBrainTimeStamp.GetNTodaysTimeStamp()};
    d.prototype.WriteToDataBuffer=function(b){b.BeginSizedWrite();m_aMachine.WriteToDataBuffer(b);b.WriteString(m_strEngine);b.WriteUnsigned(m_nFlags);pos.WriteToDataBuffer(b);m_aMove.WriteToDataBuffer(b);b.WriteUnsigned(m_nSecs);b.WriteUnsigned(m_nCpus);b.WriteUnsigned(m_nVariations);m_aMachineGuid.WriteToDataBuffer(b);b.WriteUnsigned(m_nHashSize);b.WriteData(m_cCheckSum,m_cCheckSum.Length);b.WriteInt(m_nMoveNo);b.WriteInt64(m_nNodes);b.EndSizedWrite();return!0};d.prototype.V3=function(b){b.BeginSizedRead();
        m_aMachine.ReadFromDataBuffer(b);m_strEngine=b.ReadString();m_nFlags=b.ReadUnsigned();pos.ReadFromDataBuffer(b);m_aMove.ReadFromDataBuffer(b);m_nSecs=b.ReadUnsigned();m_nCpus=b.ReadUnsigned();16<m_nCpus&&(m_nCpus=16);m_nVariations=Math.Min(64,Math.Max(1,b.ReadUnsigned()));1>m_nVariations&&(m_nVariations=1);m_aMachineGuid.ReadFromDataBuffer(b);m_nHashSize=b.ReadUnsigned();m_nMoveNo=b.ReadInt();m_nNodes=b.ReadInt64();b.EndSizedRead();return!0};d.prototype.CreateGame=function(){return new CBGame};d.prototype.GetMachine=
        function(){return m_aMachine};d.prototype.SetMachine=function(b){m_aMachine=b};d.prototype.GetStrEngine=function(){return m_strEngine};d.prototype.SetStrEngine=function(b){m_strEngine=b};d.prototype.GetMachineGuid=function(){return m_aMachineGuid};d.prototype.SetMachineGuid=function(b){m_aMachineGuid=b};d.prototype.SetNSecs=function(b){m_nSecs=b};d.prototype.GetNSecs=function(){return m_nSecs};d.prototype.GetPosition=function(){return pos};d.prototype.GetTaggedHashPos=function(){return new TaggedHashPos(pos,
        GetNMoveNo())};d.prototype.FillPosition=function(b){pos.FillPos(b);b.SetMoveNo(GetNMoveNo())};d.prototype.SetPosition=function(b){pos=new HashPosition(b);m_nMoveNo=b.GetMoveNo()};d.prototype.GetMove=function(b){return TBServerBinderm_aMove.GetMove(b)};d.prototype.GetNEval=function(){return m_aMove.GetNEval()};d.prototype.GetNMoveNo=function(){return m_nMoveNo};d.prototype.SetNMoveNo=function(b){m_nMoveNo=b};d.prototype.GetNDepth=function(){return m_aMove.GetNDepth()};d.prototype.IsEval=function(){return m_aMove.IsEval()};
    d.prototype.IsMoveNo=function(){return m_aMove.IsMoveNo()};d.prototype.GetNCpus=function(){return m_nCpus};d.prototype.SetNCpus=function(b){m_nCpus=TBServerBinderr};d.prototype.GetNVariation=function(){return m_nVariations};d.prototype.SetNVariations=function(b){m_nVariations=TBServerBinderr};d.prototype.SetEngineFact=function(b){m_fEngineFact=b};d.prototype.SetMachineFact=function(b){m_fMachineFact=b};d.prototype.SetSilent=function(b){SETFLAG(1,b)};d.prototype.IsSilent=function(){return ISFLAG(1)};
    d.prototype.SetFirstRequest=function(b){SETFLAG(2,b)};d.prototype.IsFirstRequest=function(){return ISFLAG(2)};d.prototype.SetUCI=function(b){SETFLAG(65536,b)};d.prototype.IsUCI=function(){return ISFLAG(TBServerBinderHTR.HTR_UCI_ENGINE)};d.prototype.SetUnreliableData=function(b){SETFLAG(256,b)};d.prototype.IsUnreliableData=function(){return ISFLAG(TBServerBinderHTR.HTR_UNRELIABLE_DATA)};d.prototype.IsEvalNormed=function(){return ISFLAG(TBServerBinderHTR.HTR_EVAL_NORMED)};d.prototype.SetIsEvalNormed=
        function(b){SETFLAG(TBServerBinderHTR.HTR_EVAL_NORMED,b)};d.prototype.GetCheckSum=function(b){};return d}();"use strict";CB.RequestBoard=function(){return function(d,b){this.aBoard=d;this.sMove=b}}();"use strict";
CB.TaggedHashPos=function(){var d=function(b,c,d){this.pos=new CB.HashPosition(b);this.m_nMoveNo=c;this.m_nTicket=this.m_nConnectIdSolver=this.m_nConnectIdSubmissor=0;this.m_strTag=d};d.prototype.IsSet=function(){return pos.IsSet()};d.prototype.IsStartPosition=function(){return pos.IsStartPosition()};d.prototype.IsFinalPosition=function(){return pos.IsFinalPosition()};d.prototype.GetStrTag=function(){return m_strTag};d.prototype.SetStrTag=function(b){m_strTag=b};d.prototype.WriteToDataBuffer=function(b){pos.WriteToDataBuffer(b);
    b.BeginSizedWrite();b.WriteInt(m_nMoveNo);b.WriteString(m_strTag);b.EndSizedWrite()};d.prototype.ReadFromDataBuffer=function(b){if(!pos.ReadFromDataBuffer(b))return!1;b.BeginSizedRead();m_nMoveNo=b.ReadInt();m_strTag=b.ReadString();var c=0<=m_nMoveNo;b.EndSizedRead();return c};d.prototype.CreatePosition=function(){var b=pos.CreatePosition();b.SetMoveNo(m_nMoveNo);return b};return d}();"use strict";
CB.TBRAIN={HASH_LINE_LEN:3,HASH_LINE_CNT:3,MAX_STR:63,EVAL_MOVE_NO:1,USER_IS_LOGIN:2,USER_MAY_DISCOVER:4,USER_TRUSTWORTHY:8,EVAL_NORMED:16};
CB.TBrainMove=function(){var d=function(){this.move=new CB.Move;this.m_performanceStats=new CB.GamePerformanceStats;this.m_nFlags=0};d.prototype.HASH_LINE_LEN=3;d.prototype.HASH_LINE_CNT=3;d.prototype.CALCTIME_DEEP=370;d.prototype.getMoveRecord=function(){return this.move};d.prototype.getLine=function(b){CBDebug.assert(b<CB.TBRAIN.HASH_LINE_LEN);return b<CB.TBRAIN.HASH_LINE_LEN?m_aLine[b]:0};d.prototype.getLine=function(b,c){CBDebug.assert(c<CB.TBRAIN.HASH_LINE_LEN);m_aLine[c]=b};d.prototype.getNEval=
    function(){return this.m_nEval};d.prototype.getNTimeStamp=function(){return this.m_nTimeStamp};d.prototype.setNTimeStamp=function(b){m_nTimeStamp=b};d.prototype.hasEval=function(){return CB.isFlag(this.m_nFlags,1)||0!=this.m_nEval};d.prototype.setHasEval=function(b){this.m_nFlags=b?this.m_nFlags|1:this.m_nFlags&-2};d.prototype.hasComment=function(){};d.prototype.setHasComment=function(b){};d.prototype.getPerformanceStats=function(){return m_performanceStats};d.prototype.getNGames=function(){return this.m_performanceStats.getNGames()};
    d.prototype.getEloAv=function(){return this.m_performanceStats.getSortEloAv()};d.prototype.initNaked=function(b){this.move=b;this.m_nFlags=this.m_nTimeStamp=this.m_nEval=0;this.m_aLine=[];this.m_performanceStats.initEmpty()};d.prototype.writeToDataBuffer=function(b){b.BeginSizedWrite();b.WriteInt64(m_nVisits);b.WriteBYTE(this.move.frSq);b.WriteBYTE(this.move.toSq);b.WriteBYTE(this.move.nType);b.WriteBYTE(this.move.nProm);b.WriteShort(this.m_nEval);b.WriteUShort(this.m_nTimeStamp);b.WriteShort(this.m_nFlags);
        this.m_performanceStats.WriteToDataBuffer(b);b.EndSizedWrite()};d.prototype.V3=function(b){b.beginSizedRead();this.m_nVisits=b.Vy();this.move.from=b.readUint8();this.move.to=b.readUint8();this.move.nType=b.readUint8();this.move.prom=b.readUint8();this.m_nEval=b.V11();this.m_nTimeStamp=b.Vu();this.m_nFlags=b.V11();this.m_performanceStats.V3(b);this.m_aLine=[];for(var c=0;c<CB.TBrainMove.prototype.HASH_LINE_LEN;++c){var d=b.Vu();this.m_aLine.push(d)}b.endSizedRead();return!0};d.prototype.getTimeStamp=
        function(){return TBrainTimeStamp.UShortToDate(m_nTimeStamp)};d.prototype.getNVisits=function(){return this.m_nVisits};d.getTimeStampToday=function(){var b=new CB.Date;b.setToday();b.setYear(b.getYear()-1945);return b.getNum()};d.prototype.toString=function(){return this.move.toString()+", N="+this.getNGames()+",ev="+this.m_nEval};return d}();"use strict";
CB.TBrainMoveList=function(){var d=function(){this.moves=[]};d.prototype.writeToDataBuffer=function(b){b.BeginSizedWrite();b.WriteInt(GetNFormat());b.WriteUnsigned(Count);for(var c=0;c<Count;c++)this[c].WriteToDataBuffer(b);b.EndSizedWrite()};d.prototype.V3=function(b){b.beginSizedRead();b.readInt();this.clear();for(var c=b.readInt(),d=0;d<c;d++){var f=new CB.TBrainMove;f.V3(b);this.add(f)}b.endSizedRead();return!0};d.prototype.clear=function(){this.moves=[]};d.prototype.count=function(){return this.moves.length};
    d.prototype.add=function(b){this.moves.push(b)};d.prototype.get=function(b){return this.moves[b]};d.prototype.getNFormat=function(){return 2};d.prototype.getMaxGames=function(){for(var b=0,c=0;c<this.moves.length;c++)this.moves[c].getNGames()>b&&(b=this.moves[c].getNGames());return b};d.sortEval=function(b,c){b.sort(function(b,d){return c?b.m_nEval-d.m_nEval:d.m_nEval-b.m_nEval})};d.prototype.getHintedBestMove=function(b){if(0==this.moves.length)return b;for(var c=this.moves[0].m_nEval,d=0;d<this.moves.length;d++)if(50>
        Math.abs(this.moves[d].m_nEval-c)){if(this.moves[d].move.equals(b))return b}else break;CB.LOG("EngineHintMove not Best: "+b,"LogError");return this.moves[0].move};return d}();"use strict";
CB.TeraBrainChessUser=function(){var d=function(){};d.prototype.GetStrName=function(){return m_strName};d.prototype.GetRank=function(){return m_aRank};d.prototype.SetRank=function(b){m_aRank=b};d.prototype.GetNAccountAgeDays=function(){return m_nAccountAgeDays};d.prototype.SetNAccountAgeDays=function(b){m_nAccountAgeDays=b};d.prototype.HasSerial=function(){return ISFLAG(1)};d.prototype.HasPremium=function(){return ISFLAG(2)};d.prototype.IsSilenced=function(){return ISFLAG(4)};d.prototype.GetGeoCoordinates=
    function(){return m_aGeoCoords};d.prototype.GetNLocalFlags=function(){return m_nFlags};d.prototype.GetNUFDFlags=function(){return m_nUFDFlags};return d}();"use strict";
CB.TeraBrainInfo=function(){var d=function(){this.pos=new CB.HashPosition;this.moveList=new CB.TBrainMoveList};d.prototype.read=function(){};d.prototype.fromMessage=function(b){b=b.GetPDataBuf();b.Rewind();ReadFromDataBuffer(b)};d.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();pos.writeToDataBuffer(b);b.Vt(m_nVisits);moveList.writeToDataBuffer(b);b.wndSizedWrite()};d.prototype.V3=function(b){b.beginSizedRead();this.pos.V3(b);this.m_nVisits=b.Vy();this.moveList.V3(b);b.endSizedRead();
    return!0};d.prototype.toString=function(){return""};d.prototype.getSocketsMessage=function(){var b=new TeraBrainMessage(SocketsMessageType.TERABRAIN_BOOKINFO);WriteToDataBuffer(b.GetPDataBuf());return b};d.prototype.getNVisits=function(){return m_nVisits};d.prototype.getMoveList=function(){return this.moveList};d.prototype.setMoveList=function(b){moveList=b};d.prototype.getHashPosition=function(){return pos};return d}();"use strict";CB.namespace("CB.Server.TeraBrainLobby");
CB.Server.TeraBrainLobby=function(){var d=function(){this.m_nUsageCnt=this.idGroup=0;this.m_bLoggedIn=!1;this.m_nUserReliability=0;this.m_bLaunchRankingDia=this.m_bAdmin=!1;this.m_nAnalysisTicket=0;this.m_bIsInAnalysis=this.m_bLaunchAnalysisByEngineNames=this.m_bSuppressRequests=!1;this.m_nAnalysisMoveLimit=1;this.m_bInEngineDonation=!1;this.m_nEngineId=this.m_nDonationPositions=0;this.associativeArray=[];this.tableDataHandlers={};this.timerClear=new CB.Timer(function(){this.setEmptyTable()}.bind(this),
    2E3);this.name="TBrain";this.tracker=new CB.PositionTracker};CB.inherit(d,CB.Server.Connector);d.prototype.execCommand=function(b){if(!this.hasIdReceived)return!1;switch(b){case CB.LobbyIds.PING_SERVER:this.pingServer(!0)}};d.prototype.notifyUserActivity=function(){};d.prototype.modifyLoginData=function(b){b.documentUrl=document.URL;V15.isAnyPlugin||(b.documentUrl+=" (off)")};d.prototype.onIdReceived=function(b){this.fnOnIdReceived&&this.fnOnIdReceived()};d.prototype.request=function(b,c,d,f,g,h,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             k){this.m_bSuppressRequests||(this.s_aMachineInfo=new CB.ClientMachineInfo,c=new CB.TeraBrainRequest(c,d,this.s_aMachineInfo),c.setIsNormedEval(!0),c.setCountVisit(!f),c.setConfirmRequested(g),c.setIsHumanServerGame(h),c.setIsMultiRequest(k),f=c.getSocketsMessage(),f.setVal(b),this.send(f))};d.prototype.requestPosInfo=function(b){this.hasIdReceived&&(this.request(1,b,3,!0,!1,!0),this.timerClear.runOnce(2E3))};d.prototype.requestWithTicket=function(b,c,d){this.hasIdReceived&&(this.tableDataHandlers[b]=
    d,this.request(b,c,3,!0,!1,!0))};d.prototype.requestAllMoves=function(b,c,d,f,g){if(this.hasIdReceived){var e=this.tracker.track(b);this.request(f||1,b,2,e,d,c,g)}};d.requestHotPosition=function(){var b=new CB.TeraBrainMessage(SocketsMessageType.TERABRAIN_USER);b.setUserType(TeraBrainUserMsgType.TBUSER_REQ_HOTPOSITION);this.send(b)};d.prototype.requestEngineNames=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.TERABRAIN_USER);c.setUserType(CB.TeraBrainUserMsgType.TBUSER_REQ_ENGINENAMES);c.buf.Vh(b.length);
    for(var d=0;d<b.length;d++)c.buf.Vh(b[d]);this.send(c)};d.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b))switch(b.getType()){default:TRACE("Unhandled: "+b.toString());break;case CB.SockMsgId.DEFAULTGROUPS:this.onConnectedToBoundServer();break;case CB.SockMsgId.CHAT:break;case CB.SockMsgId.TERABRAIN_BOOKINFO:this.handleInfoMsg(b);break;case CB.SockMsgId.TERABRAIN_TABLEDATA:this.handleTableData(b);break;case CB.SockMsgId.TERABRAIN_USER:this.handleUserMsg(b)}};d.prototype.handleUserMsg=
    function(b){switch(b.getUserType()){default:CB.LOG("UserMsg="+CB.TeraBrainUserMsgType.toString(b.getUserType()));break;case CB.TeraBrainUserMsgType.TBUSER_ENGINENAMES:this.handleEngineNames(b);break;case CB.TeraBrainUserMsgType.TBUSER_USERENTRIES:break;case CB.TeraBrainUserMsgType.TBUSER_HOTPOSITION:break;case CB.TeraBrainUserMsgType.TBUSER_CONFIRM_REQUEST:this.handleConfirmRequest(b);case CB.TeraBrainUserMsgType.TBUSER_CONFIRMCOMMENT_REQUEST:case CB.TeraBrainUserMsgType.TBUSER_COMMENTS:case CB.TeraBrainUserMsgType.TBUSER_ADD_COMMENT:case CB.TeraBrainUserMsgType.TBUSER_REFRESH_COMMENT:case CB.TeraBrainUserMsgType.TBUSER_CONFIRM_LOGIN:case CB.TeraBrainUserMsgType.TBUSER_RANKINGLIST:case CB.TeraBrainUserMsgType.TBUSER_DEEP_VAR:case CB.TeraBrainUserMsgType.TBUSER_SLAVE_ANALYSIS:case CB.TeraBrainUserMsgType.TBUSER_RETRACT:case CB.TeraBrainUserMsgType.TBUSER_SUBMIT_POSITION_DONE:case CB.TeraBrainUserMsgType.TBUSER_SUBMIT_GAME_RESPONSE:case CB.TeraBrainUserMsgType.TBUSER_ANALYSE_GAME_RESPONSE:case CB.TeraBrainUserMsgType.TBUSER_USERDATA:case CB.TeraBrainUserMsgType.TBUSER_LOCALTREE:}};
    d.prototype.handleInfoMsg=function(b){this.aTBI=new CB.TeraBrainInfo;this.aTBI.V3(b.getBuf());b={position:this.aTBI.pos.getPosition(),moves:this.aTBI.moveList.moves,ticket:b.getVal(),tbInfo:this.aTBI};this.fireOnLiveBook(b)};d.prototype.handleConfirmRequest=function(b){this.fireOnLiveBook({moves:[],ticket:b.getVal()})};d.prototype.onConnectedToBoundServer=function(){this.boundLoginOk=!0;this.callOnConnect?(this.callOnConnect(),this.callOnConnect=null):this.requestPosInfo(new CB.Position)};d.prototype.handleTableData=
        function(b){this.timerClear.stop();this.aHTD=new CB.HashTableData;this.aHTD.V3(b.getBuf());for(var c=[],d=0;d<CB.TBrainMove.prototype.HASH_LINE_CNT;++d)null==this.associativeArray[this.aHTD.move[d].m_nEngineId]?c.push(this.aHTD.move[d].m_nEngineId):this.aHTD.move[d].EngineName=this.associativeArray[this.aHTD.move[d].m_nEngineId];0<c.length?this.requestEngineNames(c):(c=this.aHTD.pos.getPosition(),V15.panelMgr.tbPanel&&V15.panelMgr.tbPanel.update(c,this.aHTD),this.tableDataHandlers[b.getVal()]&&(this.tableDataHandlers[b.getVal()](b.getVal(),
            this.aHTD),delete this.tableDataHandlers[b.getVal()]),this.fireOnTBData({position:c,table:this.aHTD}))};d.prototype.setEmptyTable=function(){this.aHTD||(this.aHTD=new CB.HashTableData);var b=CB.HashTableData.emptyFactory();V15.panelMgr.tbPanel&&V15.panelMgr.tbPanel.update(this.aHTD.pos.getPosition(),b)};d.prototype.handleEngineNames=function(b){for(var c=b.getBuf().Vw(),d=0;d<c;d++){b.getBuf().beginSizedRead();var f=b.getBuf().V6(255),g=b.getBuf().Vw();this.associativeArray[g]=f;b.getBuf().readFloat64();
        b.getBuf().endSizedRead()}for(b=0;b<CB.TBrainMove.prototype.HASH_LINE_CNT;++b)this.aHTD.move[b].EngineName=this.associativeArray[this.aHTD.move[b].m_nEngineId];b=this.aHTD.pos.getPosition();V15.panelMgr.tbPanel&&(V15.panelMgr.tbPanel.update(b,this.aHTD),this.timerClear.stop(),this.fireOnTBData({position:b,table:this.aHTD}))};d.prototype.LogInPlayChessName=function(){var b=new TeraBrainMessage(SocketsMessageType.TERABRAIN_USER);b.SetUserType(TeraBrainUserMsgType.TBUSER_CHESSSERVER_LOGIN);var c=b.GetPDataBuf();
        c.WriteString(m_strUsername);c.WriteString(m_strPassword);InquireMachineGuid();m_sMachineGuid.IsZero()?CBDebug.assert(!1):(this.m_sMachineGuid.WriteToDataBuffer(c),this.send(b))};d.prototype.LogOutPlayChessName=function(b){b=new TeraBrainMessage(SocketsMessageType.TERABRAIN_USER);b.SetUserType(TeraBrainUserMsgType.TBUSER_CHESSSERVER_LOGOUT);var c=b.GetPDataBuf();this.InquireMachineGuid();m_sMachineGuid.IsZero()?CBDebug.assert(!1):(this.m_sMachineGuid.WriteToDataBuffer(c),Send(b));this.m_bLoggedIn=
        !1;ResetLoginData()};d.prototype.ResetLoginData=function(){this.m_nUserReliability=0;this.m_bAdmin=!1;this.m_nUserId=0};d.prototype.InquireMachineGuid=function(){m_sMachineGuid.IsZero();return m_sMachineGuid};d.prototype.GetNUserId=function(){return m_nUserId};d.prototype.GetNEngineId=function(){return m_nEngineId};d.prototype.ShouldUsePlayChessName=function(){return!0};d.prototype.UseEngineInAnalysis=function(){return!1};d.prototype.GetMaxServerSilentSeconds=function(){return 30};d.prototype.handleChat=
        function(b){var c=new CB.ChatData;c.fromSocketsMsg(b);c.isToSession()?(b=this.watchSessions.getTitleOfSession(c.getIdSession()),b.length&&(c.strMsg="("+b+"): "+c.strMsg),V15.panelMgr.chatOut(c.toString(),"LogKibitzChat")):V15.panelMgr.chatOut(c.toString())};Ve.initForListeners(d);d.prototype.sendRandomMessage=function(){for(var b=0;10>b;b++);};Ve.initForListeners(d);Ve.addEvent(d,"LiveBook");Ve.addEvent(d,"TBData");Ve.addEvent(d,"LiveBookDisplay");return d}();
CB.TeraBrainUserMsgType={TBUSER_REQ_ENGINENAMES:1400,TBUSER_ENGINENAMES:1401,TBUSER_REQ_USERENTRIES:1402,TBUSER_USERENTRIES:1403,TBUSER_CHAT_TO_ALL:1404,TBUSER_INJECT_GAME:1420,TBUSER_CHESSSERVER_LOGIN:1421,TBUSER_CHESSSERVER_LOGOUT:1422,TBUSER_CONFIRM_LOGIN:1423,TBUSER_HOTPOSITION:1424,TBUSER_REQ_HOTPOSITION:1425,TBUSER_CONFIRM_REQUEST:1426,TBUSER_DEEP_CHECK:1427,TBUSER_DEEP_VAR:1428,TBUSER_BEGIN_DONATION:1429,TBUSER_END_DONATION:1430,TBUSER_SLAVE_ANALYSIS:1431,TBUSER_RETRACT_REQUEST:1432,TBUSER_RETRACT:1433,
    TBUSER_SUBMIT_POSITION:1434,TBUSER_SUBMIT_POSITION_DONE:1435,TBUSER_SUBMIT_GAME:1436,TBUSER_SUBMIT_GAME_RESPONSE:1437,TBUSER_ANALYSE_GAME:1438,TBUSER_ANALYSE_GAME_RESPONSE:1439,TBUSER_COMMENTS:1440,TBUSER_REQ_COMMENTS:1441,TBUSER_ADD_COMMENT:1442,TBUSER_COMMENT_FEEDBACK:1443,TBUSER_REFRESH_COMMENT:1444,TBUSER_CONFIRMCOMMENT_REQUEST:1445,TBUSER_REQ_RANKINGLIST:1460,TBUSER_RANKINGLIST:1461,TBUSER_BACKUP_DATABASES:1462,TBUSER_TEST:1463,TBUSER_ADMIN_RESET_RANKING:1464,TBUSER_ADMIN_BLOCK_DISCOVERY:1465,
    TBUSER_REQUEST_PERSONALDATA:1466,TBUSER_USERDATA:1467,TBUSER_REQUEST_LOCALTREE:1468,TBUSER_LOCALTREE:1469,TBUSER_SUSPICIOUS_LINE:1480,TBUSER_RESET_LIN:1481,TBUSER_FEEDBACK_ON_LINE:1481,TBUSER_SET_MACHINE_FACTOR:1482,toString:function(d){for(var b in this)if(this[b]==d)return b;return"Unknown TBUserMsgId: "+d}};"use strict";
CB.TeraBrainRequest=function(){var d=function(b,c,d){this.m_eRequestType=c;this.m_aHashPos=new CB.HashPosition(b);this.m_aMachineInfo=d;this.m_nMoveNo=b.getMoveNum();this.m_bCountVisit=!0;this.m_bHumanServerGame=this.m_bConfirmRequested=!1;this.m_nFlags=0};d.prototyperRequestsPosInfo=function(){return this.m_eRequestType==TeraBrainRequestType.TBREQUEST_LB_POSINFO};d.prototype.requestsAllMoves=function(){return this.m_eRequestType==TeraBrainRequestType.TBREQUEST_LB_ALLMOVES};d.prototype.requestsSearchInfo=
    function(){return this.m_eRequestType==TeraBrainRequestType.TBREQUEST_SEARCH_INFO};d.prototype.isUploadOnly=function(){return this.m_eRequestType==TeraBrainRequestType.TBREQUEST_LB_UPLOADONLY};d.prototype.getHashPos=function(){return this.m_aHashPos};d.prototype.getMoveNo=function(){return this.m_nMoveNo};d.prototype.setMoveNo=function(b){this.m_nMoveNo=b};d.prototype.getTaggedPos=function(){return new CB.TaggedHashPos(GetHashPos(),GetMoveNo())};d.prototype.countVisit=function(){return this.m_bCountVisit};
    d.prototype.setCountVisit=function(b){this.m_bCountVisit=b||!1};d.prototype.confirmRequested=function(){return this.m_bConfirmRequested};d.prototype.setConfirmRequested=function(b){this.m_bConfirmRequested=b||!1};d.prototype.isHumanServerGame=function(){return this.m_bHumanServerGame};d.prototype.setIsHumanServerGame=function(b){this.m_bHumanServerGame=b||!1};d.prototype.isNormedEval=function(){return this.ISFLAG(1)};d.prototype.setIsNormedEval=function(b){this.SETFLAG(1,b)};d.prototype.setIsMultiRequest=
        function(b){this.SETFLAG(2,b)};d.prototype.SETFLAG=function(b,c){this.m_nFlags=c?this.m_nFlags|b:this.m_nFlags&~b};d.prototype.ISFLAG=function(b){return 0!=(this.m_nFlags&b)};d.prototype.fromMessage=function(b){b=b.getPDataBuf();b.rewind();this.V3(b)};d.prototype.getSocketsMessage=function(){var b=new CB.WebSockMessage(CB.SockMsgId.TERABRAIN_REQUEST);this.writeToDataBuffer(b.buf);return b};d.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();b.Vh(this.m_eRequestType);this.m_aHashPos.writeToDataBuffer(b);
        this.m_aMachineInfo.writeToDataBuffer(b);b.Vh(this.m_nMoveNo);b.V13(this.m_bCountVisit);b.V13(this.m_bConfirmRequested);b.V13(this.m_bHumanServerGame);b.Vh(this.m_nFlags);b.endSizedWrite()};d.prototype.V3=function(b){b.BeginSizedRead();this.m_eRequestType=TeraBrainRequestType(b.ReadInt());this.m_aHashPos.ReadFromDataBuffer(b);this.m_aMachineInfo.ReadFromDataBuffer(b);this.m_nMoveNo=b.ReadUint32();this.m_bCountVisit=b.ReadBool();this.m_bConfirmRequested=b.ReadBool();this.m_bHumanServerGame=b.ReadBool();
        this.m_nFlags=b.ReadUint32();b.EndSizedRead();return!0};return d}();"use strict";CB.TBrainTimeStamp=function(){var d=function(){};d.prototype.UShortToDate=function(b){var c=b&31,d=b>>5&15;b=1945+(b>>9&127);return new CBDate(Math.Min(CBDate.Today().GetDate(),(new CBDate(b,d,c)).GetDate()))};d.prototype.DateToUShort=function(b){var c=Math.Max(1945,b.GetYear());return ushort(b.GetDay()|b.GetMonth()<<5|c-1945<<9)};d.prototype.GetNTodaysTimeStamp=function(){return DateToUShort(CBDate.Today())};return d}();
"use strict";CB.namespace("CB.Panels");
CB.Panels.createTBListPanel=function(d,b){CB.namespace("ExtDataModels");CB.ExtDataModels.tbItem=Ext.define("tbItem",{extend:"Ext.data.Model",fields:["m_nEval","line","m_nDepth","EngineName"]});var c=[],e=null,f=Ext.create("Ext.data.Store",{model:"tbItem",sorters:[{property:"m_nGames",direction:"DESC"}]});f.applyAdd=function(b){c.length&&CB.LOG("TB Store Add: "+c.length);e&&(e.hide(),e=null);f.add(c);c.length&&CB.LOG("End TB Store Add");c=[]};f.onGameRemoved=function(b){b=f.getById(b);null!==b&&f.remove([b])};
    d.game.addOnResetGameListener(function(){c=[]});var g=0;var h=Ext.create("Ext.grid.Panel",{title:lm.LETS_CHECK,id:"tbPanelGrid",store:f,heigth:150,width:350,split:!0,region:b.region,multiSelect:!1,collapsible:!0,animCollapse:!1,plugins:b.responsiveConfig?"responsive":null,responsiveConfig:b.responsiveConfig,viewConfig:{trackOver:!1},columns:[{text:lm.EVAL,flex:1,minWidth:30,maxWidth:80,sortable:!0,dataIndex:"m_nEval",tdCls:"gmBlackCell",renderer:function(b,c,d,e,f,g){return d.data.m_aLine[0]?d.data.m_nEval/
                100:"--"}},{text:lm.VARIATION,flex:1,minWidth:100,maxWidth:120,sortable:!0,dataIndex:"line",tdCls:"gmLine",renderer:function(b,c,d,e,f,h){return V15.isLoggedIn()||12>g?d.data.line:lm.PLEASE_LOGIN_SHORT}},{text:lm.DEPTH,flex:3,minWidth:30,maxWidth:60,sortable:!0,dataIndex:"m_nDepth",tdCls:"gmBlackCell",renderer:function(b,c,d,e,f,g){return d.data.m_aLine[0]?d.data.m_nDepth:""}},{text:lm.ENGINE,flex:2,minWidth:130,maxWidth:200,sortable:!0,dataIndex:"EngineName",tdCls:"gmClock",renderer:function(b,c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  d,e,f,g){return d.data.EngineName}}]});h.onCellClick=function(b,c,d,e,f,g,h,q){CB.LOG("On TB Click: row="+g)};h.on("cellclick",h.onCellClick);h.clear=function(b){f.removeAll()};h.startupdate=function(){null===e&&h.isVisible()&&(e=h.createMask());null!==e&&e.show()};h.update=function(b,e){f.removeAll();for(var h=0;h<CB.TBrainMove.prototype.HASH_LINE_CNT;++h){e.move[h].line=CB.HashTableData.generateLine(b,e.move[h],d).lineNota;var k=new CB.ExtDataModels.tbItem(e.move[h]);0==k.data.m_aLine[0]&&(k.data.line=
        "---",k.data.EngineName="---");c.push(k)}0==f.count()&&f.applyAdd(!0);g=d.getCurPos().getPlyNum()};h.createMask=function(){return new Ext.LoadMask(h.getEl(),{msg:lm.LOADING_STATISTICS})};return h};"use strict";CB.namespace("CB.Panels");
CB.Panels.createTBBookListPanel=function(d,b){function c(){if(320>r.getWidth())return"font-size:96%"}CB.namespace("ExtDataModels");CB.ExtDataModels.tbBookItem=Ext.define("tbBookItem",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},"line","Games",{name:"Result",sortType:function(b,c,d){return b}},"EloAvg","m_nVisits","m_nEval","m_nDepth","fPercent","to","fr","pr","players"]});var e=null,f=Ext.create("Ext.data.Store",{model:"tbBookItem",sorters:[{property:"m_nVisits",direction:"DESC"}]});f.applyAdd=
    function(b){b.length&&CB.LOG("LBook Add: "+b.length);e&&(e.hide(),e=null);f.add(b);b.length&&CB.LOG("End LBook Add:"+b.length)};f.onGameRemoved=function(b){b=f.getById(b);null!==b&&f.remove([b])};var g=0,h=[{text:lm.MOVE,flex:4,minWidth:50,maxWidth:250,sortable:!1,dataIndex:"line",tdCls:"liveBookMove",renderer:function(b,d,e,f,h,k){b=r.getMyMoveDecoration(e);d.tdCls=b.cls;d.tdStyle=c();if(V15.config.freeLiveBook||!V15.config.liveBookIsPremium||l||10>g){d=e.data.line.split(" ");if(1<d.length){e=d[0];
        e+='<span class="liveBookMoreMoves">';for(f=1;f<d.length;f++)e+=" "+d[f];return e+="<span>"+b.suffix}return e.data.line+b.suffix}d.tdCls="gmPremiumOnly";if(m)return String.formatEx('<a class="gmPremiumOnly" href="{0}">{1}</a>',"https://account.chessbase.com/en/matrix",lm.PREMIUM_ONLY);e="https://live.chessbase.com/logon?returnurl="+encodeURIComponent(document.location);return String.formatEx('<a class="gmPremiumOnly" href="{0}">{1}</a>',e,lm.PREMIUM_ONLY)}},{text:lm.GAMES,flex:3,minWidth:40,maxWidth:140,
    sortable:!0,dataIndex:"Games",align:"right",tdCls:"liveBookGames",renderer:function(b,d,e,f,h,k){d.tdStyle=c();return V15.config.freeLiveBook||V15.isLoggedIn()||10>g?e.data.Games.toLocaleString(CB.Language.getStrUserLanguage(),{maximumFractionDigits:0}):lm.PLEASE_LOGIN_SHORT}},{text:lm.RESULT,flex:2.3,minWidth:55,maxWidth:130,sortable:!0,dataIndex:"Result",tdCls:"liveBookResult",renderer:function(b,d,e,f,g,h){d.tdStyle=c();if(0<e.data.Games)return Math.round(e.data.Result)+"%";if(V15.config.freeLiveBook||
        V15.isLoggedIn()){if(d.tdCls="liveBookEval",e.data.hasEval()){b=e.data.m_nEval;e=e.data.m_nDepth;if(29750<Math.abs(b))return e="#"+(3E4-Math.abs(b)),0>b&&(e="-"+e),e;d="";0<b&&(d="+");b=d+(.01*b).toFixed(2);e&&(b+="/"+e);return b}}else return"";return"---"}},{text:lm.ELO_AVG,flex:2,minWidth:35,maxWidth:60,sortable:!0,dataIndex:"EloAvg",align:"center",tdCls:"liveBookEloAvg",renderer:function(b,d,e,f,g,h){d.tdStyle=c();if(!isNaN(e.data.EloAvg))return Math.round(e.data.EloAvg)}},{text:"%",flex:1,minWidth:30,
    maxWidth:50,sortable:!0,align:"center",dataIndex:"fPercent",renderer:function(b,d,e,f,g,h){d.tdStyle=c();if(!isNaN(e.data.fPercent))return Math.round(e.data.fPercent)}},{text:lm.VISITS,flex:3,minWidth:50,maxWidth:120,sortable:!0,dataIndex:"m_nVisits",tdCls:"liveBookVisits",align:"right",renderer:function(b,d,e,f,h,k){d.tdStyle=c();if(!isNaN(e.data.m_nVisits))return V15.config.freeLiveBook||V15.isLoggedIn()||10>g?e.data.m_nVisits.toLocaleString(CB.Language.getStrUserLanguage(),{maximumFractionDigits:0}):
        lm.PLEASE_LOGIN_SHORT}}],k=!1,l=!1,m=!1,p={id:"tbBookGrid",title:750<window.innerHeight||b.forceTitle?lm.LIVE_BOOK:0,region:b.region,store:f,heigth:b.height,width:b.width,minHeight:b.minHeight,autoScroll:!0,closable:b.closable,split:!0,viewConfig:{emptyText:lm.REQUESTING_MOVES},animCollapse:!1,plugins:b.responsiveConfig?"responsive":null,responsiveConfig:b.responsiveConfig,listeners:{beforeItemKeyDown:function(b,c,e,f,g){CB.LOG("Before Key Down");b=!0;switch(g.getKey()){default:b=!1;break;case g.UP:case g.DOWN:case g.PAGE_DOWN:case g.PAGE_UP:break;
            case g.LEFT:CB.LOG("Cursor L");r.myFocus=!0;d().game.gotoPrev();break;case g.RIGHT:CB.LOG("Cursor R");r.myFocus=!0;d().game.gotoNext();break;case g.ENTER:CB.LOG("Enter"),r.loadMove(c.data),b=!1}return b?b:(g.stopEvent(),V15.panelMgr.getIsFormOpen()||V15.commands.handleKeyDown(g),!1)}},columns:h,tools:800<window.innerHeight&&b.helpBtn?[{type:"help",tooltip:"Get Help",callback:function(b,c,d){V15.panelMgr.showToolTip({x:d.touch.pageX-200,y:d.touch.pageY-30},lm.LIVE_BOOK_HELP,4E3)}}]:null};b.toolbar&&
CB.System.isAtLeastTablet()&&(p.bbar={items:[CB.ToolButtons.btn(lm.LOAD_WHITE,"White16","small",function(){d().boardWin.setBlackIsBottom(!1,!0);V15.loadMyMoves(CB.GetMovesType.WHITE,new CB.Game)}.bind(r)),CB.ToolButtons.btn(lm.LOAD_BLACK,"Black16","small",function(){d().boardWin.setBlackIsBottom(!0,!0);V15.loadMyMoves(CB.GetMovesType.BLACK,new CB.Game)}.bind(r)),CB.ToolButtons.btn("Restore Game","RestoreGameNew16","small",function(){V15.restorePrevGame()}.bind(r))]});var r=Ext.create("Ext.grid.Panel",
    p);r.myMoves=[];r.onCellClick=function(b,c,d,e,f,g,h,k){CB.LOG("On book Click: row="+g);6>d&&r.loadMove(e.data)};r.loadMove=function(b){b=new CB.Move(b.fr,b.to,b.pr);d().getCurPos().isLegalMove(b)&&d().game.makeMove(b,d().Vk.getMoveEnterType());(new CB.Timer(function(){V15.panelMgr.refreshOnlineDBGames&&V15.panelMgr.refreshOnlineDBGames()})).runOnce(400);r.myFocus=!0};r.onContextMenu=function(b,c,d,e,f,g){if(V15.cloudMgr){f.preventDefault();if(V15.cloudMgr&&V15.checkCloudLoggedIn())var h=new CB.Move(c.data.fr,
    c.data.to,c.data.pr),k=function(b){r.removeFromMyMoves(h)},q=function(b){r.addMoveToMyMoves(h,!1)},l=function(b){r.addMoveToMyMoves(h,!0)},u=function(b){r.unmarkTree(h,!1)},m=function(b){r.unmarkTree(h,!0)},p=function(b){r.unlearnTree(h,!1)},y=function(b){r.unlearnTree(h,!0)};CB.CSS.addIcon("MyMove16");CB.CSS.addIcon("ImportantMove16");CB.CSS.addIcon("EraseMove16");CB.CSS.addIcon("ResetLearning16");CB.CSS.addIcon("Cutline16");Ext.create("Ext.menu.Menu",{items:[{text:lm.MARK_MOVE,iconCls:"MyMove16",
        handler:q,activated:r.isRepertoireMove(h)},{text:lm.MARK_IMPORTANT,iconCls:"ImportantMove16",handler:l},{text:lm.UNMARK_MOVE,iconCls:"Erase16",handler:k,enabled:r.isRepertoireMove(h)},"-",{text:lm.UNMARK_TREE_WHITE,iconCls:"Cutline16",handler:u},{text:lm.UNMARK_TREE_BLACK,iconCls:"Cutline16",handler:m},"-",{text:lm.RESET_LEARNING_WHITE,iconCls:"ResetLearning16",handler:p},{text:lm.RESET_LEARNING_BLACK,iconCls:"ResetLearning16",handler:y}]}).showAt(f.getXY())}};r.isRepertoireMove=function(b){if(b)for(var c=
    0;c<r.myMoves.length;c++)if(r.myMoves[c].move.equals(b))return!0;return!1};r.getMoveFlags=function(b){for(var c=0;c<r.myMoves.length;c++)if(r.myMoves[c].move.equals(b))return r.myMoves[c].flags;return 0};r.getMyMove=function(b){for(var c=0;c<r.myMoves.length;c++)if(r.myMoves[c].move.equals(b))return r.myMoves[c];return{eval:0}};r.removeMyMove=function(b){for(var c=!1,d=-1,e=0;!c&&e<r.myMoves.length;e++)r.myMoves[e].move.equals(b)&&(d=e,c=!0);0<=d&&r.myMoves.splice(d,1);return c};r.removeFromMyMoves=
    function(b){V15.cloudMgr&&V15.cloudMgr.isLoggedIn()&&r.removeMyMove(b)&&(V15.cloudMgr.removeFromMyMoves(d().game.getCurPos(),b),V15.cloudMgr.isMovesLoadedFor(d().game.getCurPos().getBTM())&&V15.cloudMgr.reloadMyMoves(),r.getView().refresh())};r.unmarkTree=function(b,c){if(V15.cloudMgr&&V15.cloudMgr.isLoggedIn()){var e=V15.cloneGameToCurPos(d().game);e.getCurPos().preCalcCtx(b);e.makeMove(b);V15.cloudMgr.removeWholeTree(d().game.getCurPos(),b,c?CB.GetMovesType.BLACK:CB.GetMovesType.WHITE);r.removeMyMove(b);
    r.getView().refresh()}};r.unlearnTree=function(b,c){if(V15.cloudMgr&&V15.cloudMgr.isLoggedIn()){var e=V15.cloneGameToCurPos(d().game);e.getCurPos().preCalcCtx(b);e.makeMove(b);V15.cloudMgr.unlearnWholeTree(d().game.getCurPos(),b,c?CB.GetMovesType.BLACK:CB.GetMovesType.WHITE);r.getView().refresh()}};r.updateOrAddMove=function(b){for(var c=0;c<r.myMoves.length;c++)if(r.myMoves[c].move.equals(b.move)){r.myMoves[c].flags=b.flags;return}r.myMoves.push({move:b.move,visits:0,flags:b.flags})};r.addMoveToMyMoves=
    function(b,c){if(V15.cloudMgr&&V15.cloudMgr.isLoggedIn()){var e=d().game.getCurPos().getBTM()?1:2;c&&(e|=16);r.getMoveFlags(b)!=e&&(r.updateOrAddMove({move:b,flags:e}),e=V15.cloneGameToCurPos(d().game),e.getCurPos().preCalcCtx(b),e.makeMove(b),V15.cloudMgr.storePosAndMoves(e,c?3:2),r.getView().refresh());V15.cloudMgr.isMovesLoadedFor(d().game.getCurPos().getBTM())&&V15.cloudMgr.reloadMyMoves()}};r.getMyMoveDecoration=function(b){var c={suffix:"",cls:""};if(CB.PosAndMoveFlags){var d=new CB.Move(b.data.fr,
    b.data.to,b.data.pr);b=r.getMoveFlags(d);d=r.getMyMove(d).eval;b&CB.PosAndMoveFlags.MYMOVE?(b&16?(c.cls+=" liveBookMoveImportant",c.suffix="**"):(c.cls+=" liveBookMoveInRep",c.suffix="*"),c.cls=b&CB.PosAndMoveFlags.MY_WHITE?b&CB.PosAndMoveFlags.BLACK?c.cls+" liveBookBoth":c.cls+" liveBookWhite":c.cls+" liveBookBlack"):b&CB.PosAndMoveFlags.MOVE?(c.cls+=" liveBookMyLine",c.suffix="",c.cls=b&CB.PosAndMoveFlags.MOVE_WHITE?b&CB.PosAndMoveFlags.BLACK?c.cls+" liveBookBoth":c.cls+" liveBookWhite":c.cls+" liveBookBlack"):
    (c.cls+=" liveBookMove",c.suffix="");d&&(c.suffix+="<span class='CBSymbol'>"+Vp.getText(d)+"</span>")}return c};r.on("cellclick",r.onCellClick);r.on("itemcontextmenu",r.onContextMenu);r.startupdate=function(){null===e&&r.isVisible()&&(e=r.createMask());null!==e&&e.show()};r.clear=function(b){r.isVisible()&&(b&&this.setEmptyText(b),b=r.getHeight(),0<f.count()&&f.removeAll(),r.setHeight(b))};r.setEmptyText=function(b){Ext.apply(r.getView(),{emptyText:'<div class = "gridEmptyText">'+b+"</div>"})};var t=
    CB.TBrainMove.getTimeStampToday();r.refreshAfterShow=function(){this.lbInfo&&this.liveBookListener(this.lbInfo);this.repPosInfo&&this.myMovesListener(this.repPosInfo)};r.liveBookListener=function(b){if(!r.isVisible())r.lbInfo=b;else if(d()&&d().getCurPos){var c=b.moves,e=d().getCurPos(),h=e.getSideToMove();6>=e.getPieces().length&&(b.sorted||CB.TBrainMoveList.sortEval(c,h==CB.Side.BLACK));r.setEmptyText(lm.FRESH_POSITION);c=r.getHeight();if(d()){g=d().getCurPos().getPlyNum();for(h=e=0;h<b.moves.length;h++)e+=
    b.moves[h].getNVisits();t=CB.TBrainMove.getTimeStampToday();var k=6>=d().getCurPos().getPieces().length,l=[];for(h=0;h<b.moves.length;h++){var m=b.moves[h];if(k||r.passesMoveFilter(m)){var p=m.getMoveRecord();m.line=r.generateLine(b.position,p);m.fPercent=100;e&&(m.fPercent=100*m.getNVisits()/e);m.m_nEval=m.getNEval();m.Games=m.m_performanceStats.getNGames();m.Result=m.m_performanceStats.getFPercent(b.position.isBTM());m.EloAvg=m.m_performanceStats.getSortEloAv();m.fr=p.from;m.to=p.to;m.players=[];
    delete m.id;m=new CB.ExtDataModels.tbBookItem(m);m.id=r.calcId(p);l.push(m)}}0<f.count()&&f.removeAll();f.applyAdd(l);r.setHeight(c);r.myFocus&&(r.myFocus=!1,r.focus());l.length?r.setEmptyText("Requesting moves..."):r.getView().refresh()}}};r.calcId=function(b){return"TBBook"+((b.prom<<12)+(b.from<<8)+b.to)};r.passesMoveFilter=function(c){var d=b.minVisits||2;return(0<c.getNGames()||300>t-c.m_nTimeStamp||c.isMyMove)&&(c.getNVisits()>=d||c.hasEval())};r.tbDataListener=function(b){if(r.isVisible()&&
    d()&&d().getCurPos&&b.position.equals(d().getCurPos())){f.beginUpdate();for(var c=[],e=0;e<CB.TBrainMove.prototype.HASH_LINE_CNT;++e){var g=CB.HashTableData.generateLine(b.position,b.table.move[e],d(),3);if(g.line.length){var h=new CB.TBrainMove;h.line=g.lineNota;for(var k=!1,l=0;l<f.getCount();l++){var m=f.getAt(l);g.line[0].equals(m.data.move)&&(m.data.m_nEval=b.table.move[e].m_nEval,m.data.m_nDepth=b.table.move[e].m_nDepth,0==m.data.Games&&(m.data.line=g.lineNota),k=!0)}if(!k&&(h.players=[],h.to=
    g.line[0].to,h.from=g.line[0].from,h.Games=0,h.EloAvg=0,h.to!=h.from&&(h.move=g.line[0],150<b.table.move[e].m_nCalcDepth))){h.m_nEval=b.table.move[e].m_nEval;h.m_nDepth=b.table.move[e].m_nDepth;h.setHasEval(!0);h=new CB.ExtDataModels.tbBookItem(h);h.id=r.calcId(g.line[0]);h.data.line=g.lineNota;g=!1;for(k=0;!g&&k<c.length;k++)g=c[k].id==h.id;g||c.push(h)}}}f.add(c);f.endUpdate();r.getView().refresh()}};r.onDBGamesListener=function(b){if(r.isVisible()){f.beginUpdate();for(var c=0;c<b.length;c++)if(b[c].nFlags&
    CB.OnlineEntryEnum.FLAGS_ONLINE_GAME&&V15.onlineLobby.firstMove<b[c].aGame.getCurLine().length){var d=b[c].aGame.getCurLine()[V15.onlineLobby.firstMove];if((d=f.getById(r.calcId(d)))&&2>d.data.players.length){var e=V15.onlineLobby.firstMove&1?b[c].aGame.hdr.black.getListStr(0):b[c].aGame.hdr.white.getListStr(0);d.data.players[0]!=e&&d.data.players.push(e);r.getView().refreshNode(d)}}f.endUpdate()}};r.generateLine=function(b,c){b=this.convertJSONLine(ObjUtil.clone(b),c);c=new CB.NotationGenerator(CB.V1);
    for(var e="",f=d().game.getStartPos().getBTM(),g=0;g<b.length;g++){var h=c.getMoveNota(b[g]),k=c.getStrMoveNumInLine(g,d().getCurPos().getPlyNum(),f);e+=k+h;g<b.length-1&&(e+=" ")}return e};r.convertJSONLine=function(b,c){var d=[];b.isLegalMove(c)&&(b.preCalcCtx(c),b.makeMove(c),b.postCalcCtx(c,!0),d.push(c));return d};r.myMovesListener=function(b){this.repPosInfo=b;for(var c=0;c<b.moves.length;c++)CB.LOG(b.moves[c].move+"-"+b.moves[c].visits+", "+b.moves[c].flags+", correct="+b.moves[c].correct);
    r.myMoves=b.moves;r.getView().refresh()};r.createMask=function(){return new Ext.LoadMask({msg:lm.LOADING_STATISTICS,target:r})};r.initCloudListener=function(b){b.addOnMyMovesListener(r.myMovesListener)};r.onLoginListener=function(){r.myMoves=[];r.setTitle(lm.LIVE_BOOK);r.getView().refresh()};r.onAccountTypeListener=function(c){m=(l=3==c.type)||2==c.type;!k&&0<=c.type&&b.players&&(h.push({text:"Players",flex:3,minWidth:50,maxWidth:220,sortable:!0,dataIndex:"players",tdCls:"liveBookVisits",align:"left",
    renderer:function(b,c,d,e,f,g){if(l)return c.tdCls="liveBookPlayers",b.join("/");c.tdCls="gmPremiumOnly";if(m)return String.formatEx('<a class="gmPremiumOnly" href="{0}">{1}</a>',"https://account.chessbase.com/en/matrix",lm.PREMIUM_ONLY);b="https://live.chessbase.com/logon?returnurl="+encodeURIComponent(document.location);return String.formatEx('<a class="gmPremiumOnly" href="{0}">{1}</a>',b,lm.PREMIUM_ONLY)}}),r.reconfigure(f,h),k=!0);r.getView().refresh()};b.suppressLiveBookListener||V15.aTBLobby.addOnLiveBookListener(r.liveBookListener);
    V15.aTBLobby.addOnLiveBookDisplayListener(r.liveBookListener);V15.aTBLobby.addOnTBDataListener(r.tbDataListener);V15.addOnLoginListener(r.onLoginListener.bind(r));V15.addOnAccountTypeListener(r.onAccountTypeListener.bind(r));V15.onlineLobby&&V15.onlineLobby.addOnGamesListener(r.onDBGamesListener.bind(r));return r};"use strict";
CB.PositionTracker=function(){var d=function(){this.set=new CB.Set;this.trackCnt=0;this.enabled=!0};d.prototype.save=function(){(new CB.Storage).save("posns_trackCnt",this.trackCnt);this.set.save("posns",function(b){return 200>this.trackCnt-b.lastSeenAt}.bind(this))};d.prototype.load=function(){this.trackCnt=(new CB.Storage).load("posns_trackCnt")||0;this.set.load("posns",function(b){if(b){var c=new CB.Position;c.copy(b.pos);c=new CB.TrackedPos(c);c.cnt=b.cnt;c.lastSeenAt=b.lastSeenAt;return c}})};
    d.prototype.track=function(b){if(this.enabled){this.trackCnt++;if(this.set.contains(new CB.TrackedPos(b)))return b=this.set.get(new CB.TrackedPos(b)),b.inc(),b.lastSeenAt=this.trackCnt,!0;b=new CB.TrackedPos(b);b.lastSeenAt=this.trackCnt;this.set.insert(b)}return!1};d.prototype.getAge=function(b){b=this.set.get(new CB.TrackedPos(b));return void 0!==b&&0!=b.cnt?this.trackCnt-b.lastSeenAt:-1};return d}();
CB.TrackedPos=function(){var d=function(b){this.pos=ObjUtil.clone(b);this.lastSeenAt=this.cnt=0};d.prototype.setEquals=function(b){return this.pos.setEquals(b.pos)};d.prototype.setGreater=function(b){return this.pos.setGreater(b.pos)};d.prototype.inc=function(){this.cnt++};return d}();CB.namespace("CB.Server.ClientData");CB.Server.ClientFlags={CCDATA_RECEIVES_PAYMENTS:1,CCDATA_ENGINE_ALLOWED:2,CCDATA_PREMIUM_ACCOUNT:4,CCDATA_NO_GAME_DOWNLOAD:8};
CB.Server.ClientData=function(){var d=function(){this.nConnQuality=this.n8Reserved=this.n8Flags2=this.n8InputLang=this.n8Language=this.n8NonPureFlags=this.n8Flags=this.nRank=this.nId=0;this.strText=this.strName="";this.n16Reserved=this.n16Flags=this.eStatus=this.eTitle=this.nRating=0;this.geoCoords=new CB.GeoCoordinates;this.eloRating=new CB.Server.EloRating};d.prototype.fromDataBuf=function(b){this.nId=b.V10();this.eStatus=b.V10()&65535;this.nRank=b.V10();this.n8Flags=b.readUint8();this.n8NonPureFlag=
    b.readUint8();this.n8Language=b.readUint8();this.n8InputLang=b.readUint8();this.n8Flags2=b.readUint8();this.n8Reserved=b.readUint8();this.nConnQuality=b.V11();this.strName=b.V6(200);this.strText=b.V6(200);this.nRating=b.V10();this.eTitle=b.V10();b.V10();this.geoCoords.fromDataBuf(b);this.n16Flags=b.V11();this.n16Reserved=b.V11();b.beginSizedRead();this.eloRating.fromDataBuf(b);b.endSizedRead();return!0};d.prototype.isGuest=function(){return(this.nRank&15)==CB.Server.RankEnum.GUEST};d.prototype.isPremium=
    function(){return this.n16Flags==CB.Server.ClientFlags.CCDATA_PREMIUM_ACCOUNT};return d}();CB.namespace("CB.Server.ClientList");CB.Server.ClientList=function(){var d=function(){this.items=[]};d.prototype.fromSocketsMsg=function(b){b=b.getBuf();for(var c=b.V10(),d=0;d<c;d++){var f=new CB.Server.ClientData;f.fromDataBuf(b)&&this.items.push(f)}};d.prototype.get=function(b){return this.items[b]};d.prototype.count=function(){return this.items.length};d.prototype.autoTests=function(){return"NOTIMPL"};return d}();
"use strict";CB.namespace("CB.Server.Rank");CB.namespace("CB.Server.RankEnum");CB.namespace("CB.Server.RankFlags");
CB.Server.RankEnum={NONE:-1,GUEST:0,PAWN:1,KNIGHT:2,BISHOP:3,ROOK:4,QUEEN:5,KING:6,TOPGM:7,VIP:8,SYSOP:9,CHESSBASE:10,NUM:11,getStrCode:function(d){switch(d&15){default:case this.GUEST:return"Guest";case this.PAWN:return"Pawn";case this.KNIGHT:return"Knight";case this.BISHOP:return"Bishop";case this.ROOK:return"Rook";case this.QUEEN:return"Queen";case this.KING:return"King";case this.VIP:return"VIP";case this.TOPGM:return"topGM";case this.SYSOP:return"Sysop";case this.CHESSBASE:return"ChessBase"}},
    getStrText:function(d){switch(d&15){default:case this.GUEST:return lm.GUEST;case this.PAWN:return lm.PAWN;case this.KNIGHT:return lm.KNIGHT;case this.BISHOP:return lm.BISHOP;case this.ROOK:return lm.ROOK;case this.QUEEN:return lm.QUEEN;case this.KING:return lm.KING;case this.VIP:return"VIP";case this.TOPGM:return"Top-GM";case this.SYSOP:return"Sysop";case this.CHESSBASE:return"ChessBase"}}};
CB.Server.RankFlags={FLAG_500DAYS:1,FLAG_1000DAYS:2,FLAG_100TOURNDIRS:16,FLAG_500TOURNDIRS:32,FLAG_HELPER:64,FLAG_PREMIUM:128,FLAG_ROBOT:256};
CB.Server.Rank=function(){function d(b,c,d,h){1<d.length&&CB.CSS.addRules(".rnk-"+c+d,"background-image: url( ../../common/media/server/ranks"+h+"/"+c+d+h+".png ) !important;background-repeat:no-repeat; background-position:center;")}var b=!1,c=function(c,f){this.rank=c;this.flags=f;if(!b){for(c=CB.Server.RankEnum.PAWN;c<=CB.Server.RankEnum.KING;c++)d(void 0,"w",CB.Server.RankEnum.getStrCode(c),16),d(void 0,"b",CB.Server.RankEnum.getStrCode(c),16);d(void 0,"","Guest",16);for(c=CB.Server.RankEnum.TOPGM;c<
CB.Server.RankEnum.NUM;c++)d(void 0,"",CB.Server.RankEnum.getStrCode(c),16);d(void 0,"","Helper",16);b=!0}};c.prototype.fromCompressed=function(b){this.rank=b&255;this.flags=b>>16};c.prototype.getCompressed=function(){return this.flags<<16+rank};c.prototype.isBlackSymbol=function(){return 0!==(this.flags&CB.Server.RankFlags.FLAG_500DAYS)||0!==(this.flags&CB.Server.RankFlags.FLAG_1000DAYS)};c.prototype.isHelper=function(){return 0!=(this.flags&CB.Server.RankFlags.FLAG_HELPER)};c.prototype.isPremium=
    function(){return 0!=(this.flags&CB.Server.RankFlags.FLAG_PREMIUM)};c.prototype.getStrCode=function(){return CB.Server.RankEnum.getStrCode(this.rank)};c.prototype.getStrColumn=function(){var b=CB.Server.RankEnum.getStrText(this.rank);return b+=this.getStrFlags()};c.prototype.getStrFlags=function(){var b="";this.flags&CB.Server.RankFlags.FLAG_500DAYS&&(b+="+");this.flags&CB.Server.RankFlags.FLAG_1000DAYS&&(b+="+");this.flags&CB.Server.RankFlags.FLAG_100TOURNDIRS&&(b+="*");this.flags&CB.Server.RankFlags.FLAG_500TOURNDIRS&&
(b+="*");this.flags&CB.Server.RankFlags.FLAG_PREMIUM&&(b+="!");return b};c.prototype.getSortVal=function(){return this.rank==CB.Server.RankEnum.CHESSBASE?0:this.isHelper()?256*CB.Server.RankEnum.VIP+this.flags+1:256*this.rank+this.flags+1};c.prototype.getCSSClass=function(){if(this.isHelper())var b="rnk-Helper";else switch(this.rank){default:case CB.Server.RankEnum.GUEST:b="rnk-Guest";break;case CB.Server.RankEnum.PAWN:case CB.Server.RankEnum.KNIGHT:case CB.Server.RankEnum.BISHOP:case CB.Server.RankEnum.ROOK:case CB.Server.RankEnum.QUEEN:case CB.Server.RankEnum.KING:b=
    "rnk-"+(this.isBlackSymbol()?"b":"w")+this.getStrCode();break;case CB.Server.RankEnum.TOPGM:case CB.Server.RankEnum.VIP:case CB.Server.RankEnum.SYSOP:case CB.Server.RankEnum.CHESSBASE:b="rnk-"+this.getStrCode()}return b};return c}();"use strict";CB.namespace("CB.Server.Status");
CB.Server.StatusEnum={GONE:1,STANDING:2,PLAYER:4,WATCHER:8,ANALYSER:16,CHAIRMAN:32,SEEKING:8192,TOURNDIRECTOR:32768,SIMULMASTER:65536,APPLYING:131072,UNAPPLYING:262144,REGISTERED:524288,SOLVER:16777216,IDLE:64,NOTIDLE:128,DISCONNECTED:1048576,YESGAMES:256,NOGAMES:512,HUMAN:1024,ENGINE:2048,CENTAUR:4096,VIDEO:16384,ENCODING:4194304,LISTENING:8388608,DGT_BOARD:2097152,OFFLINE:4194304,toString:function(d){if(d&this.GONE)var b=lm.GONE;else if(d&this.OFFLINE)b="Offline";else switch(d&this.ACTIONTYPE&~this.SEEKING){default:case this.STANDING:b=
        "";break;case this.PLAYER:b=lm.PLAYING;break;case this.WATCHER:b=lm.KIBITZING;break;case this.CHAIRMAN:b=lm.CHAIRMAN;break;case this.SOLVER:b=lm.TACTICS;break;case this.REGISTERED:b="Registered"}d&this.SEEKING&&(b.length&&(b+="/"),b+=lm.SEEKS);d&this.GONE||(d&this.IDLE&&(b.length&&(b+="/"),b+=lm.IDLE),d&this.NOGAMES&&!(d&this.PLAYER)&&(b.length&&(b+="/"),b+=lm.PAUSE),d&this.CENTAUR&&(b.length&&(b+="/"),b+="Centaur"),d&this.ENGINE&&(b.length&&(b+="/"),b+="Engine"),d&this.TOURNDIRECTOR&&(b=lm.TOURN_DIRECTOR),
    d&this.SIMULMASTER&&(b="Simul Master"),d&this.APPLYING&&(b="wants in"),d&this.UNAPPLYING&&(b="wants out"),d&this.REGISTERED&&(b="registered"),d&this.DISCONNECTED&&(b+="disconnected"));return b}};
(function(){var d=CB.Server.StatusEnum;d.ACTIONTYPE=d.STANDING|d.PLAYER|d.WATCHER|d.SOLVER|d.SEEKING|d.ANALYSER|d.CHAIRMAN|d.APPLYING|d.UNAPPLYING|d.REGISTERED|d.SIMULMASTER|d.TOURNDIRECTOR;d.PLAYERTYPE=d.HUMAN|d.ENGINE|d.CENTAUR;d.IDLETYPE=d.IDLE|d.NOTIDLE|d.VIDEO|d.DISCONNECTED|d.ENCODING|d.LISTENING;d.PROMINENTTYPE=d.CHAIRMAN|d.TOURNDIRECTOR|d.SIMULMASTER;d.NOGAMETYPE=d.YESGAMES|d.NOGAMES})();
CB.Server.Status=function(){var d=CB.Server.StatusEnum,b=!1,c=function(c){this.flags=c;if(!b){c="Idle Pause Playing Kibitzing Seeking Tactics Chairman".split(" ");for(var d=0;d<c.length;d++){var e=c[d];if(1<e.length){var h="background-image: url( ../../common/media/server/status/"+e+16+".png ) !important;";h=V15&&V15.panelMgr&&V15.panelMgr.viewport&&V15.panelMgr.viewport.rtl?h+"background-repeat:no-repeat; background-position:right center;":h+"background-repeat:no-repeat; background-position:left center;";
    CB.CSS.addRules(".stat-"+e,h)}}b=!0}};c.prototype.toString=function(){return CB.Server.StatusEnum.toString(this.flags)};c.prototype.getSortVal=function(){var b=0;if(this.flags&d.GONE)return b;b++;if(this.flags&d.CHAIRMAN)return b;b++;if(this.flags&d.SIMULMASTER)return b;b++;if(this.flags&d.TOURNDIRECTOR)return b;b++;if(this.flags&d.DISCONNECTED)return b;b++;if(this.flags&d.REGISTERED)return b;b++;if(this.flags&d.APPLYING)return b;b++;if(this.flags&d.UNAPPLYING)return b;b++;if(this.flags&d.SOLVER)return b;
    b++;if(this.flags&d.PLAYER)return b;b++;if(this.flags&d.WATCHER)return b;b++;if(this.flags&d.SEEKING)return b;b++;if(this.flags&d.YESGAMES)return b;b++;if(this.flags&d.NOGAMES)return b;b++;if(this.flags&d.DGT_BOARD)return b;b++;if(this.flags&d.IDLE)return b;b++;return b};c.prototype.applyChange=function(b){b.isStatusChange()&&(b.status&d.ACTIONTYPE&&(this.flags&=~d.ACTIONTYPE),b.status&d.PLAYERTYPE&&(this.flags&=~d.PLAYERTYPE),b.status&d.IDLETYPE&&(this.flags&=~d.IDLETYPE),b.status&d.NOGAMETYPE&&
(this.flags&=~d.NOGAMETYPE),this.flags|=b.status)};c.prototype.isPlaying=function(){return 0!=(this.flags&d.PLAYER)};c.prototype.getCSSClass=function(){var b="";if(!(this.flags&d.GONE))if(this.flags&d.IDLE)b="stat-Idle";else if(this.flags&d.NOGAMES&&!(this.flags&d.PLAYER))b="stat-Pause";else if(this.flags&d.SEEKING)b="stat-Seeking";else switch(this.flags&d.ACTIONTYPE){case d.PLAYER:b="stat-Playing";break;case d.WATCHER:b="stat-Kibitzing";break;case d.CHAIRMAN:b="stat-Chairman";break;case d.SOLVER:b=
    "stat-Tactics"}return b};return c}();"use strict";CB.namespace("CB.Server.ClientChange");CB.Server.ClientChangeEnum={STATUS:1,TEXT:2,VALUE1:4,VALUE2:8,ADDRESS:16,CONNQUAL:32};
CB.Server.ClientChange=function(){var d=CB.Server.ClientChangeEnum,b=function(){};b.prototype.init=function(b){this.reserved=this.connQual=this.flags=0;this.id=b;this.status=this.val2=this.val1=0};b.prototype.fromDataBuf=function(b){this.flags=b.V10();this.connQual=b.V11();this.reserved=b.V11();this.id=b.V10();this.ISFLAG(d.VALUE1)?this.val1=b.V10():this.val1=0;this.ISFLAG(d.VALUE2)?this.val2=b.V10():this.val2=0;this.ISFLAG(d.STATUS)&&(this.status=b.V10());this.ISFLAG(d.TEXT)&&(this.text=b.V6(65))};
    b.prototype.Vz=function(b){b.Vx(this.flags);b.Vv(this.connQual||0);b.Vv(this.reserved||0);b.Vx(this.id)||0;this.ISFLAG(d.VALUE1)&&b.writeInt(this.val1);this.ISFLAG(d.VALUE2)&&b.writeInt(this.val2);this.ISFLAG(d.STATUS)&&b.writeInt(this.status);this.ISFLAG(d.TEXT)&&b.V5(this.text)};b.prototype.toString=function(){var b="id="+this.id;this.ISFLAG(d.VALUE1)&&(b+=" val1="+this.val1);this.ISFLAG(d.VALUE2)&&(b+=" val2="+this.val2);this.ISFLAG(d.STATUS)&&(b+=" stat="+CB.Server.StatusEnum.toString(this.status));
        this.ISFLAG(d.TEXT)&&(b+=" txt="+this.text);return b};b.prototype.setStatusChange=function(b){if("number"!=typeof b)throw Error("CDC.setStatusChange must pass a number");this.flags|=d.STATUS;this.status=b};b.prototype.isStatusChange=function(){return this.ISFLAG(d.STATUS)};b.prototype.isChangedElo=function(){return this.ISFLAG(d.VALUE1)&&this.ISFLAG(d.VALUE2)&&1==this.val1};b.prototype.getChangedElo=function(){return this.isChangedElo()?this.val2&65535:0};b.prototype.ISFLAG=function(b){return 0!==
        (this.flags&b)};b.prototype.isSeeking=function(){return 0!=(this.status&CB.Server.StatusEnum.SEEKING)&&this.isStatusChange()};b.prototype.isPlaying=function(){return 0!=(this.status&CB.Server.StatusEnum.PLAYER)&&this.isStatusChange()};b.prototype.setIsPlaying=function(){this.status|=CB.Server.StatusEnum.PLAYER;this.flags|=CB.Server.ClientChangeEnum.STATUS};b.prototype.isRegisteredStatus=function(){return this.isStatusChange&&0!=(this.status&CB.Server.StatusEnum.REGISTERED)};return b}();
CB.UserMsgId={NONE:0,CHALLENGE:1E3,CANCEL_SEEKS:1001,VALIDATE_SEEKS:1002,RESPOND_VALIDATE_SEEKS:1003,REQUEST_ALL_SEEKS:1004,RESPOND_ALL_SEEKS:1005,REQUESTGAMELIST:1100,GAMELIST:1101,ADDGAME:1102,REMOVEGAME:1103,GAMESTATUS:1200,GAME:1201,SESSIONACTION:1202,SETCLOCK:1203,STARTGAME:1204,TIME_PENALTY:1205,RESTARTGAME:1206,RESTARTTOURNGAME:1207,FOLLOW:1208,STOPFOLLOW:1209,FOLLOWEVENT:1210,REQUEST_SELECTED_CLIENTLIST:1211,SELECTED_CLIENTLIST:1212,REQUEST_FRIENDLIST:1213,RESPOND_FRIENDLIST:1214,ADD_REMOVE_FRIEND_FOE:1215,
    STARTTOURNAMENTGAME:1216,PLAYEREVALUTION:1250,INFORMALAPPLAUSE:1251,NOTIFY_CLIENT:1260,REQUEST_BESTGAME:1261,RESPOND_BESTGAME:1262,CANCEL_BESTGAME:1263,REQUEST_ELODATA:1270,ELODATA:1271,FORMULA:1272,CONFIRM_REGISTRATION:1273,TEMP_ELO:1274,NEW_ELO:1275,USERTODATABASEID:1276,REQUEST_OPPONENTS:1277,RESPOND_OPPONENTS:1278,GETPICTURE:1280,SETPICTURE:1281,GETSMALLPICTURE:1282,SETSMALLPICTURE:1283,SETGEOPOS:1284,toString:function(d){for(var b in this)if(this[b]==d)return"UserMsg:"+b;return"Unknown UserMsgId: "+
        d},toNumString:function(d){return"UserMsgId="+d}};"use strict";CB.namespace("CB.Server.GameStatusChange");
CB.Server.GameStatusEnum={UNDEFINED:-1,BLACKWINS:100,DRAW:101,WHITEWINS:102,ABORT:103,RESIGN:360,TIMEOVERSTEPPED:361,CLAIMFLAG:362,ACCEPT_CLAIMFLAG:363,REJECT_CLAIMFLAG:364,YOURMOVE_REQUEST:365,SIMUL_CLAIMWIN:366,OFFERDRAW:370,ACCEPTDRAW:371,REJECTDRAW:372,RETRACTDRAW:373,OFFERTAKEBACK:374,ACCEPTTAKEBACK:375,REJECTTAKEBACK:376,OFFERABORT:380,ACCEPTABORT:381,REJECTABORT:382,CLAIMWIN_ON_DISCONNECT:383,SERVER_FORCES_ABORT:384,EARLY_ABORT:385,ALLOW_ABORT:386,OFFERADJOURN:388,ACCEPTADJOURN:389,REJECTADJOURN:390,
    RETRACTADJOURN:391,QUERYBEGIN:500,BEGINOK:501,QUERYRESTART:502,RESTARTOK:503,TRANSMISSION_READY:504,WINDOWCLOSED:505,BEGINANALYSIS:506,GAMERESTARTED:507,LIVETIME:508,MINRANKCHAT:509,TWOMOVESDONE:510,QUERYBEGINBLACK:511,BEGINOKBLACK:512,FORCERELOAD:513,CHANGEGAME_TO_ANALYSIS:514,ADD_WATCHER:600,REMOVE_WATCHER:601,REQUEST_WATCHERLIST:602,REQUEST_GAMEUPDATE:603,REQUESTGAME_ADDWATCHER:604,WATCH_NUM:605,INVITE_WATCHER:620,BLOCK_AFTER_ILLEGAL:621,RECEIVED_GAME_AFTER_ILLEGAL:622,STREAMINGON:650,STREAMINGOFF:651,
    BLOCK_ENGINES:670,ALLOW_ENGINES:671,MOVE_RECEIPT:672,toString:function(d){for(var b in this)if(this[b]==d)return"GChange: "+b;return"Unknown GameStatChange: "+d}};var gsEnum=CB.Server.GameStatusEnum;
CB.Server.GameStatusChange=function(){var d=function(b,c,d){this.type=b||CB.Server.GameStatusEnum.UNDEFINED;this.idGame=c||0;this.idPlayer=d||0;this.num=this.flags=0};d.prototype.init=function(b,c){this.idGame=b;this.idPlayer=c;this.num=this.flags=0};d.prototype.fromDataBuf=function(b){this.idGame=b.readInt();this.type=b.readInt();this.idPlayer=b.readInt();this.num=b.readInt();this.flags=b.readShort();this.reserved=b.readShort()};d.prototype.Vz=function(b){b.writeInt(this.idGame);b.writeInt(this.type);
    b.writeInt(this.idPlayer);b.writeInt(this.num);b.writeShort(this.flags);b.writeShort(0)};d.prototype.isResult=function(){return 0<=this.type&&this.type<=CB.Server.GameStatusEnum.ABORT};d.prototype.isWatcherChange=function(){return this.type==CB.Server.GameStatusEnum.ADD_WATCHER||this.type==CB.Server.GameStatusEnum.REQUESTGAME_ADDWATCHER||this.type==CB.Server.GameStatusEnum.REMOVE_WATCHER};d.prototype.isResult=function(){return this.type==CB.Server.GameStatusEnum.BLACKWINS||this.type==CB.Server.GameStatusEnum.WHITEWINS||
    this.type==CB.Server.GameStatusEnum.DRAW};d.prototype.getWatchersInc=function(){return this.type==CB.Server.GameStatusEnum.ADD_WATCHER||this.type==CB.Server.GameStatusEnum.REQUESTGAME_ADDWATCHER?1:this.type==CB.Server.GameStatusEnum.REMOVE_WATCHER?-1:0};d.prototype.getNum=function(){return this.num};d.prototype.toString=function(){return CB.Server.GameStatusEnum.toString(this.type)+": "+this.idGame+", player="+this.idPlayer+", flags="+this.flags};return d}();"use strict";CB.namespace("CB.Server.GameItemTypeBits");
CB.Server.GameItemType={UNKNOWN:0,GAME:1,BROADCAST:2,ANALYSIS:4,SETUP:8,ABORTED:16,RATED:32,BULLET:64,BLITZ:128,SLOW:256,ENGINE:512,CENTAUR:1024,HTTP_STREAM:2048,STREAM:4096,IMPORTANT:8192,PREMIUM:16384,PRIVATE:32768,TOP_GAME:65536};CB.Server.GameItemType.SORTMASK=CB.Server.GameItemType.GAME|CB.Server.GameItemType.BROADCAST|CB.Server.GameItemType.ANALYSIS|CB.Server.GameItemType.RATED|CB.Server.GameItemType.IMPORTANT|CB.Server.GameItemType.STREAM;
CB.Server.GameItemType.COMPUTER=CB.Server.GameItemType.ENGINE|CB.Server.GameItemType.CENTAUR;CB.namespace("CB.Server.GameItem");
CB.Server.GameItem=function(){var d=function(){};d.prototype.fromDataBuf=function(b){this.white=b.V6(100);this.type=b.V11();this.black=b.V6(100);this.id=b.V10();this.idGroup=b.V10();this.result=b.V10();this.timeStart=b.V10();this.idWhite=b.V10();this.idBlack=b.V10();this.idChallenger=b.readInt();this.flags=b.readInt();this.tourn=b.V6(100);this.eloWhite=b.V11()&8191;this.eloBlack=b.V11()&8191;this.round1=b.readUint8();this.round2=b.readUint8();this.kibitzCosts=b.V11();b.beginSizedRead();var c=b.V10();
    this.watchers=c&65535;this.moveLen=c>>22&511;this.eco=b.Vu();b.endSizedRead();this.clock=new CB.ClockParams;this.clock.fromDataBuf(b);this.flags&CB.Server.SessionBits.WITHCLOCK||delete this.clock};d.prototype.toString=function(){return this.white+"-"+this.black+", "+this.tourn+" ("+this.round1+")"};d.prototype.getTitle=function(){return this.white?this.white+" - ...":""};d.prototype.applyGameChange=function(b){b.isResult()&&(this.result=b.type-100);b.isWatcherChange()&&(this.watchers+=b.getWatchersInc())};
    d.prototype.isBlitz=function(){return 0!=(this.type&CB.Server.GameItemType.BLITZ)};d.prototype.isBullet=function(){return 0!=(this.type&CB.Server.GameItemType.BULLET)};d.prototype.isImportant=function(){return 0!=(this.type&CB.Server.GameItemType.IMPORTANT)};d.prototype.isAnalysis=function(){return 0!=(this.type&CB.Server.GameItemType.ANALYSIS)};d.prototype.isBroadcast=function(){return 0!=(this.type&CB.Server.GameItemType.BROADCAST)};d.prototype.isStream=function(){return 0!=(this.type&CB.Server.GameItemType.STREAM)};
    d.prototype.isHTTPStream=function(){return 0!=(this.type&CB.Server.GameItemType.HTTP_STREAM)};d.prototype.isPrivate=function(){return 0!=(this.flags&CB.Server.SessionBits.PRIVATE)};d.prototype.isPremium=function(){return 0!=(this.flags&CB.Server.GameItemType.PREMIUM)};d.prototype.mightBeEngineGame=function(){var b=(this.white.match(/\d/g)||[]).length,c=(this.black.match(/\d/g)||[]).length,d=(this.black.match(/\./g)||[]).length,f=(this.black.match(/\./g)||[]).length,g=0<(this.white.match(/64/g)||[]).length&&
        0<(this.white.match(/bit/gi)||[]).length,h=0<(this.black.match(/64/g)||[]).length&&0<(this.black.match(/bit/gi)||[]).length;return 0<d&&0<f&&1<b&&1<c||g||h};d.prototype.getWatcherSortVal=function(){return CB.GameResultEnum.isFinished(this.result)?this.watchers/2:this.watchers};d.prototype.shouldRequestImmediatelyInLive=function(){return 2<this.result&&(300<this.watchers||2500<this.eloWhite&&2500<this.eloBlack)||2680<this.eloWhite||2680<this.eloBlack};return d}();
CB.Server.GameItem.getResultString=function(d,b){switch(d){case CB.GameResultEnum.GAME_UNFINISHED:case CB.GameResultEnum.WHITE_WINS:case CB.GameResultEnum.BLACK_WINS:case CB.GameResultEnum.DRAW:return CB.GameResultEnum.toString(d);case CB.GameResultEnum.UNDEFINED_RESULT:return b&(CB.Server.GameItemType.ANALYSIS|CB.Server.GameItemType.BROADCAST)?lm.FINISHED:lm.ABORTED}};
CB.Server.GameItemList=function(){function d(b,d,f){for(var c=0;c<b.length;c++)if(void 0===b[c].watchers||d.eloWhite>b[c].eloWhite){b.splice(c,0,d);b.length>f&&b.pop();return}b.length<f&&b.push(d)}var b=function(b){this.games=b?b:[]};b.prototype.fromDataBuf=function(b){for(var c=b.V10(),d=0;d<c;d++){var g=new CB.Server.GameItem;g.fromDataBuf(b);this.games.push(g)}};b.prototype.empty=function(){return 0==this.games.length};b.prototype.getIdGroup=function(){if(this.games.length)return this.games[0].idGroup};
    b.prototype.getAutoWatchByKibitzers=function(b){function c(b,c,d){if(c){for(var e=0;e<b.length;e++)if(void 0===b[e].watchers||c.getWatcherSortVal()>b[e].getWatcherSortVal()){b.splice(e,0,c);b.length>d&&b.pop();return}b.length<d&&b.push(c)}}for(var d=[],g=0;g<this.games.length;g++)!(d.length<b||this.games[g].isImportant()||d.length&&this.games[g].watchers>d[d.length-1].watchers)||this.games[g].isStream()||this.games[g].isAnalysis()||this.games[g].mightBeEngineGame()||CB.GameResultEnum.isFinished(this.games[g].result)&&
    !this.games[g].isBroadcast()||!this.games[g].isBlitz()&&!this.games[g].isBroadcast()||c(d,this.games[g],b);d.forEach(function(b,c,d){CB.LOG(c+":"+b+" kibitzers="+b.watchers)});return d};b.prototype.getAutoWatchByElo=function(b){for(var c=[],f=0;f<this.games.length;f++)!(c.length<b||this.games[f].isImportant()||c.length&&this.games[f].eloWhite>c[c.length-1].eloWhite)||this.games[f].isStream()||this.games[f].isAnalysis()||CB.GameResultEnum.isFinished(this.games[f].result)&&!this.games[f].isBroadcast()||
    !this.games[f].isBlitz()&&!this.games[f].isBroadcast()||d(c,this.games[f],b);c.forEach(function(b,c,d){CB.LOG(c+":"+b+" Elo="+b.eloWhite)});return c};b.prototype.getAutoWatchByEloRunning=function(b,e){for(var c=[],g=0;g<this.games.length;g++)(c.length<b||this.games[g].isImportant()||c.length&&this.games[g].eloWhite>c[c.length-1].eloWhite)&&!this.games[g].isStream()&&!this.games[g].isAnalysis()&&!CB.GameResultEnum.isFinished(this.games[g].result)&&this.games[g].isBroadcast()&&this.games[g].watchers>
    e&&d(c,this.games[g],b);c.forEach(function(b,c,d){CB.LOG(c+":"+b+" Elo="+b.eloWhite)});return c};b.prototype.getAutoWatchByMedia=function(b,d){for(var c=[],e=0;e<this.games.length;e++)if((this.games[e].isStream()||this.games[e].isHTTPStream())&&this.games[e].isBroadcast()&&-1==this.games[e].result){var h=!this.games[e].isPrivate();h&&(this.games[e].isPremium()&&(h=!1,d&&(h=!0)),h&&c.push(this.games[e]))}c.forEach(function(b,c,d){CB.LOG(c+":"+b+" kibitzers="+b.watchers)});d=[];for(e=0;e<c.length;e++)d.push(c[e]),
        h=new CB.BroadcastPair(d[e].id,d[e].white+" - "+d[e].black,d[e].tourn),b.push(h);return d};b.prototype.isStream=function(b){for(b=0;b<this.games.length;b++)if(this.games[b].isStream())return!0;return!1};b.prototype.getFiltered=function(b){for(var c=[],d=0;d<this.games.length;d++)b(this.games[d])&&c.push(this.games[d]);return c.length?new CB.Server.GameItemList(c):new CB.Server.GameItemList(this.getAutoWatchByKibitzers(4))};return b}();"use strict";CB.namespace("CB.Server.GameData");
CB.Server.GameData=function(){var d=function(){};d.prototype.fromDataBuf=function(b){this.idGame=b.readInt();this.type=b.readInt();this.reserved=b.readInt();this.game=new CB.Game;this.game.fromDataBuf(b);b.beginSizedRead();this.strBanner=b.V6(255);this.strURL=b.V6(255);this.strWrapUrl=b.V6(255);b.endSizedRead()};d.prototype.Vz=function(b){b.writeInt(this.idGame)};d.prototype.toString=function(){return"GameData: "+this.idGame+", type="+this.type.toString(16)+", "+this.game.hdr.white+"-"+this.game.hdr.black};
    d.prototype.isStream=function(){return 0!=(this.type&CB.Server.GameItemType.STREAM)};d.prototype.isBroadcast=function(){return 0!=(this.type&CB.Server.GameItemType.BROADCAST)};d.prototype.isHTTPStream=function(){return 0!=(this.type&CB.Server.GameItemType.HTTP_STREAM)};d.prototype.isPremiumOnly=function(){return 0!=(this.type&CB.Server.GameItemType.PREMIUM)};return d}();"use strict";
CB.MoveData=function(){var d=function(b,c,d,f){b&&(this.move=[b.from,b.to,b.prom&7],this.moveNo=c,this.centiSecs=d,this.idGame=f);this.flags=0};d.prototype.toString=function(){return CB.Square.toString(this.move[0])+"-"+CB.Square.toString(this.move[1])};d.prototype.fromDataBuf=function(b){this.idGame=b.V10();this.move=b.readByteArray(3);this.centiSecs=b.V10();this.moveNo=b.V11();this.flags=b.V11();this.eval=b.V10()};d.prototype.Vz=function(b){b.Vx(this.idGame);b.writeByteArray(this.move,3);b.Vx(this.centiSecs);
    b.Vv(this.moveNo);b.Vv(this.flags||0);b.Vx(this.eval||0)};return d}();"use strict";CB.SetClockData=function(){var d=function(){};d.prototype.fromDataBuf=function(b){this.whiteCentiSecs=b.readInt();this.blackCentiSecs=b.readInt();this.tickCount=b.readInt();this.flags=b.readInt()};d.prototype.getWhiteTime=function(){return this.whiteCentiSecs};d.prototype.getBlackTime=function(){return this.blackCentiSecs};d.prototype.isBlack=function(){return 0!=(this.flags&1)};return d}();"use strict";CB.namespace("CB.Server.GameSession");
CB.Server.SessionBits={RATED:1,WITHCLOCK:2,ALLOWTRANSMITGAME:4,TAKEBACK:8,POOL_BLITZ:16,ANALYSIS:32,RESUME:64,IN_TOURNAMENT:128,IN_SIMUL:256,WITH_STARTMOVES:512,PRIVATE:1024,WITHSTREAMING:2048,WITH_MANUALCLOCK:4096,DUCATSSTAKE:8192,WHITE_ENGINE:16384,BLACK_ENGINE:32768,WHITE_CENTAUR:65536,BLACK_CENTAUR:131072,WHITE_GM:262144,BLACK_GM:524288,PREMIUM:1048576,AUTOSTARTENCODER:2097152,BLOCK_ENGINES:4194304,MATCH:8388608,SLAVE_RESTART:16777216,HAS_BETS:33554432,DISABLE_BETS:67108864,PREMIUM_MOVES:134217728,
    WHITE_POOL_BLITZ:268435456,BLACK_POOL_BLITZ:536870912};
CB.Server.GameSession=function(){var d=1,b=function(b,e,f){this.lobby=b;this.idGame=e;this.viewLink=f;this.requestedGame=!1;this.nErrorCount=this.nGameRequests=0;this.isFirstRequest=!0;this.uniqueId=d++;this.receivingMoves=!0;this.bufferedActions=[];this.delayedSessionActions=[];this.nGameActionsDelay=0};b.prototype.recycle=function(){CB.LOG("Release Session:"+this.idGame,"LogBold");this.gameKernel&&(this.gameKernel.animateBoard=!1,this.gameKernel.destroy(),this.gameKernel=null);this.nErrorCount=
    this.nGameRequests=0;this.receivingMoves=this.isFirstRequest=!0;this.board&&(this.board.allowInput=!0)};b.prototype.onRecycle=function(){this.recycle();if(this.board)this.board.onRecycle()};b.prototype.isFinished=function(){return this.gameKernel.isFinished()};b.prototype.toggleReceivingMoves=function(){this.receivingMoves=!this.receivingMoves;this.setReceivingMoves(this.receivingMoves);this.nGameRequests=0};b.prototype.setReceivingMoves=function(b,d){if(this.receivingMoves=b)this.lobby.watchSessions.requestGame(this.idGame),
    this.requestedGame=!0;this.board.allowInput=!0;V15.commands.fireChecked(CB.LobbyIds.RECEIVING_MOVES,this.receivingMoves);d||this.gameKernel&&(b?this.gameKernel.Vk.startClock():this.gameKernel.Vk.stopClock())};b.prototype.createBoard3D=function(b){this.board=new CB.BoardControl3D(b,100,100,"FritzBoard");this.requestGame();this.requestedGame=!0;this.isFirstRequest&&this.lobby.watchSessions.addMeAsWatcher(this.idGame);return this.board};b.prototype.createBoard=function(b){this.board=new CB.BoardControl(b,
    100,100,this.idGame);V15.isBoardOnlyApp()?this.board.animSteps={forMove:2,forPosition:2}:this.board.animSteps={forMove:2,forPosition:3};CB.System.isMobile()&&(this.board.animSteps={forMove:.6,forPosition:.5});this.board.allowInput=!0;this.idHandler=this.board.onReadyHandlers.add(this.onBoardReady.bind(this));return this.board};b.prototype.onBoardReady=function(){this.requestedGame||(CB.LOG("Board Ready, requesting Game"),this.requestGame(),this.requestedGame=!0,this.board.onReadyHandlers.remove(this.idHandler),
this.isFirstRequest&&this.lobby.watchSessions.addMeAsWatcher(this.idGame))};b.prototype.onGameData=function(b){try{this.isInGameRequest=!1;this.tickGameReceived=new CB.Tick;CB.LOG("Session "+this.idGame+" receives game: "+b,"LogGreen");this.gameKernel?this.receivingMoves&&(this.gameKernel.game.assign(b.game),this.gameKernel.game.gotoIndex(b.game.getMoveIndex())):(this.gameKernel=new CB.GameKernel(this.viewLink,b.game),this.gameKernel.setPlayingMode(new CB.AnalysisMode(this.gameKernel)),this.gameKernel.setBoardWin(this.board),
    this.gameKernel.Vk.createGUIElements(this.board),this.gameKernel.animateBoard=!1,this.board.singleClickDisabled=!0,this.modifyPlayingMode());this.clock?this.gameKernel.Vk.setChessClock(this.clock):this.gameKernel.Vk.setChessClock(!1);this.board.debugName=b.game.hdr.getStrPlayers();this.receivingMoves&&(this.moveIndexOnServer=this.gameKernel.game.getMoveIndex(),this.executeBufferedActions());this.board.cbcanvas?this.board.setTitleText(this.gameKernel.game.hdr.getStrPlayers(this.board.nSqPix>this.board.cbcanvas.zoomToPix(46))):
    this.board.setTitleText(this.gameKernel.game.hdr.getStrPlayers(20));this.bufferedActions=[];this.nErrorCount=0;this.gameKernel.animateBoard="undefined"!==typeof Ext?V15.animatedBoard()||!Ext.isIE:V15.animatedBoard();this.strBanner=b.strBanner;if((this.strURL=b.strURL)&&(V15.Vf.shouldDisplayBoardUrls()||V15.isBoardOnlyApp())&&V15.config.versionChessBaseCom){var c=this.strURL,d="?";-1!=c.search(/\?/g)&&(d="&");c+=d+"ref=link_from_playchess_com";this.board.destroyBottomWin();if(V15.isBoardOnlyApp()){var g=
    {urlRight:c,linkTextRight:CB.strUtil.shortenURL(this.strURL),linkTextLeft:lm.FULL_VIEW,urlLeft:"http://live.chessbase.com"};this.board.bottomWin=new CB.BoardDoubleURL(g,{hScale:24,hMax:18,spacing:0,rightAlign:!0})}else this.board.bottomWin=new CB.BoardURL({linkText:CB.strUtil.shortenURL(this.strURL),url:c},{hScale:20,hMax:18,spacing:1});this.board.resizeTimer.runOnce(500)}(b.isStream()||b.isHTTPStream())&&this.setReceivingMoves(!1);b.isStream()||b.isHTTPStream()||b.game.hdr.getCBResult().isFinished()&&
this.setReceivingMoves(!1)}catch(h){CB.LogException("GSess::onGameData:",h)}};b.prototype.modifyPlayingMode=function(){this.gameKernel.Vk.fnAcceptMove=function(){this.receivingMoves&&(this.analysisAdded=!0);return!0}.bind(this);this.gameKernel.Vk.fnAfterMove=function(b){this.gameKernel.game.getMoveIndex()==this.moveIndexOnServer+1&&this.gameKernel.game.isOnMainLine()&&this.gameKernel.game.setAnno(CB.AnnoType.PRETEXT,new CB.TextAnno("Analysis:"));return!0}.bind(this)};b.prototype.getTitle=function(){if(this.gameKernel)return this.gameKernel.game.hdr.getStrPlayers(!1)};
    b.prototype.executeBufferedActions=function(){for(var b=0;b<this.bufferedActions.length;b++)CB.LOG("ExecBuffered SessionAction","LogBold"),this.onSessionAction(this.bufferedActions[b],!0)};b.prototype.onSessionAction=function(b,d){if(this.receivingMoves)if(0<this.nGameActionsDelay)b.timeStamp=this.nGameActionsDelay,b.session=this,this.delayedSessionActions.push(b);else this.onProcessSessionAction(b,d);else b.gameAction.isMove()&&(d=b.gameAction.moveData.toString(),this.lobby.statusMsg("Unplugged: "+
        this.gameKernel.game.hdr.getStrPlayers()+" ("+Math.floor(b.gameAction.moveData.moveNo/2+1)+"."+d+")"))};b.prototype.onProcessSessionAction=function(b,d){if(this.isInGameRequest)this.bufferedActions.push(b);else{if(!this.gameKernel)return;this.moveIndexOnServer!=this.gameKernel.game.getMoveIndex()&&this.gameKernel.game.gotoIndex(this.moveIndexOnServer);if(b.gameAction.execute(this.gameKernel.game,b.controlMove)){if(b.gameAction.isMove()||b.gameAction.isGame())b.gameAction.isMove()&&(this.gameKernel.Vk.updateClockFromGame(),
        this.gameKernel.game.deleteAnno(CB.AnnoType.PRETEXT)),this.gameKernel.markLastMove(!1,!1);0<this.nErrorCount&&CB.LOG("Game in Legal Sync: "+this.gameKernel.game.hdr,"LogBold");this.nErrorCount=0;this.moveIndexOnServer=this.gameKernel.game.getMoveIndex();this.analysisAdded&&this.gameKernel.game.promoteLine()&&(d=this.gameKernel.game.getMoveIndex(),this.gameKernel.game.unAnnotate(),this.gameKernel.game.gotoIndex(d),this.moveIndexOnServer=d)}else b.gameAction.isMove()&&!b.isAnEarlierMove(this.gameKernel.game)?
        (this.nErrorCount+=1,CB.LOG(this.board.debugName+"-Illegal: "+b.gameAction+", "+this.nErrorCount,"LogError"),d||this.isFinished()||!(4<this.nErrorCount||6E3<this.tickGameReceived.getExpired())||(this.nGameRequests++,5>this.nGameRequests?(CB.LOG("Illegal Actions, refresh: "+this.gameKernel.game.hdr+", "+this.nGameRequests,"LogError"),this.requestGame()):CB.LOG("Too many illegal moves: "+this.gameKernel.game.hdr,"LogError"))):b.gameAction.isMove()?CB.LOG("Received an earlier move: "+this.gameKernel.game.hdr,
            "LogGreen"):CB.LOG("Non move Session Action: "+b.gameAction,"LogGreen")}b.gameAction.changesMoves()&&(this.analysisAdded=!1)};b.prototype.requestGame=function(){this.isInGameRequest=!0;this.lobby.watchSessions.requestGame(this.idGame)};b.prototype.onGameStatusChange=function(b){switch(b.type){default:CB.LOG("Session.onGSC: "+b);break;case gsEnum.ADD_WATCHER:case gsEnum.REMOVE_WATCHER:case gsEnum.REQUESTGAME_ADDWATCHER:break;case gsEnum.WHITEWINS:this.finishGameWithResult(CB.GameResultEnum.WHITE_WINS);
        break;case gsEnum.DRAW:this.finishGameWithResult(CB.GameResultEnum.DRAW);break;case gsEnum.BLACKWINS:this.finishGameWithResult(CB.GameResultEnum.BLACK_WINS);break;case gsEnum.TIMEOVERSTEPPED:CB.LOG("TIMEOVERSTEPPED","LogBold");if(this.gameKernel)this.gameKernel.Vk.onTimeOverstepped(this.idWhite!==b.idPlayer);this.idWhite==b.idPlayer?CB.LOG("Time - White"):CB.LOG("Time - Black")}};b.prototype.finishGameWithResult=function(b){this.isFinished()||this.gameKernel.setResult(b)};b.prototype.isFinished=function(){return!this.gameKernel||
        this.gameKernel.game.hdr.getCBResult().isFinished()};b.prototype.setClock=function(b){this.gameKernel&&this.gameKernel.Vk.setManualClock(b.getWhiteTime(),b.getBlackTime(),b.isBlack())};b.prototype.onReconnect=function(){this.receivingMoves&&(this.setReceivingMoves(!0),this.board&&this.board.addMessage("Reconnected",!0))};b.prototype.onConnBroken=function(){};b.prototype.toString=function(){return this.gameKernel?this.gameKernel.game.hdr.getStrPlayers():this.idGame};b.prototype.delayGameActions=function(b){this.nGameActionsDelay=
        b;0<this.nGameActionsDelay&&!this.myTimer&&(this.myTimer=setInterval(this.onBufferedGameActionsHandler.bind(this),1E3))};b.prototype.mustExecute=function(b){return 0<b.timeStamp&&(b.timeStamp--,0==b.timeStamp)?!0:!1};b.prototype.execute=function(b){b.session.onProcessSessionAction(b,!0)};b.prototype.onBufferedGameActionsHandler=function(){this.delayedSessionActions.forEach(function(b){CB.Server.GameSession.prototype.mustExecute(b)&&(CB.Server.GameSession.prototype.execute(b),b.session.gameKernel&&
    b.session.gameKernel.game.updateFromExtern())})};return b}();"use strict";
CB.ManualClock=function(){var d=function(b){CB.ManualClock.superClass.call(this,b)};CB.inherit(d,CB.BaseClock);d.prototype.setTime=function(b,c,d){this.stop();b||c?(this.currTime=this.startTime=(new Date).getTime(),0<=b&&(this.whiteTime=b),0<=c&&(this.blackTime=c),0<=this.whiteTime&&(this.isBlack=!1,this.update()),0<=this.blackTime&&(this.isBlack=!0,this.update()),this.isBlack=d,this.clockLink.setToMove(d),this.start()):this.setNoClock()};d.prototype.onResult=function(b){CB.GameResultEnum.isFinished(b)&&
(this.stop(),this.clockLink.showResult(b))};d.prototype.setToMove=function(b){this.isBlack=b;this.update();this.clockLink.setToMove(b);this.clockLink.emphasizeToMove(8E3)};d.prototype.start=function(){this.updateTimer.runPeriodic(1E3);this.clockLink&&(this.clockLink.runningClockId&&this.clockLink.runningClockId!=this.id&&(CBDebug.assert(0),TRACE("Clock Collision!")),this.clockLink.runningClockId=this.id)};d.prototype.stop=function(){this.updateTimer.stop();this.clockLink&&(this.clockLink.runningClockId=
    0)};d.prototype.update=function(){var b=((new Date).getTime()-this.startTime+5)/10,c=((new Date).getTime()-this.currTime+5)/10;this.clockLink.showCurrTime(new Date(10*c),this.isBlack);b=this.isBlack?this.blackTime-=b:this.whiteTime-=b;this.startTime=(new Date).getTime();0>b?this.clockLink.showRestTime(-1,this.isBlack):this.clockLink.showRestTime(new Date(10*b),this.isBlack)};return d}();"use strict";
CB.Server.ClockRange=function(){var d=function(b,c){this.nMins=b||0;this.nSecs=c||0};d.prototype.fromDataBuf=function(b){this.nMins=b.readInt();this.nSecs=b.readInt()};d.prototype.Vz=function(b){b.writeInt(this.nMins);b.writeInt(this.nSecs)};d.prototype.toString=function(){return"ClockRange"};return d}();"use strict";
CB.Server.ConnectionQuality=function(){var d=function(b){this.val=b||0};d.prototype.fromDataBuf=function(b){this.val=b.readShort()};d.prototype.Vz=function(b){b.writeShort(this.val)};d.prototype.getPing=function(){return 30*(this.val>>8&255)};d.prototype.getDiscos=function(){return this.val&255};d.prototype.getSortVal=function(){return this.val};d.prototype.toString=function(){return this.getPing()+"ms"};return d}();"use strict";CB.namespace("CB.Server.LiveSession");
CB.Server.LiveSession=function(){var d=1,b=function(b,e,f,g,h){this.lobby=b;this.idGame=g;this.ticket=e;this.requestData=f;this.fnGetBackgroundKernel=this.fnGetKernel=h;this.requestedGame=!1;this.nErrorCount=this.nGameRequests=0;this.isFirstRequest=!0;this.uniqueId=d++;this.receivingMoves=!0;this.bufferedActions=[];this.delayedSessionActions=[];this.nGameActionsDelay=0;this.animatePosChange=!1};b.prototype.getKernel=function(){return this.fnGetKernel()};b.prototype.setToBackgroundKernel=function(){this.fnGetKernel().Vk.deleteClock();
    this.fnGetBackgroundKernel().Vk.beforeGameLoad();this.fnGetBackgroundKernel().game.assign(this.fnGetKernel().game);this.fnGetKernel=this.fnGetBackgroundKernel};b.prototype.isFinished=function(){return this.getKernel().isFinished()};b.prototype.toggleReceivingMoves=function(){this.receivingMoves=!this.receivingMoves;this.setReceivingMoves(this.receivingMoves);this.nGameRequests=0};b.prototype.setReceivingMoves=function(b,d){if(this.receivingMoves=b)this.requestGame(this.idGame),this.requestedGame=
    !0;V15.commands.fireChecked(CB.LiveCmdIds.RECEIVING_MOVES,this.receivingMoves);d||this.getKernel()&&(b?this.getKernel().Vk.startClock():this.getKernel().Vk.stopClock())};b.prototype.requestGame=function(b){b=new CB.Server.GameStatusChange(CB.Server.GameStatusEnum.REQUEST_GAMEUPDATE,b,this.lobby.getNIdBound());this.sendGameStatusChange(b)};b.prototype.sendGameStatusChange=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);c.setUserType(CB.UserMsgId.GAMESTATUS);c.getBuf();b.Vz(c.getBuf());
    this.lobby.send(c)};b.prototype.onGameData=function(b){try{this.isInGameRequest=!1;this.tickGameReceived=new CB.Tick;CB.LOG("Session "+this.idGame+" receives game: "+b,"LogGreen","live");if(this.receivingMoves){var c=this.getKernel();if(c.boardWin&&void 0!==c.boardWin.prepareFullRedraw){c.boardWin.prepareFullRedraw();var d=c.boardWin.shouldAnimatePosChange;c.boardWin.shouldAnimatePosChange=function(){return!1}}this.animatePosChange=!1;c.Vk.beforeGameLoad();var g=-1;V15.myMovesMgr?(g=V15.myMovesMgr.annoLatestMyMovesMove(b.game),
    console.log("devi="+g)):console.log("no mmmgr...");c.game.assign(b.game);c.game.nGotoMove=b.game.getMoveIndex();var h=V15.lobby.findMyMarkedMove(b.game);0<h&&(c.game.nGotoMove=h);g>c.game.nGotoMove&&(c.game.nGotoMove=g);c.game.gotoIndex(c.game.nGotoMove);0<h&&(c.deleteAnno(CB.AnnoType.SYMBOL),c.addSymbol(CB.AnnoMarkType.MYMOVE));c.idGame=b.idGame;d&&c.boardWin&&(c.boardWin.shouldAnimatePosChange=d);this.updateBoardAttributes()}this.receivingMoves&&(this.moveIndexOnServer=this.getKernel().game.getMoveIndex(),
    this.executeBufferedActions());this.getKernel().markLastMove(!0,!0);this.bufferedActions=[];this.nErrorCount=0;this.animatePosChange=!0}catch(k){CB.LogException("LSess::onGameData:",k)}};b.prototype.shouldAnimatePosChange=function(){return this.animatePosChange};b.prototype.updateBoardAttributes=function(){var b=this.getKernel().boardWin,d=this.getKernel().game;b&&(b.cbcanvas?b.setTitleText(d.hdr.getStrPlayers(b.nSqPix>b.cbcanvas.zoomToPix(42))):b.setTitleText(d.hdr.getStrPlayers(20)),this.setClock&&
this.getKernel().Vk.setManualClock(this.setClock.getWhiteTime(),this.setClock.getBlackTime(),this.getKernel().game.getCurPos().getBTM()))};b.prototype.modifyPlayingMode=function(){this.getKernel().Vk.fnAcceptMove=function(){this.receivingMoves&&(this.analysisAdded=!0);return!0}.bind(this);this.getKernel().Vk.fnAfterMove=function(b){this.getKernel().game.getMoveIndex()==this.moveIndexOnServer+1&&this.getKernel().game.isOnMainLine()&&this.getKernel().game.setAnno(CB.AnnoType.PRETEXT,new CB.TextAnno("Analysis:"));
    return!0}.bind(this)};b.prototype.getTitle=function(){if(this.getKernel())return this.getKernel().game.hdr.getStrPlayers(!1)};b.prototype.executeBufferedActions=function(){for(var b=0;b<this.bufferedActions.length;b++)CB.LOG("ExecBuffered SessionAction","LogBold","live"),this.onSessionAction(this.bufferedActions[b],!0)};b.prototype.onSessionAction=function(b,d){if(this.receivingMoves)if(0<this.nGameActionsDelay)b.timeStamp=this.nGameActionsDelay,b.session=this,this.delayedSessionActions.push(b);else this.onProcessSessionAction(b,
    d);else b.gameAction.isMove()&&this.lobby.logIntoChat("Received a move: "+this.getKernel().game.hdr)};b.prototype.onProcessSessionAction=function(b,d){if(this.isInGameRequest)this.bufferedActions.push(b);else{if(!this.getKernel())return;this.getKernel().game.delayChangedEvents(1E3);var c=this.getKernel().game.getMoveIndex(),e=c<=this.getKernel().game.mainLine.length,h=c!=this.moveIndexOnServer;this.moveIndexOnServer!=this.getKernel().game.getMoveIndex()&&this.getKernel().game.gotoIndex(this.moveIndexOnServer,
    !0);if(b.gameAction.execute(this.getKernel().game,b.controlMove)){if(b.gameAction.isMove()||b.gameAction.isGame())b.gameAction.isMove()&&(this.getKernel().Vk.updateClockFromGame(),this.getKernel().game.deleteAnno(CB.AnnoType.PRETEXT),e||c++),this.getKernel().markLastMove(!0,!0);0<this.nErrorCount&&CB.LOG("Game in Legal Sync: "+this.getKernel().game.hdr,"LogBold");this.nErrorCount=0;this.moveIndexOnServer=this.getKernel().game.getMoveIndex();h&&this.getKernel().game.gotoIndex(c,!0);this.analysisAdded&&
this.getKernel().game.promoteLine()&&(d=this.getKernel().game.getMoveIndex(),this.getKernel().game.unAnnotate(),this.getKernel().game.gotoIndex(d),this.moveIndexOnServer=d)}else b.gameAction.isMove()&&!b.isAnEarlierMove(this.getKernel().game)?(this.nErrorCount+=1,CB.LOG("Illegal: "+b.gameAction+", "+this.nErrorCount,"LogError"),d||this.isFinished()||!(4<this.nErrorCount||this.tickGameReceived&&6E3<this.tickGameReceived.getExpired())||(this.nGameRequests++,5>this.nGameRequests?(CB.LOG("Illegal Actions, refresh: "+
    this.getKernel().game.hdr+", "+this.nGameRequests,"LogError"),this.requestGame()):CB.LOG("Too many illegal moves: "+this.getKernel().game.hdr,"LogError"))):b.gameAction.isMove()?CB.LOG("Received an earlier move: "+this.getKernel().game.hdr,"LogGreen"):CB.LOG("Non move Session Action: "+b.gameAction,"LogGreen");this.getKernel().game.continueChangedEvents()}b.gameAction.changesMoves()&&(this.analysisAdded=!1)};b.prototype.requestGame=function(){this.isInGameRequest=!0;this.lobby.requestGame(this.idGame)};
    b.prototype.onGameStatusChange=function(b){switch(b.type){default:CB.LOG("Session.onGSC: "+b);break;case gsEnum.ADD_WATCHER:case gsEnum.REMOVE_WATCHER:case gsEnum.REQUESTGAME_ADDWATCHER:break;case gsEnum.WHITEWINS:this.finishGameWithResult(CB.GameResultEnum.WHITE_WINS);break;case gsEnum.DRAW:this.finishGameWithResult(CB.GameResultEnum.DRAW);break;case gsEnum.BLACKWINS:this.finishGameWithResult(CB.GameResultEnum.BLACK_WINS);break;case gsEnum.TIMEOVERSTEPPED:CB.LOG("TIMEOVERSTEPPED","LogBold");if(this.getKernel())this.getKernel().Vk.onTimeOverstepped(this.idWhite!==
        b.idPlayer);this.idWhite==b.idPlayer?CB.LOG("Time - White"):CB.LOG("Time - Black")}};b.prototype.finishGameWithResult=function(b){this.isFinished()||this.getKernel().setResult(b)};b.prototype.isFinished=function(){return!this.getKernel()||this.getKernel().game.hdr.getCBResult().isFinished()};b.prototype.onSetClock=function(b){this.setClock=b;this.getKernel()&&this.getKernel().Vk.setManualClock(b.getWhiteTime(),b.getBlackTime(),b.isBlack())};b.prototype.onReconnect=function(){this.receivingMoves&&
    this.setReceivingMoves(!0)};b.prototype.onConnBroken=function(){};b.prototype.toString=function(){return this.getKernel()?this.getKernel().game.hdr.getStrPlayers():this.idGame};b.prototype.delayGameActions=function(b){this.nGameActionsDelay=b;0<this.nGameActionsDelay&&!this.myTimer&&(this.myTimer=setInterval(this.onBufferedGameActionsHandler.bind(this),1E3))};b.prototype.mustExecute=function(b){return 0<b.timeStamp&&(b.timeStamp--,0==b.timeStamp)?!0:!1};b.prototype.execute=function(b){b.session.onProcessSessionAction(b,
        !0)};b.prototype.onBufferedGameActionsHandler=function(){this.delayedSessionActions.forEach(function(b){CB.Server.LiveSession.prototype.mustExecute(b)&&(CB.Server.LiveSession.prototype.execute(b),b.session.getKernel()&&b.session.getKernel().game.updateFromExtern())})};return b}();"use strict";CB.namespace("CB.Server.LiveGameList");
CB.Server.LiveGameList=function(){var d=function(b,c,d){this.lobby=b;this.ticket=c;this.requestData=d;this.sessions={};this.kernels={}};d.prototype.onGameItemList=function(b){this.gameItemList=b;this.requestData.onList(b)};d.prototype.addSession=function(b,c,d,f){if(this.sessions[b])return!1;var e=new CB.GameKernel;e.setPlayingMode(new CB.AnalysisMode(e));this.kernels[b]=e;e.enableAudio(!1);e=new CB.Server.LiveSession(this.lobby,this.ticket,this.requestData,b,function(){return this.kernels[b]}.bind(this));
    var h=this.getGameItem(b);h&&(e.clock=h.clock);e.fnOnMove=c;e.fnOnRecentAnno=d;e.fnOnGameData=f;this.sessions[b]=e;return!0};d.prototype.getGameItem=function(b){if(this.gameItemList)for(var c=0;c<this.gameItemList.games.length;c++)if(this.gameItemList.games[c].id==b)return this.gameItemList.games[c]};d.prototype.onInitKibitzing=function(b,c,d){if(this.kernels[b]&&(d&&this.kernels[d]&&this.sessions[d].setToBackgroundKernel(),c)){d=this.sessions[b];if(c().boardWin&&void 0!==c().boardWin.prepareFullRedraw){c().boardWin.prepareFullRedraw();
    var e=c().boardWin.shouldAnimatePosChange;c().boardWin.shouldAnimatePosChange=function(){return!1}}c().Vk.beforeGameLoad();c().game.assign(this.kernels[b].game);c().idGame=b;c().markLastMove(!0,!0);e&&(c().boardWin.shouldAnimatePosChange=e);d.fnGetKernel=c;d.updateBoardAttributes()}};d.prototype.setSessionToBackground=function(b){b&&this.sessions[b]&&this.sessions[b].setToBackgroundKernel()};d.prototype.notifySessionSwap=function(b,c){if(this.sessions[b]&&this.sessions[c]){var d=this.sessions[c].fnGetKernel;
    this.sessions[c].fnGetKernel=this.sessions[b].fnGetKernel;this.sessions[b].fnGetKernel=d;this.sessions[b].updateBoardAttributes();this.sessions[c].updateBoardAttributes()}};d.prototype.onGameData=function(b){this.sessions[b.idGame]&&(this.sessions[b.idGame].onGameData(b),b.idGame==this.currGameId&&this.sessions[b.idGame].fnGetKernel().markLastMove(!0,!0),this.sessions[b.idGame].fnOnMove&&this.sessions[b.idGame].fnOnMove(b.idGame),this.sessions[b.idGame].fnOnGameData&&this.sessions[b.idGame].fnOnGameData(b))};
    d.prototype.onSessionAction=function(b){var c=b.idGame;this.sessions[c]&&(this.sessions[c].onSessionAction(b),this.sessions[c].fnOnMove&&this.sessions[c].fnOnMove(c,b))};d.prototype.onRecentAnno=function(b){this.sessions[b]&&this.sessions[b].fnOnRecentAnno&&this.sessions[b].fnOnRecentAnno(b)};d.prototype.onSetClock=function(b,c){if(this.sessions[c])this.sessions[c].onSetClock(b)};d.prototype.getPgn=function(){var b="",c;for(c in this.kernels)this.kernels[c].game&&this.kernels[c].game.getMoves().length&&
    (b+=CB.PGNWriter.toPGN(this.kernels[c].game));return b};return d}();CB.Server.MarkedPosition=function(){var d=function(){this.pos={};this.flags=0};d.prototype.fromDataBuf=function(b){b.beginSizedRead();this.pos=new CB.Position;this.pos.read(b);var c=b.V10();this.pos.setMoveNum(c);this.flags=b.V10();b.endSizedRead()};return d}();"use strict";CB.namespace("CB.Server.LiveManager");
CB.LiveMsgId={NONE:0,START_KIBITZING:801,START_KIBITZING_GAMEID:802,REQUEST_LISTS:803,RESPOND_LISTS:804,ADD_GAME:805,RECENT_ANNO:806,FINISH_KIBITZING:807,FINISH_KIBITZING_GAMEID:808,REQUEST_MYMOVES_GAMES:809,RESPOND_MYMOVES_GAMES:810,LIVE_CHAT:820,REQUEST_CHAT_LOG:821,RESPOND_CHAT_LOG:822,RESPOND_GAMEDATA:17,SESSIONACTION:200,GAMESTATUS_CHANGE:400,SETCLOCK:21,toNumString:function(d){return"LiveMsgId="+d},toString:function(d){for(var b in this)if(this[b]==d)return b;return"Unknown LiveMsgId: "+d}};
CB.LiveError={NONE:0,toString:function(d){switch(d){default:return"Msg="+d;case NONE:return"None"}}};CB.LiveCmdIds={NONE:0,PING_SERVER:1E3,RECEIVING_MOVES:2E3,toNumString:function(d){return"LiveCmdId="+d}};
CB.Server.LiveManager=function(){var d=function(b){this.callBacks=b;this.commandHandlerId=V15.commands.registerCommandHandler(this);this.pingServerPeriodMS=2E4;this.markedPosns=[];this.waitingTimer=new CB.Timer};d.prototype.getName=function(){return"Live"};CB.inherit(d,CB.Server.Connector);d.prototype.createLobby=function(b,c,d,h,k){V15.panelMgr.showMessage(lm.CONNECTING);this.create(b,c,d,h,"")};d.prototype.onChangeLogin=function(){this.fireOnChangeLogin()};d.prototype.signalOnConnect=function(){};
    d.prototype.onSwitchConn=function(b){};d.prototype.requestLiveGames=function(b){};d.prototype.onIdReceived=function(b){var c=String.formatEx(lm.CONNECTED_TO_SERVER,this.getName());this.logIntoChat(c,"LogGreen","conn");V15.panelMgr.showMessage(c);this.boundLoginOk=!0;this.loginMode!=CB.LoginMode.GUEST?(b.strUserId&&(V15.Vf.userName=CB.strUtil.decodeUTF8(b.strUserId),this.user=CB.strUtil.decodeUTF8(b.strUserId),this.utf8User=b.strUserId,b.strToken&&(V15.Vf.loginToken=b.strToken,CB.DOM.setCookie("AccountMode",
        CB.LoginMode.NORMAL),V15.Vf.rememberLoginToken())),document.title="Live Chess For "+this.user,V15.setLoggedIn(!0)):(this.user="Guest"+this.getNId(),this.utf8User="Guest"+this.getNId());V15.idleFunc=this.onIdle.bind(this);V15.notIdleFunc=this.onIdle.bind(this);this.initGameKibitzing();this.initListKibitzing()};d.prototype.initGameKibitzing=function(){if(this.boundLoginOk&&this.sessions&&this.sessions.length){var b=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);b.setUserType(CB.LiveMsgId.START_KIBITZING);
        var c=b.getBuf();c.writeInt(this.sessions.length);for(var d=0;d<this.sessions.length;d++)this.requestDataToBuf(this.sessions[d].requestData,c),c.writeInt(this.sessions[d].ticket),c.V13(!1),c.V13(this.sessions[d].requestData.highestRoundOnly),this.requestDataToBuf2(this.sessions[d].requestData,c),this.sessions[d].requested=!0;b.address(this.getNId(),CB.ConnectId.SERVER);this.send(b)}};d.prototype.requestLiveLists=function(b){this.requestLists=b;this.liveGameLists=[];for(var c=0;c<b.length;c++){var d=
        new CB.Server.LiveGameList(this,b[c].ticket,b[c].requestData);this.liveGameLists.push(d)}this.initListKibitzing()};d.prototype.initListKibitzing=function(){if(this.boundLoginOk&&this.liveGameLists&&this.liveGameLists.length){var b=!1,c=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);c.setUserType(CB.LiveMsgId.REQUEST_LISTS);var d=c.getBuf();d.writeInt(this.liveGameLists.length);for(var h=0;h<this.liveGameLists.length;h++)if(this.liveGameLists[h].requestData.myMoves){this.requestMyMovesGames();b=!0;
        this.requestMyMoves();break}else this.requestDataToBuf(this.liveGameLists[h].requestData,d),d.writeInt(this.liveGameLists[h].ticket),d.V13(!1),d.V13(this.liveGameLists[h].requestData.highestRoundOnly),this.requestDataToBuf2(this.liveGameLists[h].requestData,d),this.liveGameLists[h].requested=!0;try{window.location?d.V5(window.location.hostname||""):d.V5("")}catch(k){}b||(c.address(this.getNId(),CB.ConnectId.SERVER),this.send(c))}};d.prototype.requestDataToBuf=function(b,c){c.V5(b.event||"");c.V5(b.round||
        "");c.V5(b.round2||"");c.V5(b.player||"");c.V5(b.white||"");c.V5(b.black||"");c.V5(b.date||"");c.writeInt(b.kibitzRank)};d.prototype.requestDataToBuf2=function(b,c){c.V5(b.team||"")};d.prototype.sendStartKibitzing=function(b,c){var d=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);d.setUserType(CB.LiveMsgId.START_KIBITZING_GAMEID);var e=d.getBuf();e.writeInt(b);e.writeInt(c);d.address(this.getNId(),CB.ConnectId.SERVER);this.send(d)};d.prototype.sendFinishKibitzing=function(b,c){var d=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);
        d.setUserType(CB.LiveMsgId.FINISH_KIBITZING_GAMEID);var e=d.getBuf();e.writeInt(b);e.writeInt(c);d.address(this.getNId(),CB.ConnectId.SERVER);this.send(d)};d.prototype.initKibitzingById=function(b,c,d,h,k,l,m){if(this.boundLoginOk){var e=this.getLiveGameList(c);e&&(e.addSession(b,h,l,m)&&this.sendStartKibitzing(b,c),e.onInitKibitzing(b,d,k))}};d.prototype.requestChatLog=function(b,c){var d=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);d.setUserType(CB.LiveMsgId.REQUEST_CHAT_LOG);var e=d.getBuf();
        e.writeInt(c);e.writeInt(b);d.address(this.getNId(),CB.ConnectId.SERVER);this.send(d)};d.prototype.setSessionToBackground=function(b,c){this.boundLoginOk&&(b=this.getLiveGameList(b))&&b.setSessionToBackground(c)};d.prototype.notifySessionSwap=function(b,c,d){this.boundLoginOk&&(b=this.getLiveGameList(b))&&b.notifySessionSwap(c,d)};d.prototype.requestMyMovesGames=function(){if(this.boundLoginOk&&this.liveGameLists&&this.liveGameLists.length){var b=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);b.setUserType(CB.LiveMsgId.REQUEST_MYMOVES_GAMES);
        var c=b.getBuf();c.V5(V15.Vf.userName);c.Vx(CB.System.getWindowsCodePage());b.address(this.getNId(),CB.ConnectId.SERVER);this.send(b)}};d.prototype.requestMyMoves=function(){V15.myMovesMgr?V15.myMovesMgr.isLoggedIn()?this.doRequestMyMoves():V15.myMovesMgr.fnOnIdReceived=this.doRequestMyMoves.bind(this):(new CB.Timer(function(){this.doRequestMyMoves()}.bind(this))).runOnce(2E3)};d.prototype.doRequestMyMoves=function(){V15.myMovesMgr?(console.log("doReqMM"),V15.myMovesMgr.loadMyMoves(CB.GetMovesType.WHITE,
        null),V15.myMovesMgr.loadMyMoves(CB.GetMovesType.BLACK,null)):console.log("doReqMM, no MMM")};d.prototype.getPgn=function(b){if(b=this.getLiveGameList(b))return b.getPgn()};var b=!1;d.prototype.onIdle=function(){V15.isIdle()!=b&&(this.updatePlayerStatus(),b=V15.isIdle())};d.prototype.updatePlayerStatus=function(){var b=0;if(this.hasIdReceived){var c=new CB.Server.ClientChange;b=this.detPlayerStatus().flags;c.setStatusChange(b);c.id=this.getNIdBound();var d=new CB.WebSockMessage(CB.SockMsgId.CLIENTDATACHANGE);
        c.Vz(d.getBuf());d.address(this.getNId(),CB.ConnectId.SERVER);this.send(d);this.fireOnClientChanges([c])}return b};d.prototype.detPlayerStatus=function(){var b=CB.Server.StatusEnum.KIBITZING;b=V15.isIdle()?b|CB.Server.StatusEnum.IDLE:b|CB.Server.StatusEnum.NOTIDLE;return new CB.Server.Status(b)};d.prototype.execCommand=function(b){if(!this.hasIdReceived&&b!=CB.CommandIds.LOGIN&&b!=CB.LiveCmdIds.PING_SERVER)return!1;try{switch(b){case CB.CommandIds.LOGIN:this.changeLogin();break;case CB.LiveCmdIds.PING_SERVER:this.pingServer(!0);
        break;case CB.CommandIds.TEST:this.test()}}catch(f){b=CB.LiveCmdIds.toNumString(b),CB.LogException(b,f)}};d.prototype.logIntoChat=function(b,c,d){};d.prototype.testYesNo=function(b){CB.LOG("YesNo="+b)};d.prototype.test=function(b){};d.prototype.test2=function(){this.logIntoChat("Stop Torture");this.torturer&&this.torturer.stop()};d.prototype.changeLogin=function(){V15.Vf&&V15.Vf.prepareLoginChange()&&V15.Vf.prepareLoginChange()};d.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b))try{switch(b.getType()){default:console.log("Unhandled: "+
        b.toString());break;case CB.SockMsgId.LIVE_USER:this.handleLiveUserMsg(b);break;case CB.SockMsgId.RECONNECT_OK:this.handleReconnectOk(b);break;case CB.SockMsgId.CHAT:this.handleChat(b)}}catch(f){b=CB.SockMsgId.toNumString(b.getType()),CB.LogException(b,f)}};d.prototype.handleChat=function(b){var c=new CB.ChatData;c.fromSocketsMsg(b);var d=b.getBuf().V10(),e=b.getBuf().V10(),k=new CB.GameHeader;k.compactFromDataBuf(b.getBuf());b=b.getBuf().V10();c.isToSession()||c.isToObservers()?V15.panelMgr.kibitzChatOut(c.strSender,
        k,c.strMsg,{idGame:e,ticket:d,mvInx:b},c.isAutomatic(),!0):V15.panelMgr.chatOut(c.toString())};d.prototype.handleChatLog=function(b){var c=[];b=b.getBuf();var d=b.V10();b.V10();for(var e=b.V10(),k=0;k<e;k++){b.beginSizedRead();var l={};l.sender=b.V6(200);l.txt=b.V6(1500);l.gameId=b.V10();l.hdr=new CB.GameHeader;l.hdr.compactFromDataBuf(b);l.mvInx=b.V10();l.autoChat=b.V14();l.txt.length&&c.push(l);b.endSizedRead()}V15.panelMgr.onChatLog(d,c)};d.prototype.sendChat=function(b,c,d){var e=new CB.ChatData;
        e.idReceiver=CB.ConnectId.SERVER;e.idSender=this.getNId();e.strMsg=d;e.strSender=b;e.nChannel=c;e.setToSession(!0);e.setToObservers(!0);e.eColName=14;b=e.Vc();b.setType(CB.SockMsgId.LIVE_USER);b.setUserType(CB.LiveMsgId.LIVE_CHAT);this.send(b)};d.prototype.displayForceLogOffMsg=function(b){this.callBacks.onForcedLogoff(b)};d.prototype.handleReconnectOk=function(b){V15.panelMgr.showPosText("Reconnected OK...");this.requestLists&&this.requestLiveLists(this.requestLists)};var c=0;d.prototype.handleLiveUserMsg=
        function(b){0<c&&CB.LogException("Reenter handleLiveUserMsg: ",c);c=b.getUserType();try{switch(b.getUserType()){default:CB.LOG("UserMsg="+CB.UserMsgId.toString(b.getUserType()));break;case CB.LiveMsgId.RESPOND_LISTS:this.handleRespondLists(b);break;case CB.LiveMsgId.RESPOND_MYMOVES_GAMES:this.handleRespondMyMovesGames(b);break;case CB.LiveMsgId.RESPOND_GAMEDATA:this.handleGameData(b);break;case CB.LiveMsgId.SESSIONACTION:this.handleSessionAction(b);break;case CB.LiveMsgId.SETCLOCK:this.handleSetClock(b);
            break;case CB.LiveMsgId.RECENT_ANNO:this.handleRecentAnno(b);break;case CB.LiveMsgId.LIVE_CHAT:this.handleChat(b);break;case CB.LiveMsgId.RESPOND_CHAT_LOG:this.handleChatLog(b)}}catch(f){b=CB.LiveMsgId.toNumString(b.getUserType()),CB.LogException(b,f)}c=0};d.prototype.requestGame=function(b){};d.prototype.handleGameData=function(b){var c=new CB.Server.GameData;c.fromDataBuf(b.getBuf());c.game.gotoIndex(c.game.getMoveIndex());var d=b.getBuf().V10();b.getBuf().V14()&&!V15.isPremium()&&console.log("Live: no premium");
        if(b=this.getLiveGameList(d))b.onGameData(c)};d.prototype.handleRespondLists=function(b){var c=b.getBuf();b=new CB.Server.GameItemList;b.fromDataBuf(c);c=c.readInt();if(c=this.getLiveGameList(c))c.onGameItemList(b)};d.prototype.handleRespondMyMovesGames=function(b){var c=b.getBuf();b=new CB.Server.GameItemList;b.fromDataBuf(c);c.beginSizedRead();var d=c.V10();this.markedPosns=[];for(var e=0;e<d;e++){var k=new CB.Server.MarkedPosition;k.fromDataBuf(c);this.markedPosns.push(k)}c.endSizedRead();c=c.readInt();
        if(!b.empty()&&(c=this.getLiveGameList(c)))c.onGameItemList(b)};d.prototype.findMyMarkedMove=function(b){if(0<this.markedPosns.length){this.markedPosns.find=function(b){for(var c=0;c<this.length;c++)if(this[c].pos.boardEquals(b.board))return this[c].pos.getMoveNum();return-1};for(b.gotoEnd();0<b.getMoveIndex();){var c=this.markedPosns.find(b.getCurPos());if(0<=c)return c;b.gotoPrev()}b.gotoEnd()}return 0};d.prototype.handleSessionAction=function(b){var c=new CB.SessionAction;c.fromDataBuf(b.getBuf());
        b=b.getBuf().V10();CB.LOG("SAction: "+b);if(b=this.getLiveGameList(b))b.onSessionAction(c)};d.prototype.handleRecentAnno=function(b){var c=b.getBuf().V10();b=b.getBuf().V10();if(c=this.getLiveGameList(c))c.onRecentAnno(b)};d.prototype.handleSetClock=function(b){var c=new CB.SetClockData;c.fromDataBuf(b.getBuf());var d=b.getBuf().V10();b=b.getBuf().V10();if(d=this.getLiveGameList(d))d.onSetClock(c,b)};d.prototype.getSession=function(b){};d.prototype.getLiveGameList=function(b){if(this.liveGameLists)for(var c=
        0;c<this.liveGameLists.length;c++)if(this.liveGameLists[c].ticket==b)return this.liveGameLists[c]};d.prototype.gameFromBuf=function(b){var c=new CB.Game,d=new CB.GameHeader;d.compactFromDataBuf(b);b.V10();c.readGameOnly2(b);c.setHeader(d);return c};d.prototype.onWait=function(){this.showBoardMsg(this.waitMsg|NaN)};d.prototype.showBoardMsg=function(b){V15.gameKernel.boardWin&&V15.gameKernel.boardWin.addMessage(b,!0)};d.prototype.setNoPremiumWarningGame=function(b){4<b.getMoves().length&&(b.gotoIndex(4),
        b.deleteRemaining(!0),b.getMoves()[3].setAnnoItem(CB.AnnoType.POSTTEXT,new CB.TextAnno("Sorry, this broadcast is Premium only. Please login in with your Premium Account. Thanks!")))};Ve.initForListeners(d);Ve.addEvent(d,"ChangeLogin");Ve.addEvent(d,"ClientChanges");return d}();
CB.LiveTorturer=function(){var d=function(b,c){this.wsUris=[b];this.liveLists=c;this.mustStop=!1;this.cntRobots=0;this.arrRobots=[];this.maxRobotsAllowed=30;0<=getInternetExplorerVersion()&&(this.maxRobotsAllowed=3)};d.prototype.run=function(){this.mustStop=!1;this.createTimer=new CB.Timer(function(){this.periodicCreate()}.bind(this));this.logOffTimer=new CB.Timer(function(){this.periodicLogOff()}.bind(this));this.createTimer.runPeriodic(500);this.logOffTimer.runPeriodic(350);this.guid=new CBGuid;
    this.guid.fromRandom();this.arrRobots=[]};d.prototype.stop=function(){this.mustStop=!0;this.createTimer.stop();this.logOffTimer.stop();for(var b=0;b<this.arrRobots.length;b++)0<this.arrRobots[b].connectId?(this.arrRobots[b].logOff(),this.arrRobots[b].conn.tryTimer.stop(),CB.LOG("LogOff on Stop")):(this.arrRobots[b].closeConn(),CB.LOG("Close on Stop"))};d.prototype.periodicCreate=function(){this.arrRobots.length<this.maxRobotsAllowed&&this.createRobot()&&CB.LOG("Created Robot, NTot="+this.arrRobots.length+
    ", logged in="+this.countLoggedIn(),"LogGreen")};d.prototype.periodicLogOff=function(){if(this.countLoggedIn()>this.maxRobotsAllowed/2||this.arrRobots.length==this.maxRobotsAllowed){var b=Math.floor(Math.random()*this.arrRobots.length);b<this.arrRobots.length&&(0<this.arrRobots[b].connectId?(this.arrRobots[b].logOff(),CB.LOG("Log Off: "+this.arrRobots[b].connectId,"LogBold")):this.arrRobots[b].isTimeout()&&this.arrRobots[b].closeConn(),this.arrRobots.splice(b,1))}};d.prototype.createRobot=function(){if(this.arrRobots.length<
    this.maxRobotsAllowed){var b=new CBGuid;b.fromRandom();80<Math.floor(100*Math.random())&&(b=this.guid);b=new CB.LiveConnectionRobot(this,b,this.liveLists);try{return b.logOn(),this.arrRobots.push(b),!0}catch(c){for(CB.LOG(c,"LogException");this.arrRobots.length;)this.arrRobots[0].isLoggedIn()?this.arrRobots[0].logOff():this.arrRobots[0].closeConn(),this.arrRobots.splice(0,1)}}};d.prototype.countLoggedIn=function(){for(var b=0,c=0;c<this.arrRobots.length;c+=1)0<this.arrRobots[c].connectId&&(b+=1);
    return b};return d}();
CB.LiveConnectionRobot=function(){var d=function(b,c,d){this.conn=new CB.Connection(this,b.wsUris);this.conn.tryTimer.stop();this.guid=c;this.liveLists=d};d.prototype.logOn=function(){this.hasIdReceived||(this.tick=new CB.Tick,this.conn.open())};d.prototype.isTimeout=function(){return this.tick&&2E4<this.tick.getExpiredMS()};d.prototype.logOff=function(){try{if(this.hasIdReceived){var b=new CB.WebSockMessage(CB.SockMsgId.LOGOFF);b.address(this.connectId,CB.ConnectId.SERVER);b.buf.Vx(0);this.conn.sendMessage(b,
    !0);this.conn.tryTimer.stop();delete this.tick}}catch(c){CB.LOG(c)}};d.prototype.idReceived=function(b){CB.LOG("idReceived: "+b.nId,"","conn");this.hasIdReceived=!0;this.Va=0;this.connectId=b.nId;delete this.tick;(new CB.Timer(function(){this.requestLiveLists(this.liveLists)}.bind(this))).runOnce(500)};d.prototype.onConnect=function(){CB.LOG("OnConnect");void 0===this.guid&&(this.guid=new CBGuid,this.guid.fromRandom());var b=new CB.LogonData("Guest","Guest",CB.LoginMode.GUEST,this.guid,"","robot");
    this.conn.sendMessage(b.Vc(!1),!0)};d.prototype.closeConn=function(){this.conn.close()};d.prototype.requestLiveLists=function(b){this.liveGameLists=[];for(var c=0;c<b.length;c++){var d=new CB.Server.LiveGameList(this,b[c].ticket,b[c].requestData);this.liveGameLists.push(d)}this.initListKibitzing()};d.prototype.initListKibitzing=function(){if(this.liveGameLists&&this.liveGameLists.length){var b=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);b.setUserType(CB.LiveMsgId.REQUEST_LISTS);var c=b.getBuf();
    c.writeInt(this.liveGameLists.length);for(var d=0;d<this.liveGameLists.length;d++)this.requestDataToBuf(this.liveGameLists[d].requestData,c),c.writeInt(this.liveGameLists[d].ticket),this.liveGameLists[d].requested=!0;b.address(this.getNId(),CB.ConnectId.SERVER);this.conn.sendMessage(b,!0)}};d.prototype.requestDataToBuf=function(b,c){c.V5(b.event||"");c.V5(b.round||"");c.V5(b.round2||"");c.V5(b.player||"");c.V5(b.white||"");c.V5(b.black||"");c.V5(b.date||"");c.writeInt(b.kibitzRank)};d.prototype.handleReceived=
    function(b){try{switch(b.getType()){case CB.SockMsgId.CHAT:this.handleChat(b);break;case CB.SockMsgId.RECONNECT_OK:CB.LOG("Reconnect OK","LogRed");break;case CB.SockMsgId.ALIVE:this.handleAreYouAlive();break;case CB.SockMsgId.DEFAULTGROUPS:this.idBound=b.getBuf().V10();this.boundLoginOk=!0;break;case CB.SockMsgId.LIVE_USER:switch(b.getUserType()){case CB.LiveMsgId.RESPOND_LISTS:this.handleRespondLists(b);break;case CB.LiveMsgId.RESPOND_GAMEDATA:this.handleGameData(b);break;case CB.LiveMsgId.SESSIONACTION:this.handleSessionAction(b)}}}catch(c){CB.LOG("Exception: "+
        c.toString(),"LogException")}};d.prototype.isLoggedIn=function(){return this.boundLoginOk&&this.conn&&this.conn.isConnected()};d.prototype.handleChat=function(b){var c=new CB.ChatData;c.fromSocketsMsg(b);V15.panelMgr.chatOut(c.toString())};d.prototype.handleAreYouAlive=function(){CB.LOG("Server -> Robot: AYAlive? boundLogin="+this.boundLoginOk);var b=new CB.WebSockMessage(CB.SockMsgId.IAMALIVE);b.address(this.connectId,CB.ConnectId.SERVER);this.conn.sendMessage(b,!0)};d.prototype.handleGameData=function(b){var c=
    new CB.Server.GameData;c.fromDataBuf(b.getBuf());c.game.gotoIndex(c.game.getMoveIndex());b=b.getBuf().V10();CB.LOG("Game: "+b,"","rob");if(b=this.getLiveGameList(b))b.onGameData(c)};d.prototype.handleRespondLists=function(b){var c=b.getBuf();b=new CB.Server.GameItemList;b.fromDataBuf(c);c=c.readInt();CB.LOG("List: "+b.games.length,"","rob");if(c=this.getLiveGameList(c))c.onGameItemList(b)};d.prototype.handleSessionAction=function(b){var c=new CB.SessionAction;c.fromDataBuf(b.getBuf());b=b.getBuf().V10();
    CB.LOG("SAction: "+b);this.getSession(b);if(b=this.getLiveGameList(b))b.onSessionAction(c)};d.prototype.getLiveGameList=function(b){if(this.liveGameLists)for(var c=0;c<this.liveGameLists.length;c++)if(this.liveGameLists[c].ticket==b)return this.liveGameLists[c]};d.prototype.sendChat=function(b){if(this.idBound){var c=new CB.ChatData;c.strMsg=b;c.setToIndividuals(!0);c.idSender=this.idBound;c.setReceivers(this.idBound);c.setAutomatic(!0);b=c.Vc();b.address(this.getNId(),this.getNId());this.conn.sendMessage(b,
    !0)}};d.prototype.getNId=function(){return this.conn.connectId};return d}();
CB.Tournament=function(){var d=function(){};d.prototype.title=null;d.prototype.arcKey=null;d.prototype.player=null;d.prototype.rounds=null;d.prototype.availbeRounds=null;d.prototype.type=null;d.Types={koTwo:"ko",ko:"k.o.",roundrobin:"tourn",swiss:"swiss",sheveninger:"shev",match:"mat",team:"team"};d.prototype.getPlayerById=function(b){return this.player.filter(function(c){if(c.id==b||c.otherIds&&c.otherIds.contains(parseInt(b)))return!0})[0]};d.prototype.distinctPlayerForRound=function(b){b=this.rounds[b-
1];for(var c=[],d,f=0;f<b.length;f++)d=b[f],0>c.indexOf(d.white)&&c.push(d.white),0>c.indexOf(d.black)&&c.push(d.black);return c.length};d.fromJson=function(b){return d.fromObject(JSON.parse(b))};d.fromObject=function(b){var c=new d;c.title=b.Tournaments[0].t.split("_").join(" ");c.arcKey=b.Tournaments[0].k;for(var e=[],f=function(b,c){b=(c.f+c.l).trim();for(c=0;c<e.length;c++){var d=e[c].lastName;var f=e[c].firstName;f=(f+d).trim();if(.2>CB.Levenshtein.getDistance(b,f,3,1,1)/Math.max(b.length,f.length))return e[c]}},
                                                                                                                                                                                                                                                                                                                             g=0;g<b.Players.length;g++){var h=b.Players[g],k=f(e,h);k?(k.otherIds=k.otherIds||[],k.otherIds.push(h.i)):e.push(new CB.TablePlayer(h.f,h.l,h.e,h.i))}c.player=e;f=b.Rounds;c.availbeRounds=f;var l=[],m=[];f.forEach(function(d,e,f){l.push([]);l[d-1]=[];m.push([]);m[d-1]=[];rp=[];for(e=0;e<b["R-"+d+":"].length;e++){f=b["R-"+d+":"][e].b;var g=b["R-"+d+":"][e].p.split(/-|=/),h=c.getPlayerById(g[0]),k=c.getPlayerById(g[1]);g=g[2];if(0>g||2<g)g=null;var p=new CB.Pairing(h,k,g);p.round=d;p.subround=f;g&&
l[d-1].push(p);m[d-1].push(p);p=g?g/2:null;var r=g?(2-g)/2:null;g&&(h.opponents.push(new CB.OpponentEntry(k,p,!0,d,f)),k.opponents.push(new CB.OpponentEntry(h,r,!1,d,f)))}}.bind(this));c.rounds=l;c.pairings=m;c.type=b.Tournaments[0].tt;c.strTB=b.Tournaments[0].tb;return c};d.PairingFromJson=function(b){return d.PairingFromObjecct(JSON.parse(b))};d.PairingfromObject=function(b){};return d}();
CB.TablePlayer=function(){var d=function(b,c,d,f,g){this.firstName=b;this.lastName=c;this.elo=d;this.id=f;this.team=g;this.valuation=new CB.Valuation;this.valuation.elo=this.elo;this.valuation.name=this.getPbServerUrl();this.valuation.info=$("<div>",{class:"playerImageContainer"}).append($("<div>",{class:"name"}).html(this.valuation.name));this.valuation.nation=$("<div>",{class:"flag"}).append($("<img>",{class:"flagImg",src:"https://pgn.chessbase.com/Common/Media/Flags/Flags64/United Nations.png"}));
    this.valuation.title=$("<div>",{class:"title"}).text("");this.opponents=[]};d.prototype.team=null;d.prototype.opponents=null;d.prototype.id=null;d.prototype.firstName=null;d.prototype.lastName=null;d.prototype.elo=null;d.prototype.valuation=null;d.prototype.getName=function(){return this.firstName?this.lastName+","+this.firstName:this.lastName};d.prototype.getDisplayeName=function(){return this.firstName&&this.firstName.length?this.lastName+","+this.firstName.substr(0,1):this.lastName};d.prototype.getFirstOpponentEntryForPlayer=
    function(b){return this.getAllOpponentEntriesForPlayer(b)[0]};d.prototype.getAllOpponentEntriesForPlayer=function(b){var c=this.opponents.filter(function(c){return c.opponent===b});return c=c||[]};d.prototype.distinctOpponentCount=function(){var b=[];this.opponents.forEach(function(c){0>b.indexOf(c.opponent)&&b.push(c.opponent)});return b.length};d.prototype.getPbServerUrl=function(){this.getName();var b=this.getDisplayeName(),c=$("<a>");c.attr("href",String.formatEx("//players.chessbase.com/player/{0}_{1}?elo={2}",
    this.lastName,this.firstName,this.valuation.elo));c.text(b);return c.prop("outerHTML")};return d}();CB.RankingOptions=function(){var d=function(b,c){this.tiebreakInfosArr=b;this.top=c};d.prototype.tiebreakInfosArr=null;d.prototype.top=1E4;return d}();
CB.OpponentEntry=function(){var d=function(b,c,d,f,g){this.opponent=b;this.scoredPoints=c;this.isWhite=d;this.round=f;this.board=g};d.prototype.board=null;d.prototype.opponent=null;d.prototype.scoredPoints=null;d.prototype.isWhite=null;d.prototype.round=null;return d}();CB.Pairing=function(){var d=function(b,c,d){this.white=b;this.black=c;this.result=d};d.prototype.white=null;d.prototype.black=null;d.prototype.result=null;return d}();
CB.TableResult=function(){var d=function(b){};d.prototype.result=null;return d}();CB.Round=function(){var d=function(b,c){this.roundNr=b;this.pairingsArr=c};d.prototype.roundNr=null;d.prototype.pairingsArr=null;return d}();
CB.TiebrakeInfo=function(){var d=function(b,c,d){this.propertyName=b;this.cutOffFront=this.streichWertungen=c;this.cutOffEnd=d};d.prototype.cutOffFront=null;d.prototype.cutOffEnd=null;d.prototype.propertyName=null;d.prototype.streichWertungen=null;d.Names={bhz:"Buchholz",dirEnc:"Direct encounter",snb:"Sonneborn-Berger",avgElo:"Average Elo",perf:"Performance",wins:"Wins",bl:"Games with black",prog:"Comulative",blwins:"Wins with black",bhzsum:"Sum of opponents buchholz",koya:"Koya"};d.arrFromString=
    function(b){if(!b)return[];var c=[],d=/[a-zA-Z]+/;b.split(",").forEach(function(b){var e=d.exec(b)[0],f=b.match(/^\d+|\d+\b|\d+(?=\w)/g);f=f?f.map(function(b){return+b}):[];var k=0,l=0;0<f.length&&(k=f[0]);1<f.length&&(l=f[1]);b.replace(e,"");c.push(new CB.TiebrakeInfo(e,k,l))});return c};return d}();
CB.Valuation=function(){var d=function(){};d.prototype.points=null;d.prototype.buchholz=null;d.prototype.sonnebornberger=null;d.prototype.wins=null;d.prototype.avgElo=null;d.prototype.eloPerff=null;d.prototype.direkterVergleich=0;return d}();
CB.TableMath=function(){var d={calc:function(b,e,f,g,h,k,l){return d.calcMethods[e](b,e,f||function(){return!0},g,h,k,l)},getOpponents:function(b,d,f){f=b.length-f;f=0>f?0:f;return b.sort(function(b,c){return c.opponent.valuation.points-b.opponent.valuation.points}).slice(d,f)},calculateEloPerf:function(c,e,f,g,h,k){k=0<=k?k:0;e=d.getOpponents(c.opponents.filter(f),h,k).filter(function(b){return null!=b.scoredPoints});c=CB.TableMath.avg(e,function(b){return b.opponent.valuation.elo});e=Math.round(CB.TableMath.sum(e,
        function(b){return b.scoredPoints})/e.length*100);return c+b.getDiff(e)},calculatePoints:function(b,d,f,g,h,k,l){return CB.TableMath.sum(b.opponents.filter(f),function(b){return 1==b.scoredPoints?l.win:.5==b.scoredPoints?l.draw:0==b.scoredPoints?l.loss:b.scoredPoints})},calculateBuchHolz:function(b,e,f,g,h,k){b=CB.TableMath.getOpponents(b.opponents.filter(f),h,k);return d.sum(b,CB.TableMath.buildGetPropertyFromOpEntryFunc("points"))},calculateSonnebornBerger:function(b,d,f,g,h,k){var c=0;CB.TableMath.getOpponents(b.opponents.filter(f),
        h,k).filter(f).forEach(function(b){c+=b.scoredPoints*b.opponent.valuation.points});return c},calculateWins:function(b,e,f,g,h,k){return d.getOpponents(b.opponents.filter(f),h,k).filter(function(b){return 1===b.scoredPoints}).length},calculateBlacks:function(b,e,f,g,h,k){return d.getOpponents(b.opponents.filter(f),h,k).filter(function(b){return!b.isWhite}).length},calculateAvgElo:function(b,e,f,g,h,k){b=d.getOpponents(b.opponents.filter(f),h,k);return d.avg(b,CB.TableMath.buildGetPropertyFromOpEntryFunc("elo"))},
    calculateDirectEncounter:function(b,e,f,g,h,k){var c=!0,m=b.opponents.filter(function(c){return c.opponent.valuation.points==b.valuation.points});if(0==m.length)return 0;m.map(function(b){return b.opponent}).forEach(function(b){opponentOps=b.opponents.filter(function(c){return c.opponent.valuation.points==b.valuation.points});opponentOps.length!=m.length&&(c=!1)});return c?d.sum(m,function(b){return b.scoredPoints}):0},calculateComulative:function(b,d,f,g,h,k){b=b.opponents.filter(f);d=0;for(f=1;f<=
    b.length;f++)d+=f*b[b.length-f];return d},calculateBlackWins:function(b,d,f,g,h,k){return b.opponents.filter(f).filter(function(b){return!b.isWhite}).filter(function(b){return 1==b.scoredPoints}).length},calculateBuchHolzSum:function(b,e,f,g,h,k){b=b.opponents.filter(f);b=d.getOpponents(b,h,k);b=b.filter(function(b){return null!=b.scoredPoints});b.forEach(function(b){b.opponent.valuation.bhz||(b.opponent.valuation.bhz=d.calculateBuchHolz(b.opponent,"bhz",f,g,h,k))});return d.sum(b,function(b){return parseFloat(b.opponent.valuation.bhz)})},
    calculateBuchHolzMinMax:function(b,e,f,g,h,k){return d.calculateBuchHolz(b,e,f,g,1,1)},calculateKoya:function(b,e,f,g,h,k){b=b.opponents.filter(function(b){return b.opponent.valuation.points>=b.opponent.opponents.length/2});return d.sum(b,function(b){return b.scoredPoints})},sum:function(b,d){var c=0;b.forEach(function(b){c+=d(b)});return c},avg:function(b,e){return d.sum(b,e)/b.length},buildGetPropertyFromOpEntryFunc:function(b){return function(c){return parseFloat(c.opponent.valuation[b])}},max:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   d){max=0;b.forEach(function(b){b=d(b);max=b>max?b:max});return max},min:function(b,d){min=0;b.forEach(function(b){b=d(b);min=b<min?b:min});return min}};d.calcMethods={points:d.calculatePoints,buchholz:d.calculateBuchHolz,sonnebornberger:d.calculateSonnebornBerger,wins:d.calculateWins,avgElo:d.calculateAvgElo,eloPerf:d.calculateEloPerf,direkterVergleich:d.calculateDirectEncounter,blacks:d.calculateBlacks,bl:d.calculateBlacks,bhz:d.calculateBuchHolz,snb:d.calculateSonnebornBerger,perf:d.calculateEloPerf,
    dirEnc:d.calculateDirectEncounter,prog:d.calculateComulative,blwins:d.calculateBlackWins,bhzsum:d.calculateBuchHolzSum,bhzminmax:d.calculateBuchHolzMinMax,koya:d.calculateKoya};var b={100:800,99:677,98:589,97:538,96:501,95:470,94:444,93:422,92:401,91:383,90:366,89:351,88:336,87:322,86:309,85:296,84:284,83:273,82:262,81:251,80:240,79:230,78:220,77:211,76:202,75:193,74:184,73:175,72:166,71:158,70:149,69:141,68:133,67:125,66:117,65:110,64:102,63:95,62:87,61:80,60:72,59:65,58:57,57:50,56:43,55:36,54:29,
    53:21,52:14,51:7,50:0,getDiff:function(b){return 50<b?this[b]:-this[100-b]}};return d}();
CB.ArrayToTableConverter=function(){var d=function(){};d.convertToHtmlTable=function(b){var c=$("<table>"),e=$("<thead>"),f=$("<tbody>"),g=CB.TableMath.max(b,function(b){return b.length});theadRow=$("<tr>");var h=0;b[0].forEach(function(b,c,d){var e=$("<th>");b.colspan&&b.str?(e.html(b.str),e.attr("colspan",b.colspan),h+=b.colspan):(e.html(b),h++);c===d.length-1&&e.attr("colspan",g-h);theadRow.append(e)});e.append(theadRow);for(var k=1;k<b.length;k++){var l=b[k],m=$("<tr>");l.forEach(function(b,c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  e){var f;d.isNumberField(b)&&(f="tdNumber");f=$("<td>",{class:f});f.html(b);c===e.length-1&&f.attr("colspan",g-c);m.append(f)});f.append(m)}c.append(e);c.append(f);return c};d.isNumberField=function(b){if(!b)return!1;if(b instanceof Number||"number"===typeof b||!isNaN(b)||b.charCodeAt&&189==b.charCodeAt(0)||b&&$(b).text&&(b=$(b).text(),b instanceof Number||"number"===typeof b||!isNaN(b)||189==b.charCodeAt(0)))return!0};return d}();CB.Comparer=CB.Comparer||{};
CB.Comparer.PlayerComparer=function(){var d=function(b){this.subComparer=_subComparer};d.prototype.subComparer=null;d.prototype.compare=function(b,c){};return d}();CB.Comparer=CB.Comparer||{};
CB.Comparer.HigherNumberComparer=function(){var d=function(b,c){this.subComparer=b;this.property=c};d.prototype.subComparer=null;d.prototype.property=null;d.prototype.compare=function(b,c){return b.valuation[this.property]===c.valuation[this.property]?this.subComparer?this.subComparer.compare(b,c):0:c.valuation[this.property]-b.valuation[this.property]};return d}();CB.Comparer=CB.Comparer||{};
CB.Comparer.Comparer=function(){var d=function(){this.comparer=[]};d.prototype.comparer=null;d.prototype.addComparer=function(b){this.comparer.push(b)};d.prototype.removeComparer=function(b){b=this.comparer.indexOf(b);return this.comparer.slice(b)};d.prototype.removeComparerByIndex=function(b){return this.comparer.slice(b,1)};d.prototype.compare=function(b,c){var d=0,f=this.comparer.length;do{var g=this.comparer[d].compare(b,c);d++}while(0==g&&d<f);return g};d.fromTiebrakeInfos=function(b){var c=
    new CB.Comparer.Comparer;c.addComparer(new CB.Comparer.HigherNumberComparer(null,"points"));b.forEach(function(b){c.addComparer(new CB.Comparer.HigherNumberComparer(null,b.propertyName))});return c};return d}();CB.Formatter=CB.Formatter||{};
CB.Formatter.KoFormatter=function(){var d=function(){};d.prototype.sortRounds=function(b){var c=b[b.length-1];c.sort(function(b,c){return Math.max(c.white.elo,c.black.valuation.elo)-Math.max(b.white.elo,b.black.valuation.elo)});var d=0,g=[];c.forEach(function(b){var c=b.white.elo>b.black.elo?b.white:b.black;b=b.white.elo>b.black.elo?b.black:b.white;g.contains(c)||(c.sortIndex=++d,g.push(c));g.contains(b)||(b.sortIndex=++d,g.push(b))});var h=1/3;for(c=b.length-2;0<=c;c--)b[c].forEach(function(b){var c=
    b.white.elo>b.black.elo?b.white:b.black;b=b.white.elo>b.black.elo?b.black:b.white;c.sortIndex&&b.sortIndex||(c.sortIndex?b.sortIndex=c.sortIndex+h:b.sortIndex?c.sortIndex=b.sortIndex-h:console.log("How?"))}),h/=3;b.forEach(function(b){b.sort(function(b,c){return Math.min(b.white.sortIndex,b.black.sortIndex)-Math.min(c.white.sortIndex,c.black.sortIndex)})})};d.prototype.toHtml=function(b,d,f,g){d=b.players;f=b.tournament.rounds;console.log(b);g=b.tournament.availbeRounds;this.sortRounds(f);for(var c=
    $("<div>",{class:"koContainer"}),e=$("<div>",{class:"koContent"}),l=0;l<g.length;l++){var m=g[l],p=$("<div>",{class:"koRound koRound-"+m});p.append(this.createRoundDiv(f[l],m,d,b));e.append(p)}c.append(e);return c};d.prototype.toHtmlOld=function(b,d,f,g){d=g.width;f=b.players;g=b.tournament.rounds;this.sortRounds(g);var c=b.tournament.availbeRounds,e=$("<div>",{class:"koContainer"}),l=$("<div>",{class:"koHead"});l.append(this.createHead(c,b));for(var m=$("<div>",{class:"koContent"}),p=0;p<c.length;p++){var r=
    c[p],t=$("<div>",{class:"koRound koRound-"+r});t.append(this.createRoundDiv(g[p],r,f,b));m.append(t)}e.append(l);e.append($("<div>",{class:"koContentContainer"}).append(m));520<=d?e.css("width",500):e.css("width","100%");return e};d.prototype.createHead=function(b,d){var c=$("<div>",{class:"arrowContainer"}),e=$("<div>",{class:"arrowLeftContainer arrowSideContainer"}),h=$("<img>",{src:"https://pgn.chessbase.com/Common/Media/Webimages/Arrow_left.png",class:"arrow arrowLeft"}),k=$("<div>",{class:"arrowRightContainer arrowSideContainer"}),
    l=$("<img>",{src:"https://pgn.chessbase.com/Common/Media/Webimages/Arrow_right.png",class:"arrow arrowRight"}),m=$("<div>",{class:"roundNrContainer"}),p=$("<div>",{class:"roundNr"});m.append(p);e.append(h);k.append(l);c.append(e);c.append(m);c.append(k);var r=function(b){document.getElementById("koRoundSheet"+b)||(b=$("<style>",{id:"koRoundSheet"+b}).html(".cbtable .koContainer .koRound-"+b+"{display:none}"),$(document.head).append(b))},t=function(b){document.head.removeChild(document.getElementById("koRoundSheet"+
    b))},w=function(b){e.next().children(".roundNr").text(b)};d.currentRoundIndex=d.currentRoundIndex||b.length-1;d.lastRoundIndex=d.lastRoundIndex||0;var q=d.currentRoundIndex,u=d.lastRoundIndex,y=b.length-1;for(d=0;d<b.length-1;d++)r(b[d]);w(b[b.length-1]);e.on("click",function(){0!=q&&(u=q,q--,w(b[q]),r(b[u]),t(b[q]),0==q&&e.children(".arrow").addClass("inactive"),q+1==y&&k.children(".arrow").removeClass("inactive"))});k.on("click",function(){q!=y&&(u=q,q++,w(b[q]),r(b[u]),t(b[q]),0==q-1&&e.children(".arrow").removeClass("inactive"),
q==y&&k.children(".arrow").addClass("inactive"))});q==y&&k.children(".arrow").addClass("inactive");0==q&&e.children(".arrow").addClass("inactive");return c};d.prototype.createRoundDiv=function(b,d,f,g){var c=$("<div>",{class:"koRoundDiv"}),e=[],l=0;f.forEach(function(b){l=Math.max(b.opponents.filter(function(b){return b.round==d}).length,l)});for(f=0;f<b.length;f++){var m=b[f],p=m.white,r=m.black;if(!e.contains(p)&&!e.contains(r)){e.push(p);e.push(r);m=$("<div>",{class:"koMatch"});if(p.sortIndex<
    r.sortIndex){var t=this.createPlayerLine(p,r,d,g,l);p=this.createPlayerLine(r,p,d,g,l)}else t=this.createPlayerLine(r,p,d,g,l),p=this.createPlayerLine(p,r,d,g,l);m.append(t);m.append(p);c.append(m)}}return c};var b=function(b,d){return b.round!=d.round?b.round-d.round:b.board-d.board};d.prototype.createPlayerLine=function(c,d,f,g,h){c.opponents.sort(b);d=$("<div>",{class:"playerLine"});d.append(this.createPlayerDiv(c));var e=[];c.opponents.filter(function(b){return b.round==f}).forEach(function(b){e.push(g.createGameLink(c,
    b))});for(var l=e.length;l<h;l++)e.push("-");h=g.getColoredResultsForPlayer(c,f);d.append(this.resultDiv(e,h));return d};d.prototype.createPlayerDiv=function(b){var c=$("<div>",{class:"playerDiv"});c.append($("<div>",{class:"title"}).html($(b.valuation.title.prop("outerHTML"))));c.append($(b.valuation.info.prop("outerHTML")));c.append($("<div>",{class:"rating"}).html(b.valuation.elo));c.append($("<div>",{class:"nation"}).html(b.valuation.nation.prop("outerHTML")));return c};d.prototype.toHtmlOld=
    function(b,d,f,g){var c=this.buildD2Array(b);f=b.tournament.rounds;g=[];for(var e,l=0;l<b.tournament.availbeRounds.length;l++){var m=[];var p=0;e=l;roundNr=b.tournament.availbeRounds[l];d=Math.pow(2,roundNr-1)-1;var r=2*d;p+=d;g.push(roundNr);f[roundNr-1].forEach(function(d,f,g){f=d.white;d=d.black;if(!(0<=m.indexOf(f))){m.push(f);m.push(d);var h=b.getResultsForPlayer(f,roundNr);g=b.getResultsForPlayer(d,roundNr);h=this.resultDiv(h);g=this.resultDiv(g);c[p++][e]=f.getPbServerUrl();c[p++][e]=h;c[p++][e]=
        g;c[p++][e]=d.getPbServerUrl();p+=r}}.bind(this))}c.unshift(g);d=CB.ArrayToTableConverter.convertToHtmlTable(c);d.addClass("cbko");return d};d.prototype.buildD2Array=function(b){var c=2*b.tournament.player.length+4;b=b.tournament.rounds.length;for(var d=[],g=0;g<c;g++){for(var h=[],k=0;k<b;k++)h.push("");d.push(h)}return d};d.prototype.toHtmlOld=function(b,d,f,g){g=b.players;var c=this.buildArray(b);d=b.tournament.rounds;f=[];g.forEach(function(b,c,d){b.kosortrank=c});for(var e=0;e<b.tournament.availbeRounds.length;e++){var l=
    [];var m=0;columnNr=e;var p=b.tournament.availbeRounds[e];g=Math.pow(2,p)-2;var r=2*g;m+=g;f.push(p);d[p-1].forEach(function(d,e,f){e=d.white;d=d.black;if(!(0<=l.indexOf(e))){l.push(e);l.push(d);var g=b.getResultsForPlayer(e,p);f=b.getResultsForPlayer(d,p);g=this.resultDiv(g);f=this.resultDiv(f);c[m++][columnNr]=e.getPbServerUrl();c[m++][columnNr]=g;c[m++][columnNr]=f;c[m++][columnNr]=d.getPbServerUrl();m+=r}}.bind(this))}c.shift(f);return CB.ArrayToTableConverter.convertToHtmlTable(c)};d.prototype.resultDiv=
    function(b,d){var c=$("<div>");c.addClass("resultsBox");for(var e=0;e<b.length;e++){var h=$("<div>");h.html(b[e]);h.addClass("innerResultsBox");e<d.length&&h.addClass(d[e].isWhite?"w":"b");c.append(h)}b=CB.TableMath.sum(d,function(b){return b.points});d=$("<div>");d.addClass("innerResultsBox");d.html(b);c.append(d);return $("<div>").append(c.clone()).html()};d.prototype.replaceHalf=function(b){return(b+"").split("0.5").join(".5").split(".5").join("&#189;")};d.prototype.getFunction=function(b){return b};
    d.prototype.buildArray=function(b){var c=2*Math.pow(2,b.tournament.rounds.length);b=b.tournament.rounds.length;for(var d=[],g=0;g<c;g++){for(var h=[],k=0;k<b;k++)h.push("");d.push(h)}return d};return d}();CB.Formatter=CB.Formatter||{};
CB.Formatter.RoundRobinFormatter=function(){var d=function(){},b=function(b,d){var c=$("<tfoot>"),e=$("<tr>");d=$("<td>",{class:"tbTd",colspan:d});d.text(b);e.append(d);c.append(e);return c};d.prototype.toHtml=function(c,d,f,g){var e=g.width,k=[],l=[];d.forEach(function(b){l.push(b.headerName)});if(450<e)for(var m=1;m<=c.players.length;m++)l.push($("<div>",{class:"crossResultHeader"}).html(m));0<f.tiebreakInfosArr.length&&l.push({str:"TB",colspan:1});l.push("Perf.");k.push(l);var p=1;c.players.forEach(function(b){var g=
    [];d.forEach(function(c){g.push($("<div>",{class:c.propertyName}).html(b.valuation[c.propertyName]).prop("outerHTML"))});450<e&&c.players.forEach(function(d){var e=$("<div>",{class:"crossResult"}),f=b.getAllOpponentEntriesForPlayer(d);p=Math.max(p,f.filter(function(b){return b.scoredPoints}).length);if(d===b)g.push('<div class="samePlayer"></div>');else if(0<f.length){var h=[];d="";4<f.length?d=CB.TableMath.sum(f,function(b){return b.scoredPoints}):(f.forEach(function(d){d=c.createGameLink(b,d);h.push(d)}),
    d=h.map(function(b){return b.prop("outerHTML")}).join(" "));e.html(d);g.push(e.prop("outerHTML"))}else g.push("")});0<f.tiebreakInfosArr.length&&g.push($("<div>",{class:"tb"}).text(b.valuation[f.tiebreakInfosArr[0].propertyName]));g.push($("<div>",{class:"perf"}).text(b.valuation.perf));k.push(g)});m=CB.ArrayToTableConverter.convertToHtmlTable(k);if(g.caption){g=$("<caption>");var r=String.formatEx('<a href="http://live.chessbase.com/replay/{0}/0?anno=false">{1}</a>',c.tournament.arcKey,c.tournament.title);
    g.html(r);m.prepend(g)}g=CB.TableMath.max(k,function(b){return b.length});r="TBs: "+f.tiebreakInfosArr.map(function(b){return CB.TiebrakeInfo.Names[b.propertyName]}).join(", ");m.append(b(r,g));m.addClass("cbroundrobin");m.addClass("games-"+p);m.attr("cellpadding","0");return m};return d}();CB.Formatter=CB.Formatter||{};
CB.Formatter.SwissFormatter=function(){var d=function(){};d.prototype.toHtml=function(b,c,d,f){var e=d.top||1E4;e=Math.min(e,b.players.length);var h=d.tiebreakInfosArr;d=b.players.slice(0,e);var k=[],l=[];c.forEach(function(b){l.push(b.headerName)});l.push({str:"TB",colspan:1});l.push("Perf.");k.push(l);d.forEach(function(b){var d=[];c.forEach(function(c){b.valuation[c.propertyName]instanceof jQuery?d.push($("<div>",{class:c.propertyName}).html($(b.valuation[c.propertyName].prop("outerHTML")))):d.push($("<div>",
    {class:c.propertyName}).html(b.valuation[c.propertyName]))});0<h.length&&d.push($("<div>",{class:"tb"}).html(b.valuation[h[0].propertyName]));d.push($("<div>",{class:"perf"}).text(b.valuation.perf));k.push(d)});d=CB.ArrayToTableConverter.convertToHtmlTable(k);f.caption&&(b=String.formatEx('<a href="http://live.chessbase.com/replay/{0}/0?anno=false">{1}</a>',b.tournament.arcKey,b.tournament.title),f=$("<caption>"),f.html(b),d.prepend(f));var m=CB.TableMath.max(k,function(b){return b.length});b=$("<tfoot>");
    f=h.map(function(b){return CB.TiebrakeInfo.Names[b.propertyName]}).join(", ");e=$("<tr>");m=$("<td>",{colspan:m});m.text("TBs: "+f);e.append(m);b.append(e);d.append(b);d.addClass("cbswiss");return d};d.prototype.toHtmlold=function(b,c,d,f){var e=d.top||1E4,h=d.tiebreakInfosArr;d=b.players;var k=$("<table>",{class:"simple_table"});f.caption&&(f=$("<caption>"),b=String.formatEx('<a href="http://live.chessbase.com/replay/{0}/0?anno=false">{0}</a>',b.tournament.title.split(" ").join("_")),f.html(b),k.append(f));
    b=$("<thead>");var l=$("<tbody>"),m=$("<tr>");c.forEach(function(b){var c=$("<th>");c.text(b.headerName);m.append(c)});f=$("<th>");f.text("Tiebrakers");f.attr("colspan",h.length);m.append(f);f=$("<tfoot>");f.text("TBs");b.append(m);k.append(b);k.append(f);var p=function(b,c){return function(d){var e=$("<td>");(b.valuation[d.propertyName]instanceof Number||"number"===typeof b.valuation[d.propertyName])&&e.addClass("tdNumber");e.html(b.valuation[d.propertyName]);c.append(e)}};d.filter(function(b){return b.valuation.rank<=
        e}).forEach(function(b){var d=$("<tr>");b=p(b,d);c.forEach(b);h.forEach(b);l.append(d)});k.append(l);return k};return d}();CB.Formatter=CB.Formatter||{};CB.Formatter.ITableFormatter=function(){var d=function(){};d.prototype.toHtml=function(b,c,d,f){};return d}();CB.TablePropertiesDeclarer=function(){var d=function(b,c){this.propertyName=b;this.headerName=c};d.prototype.propertyName=null;d.prototype.headerName=null;return d}();CB.Formatter=CB.Formatter||{};
CB.Formatter.MatchFormatter=function(){var d=function(){};d.prototype.toHtml=function(b,c,d,f){c=f.width||4E4;this.ranking=b;d=[];d.push([]);var e=b.players[0],h=b.players[1],k=e.valuation.nation||h.valuation.nation,l=e.valuation.title||h.valuation.title,m=e.valuation.elo||h.valuation.elo,p=f.withPic&&(e.valuation.picture||h.valuation.picture);d.push(this.formPlayerLine(e,450<c,k,l,m,p));d.push(this.formPlayerLine(h,450<c,k,l,m,p));c=CB.ArrayToTableConverter.convertToHtmlTable(d);f.caption&&(f=$("<caption>"),
    b=String.formatEx('<a href="http://live.chessbase.com/replay/{0}/0?anno=false">{1}</a>',b.tournament.arcKey,b.tournament.title),f.html(b),c.prepend(f));c.addClass("cbmatch");return c};d.prototype.formPlayerLine=function(b,c,d,f,g,h){var e=[];f&&e.push($("<div>",{class:"title"}).html(b.valuation.title));e.push($("<div>",{class:"name"}).html(b.getPbServerUrl()));h&&e.push($("<div>",{class:"picture"}).html(b.valuation.picture));d&&e.push($("<div>",{class:"nation"}).html(b.valuation.nation));g&&e.push($("<div>",
    {class:"elo"}).html(b.valuation.elo));d=b.opponents.sort(function(b,c){return b.round-c.round});c&&d.forEach(function(c){e.push($("<div>",{class:"crossResult"}).html(this.ranking.createGameLink(b,c)).prop("outerHTML"))}.bind(this));c=CB.TableMath.sum(d,function(b){return b.scoredPoints});e.push($("<div>",{class:"points"}).text(c).prop("outerHTML"));return e};return d}();CB.Formatter=CB.Formatter||{};
CB.Formatter.SheveningerFormatter=function(){var d=function(){};d.prototype.toHtml=function(b,c,d,f){d=this._getTeams(b);c=d[0];var e=d[1];d=function(b,c){return c.valuation.points-b.valuation.points};c.sort(d);e.sort(d);d=$("<table>",{class:"shev"});var h=$("<tbody>"),k=$("<tr>");k.append($("<td>"));var l=0;e.forEach(function(b){var c=$("<td>",{class:"shev-rotate"});this._getPlayerDiv(b);c.html(this._getPlayerDiv(b));b=b.getDisplayeName().length;l=Math.max(l,5*b+48);k.append(c)}.bind(this));h.append(k);
    c.forEach(function(c){var d=$("<tr>"),f=$("<td>");d.append(f);f.append(this._getPlayerDiv(c));e.forEach(function(e){c.getAllOpponentEntriesForPlayer(e).forEach(function(e){var f=$("<td>");f.html(b.createGameLink(c,e));d.append(f)})});h.append(d)}.bind(this));d.append(h);d.css("margin-top",Math.sqrt(Math.pow(l,2)));return d};d.prototype._getPlayerDiv=function(b){var c=$("<div>",{class:"outerPlayerDiv"}),d=$("<div>",{class:"playerDiv"});d.append(b.valuation.nation);d.append(b.valuation.title);d.append(b.getPbServerUrl());
    d.append(b.valuation.elo);c.append(d);return d};d.prototype._getTeams=function(b){var c=[],d=[],f=b.players[0];f.opponents.forEach(function(b){d.push(b.opponent)});c.push(f);var g=d,h=c;for(f=0;c.length+d.length<b.players.length&&5>f;)b.players.forEach(function(b){if(c.contains(b))g=c,h=d;else if(d.contains(b))g=d,h=c;else return;if(b.opponents.some(function(b){return g.contains(b.opponent)}))return!1;h.merge(b.opponents.map(function(b){return b.opponent}))}),f++;return[c,d]};return d}();
Array.prototype.contains||(Array.prototype.contains=function(d){return 0<=this.indexOf(d)});Array.prototype.merge||(Array.prototype.merge=function(d){d.forEach(function(b){this.contains(b)||this.push(b)}.bind(this))});
CB.Ranking=function(){var d=function(b,c,d,e,f){this.tournament=b;this.round=c;this.rankingOptions=d;this.formatOptions=e;this.players=this.tournament.player;this.tableOptions=f;this.pointMult={win:this.tableOptions.pointsWin,draw:this.tableOptions.pointsDraw,loss:this.tableOptions.pointsLoss};this.init()};d.prototype.tournament=null;d.prototype.round=null;d.prototype.rankingOptions=null;d.prototype.players=null;d.prototype.pointMult=null;d.prototype.tableOptions=null;d.prototype.htmlFormatter={swiss:new CB.Formatter.SwissFormatter,
    tourn:new CB.Formatter.RoundRobinFormatter,rapid:new CB.Formatter.SwissFormatter,ko:new CB.Formatter.KoFormatter,match:new CB.Formatter.MatchFormatter,shev:new CB.Formatter.SheveningerFormatter,getFormatter:function(b){return this[b]||this.swiss}};d.prototype.htmlFormatter[CB.Tournament.Types.swiss]=d.prototype.htmlFormatter.swiss;d.prototype.htmlFormatter[CB.Tournament.Types.roundrobin]=d.prototype.htmlFormatter.tourn;d.prototype.htmlFormatter[CB.Tournament.Types.ko]=d.prototype.htmlFormatter.ko;
    d.prototype.htmlFormatter[CB.Tournament.Types.match]=d.prototype.htmlFormatter.match;d.prototype.htmlFormatter[CB.Tournament.Types.sheveninger]=d.prototype.htmlFormatter.shev;d.prototype.htmlFormatter[CB.Tournament.Types.koTwo]=d.prototype.htmlFormatter.ko;d.prototype.htmlFormatter[CB.Tournament.Types.team]=d.prototype.htmlFormatter.swiss;d.connected=!1;d.lobby=null;var b=function(b){return!("bye"==b.lastName.toLowerCase()||"bye"==b.firstName.toLowerCase())},c=function(b,c,d,f){b=$("<div>",{class:"player-opponent-box"});
        var g=$("<div>",{class:"player-opponent-lines"});f.opponents.forEach(function(b,c){g.append(e(b));c!=f.opponents.length-1&&g.append($("<hr>",{class:"opponent-line-seperator"}))});b.append(g);return b},e=function(b){var c=b.round,d=b.opponent.imgSource,e=b.opponent.valuation.nation.html(),f=b.opponent.valuation.title.html();return String.f('<div class="opponent-line"><div class="opponent-line-round">{0}</div><div class="opponent-line-flag">{2}</div><div class ="opponent-line-title">{3}</div><div class="opponent-line-name">{4}</div><div class="opponent-line-elo">{5}</div><div class="opponent-line-color color-{6}"></div><div class="opponent-line-result">{7}</div></div>',
        c,d,e,f,b.opponent.valuation.name,b.opponent.valuation.elo,b.isWhite?"white":"black",.5==b.scoredPoints?"&#189;":b.scoredPoints)},f=function(b,c,d,e,f){oppFilterFunc=function(b){return 100<b.opponent.valuation.elo};b=CB.TableMath.calc(e,"avgElo",oppFilterFunc,null,0,0,0);b=Math.round(b);f=CB.TableMath.calc(e,"points",function(b){return!0},null,0,0,f);e=CB.TableMath.sum(e.opponents,function(b){return null!=b.scoredPoints});return String.f('<div class="player-avg-line"><div class ="player-avg-line-avgelo inline-block">&#216 {0}</div><div class ="player-avg-line-points inline-block">{1}/{2}</div></div>',
        b,f,e)};d.prototype.startGetPlayerFlag=function(b){var d=this,e,g,m,p,r,t,w,q,u,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==h.nextAddress)return e=[],g=function(b){var c=[];$(".cbtable tr, .cbpairing tr, .cbtable .playerDiv").each(function(d,e,f){$(e).find(".name a").each(function(d,f,g){$(f).text()==b.getDisplayeName()&&c.push({row:e,index:d})})});return c},m=function(b,c){var d=g(b);b.imgSource=c.pic?window.URL.createObjectURL(new Blob([new Uint8Array(c.pic)],{type:"img/png"})):
        "";d.forEach(function(d,e){e=d.row;var f=d.index,g=(new CB.Nation(c.player.m_NewCBPlayer.m_HighData.m_aNation)).getStrFlag();g=String.formatEx("https://pgn.chessbase.com/Common/Media/Flags/Flags{1}/{0}.png",g,64);$(e).find(".flagImg");$($(e).find(".flagImg")[f]).attr("src",g);b.valuation.nation.find(".flagImg").attr("src",g);e=d.row;d=d.index;f=CB.Title.getStr(c.player.m_NewCBPlayer.m_HighData.m_aTitle);$($(e).find(".title")[d]).text(f);b.valuation.title.text(f)})},p=d,r=function(b,d){g(b).forEach(function(e,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        g){g=e.row;e=e.index;var h=p.pointMult,k=$("<span>",{class:"player-info-container"});var q=b.imgSource;var l=b.valuation.nation.html(),u=b.valuation.title.html();q=String.formatEx('<div class="player-info-box"><div class="player-info-picture"><img src={0}></img></div><div class="player-info-personal"><div class="player-info-namerow"><div class="player-info-nation inline-block">{1}</div><div class ="player-info-title inline-block">{2}</div><div class ="player-info-name inline-block">{3}</div><div class ="player-info-elo inline-block">{4}</div></div></div></div>',
        q,l,u,b.valuation.name,b.valuation.elo);q=$(q);l=c(g,d,e,b);h=f(g,d,e,b,h);k.append(q);k.append($("<hr>",{class:"player-opponent-box-seperator"}));k.append(l);k.append($("<hr>",{class:"opponent-average-box-seperator"}));k.append(h);$($(g).find(".playerImageContainer")[e]).append(k);b.valuation.info.append(k.prop("outerHTML"))})},t=function(b){for(var c=0;c<q.length;c++)e.push({player:q[c],data:b[c]});for(c=0;c<e.length;c++)0!=e[c].data.found&&m(e[c].player,e[c].data);for(c=0;c<e.length;c++)0!=e[c].data.found&&
    r(e[c].player,e[c].data)},w=[],w=b,q=[],u=w.map(function(b){return V15.playerLobby.localPB.getPlayer(b.firstName,b.lastName,0,0)}),h.yield(Promise.all(u),2);y=h.yieldResult;e=y.filter(function(b){return b}).map(function(b,c){return{player:w[c],data:b.player}});q=y.map(function(b,c){return b?null:w[c]});q=q.filter(function(b){return b});V15.playerLobby.requestMultiPlayerInfo(q,t,!0);h.jumpToEnd()})};d.prototype.determinType=function(){return this._isKO()?CB.Tournament.Types.ko:this._isMatch()?CB.Tournament.Types.match:
        this._isScheveninger()?CB.Tournament.Types.sheveninger:this._isRoundRobin()?CB.Tournament.Types.roundrobin:CB.Tournament.Types.swiss};d.prototype.determinTypeSoft=function(){if(this._isMatch())return CB.Tournament.Types.match;if(this._isKO())return CB.Tournament.Types.ko;if(this._isRoundRobin())return CB.Tournament.Types.roundrobin;if(this._isTeamTourn()||this.tournament.type==CB.Tournament.Types.roundrobin&&20<this.tournament.player.length)return CB.Tournament.Types.team};d.prototype._isMatch=function(){return 2==
        this.players.length};d.prototype._isKO=function(){for(var b=this.tournament.availbeRounds.length,c=this.tournament.distinctPlayerForRound(this.tournament.availbeRounds[0]),d=!1,e=1;e<b&&4<c;e++){d=!0;var f=this.tournament.distinctPlayerForRound(this.tournament.availbeRounds[e]);c/=f;if(1.8>c||2.2<c)return!1;c=f}return d};d.prototype._isTeamTourn=function(){return this.players.all(function(b){return b.team})};d.prototype._isRoundRobin=function(){var b=this.players.length;if(this.tournament.rounds.length+
        1===b||12>=b)return!0};d.prototype._isScheveninger=function(){if(3>this.tournament.rounds.length)return!1;var b=[],c=[],d=this.players[0];d.opponents.forEach(function(b){c.push(b.opponent)});b.push(d);var e=!0,f=c,p=b;e=!0;for(d=0;b.length+c.length<this.players.length&&5>d;)this.players.forEach(function(d){b.contains(d)?(f=b,p=c):c.contains(d)?(f=c,p=b):e=!1;d.opponents.some(function(b){return f.contains(b.opponent)})&&(e=!1);p.merge(d.opponents.map(function(b){return b.opponent}))}.bind(this)),d++;
        return e&&b.length==c.length&&b.length<=this.players.length/2};d.prototype.init=function(){this.tournament.type=this.tournament.type?this.determinTypeSoft()||this.tournament.type:this.determinType();var c=0<this.round&&"0"!=this.round?function(b){return b.round<=this.round}.bind(this):function(b){return!0};this.players.forEach(function(b){b.allOpponents=b.opponents;b.opponents=b.opponents.filter(c)});this.players.forEach(function(b){b.valuation.points=CB.TableMath.calc(b,"points",c,this.players,0,
        0,this.pointMult);null!=b.valuation.points&&void 0!=b.valuation.points&&(b.valuation.points=b.valuation.points.toFixed(1));b.valuation.gCount=b.opponents.filter(function(b){return void 0!=b.scoredPoints}).length}.bind(this));this.rankingOptions.tiebreakInfosArr&&this.rankingOptions.tiebreakInfosArr.length||(this.tournament.type==CB.Tournament.Types.swiss?this.rankingOptions.tiebreakInfosArr=[{propertyName:"bhz",cutOffFront:0,cutOffEnd:0}]:this.tournament.type==CB.Tournament.Types.roundrobin&&(this.rankingOptions.tiebreakInfosArr=
        [{propertyName:"snb",cutOffFront:0,cutOffEnd:0}]));this.rankingOptions.tiebreakInfosArr.forEach(function(b){this.players.forEach(function(d){var e=CB.TableMath.calc(d,b.propertyName,c,this.players,b.cutOffFront,b.cutOffEnd);e=void 0!=e&&null!=e&&e.toFixed?e.toFixed(2):e;d.valuation[b.propertyName]=e}.bind(this))}.bind(this));this.players.forEach(function(b){b.valuation.perf=CB.TableMath.calc(b,"perf",function(){return!0},this.players,0,0).toFixed(0);b.valuation.perf=isNaN(b.valuation.perf)?0:b.valuation.perf}.bind(this));
        var d=CB.Comparer.Comparer.fromTiebrakeInfos(this.rankingOptions.tiebreakInfosArr);d.addComparer(new CB.Comparer.HigherNumberComparer(null,"elo"));this.players.sort(d.compare.bind(d));this.players=this.players.filter(b);for(var e=this.players[0].valuation.rank=1;e<this.players.length;e++)0===d.compare(this.players[e],this.players[e-1])?this.players[e].valuation.rank=this.players[e-1].valuation.rank:this.players[e].valuation.rank=e+1};d.prototype.createGameLink=function(b,c){var d=$("<a>");if(c.isWhite){b=
        b.lastName;var e=c.opponent.lastName}else e=b.lastName,b=c.opponent.lastName;b=String.formatEx("http://live.chessbase.com/replay/{2}/0/?w={0}&b={1}",b,e,this.tournament.arcKey.split(" ").join("_"));d.attr("href",b);null!=c.scoredPoints&&(c=c.scoredPoints.toString().split("0.5").join(".5").split(".5").join("&#189;"),d.html(c));return d};d.prototype.getResultsForPlayer=function(b,c){return b.opponents.filter(function(b){return b.round==c}).sort(function(b,c){return parseInt(b.board)-parseInt(c.board)}).map(function(b){return b.scoredPoints})};
    d.prototype.getColoredResultsForPlayer=function(b,c){return b.opponents.filter(function(b){return b.round==c}).sort(function(b,c){return parseInt(b.board)-parseInt(c.board)}).map(function(b){return{isWhite:b.isWhite,points:b.scoredPoints}})};d.prototype.toHtml=function(b){b||(b=1E5);var c=[];c.push(new CB.TablePropertiesDeclarer("rank","Rk."));CB.System.isMobile()||c.push(new CB.TablePropertiesDeclarer("title",""));c.push(new CB.TablePropertiesDeclarer("info","Name"));c.push(new CB.TablePropertiesDeclarer("elo",
        "Rtg."));CB.System.isMobile()||c.push(new CB.TablePropertiesDeclarer("nation","Nt."));c.push(new CB.TablePropertiesDeclarer("points","Pts."));c.push(new CB.TablePropertiesDeclarer("gCount","n"));this.formatOptions.width=b;return this.htmlFormatter.getFormatter(this.tournament.type).toHtml(this,c,this.rankingOptions,this.formatOptions)};d.prototype.calcPoints=function(b,c){return CB.TableMath.sum(b.allOpponents.filter(function(b){return!c||b.round<c}),function(b){return this.getPoints(b.scoredPoints)}.bind(this))};
    d.prototype.getPoints=function(b){return 1==b?this.pointMult.win:.5==b?this.pointMult.draw:0==b?this.pointMult.loss:b};Ve.initForListeners(d);Ve.addEvent(d,"Changed");return d}();
CB.Pairings=function(){var d=function(b){this.ranking=b;this.init()};d.prototype.ranking=null;d.prototype.init=function(){for(var b=function(b){return function(c,d){var e=c.white.valuation["points"+b]+c.black.valuation["points"+b]-(d.white.valuation["points"+b]+d.black.valuation["points"+b]);return 0!=e?-e:-(Math.max(c.white.valuation.elo,c.black.valuation.elo)-Math.max(d.white.valuation.elo,d.black.valuation.elo))}},c=this.ranking.tournament.pairings,d=[],f=0;f<c.length;f++)d.push(this.createPairingsRound(c[f],
    this.ranking.tournament.availbeRounds[f])),d[f].sort(b(this.ranking.tournament.availbeRounds[f]));this.pairings=d};d.prototype.createPairingsRound=function(b,c){var d=[];b.forEach(function(b){b.white.valuation["points"+c]=this.ranking.calcPoints(b.white,c);b.black.valuation["points"+c]=this.ranking.calcPoints(b.black,c);d.push(b)}.bind(this));d.roundNr=c;return d};d.prototype.RoundToHtml=function(b){var c=this.pairings[b-1];if(!c)return $("<div data-error='no pairings'>");var d=[];d.push(" Name Rtg. Nt. Pts.  Pts.  Name Rtg Nt.".split(" "));
    c=c.slice(0,this.ranking.tableOptions.top||1E4);c.forEach(function(c){var e=[],f=c.white,k=c.black;e.push(f.valuation.title);e.push(f.valuation.info);e.push(f.valuation.elo);e.push(f.valuation.nation);e.push($("<div>",{class:"points"}).html(this.FancyFraction(f.valuation["points"+b])));e.push(this.createResultLink(c,b));e.push($("<div>",{class:"points"}).html(this.FancyFraction(k.valuation["points"+b])));e.push(k.valuation.title);e.push($(k.valuation.info.prop("outerHTML")));e.push(k.valuation.elo);
        e.push(k.valuation.nation);d.push(e)}.bind(this));return CB.ArrayToTableConverter.convertToHtmlTable(d)};d.prototype.createResultLink=function(b,c){var d=b.result/2,f=1-d;null===b.result&&(d=f="&nbsp;");b=String.formatEx("http://live.chessbase.com/replay/{2}/{3}/?w={0}&b={1}",b.white.lastName,b.black.lastName,this.ranking.tournament.arcKey.split(" ").join("_"),c);return $("<a>").attr("href",b).html($("<div>",{class:"result"}).html(this.FancyFraction(d+"-"+f)))};d.prototype.FancyFraction=function(b){return b.toString().split("0.5").join(".5").split(".5").join("&#189;")};
    Ve.initForListeners(d);Ve.addEvent(d,"Changed");return d}();"use strict";
CB.PluginManager=function(){var d=function(){$(window).unbind("resize");$(window).on("resize",this.resize.bind(this));this.elementsThatNeedDestroy=[]};d.prototype.init=function(){this.is3D=!1;this.boardTimer=[];this.nActivePlugin=-1;this.instantiated=!1;this.hasPlugins=!0;this.prevWindowWidth=window.innerWidth;this.prevWindowHeight=window.innerHeight;this.socialMedia=!0;this.socialMediaUrl="https://share.chessbase.com/SharedGames"};d.prototype.calcIsVerticalLayout=function(){this.isVerti=1.15*window.innerWidth<
    window.innerHeight&&600>window.innerWidth};d.prototype.isVerticalScreen=function(){return 1.2*window.innerWidth<window.innerHeight};d.prototype.createDiv=function(b,d){var c=document.createElement("div");c.id=b;"undefined"!=typeof d&&(c.id+=d);c.className=b;return c};d.prototype.createEl=function(b,d,f){b=document.createElement(b);d&&(b.id=d+(f||0),b.className=d);return b};d.prototype.createUL=function(b,d,f){var c=document.createElement("ul");b&&(c.id=b+(d||0),c.className=b);f.forEach(function(b){var d=
    document.createElement("li");c.appendChild(d);$(d).text(b||0)});return c};d.prototype.createJQMenu=function(b,d,f,g,h,k){if(b){var c=0;f.forEach(function(b){b.length>c&&(c=b.length)});var e=this.createDiv(d,g),p=this.createEl("ul","ul"+d,g),r=9;CB.System.isMobile()&&(r=12);if(f.length){for(var t=0;t<f.length;t++){var w=this.createEl("li",d+"-item-"+t+"-",g);f[t]?$(w).html('<a href="#">'+f[t]+"</a>"):$(w).attr("type","separator");p.appendChild(w)}e.appendChild(p);$(b).append(e);t=$("#"+d+g);t.jqxMenu({autoOpenPopup:!1,
    mode:"popup",width:16+c*r,animationShowDuration:0,animationHideDuration:0,animationHideDelay:0,animationShowDelay:0,autoCloseInterval:0});t.on("itemclick",function(b){b=b.args.id.match(/[-][0-9]*[-]/);b=b[0].substring(1,b[0].length-1);h(b)});t.on("closed",function(){k&&k()})}t[0].dataset.itemcount=f.length;return t[0]}};d.prototype.togglePopup=function(b,d,f,g){if(f)return $(b).jqxMenu("close"),!1;var c=b.dataset.itemcount;f=$(window).scrollTop();var e=$(window).scrollLeft(),l=d.clientX-20;5>l&&(l=
    5);var m=0;CB.System.isMobile()&&(m=2);d=d.clientY-Math.max(60,30+(25+m)*c)+(g||0);$(b).jqxMenu("open",l+e,d+f);CB.System.isMobile()&&$(".jqx-item").css("font-size","18px");return!0};d.prototype._createCanvasParent=function(b){var c=new CB.CanvasParent(b);c.setSize(b.offsetWidth,b.offsetHeight);c.setVisible(!0);return c};CB.LOG=function(b,d,f){};var b=new CB.Vr;d.prototype.resize=function(c,d){this.prevWindowWidth||(this.prevWindowWidth=window.innerWidth);this.prevWindowHeight||(this.prevWindowHeight=
    window.innerHeight);((10<Math.abs(window.innerWidth-this.prevWindowWidth)||150<Math.abs(window.innerHeight-this.prevWindowHeight)||!CB.System.isMobile())&&(window.innerWidth!=this.prevWindowWidth||window.innerHeight-this.prevWindowHeight)||d)&&b.exec(function(){0<=this.maximized&&this.fnFullWindow(this.maximized);this.checkRecreateOrientation()||(this.resizePlugins(),this.prevWindowWidth=window.innerWidth,this.prevWindowHeight=window.innerHeight)}.bind(this),600)};d.prototype.resizePlugins=function(){var b=
    0;$(this.allPluginClasses).each(function(c,d){this.resizePlugin($(d),b);b++}.bind(this))};d.prototype.launchResizeBoard=function(b,d,f,g){this.boardTimer[b]&&this.boardTimer[b].stop();this.boardTimer[b]=new CB.Timer(function(){this.modules[b].boardArea&&this.resizeBoard(b,d,f)}.bind(this));this.boardTimer[b].runOnce(g)};d.prototype.resizeBoard=function(b,d,f){this.boardTimer[b]&&this.boardTimer[b].stop();this.modules[b].boardArea.setPosSize(0,0,d,f);this.modules[b].multiBoardCanvas&&this.modules[b].multiBoardCanvas.setPosSize(0,
    0,d,f)};d.prototype.isMobileLayout=function(){return this.isVerticalScreen()};d.prototype.checkRecreateOrientation=function(){this.currentMobileLayout!==this.isMobileLayout()&&(this.recycled=[],this.destroyBoardMessage(),$(this.allPluginClasses).each(function(b,d){this.recycled[b]={};this.recycled[b].boardArea=this.modules[b].boardArea;this.recycled[b].boardWin=this.modules[b].boardArea.canvas.control.boards[0];this.recycled[b].kernel=this.modules[b].getKernel();$(d).empty()}.bind(this)),this.init(),
    this.createPlugins(),this.onRecreate())};d.prototype.onRecreate=function(){};d.prototype.checkBoardAreaChange=function(b,d,f){if(this.modules[f].boardAreaW==b&&this.modules[f].boardAreaH==d)return!1;this.modules[f].boardAreaW=b;this.modules[f].boardAreaH=d;return!0};d.prototype.resizeActivePlugin=function(){this.resizePlugin($($(this.allPluginClasses)[this.nActivePlugin]),this.nActivePlugin)};d.prototype.isOnChessBaseCom=function(){return-1!=document.URL.search(/en.chessbase.com/i)||-1!=document.URL.search(/de.chessbase.com/i)||
    -1!=document.URL.search(/es.chessbase.com/i)};d.prototype.instantiateButtons=function(b,d,f,g,h,k){for(var c="",e=0;e<g.length;e++){if(g[e].title){var p=h;g[e].css&&(p+=" "+g[e].css);var r="";g[e].subtxt?r=String.f("<span class='btnSubText'>{0}</span>",g[e].subtxt):g[e].txt&&(r=g[e].txt);c+=String.f('<{6} title="{0}" id="{4}-btn{1}-{2}" class="{3}">{5}</{6}>',g[e].title,g[e].id,k,p,f,r,b)}else c+='<span class="toolBarSep"/>';this.buttonImages[k]&&(this.buttonImages[k][g[e].id]=g[e].id,g[e].pic&&(this.buttonImages[k][g[e].id]=
    g[e].pic))}$(d).html(c);for(e=0;e<g.length;e++)g[e].id&&(b=$(String.f("#{2}-btn{0}-{1}",g[e].id,k,f)),d=function(b,c){return function(d){this.nActivePlugin=c;g[b].handler(c,d);d.preventDefault()}}.call(this,e,k),function(b,c){return function(b){this.nActivePlugin=c;b.preventDefault()}}.call(this,e,k),b[0]&&(b[0].onclick=d))};d.prototype.setButtonImages=function(b,d,f,g,h,k,l){if(d)for(var c='url( "'+CB.getCommonPath()+'Media/Ribbons/{2}/{0}{1}.png" )',e=0;e<d.length;e++)if(d[e].id&&this.buttonImages[h]){var r=
    $(String.f("#{2}-btn{0}-{1}",d[e].id,h,b));r.css("background-image",String.f(c,this.buttonImages[h][d[e].id],f,k));l&&r.css("background-position",l);var t=g;d[e].css&&(t+=" "+d[e].css);r.attr("class",t)}};d.prototype.getKernel=function(){if("undefined"!=typeof this.nActivePlugin){if(this.modules[this.nActivePlugin]&&this.modules[this.nActivePlugin].getKernel())return this.modules[this.nActivePlugin].getKernel()}else if(this.modules[0])return this.modules[0].getKernel();return null};d.prototype.showPosText=
    function(b,d){};d.prototype.showMessage=function(b){this.showBoardMessage(b,2E3)};d.prototype.showBoardMessage=function(b,d){this.getKernel()&&this.getKernel().boardWin&&(this.getKernel().boardWin.addMessage(b,!0),d&&(new CB.Timer(function(){this.getKernel().boardWin.destroyMessage()}.bind(this))).runOnce(d))};d.prototype.create2DBoardArea=function(b){$("#boardArea"+b).empty();this.modules[b].boardArea=this._createCanvasParent(this.modules[b].panels.boardParent);this.modules[b].boardArea.setVisible(!0);
    this.resize();this.resizePlugins()};d.prototype.create3DBoardArea=function(b){$("#boardArea"+b).empty();this.modules[b].boardArea=this._createCanvasParent3D(this.modules[b].panels.boardParent,b);this.modules[b].boardArea.setVisible(!0);this.resize();this.resizePlugins()};d.prototype._createCanvasParent3D=function(b,d){var c=new CB.CanvasParent3D(b,"3d");c=c.createCanvas(this.on3DLoaded);this.board=new CB.BoardControl3D(c.canvas,100,100,"FritzBoard",this.on3DLoaded.bind(this),d);this.modules[d].board3d=
    this.board;c.setPosSize(b.offsetLeft,b.offsetTop,b.offsetWidth,b.offsetHeight);c.setVisible(!0);return c};d.prototype.on3DLoaded=function(b){this.modules[b].getKernel().setBoardWin(this.modules[b].board3d)};d.prototype.onControlReady=function(){};d.prototype.getBoardTopOffset=function(){return Math.min(30,window.innerHeight/35)};d.prototype.toggle3DBoard=function(b){CB.LogStats("Toggle3D");this.is3D?this.create2DBoardArea(b):this.create3DBoardArea(b);this.is3D=!this.is3D};d.prototype.getMultiBoardOptions=
    function(){return{topDist:0,bottomDist:0,marginDistDivisor:80,shiftXPercent:-1.7,minWForCoordinates:260,splitLayout:!0,suppressCalcGeometry:!0}};d.prototype.setAutoShowEngine=function(){};d.prototype.getSplitterWidth=function(){return CB.System.isMobile()?8:1800<screen.width?7:6};d.prototype.saveSplitSize=function(b,d){try{var c=$("#"+b+d);if(c.length){var e=$(c).jqxSplitter("panels");e&&e[0]&&V15.Vf.save(b+"size",e[0].size)}}catch(h){CB.LogException("RWM:saveSplitSize",h)}};d.prototype.loadSplitSize=
    function(b,d){b=V15.Vf.load(b+"size");return{size:parseFloat(b),coll:!1}};d.prototype.setSplitSize=function(b,d,f){$("#"+b+d).jqxSplitter({width:"100%",height:"100%",panels:[{size:f+"%"},{size:100-f+"%"}]})};d.prototype.createDiagramPlayingMode=function(b){return new CB.PlayingMode};d.prototype.useBackgroundFilter=function(){return!1};d.prototype.useMatBalanceDefault=function(){return!0};d.prototype.pgnLinkClickHandler=function(b,d,f){document.getElementById(d);V15.isPremium()||V15.forceGuestLogon()?
    (f=f(),d=CB.PGNWriter.toPGN(f),f=f.hdr.getStrPlayers(!1,0)+".pgn",window.Blob?(console.log("Blob DL: "+f),d=new Blob([d],{type:"text/plain;charset=utf-8"}),window.saveAs(d,f),b.preventDefault()):0<CB.System.getIEVersion()&&(window.clipboardData&&clipboardData.setData&&(alert("On Internet Explorer the game has been pasted to the clipboard ('Ctrl-V')"),clipboardData.setData("Text",d)),b.preventDefault()),CB.LogStats("PGN")):(alert("You need a Premium Account to download PGN files."),b.preventDefault())};
    d.prototype.isAnnoFieldVisible=function(){return this.annoField&&this.annoField.is(":visible")};d.prototype.openAnnoField=function(){this.addAnnoField()};d.prototype.closeAnnoField=function(){this.removeAnnoField()};d.prototype.isAnnoFieldOpen=function(){return this.isAnnoFieldVisible};d.prototype.toggleAnnoField=function(){this.isAnnoFieldVisible()?this.removeAnnoField():this.addAnnoField()};d.prototype.addAnnoField=function(){void 0===this.annoField?($("#annoEdit")[0]&&$("#annoEdit").remove(),this.annoField=
        CB.Fields.createTextField("annoEdit","","Enter text annotation",function(b,d){V15.gameKernel.onAnnoEnter(b,d)})):this.annoField.show();$(this.annoField).insertBefore("#notaToolbar0");$(this.annoField).focus()};d.prototype.removeAnnoField=function(){$(this.annoField).blur();$(this.annoField).hide();delete this.annoField};d.prototype.setAnnoFieldText=function(b){void 0!==this.annoField&&$(this.annoField).val(b)};d.prototype.fitsHorizontally=function(b,d){var c=$(document.body).width(),e=$("#"+b).outerWidth();
        b=$("#"+b)[0].getBoundingClientRect();return(b.x||b.left)+e+d<c};d.prototype.adaptRibbonButtons=function(b,d){if(0!=b.length){for(var c=0,e=$("td.ribbonTD:visible").last().find('div[role="button"]:visible');e&&!this.fitsHorizontally(e[0].id,d||24);){$("#"+b[c]).closest("td").hide();c++;if(c==b.length)break;e=$("td.ribbonTD:visible").last().find('div[role="button"]:visible')}0<c&&$(".ribbonSeparator").remove();CB.System.runsInIFrame()&&($("#idLoginStart").hide(),$("#idAccount").hide())}};d.prototype.createInfoPanel=
        function(b,d){if(!CB.System.isMobile()&&!CB.System.runsInIFrame()){this.infoPanel&&$("#"+this.infoPanel.id).remove();if(d||V15.isLoggedIn()||V15.config.isMVCPlugin){var c=450<window.innerHeight?28:20;d=this.getLoggedInHtml();var e="CBInfoLoggedIn flex-fixed";var h=this.getLoginInfoGradient()+";color:white;text-transform:uppercase;"}else d=this.getPleaseLoginHtml(),e="CBInfoNotLoggedIn flex-fixed",h="background-color:white;color:black;text-transform:none;";e=$("<div id='infoDiv' class='"+e+"'></div>");
            $(e).css({border:1,overflow:"auto"});c&&$(e).css("line-height",String(c)+"px");$(e).attr("style",$(e).attr("style")+h);$(e).html(d);$(b).prepend(e);this.infoPanel=$(e)[0];this.infoPanel.loggedIn=V15.isLoggedIn();this.infoPanel.setHeight=function(b){};return this.infoPanel}return null};d.prototype.createLanguageButton=function(b){V15.getAvailableLanguages()&&(b=b.concat([{id:"idLanguageOptions",buttons:[{id:"idSelectLanguage",text:lm.LANGUAGE,icon:"Language"}]}]));return b};d.prototype.openLanguageMenu=
        function(){var b=$("#idSelectLanguage").position(),d=$("#idSelectLanguage").height(),f=b.left+2;b=b.top+d+14;d=this.createLanguageMenu($("#idSelectLanguage")[0]);$(d).jqxMenu("open",f,b);$(d).jqxMenu({theme:"chessbase",width:150})};d.prototype.createLanguageMenu=function(b){for(var c=V15.getAvailableLanguages(),d=CB.Language.getNativeLangNames(c),g=CB.Language.getFlagNames(c),h=[],k=0;k<g.length;k++)h.push("<img style='float: left; margin-right: 5px;' src='"+this.getLanguageFlagIcon(g[k],16)+"' />"+
        d[k]);var l=[];for(k=0;k<g.length;k++)d={index:k,commandId:glSettings.getCommandIdOfLanguage(c[k])},l.push(d);return this.createJQMenu(b,"languagesMenu",h,0,function(b){var c=$.grep(l,function(c){return c.index===parseInt(b)})[0].commandId;glSettings.changeLanguage(c)},function(){})};d.prototype.openAccountMenu=function(){var b=$("#idAccount").position(),d=$("#idAccount").height(),f=b.left+2;b=b.top+d+14;d=this.createAccountMenu($("#idAccount")[0]);$(d).jqxMenu("open",f,b);$(d).jqxMenu({theme:"chessbase",
        width:150})};d.prototype.createAccountMenu=function(b){return this.createJQMenu(b,"accountMenu",[lm.ACCOUNT,lm.LOGOUT],0,function(b){switch(parseInt(b)){case 0:V15.panelMgr.openAccountPage();break;case 1:V15.panelMgr.logOut()}},function(){})};d.prototype.createAccountOptionsButton=function(b){return b=b.concat([{id:"idAccountOptions",buttons:[{id:"idLoginStart",text:lm.LOGIN,icon:"Key"},{id:"idAccount",text:lm.ACCOUNT,icon:"Account"}]}])};d.prototype.showAccountsForm=function(b,d,f){b=CB.DOM.getAccountNameCookie(!0);
        (new CB.AccountForm).createLoginForm(lm.LOGIN,function(b){V15.Vf.userName=b.idUser;V15.Vf.password=b.idPassword;V15.Vf.loginMode=CB.LoginMode.NORMAL;(new CB.AccountsManager(V15.shortAppName)).pwLogin(V15.Vf.userName,V15.Vf.password,V15.receiveTokenHandler.bind(V15))}.bind(this),function(b){f&&f()}.bind(this),b)};d.prototype.getLanguageFlagIcon=function(b,d){return V15.config.getFlagPath(d)+b+".png"};d.prototype.setAnnoEditCss=function(){var b=$("#notaToolbar0").position().top,d=$("#notaToolbar0 ").width();
        $("#annoEdit").css({top:String(b-24)+"px",width:String(d-10)+"px",height:"22px"})};d.prototype.getNotationToolBarItemsHtml=function(b,d){var c=[{id:"downloadPgnId",title:"Download PGN",imgSrc:"../../Common/Media/Ribbons/MyGames/Download16.png",clickHandler:function(b){V15.panelMgr.pgnLinkClickHandler(b,"downloadPgnId",function(){return V15.panelMgr.getKernel().game})}},{id:"btnFritzOnline",title:"Play out in Fritz Online",imgSrc:"../../Common/Media/Ribbons/MyGames/FritzOnline16.png",clickHandler:function(){V15.passToFritzOnline(V15.panelMgr.getKernel().game)}},
        {id:"btnTextBefore",title:lm.TEXT_BEFORE_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/Pretext16.png",clickHandler:function(){V15.gameKernel.execCommand(b.ADD_PRE_TEXT);V15.panelMgr.setAnnoEditCss()}},{id:"btnTextAfter",title:lm.TEXT_AFTER_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/Posttext16.png",clickHandler:function(){V15.gameKernel.execCommand(b.ADD_POST_TEXT);V15.panelMgr.setAnnoEditCss()}},{id:"btnStartLine",title:lm.START_LINE_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/StartLine16.png",clickHandler:function(){V15.gameKernel.execCommand(b.START_LINE)}},
        {id:"btnPromoteLine",title:lm.PROMOTE_LINE_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/PromoteLine16.png",clickHandler:function(){V15.gameKernel.execCommand(b.PROMOTE_LINE)}},{id:"btnDeleteLine",title:lm.DELETE_LINE_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/DeleteLine16.png",clickHandler:function(){V15.gameKernel.execCommand(b.DELETE_LINE)}},{id:"btnCutLine",title:lm.CUT_LINE_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/CutLine16.png",clickHandler:function(){V15.gameKernel.execCommand(b.CUT_LINE)}},
        {id:"btnMarkGood",title:"Good move",imgSrc:"../../DocuWeb/Images/Buttons/16/Good16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_GOOD)}},{id:"btnMarkBad",title:"Bad move",imgSrc:"../../DocuWeb/Images/Buttons/16/Bad16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_BAD)}},{id:"btnMarkVeryGood",title:"Very good move",imgSrc:"../../DocuWeb/Images/Buttons/16/VeryGood16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_VERYGOOD)}},{id:"btnMarkVeryBad",title:"Very bad move",
            imgSrc:"../../DocuWeb/Images/Buttons/16/VeryBad16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_VERYBAD)}},{id:"btnMarkInteresting",title:"Interesting move",imgSrc:"../../DocuWeb/Images/Buttons/16/Interesting16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_INTERESTING)}},{id:"btnMarkDubious",title:"Dubious move",imgSrc:"../../DocuWeb/Images/Buttons/16/Dubious16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_DUBIOUS)}},{id:"btnMarkMyMove",title:"Mark as My Move",
            imgSrc:"../../DocuWeb/Images/Buttons/16/MyMove16.png",clickHandler:function(){V15.markCurrentMove(V15.gameKernel,!1)}},{id:"btnMarkImportantMove",title:"Mark as Important Move",imgSrc:"../../DocuWeb/Images/Buttons/16/ImportantMove16.png",clickHandler:function(){V15.markCurrentMove(V15.gameKernel,!0)}},{id:"btnUnmarkMove",title:"Unmark current move",imgSrc:"../../DocuWeb/Images/Buttons/16/Erase16.png",clickHandler:function(){V15.unMarkCurrentMove(V15.gameKernel)}},{id:"btnWhiteSlightly",title:"White has a slight advantage",
            imgSrc:"../../DocuWeb/Images/Buttons/16/WhiteSlightly16.png",clickHandler:function(){V15.gameKernel.execCommand(b.WHITE_SLIGHTLY)}},{id:"btnEqual",title:"The position is equal",imgSrc:"../../DocuWeb/Images/Buttons/16/Equal16.png",clickHandler:function(){V15.gameKernel.execCommand(b.EQUAL)}},{id:"btnUnclear",title:"The position is unclear",imgSrc:"../../DocuWeb/Images/Buttons/16/Unclear16.png",clickHandler:function(){V15.gameKernel.execCommand(b.UNCLEAR)}},{id:"btnBlackSlightly",title:"Black has a slight advantage",
            imgSrc:"../../DocuWeb/Images/Buttons/16/BlackSlightly16.png",clickHandler:function(){V15.gameKernel.execCommand(b.BLACK_SLIGHTLY)}},{id:"btnWhiteBetter",title:"White is better",imgSrc:"../../DocuWeb/Images/Buttons/16/WhiteBetter16.png",clickHandler:function(){V15.gameKernel.execCommand(b.WHITE_BETTER)}},{id:"btnBlackBetter",title:"Black is better",imgSrc:"../../DocuWeb/Images/Buttons/16/BlackBetter16.png",clickHandler:function(){V15.gameKernel.execCommand(b.BLACK_BETTER)}},{id:"btnWhiteWins",title:"White is winning",
            imgSrc:"../../DocuWeb/Images/Buttons/16/WhiteWins16.png",clickHandler:function(){V15.gameKernel.execCommand(b.WHITE_WINS)}},{id:"btnBlackWins",title:"Black is winning",imgSrc:"../../DocuWeb/Images/Buttons/16/BlackWins16.png",clickHandler:function(){V15.gameKernel.execCommand(b.BLACK_WINS)}},{id:"btnCompensation",title:"Material compensation",imgSrc:"../../DocuWeb/Images/Buttons/16/Compensation16.png",clickHandler:function(){V15.gameKernel.execCommand(b.COMPENSATION)}}];this.addSocialMediaButtons(c,
        "../../DocuWeb/Images/Buttons/16/");var e=$(d).width()-60;this.showNotationToolbarItems(e,26,c,$(d))};d.prototype.addSocialMediaButtons=function(b,d){this.socialMedia&&(b.splice(0,0,{id:"btnShareGame",title:"Share game",imgSrc:d+"Social16.png",clickHandler:function(){$("#btnShareGame").attr("disabled",!0);V15.panelMgr.shareGame(V15.gameKernel.game);$("#btnShareGame").removeAttr("disabled")}}),b.splice(0,0,{id:"btnLikeGame",title:"Like game",imgSrc:d+"LikeNew16.png",clickHandler:function(){V15.isLoggedIn()?
            ($("#btnLikeGame").attr("disabled",!0),V15.panelMgr.likeGame(V15.gameKernel.game),$("#btnLikeGame").removeAttr("disabled")):V15.panelMgr.showAlert("You need to be logged in to like games.",350,130)}}))};d.prototype.shareGame=function(b){var c=this.socialMediaUrl+"/Share/",d=CB.PGNWriter.toPGN(b);b={gameText:encodeURIComponent(d),moveIndex:String(b.getMoveIndex())};$.ajax({url:c,method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(b),success:function(b){V15.panelMgr.showShareWindow(b.Url)},
        error:function(b,c,d){alert(d)}})};d.prototype.showShareWindow=function(b){var c=.9*$(window).width(),d=.9*$(window).height(),g=this.createDiv("divShareWindow",0);$(g).css({position:"fixed",left:"50%",top:"50%"});b="<div>   <div style='width: 100%; height: 100%;'>      <iframe style='border: 0;' width='100%' height='99%' src='"+(b+"'></iframe>   </div></div>");$(g).html(b);$(g).jqxWindow({title:"ChessBase - Share Game",width:c,height:d,resizable:!1,draggable:!1,isModal:!0,theme:V15.config.jqxTheme,
        modalOpacity:.3,showCloseButton:!0})};d.prototype.likeGame=function(b){var c=this.socialMediaUrl+"/Like/";b={userName:encodeURIComponent(V15.Vf.userName),gameText:encodeURIComponent(CB.PGNWriter.toPGN(b))};$.ajax({url:c,method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(b),success:function(b){V15.panelMgr.showAlert(b.Message,600,210)},error:function(b,c,d){alert(d)}})};d.prototype.showAlert=function(b,d,f){var c=this.createDiv("divAlert",0);$(c).css({position:"fixed",
        left:"50%",top:"50%"});b="<div style='text-align: center;'>   <div style='display: inline-block; word-break: break-word; padding: 10px;'>"+b+"      <br /><br /><button id='btnOK'>OK</button>   </div>";b+="</div>";$(c).html(b);$(c).jqxWindow({title:"Information",width:d,height:f,resizable:!1,draggable:!1,isModal:!0,modalOpacity:.3,showCloseButton:!1});$(c).find("#btnOK").jqxButton();$(c).find("#btnOK").click(function(){$(c).jqxWindow("close")})};d.prototype.showNotationToolbarItems=function(b,d,f,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       g){var c=Math.floor(b/d);1>c&&(c=1);c<f.length?c--:c>f.length&&(c=f.length);b="";for(d=0;d<c;d++)b+="<button title='"+f[d].title+"' id='"+f[d].id+"'><img src='"+f[d].imgSrc+"' /></button>";c<f.length&&(b+="<button title='More symbols' id='btnMore'><b>...</b></button>");$(g).html(b);for(d=0;d<c;d++)$(g).find("#"+f[d].id)[0].addEventListener("click",f[d].clickHandler,!1);c<f.length&&$(g).find("#btnMore").click(function(){var b=$(g).find("#btnMore")[0].getBoundingClientRect(),d=b.left-280;b=b.top-26*
        (f.length-c)-5;V15.panelMgr.showNotationToolbarItemsThatDoNotFit($(g).find("#btnMore"),d,b,f,c+1)})};d.prototype.showNotationToolbarItemsThatDoNotFit=function(b,d,f,g,h){var c=function(){$("#menuWrappernotationToolbarMenu0")[0]&&$("#menuWrappernotationToolbarMenu0").remove();for(var c=[],d=h-1;d<g.length;d++)c.push("<img style='float: left; margin-right: 5px;' src='"+g[d].imgSrc+"' />"+g[d].title);return V15.panelMgr.createJQMenu(b,"notationToolbarMenu",c,0,function(b){g[parseInt(b)+h-1].clickHandler()},
        function(){})}();$(c).jqxMenu("open",d,f);$(c).jqxMenu({theme:"chessbase",width:300})};d.prototype.showToolTip=function(b,d,f,g,h){if(b&&d){var c=$("#"+b);c.length&&(c.jqxTooltip({content:d,theme:V15.config.jqxTheme,position:g||"bottom",name:b}),f&&(c.jqxTooltip("open"),c.jqxTooltip("close",f)),h&&(new CB.Timer(function(){c.jqxTooltip("destroy")})).runOnce(h))}};d.prototype.destroyToolTip=function(b){$("#"+b).length&&$("#"+b).jqxTooltip("destroy")};d.prototype.createSwitchAppBar=function(b,d){var c=
        this.createDiv("switchBar",d);$(b).append(c);this._initSwitchToolBar(c,d)};d.prototype._initSwitchToolBar=function(b,d){var c=$('<div class="cbSwitchToolBar" id="switch-tb"></div>');$(b).append(c);var e=this;c=[];this.switchAppBtns=c=c.concat([{title:"Live Chess",id:"switch-Live",pic:"Live",subtxt:"Live Chess",handler:function(){e.redirectToLivePage()}},{title:"Tactics",id:"switch-Tactics",pic:"Tactics",subtxt:"Tactics",handler:function(){e.redirectTo("tactics")}},{title:"Videos",id:"switch-Videos",
        pic:"Videos",txt:"",subtxt:"Videos",handler:function(){e.redirectTo("videos")}},{title:"Fritz",id:"switch-Fritz",pic:"Fritz",subtxt:"Fritz",handler:function(){e.redirectTo("fritz")}},{title:"Database",id:"switch-Database",pic:"Database",subtxt:"Database",handler:function(){e.redirectTo("database")}},{title:"Openings",id:"switch-Openings",pic:"Openings",subtxt:"Openings",handler:function(){e.redirectTo("openings")}},{title:"My Own Games",id:"switch-Mygames",pic:"mygames",subtxt:"My Games",handler:function(){e.redirectTo("mygames")}},
        {title:"Chess Quiz",id:"switch-quiz",pic:"quiz",subtxt:"Quiz",handler:function(){e.redirectTo("quiz")}},{title:"Players",id:"switch-players",pic:"players",subtxt:"Players",handler:function(){e.redirectTo("players")}},{title:"News",id:"switch-news",pic:"news",subtxt:"News",handler:function(){e.redirectTo("en")}},{title:"Studies",id:"switch-studies",pic:"studies",subtxt:"Studies",handler:function(){e.redirectTo("studies")}}]);this.instantiateButtons("button",b,"a",c,"switchAppBtn",0);this.adaptSwitchAppButtons();
        this.setButtonImages("a",this.switchAppBtns,32,"switchAppBtn",d,"Switch","center 3px")};d.prototype.switchAppButtonfitsVertically=function(b,d){var c=$(document.body).height(),e=$("#"+b).outerHeight();return $("#"+b).position().top-c+e+d<c};d.prototype.adaptSwitchAppButtons=function(){function b(b){return b.id===f[g]}for(var d=["a-btnswitch-quiz-0","a-btnswitch-news-0"],f=["switch-quiz","switch-news"],g=0,h=$(".switchAppBtn").last();g<d.length&&!this.switchAppButtonfitsVertically(h[0].id,24);)$("#"+
        d[g]).hide(),this.switchAppBtns.splice(this.switchAppBtns.findIndex(b),1),g++,h=$(".switchAppBtn").last()};d.prototype.redirectToLoginPage=function(){window.location=this.getLoginPageUrl()};d.prototype.createLogDiv=function(b){this.logDiv=this.createEl("div","logDiv");$(b).append(this.logDiv);$(this.logDiv).html("<h1>CB.LOG( x )</h1>");CB.LOG=function(b,c,d){"Beefy"===d&&(b=$(String.f("<div class='cbLogLine {0}'>{1}</div>",c,b)),$(this.logDiv).append(b),b[0].scrollIntoView())}.bind(this)};d.prototype.getLoginPageUrl=
        function(){return CB.System.isCordova()||CB.System.isMobile()?"https://live.chessbase.com/LogonIos?returnurl="+encodeURIComponent(document.location):"https://live.chessbase.com/Logon?returnurl="+encodeURIComponent(document.location)};d.prototype.getCreateAccountUrl=function(){CB.System.isCordova()||CB.System.isMobile();return"https://live.chessbase.com/createAccount?returnurl="+encodeURIComponent(document.location)};d.prototype.redirectToLivePage=function(){CB.LogStats("Live");this.redirectTo("live")};
    d.prototype.openAccountPage=function(){window.open("https://account.chessbase.com/en/me")};d.prototype.openRegisterPage=function(){var b=this.getCreateAccountUrl();window.location.href=b};d.prototype.redirectTo=function(b,d){b=String.f("https://{0}.chessbase.com",b);d?window.open(b):window.location=b};d.prototype.setPgn=function(b,d){if(d){var c=new CB.Game;c.assign(CB.PGN.parseGame(d));b.getKernel().playFromPgnGame=c}};d.prototype.drawButtonHintArrow=function(b,d,f){this.drawOnFlashedCanvas(function(c){var e=
        $(b).offset().left,f=$(b).offset().top,g=$(b).width();CB.BoardArrow.drawFree(c,e-10,f+120,e+.4*g,f+20,9,"hsla( 130, 50%, 50%, 0.9 )");c.font="bold 30px Roboto";c.fillStyle="hsla( 120, 50%, 100%, 1.0 )";c.fillText(d,e+10,f+120)}.bind(this),f)};d.prototype.drawOnFlashedCanvas=function(b,d,f){var c=$(String.f("<canvas width={0}, height={1}>",window.innerWidth-10,window.innerHeight-10));$(document.body).append(c);$(c).css("zIndex",900);$(c).css("left",4);$(c).css("top",4);$(c).css("position","fixed");
        $(c).click(function(){c.remove()});b(c[0].getContext("2d"));(new CB.Timer(function(){c.remove()})).runOnce(d||2E3)};d.prototype.log=function(b){};d.prototype.logIntoChat=function(b,d){6};d.prototype.chatOut=function(){};d.prototype.handleCommonKeyDown=function(b){if("INPUT"==b.target.nodeName||"TEXTAREA"==b.target.nodeName)return!0;if(this.instantiated){var c=!0,d=this.modules[0].getKernel();switch(b.which){default:c=!1;break;case 37:d.Vk.mayNavigate()&&d.game.gotoPrev();break;case 39:d.Vk.mayNavigate()&&
    d.game.gotoNext();break;case 40:b.altKey&&(this.newGame?this.newGame():V15.execCommand(CB.CommandIds.NEW_GAME));break;case 66:b.ctrlKey&&d.boardWin&&d.boardWin.flipBoard();break;case 113:b.altKey&&(this.fnAnalysis?V15.panelMgr.studyMode&&V15.panelMgr.studyMode==CB.StudyMode.PLAYING||this.fnAnalysis():V15.execCommand(CB.CommandIds.TOGGLE_ANALYSIS_ENGINE));break;case 187:this.fnIncMultiVars&&!this.isMobileLayout()&&this.fnIncMultiVars(1);break;case 189:this.fnIncMultiVars&&!this.isMobileLayout()&&this.fnIncMultiVars(-1)}c&&
    b.preventDefault();return c}};return d}();"use strict";
CB.AccountsManager=function(){var d=function(b){if(!b)throw"Accountsmanager: App required";this.app=b||"playchess";this.server=V15.config.getAccountUris()[0];this.backupServer=V15.config.getAccountUris()[1]};d.prototype.getxmlRequest=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")};d.prototype.pwLogin=function(b,d,f,g){CB.LOG("AM, PWLogin:"+b+"/"+d,"","acc");if(b&&d){b=this.encodeAndBase64(b);var c=this.getCmdKey(b,"chk");this.doQuery({cmd:"chk",user:b,
    app:this.app,pass:this.encodeAndBase64(d),key:c},function(b){b&&f(b,g)})}else f({error:!0},g)};d.prototype.tokenHandler=function(b){};d.prototype.tokenLogin=function(b,d,f){CB.LOG("AM, TokenLogin:"+d);b=this.encodeAndBase64(b);var c=this.getCmdKey(b,"get");this.doQuery({cmd:"get",user:b,app:this.app,token:d,key:c},f)};d.prototype.changePassword=function(b,d,f,g,h){b=this.encodeAndBase64(b);var c=this.getCmdKey(b,"pw");this.doQuery({cmd:"pw",user:b,app:this.app,old:this.encodeAndBase64(d),"new":this.encodeAndBase64(f),
    token:g,key:c},h)};d.prototype.activateTrainer=function(b,d,f,g){var c=this.encodeAndBase64(d);c=this.getCmdKey(c,"activatecenapp");this.doQuery({cmd:"activatecenapp",guid:b,serial:d,productid:f,key:c,user:this.encodeAndBase64(d)},g)};d.prototype.activateTrainerSilent=function(b,d,f,g){var c=this.encodeAndBase64(d);c=this.getCmdKey(c,"activatecenapp");this.doQuery({cmd:"activatecenapp",guid:b,serial:"",productid:f,key:c,user:this.encodeAndBase64(d)},g)};d.prototype.deactivateTrainer=function(b,d,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     f){var c=this.encodeAndBase64(d);c=this.getCmdKey(c,"deactivatecenapp");this.doQuery({cmd:"deactivatecenapp",guid:b,serial:d,key:c,user:this.encodeAndBase64(d)},f)};d.prototype.getFriends=function(b,d,f,g){b=this.encodeAndBase64(b);var c=this.getCmdKey(b,"getfr");this.doQuery({cmd:"getfr",user:b,token:d,friendtype:f,key:c},g)};d.prototype.setFriends=function(b,d,f,g,h){for(var c="",e=0;e<g.length;e++)c+=g[e]+",";g=this.encodeAndBase64(c);b=this.encodeAndBase64(b);c=this.getCmdKey(b,"setfr");this.doQuery({cmd:"setfr",
    user:b,token:d,friendtype:f,friends:g,key:c},h)};var b;d.prototype.doQuery=function(c,d){CB.LOG("Accounts Query: "+c.cmd,"","acc");var e=[],g;for(g in c)e.push(encodeURIComponent(g)+"="+encodeURIComponent(c[g]));var h=e.join("&"),k=this.getxmlRequest();k.open("POST",this.server);k.setRequestHeader("Content-type","application/x-www-form-urlencoded");k.setRequestHeader("X-Requested-With","XMLHttpRequest");b=new CB.Timer(function(){k.abort();this.server!==this.backupServer?(this.server=this.backupServer,
    k.open("POST",this.backupServer),k.send(h)):d({timeout:!0})}.bind(this));b.runOnce(3E3);k.onload=function(){b.stop();if(4===k.readyState&&200===k.status){var c=k.responseText;d(c?JSON.parse(c):{})}else d({})};k.onerror=function(c){CB.LOG("Accounts Error: "+c.data);b.stop();this.server!=this.backupServer?(this.server=this.backupServer,k.open("POST",this.backupServer),k.send(h),console.log("Retry AccountServer")):d({error:!0})}.bind(this);k.send(h)};d.prototype.getCmdKey=function(b,d){0==b.Length&&
(b="nameCoded");var c=d+b;b=b.split("");d=d.split("");c=c.split("");for(var e=0,h=0,k=0;k<c.length;k++)0!=(k&1)&&e<d.length?(c[k]=d[e],e++):h<b.length&&(c[k]=b[b.length-h-1],h++);return this.encodeAndBase64(c.join(""))};d.prototype.encodeAndBase64=function(b){b=CB.strUtil.escapeHtmlEntities(b);return CB.strUtil.base64.encode(b)};return d}();"use strict";
CB.AccountForm=function(){var d=function(){};d.prototype.createLoginForm=function(b,c,d,f){(new CB.Form({id:"loginForm",title:b,width:320,height:230,modal:!0,okHandler:c,cancelHandler:d,fields:[{caption:"User:",type:"string",id:"idUser",val:f},{caption:"Password:",type:"password",id:"idPassword",val:""}],focusField:"idUser",accountButton:!0})).create()};return d}();"use strict";
CB.SerialForm=function(){var d=function(){};d.prototype.validator=function(b){$(b).jqxValidator({rules:[{input:"#idSerial0",message:"!",action:"keyup",rule:function(b,d){return 5===b.val().length?!0:!1}},{input:"#idSerial1",message:"",action:"keyup",rule:function(b,d){return 5===b.val().length?!0:!1}},{input:"#idSerial2",message:"",action:"keyup",rule:function(b,d){return 5===b.val().length?!0:!1}},{input:"#idSerial3",message:"",action:"keyup",rule:function(b,d){return 5===b.val().length?!0:!1}},
        {input:"#idSerial4",message:"!",action:"keyup",rule:function(b,d){return 5===b.val().length?!0:!1}}]})};d.prototype.createSerialForm=function(b,c,d,f){f="";if(window.clipboardData&&clipboardData.getData){var e=clipboardData.getData("Text");34<=e.length&&(f=e)}CB.System.isElectron()&&"undefined"!==typeof electronBridge&&(e=electronBridge.readFromClipboard().trim(),34<=e.length&&(f=e));(new CB.Form({id:"serialForm",title:b,width:680,height:200,modal:!0,okHandler:c,cancelHandler:d,fields:[{caption:lm.PRODUCT_KEY,
        type:"serial",id:"idSerial",val:f}],focusField:"idSerial0",accountButton:!1,pasteButton:!0})).create()};return d}();CB.ProgressForm=function(){var d=function(){};d.prototype.createProgressForm=function(b){b=new CB.Form({id:"serialForm",title:b,width:620,height:200,noButtons:!0,modal:!1,fields:[{caption:"Please Wait",type:"label"},{caption:"Progress",type:"progress",id:"idSerial",val:""}],accountButton:!1});b.create();this.progress=b.progressBar;this.label=b.label;this.nestDiv=b.nestDiv};return d}();
CB.FeedbackForm=function(){var d=function(){};d.prototype.createFeedbackForm=function(b,c,d){(new CB.Form({id:"feedbackForm",title:b+" (version:"+V15.versionCode.nMajor+"."+V15.versionCode.nMinor+")",width:620,height:400,modal:!0,okHandler:c,cancelHandler:d,fields:[{caption:lm.SUBJECT+":",type:"string",id:"idSubject"},{caption:lm.MESSAGE+":",type:"stringmultiline",id:"idMessage",rows:10,cols:60}],focusField:"idSubject",accountButton:!1})).create()};return d}();"use strict";"NOMINIFY=";
CB.GetMovesType={NONE:-1,ALL:0,WHITE:1,BLACK:2,GLOBAL_WHITE:3,GLOBAL_BLACK:4};CB.BlockUpdateMode={NOT_BLOCKED:0,BLOCKED:1,FORCE_UPDATE:2};
CB.CloudPanelMgrMixin=function(){function d(b,c){b.push([CB.strUtil.utf8ArrayToStr(c.title),c.nGames,c.cloudId,CB.strUtil.utf8ArrayToStr(c.owner)])}var b={openCloudDatabase:function(){V15.initCloudManager()},nMaxOnlineDBGames:2,selectCloudDatabase:function(b,c,g){if(!this.getIsFormOpen()){for(var e=[],f=[],l=CB.strUtil.encodeUTF8(b),m=0;m<c.size();m++)c.items[m].owner.toLowerCase()==l.toLowerCase()?d(e,c.items[m]):d(f,c.items[m]);c=[{name:"title",type:"string"},{name:"games",type:"int"},{name:"cloudId",
        type:"int"},{name:"owner",type:"string"}];l=[{header:"Title",dataIndex:"title",flex:2},{header:"Games",dataIndex:"games",flex:1},{header:"Owner",dataIndex:"owner",flex:2}];var p=-1;CB.Forms&&CB.Forms.selectCloudDB(b,e,f,c,l,function(b){b&&(p=b.cloudId);g(p)})}},blockLiveBookUpdates:function(b){this.getKernel().Vk.blockLiveBookUpdate(b)},loadGame:function(b){V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()||V15.pushGame(this.getKernel().game);this.getKernel().loadSearchResultGame(b)}},c=new CB.Vr;
    b.refreshOnlineDBGames=function(){this.dbGames&&this.dbGames.isVisible()&&(this.dbGames.setEmptyText("Searching..."),c.exec(function(){this.getKernel().Vk.searchOnlineDB()}.bind(this),500))};b.useMatBalanceDefault=function(){return 800<window.innerHeight};b.execCommand=function(b){try{switch(b){case V15.Vo.ONLINEDB_SEARCH:this.getKernel().Vk.search();break;case CB.CommandIds.TOGGLE_ANALYSIS_AUTO_ENGINE:this.toggleAutoShowEngine()&&this.getAutoEngPanel().setGame(this.getKernel().game);break;case V15.Vo.OPEN_CLOUDDATABASE:this.openCloudDatabase();
        break;case V15.Vo.LOGIN:V15.changeCloudLogin();break;case V15.Vo.SAVE_CLOUDDB:V15.saveToCloud(this.getKernel().game,0);break;case V15.Vo.REPLACE_CLOUDDB:V15.replaceInCloud(this.getKernel().game,0);break;case V15.Vo.SAVE_WHITE_REPERTOIRE:V15.saveToWhiteRepertoire(this.getKernel().game);break;case V15.Vo.SAVE_BLACK_REPERTOIRE:V15.saveToBlackRepertoire(this.getKernel().game);break;case V15.Vo.CREATE_CLOUDDB:V15.createCloudDB();break;case V15.Vo.DELETE_CLOUDDB:V15.deleteCloudDB();break;case V15.Vo.EDIT_HEADER:V15.editHeader(this.getKernel().game);
        break;case V15.Vo.LOAD_WHITE_MYMOVES:this.getKernel().boardWin.setBlackIsBottom(!1,!0);V15.loadMyMoves(CB.GetMovesType.WHITE,new CB.Game);break;case V15.Vo.LOAD_BLACK_MYMOVES:this.getKernel().boardWin.setBlackIsBottom(!0,!0);V15.loadMyMoves(CB.GetMovesType.BLACK,new CB.Game);break;case V15.Vo.MARK_CURRENT_MOVE:V15.markCurrentMove(this.getKernel(),!1);break;case V15.Vo.IMPORTANT_CURRENT_MOVE:V15.markCurrentMove(this.getKernel(),!0);break;case V15.Vo.UNMARK_CURRENT_MOVE:V15.unMarkCurrentMove(this.getKernel());
        break;case V15.Vo.UPLOAD_TO_MYMOVES:V15.uploadToMyMoves(this.getKernel())}}catch(f){b=V15.Vo.toNumString(b),CB.LogException(b,f)}};b.execNotaContextMenu=function(b){if(Ext&&Ext.create&&V15.myMovesMgr){CB.CSS.addIcon("MyMove16");CB.CSS.addIcon("ImportantMove16");var c=[{text:lm.MARK_MOVE,handler:function(){V15.markCurrentMove(V15.panelMgr.getKernel(),!1)},iconCls:"MyMove16"},{text:lm.MARK_IMPORTANT,iconCls:"ImportantMove16",handler:function(){V15.markCurrentMove(V15.panelMgr.getKernel(),!0)}}];if(V15.myMovesMgr&&
        V15.myMovesMgr.isMovesLoadedForAny())CB.CSS.addIcon("EraseMove16"),CB.CSS.addIcon("White16"),CB.CSS.addIcon("Black16"),CB.CSS.addIcon("Cutline16"),c=c.concat([{text:lm.UNMARK_MOVE,iconCls:"Erase16",handler:function(){V15.unMarkCurrentMove(V15.panelMgr.getKernel())}},"-",{text:lm.REMOVE_TREE_FROM_HERE,iconCls:"Cutline16",handler:function(){CB.Forms.Confirm(lm.DELETE_VARIATION_TREE,lm.REMOVE_ALL_MY_MOVES,function(b){"yes"!=b&&"ok"!=b||V15.removeWholeTreeFromCurrentMove(V15.panelMgr.getKernel())})}}]);
    else{var d=V15.Vo;c=c.concat(this.getMarkEvalItems("Good16 Bad16 VeryGood16 VeryBad16 Interesting16 Dubious16 WhiteWins16 WhiteBetter16 WhiteSlightly16 Equal16 Unclear16 BlackSlightly16 BlackBetter16 BlackWins16 Compensation16".split(" "),[d.MARK_GOOD,d.MARK_BAD,d.MARK_VERYGOOD,d.MARK_VERYBAD,d.MARK_INTERESTING,d.MARK_DUBIOUS,d.WHITE_WINS,d.WHITE_BETTER,d.WHITE_SLIGHTLY,d.EQUAL,d.UNCLEAR,d.BLACK_SLIGHTLY,d.BLACK_BETTER,d.BLACK_WINS,d.COMPENSATION],"Strong Move;Bad Move;Brilliant Move;Blunder;Interesting Move;Dubious Move;White Is Winning;White Is Better;White: Slight Advantage;Equal;Unclear;Black: Slight Advantage;Black Is Better;Black Is Winning;Compensation".split(";")))}Ext.create("Ext.menu.Menu",
        {items:c}).showAt([b.clientX,b.clientY])}};b.getMarkEvalItems=function(b,c,d){for(var e=[],f=0;f<b.length;f++)e.push({text:d[f],iconCls:b[f],handler:function(){var b=c[f];return function(){V15.commands.commandHandler(b)}}()});return e};b.getNotaElement=function(){var b=Ext.ComponentManager.get("idNotaPanel");if(b)return b.nota};b.shakeMarkButton=function(){CB.$(".MyMove32").addClass("shakeAnimation");CB.$(".MyMove24").addClass("shakeAnimation");CB.$(".iconMarkHelp").addClass("shakeAnimation")};b.stopShakeMarkButton=
        function(){CB.$(".MyMove32").removeClass("shakeAnimation");CB.$(".MyMove24").removeClass("shakeAnimation");CB.$(".iconMarkHelp").removeClass("shakeAnimation")};b.showMessage=function(b,c){this.getKernel()&&this.getKernel().boardWin&&(this.getKernel().boardWin.addMessage(b,!0),c&&(new CB.Timer(function(){this.getKernel().boardWin.destroyMessage()}.bind(this))).runOnce(c))};b.setLayoutMyMoves=function(b,c,d){if(this.notaElement)if(b){b=(c=c===CB.GetMovesType.BLACK||c===CB.GetMovesType.GLOBAL_BLACK)?
        "/common/media/ribbons/Black32.png":"/common/media/ribbons/White32.png";c=c?lm.BLACK:lm.WHITE;var e=lm.MY_MOVES_FOR+"  "+c;d&&(Array.isArray(d)&&1<d.length?(d[1]+=" - "+c,e=d):e=d+" - "+c);this.notaElement.notaHeaderElement.setTitleOnly(e,b)}else this.notaElement.notaHeaderElement.setTitleOnly("")};b.getNotationToolBarItems=function(b){return[CB.ToolButtons.downloadPGNBtn("PGN","Save16","Download Game Notation","downloadPgnId",function(){return V15.panelMgr.getKernel().game}),"-",CB.ToolButtons.smallBtn(lm.TEXT_AFTER,
        "Posttext16",b.ADD_POST_TEXT,lm.TEXT_AFTER_TIP),"-",CB.ToolButtons.smallBtn(lm.DELETE_LINE,"DeleteLine16",b.DELETE_LINE,lm.DELETE_LINE_TIP),CB.ToolButtons.smallBtn(lm.CUT_LINE,"CutLine16",b.CUT_LINE,lm.CUT_LINE_TIP),"-",CB.ToolButtons.smallBtn("","MyMove16",b.MARK_CURRENT_MOVE,"Mark as 'My Move'"),CB.ToolButtons.smallBtn("","ImportantMove16",b.IMPORTANT_CURRENT_MOVE,"Mark as Important Move"),CB.ToolButtons.smallBtn("","Erase16",b.UNMARK_CURRENT_MOVE,"Unmark current move"),"-",CB.ToolButtons.smallBtn("",
        "WhiteSlightly16",b.WHITE_SLIGHTLY,"White has a slight advantage"),CB.ToolButtons.smallBtn("","Equal16",b.EQUAL,"The position is equal"),CB.ToolButtons.smallBtn("","Unclear16",b.UNCLEAR,"The position ist unclear"),CB.ToolButtons.smallBtn("","BlackSlightly16",b.BLACK_SLIGHTLY,"Black has a slight advantage"),CB.ToolButtons.smallBtn("","WhiteBetter16",b.WHITE_BETTER,"White is better"),CB.ToolButtons.smallBtn("","BlackBetter16",b.BLACK_BETTER,"Black is better"),CB.ToolButtons.smallBtn("","WhiteWins16",
        b.WHITE_WINS,"White is winning"),CB.ToolButtons.smallBtn("","BlackWins16",b.BLACK_WINS,"Black is winning"),CB.ToolButtons.smallBtn("","Compensation16",b.COMPENSATION,"Material compensation"),"-",CB.ToolButtons.smallBtn("","InsertDiagram16",b.INSERT_DIAGRAM,lm.INSERT_DIAGRAM)]};return b}();
CB.CloudAppMixin=function(){function d(){CB.Forms.InputString("Name","New Database",function(b){b&&V15.cloudMgr&&V15.cloudMgr.createDatabase(b)}.bind(this))}function b(){V15.cloudMgr&&V15.cloudMgr.logOff();V15.myMovesMgr&&V15.myMovesMgr.logOff();V15.aTBLobby&&V15.aTBLobby.logOff();V15.logOffPlayerLobby();V15.logOffOnlineLobby();if(V15.panelMgr.getKernel())V15.panelMgr.getKernel().Vk.onBeforeUnload();V15.exitInstance();V15.myMovesMgr&&!V15.myMovesMgr.isMovesLoadedForAny()&&V15.saveGameToLocalStorage()}
    function c(){V15.cloudMgr&&V15.myMovesMgr&&!CB.System.runsInIFrame()&&(CB.System.isMobile()&&(V15.panelMgr.stopEngines&&V15.panelMgr.stopEngines(),V15.blurLogOffTimer&&V15.stop&&V15.stop(),V15.blurLogOffTimer=new CB.Timer(function(){V15.cloudMgr.logOff();V15.myMovesMgr.logOff()}),V15.blurLogOffTimer.runOnce(6E4)),V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()||V15.saveGameToLocalStorage())}function e(){V15.blurLogOffTimer&&V15.blurLogOffTimer.stop()}function f(){document.hidden?c():e()}return{initCloudManager:function(){if(void 0!==
            V15.cloudMgr)V15.cloudMgr.isLoggedIn()?V15.cloudMgr.requestDatabases():this.loginToCloud();else{var b=this.copyUserName();b&&V15.Vf.userName&&"guest"!==V15.Vf.userName?(V15.Vf.loginToken=b,this.createCloudManager(!0,null,b)):V15.Vf.hasUserAndPass()?this.createCloudManager(!0):CB.Forms&&CB.Forms.Login("ChessBase Game Cloud",V15.Vf,function(b){this.createCloudManager(b);this.createMyMovesManager(b)}.bind(this),function(){CB.ToolButtons.hideBusyMask()},{})}},initMyMovesManager:function(){if(void 0!==
            V15.myMovesMgr)V15.myMovesMgr.isLoggedIn()||this.loginToMyMoves();else{var b=this.copyUserName();b&&V15.Vf.userName&&"guest"!==V15.Vf.userName?(V15.Vf.loginToken=b,this.createMyMovesManager(!0,b)):V15.Vf.hasUserAndPass()&&this.createMyMovesManager(!0)}},copyUserName:function(){V15.Vf.userName||(V15.Vf.userName=CB.DOM.getAccountNameCookie(!0));V15.Vf.userName||(V15.Vf.userName=CB.DOM.getCodedCookie("AccountBackName64",!0));V15.Vf.loginMode=CB.LoginMode.NORMAL;return CB.DOM.getCookie("AccountToken")||
            V15.Vf.loginToken},createCloudManager:function(d,h,k){CB.DOM.setAccountNameCookie(V15.Vf.userName);V15.config.silentCloud||V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.showBusyMask(lm.CONNECTING);V15.cloudMgr=new CB.Server.CloudManager;V15.cloudMgr.onServerDown=this.onCloudServerDown.bind(this);V15.cloudMgr.onInvalidPassword=this.changeCloudLogin.bind(this);var g=V15.Vf.userName,m=CB.LoginMode.NORMAL;d||(g="Guest",m=CB.LoginMode.GUEST);V15.cloudMgr.createLobby(this.config.getCloudServerUris(),g,
            V15.Vf.password,m,k);this.windowEventsAdded||(this.windowEventsAdded=!0,window.addEventListener("beforeunload",b),V15.isExtJS||window.addEventListener("unload",b),window.addEventListener("blur",c),window.addEventListener("focus",e),window.addEventListener("visibilitychange",f));V15.cloudMgr.connect();V15.cloudMgr.setCallAfterDBSelected(h);V15.initCloudListeners(V15.cloudMgr);V15.panelMgr.getKernel()&&V15.panelMgr.getKernel().game.addOnResetGameListener(function(){if(V15.cloudMgr)V15.cloudMgr.onResetGame()})},
        createMyMovesManager:function(d,h){if(V15.myMovesMgr)d=V15.Vf.userName,g=CB.LoginMode.NORMAL,V15.myMovesMgr.createLobby(this.config.getMyMovesServerUris(),d,V15.Vf.password,g,h);else{CB.DOM.setAccountNameCookie(V15.Vf.userName);V15.myMovesMgr=new CB.Server.MyMovesManager;V15.myMovesMgr.onServerDown=this.onMyMovesServerDown.bind(this);d=V15.Vf.userName;var g=CB.LoginMode.NORMAL;h?(V15.myMovesMgr.isLoggedIn()&&V15.myMovesMgr.logOff(),V15.myMovesMgr.createLobby(this.config.getMyMovesServerUris(),d,V15.Vf.password,
            g,h)):V15.myMovesMgr.createLobby(this.config.getMyMovesServerUris(),"guest","",CB.LoginMode.GUEST,"");this.windowEventsAdded||(this.windowEventsAdded=!0,window.addEventListener("beforeunload",b),V15.isExtJS||window.addEventListener("unload",b),window.addEventListener("blur",c),window.addEventListener("focus",e),window.addEventListener("visibilitychange",f));V15.myMovesMgr.connect();V15.initMyMovesListeners(V15.myMovesMgr);V15.panelMgr.getKernel()&&(V15.panelMgr.getKernel().game.addOnResetGameListener(function(){if(V15.myMovesMgr)V15.myMovesMgr.onResetGame()}),
            V15.panelMgr.getKernel().game.addOnNotaDoubleClickListener(function(){V15.onNotaDoubleClick()}))}},connectCloudManager:function(b,c,d){CB.DOM.setAccountNameCookie(V15.Vf.userName);V15.config.silentCloud||V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.showBusyMask(lm.CONNECTING);var e=V15.Vf.userName,f=CB.LoginMode.NORMAL;b||(e="Guest",f=CB.LoginMode.GUEST);V15.cloudMgr.connectUser(e,V15.Vf.password,f,d);V15.cloudMgr.setCallAfterDBSelected(c)},connectMyMovesManager:function(b,c){CB.DOM.setAccountNameCookie(V15.Vf.userName);
            V15.myMovesMgr.connectUser(V15.Vf.userName,V15.Vf.password,CB.LoginMode.NORMAL,c)},initCloudListeners:function(b){},initMyMovesListeners:function(b){V15.panelMgr.tbBook&&V15.panelMgr.tbBook.initCloudListener(b);V15.panelMgr.getKernel()&&V15.panelMgr.getKernel().Vk.initMyMovesListener&&V15.panelMgr.getKernel().Vk.initMyMovesListener(b)},onCloudServerDown:function(){this.config.silentCloud||alert("Sorry, Cloud Server is currently in maintenance, please wait a few minutes.")},onMyMovesServerDown:function(){this.config.silentCloud||
        alert("Sorry, MyMoves Server is currently in maintenance, please wait a few minutes.")},onTokenLoginOk:function(){this.panelMgr.hasPlugins&&(this.initCloudManager(),this.initMyMovesManager())},onInvalidPassword:function(){},shouldRequestCloudDBsOnLogin:function(){return!1},loginToCloud:function(b){var c=CB.DOM.getCookie("AccountToken");if(c){var d=CB.DOM.getAccountNameCookie(!0);d&&(V15.Vf.userName=d);V15.Vf.loginMode=CB.LoginMode.NORMAL;V15.Vf.loginToken=c;void 0===V15.cloudMgr?this.createCloudManager(!0,
            b,c):this.connectCloudManager(!0,b,c)}else this.changeCloudLogin(b)},loginToMyMoves:function(){var b=CB.DOM.getCookie("AccountToken");if(b){var c=CB.DOM.getAccountNameCookie(!0);c&&(V15.Vf.userName=c);V15.Vf.loginMode=CB.LoginMode.NORMAL;V15.Vf.loginToken=b;void 0===V15.myMovesMgr?this.createMyMovesManager(!0,b):this.connectMyMovesManager(!0,b)}},changeCloudLogin:function(b){if(CB.Forms){var c=CB.DOM.getAccountNameCookie(!0);c||(c=CB.DOM.getCodedCookie("AccountBackName64",!0));c&&(V15.Vf.userName=
            c);CB.Forms.Login("ChessBase Game Cloud",V15.Vf,function(c){void 0===V15.cloudMgr?this.createCloudManager(c,b):this.connectCloudManager(c,b)}.bind(this),function(){CB.ToolButtons.hideBusyMask()},{guestBtn:!1,createBtn:!0,forgotBtn:!0})}},saveToCloud:function(b){var c=function(){CB.Forms.editGameHeader(b.hdr,function(){b.fireOnHeaderChanged();V15.cloudMgr.saveGame(b)}.bind(this))}.bind(this);void 0===V15.cloudMgr||V15.cloudMgr.isGuest()?V15.loginToCloud(c):c()},replaceInCloud:function(b){var c=function(){CB.Forms.editGameHeader(b.hdr,
            function(){b.fireOnHeaderChanged();V15.cloudMgr.replaceGame(b)}.bind(this))}.bind(this);void 0===V15.cloudMgr||V15.cloudMgr.isGuest()?V15.loginToCloud(c):c()},editHeader:function(b){CB.Forms.editGameHeader(b.hdr,function(){b.fireOnHeaderChanged();V15.cloudMgr.canReplaceGame(b)&&V15.cloudMgr.replaceGame(b)})},saveToWhiteRepertoire:function(b){alert("NOTIMPL")},saveToBlackRepertoire:function(b){alert("NOTIMPL")},createCloudDB:function(){void 0===V15.cloudMgr||V15.cloudMgr.isGuest()?this.loginToCloud():
            d.bind(this)()},deleteCloudDB:function(){void 0===V15.cloudMgr||V15.cloudMgr.isGuest()?this.loginToCloud():V15.cloudMgr.deleteDatabase()},setLoggedIn:function(b){b?this.isPlugin()||(document.title=this.appTitle+" - "+V15.Vf.userName):(V15.cloudMgr&&V15.cloudMgr.isLoggedIn()&&(V15.cloudMgr.logOff(),delete V15.cloudMgr),V15.myMovesMgr&&V15.myMovesMgr.isLoggedIn()&&(V15.myMovesMgr.isMovesLoadedForAny()&&V15.panelMgr.getKernel().newGame(),V15.myMovesMgr.logOff(),delete V15.myMovesMgr),this.panelMgr.showDatabase&&
        this.panelMgr.showDatabase(null),this.isPlugin()||(document.title=this.appTitle+" - not logged in"),this.loginPending=!1);this.superClass.setLoggedIn.apply(this,arguments)},loadMyMoves:function(b,c){V15.checkMyMovesLoggedIn()&&V15.panelMgr.getKernel().Vk.mayLoadGames()&&(V15.myMovesMgr.isMovesLoadedForAny()||V15.pushGame(V15.panelMgr.getKernel().game),V15.panelMgr.getKernel().Vk.shouldRefreshOnlineDB=!0,V15.myMovesMgr.loadCurrentMyMoves(b,c),V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.NOT_BLOCKED))},
        gameStack:[],pushGame:function(b){var c=new CB.Game;c.assign(b);this.gameStack.push(c)},restorePrevGame:function(){if(this.gameStack.length){var b=this.gameStack.pop();V15.panelMgr.getKernel().Vk.getFnLoadSearchResult().call(V15.panelMgr.getKernel(),b)}},removeWholeTreeFromCurrentMove:function(b,c){if(V15.checkMyMovesLoggedIn()&&b.game.getMoveOffs()<=b.game.getCurLine().length){var d=new CB.Game,e=b.game.getMoveOffs();c&&(e=b.game.getLineStartMoveNo());for(c=0;c<e;c++)d.makeMove(b.game.getCurLine()[c]);
            if(b=b.game.getCurLine()[c])b=new CB.Move(b.from,b.to,b.prom),V15.myMovesMgr.removeWholeTree(d.getCurPos(),b,V15.myMovesMgr.myMovesLoadMode),d.gotoPrev()}},markCurrentMove:function(b,c){V15.panelMgr.stopShakeMarkButton();c=c||!1;if(V15.checkMyMovesLoggedIn()&&b.game.getMoveOffs()<=b.game.getCurLine().length&&this.checkMyMovesLoadedForOtherSide(!b.getCurPos().getBTM())){b.game.deleteAnno(CB.AnnoType.SYMBOL);c?b.addSymbol(CB.AnnoMarkType.IMPORTANT):b.addSymbol(CB.AnnoMarkType.MYMOVE);var d=this.cloneGameToCurPos(b.game);
            V15.myMovesMgr.storePosAndMoves(d,c?3:2);d=new CB.NotationGenerator;var e=b.game.getLastMove();if(e){var f=b.getCurPos().getMoveNum();d=d.getMoveNota(e,f);e=d+" "+lm.MARKED;c&&(e=d+" "+lm.MARKED_IMPORANT);b.boardWin.addMessage(e,!0);(new CB.Timer(function(){b.boardWin.destroyMessage()})).runOnce(2E3);V15.myMovesMgr.isMovesLoadedFor(!b.getCurPos().getBTM())&&(d=this.cloneGameToCurPos(b.game,2),V15.myMovesMgr.loadMyMoves(V15.myMovesMgr.myMovesLoadMode,d))}}},checkMyMovesLoadedForOtherSide:function(b){if(0===
            this.panelMgr.getKernel().game.getMoveNo())V15.panelMgr.showMessage(lm.ENTER_OR_CLICK_MOVE_AND_MARK,5E3);else{switch(V15.myMovesMgr.myMovesLoadMode){default:case CB.GetMovesType.ALL:b=!0;break;case CB.GetMovesType.BLACK:var c=lm.CAUTION_YOU_ARE_EDITING_MOVES_FOR+" "+lm.BLACK+".";break;case CB.GetMovesType.WHITE:b=!b,c=lm.CAUTION_YOU_ARE_EDITING_MOVES_FOR+" "+lm.WHITE+"."}b||V15.panelMgr.showMessage(c);return b}},makeMainMoveOrder:function(b){if(V15.checkMyMovesLoggedIn()&&b.game.getMoveOffs()<=b.game.getCurLine().length){for(var c=
            new CB.Game,d=0;d<b.game.getMoveOffs();d++)c.makeMove(b.game.getCurLine()[d]);V15.myMovesMgr.makeMainMoveOrder(c);c=new CB.NotationGenerator;if(d=b.game.getLastMove()){var e=b.getCurPos().getMoveNum();c=c.getMoveNota(d,e);b.boardWin.addMessage(c+" is main move order.",!0);(new CB.Timer(function(){b.boardWin.destroyMessage()})).runOnce(2E3);V15.myMovesMgr.isMovesLoadedFor(!b.getCurPos().getBTM())&&V15.myMovesMgr.reloadMyMoves()}}},unMarkCurrentMove:function(b){if(V15.checkMyMovesLoggedIn()&&b.game.getMoveOffs()<=
            b.game.getCurLine().length&&this.checkMyMovesLoadedForOtherSide(!b.getCurPos().getBTM())){var c=b.game.getLastMove();if(c){b.game.deleteAnno(CB.AnnoType.SYMBOL);var d=new CB.Position;b.game.enableEvents(!1);b.game.gotoPrev();d.copy(b.game.getCurPos());b.game.gotoNext();V15.myMovesMgr.removeFromMyMoves(d,c);b.game.enableEvents(!0);d=new CB.NotationGenerator;var e=b.getCurPos().getMoveNum();c=d.getMoveNota(c,e);b.boardWin.addMessage(c+" cleared.",!0);(new CB.Timer(function(){b.boardWin.destroyMessage()})).runOnce(2E3);
            V15.myMovesMgr.isMovesLoadedFor(!b.getCurPos().getBTM())&&(c=this.cloneGameToCurPos(b.game,2),V15.myMovesMgr.loadMyMoves(V15.myMovesMgr.myMovesLoadMode,c))}}},uploadToMyMoves:function(b){V15.checkMyMovesLoggedIn()&&(b.boardWin.addMessage(lm.GAME_UPLOADED,!0),V15.myMovesMgr.uploadToMyMoves(b.game),(new CB.Timer(function(){b.boardWin.destroyMessage()})).runOnce(2E3),V15.myMovesMgr.reloadMyMoves())},isCloudLoggedIn:function(){return V15.cloudMgr&&V15.cloudMgr.isLoggedIn()},checkCloudLoggedIn:function(){if(V15.cloudMgr){if(V15.cloudMgr.isLoggedIn())return!0;
            if(V15.cloudMgr.wasLoggedIn()&&!V15.cloudMgr.isConnected())return V15.cloudMgr.reconnectUser(),!0}V15.panelMgr.showMessage(lm.PLEASE_LOGIN_OPENINGS,3E3);return!1},isMyMovesLoggedIn:function(){return V15.myMovesMgr&&V15.myMovesMgr.isLoggedIn()},checkMyMovesLoggedIn:function(){if(V15.myMovesMgr){if(V15.myMovesMgr.isLoggedIn()&&!V15.myMovesMgr.isGuest())return!0;if(V15.myMovesMgr.wasLoggedIn()&&!V15.myMovesMgr.isConnected())return V15.myMovesMgr.reconnectUser(),!0}V15.panelMgr.showMessage(lm.PLEASE_LOGIN_OPENINGS,
            3E3);return!1},cloneGameToCurPos:function(b,c){for(var d=new CB.Game,e=0;e<b.getMoveOffs()&&e<(c||999);e++){var f=b.getCurLine()[e];if(f){d.makeMove(new CB.Move(f.from,f.to,f.prom));var g=d.getLastMove();f.annos&&f.annos[CB.AnnoType.SYMBOL]&&(g.annos=new CB.Annotation,g.annos[CB.AnnoType.SYMBOL]=f.annos[CB.AnnoType.SYMBOL])}else{alert("game logic problem");break}}return d},onNotaDoubleClick:function(){this.loadMyMoves(V15.myMovesMgr.myMovesLoadMode,new CB.Game);V15.panelMgr.refreshOnlineDBGames&&
        V15.panelMgr.refreshOnlineDBGames()},notifyMyMovesChanged:function(){this.myMovesMgr.checkPosAndMoves(this.panelMgr.getKernel().game.getCurPos());this.myMovesMgr.isMovesLoadedFor(this.panelMgr.getKernel().getCurPos().getBTM())&&this.myMovesMgr.reloadMyMoves()}}}();
CB.CloudPlayingModeMixin=function(){var d={createGUIElements:function(b){this.superClass.createGUIElements.call(this,b);b.shouldAnimatePosChange=this.shouldAnimatePosChange.bind(this);this.setDefaultAnimSteps(b)},setDefaultAnimSteps:function(b){if(this.kernel)var c=b||this.kernel.boardWin;c&&(CB.System.isMobile()?c.animSteps={forMove:.3,forPosition:.3}:c.animSteps={forMove:.6,forPosition:.6})},shouldAnimatePosChange:function(){return this.animatePos},blockLiveBookUpdate:function(b){if(this.blockUpdateMode!=
        CB.BlockUpdateMode.FORCE_UPDATE||b!=CB.BlockUpdateMode.NOT_BLOCKED)this.blockUpdateMode=b},onAnnotate:function(){return V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()?(V15.panelMgr.showMessage("Cannot annotate 'My Moves'",3E3),!1):this.canAnnotateLoadedGames()},onTextAnno:function(b,d){if(d){if(V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny())return d=V15.cloneGameToCurPos(this.kernel.game),V15.myMovesMgr.storeText(d,b),!0}else V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()&&V15.panelMgr.showMessage("'My Moves' can only have text after a move.");
        if(this.canAnnotateLoadedGames())return!0;V15.panelMgr.showMessage("You can only annotate your own moves");return!1},onEval:function(b){if(V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()){var c=this.kernel.game.getAnno(CB.AnnoType.SYMBOL);c&&c.hasExclusiveEval(b)&&(b=0);c=V15.cloneGameToCurPos(this.kernel.game);V15.myMovesMgr.storeEval(c,b);return!0}if(this.canAnnotateLoadedGames())return!0;V15.panelMgr.showMessage("You can only annotate your own moves");return!1},canAnnotateLoadedGames:function(){return!1},
    onPromoteLine:function(){return V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()?(V15.panelMgr.showMessage("Line ordering is automatic in 'My Moves'"),!1):!0},onDeleteLine:function(){if(V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny())return CB.Forms.Confirm(lm.DELETE_VARIATION_TREE,lm.REMOVE_ALL_MY_MOVES,function(b){"yes"!=b&&"ok"!=b||V15.removeWholeTreeFromCurrentMove(this.kernel,!0)}.bind(this)),!1;if(this.canAnnotateLoadedGames())return!0;V15.panelMgr.showMessage("You can only annotate your own moves");
        return!1},onCutLine:function(){if(V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny())return CB.Forms.Confirm(lm.DELETE_VARIATION_TREE,lm.REMOVE_MOVES_FROM_HERE,function(b){"yes"!=b&&"ok"!=b||V15.removeWholeTreeFromCurrentMove(this.kernel)}.bind(this)),!1;if(this.canAnnotateLoadedGames())return!0;V15.panelMgr.showMessage("You can only annotate your own moves");return!1},cloudOnEnteredMove:function(b){try{var c=V15.panelMgr.getNotaElement();c&&c.focus();if(V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedFor(this.kernel.getCurPos().getBTM())){var d=
        V15.cloneGameToCurPos(this.kernel.game);d.getCurPos().preCalcCtx(b);d.makeMove(b);V15.myMovesMgr.storePosAndMoves(d,b,1)}}catch(g){alert("CloudEnter: "+g)}},newGame:function(){delete this.kernel.game.replaceGameNo;delete this.kernel.game.replaceDBId;if(V15.myMovesMgr)V15.myMovesMgr.onResetGame();V15.panelMgr.setLayoutMyMoves(!1)},searchOnlineDB:function(){if(V15.panelMgr.dbGames||V15.panelMgr.usesOnlineDB&&V15.panelMgr.usesOnlineDB()){var b=new CB.SearchMask;b.setSearchBoard(this.kernel.game.getCurPos().board,
        this.kernel.game.getCurPos().getSideToMove());b.setUseBoard(!0);null!=V15.onlineLobby&&V15.onlineLobby.search(b,this.getOnlineDBMaxGames(),this.kernel.game.getMoveNo())}},getOnlineDBMaxGames:function(){return this.nMaxOnlineDBGames},getFnLoadSearchResult:function(){return function(b){this.Vk.beforeGameLoad();this.Vk.animatePos=!1;V15.panelMgr.setLayoutMyMoves.call(V15.panelMgr,!1);var c=ObjUtil.clone(this.game),d=c.getCurPos();void 0!==this.boardWin.prepareFullRedraw&&this.boardWin.prepareFullRedraw();
        this.game.assign(b,!0);b=0;if(this.game.isNormalInit())for(;60>++b&&!this.game.gotoPos(d,!0)&&0<c.getMoveOffs();)c.gotoPrev(!0),d=c.getCurPos();this.game.fireOnResetGame();this.game.fireOnChanged();this.game.fireOnCurPosChanged();this.game.fireOnHeaderChanged();this.game.isNormalInit()?60>b&&0<b&&5<this.game.getMoveNo()&&1<this.game.getLineCnt()&&V15.panelMgr.refoldToCurrentLine&&V15.panelMgr.refoldToCurrentLine():this.game.gotoFirst();this.Vk.animatePos=!0;this.Vk.afterGameLoad()}}},b=new CB.Vr;
    d.forceUpdateCloudOnGamePos=function(){this.blockUpdateMode=CB.BlockUpdateMode.FORCE_UPDATE;this.updateCloudOnGamePos()};d.updateCloudOnGamePos=function(){this.blockUpdateMode!=CB.BlockUpdateMode.BLOCKED&&b.exec(function(){V15.panelMgr.tbBook&&V15.aTBLobby&&V15.aTBLobby.hasIdReceived&&(this.bookAnswers||!this.updatePos||!this.updatePos.equals(this.kernel.game.getCurPos())||this.blockUpdateMode==CB.BlockUpdateMode.FORCE_UPDATE)&&(this.blockUpdateMode=CB.BlockUpdateMode.NOT_BLOCKED,this.updatePos=ObjUtil.clone(this.kernel.game.getCurPos()),
        V15.panelMgr.tbBook.clear(),(V15.panelMgr.tbBook.isVisible()||this.checkCloudWithHiddenBook())&&V15.aTBLobby.requestAllMoves(this.kernel.game.getCurPos()),V15.panelMgr.tbPanel&&(V15.panelMgr.tbPanel.isVisible()||this.checkCloudWithHiddenBook())&&V15.aTBLobby.requestPosInfo(this.kernel.game.getCurPos()),this.lbInfo=null,this.myMoves=[],V15.myMovesMgr&&(V15.panelMgr.tbBook&&V15.panelMgr.tbBook.isVisible()||this.checkCloudWithHiddenBook())&&(this.myMoves=null,!V15.myMovesMgr.isLoggedIn()&&V15.myMovesMgr.wasLoggedIn()?
        V15.myMovesMgr.reconnectUser():V15.myMovesMgr.isLoggedIn()&&(this.bookAnswers?V15.myMovesMgr.checkPosAndMovesEx(this.kernel.game.getCurPos(),this.bookAnswers,this.playingSide):V15.myMovesMgr.checkPosAndMoves(this.kernel.game.getCurPos(),this.bookAnswers,this.playingSide))),this.setDefaultAnimSteps())}.bind(this),100)};d.checkCloudWithHiddenBook=function(){return!1};d.initMyMovesListener=function(b){b.addOnMyMovesListener(this.myMovesListener.bind(this));V15.addOnAccountTypeListener(this.VlListener.bind(this))};
    d.myMovesListener=function(b){this.myMoves=b.moves};d.VlListener=function(b){switch(b.type){default:case 1:this.nMaxOnlineDBGames=5;break;case 2:this.nMaxOnlineDBGames=30;break;case 3:this.nMaxOnlineDBGames=50}};return d}();
CB.CloudGUIElements={createCloudMenuBtn:function(d,b){return CB.ToolButtons.menuBtn(b,"Databases","Cloud",["Open Cloud Database","Login","Save Game"],["Cloud16","Login16","Save16"],[d.OPEN_CLOUDDATABASE,d.LOGIN_CLOUDDB,d.SAVE_CLOUDDB],d.OPEN_CLOUDDATABASE,"Open database and save games")},createCloudAndPgnMenuBtn:function(d){return CB.ToolButtons.menuBtn(32,"Open","Open",["Open Cloud Database","Open PGN File"],["Cloud16","Open16"],[d.OPEN_CLOUDDATABASE,d.OPEN_PGN_DATABASE],d.OPEN_CLOUDDATABASE)},createCloudDatabaseMenuBtn:function(d,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b){return CB.ToolButtons.menuBtn(b,lm.DATABASES,"Cloud",[lm.OPEN_DATABASE,lm.CREATE_DATABASE,lm.DELETE_DATABASE],["Cloud16","CreateCloudDB16","Delete16"],[d.OPEN_CLOUDDATABASE,d.CREATE_CLOUDDB,d.DELETE_CLOUDDB],void 0,lm.DATABASE_FUNCTIONS)},createMarkMoveBtn:function(d,b){return CB.ToolButtons.ribbonBtn(b,lm.MARK_MOVE,"MyMove",d.MARK_CURRENT_MOVE,"Mark the current move as 'my move' to create a repertoire that you can drill.")},createLoadWhiteBtn:function(d,b){return CB.ToolButtons.ribbonBtn(b,lm.LOAD_WHITE,
        "White",d.LOAD_WHITE_MYMOVES,"Load your White repertoire (marked moves) from the current position.")},createLoadBlackBtn:function(d,b){return CB.ToolButtons.ribbonBtn(b,lm.LOAD_BLACK,"Black",d.LOAD_BLACK_MYMOVES,"Load your Black repertoire (marked moves) from the current position.")},createMyMoveMenuBtn:function(d,b,c,e){var f=[lm.MARK_MOVE,lm.MARK_IMPORTANT,lm.UNMARK_MOVE],g=["MyMove16","ImportantMove16","Erase16"],h=[d.MARK_CURRENT_MOVE,d.IMPORTANT_CURRENT_MOVE,d.UNMARK_CURRENT_MOVE];c&&(f=f.concat(["-",
        lm.LOAD_WHITE,lm.LOAD_BLACK]),g=g.concat(["","White16","Black16"]),h=h.concat([null,d.LOAD_WHITE_MYMOVES,d.LOAD_BLACK_MYMOVES]));e&&(f.push(lm.UPLOAD_GAME),g.push("Upload16"),h.push(d.UPLOAD_TO_MYMOVES));return CB.ToolButtons.menuBtn(b,lm.MY_MOVES,"MyMove",f,g,h,void 0,lm.MY_MOVE_MENU_TTIP)},createCloudBtn:function(d,b){return CB.ToolButtons.ribbonBtn(b,"Cloud Databases","Cloud",d.OPEN_CLOUDDATABASE,"Open the list of your databases (cloud)")},createCloudSaveBtn:function(d,b){return CB.ToolButtons.ribbonBtn(b,
        "Save","Save",d.SAVE_CLOUDDB,"Append game to the current cloud database")},createCloudSaveReplaceMenuBtn:function(d,b){return CB.ToolButtons.menuBtn(b,lm.SAVE,"Save",[lm.SAVE,lm.SAVE_AS_NEW,lm.EDIT_GAME],["Replace16","Save16","Edit16"],[d.REPLACE_CLOUDDB,d.SAVE_CLOUDDB,d.EDIT_HEADER],void 0,lm.SAVE_AND_REPLACE_GAMES)},createCloudLoginBtn:function(d,b){return V15.loginMenuBtn(b)}};
CB.AccountPanelMgrMixin=function(){return{onLogin:function(){CB.LOG("Login="+V15.isLoggedIn());this.gameKernel&&this.gameKernel.game.fireOnChanged({forceUpdate:!0});this.setLoginHtml(V15.isLoggedIn())},setLoginHtml:function(d){if(this.infoPanel){if(d)this.infoPanel.setHeight(450<window.innerHeight?28:20),Ext.apply(this.infoPanel,{overflowY:"auto"}),this.infoPanel.update('<div class="CBInfoLoggedIn">'+this.getLoggedInHtml()+"</div>"),this.infoPanel.setBodyStyle(this.getLoginInfoGradient()+";color:white;text-transform:uppercase");
    else{var b=window.innerHeight/3;this.eastContainer&&this.eastContainer.el&&(b=this.eastContainer.getHeight());CB.System.isMobile()&&900>window.innerHeight?this.infoPanel.setHeight(Math.min(b,120)):this.infoPanel.setHeight(Math.min(b,160));Ext.apply(this.infoPanel,{overflowY:"scroll"});this.infoPanel.update('<div class="CBInfoNotLoggedIn">'+this.getPleaseLoginHtml()+"</div>");this.infoPanel.setBodyStyle(CB.CSS.getGradToRight("rgba(254, 254,252,255)","rgba( 251, 251,247,255)")+";color:black;text-transform:none;")}this.infoPanel.loggedIn=
        d;V15.Vf.noLists()&&this.infoPanel.el&&this.infoPanel.setVisible(!1)}},getLoginInfoGradient:function(){return CB.CSS.getGradToRight("rgba(6, 216,19,255)","rgba(24, 147,23,255)")},getGuestInfoGradient:function(){return CB.CSS.getGradToRight("hsl( 120, 15%, 30% )","hsl( 0, 15%, 20% )")},getPleaseLoginHtml:function(d){d=CB.CSS.getHeader("h3",lm.LOGIN_PLEASE_LOGIN,"margin-top:4px");d+=this.getLoginInviteHeader()+"<br/>";if(!CB.System.isMobile()||900<window.innerHeight)d+=this.getFunctionalityText()+"<br/>",
        d+=lm.LOGIN_ACCOUNT_FREE+"<br/><br/>";CB.System.isCordova()||(d+=this.genCreateAccountLink());return d},genCreateAccountLink:function(){return'<a href="'+V15.config.createAccountWebUrl+'" style="color:#8B0A16">'+lm.LOGIN_CREATE_LINK+"</a>"},getLoggedInHtml:function(){return String.f(lm.LOGIN_WELCOME,V15.Vf.userName)},getLoginInviteHeader:function(){return String.f(lm.GENERAL_INVITE,V15.appTitle)},getFunctionalityText:function(){return lm.PLEASE_LOGIN},resizeInfoPanel:function(){var d=!1;if(this.infoPanel&&
        this.infoPanel.el)if(this.infoPanel.loggedIn){var b=22;450<window.innerHeight&&(b=650<window.innerHeight?30:26);this.infoPanel.setHeight(b);d=!0}else this.eastContainer&&(b=Math.min(220,Math.max(20,.3*this.eastContainer.getHeight())),this.infoPanel.setHeight(b));return d}}}();
CB.AccountAppMixin=function(){return{accountLogin:function(d,b){V15.Vf.userName=CB.DOM.getAccountNameCookie(!0)||V15.Vf.userName;V15.Vf.loginToken=CB.DOM.getCookie("AccountToken");if(!d&&V15.Vf.loginToken&&V15.Vf.userName&&"guest"!=V15.Vf.userName)d=new CB.AccountsManager(V15.shortAppName),V15.Vf.userName&&"guest"!=V15.Vf.userName&&V15.Vf.password?d.pwLogin(V15.Vf.userName,V15.Vf.password,this.receiveTokenHandler.bind(this)):d.tokenLogin(V15.Vf.userName,V15.Vf.loginToken,this.tokenLoginHandler.bind(this));
    else this.onRequestLogin(b)},onRequestLogin:function(d){this.enterLoginForm(d)},enterLoginForm:function(d,b){V15.panelMgr.showAccountsForm(d,"",b)},tokenLoginHandler:function(d){d&&1!=d.ResultType&&!d.timeout?(this.setLoggedIn(!1),this.enterLoginForm()):d.timeout?(CB.DOM.clearCookie("AccountToken"),this.setLoggedIn(!1)):(this.setLoggedIn(!0),this.onTokenLoginOk(),V15.showAccountType(d.Subscription));this.loginPending=!1},onTokenLoginOk:function(){},receiveTokenHandler:function(d){if(d&&d.Token){var b=
        unescape(d.Token);V15.Vf.loginToken=b;CB.LOG("AccToken = "+b,"","acc");V15.Vf.rememberLoginToken();d.userId&&1==d.ResultType&&(V15.Vf.userName=d.userId);CB.DOM.setAccountNameCookie(V15.Vf.userName);this.setLoggedIn(!0);CB.ToolButtons&&CB.ToolButtons.showBusyMask("Logged in OK: "+V15.Vf.userName);CB.Timer.launch(function(){CB.ToolButtons&&CB.ToolButtons.hideBusyMask()},600);this.onTokenLoginOk()}else{CB.LOG("No Token Received in token handler");if(d&&1!=d.Result&&!d.timeout&&!d.error)this.onInvalidToken();
        d.timeout&&CB.DOM.clearCookie("AccountToken","");this.setLoggedIn(!1);this.loginPending=!1}},onInvalidToken:function(){V15.panelMgr.showAccountsForm()?V15.panelMgr.showAccountsForm(lm.PW_INVALID,V15.Vf.userName):this.enterLoginForm(String.formatEx(lm.PW_INVALID,V15.Vf.userName))},isLoggedIn:function(){return this.loggedIn||this.loginPending},setLoggedIn:function(d){this.superClass.setLoggedIn.apply(this,arguments);d?document.title=this.appTitle+" - "+V15.Vf.userName:(document.title=this.appTitle+
        " - not logged in",this.loginPending=!1)}}}();
CB.ResultPostBack=function(){var d=function(){this.url="https://www.schach.de/";0<=window.location.href.search("test.schach.de")&&(this.url="http://test.schach.de:62068/",console.log("test url detected"))};d.prototype.postSolved=function(b,c,d){if(b&&c){var e=this.url;e+="users/solved?userId="+b+"&posId="+c+String.f("&points={0}",d);$.post(e,null,this.updateUserPoints.bind(this))}};d.prototype.postWrong=function(b,c,d){b&&c&&(d=this.url,d+="users/wrong?userId="+b+"&posId="+c,$.post(d),console.log(d))};
    d.prototype.postPlayed=function(b,c){b&&c&&(b=this.url,b+="users/played?userId="+window.playchessUser+"&posId="+c,$.post(b))};d.prototype.updateUserPoints=function(b){isNaN(b)||$("#UserTotalPoints").text(b.toString())};return d}();"use strict";CB.FritzTrainer=function(){var d=function(){this.nShopId="";this.fileList=[];this.indexInList=this.filesInDB=0};d.prototype.getLocalDB=function(){this.localDB||(this.localDB=localforage.createInstance({name:"GA"+this.nShopId}));return this.localDB};return d}();
CB.ReaderHelper=function(){var d=function(){this.requestId=0;this.FritzTrainers=[];var b=new CB.FritzTrainer;this.FritzTrainers.push(b);this.ActiveFritzTrainer=0;this.aProgressForm=null;this.homedir="undefined";this.localDB=localforage.createInstance({name:"GA"});CB.System.isElectron()&&"undefined"!==typeof electronBridge&&(this.homedir=electronBridge.getHomeDir())};d.prototype.onCheckHardware=function(b,c){var d=!1;null==b&&null!=c&&(c===this.getHardwareGuid()?d=!0:alert(lm.YOUR_SYSTEMS_CONFIGURATION_HAS_CHANGED));
    return d};d.prototype.trySilentActivation=function(b){this.silentCallback=b;b=this.getHardwareGuid();(new CB.AccountsManager(V15.shortAppName)).activateTrainerSilent(b,"hallolutz",this.FritzTrainers[0].nShopId,this.onSilentActivationResult.bind(this))};d.prototype.onSilentActivationResult=function(b){var c=b.Reason;this.requestId=b.RequestId;this.addFritzTrainer(b.BindedProducts);"80"===c?(this.localDB.setItem("hardware",this.getHardwareGuid(),function(b,c){null!=b&&alert(b)}),this.downloadAllGameActions()):
    this.silentCallback()};d.prototype.checkHardware=function(b){var c=CB.DOM.getCookie("hardware");null===c||""===c?this.localDB.getItem("hardware",function(c,d){b(c,d)}):b(null,c)};d.prototype.onGetItem=function(b){b&&(this.FritzTrainers[this.ActiveFritzTrainer].indexInList++,this.checkNextGameActionFile())};d.prototype.onRemoveItems=function(){for(var b=0;b<this.FritzTrainers.length;b++)if(this.FritzTrainers[b].fileList){this.ActiveFritzTrainer=b;for(var c=0;c<this.FritzTrainers[b].fileList.length;c++){var d=
    this.constructItemName(this.FritzTrainers[b].fileList[c]);d=d.substr(0,d.length-4);this.FritzTrainers[b].getLocalDB().removeItem(d,function(b,c){})}}};d.prototype.removeProducts=function(){this.onRemoveItems()};d.prototype.downloadAllGameActions=function(){this.showProgressDialog();this.FritzTrainers[this.ActiveFritzTrainer].indexInList=0;this.downloadNextGameActionFile()};d.prototype.downloadNextGameActionFile=function(){if(this.FritzTrainers[this.ActiveFritzTrainer].indexInList<this.FritzTrainers[this.ActiveFritzTrainer].fileList.length){var b=
    this.getHardwareGuid(),c=100*this.FritzTrainers[this.ActiveFritzTrainer].indexInList/this.FritzTrainers[this.ActiveFritzTrainer].fileList.length;this.aProgressForm.progress.jqxProgressBar("value",c);CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.updateProgressBar(V15,c/100);c=this.constructItemName(this.FritzTrainers[this.ActiveFritzTrainer].fileList[this.FritzTrainers[this.ActiveFritzTrainer].indexInList]);var d=c.substr(0,c.length-4);$("#myLabel").text(lm.DOWNLOAD_STARTED+
    ". "+lm.PLEASE_WAIT);$.get("https://videos.chessbase.com/Replay/GetGameActionsTrainer?id="+(d+"&Request="+this.requestId+"&Product="+this.FritzTrainers[this.ActiveFritzTrainer].nShopId+"&Hardware="+b),function(b){$("#myLabel").text("Received");b&&(b.length&&($("#myLabel").text("Storing..."),this.FritzTrainers[this.ActiveFritzTrainer].getLocalDB().setItem(d,b,function(b,c){null!=b&&alert(b)}),this.onActivatedVideoDownload(this.FritzTrainers[this.ActiveFritzTrainer].fileList[this.FritzTrainers[this.ActiveFritzTrainer].indexInList])),
    this.FritzTrainers[this.ActiveFritzTrainer].indexInList++,(new CB.Timer(function(){this.downloadNextGameActionFile()}.bind(this))).runOnce(100))}.bind(this)).fail(function(){$(this.aProgressForm.nestDiv).jqxWindow("hide");$(this.aProgressForm.nestDiv).remove();alert("Sorry downloading data failed, please try again in a moment")}.bind(this))}else this.ActiveFritzTrainer++,this.ActiveFritzTrainer<this.FritzTrainers.length?this.downloadAllGameActions():(this.ActiveFritzTrainer=0,CB.System.isElectron()&&
"undefined"!==typeof electronBridge&&electronBridge.updateProgressBar(V15,-1),$(this.aProgressForm.nestDiv).jqxWindow("hide"),$(this.aProgressForm.nestDiv).remove(),CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.showAlert(V15,lm.PRODUCT_IS_ACTIVATED))};d.prototype.removeProgress=function(){$(this.aProgressForm.nestDiv).jqxWindow("hide");$(this.aProgressForm.nestDiv).remove()};d.prototype.isFileAvailable=function(b,c){b=this.constructItemName(b);b=b.substr(0,b.length-4);
    this.FritzTrainers[this.ActiveFritzTrainer].getLocalDB().getItem(b,function(b,d){c(d)})};d.prototype.descrambleTime=function(b){return parseInt(b)^this.FritzTrainers[this.ActiveFritzTrainer].nShopId};d.prototype.descrambleAction=function(b,c,d){c=c%5+1;d=d.substr(0,c);return b&&d===b.substr(0,c)?b.substr(c):""};d.prototype.constructItemName=function(b){return this.FritzTrainers[this.ActiveFritzTrainer].nShopId+"-"+b};d.prototype.readGameActionListReady=function(){this.filesInDB=this.indexInList=0;
    this.checkNextGameActionFile()};d.prototype.readGameActionFileList=function(b){try{var c=new XMLHttpRequest;c.open("GET","gameactions.txt",!0);c.onreadystatechange=function(){if(4===c.readyState&&(200===c.status||0==c.status)){var d=c.responseText;this.FritzTrainers[0].fileList=[];d=d.split("\r\n");for(var f=0;f<d.length;f++)0<d[f].length&&this.FritzTrainers[0].fileList.push(d[f]);b()}}.bind(this);c.send(null)}catch(e){CB.LogException("RN:readGameActionFileList",e),b()}};d.prototype.readShopId=function(b){try{var c=
    new XMLHttpRequest;c.open("GET","shop.txt",!1);c.onreadystatechange=function(){if(4===c.readyState&&(200===c.status||0===c.status))for(var b=c.responseText.split("\r\n"),d=0;d<b.length;d++)0<b[d].length&&(this.FritzTrainers[0].nShopId=b[d])}.bind(this);c.send(null)}catch(e){CB.LogException("RWM:readShopId",e)}};d.prototype.getUnmaskedInfo=function(b){var c={renderer:"",vendor:""},d=b.getExtension("WEBGL_debug_renderer_info");null!=d&&(c.renderer=b.getParameter(d.UNMASKED_RENDERER_WEBGL),c.vendor=
    b.getParameter(d.UNMASKED_VENDOR_WEBGL));return c};d.prototype.getHardwareGuid=function(){var b="No graphics device found",c=document.getElementById("glcanvas").getContext("experimental-webgl");c&&(b=this.getUnmaskedInfo(c).vendor+this.getUnmaskedInfo(c).renderer);c=CB.System.getHardwareId()+this.homedir;for(var d="",f=0;f<b.length;f++)if(f<c.length){var g=b[f].charCodeAt()^c[f].charCodeAt();d+=String.fromCharCode(65+g%26)}return d=CB.System.getOSChar()+d};d.prototype.OnDeactivate=function(b){alert(lm.PRODUCT_IS_DEACTIVATED)};
    d.prototype.addFritzTrainer=function(b){if(b)for(var c=0;c<b.length;c++){var d=new CB.FritzTrainer;d.nShopId=b[c].ProductId;for(var f=b[c].FileList.split(";"),g=0;g<f.length;g++)d.fileList.push(f[g]);this.FritzTrainers.push(d)}};d.prototype.OnActivate=function(b){var c=b.Reason;this.requestId=b.RequestId;this.addFritzTrainer(b.BindedProducts);if("Server Maintenance"===b.Result)alert(lm.SERVER_IS_IN_MAINTENANCE);else switch(c){case "80":this.localDB.setItem("hardware",this.getHardwareGuid(),function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            c){null!=b&&alert(b)});this.downloadAllGameActions();break;case "81":alert(lm.PRODUCT_KEY_ALREADY_USED_BEFORE);break;case "83":alert(lm.PRODUCT_KEY_IS_DISABLED);break;case "84":alert(lm.PRODUCT_KEY_IS_INVALID);break;case "85":alert(lm.PRODUCT_KEY_ALREADY_ACTIVATED);break;case "86":alert(lm.PRODUCT_KEY_NOT_VALID_FOR_THIS_PRODUCT)}};d.prototype.showActivateDialog=function(b){this.onActivatedVideoDownload=b;var c=this.getHardwareGuid(),d=new CB.AccountsManager(V15.shortAppName);b=new CB.SerialForm;CB.DOM.setCookie("hardware",
        c,365);b.createSerialForm(lm.PLEASE_ACTIVATE_THIS_PRODUCT,function(b){b.idSerial=b.idSerial.trim();25===b.idSerial.length?(b=b.idSerial.toUpperCase(),CB.DOM.setCookie("serial",b,365),d.activateTrainer(c,b,this.FritzTrainers[0].nShopId,this.OnActivate.bind(this))):alert(lm.PRODUCT_KEY_CONTAINS_5_BLOCKS)}.bind(this),function(b){}.bind(this),"")};d.prototype.onValidDeactivate=function(b){var c=b.Reason,d=b.Result;this.addFritzTrainer(b.BindedProducts);if("Server Maintenance"===d)alert(lm.SERVER_IS_IN_MAINTENANCE);
    else switch(c){case "113":alert(lm.PRODUCT_KEY_NOT_VALID_FOR_THIS_PRODUCT);break;case "112":alert("No products activated");break;case "84":alert("Product key does not exists");break;case "83":alert("General error with deactivation");break;case "110":this.removeProducts(),alert(lm.PRODUCT_IS_DEACTIVATED)}};d.prototype.showDeactivateDialog=function(){var b=new CB.SerialForm,c=this.getHardwareGuid(),d=lm.DEACTIVATE_THIS_PRODUCT;TRACE("harwareid:"+c);b.createSerialForm(d,function(b){b.idSerial=b.idSerial.trim();
        25===b.idSerial.length?(b=b.idSerial.toUpperCase(),(new CB.AccountsManager(V15.shortAppName)).deactivateTrainer(c,b,this.onValidDeactivate.bind(this))):alert(lm.PRODUCT_KEY_CONTAINS_5_BLOCKS)}.bind(this),function(b){}.bind(this),"")};d.prototype.feedbackProduct=function(){(new CB.FeedbackForm).createFeedbackForm(lm.SEND_YOUR_FEEDBACK,function(b){var c=b.idSubject;0<this.FritzTrainers.length&&(c+=" ("+this.FritzTrainers[0].nShopId+")",c+=" version:"+V15.versionCode.nMajor+"."+V15.versionCode.nMinor);
        b=b.idMessage;this.baseurl=V15.config.getVideoPortalUris()[0];c=this.baseurl+"Public/ReportAProblem?subject="+encodeURIComponent(c)+"&message="+encodeURIComponent(b);$.get(c,function(b){alert("thank you")}.bind(this)).fail(function(){}.bind(this))}.bind(this),function(b){}.bind(this),"")};d.prototype.showProgressDialog=function(){this.aProgressForm=new CB.ProgressForm;this.aProgressForm.createProgressForm(lm.DOWNLOADING_FILES,function(b){}.bind(this),function(b){}.bind(this),"")};return d}();"use strict";
(function(d){d.require=function(){d.each(arguments,function(b,c){0==d('head script[src="'+c+'"]').length&&document.write('<script type="text/javascript" src="'+c+'">\x3c/script>')})}})(jQuery);CB.ReaderMode={LIVE:1,REPLAY:2,DIAGRAM:3,TABLE:4,PAIRING:5,VIDEO:6,LIVEVIDEO:7,OFFLINEVIDEO:8,RECORDER:9};
CB.ReaderPluginManager=function(){function d(b){return new CB.AnalysisMode(b,1,{hintTimeout:20,liveBookSilent:!0})}function b(b){return new CB.ReaderPlayingMode(b)}function c(b,c){"number"!==typeof b&&(b=0);"number"!==typeof c&&(c=0);return c-b}function e(b,c,d){if(c)for(var e=0;e<V15.panelMgr.modules[b].kernel.length;e++)if(V15.panelMgr.modules[b].kernel[e].idGame==c)return V15.panelMgr.modules[b].kernel[e];return V15.panelMgr.modules[b].getKernel(d)}var f=function(b){this.inDestroy=!1;this.allPluginClasses=
    ".cbreplay,.cblive,.cbdiagram,.cbtable,.cbpairing,.cbvideo,.cblivevideo,.cbofflinevideo,.cbrecorder";f.superClass.call(this,b);this.init();TRACE(window.innerWidth+"/"+window.innerHeight+"/"+window.devicePixelRatio);CB.System.isElectron()&&V15.connectPlayerLobby(!1)};CB.inherit(f,CB.PluginManager);f.prototype.init=function(){this.superClass.init.call(this);this.modules=[];this.diagrams=[];this.chat=[];this.book=[];this.video=[];this.offlinevideo=[];this.recorder=[];this.livevideo=[];this.maximized=
    -1;this.gridCreated=this.engineOpen=!1;this.boardBtns=[];this.diagramBtns=[];this.tabNavBtns=[];this.buttonImages=[];this.tabNavSwitchDivs=[];this.listResized=[];this.notaResized=[];this.soundBtnSelector=[];this.hasPlugins=0<$(this.allPluginClasses).length;CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setTitleTouchBar(V15,"")};f.prototype.createPanels=function(){this.createHtml();return 0<this.modules.length};f.prototype.createHelper=function(){this.readerHelper=new CB.ReaderHelper;
    this.readerHelper.readShopId()};f.prototype.onReady=function(){V15.lobby&&(this.modules&&this.modules[0]&&(this.modules[0].isMyMovesLive||V15.lobby.requestLiveLists(this.liveLists)),V15.playerLobby&&V15.playerLobby.addOnConnectedListener(this.onPlayerLobbyConnect.bind(this)))};f.prototype.loadAzurePlayer=function(b){if("undefined"===typeof V15.AzurePlayerLoaded){var c=document.createElement("link");c.href="//amp.azure.net/libs/amp/latest/skins/amp-default/azuremediaplayer.min.css";c.rel="stylesheet";
    c.type="text/css";document.getElementsByTagName("head")[0].appendChild(c);jQuery.getScript("//amp.azure.net/libs/amp/latest/azuremediaplayer.min.js",function(){V15.AzurePlayerLoaded=!0;b()})}else b()};f.prototype.loadNanoPlayer=function(b){"undefined"===typeof V15.NanoPlayerLoaded&&($.ajax({url:"//demo.nanocosmos.de/nanoplayer/api/release/nanoplayer.3.min.js",dataType:"script",async:!1}),V15.NanoPlayerLoaded=!0)};f.prototype.loadRecorder=function(b){"undefined"===typeof V15.RecorderLoaded&&($.ajax({url:"//www.webrtc-experiment.com/common.js",
    dataType:"script",async:!1}),$.ajax({url:"//www.webrtc-experiment.com/RecordRTC.js",dataType:"script",async:!1}),$.ajax({url:"//webrtc.github.io/adapter/adapter-latest.js",dataType:"script",async:!1}),V15.RecorderLoaded=!0)};f.prototype.loadOfflinePlayer=function(b){this.createHelper();CB.System.isElectron()&&this.readerHelper.checkHardware(function(b,c){null==b?this.readerHelper.onCheckHardware(b,c)||this.modules[0].offlineVideo.videoManager.disable():alert(b)}.bind(this));CB.System.isElectron()&&
"undefined"!==typeof electronBridge&&electronBridge.setMediaTouchBar(V15,"Video");"undefined"===typeof V15.OfflinePlayerLoaded&&(V15.OfflinePlayerLoaded=!0);b()};f.prototype.createHtml=function(){this.createPlugins();V15.addOnLoginListener(this.onLogInListener.bind(this));this.initLiveGames();this.initDiagramAnimations()};f.prototype.checkRecreateOrientation=function(){var b=this.isTabbedLayout();this.calcIsVerticalLayout();return b!=this.isTabbedLayout()?($(this.allPluginClasses).each(function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    c){if(this.isOfflineVideo(b))"undefined"==typeof V15.offlinevideoEl&&(V15.offlinevideoEl=[],V15.videoDIV=[],V15.offlinevideo=[]),V15.offlinevideoEl[b]=document.getElementById("videoEl"+b),V15.videoDIV[b]=V15.offlinevideoEl[b].parentElement,V15.offlinevideo[b]=this.offlinevideo[b],V15.videoDIV[b].removeChild(V15.offlinevideoEl[b]);else if(this.isLiveVideo(b))V15.config.hasFolding=!1,"undefined"==typeof V15.livevideoEl&&(V15.livevideoEl=[],V15.videoDIV=[],V15.livevideo=[]),V15.livevideoEl[b]=document.getElementById("videoEl"+
    b),V15.videoDIV[b]=V15.livevideoEl[b].parentElement,V15.livevideo[b]=this.livevideo[b],V15.videoDIV[b].removeChild(V15.livevideoEl[b]);else if(this.isVideo(b))"undefined"==typeof V15.videoEl&&(V15.videoEl=[],V15.videoDIV=[],V15.video=[]),V15.videoEl[b]=document.getElementById("videoEl"+b),V15.videoDIV[b]=V15.videoEl[b].parentElement,V15.video[b]=this.video[b],V15.videoDIV[b].removeChild(V15.videoEl[b]);else if(this.isRecorder(b))"undefined"==typeof V15.recoderEl&&(V15.recorderEl=[],V15.videoDIV=[],
    V15.recorder=[]),V15.recorderEl[b]=document.getElementById("videoEl"+b),V15.videoDIV[b]=V15.recorderEl[b].parentElement,V15.recorder[b]=this.recorder[b],V15.videoDIV[b].removeChild(V15.recorderEl[b]);else if(this.isLive(b)){if(this.modules[b].list)for(var d=0;d<this.modules[b].list.length;d++)V15.lobby.setSessionToBackground(this.modules[b].ticket,this.modules[b].list[d].id);$(c).empty(".root");delete this.modules[b].boardArea}}.bind(this)),this.init(),this.createPlugins(),this.createHelpText(V15.isLoggedIn()),
    this.initLiveGames(),V15.lobby&&null!=V15.lobby.requestLiveLists&&V15.lobby.requestLiveLists(this.liveLists),!0):!1};var g=0;f.prototype.createPlugins=function(){this.calcIsVerticalLayout();var c=0,d=function(b,d,e,f,g,h){this.instantiated=!0;this.buttonImages[b]={};this.modifyDimensionsOnCreate(d);var k=$(d).text();k&&($(d).text(""),$(d).attr("data-move")&&(this.pgnStartMoveIndex=Number($(d).attr("data-move"))));e=this.initAbstractModule(d,c,e);f(e,c,k);this.modules.push(e);e.addKernel(this);f=h(d,
    c,e.getKernel(),"100%");e.panels=f;e.nota=f.nota;e.undo=[];e.redo=[];e.onBoardReady=function(){V15.chessAudio||V15.AzurePlayerLoaded||V15.NanoPlayerLoaded||V15.OfflinePlayerLoaded||CB.System.isElectron()||(V15.chessAudio=new CB.ChessAudio(V15.config.getExternalCommonPath()+"Media/Sounds/"),(new CB.Timer(function(){V15.chessAudio.loadAll()})).runOnce(5E3))};$(d).on("click",function(b){return function(c){if(this.nActivePlugin!=b&&0<=this.nActivePlugin)this.onPluginExit(this.nActivePlugin);if(this.nActivePlugin!=
    b)this.onPluginEntry(b);this.nActivePlugin=b}.bind(this)}.call(this,c));f.boardParent&&(e.boardArea=this._createCanvasParent(f.boardParent));e.engineOpen=!1;g(e,c,k);c++;e.mode==CB.ReaderMode.LIVE&&($("#listParent"+b).text(lm.CONNECTING),$("#listParent"+b).addClass("msgInListParent"))},e=this,f=1;$(this.allPluginClasses).each(function(c,g){$(g).is(".cbreplay")?e.doCreateReplayPlugin(g,c,d):$(g).is(".cblive")?(e.doCreateLivePlugin(g,c,d,f),f++):$(g).is(".cbdiagram")?e.doCreateDiagramPlugin(g,c,d):
    $(g).is(".cbtable")?e.doCreateTablePlugin(g,c,d):$(g).is(".cbpairing")?d.call(this,c,g,b,function(b){b.mode=CB.ReaderMode.PAIRING},function(b,c,d){b.getKernel().fnInitGame=function(){};this.loadPairingData(g,c)}.bind(this),function(b,c,d,e){return this.createPluginElementsTable(b,c)}.bind(this)):$(g).is(".cbvideo")?this.loadAzurePlayer(function(){e.doCreateVideoPlugin(g,c,d)}.bind(this)):$(g).is(".cblivevideo")?(this.loadNanoPlayer(),e.doCreateLiveVideoPlugin(g,c,d)):$(g).is(".cbrecorder")?(this.loadRecorder(),
        e.doCreateRecorderPlugin(g,c,d)):$(g).is(".cbofflinevideo")&&this.loadOfflinePlayer(function(){e.doCreateOfflineVideoPlugin(g,c,d)}.bind(this))}.bind(this));V15.isLive=0<$(".cblive").length||0<$(".cblivevideo").length;V15.isAnyPlugin=0<$(this.allPluginClasses).length;$(document.body).unbind("keydown");$(document.body).on("keydown",function(b){this.chat[this.nActivePlugin]&&this.chat[this.nActivePlugin].hasFocus()||this.handleKeyDown(b,this.nActivePlugin||0)&&b.preventDefault()}.bind(this));$(document.body).unbind("orientationchange");
    $(document.body).on("orientationchange",function(b){this.onOrientationChange()}.bind(this));this.pluginCnt=c};f.prototype.doCreateReplayPlugin=function(c,d,e){e.call(this,d,c,b,function(b,c){b.mode=CB.ReaderMode.REPLAY},function(b,d,e){b.getKernel().fnInitGame=this.getFnKernelInitGame(c,d);this.createPgnDatabase(c,this.createDatabaseGrid.bind(this),d,e);b.toPgn=function(b){if(b=this.modules[b].pgnDatabase)return b.toString()}.bind(this)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,
    c,d,e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};f.prototype.doCreateLivePlugin=function(b,c,e,f){e.call(this,c,b,d,function(c){c.mode=CB.ReaderMode.LIVE;c.isMyMovesLive="true"==b.dataset.mymoves},function(d){d.requestData=this.createRequestData(b,f,c,this,d.ticket);d.pgnTitle="LiveGames_"+d.requestData.event+".pgn";d.list=[];d.toPgn=this.moduleGamesToPgn.bind(this);this.resizePlugin($(b),c)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,c,
    d,e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};f.prototype.doCreateDiagramPlugin=function(b,c,d){d.call(this,c,b,function(d){b.dataset.play||b.dataset.anim||b.dataset.choice?(d=new CB.MiniPlayMode(d,b.dataset,null,c),d.clearBoardAlways=!!b.dataset.anim):(d=new CB.AnalysisMode(d,1,{hintTimeout:20,liveBookSilent:!0}),d.fnGetMoveEnterType=function(){return CB.MoveEnterType.OVERWRITE_MAIN},d.onEntry=function(){this.gateUpdate.exec(function(){V15.analysisEngine&&V15.analysisEngine.engineGo(this.kernel)}.bind(this),
    100)});return d},function(b){b.mode=CB.ReaderMode.DIAGRAM},function(d,e,f){d.toPgn=function(b){b=this.modules[b].getKernel().game;return CB.PGNWriter.toPGN(b)}.bind(this);d.pgnTitle="Position.pgn";d.getKernel().fnInitGame=this.getFnKernelInitDiagram(b,c,this,f);this.resizeDiagram($(b),c)}.bind(this),function(b,c,d,e){this.modifyPlayingModeForTraining(b,c,d);return this.createPluginElementsDiagram(b,c,d)}.bind(this))};f.prototype.doCreateTablePlugin=function(c,d,e){e.call(this,d,c,b,function(b){b.mode=
    CB.ReaderMode.TABLE},function(b,d,e){b.getKernel().fnInitGame=function(){};this.loadTableData(c,d)}.bind(this),function(b,c,d,e){return this.createPluginElementsTable(b,c)}.bind(this))};f.prototype.modifyDimensionsOnCreate=function(b){if(!($(b).hasClass("cbtable")||$(b).hasClass("cbdiagram")||$(b).hasClass("cbpairing"))&&((CB.System.isMobile()||this.isTabbedLayout())&&$(b).css("min-width",220),this.isTabbedLayout()?CB.System.runsOnVideosChessBaseCom()?b.style.height="80vh":CB.System.runsOnLiveChessBaseCom()&&
    (CB.System.isFullScreen()?b.style.height="100vh":b.style.height="92vh"):b.style.minHeight="400px",b.style.clear="both",$(b).hasClass("cbofflinevideo"))){var c=$(b).width()/16*9;b.style.maxHeight=c+"px";b.style.minHeight=c+"px";b.style.Height=c+"px"}};f.prototype.createPluginElementsDiagram=function(b,c,d,e){return{nota:null,boardParent:this.createDiagramElements(b,c)}};f.prototype.createPluginElementsTable=function(b,c){return{nota:null,boardParent:null}};f.prototype.createCrossTable=function(b,c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      d,e,f){if(d.Players){d=CB.Tournament.fromObject(d);var g=CB.TiebrakeInfo.arrFromString(d.strTB||e.tbs);g=new CB.RankingOptions(g,e.top);var h=new CB.Ranking(d,e.round,g,f,e);this.modules[c].ranking=h;e=$(b).width();$(b).html("");h.addListener("Changed",function(){$(b).width();this.resizeTable(b,c);h.resized||(h.resized=!0)}.bind(this));e=h.toHtml(e)[0];b.appendChild(e);h.startGetPlayerFlag(h.players);this.resizeTable(b,c)}};f.prototype.createPairings=function(b,c,d,e,f){var g=CB.Tournament.fromObject(d);
    d=e.round;0==d&&(d=g.availbeRounds[g.availbeRounds.length-1]);e=new CB.Ranking(g,1E4,{tiebreakInfosArr:[]},f,e);var h=new CB.Pairings(e);h.round=d;this.modules[c].pairing=h;h.addListener("Changed",function(){$(b).width();this.resizePairings(b,c);h.resized||(h.resized=!0)}.bind(this));e=h.RoundToHtml(d)[0];b.appendChild(e);this.resizePairings(b,c)};f.prototype.doCreateVideoPlugin=function(c,d,e){e.call(this,d,c,b,function(b,c){b.mode=CB.ReaderMode.VIDEO},function(b,d,e){b.getKernel().fnInitGame=this.getFnKernelInitGame(c,
    d);this.createVideoDatabase(c,this.createVideoGrid.bind(this),d,e);b.toPgn=function(b){if(b=this.modules[b].pgnDatabase)return b.toString()}.bind(this)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,c,d,e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};f.prototype.doCreateLiveVideoPlugin=function(c,d,e){e.call(this,d,c,b,function(b,c){b.mode=CB.ReaderMode.LIVEVIDEO},function(b,d,e){b.getKernel().fnInitGame=this.getFnKernelInitGame(c,d);this.createLiveVideoDatabase(c,
    this.createLiveVideoGrid.bind(this),d,e);b.toPgn=function(b){if(b=this.modules[b].pgnDatabase)return b.toString()}.bind(this)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,c,d,e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};f.prototype.doCreateOfflineVideoPlugin=function(c,d,e){e.call(this,d,c,b,function(b,c){b.mode=CB.ReaderMode.OFFLINEVIDEO},function(b,d,e){b.getKernel().fnInitGame=this.getFnKernelInitGame(c,d);this.createOfflineVideoDatabase(c,
    this.createOfflineVideoGrid.bind(this),d,e);b.toPgn=function(b){if(b=this.modules[b].pgnDatabase)return b.toString()}.bind(this)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,c,d,e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};f.prototype.doCreateRecorderPlugin=function(c,d,e){e.call(this,d,c,b,function(b,c){b.mode=CB.ReaderMode.RECORDER},function(b,d,e){b.getKernel().fnInitGame=this.getFnKernelInitGame(c,d);this.createPgnDatabase(c,this.createDatabaseGrid.bind(this),
    d,e);b.toPgn=function(b){if(b=this.modules[b].pgnDatabase)return b.toString()}.bind(this)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,c,d,e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};var h=new CB.Vr,k=new CB.Vr,l=new CB.Vr;f.prototype.createPluginElementsHori=function(b,c,d,e){this.modules[c].noBook=null!=b.dataset.nobook;this.hasCaptionBar(c)&&(e=this.createDiv("cbcaption",c),b.appendChild(e));var f=this.createDiv("rootParent",c);b.appendChild(f);
    e=this.createDiv("root",c);f.appendChild(e);var g=this.createDiv("west",c);e.appendChild(g);f=this.createDiv("westNest",c);g.appendChild(f);var h=this.createDiv("westNorth",c);f.appendChild(h);g=this.createDiv("westSouth",c);f.appendChild(g);var k=this.createDiv("east",c);e.appendChild(k);var q=this.createDiv("eastNest",c);k.appendChild(q);var l=this.createDiv("eastLayer",c);q.appendChild(l);k=this.createDiv("eastUpDownNest",c);l.appendChild(k);this.isLiveVideo(c)&&this.createLiveVideoDivs(k,c);this.isOfflineVideo(c)&&
    this.createOfflineVideoDivs(k,c);this.isVideo(c)&&this.createVideoDivs(k,c);this.isRecorder(c)&&this.createRecorderDivs(k,c);d=this.createNotaDivs(k,c,d);this.hasBook(c)&&this.createBookDivs(k,c);this.hasChat(c)&&this.createChatDivs(q,c);h=this.createBoardDivs(h,c);this.createEngineDivs(g,c);l=this.createDiv("listParent",c);g.appendChild(l);this.createSplittersHori(b,c,e,f,q,k);this.isAnyVideo(c)&&(new CB.Timer(function(){this.inDestroy||(this.onVideoSplitterResize(c,!1),$("#root"+c)&&$("#root"+c).jqxSplitter("refresh"))}.bind(this))).runOnce(1E3);
    return{nota:d,boardParent:h}};f.prototype.createNotaDivs=function(b,c,d){var e=this.createDiv("notaNest",c);b.appendChild(e);b=this.createDiv("notaparent",c);var f=this.createDiv("notaEl",c);b.appendChild(f);e.appendChild(b);d=this._createNotation(f,d,c);this.isOfflineVideo(c)||(b=this.createDiv("belowNota",c),f=this.createDiv("notaButtons",c),b.appendChild(f),e.appendChild(b),this.createNotaButtons(f,c));return d};f.prototype.createBookDivs=function(b,c){var d=this.createDiv("bookparent",c),e=this.createDiv("bookEl",
    c);d.appendChild(e);b.appendChild(d);this.book[c]=this._createBook(e,c)};f.prototype.createChatDivs=function(b,c){var d=this.createDiv("chatparent",c),e=this.createDiv("chatEl",c);$(e).height("100%");$(e).width("100%");d.appendChild(e);b.appendChild(d);this.chat[c]=this._createChat(e,c)};f.prototype.createVideoDivs=function(b,c){var d=this.createDiv("videoparent",c);if("undefined"!=typeof V15.videoEl&&V15.videoEl[c])d.appendChild(V15.videoEl[c]),this.video[c]=V15.video[c],this.video[c].videoManager.play();
else{var e=this.createDiv("videoEl",c);d.appendChild(e);e.style.height="100%";this.video[c]=this._createVideo(e,c)}b.appendChild(d)};f.prototype.createLiveVideoDivs=function(b,c){var d=this.createDiv("videoparent",c);if("undefined"!=typeof V15.livevideoEl&&V15.livevideoEl[c])d.appendChild(V15.livevideoEl[c]),this.livevideo[c]=V15.livevideo[c],this.livevideo[c].videoManager&&this.livevideo[c].videoManager.play();else{var e=this.createDiv("videoEl",c);d.appendChild(e);e.style.height="100%";this.livevideo[c]=
    this._createLiveVideo(e,c)}b.appendChild(d)};f.prototype.createOfflineVideoDivs=function(b,c){var d=this.createDiv("videoparent",c);if("undefined"!=typeof V15.offlinevideoEl&&V15.offlinevideoEl[c])d.appendChild(V15.offlinevideoEl[c]),this.offlinevideo[c]=V15.offlinevideo[c],this.offlinevideo[c].videoManager&&this.offlinevideo[c].videoManager.play();else{var e=this.createDiv("videoEl",c);d.appendChild(e);this.offlinevideo[c]=this._createOfflineVideo(e,c);this.modules[c].offlineVideo=this.offlinevideo[c]}b.appendChild(d)};
    f.prototype.createRecorderDivs=function(b,c){var d=this.createDiv("videoparent",c);if("undefined"!=typeof V15.recorderEl&&V15.recorderEl[c])d.appendChild(V15.recorderEl[c]),this.recorder[c]=V15.recorder[c];else{var e=this.createDiv("videoEl",c);d.appendChild(e);this.recorder[c]=this._createRecorder(e,c);this.modules[c].recorder=this.recorder[c]}b.appendChild(d)};f.prototype.createBoardDivs=function(b,c){var d=this.createDiv("boardHolder",c);$(d).css("backgroundImage","url( "+CB.getCommonPath()+"media/chess/OrangeBrighterSoftBacklightLessSatur.jpg )");
        b.appendChild(d);var e=this.createDiv("boardArea",c);d.appendChild(e);d=this.createDiv("belowBoard",c);var f=this.createDiv("buttons",c);d.appendChild(f);b.appendChild(d);this.createBoardButtons(f,c);return e};f.prototype.createBoardDivsTabbed=function(b,c){var d=this.createDiv("boardHolder",c);$(d).css("backgroundImage","url( "+CB.getCommonPath()+"media/chess/OrangeBrighterSoftBacklightLessSatur.jpg )");var e=this.createDiv("boardArea",c);d.appendChild(e);b.appendChild(d);d=this.createDiv("belowBoard",
        c);var f=this.createDiv("buttons",c);d.appendChild(f);b.appendChild(d);this.createBoardButtons(f,c);$("#boardHolder"+c)[0].style.height="calc( 92vh - 34px )";return e};f.prototype.createEngineDivs=function(b,c){var d=this.createDiv("engineParent",c),e=this.createDiv("engineEl",c),f=this.createDiv("engineButtons",c);d.appendChild(f);d.appendChild(e);b.appendChild(d);this.createEngineButtons(f,c)};f.prototype.createSplittersHori=function(b,c,d,e,f,g){var h=this.getSplitterWidth(),k=65,q=50;$(b).is(".cblive")&&
    (880<$(b).width()&&1100>$(b).width()?(q=65,780>$(b).height()&&(k=60)):(k=76,q=65));if($(b).is(".cbvideo")||$(b).is(".cblivevideo")||$(b).is(".cbofflinevideo")||$(b).is(".cbrecorder"))q=55,k=88;CB.System.isMobile()&&500>window.innerWidth?q=k=65:$(b).width()<1.1*$(b).height()&&(q=65);this.createRootSplitter(c,d,h,q);this.createWestNestSplitter(c,e,h,k);this.createEastNestSplitter(c,f,h);this.isAnyVideo(c)?this.createVideoSplitter(c,g,h,$(b).height()):this.createBookSplitter(c,g,h,$(b).height())};f.prototype.createRootSplitter=
        function(b,c,d,e){var f=this.loadSplitPos("root",b);e=f&&f.size?f.size:e;$(c).jqxSplitter({width:"100%",height:"100%",splitBarSize:d,theme:"chessbase",panels:[{size:e+"%",collapsible:!1},{size:100-e+"%",collapsible:!1}]});$(c).on("resize",function(c){CB.LOG("RootResize","","resize");h.exec(function(){this.onSplitterResizeHori(b,!0)}.bind(this),100)}.bind(this))};f.prototype.createWestNestSplitter=function(b,c,d,e){var f=this.loadSplitPos("westNest",b);e=f&&f.size?f.size:e;$(c).jqxSplitter({orientation:"horizontal",
        splitBarSize:d+1,theme:"chessbase",panels:[{size:e+"%",collapsible:!1},{size:100-e+"%",collapsible:!1}]});$(c).on("resize",function(c){CB.LOG("WestNestResize","","resize");h.exec(function(){this.onSplitterResizeHori(b,!1)}.bind(this),100)}.bind(this))};f.prototype.createEastNestSplitter=function(b,c,d){if(this.hasChat(b)){var e=(e=this.loadSplitPos("eastNest",b))&&e.size?e.size:75;$(c).jqxSplitter({orientation:"vertical",splitBarSize:d+2,theme:"chessbase",panels:[{size:e+"%",collapsible:!1},{size:100-
                e+"%",collapsible:!1}]});$(c).on("resize",function(c){CB.LOG("EastNestResize","","resize");k.exec(function(){this.onEastSplitterResize(b,!1)}.bind(this),50)}.bind(this))}};f.prototype.createBookSplitter=function(b,c,d,e){if(this.hasBook(b)){var f=90;850<e&&(f=86);f=(e=this.loadSplitPos("eastUpDownNest",b))&&e.size?e.size:f;$(c).jqxSplitter({orientation:"horizontal",width:"100%",height:"100%",splitBarSize:d+2,theme:"chessbase",panels:[{size:f+"%",collapsible:!1},{size:100-f+"%",collapsible:!1}]});
        $(c).on("resize",function(c){CB.LOG("EastNestResize","","resize");l.exec(function(){this.onBookSplitterResize(b,!1)}.bind(this),50)}.bind(this))}};f.prototype.createVideoSplitter=function(b,c,d,e){if(this.isAnyVideo(b)){var f=90;850<e&&(f=60);this.isAnyVideo(b)&&(f=45);f=(e=this.loadSplitPos("eastUpDownNest",b))&&e.size?e.size:f;$(c).jqxSplitter({orientation:"horizontal",width:"100%",height:"100%",splitBarSize:d+2,theme:"chessbase",panels:[{size:f+"%",collapsible:!1},{size:100-f+"%",collapsible:!1}]});
        $(c).on("resize",function(c){l.exec(function(){TRACE("resizevideo");this.onVideoSplitterResize(b,!1)}.bind(this),150)}.bind(this))}};f.prototype.createPluginElementsTabbed=function(b,c,d,e){return this.createPluginElementsSplitterVerti(b,c,d,e)};f.prototype.createPluginElementsSplitterVerti=function(b,c,d,e){e=this.createDiv("root",c);b.appendChild(e);b=this.createDiv("north",c);e.appendChild(b);var f=this.createDiv("southNest",c),g=this.createDiv("south",c);e.appendChild(g);g.appendChild(f);g=this.createDiv("ribbon",
        c);f.appendChild(g);f=this.createDiv("notaparent",c);var k=this.createDiv("listParent",c),q=this.createDiv("videoParent",c);this.isLiveVideo(c)&&this.createLiveVideoDivs(q,c);this.isVideo(c)&&this.createVideoDivs(q,c);this.isOfflineVideo(c)&&this.createOfflineVideoDivs(q,c);this.isRecorder(c)&&this.createRecorderDivs(q,c);g.appendChild(f);g.appendChild(k);this.isAnyVideo(c)&&g.appendChild(q);this.tabNavSwitchDivs[c]=[f,k];this.isAnyVideo(c)&&this.tabNavSwitchDivs[c].push(q);q=this.createDiv("tabNavButtons",
        c);g.appendChild(q);this.createTabNavButtons(q,c);$(k).text("Just one game here...");g=this.createDiv("notaEl",c);f.appendChild(g);d=this._createNotation(g,d,c);$("#notaEl"+c)[0].style.height="100%";b=this.createBoardDivsTabbed(b,c);this.fnSelectNota(c);$(e).jqxSplitter({width:"100%",height:"100%",orientation:"horizontal",splitBarSize:10,resizable:!0,theme:"chessbase",panels:[{size:"65%",min:90,max:window.innerWidth+30,collapsible:!1},{size:"35%",min:20}]});$(e).on("resize",function(b){CB.LOG("RootResize",
        "","resize");h.exec(function(){this.onSplitterResizeVerti(c,!1);this.resize(null,!0)}.bind(this),100)}.bind(this));return{nota:d,boardParent:b}};f.prototype.hideRibbon=function(b){this.isTabbedLayout()&&($("#t-btnSelNota-"+b).remove(),$("#tabNavButtons"+b)[0].style.height="0px")};f.prototype.isTabbedLayout=function(){return this.isVerti};f.prototype.createDiagramElements=function(b,c){this.modules[c].diagramAnimations=this.parseDiagramAnimation(b);this.modules[c].posId=b.dataset.posid;var d=b.dataset.title;
        if(d){var e=this.createDiv("aboveDiag",c);b.appendChild(e);var f=this.createDiv("diagTitle",c);e.appendChild(f);$(f).text(d)}d=this.createDiv("diagarea",c);b.appendChild(d);e=this.needsDiagramAnimButtons(c);if("0"!=b.dataset.buttons||e){var g=this.createDiv("belowDiag",c);b.appendChild(g);e=this.createDiv("diagButtons",c);g.appendChild(e);this.needsDiagramAnimButtons(c)?this.createDiagramAnimButtons(e,b,c):this.createDiagramReplayButtons(e,b,c)}if(e=b.dataset.legend)g||(g=this.createDiv("belowDiag",
            c),b.appendChild(g)),f=this.createDiv("diagText",c),g.appendChild(f),$(f).text(e);(e=b.dataset.choice)&&this.createMultipleChoice(b,g,e,c);return d};f.prototype.createMultipleChoice=function(b,c,d,e){c||(c=this.createDiv("belowDiag",e),b.appendChild(c));b=this.createDiv("diagChoices",e);c.appendChild(b);(d=JSON.parse(d))&&d.entries?(this.modules[e].diagramChoice=d,this.createChoiceTable(b,d,e),e=this.createDiv("diaChoiceFeedback",e),c.appendChild(e)):$(b).text("Parsing Error")};f.prototype.createChoiceTable=
        function(b,c,d){var e="<table>"+String.f("<thead><tr><th colspan='2'>{0}</th></thead>",c.title);for(var f=0;f<c.entries.length;f++){var g=String.f("V15.panelMgr.onChoiceClick( {0}, {1} )",d,f);g=String.f("<input type='checkbox' id='checkChoice{0}-{1}' onclick='{2}'/>",d,f,g);e+=String.f("<tr><td>{0}</td><td>{1}</td></tr>",g,c.entries[f].text)}b.appendChild($(e+"</table>")[0])};f.prototype.onChoiceClick=function(b,c){if(this.modules[b].diagramChoice){var d=this.modules[b].diagramChoice.attrs;d&&d.length||
    (d=this.modules[b].diagramChoice.entries[c].attrs);this.modules[b].diagramChoice.entries[c].correct?($("#diaChoiceFeedback"+b).css("color","green"),window.playchessUser&&!this.modules[b].diagramChoice.entries[c].done&&V15.resultPostBack.postSolved(window.playchessUser,this.modules[b].posId||"noid",1),this.modules[b].diagramChoice.entries[c].done=!0,this.modules[b].getKernel().boardWin.addCheckMark()):($("#diaChoiceFeedback"+b).css("color","red"),this.modules[b].getKernel().boardWin.destroySideIcon());
        $("#diaChoiceFeedback"+b).text(this.modules[b].diagramChoice.entries[c].feedback);this.modules[b].getKernel().boardWin.addAttributes([]);this.modules[b].getKernel().Vk.showChoiceFeedback(d)}for(d=0;d<this.modules[b].diagramChoice.entries.length;d++)d!=c&&$(String.f("#checkChoice{0}-{1}",b,d)).prop("checked",!1)};f.prototype.hasAutoStartDiaAnimation=function(b){return!1};f.prototype.needsDiagramAnimButtons=function(b){if(this.modules[b]&&(b=this.modules[b].diagramAnimations))return CB.DiagramAnimationController.needsDiagramAnimButtons(b)};
    f.prototype.currPluginIsAnimatedDiagram=function(){return this.needsDiagramAnimButtons(this.nActivePlugin)};f.prototype.parseDiagramAnimation=function(b){if(b=b.dataset.anim)if(b=b.replace(/[^\S ]+/g,""))try{var c=b.split(";");for(b=0;b<c.length;b++)c[b]=c[b].trim();return c}catch(y){CB.LOG("Animation error: "+y)}};f.prototype._createNotation=function(b,c,d){var e=ObjUtil.clone(CB.cbNotationDefaults);e.useMatBalance=!this.isTabbedLayout();b=CB.NotaElement.factory(b,null,e,d,this.modules[d].ticket);
        b.setGame(c.game);return b};f.prototype._createChat=function(b,c){return CB.ChatElement.factory(b,c,this.fnSendChat.bind(this),{noInvite:!1})};f.prototype._createBook=function(b,c){return CB.LiveBookElement.factory(b,c,function(){return this.modules[c].getKernel()}.bind(this),this.modules[c].ticket)};f.prototype._createVideo=function(b,c){return CB.VideoElement.factory(b,c,function(){return this.modules[c].getKernel()}.bind(this),this.modules[c].ticket,this.onGameAction.bind(this),this.onVideoEnd.bind(this))};
    f.prototype._createLiveVideo=function(b,c){return CB.LiveVideoElement.factory(b,c,function(){return this.modules[c].getKernel()}.bind(this),this.modules[c].ticket,this.onLiveGameAction.bind(this))};f.prototype._createOfflineVideo=function(b,c){return CB.OfflineVideoElement.factory(b,c,function(){return this.modules[c].getKernel()}.bind(this),this.modules[c].ticket,this.onGameAction.bind(this),this.onOfflineVideoEnd.bind(this))};f.prototype._createRecorder=function(b,c){return CB.RecorderElement.factory(b,
        c,function(){return this.modules[c].getKernel()}.bind(this),this.modules[c].ticket,this.onGameAction.bind(this),this.onOfflineVideoEnd.bind(this))};f.prototype.chatOut=function(b,c){this.chat[0]&&this.chat[0].out(b,c)};f.prototype.getNPluginByTicket=function(b){for(var c=0;c<this.modules.length;c++)if(this.modules[c].ticket==b)return c;return 0};f.prototype.kibitzChatOut=function(b,c,d,e,f,g){var h=0;e&&e.ticket&&(h=this.getNPluginByTicket(e.ticket));this.chat[h]&&this.chat[h].addKibitzChat(b,c,d,
        e,f,g)};f.prototype.loginOkOut=function(b,c){this.chat[b]&&this.chat[b].addKibitzChat(sender,null,c,gameTicket,!0,!0)};f.prototype.onChatLog=function(b,c){var d=this.getNPluginByTicket(b);if(this.chat[d])for(d=0;d<c.length;d++)this.kibitzChatOut(c[d].sender,c[d].hdr,c[d].txt,{idGame:c[d].gameId,ticket:b,mvInx:c[d].mvInx},c[d].autoChat,d==c.length-1)};f.prototype.fnSendChat=function(b,c){if(V15.isLoggedIn()&&V15.Vf.userName){if((b=this.modules[b].getKernel())&&b.idGame)return V15.lobby.sendChat(V15.Vf.userName,
        b.idGame,c),b}else this.chat[b].inviteLogin()};f.prototype.createDatabaseGrid=function(b,c,d){$("#boardHolder"+c).height();$($(".cbreplay")[c]).height();CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setReplayTouchBar(V15,"Replay");var e=this;$("#listParent"+c).jsGrid({width:"400px",height:"100%",heading:!1,filtering:!1,editing:!1,inserting:!1,updateOnResize:!1,sorting:!0,autoload:!1,rowClick:function(f){d(b.getGame(f.item.No),c,f.item.No);e.isVerti&&e.fnSelectNota(c)},
        controller:{loadData:function(c){c=[];for(var d=1;d<=b.getGameCount();d++){var e=b.getHeaderJson(d),f=e.white,g=e.black,h=e.elow?e.elow:"-",k=e.elob?e.elob:"-",q=e.result,l=e.eco,u=e.event,m=e.date?e.date:" ",p=d,r="";e.round&&(r=e.round,e.subRound&&(r+="."+e.subRound));c.push({White:f,Black:g,EloW:h,EloB:k,Res:q,ECO:l,Event:u,Year:m,No:p,Rnd:r,Len:e.plyCount})}return c}},fields:this.getGridFields(this.getGridWidth(c),!1)});this.gridCreated=!0;$("#listParent"+c).jsGrid("loadData");this.resize(null,
        !0);(new CB.Timer(function(){this.onSplitterResize(c);console.log("ResizePGN");(new CB.Timer(function(){console.log("ResizePGN2");$("#listParent"+c).jsGrid("loadData");this.resize(null,!0);0<$("#westNest"+c).length&&$("#westNest"+c).jqxSplitter("refresh");0<$("#eastNest"+c).length&&$("#eastNest"+c).jqxSplitter("refresh");0<$("#root"+c).length&&$("#root"+c).jqxSplitter("refresh")}.bind(this))).runOnce(this.isAnyVideo(c)?100:1E3)}.bind(this))).runOnce(this.isAnyVideo(c)?160:1600);this.isRecorder(c)&&
    (new CB.Timer(function(){this.recorder[0].videoManager.setUrl()}.bind(this))).runOnce(100);return this.loadFromDBByUrlParam(b,c,d)?!0:(d(b.getGame(1),c,1),!1)};f.prototype.createLiveListGrid=function(b,d,e){$("#listParent"+d).removeClass("msgInListParent");var f=this.getGridFields(this.getGridWidth(d),!0),g=this;$("#listParent"+d).jsGrid({width:"400px",height:"100%",heading:!1,filtering:!1,editing:!1,inserting:!1,updateOnResize:!1,sorting:!0,loadMessage:"Retrieving games ...",loadShading:!0,autoload:!1,
        rowClick:function(b){e(b.item.id,d,!1);g.isVerti&&g.fnSelectNota(d)},controller:{loadData:function(c){c=[];for(var d=0;d<b.games.length;d++){var e=b.games[d],f=e.white,h=e.black,k=e.eloWhite?e.eloWhite:"-",q=e.eloBlack?e.eloBlack:"-",l=g.getResIcon(e.result),u=e.eco?CB.GameHeader.ECOtoString(e.eco):"",m=e.tourn,p=d+1,r=e.watchers,y="";e.round1&&(y=e.round1,e.round2&&(y+="."+e.round2));c.push({White:f,Black:h,EloW:k,EloB:q,Res:l,ECO:u,Event:m,No:p,NKib:r,Rnd:y,Len:Math.ceil(e.moveLen/2),id:e.id,Stat:e.stat})}return c}},
        fields:f});this.gridCreated=!0;$("#listParent"+d).jsGrid("loadData");jsGrid.sortStrategies.number=c;b.games.length&&(new CB.Timer(function(){e(b.games[0].id,d);for(var c=1;c<b.games.length;c++)(b.games[c].shouldRequestImmediatelyInLive()||6>=c)&&14>=c&&e(b.games[c].id,d,!0);this.loadByUrlParam(b.games,d,e);this.onSplitterResize(d)}.bind(this))).runOnce(500)};f.prototype.createVideoGrid=function(b,c,d){this.modules[c].getKernel().Interactive=b.Interactive;$("#boardHolder"+c).height();$($(".cbreplay")[c]).height();
        var e=this;$("#listParent"+c).jsGrid({width:"400px",height:"100%",heading:!1,filtering:!1,editing:!1,inserting:!1,updateOnResize:!1,sorting:!0,autoload:!1,rowClick:function(f){this.loadFromVideos(b,f.itemIndex,c,d);e.isVerti&&e.fnSelectNota(c)}.bind(this),controller:{loadData:function(c){c=[];if(b&&b.Items)for(var d=0;d<b.Items.length;d++){var f=b.Items[d];f={Duration:e.getDurationString(f.DurationSeconds),Name:f.Name,Id:f.Id};c.push(f)}return c}},fields:this.getVideoGridFields(this.getGridWidth(c),
                !1)});this.gridCreated=!0;$("#listParent"+c).jsGrid("loadData");this.resize(!0);(new CB.Timer(function(){this.onSplitterResize(c);0<$("#westNest"+c).length&&$("#westNest"+c).jqxSplitter("refresh");0<$("#eastNest"+c).length&&$("#eastNest"+c).jqxSplitter("refresh");0<$("#root"+c).length&&$("#root"+c).jqxSplitter("refresh")}.bind(this))).runOnce(1E3);if("undefined"==typeof V15.videoEl){var f=0;if(b&&b.Items)for(var g=0;g<b.Items.length;g++)if(b.Preferred===b.Items[g].Id){f=g;break}(new CB.Timer(function(){this.show||
        this.loadFromVideos(b,f,c,d);this.isTabbedLayout()&&(this.onSplitterResize(c),this.fnSelectTab(c,2),(new CB.Timer(function(){if(0<$("#root"+c).length)this.onSplitterResizeVerti(c,!1);this.resize(null,!0)}.bind(this))).runOnce(1E3))}.bind(this))).runOnce(100)}else this.setCaptionText(b.Items[0].Name,c);return!0};f.prototype.createLiveVideoGrid=function(b,c,d){this.modules[c].getKernel().Interactive=!1;$("#boardHolder"+c).height();$($(".cbreplay")[c]).height();this.modules[c].database=b;for(var e=!0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          f=0;f<b.results.length;f++)b.results[f].Private||(e=!1);e&&this.getCalendar(c);var g=this;$("#listParent"+c).jsGrid({width:"400px",height:"100%",heading:!1,filtering:!1,editing:!1,inserting:!1,updateOnResize:!1,sorting:!0,autoload:!1,rowClick:function(b){this.loadFromLiveVideos(g.modules[c].database,b.itemIndex,c,d);g.isVerti&&g.fnSelectNota(c)}.bind(this),controller:{loadData:function(b){b=[];for(var d=0;d<g.modules[c].database.results.length;d++){var e=g.modules[c].database.results[d];e.Private||
            b.push({Name:e.ID,Id:e.StreamId,url:e.URL,gameId:e.gameId,Connections:e.Connections})}return b}},noDataContent:"Currently no broadcast",fields:this.getLiveVideoGridFields(this.getGridWidth(c),!1)});this.gridCreated=!0;(new CB.Timer(function(){var b=this.buildGetLiveStreamsURL();$.get(b,function(b){if(b){var e=0;this.modules[c].database&&(e=this.modules[c].database);this.modules[c].database=b;$("#listParent"+c).jsGrid("loadData");0<b.results.length&&0==e.results.length&&(new CB.Timer(function(){this.loadFromLiveVideos(this.modules[c].database,
        h,c,d);(new CB.Timer(function(){this.onSplitterResize(c);0<$("#westNest"+c).length&&$("#westNest"+c).jqxSplitter("refresh");0<$("#eastNest"+c).length&&$("#eastNest"+c).jqxSplitter("refresh");0<$("#root"+c).length&&$("#root"+c).jqxSplitter("refresh")}.bind(this))).runOnce(1E3)}.bind(this))).runOnce(100)}}.bind(this)).fail(function(){this.resizePlugin($(pluginDiv),c)}.bind(this))}.bind(this))).runPeriodic(3E4);$("#listParent"+c).jsGrid("loadData");this.resize(!0);(new CB.Timer(function(){this.onSplitterResize(c);
        0<$("#westNest"+c).length&&$("#westNest"+c).jqxSplitter("refresh");0<$("#eastNest"+c).length&&$("#eastNest"+c).jqxSplitter("refresh");0<$("#root"+c).length&&$("#root"+c).jqxSplitter("refresh");this.show&&0==b.results.length&&(this.inDestroy=!0,this.modules&&this.modules[0]&&this.modules[0].getKernel()&&this.modules[0].getKernel().boardWin&&this.modules[0].getKernel().boardWin.destroyMessage(),this.deleteRoot(0),this.inDestroy=!1,this.modules[c].pluginDiv.className="cbvideo",V15.panelMgr.init(),V15.panelMgr.createPanels())}.bind(this))).runOnce(1E3);
        if("undefined"==typeof V15.videoEl){var h=0;for(f=0;f<b.results.length;f++)if(b.Preferred===b.results[f].Id){h=f;break}(new CB.Timer(function(){this.loadFromLiveVideos(b,h,c,d)}.bind(this))).runOnce(100)}else 0<b.results.length&&this.setCaptionText(b.results[0].ID,c);return!0};f.prototype.createOfflineVideoGrid=function(b,c,d){this.modules[c].getKernel().Interactive=!1;$("#boardHolder"+c).height();$($(".cbreplay")[c]).height();this.modules[c].database=b;this.modules[c].selectedLecture=0;var e=this;
        $("#listParent"+c).jsGrid({width:"400px",height:"100%",heading:!1,filtering:!1,editing:!1,inserting:!1,updateOnResize:!1,sorting:!0,autoload:!1,rowClick:function(b){e.modules[c].selectedLecture=c;this.loadFromOfflineVideos(e.modules[c].database,b.itemIndex,c,d);e.isVerti&&e.fnSelectNota(c)}.bind(this),controller:{loadData:function(b){b=[];for(var d=0;d<e.modules[c].database.results.length;d++){var f=e.modules[c].database.results[d];b.push({Name:f.Name,Id:f.Id,url:f.url,gameId:f.gameId})}return b}},
            noDataContent:"Currently no broadcast",fields:this.getOfflineVideoGridFields(this.getGridWidth(c),!1)});this.gridCreated=!0;$("#listParent"+c).jsGrid("loadData");this.resize(!0);(new CB.Timer(function(){this.onSplitterResize(c);0<$("#westNest"+c).length&&$("#westNest"+c).jqxSplitter("refresh");0<$("#eastNest"+c).length&&$("#eastNest"+c).jqxSplitter("refresh");0<$("#root"+c).length&&$("#root"+c).jqxSplitter("refresh")}.bind(this))).runOnce(100);if("undefined"==typeof V15.videoEl){for(var f=0,g=0;g<
        b.results.length;g++)if(b.Preferred===b.results[g].Id){f=g;break}(new CB.Timer(function(){this.loadFromOfflineVideos(b,f,c,d)}.bind(this))).runOnce(100)}else 0<b.results.length&&this.setCaptionText(b.results[0].Name,c);return!0};f.prototype.getCalendar=function(b){0<this.livevideo.length&&(this.livevideo[b].videoManager.el.innerHTML="<iframe  style='width:100%;height:100%;' src='https://en.chessbase.com/playchess2/events.aspx/video'></iframe>")};f.prototype.getDateString=function(b){return"undefined"!==
    typeof b?b.toString():"?"};f.prototype.getDurationString=function(b){var c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60);b=b-3600*c-60*d;c="0"+c+":";if(0!=d||""!==c)d=10>d&&""!==c?"0"+d:String(d),c+=d+":";return c=""===c?b+"s":c+(10>b?"0"+b:String(b))};f.prototype.loadByUrlParam=function(b,c,d){var e=decodeURIComponent(CB.strUtil.trimQuotes(CB.strUtil.getURLParam("w"))),f=decodeURIComponent(CB.strUtil.trimQuotes(CB.strUtil.getURLParam("b"))),g=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("r")),h=
        CB.strUtil.trimQuotes(CB.strUtil.getURLParam("r2")),k=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("mv"));if(e.length&&f.length)for(var q=0;q<b.length;q++)if(0==b[q].white.indexOf(e)&&0==b[q].black.indexOf(f)){var l=0==g.length||b[q].round1==parseInt(g);if(l=l&&0==h.length||b[q].round2==parseInt(h))return d(b[q].id,c,!1,k),this.nActivePlugin=c,!0}};f.prototype.loadFromDBByUrlParam=function(b,c,d){var e=decodeURIComponent(CB.strUtil.trimQuotes(CB.strUtil.getURLParam("w"))),f=decodeURIComponent(CB.strUtil.trimQuotes(CB.strUtil.getURLParam("b"))),
        g=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("r")),h=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("r2")),k=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("mv"));if(e.length&&f.length)for(var q=0;q<b.getGameCount()&&100>q;q++){var l=b.getHeaderJson(q+1);if(0==l.white.indexOf(e)&&0==l.black.indexOf(f)){var u=0==g.length||l.round==parseInt(g);if(u=u&&0==h.length||l.subRound==parseInt(h))return b=b.getGame(q+1),d(b,c,q+1,!1,parseInt(k)),this.nActivePlugin=c,!0}}return!1};f.prototype.onLiveGameAction=
        function(b,c){if(b.GA){b=b.GA;var d=new CB.DataBuffer;d.constructFromBase64(b);d.rewind();d=d.exportAsCompressedString();this.modules[c].getKernel().executeGameAction("GC",d);this.modules[c].boardArea&&this.modules[c].boardArea.canvas&&this.modules[c].boardArea.canvas.requestRedraw()}else b.ASKBESTMOVE&&(b=b.ASKBESTMOVE,d=new CB.DataBuffer,d.constructFromBase64(b),d.rewind(),d=d.exportAsCompressedString(),b=new CB.DataBuffer,b.constructFromString(d,!0),b.rewind(),d=new CB.Position,d.read(b),this.modules[c].getKernel().Vk.posAskBestmove=
            d,this.modules[c].getKernel().boardWin.addMessage("Please enter your move",!0))};f.prototype.mustExecute=function(b,c){return b>=c&b<c+1};f.prototype.onGameAction=function(b,c){if(this.gameactions){if(CB.System.isElectron()&&"undefined"!==typeof electronBridge&&this.offlinevideo&&this.offlinevideo[b]&&this.offlinevideo[b].videoManager){var d=this.offlinevideo[b].videoManager.getDuration();d=parseInt(100*c/d,10);electronBridge.updateSlider(V15,d)}for(d=0;d<this.gameactions.length;d++)if(this.mustExecute(this.gameactions[d].time,
        c)&&(console.log("Exec GA"),this.modules[b].getKernel().executeGameAction(this.gameactions[d].type,this.gameactions[d].action),this.modules[b].boardArea&&this.modules[b].boardArea.canvas&&this.modules[b].boardArea.canvas.requestRedraw(),60<=c-this.modules[b].lastSnippedViewed&&!this.offlinevideo[b])){var e=this.modules[b].getKernel().Vk.videoid;if(e){var f=Math.floor(c)/60;f=Math.floor(f);this.modules[b].endEventFired=!1;var g="",h="";V15.isLoggedIn()&&V15.Vf.userName&&(h=V15.Vf.userName);h&&(g=encodeURIComponent(h));
        1<f&&(this.baseurl=V15.config.getVideoPortalUris()[0],e=this.baseurl+"Replay/AddSnippetViewed?id="+encodeURIComponent(e)+"&time="+f+"&user="+g,$.get(e,function(c){"undefined"===typeof this.video[b].loginOk&&c&&0!=c.localeCompare("Ok")&&(this.video[b].videoManager.pause(),0==c.localeCompare("Expert")?this.fnHint("You have to purchase this video in order to watch it",b):this.showAccountsForm(b))}.bind(this)).fail(function(){alert("onsnippedviewed")}.bind(this)))}this.modules[b].lastSnippedViewed=c}}};
    f.prototype.showAccountsForm=function(b){0<this.video.length&&this.video[b].videoManager.pause();(new CB.AccountForm).createLoginForm("Login with premium account",function(c){V15.Vf.userName=c.idUser;V15.Vf.password=c.idPassword;V15.Vf.loginMode=CB.LoginMode.NORMAL;(new CB.AccountsManager(V15.shortAppName)).pwLogin(V15.Vf.userName,V15.Vf.password,this.receiveTokenHandler.bind(this),b)}.bind(this),function(c){0<this.video.length&&this.video[b].videoManager.disable()}.bind(this),"")};f.prototype.receiveTokenHandler=
        function(b,c){"error"!=b&&"OK"==b.Result&&3<=b.HighestSubscr?(V15.setLoggedIn(!0),this.video[c].videoManager.play(),this.video[c].loginOk=!0):this.video[c].videoManager.disable()};f.prototype.onOfflineVideoEnd=function(b,c){this.modules[b].endEventFired=!0;CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setVideoEndTouchBar(V15,"Video");if(this.modules[b].cmsiManager){var d=c,e=c.lastIndexOf("/");-1!=e&&(d=c.substr(e+1));c=this.modules[b].cmsiManager.extractStateFromFileName(d);
        if(3==c)this.fnHint("please try again",b),(b=this.modules[b].getKernel())&&b.Vk.restoreMoveEnterPosition();else if(0==c)CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setQuestionTouchBar(V15,"Enter your Move");else if(2==c){d=this.modules[b].cmsiManager.getNextQuestion(d);c=-1;if(d.length)for(e=0;e<this.modules[b].offlinevideoDatabase.results.length;e++)-1!=this.modules[b].offlinevideoDatabase.results[e].Id.indexOf(d)&&(c=e);-1!=c&&c<this.modules[b].offlinevideoDatabase.results.length&&
        this.loadNewOfflineVideo(b,this.modules[b].offlinevideoDatabase.results[c].Id)}}};f.prototype.onVideoEnd=function(b,c){var d=this.modules[b].getKernel();d.PositionMode||(this.modules[b].endEventFired=!0,this.baseurl=V15.config.getVideoPortalUris()[0],c=this.baseurl+"Replay/GetNextIdAtEnd?id="+encodeURIComponent(c)+"&fen="+encodeURIComponent(d.game.getCurPos().toFEN()),$.get(c,function(c){if(c){var e=c.ID,f=c.MSG;2<f.length?this.fnHint(f,b):"3"==c.STATE?(this.fnHint("please try again",b),d&&d.Vk.restoreMoveEnterPosition()):
        2<e.length&&(this.video[b].videoManager.restart(),this.loadNewVideo(b,e))}}.bind(this)).fail(function(){pluginDiv&&this.resizePlugin($(pluginDiv),n)}.bind(this)))};f.prototype.loadNewVideo=function(b,c){for(var d=0;d<this.modules[b].videoDatabase.Items.length;d++)this.modules[b].videoDatabase.Items[d].Id===c&&this.setCaptionText(this.modules[b].videoDatabase.Items[d].Name,b);this.loadVideo(c,b,this.loadVideoGame.bind(this))};f.prototype.loadNewOfflineVideo=function(b,c){CB.System.isElectron()&&"undefined"!==
    typeof electronBridge&&electronBridge.setMediaTouchBar(V15,"Video");var d=this.modules[b].cmsiManager.getFile(c);if(d)this.loadOfflineVideo(this.modules[b].baseDir+d,b,this.loadOfflineVideoGame.bind(this));else{for(d=0;d<this.modules[b].offlinevideoDatabase.results.length;d++)this.modules[b].offlinevideoDatabase.results[d].Id.indexOf===c&&this.setCaptionText(this.modules[b].offlinevideoDatabase.results[d].Name,b);this.loadOfflineVideo(c,b,this.loadOfflineVideoGame.bind(this))}};f.prototype.loadFromLiveVideos=
        function(b,c,d,e){if(0<b.results.length&&!b.results[c].Private){var f=b.results[c].StreamId;this.setCaptionText(b.results[c].ID,d);this.loadLiveVideo(f,d,e);e=this.modules[d].ticket;if(f=this.modules[d].getKernel())f.idGame&&V15.lobby&&V15.lobby.sendFinishKibitzing(f.idGame,e),f.idGame=b.results[c].GameId;this.chat[d]&&this.chat[d].clear();V15.lobby&&V15.lobby.sendStartKibitzing(f.idGame,e);(new CB.Timer(function(){V15.lobby&&V15.lobby.requestChatLog(d,b.results[c].GameId)}.bind(this))).runOnce(500)}};
    f.prototype.loadFromOfflineVideos=function(b,c,d,e){if(0<b.results.length){var f=b.results[c].url;this.setCaptionText(b.results[c].Name,d);this.loadOfflineVideo(f,d,e);if(d=this.modules[d].getKernel())d.idGame=b.results[c].url}};f.prototype.loadFromVideos=function(b,c,d,e){if(b.Items.length){var f=b.Items[c].Id;this.modules[d].getKernel().Vk.videoid=f;this.setCaptionText(b.Items[c].Name,d);this.loadVideo(f,d,e)}};f.prototype.loadLiveVideo=function(b,c,d){(this.modules[c].getKernel().Vk.videoid=b)&&
    this.livevideo[c]&&(this.livevideo[c].videoManager.setUrl(b),d("",c))};f.prototype.onGaAvailable=function(b){this.gameactions=[];if(b)for(var c=this.readerHelper.getHardwareGuid(),d=0;d<b.length;d++){var e=b[d],f=new CB.ScriptCommand;f.time=this.readerHelper.descrambleTime(e.Time);f.type=e.GameActionType;f.action=this.readerHelper.descrambleAction(e.C,f.time,c);0<f.action.length&&this.gameactions.push(f)}else this.modules[0].offlineVideo.videoManager.disable(),this.autostartVideo=!0,this.readerHelper.onActivatedVideoDownload=
        this.onActivatedVideoDownload.bind(this),this.readerHelper.trySilentActivation(this.onSilentActivation.bind(this))};f.prototype.onSilentActivation=function(b){this.readerHelper.showActivateDialog(this.onActivatedVideoDownload.bind(this))};f.prototype.onActivatedVideoDownload=function(b){this.autostartVideo&&this.modules&&this.modules[0]&&this.modules[0].getKernel()&&this.modules[0].getKernel().Vk.videoid&&-1!==this.modules[0].getKernel().Vk.videoid.search(b)&&(this.autostartVideo=!1,(new CB.Timer(function(){this.loadOfflineVideo(this.modules[0].getKernel().Vk.videoid,
        0,this.loadOfflineVideoGame.bind(this));this.readerHelper.removeProgress()}.bind(this))).runOnce(3E3))};f.prototype.loadOfflineVideo=function(b,c,d){if((this.modules[c].getKernel().Vk.videoid=b)&&this.offlinevideo[c]&&(this.offlinevideo[c].videoManager.setUrl(b),0<$("#eastNest"+c).length&&$("#eastNest"+c).jqxSplitter("refresh"),this.setVideoSize(c),d=b.replace(".mp4",".txt").replace(".mp3",".txt"),this.checkGAs(d),this.modules[c].cmsiManager)){for(d=0;d<b.length;d++);this.suppressNotationForCMSI(c)}};
    f.prototype.loadVideo=function(b,c,d){this.modules[c].lastSnippedViewed=0;(this.modules[c].getKernel().Vk.videoid=b)&&this.video[c]&&this.video[c].videoManager.loadVideoFromId(b);this.setLike(c);var e="";V15.isLoggedIn()&&V15.Vf.userName&&(e=V15.Vf.userName);e&&(e=encodeURIComponent(e));this.baseurl=V15.config.getVideoPortalUris()[0];$.get(this.baseurl+"Replay/GetGameActions?id="+b+"&user="+e,function(b){b&&d(b,c)}.bind(this)).fail(function(){this.resizePlugin($(pluginDiv),c)}.bind(this))};f.prototype.getResIcon=
        function(b){switch(b){case 2:return"win";case 1:return"draw";case 0:return"loss"}};f.prototype.getEvalIcon=function(b){switch(b){case CB.AnnoEvalType.EQUAL:return"equal";case CB.AnnoEvalType.BLACK_SLIGHTLY_BETTER:return"blackslightly";case CB.AnnoEvalType.BLACK_BETTER:return"blackbetter";case CB.AnnoEvalType.BLACK_WINS:return"blackwins";case CB.AnnoEvalType.WHITE_WINS:return"whitewins";case CB.AnnoEvalType.WHITE_BETTER:return"whitebetter";case CB.AnnoEvalType.WHITE_SLIGHTLY_BETTER:return"whiteslightly"}};
    f.prototype.isLive=function(b){return this.modules[b]&&this.modules[b].mode==CB.ReaderMode.LIVE};f.prototype.isDiagram=function(b){return this.modules[b].mode==CB.ReaderMode.DIAGRAM};f.prototype.isTable=function(b){return this.modules[b].mode==CB.ReaderMode.TABLE};f.prototype.isPairing=function(b){return this.modules[b].mode==CB.ReaderMode.PAIRING};f.prototype.isAnyVideo=function(b){return this.isVideo(b)||this.isLiveVideo(b)||this.isOfflineVideo(b)||this.isRecorder(b)};f.prototype.isVideo=function(b){return this.modules[b]&&
        this.modules[b].mode==CB.ReaderMode.VIDEO};f.prototype.isLiveVideo=function(b){return this.modules[b]&&this.modules[b].mode==CB.ReaderMode.LIVEVIDEO};f.prototype.isOfflineVideo=function(b){return this.modules[b]&&this.modules[b].mode==CB.ReaderMode.OFFLINEVIDEO};f.prototype.isRecorder=function(b){return this.modules[b]&&this.modules[b].mode==CB.ReaderMode.RECORDER};f.prototype.hasChat=function(b){return this.isVerti||CB.System.isMobile()&&!CB.System.isAtLeastTablet()||700>window.innerHeight||1340>
    window.innerWidth||CB.System.runsInIFrame()?!1:this.modules[b].mode==CB.ReaderMode.LIVE||this.modules[b].mode==CB.ReaderMode.LIVEVIDEO};f.prototype.hasBook=function(b){return 0<=b&&this.isAnyVideo(b)||!this.modules[b]||0<=b&&this.modules[b].noBook||CB.System.runsInIFrame()||!CB.System.runsOnChessBaseDomain()?!1:!CB.System.isMobile()||800<window.innerHeight&&1500<window.innerWidth};f.prototype.hasCaptionBar=function(b){return this.isOfflineVideo(b)?!1:(this.runsOnChessBaseNews()||CB.System.runsOnVideosChessBaseCom())&&
        1E3<window.innerWidth&&700<window.innerHeight};f.prototype.getCaptionHeight=function(b){return $("#cbcaption"+b).outerHeight()};f.prototype.getBottomHeight=function(b){return 0};f.prototype.setCaptionText=function(b,c){$("#cbcaption"+c).text(b)};f.prototype.setSingleGameCaption=function(b,c){this.setCaptionText(b.hdr.getStrPlayers(!1,99),c)};f.prototype.usesOnlineDB=function(){return this.hasBook(this.nActivePlugin)};f.prototype.getGridFields=function(b,c){var d=function(b,c){var d=0,e=0,f=0,g=0,
        h=/([0-9]*)\.?([0-9]*)/i;"number"===typeof b?d=b:(b=b.match(h),b[1]&&(d=parseInt(b[1])),b[2]&&(f=parseInt(b[2])));"number"===typeof c?e=c:(c=c.match(h),c[1]&&(e=parseInt(c[1])),c[2]&&(g=parseInt(c[2])));return 100*e+g-100*d-f},e=[];420>b?e=[{name:"White",type:"text",width:Math.floor(.25*b)},{name:"EloW",type:"text",width:Math.floor(.11*b)},{name:"Black",type:"text",width:Math.floor(.25*b)},{name:"EloB",type:"text",width:Math.floor(.11*b)},{name:"Res",type:"text",width:Math.floor(.1*b)}]:580>b?(e=
        [{name:"White",type:"text",width:Math.floor(.23*b)},{name:"EloW",type:"number",width:Math.floor(.09*b)},{name:"Black",type:"text",width:Math.floor(.23*b)},{name:"EloB",type:"number",width:Math.floor(.09*b)},{name:"Res",type:"text",width:Math.floor(.1*b)}],c||e.push({name:"ECO",type:"text",width:Math.floor(.05*b)})):(e=[{name:"White",type:"text",width:Math.floor(.1*b)},{name:"EloW",type:"number",width:Math.floor(.05*b)},{name:"Black",type:"text",width:Math.floor(.1*b)},{name:"EloB",type:"number",width:Math.floor(.05*
            b)},{name:"Res",type:"text",width:Math.floor(.04*b)}],c||(e.push({name:"Year",type:"number",width:Math.floor(.05*b)}),e.push({name:"ECO",type:"text",width:Math.floor(.045*b)})),e.push({name:"Event",type:"text",width:Math.floor(.16*b)}));360<b&&((420<b||!c&&400<b)&&e.push({name:"Rnd",type:"number",width:Math.floor(.04*b),sorter:d}),600<b&&e.push({name:"Len",type:"number",width:Math.floor(.03*b)}),c&&(e=[{name:"Stat",type:"staticon",width:Math.min(30,Math.floor(.05*b))}].concat(e)));e.forEach(function(b){"White"==
    b.name||"Black"==b.name?b.css="jsg-player":"EloW"==b.name||"EloB"==b.name?(b.css="jsg-elo",b.align="center"):"ECO"==b.name?(b.css="jsg-eco",b.align="center"):"Res"==b.name&&(b.css="jsg-result",b.align="center",c&&(b.type="resicon",b.css="jsg-icon"));"Event"==b.name&&(b.css="jsg-event")});return e};f.prototype.getVideoGridFields=function(b,c){c=[];c=[{name:"Duration",type:"text",width:Math.floor(.2*b)},{name:"Name",type:"text",width:Math.floor(.6*b)}];c.forEach(function(b){"Name"==b.name?b.css="jsg-name":
        "Duration"==b.name?b.css="jsg-duration":"Created"==b.name&&(b.css="jsg-created")});return c};f.prototype.getLiveVideoGridFields=function(b,c){c=[];c=[{name:"Name",type:"text",width:Math.floor(.6*b)},{name:"Connections",type:"number",width:Math.floor(.2*b)}];c.forEach(function(b){"Name"==b.name&&(b.css="jsg-name");"Connections"==b.name&&(b.css="jsg-name")});return c};f.prototype.getOfflineVideoGridFields=function(b,c){c=[];c=[{name:"Name",type:"text",width:Math.floor(.6*b)}];c.forEach(function(b){"Name"==
    b.name&&(b.css="jsg-name")});return c};f.prototype.resizePlugin=function(b,c){this.inDestroy||(this.isDiagram(c)?this.resizeDiagram(b,c):this.isTable(c)?this.resizeTable(b,c):this.isPairing(c)?this.resizePairings(b,c):this.isTabbedLayout()?this.resizePluginTabbed(b,c):this.resizePluginHori(b,c),this.isLive(c)&&this.refreshGridIcons(c))};f.prototype.resizePluginHori=function(b,c){CB.LOG("ResPlugInH: "+c+" - "+window.innerWidth+"/"+window.innerHeight,"","resize");if(b&&this.modules&&this.modules[c]){var d=
        this.getCaptionHeight(c);d?(d+=this.getBottomHeight(c),$("#rootParent"+c).height("calc( 100% - "+d+"px )")):$("#rootParent"+c).height("100%");d=this.getGameCount(c);var e=1<d;if(this.isLiveVideo(c)||this.isRecorder(c))e=!0;$(b).find(".cbmove").filter(":last");900<$(b).scrollTop()&&this.isOnChessBaseCom()&&this.maximized!=c&&$(b).css("width","112%");this.showHidePrevNext(c,e);CB.System.isAtLeastTablet()?$("#b-btnSave-"+c).show():$("#b-btnSave-"+c).hide();var f=this.getButtonConfig().getLineHBoard(),
        g=b.width();b=b.height();var h=this.getEngineH(c,$("#westSouth"+c).height(),e),k=e?.72*b-f-h:b-f-h;400>k&&(k=400);k>.5*g&&(k=.5*g,e||(h=b-f-k));k=g-(g-k);$("#east"+c)[0].style.height="100%";$("#west"+c)[0].style.height="100%";this.resizeNotaHori(c);this.chat[c]&&this.chat[c].resize();this.book[c]&&this.book[c].resize();$("#boardHolder"+c)[0].style.width="100%";$("#boardHolder"+c)[0].style.height="calc( 100% - "+f+"px )";$("#belowBoard"+c)[0].style.width="100%";$("#belowBoard"+c)[0].style.height=f+
        2+"px";$("#buttons"+c)[0].style.width="100%";$("#buttons"+c)[0].style.height="100%";f=$("#boardHolder"+c).width();var q=$("#boardHolder"+c).height();this.modules[c].boardArea&&!this.modules[c].boardArea.canvas&&(this.isLive(c)?this.createMultiBoard(c):(this.modules[c].boardArea.createCanvas(this.modules[c].getKernel(),{topDist:0,bottomDist:0,marginDistDivisor:40,bigCoords:!0,shiftXPercent:-1.7,minWForCoordinates:240,boardShadow:!0}),this.modules[c].getKernel().boardWin.onReadyHandlers.add(this.modules[c].onBoardReady.bind(this.modules[c]))));
        this.adaptMaxKernels(c,f,q);this.launchResizeBoard(c,f,q,700);this.resizeEngineAndListHori(c,e,h,d,k);this.checkShowFullBtn(g,b,c);this.setButtonImages("b",this.boardBtns[c],this.getButtonConfig().getBtnHBoard(),this.getButtonConfig().getCssBoard(),c,"Reader");this.setButtonImages("n",this.notaBtns,this.getButtonConfig().btnHNota,this.getButtonConfig().getCssNota(),c,"Reader");this.setNotaSize(c);this.setVideoSize(c);$("#eastUpDownNest"+c).jqxSplitter("refresh")}};f.prototype.getBoardTopOffset=function(){return 900>
    window.innerHeight?0:10};f.prototype.setNotaSize=function(b){var c=CB.$("#notaparent"+b).single();if(c){var d=c.offsetWidth;c=c.offsetHeight;this.modules[b]&&this.modules[b].nota&&this.modules[b].nota.setSize(d,c)}};f.prototype.setVideoSize=function(b){if(this.isLiveVideo(b)){if(this.livevideo){var c=CB.$("#videoparent"+b).single(),d=c.offsetWidth;c=c.offsetHeight;this.livevideo[b].resize(d,c)}}else this.isOfflineVideo(b)?this.offlinevideo&&(c=CB.$("#videoparent"+b).single())&&(d=c.offsetWidth,c=
        c.offsetHeight,this.offlinevideo[b].resize(d,c)):this.isVideo(b)?this.video&&(c=CB.$("#videoparent"+b).single())&&(d=c.offsetWidth,c=c.offsetHeight,this.video[b].resize(d,c)):this.isRecorder(b)&&this.recorder&&(c=CB.$("#videoparent"+b).single())&&(d=c.offsetWidth,c=c.offsetHeight,this.recorder[b].resize(d,c))};f.prototype.resizePluginTabbed=function(b,c){CB.LOG("ResPlugInT: "+c+" winW="+window.innerWidth+", winH="+window.innerHeight,"","resize");if(b&&this.modules&&this.modules[c]){$(b).css("width",
        "100vw");CB.System.runsOnVideosChessBaseCom()?$(b).css("height","80vh"):CB.System.runsOnLiveChessBaseCom()?CB.System.isFullScreen()?$(b).css("height","100vh"):$(b).css("height","92vh"):$(b).css("height","100vh");$(b).css("min-width","300px");$(b).css("min-height","300px");$(b).find(".cbmove").filter(":last");this.isOnChessBaseCom()&&$(b).css("height",.8*window.innerHeight+"px");var d=this.getGameCount(c),e=1<d;if(this.isLiveVideo(c)||this.isOfflineVideo(c)||this.isRecorder(c))e=!0;e||this.showHideGamesTab(c,
        e);this.showHidePrevNext(c,e);var f=this.getButtonConfig().getLineHBoard();if(this.isVideo(c)||this.isLiveVideo(c)||this.isOfflineVideo(c))f=0;this.getButtonConfig();var g=b.width(),h=b.height(),k=0;this.ribbonButtonsVisible(c)&&(k=$("#tabNavButtons"+c).height());$("#tabNavButtons"+c).width();var q=$("#north"+c).height(),l=q-f-1;$("#boardHolder"+c)[0].style.width="100%";$("#boardHolder"+c)[0].style.height=l+"px";$("#belowBoard"+c)[0].style.width="100%";$("#belowBoard"+c)[0].style.height=f+"px";$("#buttons"+
        c)[0].style.width="100%";$("#buttons"+c)[0].style.height="100%";this.modules[c].boardArea.canvas||this.modules[c].boardArea.createCanvas(this.modules[c].getKernel(),{topDist:2.3*V15.config.board2DBottomOffset,bottomDist:V15.config.board2DBottomOffset,marginDistDivisor:26.5,shiftXPercent:-1.7,minWForCoordinates:240,boardShadow:!0,addTitle:!0,noClock:!this.isLive(c)});f=$("#boardHolder"+c).width();l=$("#boardHolder"+c).height();this.launchResizeBoard(c,f,l,800);this.isListTabVisible(c)?(k=h-k,this.isAnyVideo(c)?
        this.resizeVideoAndListTabbed(c,e,0,d,g-6,k-q-12):this.resizeEngineAndListTabbed(c,e,0,d,g-6,k-q-12)):(this.listResized[c]=!1,$("#listParent"+c).hide());this.checkShowFullBtn(g,h,c);this.setButtonImages("b",this.boardBtns[c],this.getButtonConfig().getBtnHBoard(),this.getButtonConfig().getCssBoard(),c,"Reader");this.setButtonImages("n",this.notaBtns,this.getButtonConfig().btnHNota,this.getButtonConfig().getCssNota(),c,"Reader");$("#buttons"+c)[0].style.width="100%";$("#buttons"+c)[0].style.height=
        32;this.isNotaTabVisible(c)?this.resizeNotaTabbed(b,c,h-q-12):this.notaResized[c]=!1;this.isVideoTabVisible(c)&&this.resizeVideoTabbed(b,c)}};f.prototype.ribbonButtonsVisible=function(b){return 1<this.getGameCount(b)||this.isLiveVideo(b)||this.isOfflineVideo(b)||this.isRecorder(b)};f.prototype.showRibbonButtons=function(b,c){c?$("#tabNavButtons"+b)[0].style.height="32px":$("#tabNavButtons"+b)[0].style.height="0px"};f.prototype.resizePluginVerti=function(b,c){CB.LOG("ResPlugInV: "+c+" - "+window.innerWidth+
        "/"+window.innerHeight,"","resize");if(b&&this.modules&&this.modules[c]){var d=this.getGameCount(c),e=1<d;this.isLiveVideo(c)&&(e=!0);$(b).find(".cbmove").filter(":last");900<$(b).scrollTop()&&this.isOnChessBaseCom()&&this.maximized!=c&&$(b).css("width","112%");$(b).css("height","240vw");$("#b-btnSave-"+c).hide();this.showHidePrevNext(c,e);e||$("#southNest"+c).jqxSplitter({showSplitBar:!1,panels:[{size:"100%"},{size:"0%"}]});var f=this.getButtonConfig().getLineHBoard();this.getButtonConfig();var g=
        b.width(),h=b.height();500>g&&($(b).css("width","100vw"),g=b.width(),$(b).css("min-width","100px"),$(b).css("max-width","1000px"));$("#south"+c)[0].style.width="100%";$("#north"+c)[0].style.width="100%";$("#southNorth"+c).height();$("#notaEl"+c).css("font-size",this.isMaximized()&&1E3<window.innerWidth?"1.1em":"0.8em");$("#boardHolder"+c)[0].style.width="100%";$("#boardHolder"+c)[0].style.height="calc( 100% - "+f+"px )";$("#belowBoard"+c)[0].style.width="100%";$("#belowBoard"+c)[0].style.height=f+
        2+"px";$("#buttons"+c)[0].style.width="100%";$("#buttons"+c)[0].style.height="100%";this.modules[c].boardArea.canvas||this.modules[c].boardArea.createCanvas(this.modules[c].getKernel(),{topDist:V15.config.board2DBottomOffset,bottomDist:V15.config.board2DBottomOffset,marginDistDivisor:26.5,shiftXPercent:-1.7,minWForCoordinates:240,boardShadow:!0});f=$("#boardHolder"+c).width();var k=$("#boardHolder"+c).height();this.launchResizeBoard(c,f,k,1E3);this.resizeEngineAndListVerti(c,e,0,d,b.width());this.checkShowFullBtn(g,
        h,c);this.setButtonImages("b",this.boardBtns[c],this.getButtonConfig().getBtnHBoard(),this.getButtonConfig().getCssBoard(),c,"Reader");this.setButtonImages("n",this.notaBtns,this.getButtonConfig().btnHNota,this.getButtonConfig().getCssNota(),c,"Reader");this.setNotaSize(c);this.setVideoSize(c)}};f.prototype.showHidePrevNext=function(b,c){var d=!1,e=$("#buttons"+b).width();(this.isLive(b)||c)&&(600<e||this.isTabbedLayout())?($("#b-btnLoadNext-"+b).show(),$("#b-btnLoadPrev-"+b).show(),$("#n-btnLoadNext-"+
        b).show(),$("#n-btnLoadPrev-"+b).show(),d=!0):($("#b-btnLoadNext-"+b).hide(),$("#b-btnLoadPrev-"+b).hide(),$("#n-btnLoadNext-"+b).hide(),$("#n-btnLoadPrev-"+b).hide());550<e||this.isTabbedLayout()?$("#b-btnGoBegin-"+b).show():$("#b-btnGoBegin-"+b).hide();550<e||this.isTabbedLayout()&&!d?$("#b-btnGoEnd-"+b).show():$("#b-btnGoEnd-"+b).hide()};f.prototype.showHideGamesTab=function(b,c){c||$("#t-btnSelList-"+b).hide()};f.prototype.resizeBoard=function(b,c,d){this.boardTimer[b]&&this.boardTimer[b].stop();
        this.modules[b].boardArea.setSize(c,d);this.modules[b].multiBoard&&(this.adaptMaxKernels(b,c,d),this.modules[b].multiBoard.resize(c,d))};f.prototype.adaptMaxKernels=function(b,c,d){if(this.modules[b].multiBoard&&!(100>d)){var e=1;c/=d;160<d&&1.25<c&&(e=1.9<c||800<d?2.3<c?3.3<c||600<d?9:7:2.3<c&&450<d||800<d?7:5:480<d&&(1.8<c||900<d)?5:3);d=this.modules[b].changeNKernels(e,this);if(e>d){c=0;for(var f=d;c<e-d&&f<this.modules[b].list.length;f++){var g=this.modules[b].list[f].id;this.hasKernelOfId(b,
        g)||(w(g,b),c++)}}}};f.prototype.hasKernelOfId=function(b,c){for(var d=0;d<this.modules[b].kernel.length;d++)if(this.modules[b].kernel[d].idGame==c)return!0;return!1};f.prototype.createMultiBoard=function(b){var c=this.modules[b].boardArea.createCanvas({createControl:function(b,c,d){var e=this.getMultiBoardOptions();e.suppressCalcGeometry=!0;b=new CB.MultiBoard(b,c,d,e);b.onClickBoard=this.onClickBoard.bind(this);b.onDblClick=this.onDblClickBoard.bind(this);return b}.bind(this),onControlReady:function(){V15.chessAudio||
        (V15.chessAudio=new CB.ChessAudio(V15.config.getExternalCommonPath()+"Media/Sounds/"),(new CB.Timer(function(){V15.chessAudio.loadAll()})).runOnce(5E3))}},this.getMultiBoardOptions()),d=this.createBoardWin(c,this.getMultiBoardOptions());this.modules[b].getKernel().setBoardWin(d);this.modules[b].getKernel().Vk.createGUIElements(d);this.modules[b].boardArea.setVisible(!0);c=c.control;this.modules[b].multiBoard=c;c.addBoard(d,null)};f.prototype.createBoardWin=function(b,c){b=new CB.BoardControl(b,100,
        100,"FirstB",c);b.animSteps={forMove:2,forPosition:2};CB.System.isMobile()&&(b.animSteps={forMove:.6,forPosition:.5});b.singleClickDisabled=!0;b.allowInput=!0;return b};f.prototype.onClickBoard=function(b,c){1==this.pluginCnt&&(this.nActivePlugin=0);0<=this.nActivePlugin&&this.stopAutoplay(this.nActivePlugin);this.changeSelectedGameKernel(b)};f.prototype.onDblClickBoard=function(b,c){1==this.pluginCnt&&(this.nActivePlugin=0);0<=this.nActivePlugin&&this.trySwapWithBigBoard(b,this.nActivePlugin,!0);
        c.preventDefault()};f.prototype.changeSelectedGameKernel=function(b){if(0>this.nActivePlugin)if(1===this.pluginCnt)this.nActivePlugin=0;else return;var c=this.modules[this.nActivePlugin];try{c.getKernel().releaseCommandHandlers();c.selectKernelByIdGame(b);var d=c.getKernel();d.linkCommandHandlers();var e=d.game,f=this.modules[this.nActivePlugin].nota;e&&f&&(d.Vk.saveToCloud(),f.setGame(e),d.forceTBUpdate=!0,d.boardWin&&(d.nextCurPosNoAnim=!1),e.fireOnCurPosChanged(),e.fireOnNavigate());c.multiBoard&&
    c.multiBoard.markBoardByGameId&&c.multiBoard.markBoardByGameId(b);this.setGameStat(this.nActivePlugin,b,"watch");d.boardWin&&(d.boardWin.markLastMove(!1,!0),V15.aTBLobby.isConnected()&&(V15.aTBLobby.requestWithTicket(b,d.getCurPos(),this.tbTableHandler.bind(this)),d.boardWin.setEvaluationInvalid()))}catch(C){CB.LogException("RWM:chngSelectedKernel",C)}};f.prototype.checkShowFullBtn=function(b,c,d){b>.9*window.innerWidth&&c>.9*window.innerHeight&&this.maximized!=d?$("#b-btnFullScreen-"+d).hide():$("#b-btnFullScreen-"+
        d).show()};f.prototype.resizeNotaHori=function(b){CB.LOG("ResizeNota_"+b,"","resize ");if($("#eastNest"+b)&&$("#eastNest"+b)[0]){var c=this.getButtonConfig().lineHNota;this.isOfflineVideo(b)&&(c=0);$("#eastNest"+b)[0].style.height="100%";$("#eastLayer"+b)[0].style.height="100%";$("#eastUpDownNest"+b)[0].style.height="100%";$("#eastUpDownNest"+b)[0].style.width="100%";this.hasChat(b)||($("#eastNest"+b)[0].style.width="100%");this.hasBook(b)||this.isAnyVideo(b)||($("#notaNest"+b)[0].style.height="100%");
        var d=$("#notaNest"+b).height()-c;$("#notaparent"+b)[0].style.height=d+"px";this.isAnyVideo(b);$("#notaEl"+b).css("font-size",this.isMaximized()&&1E3<window.innerWidth?"1.3em":"0.9em");this.isOfflineVideo(b)||($("#belowNota"+b)[0].style.width="calc( 100% + 1px )",$("#belowNota"+b)[0].style.height=c+"px",$("#belowNota"+b)[0].style.top=d+"px")}};f.prototype.getEngineH=function(b,c,d){c=Math.max(Math.min(c,50),d?Math.min(.35*c,90):Math.min(.35*c,110));!this.modules[b].engineOpen&&d&&(c=0);return c};
    f.prototype.getGameCount=function(b){if(this.modules&&this.modules[b]){if(this.modules[b].livevideoDatabase)return this.modules[b].livevideoDatabase.results.length;if(this.modules[b].offlinevideoDatabase)return this.modules[b].offlinevideoDatabase.results.length;if(this.modules[b].videoDatabase&&this.modules[b].videoDatabase.Items)return this.modules[b].videoDatabase.Items.length;if(this.modules[b].pgnDatabase)return this.modules[b].pgnDatabase.getGameCount();if(this.modules[b].requestData&&this.modules[b].requestData.isList())return Math.max(2,
        this.modules[b].list.length)}return 0};f.prototype.resizeEngineAndListHori=function(b,c,d,e,f){c?$("#engineParent"+b)[0].style.height=d+"px":$("#engineParent"+b)[0].style.height="100%";$("#engineParent"+b)[0].style.width="100%";this.modules[b].engineOpen||!c?($("#engineParent"+b).show(),!c&&$("#replayinfo"+b)[0]&&($("#replayinfo"+b)[0].style.height="100%")):($("#engineParent"+b).hide(),d=0);$("#listParent"+b)[0].style.width="100%";$("#listParent"+b)[0].style.height="calc( 100% - "+d+"px )";c&&this.gridCreated&&
    ($("#listParent"+b).jsGrid("option","height","calc( 100% - "+d+"px )"),$("#listParent"+b).jsGrid("option","width","100%"),$("#listParent"+b).jsGrid("option","heading",!0),this.isOfflineVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getOfflineVideoGridFields(this.getGridWidth(b),this.isLive(b))):this.isLiveVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getLiveVideoGridFields(this.getGridWidth(b),this.isLive(b))):this.isVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getVideoGridFields(this.getGridWidth(b),
        this.isLive(b))):$("#listParent"+b).jsGrid("option","fields",this.getGridFields(this.getGridWidth(b),this.isLive(b))))};f.prototype.resizeEngineAndListTabbed=function(b,c,d,e,f,g){$("#engineParent"+b).hide();$("#listParent"+b)[0].style.height=g+"px";$("#listParent"+b)[0].style.width=f+"px";c&&this.gridCreated&&($("#listParent"+b).jsGrid("option","height",g+"px"),$("#listParent"+b).jsGrid("option","width",f+"px"),$("#listParent"+b).jsGrid("option","heading",!0),this.isOfflineVideo(b)?$("#listParent"+
        b).jsGrid("option","fields",this.getOfflineVideoGridFields(f,this.isLive(b))):this.isLiveVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getLiveVideoGridFields(f,this.isLive(b))):this.isVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getVideoGridFields(f,this.isLive(b))):$("#listParent"+b).jsGrid("option","fields",this.getGridFields(f,this.isLive(b))))};f.prototype.resizeVideoAndListTabbed=function(b,c,d,e,f,g){$("#engineParent"+b).hide();$("#videoParent"+b)[0].style.height=g-
        34+"px";$("#videoParent"+b)[0].style.width=f+"px";this.setVideoSize(b);$("#listParent"+b)[0].style.height=g+"px";$("#listParent"+b)[0].style.width=f+"px";c&&this.gridCreated&&($("#listParent"+b).jsGrid("option","height",g+"px"),$("#listParent"+b).jsGrid("option","width",f+"px"),$("#listParent"+b).jsGrid("option","heading",!0),this.isOfflineVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getOfflineVideoGridFields(f,this.isLive(b))):this.isLiveVideo(b)?$("#listParent"+b).jsGrid("option","fields",
        this.getLiveVideoGridFields(f,this.isLive(b))):this.isVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getVideoGridFields(f,this.isLive(b))):$("#listParent"+b).jsGrid("option","fields",this.getGridFields(f,this.isLive(b))))};f.prototype.resizeEngineAndListVerti=function(b,c,d,e,f){$("#engineParent"+b).hide();$("#listParent"+b)[0].style.width="100%";$("#listParent"+b)[0].style.height="100%";c&&this.gridCreated&&($("#listParent"+b).jsGrid("option","height","100%"),$("#listParent"+b).jsGrid("option",
        "width","100%"),$("#listParent"+b).jsGrid("option","heading",!0),$("#listParent"+b).jsGrid("option","fields",this.getGridFields(f,this.isLive(b))))};f.prototype.resizeNotaTabbed=function(b,c){var d=0;this.ribbonButtonsVisible(c)&&(d=$("#tabNavButtons"+c).height());var e=$("#tabNavButtons"+c).width();var f=$("#north"+c).height();f=$(b).height()-f;b=this.getButtonConfig().lineHNota;this.isAnyVideo(c)&&($("#videoparent"+c).css("height",f-d),$("#videoparent"+c).css("width",e+1));$("#notaEl"+c).css("height",
        f-b);$("#notaEl"+c).css("font-size",this.isMaximized()&&1E3<window.innerWidth?"1.1em":"0.9em");f=$("#south"+c).height()-d;$("#notaEl"+c).css("height",f);this.modules[c].nota.setSize(e,f);this.modules[c].nota.scrollCurElemIntoView()};f.prototype.resizeVideoTabbed=function(b,c){this.ribbonButtonsVisible(c)&&$("#tabNavButtons"+c).height();var d=$("#tabNavButtons"+c).width();$("#north"+c).height();var e=$("#south"+c).height();$(b).height();this.isAnyVideo(c)&&($("#videoParent"+c)[0].style.height=e-34+
        "px",$("#videoparent"+c).css("height",e-34),$("#videoparent"+c).css("width",d+1),this.setVideoSize(c))};f.prototype.getGridWidth=function(b){return $("#listParent"+b).width()};f.prototype.getBoardWidth=function(b){return $("#boardHolder"+b).width()};f.prototype.onSplitterResize=function(b){CB.LOG("onSplitRes","","resize");if(this.isTabbedLayout())this.onSplitterResizeVerti(b);else this.onSplitterResizeHori(b)};f.prototype.onSplitterResizeHori=function(b){var c=$("#boardHolder"+b).width(),d=$("#boardHolder"+
        b).height();$("#belowBoard"+b).height();CB.LOG("SplitResizeHori"+c+"/"+d,"","resize");if(this.checkBoardAreaChange(c,d,b)){this.modules[b].boardArea&&this.resizeBoard(b,c,d);d=1<this.getGameCount(b);this.isLiveVideo(b)&&(d=!0);var e=$("#engineParent"+b).height();$("#listParent"+b)&&($("#listParent"+b)[0].style.height="calc( 100% - "+e+"px )");this.showHidePrevNext(b,d);d&&this.gridCreated&&($("#listParent"+b).jsGrid("option","height","calc( 100% - "+e+"px )"),this.isOfflineVideo(b)?$("#listParent"+
        b).jsGrid("option","fields",this.getOfflineVideoGridFields(c,this.isLive(b))):this.isLiveVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getLiveVideoGridFields(c,this.isLive(b))):this.isVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getVideoGridFields(c,this.isLive(b))):$("#listParent"+b).jsGrid("option","fields",this.getGridFields(c,this.isLive(b))));this.setNotaSize(b);this.setVideoSize(b);this.chat[b]&&this.chat[b].resize();this.isLive(b)&&this.refreshGridIcons(b);this.book[b]&&
    this.book[b].resize();this.saveSplitSize("root",b);this.saveSplitSize("westNest",b)}};f.prototype.onRootSplitterCollapse=function(b){this.saveSplitColl("root",b)};f.prototype.onListSplitterCollapse=function(b){this.saveSplitColl("westNest",b)};f.prototype.onChatSplitterCollapse=function(b){this.saveSplitColl("eastNest",b)};f.prototype.onBookSplitterCollapse=function(b){this.saveSplitColl("eastUpDownNest",b)};f.prototype.loadSplitPos=function(b,c){if(this.isVideo(c)||this.isLiveVideo(c)||this.isOfflineVideo(c))return null;
        c=this.isLive(c)?"live":"";var d=V15.Vf.load(b+"size"+c);V15.Vf.load(b+"coll"+c);return{size:parseFloat(d),coll:!1}};f.prototype.saveSplitSize=function(b,c){try{var d=$("#"+b+c);if(d&&d.length){var e=this.isLive(c)?"live":"",f=$(d).jqxSplitter("panels");f&&f[0]&&V15.Vf.save(b+"size"+e,f[0].size)}}catch(C){CB.LogException("RWM:saveSplitSize",C)}};f.prototype.saveSplitColl=function(b,c){};f.prototype.onSplitterResizeVerti=function(b){var c=0;this.ribbonButtonsVisible(b)&&(c=$("#tabNavButtons"+b).height());
        $("#tabNavButtons"+b).width();var d=this.getButtonConfig().getLineHBoard(),e=$("#north"+b).height()-d-1;$("#boardHolder"+b)[0].style.width="100%";$("#boardHolder"+b)[0].style.height=e+"px";$("#belowBoard"+b)[0].style.width="100%";$("#belowBoard"+b)[0].style.height=d+"px";$("#buttons"+b)[0].style.width="100%";$("#buttons"+b)[0].style.height="100%";c=$("#south"+b).height()-c;$("#notaEl"+b).css("height",c);this.modules[b].nota&&this.setNotaSize(b);c=$("#boardHolder"+b).width();d=$("#boardHolder"+b).height();
        $("#belowBoard"+b).height();this.modules[b].boardArea&&this.resizeBoard(b,c,d);d=1<this.getGameCount(b);if(this.isLiveVideo(b)||this.isRecorder(b))d=!0;$("#engineParent"+b)&&$("#engineParent"+b).height();$("#listParent"+b)[0].style.height="100%;";d&&this.gridCreated&&(this.isOfflineVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getOfflineVideoGridFields(c,this.isLive(b))):this.isLiveVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getLiveVideoGridFields(c,this.isLive(b))):this.isVideo(b)?
            $("#listParent"+b).jsGrid("option","fields",this.getVideoGridFields(c,this.isLive(b))):$("#listParent"+b).jsGrid("option","fields",this.getGridFields(c,this.isLive(b))));this.modules[b].getKernel().game.fireOnChanged();this.modules[b].getKernel().game.fireOnHeaderChanged({recalc:!0})};f.prototype.onSouthNestSplitterResizeVerti=function(b,c){c=$(c).width();var d=this.getGameCount(b),e=1<d;this.isLiveVideo(b)&&(e=!0);var f=$("#engineParent"+b).height();e&&this.gridCreated&&$("#listParent"+b).jsGrid("option",
        "fields",this.getGridFields(c,this.isLive(b)));this.resizeEngineAndListHori(b,e,f,d,c);this.modules[b].getKernel().game.fireOnChanged();this.modules[b].getKernel().game.fireOnHeaderChanged({recalc:!0})};f.prototype.onEastSplitterResize=function(b){this.resizeNotaHori(b);this.chat[b]&&this.chat[b].resize();this.book[b]&&this.book[b].resize();this.video[b]&&this.video[b].resize();this.setNotaSize(b);this.setVideoSize(b);this.saveSplitSize("eastNest",b)};f.prototype.onBookSplitterResize=function(b){this.resizeNotaHori(b);
        this.book[b]&&this.book[b].resize();this.saveSplitSize("eastUpDownNest",b)};f.prototype.onVideoSplitterResize=function(b){this.resizeNotaHori(b);this.setVideoSize(b);this.saveSplitSize("eastUpDownNest",b)};f.prototype.getButtonConfig=function(){function b(){return 100<window.innerHeight&&100<window.innerWidth}return CB.System.isMobile()?{getLineHBoard:function(){return b()?60:44},getBtnHBoard:function(){return b()?48:32},getBtnHDiagram:function(c){return b()?32:24},lineHNota:42,btnHNota:32,getCssBoard:function(){return b()?
            "toolBtn toolBtn48":"toolBtn toolBtn32"}.bind(this),getCssDiagrams:function(c){return b()?"toolBtn toolBtn32":"toolBtn toolBtn24"}.bind(this),getCssNota:function(){return"toolBtn toolBtn32"}.bind(this),getCssEngine:function(){return"toolBtn toolBtnV16"}.bind(this),getCssTabNav:function(){return"tabNavBtn tabNavBtn32"}.bind(this)}:{getLineHBoard:function(){return 800<window.innerHeight?44:34}.bind(this),getBtnHBoard:function(){return 800<window.innerHeight?32:24}.bind(this),getBtnHDiagram:function(b){return 250<
        b?24:16},lineHNota:34,btnHNota:24,getCssBoard:function(){return 800<window.innerHeight?"toolBtn toolBtn32":"toolBtn"}.bind(this),getCssDiagrams:function(b){return 250<b?"toolBtn toolBtn24":"toolBtn toolBtn16"}.bind(this),getCssNota:function(){return"toolBtn"}.bind(this),getCssTabNav:function(){return"tabNavBtn tabNavBtn16"}.bind(this),getCssEngine:function(){return"toolBtn toolBtnV16"}.bind(this)}};f.prototype.resizeDiagram=function(b,c){if(b){var d=400,e=b[0].dataset.size;if(e)if(d=e.match(/%/)){if(e.match(/%\/max=/)){var f=
        e.split("=");$(b).css("width",e.substr(0,d.index+1));$(b).css("max-width",f[1].substr(0,f[0].length)+"px")}else $(b).css("width",e);d=$(b).width()}else d=e;e=!!b[0].dataset.bigcoords;$("#aboveDiag"+c).width(d);$("#belowDiag"+c).width(d);d>.9*window.innerWidth&&(d=.9*window.innerWidth,$(b).width(d));f=d;b=.8*f;CB.LOG("Resize Diag:"+d+"/"+d,"","resize");$("#diagarea"+c).width(f);$("#diagarea"+c).height(b);this.modules[c].boardArea.canvas||(this.modules[c].boardArea.createCanvas(this.modules[c].getKernel(),
        {topDist:0,bottomDist:0,marginDistDivisor:0,shiftXPercent:-1.65,minWForCoordinates:200,transparent:!0,bigCoords:e,mixin:this.getDiagramMixin()}),this.modules[c].getKernel().boardWin.onReadyHandlers.add(this.modules[c].onBoardReady.bind(this.modules[c])));$("#diagarea"+c)[0]&&this.modules[c]&&this.modules[c].boardArea&&this.resizeBoard(c,f-1,b-1);this.setButtonImages("d",this.diagramBtns[c],this.getButtonConfig().getBtnHDiagram(b),this.getButtonConfig().getCssDiagrams(b),c,"Reader");b=$("#diagButtons"+
        c);c=$("#diagText"+c);b&&b.height();c&&c.height()}};var m=function(b,c){b.css("font-size",c+"em")};f.prototype.getDiagramMixin=function(){return{addCheckMark:function(){this.addSideIcon({url:CB.getCommonPath()+"Media/Ribbons/Reader/Check48.png",cssClass:"cbBoardCheckMark",boardFract:12})}}};f.prototype.resizeTable=function(b,c){var d=this.modules[c].ranking;d&&(b=$(b),b.html(""),c=b.width(),d=d.toHtml(c),b.append(d),$(b.children()[0]),750>c?m(b,1-(750-c)/1050):m(b,1))};f.prototype.resizePairings=
        function(b,c){var d=this.modules[c].pairing;if(d){b=$(b);b.html("");c=b.width();d=d.RoundToHtml(d.round,c);b.append(d);750>c?m(b,1-(750-c)/1200):m(b,1+(c-750)/4200);b=$(d).find("td").has(".playerImageContainer");b.css("width","0px");b.hide();d=$(d).width();var e=$(b[0]).width();b.css("width",(c-d+2*e)/2+"px");b.show()}};f.prototype.resizeActivePlugin=function(){this.resizePlugin($($(this.allPluginClasses)[this.nActivePlugin]),this.nActivePlugin)};f.prototype.createBoardButtons=function(b,c){var d=
        [];this.isRecorder(c)?d=d.concat([{title:lm.START_RADIO,id:"LiveNew",handler:this.fnStart.bind(this)}]):this.isVideo(c)?CB.System.runsOnVideosChessBaseCom()||(d=d.concat([{title:lm.LIKE,id:"Like",handler:this.fnLike.bind(this)}])):d=d.concat([{title:lm.TAKE_BACK,id:"Retract",handler:this.fnRetract.bind(this)},{title:lm.MAKE_MOVE,id:"Exec",handler:this.fnExec.bind(this)},{title:lm.AUTOPLAY,id:"Autoplay",handler:this.fnAutoplay.bind(this)}]);400<window.innerWidth&&d.push({separator:!0});var e=$("#root0").width();
        !(this.isTabbedLayout()||880<e)||this.isVideo(c)||this.isLiveVideo(c)||this.isOfflineVideo(c)||(380<=window.innerWidth&&d.push({title:lm.GOTO_BEGIN,id:"GoBegin",handler:this.fnGotoStart.bind(this)}),380<window.innerWidth&&d.push({title:lm.GOTO_END,id:"GoEnd",handler:this.fnGotoEnd.bind(this)}),500<window.innerWidth&&d.push({separator:!0}),450<=window.innerWidth&&d.push({title:lm.LOAD_PREV,id:"LoadPrev",handler:this.loadPrevGame.bind(this)}),320<=window.innerWidth&&d.push({title:lm.LOAD_NEXT,id:"LoadNext",
            handler:this.loadNextGame.bind(this)}),500<window.innerWidth&&d.push({separator:!0}));this.isTabbedLayout()||d.push({title:lm.MAXIMIZE,id:"FullScreen",handler:this.fnFullWindow.bind(this)});this.isTabbedLayout()||(CB.System.isMobile()||d.push({separator:!0}),d.push({title:lm.ANALYSIS_ENGINE,id:"Engine",handler:this.fnAnalysis.bind(this)}));500<e&&(d=d.concat([{}]),d.push({title:lm.FLIP_BOARD,id:"Rotate",handler:this.fnFlipBoard.bind(this)}));d=d.concat([{}]);CB.System.isElectron()||CB.System.isCordova()||
        d.push({title:lm.DOWNLOAD_PGN,id:"Save",handler:this.fnSaveDB.bind(this)});1300<window.innerWidth&&!this.isAnyVideo(c)&&(d=d.concat([{}]),d.push({title:lm.SOUND_ONOFF,id:"SoundOn",handler:this.fnSound.bind(this),css:"btnSound"}));1E3<window.innerWidth&&(d=d.concat([{}]),d.push({title:lm.PIECES,id:"Pieces",handler:this.fnPieces.bind(this),css:"btnPieces"}));this.isTabbedLayout()&&(this.isVideo(c)||this.isLiveVideo(c)||this.isOfflineVideo(c))&&(d=[]);this.boardBtns[c]=d;e=this.getButtonConfig().getCssBoard();
        try{this.instantiateButtons("button",b,"b",d,e,c)}catch(A){}this.soundBtnSelector[c]="#b-btnSoundOn-"+c};f.prototype.createTabNavButtons=function(b,c){var d=[];d=d.concat([{title:"Notation",id:"SelNota",txt:lm.NOTATION,handler:this.fnSelectNota.bind(this)}]);d=d.concat([{title:"List",id:"SelList",txt:lm.GAMES,handler:this.fnSelectList.bind(this)}]);if(this.isVideo(c)||this.isLiveVideo(c)||this.isOfflineVideo(c)||this.isRecorder(c))d=d.concat([{title:"Video",id:"SelVideo",txt:"Video",handler:this.fnSelectVideo.bind(this)}]);
        CB.System.runsOnLiveChessBaseCom()&&(d=d.concat([{title:"Index",id:"SelHome",txt:"Index",handler:this.fnSelectBack.bind(this)}]));this.tabNavBtns[c]=d;var e=this.getButtonConfig().getCssTabNav();this.instantiateButtons("button",b,"t",d,e,c)};f.prototype.shakeFullWinBtn=function(b){$("#b-btnFullScreen-"+b).addClass("shakeShort")};f.prototype.stopShakeFullWinBtn=function(b){$("#b-btnFullScreen-"+b).removeClass("shakeShort")};f.prototype.createDiagramReplayButtons=function(b,c,d){var e=[],f=V15.config.diaStyleSuffix;
        if(c.dataset.play||c.dataset.choice)e=e.concat([{title:"Restart",id:"Repeat",pic:"Repeat"+f,handler:this.fnRestart.bind(this)}]);e=e.concat([{title:lm.TAKE_BACK,id:"Retract",pic:"Retract"+f,handler:this.fnRetract.bind(this)},{title:lm.MAKE_MOVE,id:"Exec",pic:"Exec"+f,handler:this.fnExec.bind(this)}]);360<=$(c).width()&&"replayonly"!=c.dataset.buttons&&(e=e.concat([{},{}]),e.push({title:lm.FLIP_BOARD,id:"Rotate",handler:this.fnFlipBoard.bind(this)}));c.dataset.hint?(e=e.concat([{}]),e.push({title:"Hint",
            id:"Hint",pic:"Hint"+f,handler:function(b){this.fnHint(c.dataset.hint,b)}.bind(this)})):(e=e.concat([{}]),e.push({title:"Help",id:"Hint",pic:"Hint"+f,handler:function(b){this.fnHelp(c.dataset.help,b)}.bind(this)}));c.dataset.solution&&e.push({title:"Solution",id:"Solution",handler:function(b){this.fnSolution(c.dataset.solution,b)}.bind(this)});"replayonly"!=c.dataset.buttons&&(e=e.concat([{},{}]),e.push({title:"Download FEN",id:"Save",handler:this.fnSaveFEN.bind(this)}));this.diagramBtns[d]=e;f=this.getButtonConfig().getCssDiagrams();
        try{this.instantiateButtons("button",b,"d",e,f,d)}catch(C){}};f.prototype.createDiagramAnimButtons=function(b,c,d){c=[];var e=V15.config.diaStyleSuffix;c=c.concat([{title:"Rewind",id:"ActionRewind",pic:"ActionRewind"+e,handler:this.fnAnimRewind.bind(this)},{title:"Back",id:"ActionGotoPrev",pic:"ActionGotoPrev"+e,handler:this.fnAnimBack.bind(this)},{title:"Play",id:"ActionPlay",pic:"ActionPlay"+e,handler:this.fnAnimPlay.bind(this)},{title:"Step",id:"ActionGotoNext",pic:"ActionGotoNext"+e,handler:this.fnAnimStep.bind(this)},
        {title:"Pause",id:"ActionPause",pic:"ActionPause"+e,handler:this.fnAnimPause.bind(this)}]);this.diagramBtns[d]=c;e=this.getButtonConfig().getCssDiagrams();this.instantiateButtons("button",b,"d",c,e,d)};f.prototype.fn3D=function(b){this.toggle3DBoard(b)};f.prototype.setAutoplayBtnImg=function(b,c){c=$(String.f("#b-btnAutoplay-{0}",c));var d='url( "'+CB.getCommonPath()+'Media/Ribbons/Reader/{0}{1}.png" )';b?c.css("background-image",String.f(d,"Stop",this.getButtonConfig().getBtnHBoard())):c.css("background-image",
        String.f(d,"Autoplay",this.getButtonConfig().getBtnHBoard()))};f.prototype.canUseEngine=function(){return CB.EngineInstance.isAjax||-1!=document.URL.search(/chessbase.com/i)||-1!=document.URL.search(/localhost/i)};f.prototype.createNotaButtons=function(b,c){var d=[];!this.socialMedia||CB.System.isElectron()||CB.System.isCordova()||(d.push({title:"Like game",id:"LikeGame",handler:function(){V15.isLoggedIn()?($("#n-btnLikeGame-0").attr("disabled",!0),V15.panelMgr.likeGame(V15.panelMgr.modules[c].getKernel().game),
            $("#n-btnLikeGame-0").removeAttr("disabled")):V15.panelMgr.showAlert("You need to be logged in to like games.",350,130)}}),d.push({title:"Share game",id:"ShareGame",handler:function(){$("#n-btnShareGame-0").attr("disabled",!0);V15.panelMgr.shareGame(V15.panelMgr.modules[c].getKernel().game);$("#n-btnShareGame-0").removeAttr("disabled")}.bind(this)}));CB.System.isElectron()||CB.System.isCordova()||d.push({title:lm.SAVE+" (Ctrl-S)",id:"Save",handler:this.fnSave.bind(this)});d.push({title:"Toggle Variation Folding",
        id:"UnFoldAll",handler:function(){this.modules[c]&&this.modules[c].nota&&this.modules[c].nota.unfoldAll()}.bind(this)});d.push({title:lm.PROMOTE_LINE+" (Alt-up)",id:"PromoteLine",handler:this.fnPromoteLine.bind(this)});d.push({title:lm.DELETE_LINE+" (Del)",id:"DeleteLine",handler:this.fnDeleteLine.bind(this)});d.push({title:lm.CUT_LINE+" (})",id:"CutLine",handler:this.fnCutLine.bind(this)});d.push({title:lm.UNANNOTATE+" (Ctrl-Shift-Y)",id:"Unannotate",handler:this.fnUnannotate.bind(this)});d.push({title:"Undo (Ctrl-Z)",
        id:"Undo",handler:this.fnUndo.bind(this)});d.push({title:"Redo (Ctrl-Y)",id:"Redo",handler:this.fnRedo.bind(this)});CB.System.isElectron()||CB.System.isCordova()||(d.push({title:"Copy FEN to clipboard",id:"Fen",handler:this.fnSaveNotaFEN.bind(this)}),d.push({title:"Check Database",id:"OnlineDB",handler:this.fnOnlineDB.bind(this)}));!CB.System.isElectron()&&!CB.System.isCordova()&&1600<window.innerWidth&&(d.push({title:"-> MyGames",id:"MyGames",handler:this.fnMyGames.bind(this)}),d.push({title:"-> Fritz",
        id:"FritzOnline",handler:this.fnFritz.bind(this)}));1200<window.innerWidth&&d.push({title:"Live Games Running Now",id:"LiveNew",handler:this.fnLivePlaychess.bind(this)});this.notaBtns=d;var e=this.getButtonConfig().getCssNota();try{this.instantiateButtons("button",b,"n",d,e,c)}catch(A){}};f.prototype.createNotaButtonsTabbed=function(b,c){var d=[];this.isVideo(c)||this.isLiveVideo(c)||this.isOfflineVideo(c)||(d.push({title:"Load Prev",id:"LoadPrev",handler:this.loadPrevGame.bind(this)}),d.push({title:"Load Next",
        id:"LoadNext",handler:this.loadNextGame.bind(this)}),d.push({separator:!0}));d.push({title:lm.UNANNOTATE+" (Ctrl-Shift-Y)",id:"Unannotate",handler:this.fnUnannotate.bind(this)});d.push({separator:!0});d.push({title:"Undo (Ctrl-Z)",id:"Undo",handler:this.fnUndo.bind(this)});CB.System.isElectron()||CB.System.isCordova()||d.push({title:lm.SAVE+" (Ctrl-S)",id:"Save",handler:this.fnSave.bind(this)});this.notaBtns=d;var e=this.getButtonConfig().getCssNota();try{this.instantiateButtons("button",b,"n",d,
        e,c)}catch(A){}};f.prototype.createEngineButtons=function(b,c){var d="",e=[];e.push({title:lm.MORE_LINES,id:"More",handler:function(){this.fnIncMultiVars(c,1)}.bind(this)});e.push({title:lm.LESS_LINES,id:"Less",handler:function(){this.fnIncMultiVars(c,-1)}.bind(this)});e.push({title:lm.CALCULATE_THREAT,id:"Threat",handler:this.fnToggleThreat.bind(this)});for(var f=this.getButtonConfig().getCssEngine(),g=0;g<e.length;g++)d+=String.f('<button title="{0}" id="e-btn{1}-{2}" class="{3}"></button>',e[g].title,
        e[g].id,c,f);$(b).html(d);b='url( "'+CB.getCommonPath()+'Media/Ribbons/Reader/{0}{1}.png" )';for(g=0;g<e.length;g++)d=$(String.f("#e-btn{0}-{1}",e[g].id,c)),e[g].handler&&(d[0].onclick=function(b,c){return function(d){e[b].handler(c,d)}}.call(this,g,c)),d.css("background-image",String.f(b,e[g].id,16))};f.prototype.setFullWinBtnImage=function(b,c){this.buttonImages[b].FullScreen=c?"FullScreen":"Restore"};f.prototype.fnSaveDB=function(b){this.fnSave(b,!1)};f.prototype.fnSave=function(b,c,d){var e="Download",
        f=".fen"===d;if(c)b=this.modules[b].getKernel().game,c=f?CB.PGNWriter.toFEN(b):CB.PGNWriter.toPGN(b),0<b.hdr.getStrPlayers(!1,0).length&&(e=b.hdr.getStrPlayers(!1,0)+(d||".pgn")),d=b.requiresPremiumForDownload()&&!f;else{c=this.modules[b].toPgn(b);if(!c)return;e=this.modules[b].pgnTitle;d=this.modules[b].getKernel().game.requiresPremiumForDownload()}CB.System.copyToClipboard(c);f?this.showMessage("FEN copied"):(f=CB.System.runsOnChessBaseCom()&&-1==document.URL.search(/view.chessbase.com/i)&&-1==
        document.URL.search(/cloudserver.chessbase.com/i),V15.isLoggedIn()||!f?d&&!V15.isPremium()&&f?window.location="https://live.chessbase.com/Premium?returnurl="+encodeURIComponent(document.location):(window.Blob?(console.log("Blob DL: "+e),c=new Blob([c],{type:"text/plain;charset=utf-8"}),window.saveAs(c,e)):0<CB.System.getIEVersion()&&window.clipboardData&&clipboardData.setData&&(alert("On Internet Explorer the game has been pasted to the clipboard ('Strg-V')"),clipboardData.setData("Text",c)),CB.LogStats("PGN")):
        window.location="https://live.chessbase.com/Logon?returnurl="+encodeURIComponent(document.location))};f.prototype.runsOnChessBaseNews=function(){return-1!=document.URL.search(/en.chessbase.com/i)||-1!=document.URL.search(/de.chessbase.com/i)||-1!=document.URL.search(/es.chessbase.com/i)||-1!=document.URL.search(/localhost/i)};f.prototype.fnSaveFEN=function(b){this.fnSave(b,!1,".fen")};f.prototype.fnSaveNotaFEN=function(b){this.fnSave(b,!0,".fen")};f.prototype.moduleGamesToPgn=function(b){return V15.lobby.getPgn(this.modules[b].ticket)};
    f.prototype.fnGotoStart=function(b){this.stopAutoplay(b);this.modules[b].getKernel().game.gotoStart()};f.prototype.fnRestart=function(b){this.fnAnimRewind(b);this.modules[b].getKernel().Vk.restart()};f.prototype.fnGotoEnd=function(b){this.stopAutoplay(b);this.modules[b].getKernel().game.gotoEnd()};f.prototype.fnRetract=function(b){this.stopAutoplay(b);this.modules[b].getKernel().game.gotoPrev()};f.prototype.fnExec=function(b){if(!this.stopAutoplay(b)){var c=this.modules[b].getKernel().game.getAnno(CB.AnnoType.TRAINING);
        c&&!c.solved||this.modules[b].getKernel().game.gotoNext()}};f.prototype.fnAnimPlay=function(b){for(var c=0;c<this.modules.length;c++)c!=b&&this.modules[c].animationController&&this.modules[c].animationController.pause();this.modules[b].animationController&&this.modules[b].animationController.play()};f.prototype.fnAnimStep=function(b){this.modules[b].animationController&&this.modules[b].animationController.step()};f.prototype.fnAnimBack=function(b){this.modules[b].animationController&&this.modules[b].animationController.stepBack()};
    f.prototype.fnAnimFastForward=function(b){this.modules[b].animationController&&this.modules[b].animationController.fastForward()};f.prototype.fnAnimPause=function(b){this.modules[b].animationController&&this.modules[b].animationController.pause()};f.prototype.fnAnimRewind=function(b){this.modules[b].animationController&&(this.modules[b].getKernel().Vk.restart(),this.modules[b].animationController.rewind(!0))};f.prototype.stopAutoplay=function(b){this.modules[b].runAutoplayTimer&&this.modules[b].runAutoplayTimer.stop();
        return this.modules[b].timerAutoplay?!this.fnAutoplay(b):!1};f.prototype.fnAutoplay=function(b,c,d){if(this.modules[b].timerAutoplay)return this.modules[b].timerAutoplay.stop(),delete this.modules[b].timerAutoplay,this.modules[b].getKernel().boardWin.prepareFullRedraw(),this.modules[b].animSteps&&(this.modules[b].getKernel().boardWin.animSteps=this.modules[b].animSteps),this.modules[b].getKernel().Vk.setIsAutoplay(!1),this.setAutoplayBtnImg(!1,b),!1;this.modules[b].getKernel().boardWin&&this.modules[b].getKernel().boardWin.animSteps&&
    (this.modules[b].animSteps=this.modules[b].getKernel().boardWin.animSteps,CB.System.isMobile()?this.modules[b].getKernel().boardWin.animSteps.forMove=.3:this.modules[b].getKernel().boardWin.animSteps.forMove=3);this.modules[b].getKernel().game.getMoveNo()==this.modules[b].getKernel().game.getMainLine().length&&this.fnGotoStart(b);this.setAutoplayBtnImg(!0,b);var e=d||2500;CB.System.isMobile()&&(e=1600);c&&!d&&(c.ctrlKey?(e=1300,c.altKey&&(e=c.shiftKey?200:700)):c.shiftKey?(e=5E3,c.altKey&&(e=1E4)):
        c.altKey&&(e=1E3));this.modules[b].getKernel().boardWin&&this.modules[b].getKernel().boardWin.destroyMessage();this.modules[b].getKernel().Vk.setIsAutoplay(!0);this.modules[b].getKernel().game.gotoNext();this.modules[b].timerAutoplay=new CB.Timer(function(){this.modules[b].getKernel().game.isOnLastMove()?(this.modules[b].timerAutoplay.stop(),(new CB.Timer(function(){this.modules[b].timerAutoplay&&(this.loadNextGame(b),this.modules[b].getKernel().game.gotoIndex(0),this.modules[b].timerAutoplay.runPeriodic(e))}.bind(this))).runOnce(4*
        e)):this.modules[b].getKernel().game.gotoNext()}.bind(this));this.modules[b].timerAutoplay.runPeriodic(e);return!0};f.prototype.fnCursorUp=function(b){this.modules[b].nota&&this.modules[b].nota.handleCursorUp()};f.prototype.fnCursorDown=function(b){this.modules[b].nota&&this.modules[b].nota.handleCursorDown()};f.prototype.fnAnalysis=function(b){this.canUseEngine()?(this.nActivePlugin=b,this.modules[b].getKernel().Vk.toggleEngine()||this.closeEnginePanel()):this.modules[this.nActivePlugin].engineOpen?
        this.closeEnginePanel():(CB.LogStats("Engine"),this.openEnginePanel(),this.modules[this.nActivePlugin].enginePanel.displayInfo("Sorry, you cannot run an engine in this browser yet. On Mac, please try Chrome. Thank you.","cbEngineWarnBrowser"))};var p=new CB.Vr;f.prototype.fnIncMultiVars=function(b,c){this.modules[b].getKernel().Vk.incNMultiVars(c);p.exec(function(){this.modules[b].getKernel().Vk.goAll()}.bind(this),300)};var r=new CB.Vr;f.prototype.fnToggleThreat=function(b){r.exec(function(){this.modules[b].getKernel().Vk.toggleThreat()}.bind(this),
        300)};f.prototype.fnFlipBoard=function(b){this.modules[b].getKernel().boardWin&&this.modules[b].getKernel().boardWin.flipBoard()};var t=0;f.prototype.fnPieces=function(b){this.stopAutoplay(b);b=[CB.CommandIds.PIECES2D_FRITZ,CB.CommandIds.PIECES2D_USCF,CB.CommandIds.PIECES2D_CRYSTALS_WOOD,CB.CommandIds.PIECES2D_BLUE,CB.CommandIds.PIECES2D_OLDSTYLE];CB.System.isElectron()&&(b=[CB.CommandIds.PIECES2D_FRITZ,CB.CommandIds.PIECES2D_BLUE]);t++;t>b.length-1&&(t=0);glSettings.changeBoardStyle(b[t])};f.prototype.fnSound=
        function(b){if(V15.chessAudio)for(V15.chessAudio.enable(!V15.chessAudio.isEnabled()),b=0;b<this.soundBtnSelector.length;b++)this.buttonImages[b].SoundOn=V15.chessAudio.isEnabled()?"SoundOn":"SoundMute",this.setButtonImages("b",this.boardBtns[b],this.getButtonConfig().getBtnHBoard(),this.getButtonConfig().getCssBoard(),b,"Reader")};f.prototype.fnStart=function(b){this.recorder[0].start()};f.prototype.fnLike=function(b){var c=this.modules[b].getKernel().Vk.videoid;if(c){var d="";V15.isLoggedIn()&&V15.Vf.userName&&
    (d=V15.Vf.userName);c=this.baseurl+"Replay/ToggleLike?id="+encodeURIComponent(c)+"&user="+d;$.get(c,function(c){c&&(this.fnHint(c,b),this.setLike(b))}.bind(this)).fail(function(b){alert("Liked")}.bind(this))}};f.prototype.setLike=function(b){var c=this.modules[b].getKernel().Vk.videoid;if(c){var d="";V15.isLoggedIn()&&V15.Vf.userName&&(d=V15.Vf.userName);c=this.baseurl+"Replay/GetMetaData?id="+encodeURIComponent(c)+"&user="+d;$.get(c,function(c){this.buttonImages[b].Like=0<c.Like.length?"Liked":"Like";
        this.setButtonImages("b",this.boardBtns[b],this.getButtonConfig().getBtnHBoard(),this.getButtonConfig().getCssBoard(),b,"Reader")}.bind(this)).fail(function(b){alert("Liked")}.bind(this))}};f.prototype.fnHint=function(b,c){this.modules[c].getKernel().boardWin&&(this.modules[c].getKernel().boardWin.addMessage(b,!0),(new CB.Timer(function(){this.modules[c].getKernel().boardWin.destroyMessage()}.bind(this))).runOnce(4E3))};f.prototype.fnHelp=function(b,c){this.modules[c].getKernel().Vk.showDiagramHelp(b)};
    f.prototype.fnSolution=function(b,c){if(this.modules[c].getKernel().boardWin&&4==b.length){var d=CB.Square.fromString(b.substring(0,2));b=CB.Square.fromString(b.substring(2,4));this.modules[c].getKernel().boardWin.drawArrow(d,b,"hsla( 120, 70%, 50%, 0.9 )")}};f.prototype.loadPrevGame=function(b){if(this.modules[b].pgnDatabase){var c=this.modules[b].getKernel().game.gameNo-1;if(!c||1>c)c=this.modules[b].pgnDatabase.getGameCount();var d=this.modules[b].pgnDatabase.getGame(c);this.loadGame(d,b,c,!0)}else if(c=
        this.modules[b].getKernel().idGame)if(d=this.modules[b].list,1<d.length){for(var e=!1,f=1;!e&&f<d.length;f++)d[f].id==c&&(c=d[f-1].id,w(c,b),e=!0);e||d[d.length-1].id==c||w(d[d.length-1].id,b)}};f.prototype.loadNextGame=function(b){if(this.modules[b].pgnDatabase){var c=this.modules[b].getKernel().game.gameNo+1;if(!c||c>this.modules[b].pgnDatabase.getGameCount())c=1;var d=this.modules[b].pgnDatabase.getGame(c);this.loadGame(d,b,c,!0)}else if(c=this.modules[b].getKernel().idGame){d=this.modules[b].list;
        for(var e=!1,f=0;!e&&f<d.length-1;f++)d[f].id==c&&(c=d[f+1].id,w(c,b),e=!0);e||d[0].id==c||w(d[0].id,b)}};f.prototype.onWindowResize=function(){if(this.modules&&null!=this.modules[0]&&this.isOfflineVideo(0)){var b=$(this.allPluginClasses);$(b[0]).offset({top:0,left:0});$(b[0]).css("top",0);$(b[0]).css("left",0)}};f.prototype.fnFullWindow=function(b){if(!this.isTabbedLayout()){this.stopShakeFullWinBtn(b);var c=$(this.allPluginClasses);if(c&&c[b]){var d=0,e=0;this.maximized!=b&&0<=this.maximized&&this.fnFullWindow(this.maximized);
        this.maximized==b?(this.setFullWinBtnImage(b,!0),this.maximized=-1,$(c[b]).css("max-width",this.storeMaxWidth),$(c[b]).css("max-height",this.storeMaxHeight),$(c[b]).css("box-shadow",this.storeShadow),$(c[b]).width(this.storeWidth),$(c[b]).height(this.storeHeight),$(c[b]).offset({top:this.storeOffset.top,left:this.storeOffset.left}),$(c[b]).css("z-index","1"),d=this.storeWidth,e=this.storeHeight,CB.System.isElectron()?($(c[0]).offset({top:0,left:0}),$(c[0]).css("top",0),$(c[0]).css("left",0)):$("#root"+
            b).jqxSplitter({panels:this.storePanels})):(this.setFullWinBtnImage(b,!1),this.storeWidth=$(c[b]).width(),this.storeHeight=$(c[b]).height(),this.storeOffset=$(c[b]).offset(),this.storeMaxWidth=$(c[b]).css("max-width"),this.storeShadow=$(c[b]).css("box-shadow"),$("#root"+b).jqxSplitter("panels"),this.storePanels=$("#root"+b).jqxSplitter("panels"),this.maximized=b,d=Math.min(1900,window.innerWidth-2*Math.min(30,Math.round(.05*window.innerWidth))),e=window.innerHeight-10,$(c[b]).css("max-width",d),$(c[b]).css("max-height",
            e),$(c[b]).css("box-shadow","1px 1px 12px 2px hsla( 0, 0%, 0%, 0.35 )"),$(c[b]).width(d),$(c[b]).height(e),$(c[b]).offset({top:window.pageYOffset+2,left:4+(window.innerWidth-d)/2}),$(c[b]).css("z-index","100"),CB.System.isElectron()&&($(c[b]).css("max-width",screen.availWidth),$(c[b]).css("max-height",screen.availHeight-64),$(c[b]).width(screen.availWidth),$(c[b]).height(screen.availHeight-64),$(c[b]).offset({top:0,left:0}),e=screen.availHeight-64,d=screen.availWidth),this.nActivePlugin=b,this.shouldDoBigMultiBoard(b,
            d,e)&&($("#root"+b).jqxSplitter({panels:[{size:"68%",collapsible:!1},{size:"32%",collapsible:!1}]}),700>e&&$("#westNest"+b).jqxSplitter({panels:[{size:"60%",collapsible:!1},{size:"40%",collapsible:!1}]})),CB.LogStats("FullWin"));$("#root"+b).jqxSplitter({width:d+"px",height:e+"px"});this.resizePlugin($(c[b]),b);h.exec(function(){return function(){this.onSplitterResize(b,this.isLive(b))}.bind(this)}.call(this,b),300);$("#root"+b).jqxSplitter("refresh");this.isVertical?$("#southNest"+b).jqxSplitter("refresh"):
            $("#westNest"+b).jqxSplitter("refresh");$("#eastNest"+b).jqxSplitter("refresh");$("#eastUpDownNest"+b).jqxSplitter("refresh")}}};f.prototype.shouldDoBigMultiBoard=function(b,c,d){return!this.isTabbedLayout()&&this.isLive(b)&&1200<c&&700<d&&3<=this.modules[b].list.length};f.prototype.isVideoTabVisible=function(b){return this.isAnyVideo(b)?this.isTabVisible(b,2):!1};f.prototype.isNotaTabVisible=function(b){return this.isTabVisible(b,0)};f.prototype.isListTabVisible=function(b){return this.isTabVisible(b,
        1)};f.prototype.isTabVisible=function(b,c){return $(this.tabNavSwitchDivs[b][c]).is(":visible")};f.prototype.fnSelectNota=function(b){this.notaResized[b]=!0;(new CB.Timer(function(){var c=$(this.allPluginClasses)[b];this.resizeNotaTabbed(c,b)}.bind(this))).runOnce(10);this.fnSelectTab(b,0)};f.prototype.fnSelectList=function(b){this.listResized[b]||(this.listResized[b]=!0,(new CB.Timer(function(){var c=this.getGameCount(b),d=1<c;if(this.isLiveVideo(b)||this.isOfflineVideo(b))d=!0;var e=$(this.allPluginClasses)[b],
        f=$(e).width();e=$(e).height();var g=$("#north"+b).height(),h=0;this.ribbonButtonsVisible(b)&&(h=$("#tabNavButtons"+b).height());this.isAnyVideo(b)?this.resizeVideoAndListTabbed(b,d,0,c,f,e-g-h-14):this.resizeEngineAndListTabbed(b,d,0,c,f,e-g-h-14)}.bind(this))).runOnce(10));this.fnSelectTab(b,1)};f.prototype.fnSelectVideo=function(b){(new CB.Timer(function(){var c=this.getGameCount(b),d=1<c;this.isLiveVideo(b)&&(d=!0);var e=$(this.allPluginClasses)[b],f=$(e).width();e=$(e).height();var g=0;this.ribbonButtonsVisible(b)&&
    (g=$("#tabNavButtons"+b).height());var h=$("#north"+b).height();this.isAnyVideo(b)?this.resizeVideoAndListTabbed(b,d,0,c,f,e-h-g-14):this.resizeEngineAndListTabbed(b,d,0,c,f,e-h-g-14);this.onSplitterResizeVerti(b,!1);this.resize(null,!0)}.bind(this))).runOnce(10);this.fnSelectTab(b,2)};f.prototype.fnSelectBack=function(b){document.exitFullScreen&&document.exitFullScreen();document.location="https://live.chessbase.com"};f.prototype.fnSelectTab=function(b,c){if(0<this.tabNavBtns.length)for(var d=0;d<
    this.tabNavSwitchDivs[b].length;d++){var e=String.formatEx("#t-btn{0}-{1}",this.tabNavBtns[b][d].id,b);d==c?($(this.tabNavSwitchDivs[b][d]).css("display","block"),$(e).addClass("tabNavBtnSelected")):($(this.tabNavSwitchDivs[b][d]).css("display","none"),$(e).removeClass("tabNavBtnSelected"))}};f.prototype.onOrientationChange=function(b){0<=this.maximized&&this.fnFullWindow(this.maximized);this.checkRecreateOrientation()};f.prototype.fnNotaSave=function(b){console.log("Nota Save");this.fnSave(b,!0)};
    f.prototype.fnOnlineDB=function(b){var c=$(this.allPluginClasses);c&&c[b]&&(CB.System.isElectron()||V15.saveGameToLocalStorage(),window.location="https://database.chessbase.com?ref=pgn")};f.prototype.fnMyGames=function(b){this.modules[b].getKernel().Vk.saveToCloud(!0)||5;var c=$(this.allPluginClasses);c&&c[b]&&(V15.saveGameToLocalStorage(),window.location="http://mygames.chessbase.com?ref=pgn")};f.prototype.fnFritz=function(b){var c=$(this.allPluginClasses);c&&c[b]&&V15.passToFritzOnline(this.modules[b].getKernel().game)};
    f.prototype.checkGAs=function(b){if(CB.System.isElectron()){var c=b,d=b.lastIndexOf("/");-1!=d&&(c=b.substr(d+1));this.readerHelper.readGameActionFileList(function(){this.readerHelper.isFileAvailable(c,this.onGaAvailable.bind(this))}.bind(this))}else try{console.log("CheckGAs");var e=new XMLHttpRequest;e.open("GET",b,!1);e.onreadystatechange=function(){if(4===e.readyState&&(200===e.status||0==e.status)){console.log("GameActions present");this.gameactions=[];for(var b=e.responseText.split("\r\n"),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          c=0;c<(b.length-1)/2;c++){var d=b[2*c],f=b[2*c+1],g=new CB.ScriptCommand;g.fromString(d,f);this.gameactions.push(g)}}}.bind(this);e.send(null)}catch(A){CB.LogException("RM:checkGAs",A)}};f.prototype.fnPromoteLine=function(b){this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().Vk.onPromoteLine()&&this.modules[b].getKernel().game.promoteLine()};f.prototype.fnDeletePrevious=function(b){this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));
        this.modules[b].getKernel().Vk.onDeletePrevious()&&this.modules[b].getKernel().game.deletePrevious()};f.prototype.fnCutLine=function(b){this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().Vk.onCutLine()&&this.modules[b].getKernel().game.deleteRemaining()};f.prototype.fnDeleteLine=function(b){this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().Vk.onDeleteLine()&&this.modules[b].getKernel().game.deleteLine()};
    f.prototype.fnUndo=function(b){if(this.modules[b].undo.length){var c=this.modules[b].undo.pop();this.modules[b].redo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().game.assign(c)}};f.prototype.fnRedo=function(b){if(this.modules[b].redo.length){var c=this.modules[b].redo.pop();this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().game.assign(c)}};f.prototype.fnUnannotate=function(b){this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));
        this.modules[b].getKernel().Vk.saved=!1;this.modules[b].getKernel().game.unAnnotate()};f.prototype.fnEmbed=function(b){this.isLive(b)?window.open("https://docu.chessbase.com/reader/cblive.html"):window.open("https://docu.chessbase.com/reader/cbreplay.html")};f.prototype.fnLivePlaychess=function(b){window.open("http://live.playchess.com")};f.prototype.onNotaClickListener=function(){this.stopAutoplay(-1==this.nActivePlugin?0:this.nActivePlugin)};f.prototype.handleKeyDown=function(b,c){if(this.instantiated&&
        -1!=this.nActivePlugin){var d=!0;switch(b.which){default:d=!1;break;case 13:this.fnAutoplay(c,b,1E3);break;case 27:this.maximized==c&&this.fnFullWindow(c);this.modules[c].timerAutoplay&&this.fnAutoplay(c,b);break;case 37:this.fnRetract(c);break;case 39:this.fnExec(c);break;case 38:b.altKey?this.fnPromoteLine(c):this.fnCursorUp(c);break;case 40:this.fnCursorDown(c);break;case 46:this.fnDeleteLine(c);break;case 56:this.fnDeletePrevious(c);break;case 57:this.fnCutLine(c);break;case 65:b.ctrlKey||(d=
        !1);break;case 66:b.ctrlKey?this.fnFlipBoard(c):d=!1;break;case 83:b.ctrlKey?this.fnSave(c,!0):d=!1;break;case 89:b.ctrlKey?b.shiftKey?this.fnUnannotate(c):this.fnRedo(c):d=!1;break;case 90:b.ctrlKey?this.fnUndo(c):d=!1;break;case 113:b.altKey?this.fnAnalysis(c):d=!1;break;case 122:b.ctrlKey||b.shiftKey?this.loadPrevGame(c):this.loadNextGame(c);break;case 187:this.fnIncMultiVars(c,1);break;case 189:this.fnIncMultiVars(c,-1);break;case 120:this.test(c)}d&&b.preventDefault();return d}};f.prototype.checkShowIsLive=
        function(b){(new CB.Timer(function(){if(this.isVideo(b)&&this.show){var c=this.buildGetLiveStreamsByShowURL(this.show);$.get(c,function(c){c&&0<c.results.length&&(new CB.Timer(function(){this.deleteRoot(b);this.modules[b].pluginDiv.className="cblivevideo";V15.panelMgr.init();V15.panelMgr.createPanels()}.bind(this))).runOnce(100)}.bind(this)).fail(function(){}.bind(this))}}.bind(this))).runPeriodic(3E4)};f.prototype.deleteRoot=function(b){$("#cbcaption"+b).remove();$("#rootParent"+b).remove()};f.prototype.test=
        function(b){this.show&&(this.isVideoShow?(this.deleteRoot(b),this.modules[b].pluginDiv.className="cbvideo"):(this.deleteRoot(b),this.modules[b].pluginDiv.className="cblivevideo"),V15.panelMgr.init(),V15.panelMgr.createPanels(),this.isVideoShow=!this.isVideoShow)};f.prototype.isMaximized=function(){return this.maximized==this.nActivePlugin};f.prototype.getFnKernelInitGame=function(b,c){return function(b){if(this.modules&&this.modules.length){var d=this.modules[c].pgnDatabase;d&&b.assign(d.getGame(1),
        !0)}}};f.prototype.getFnKernelInitDiagram=function(b,c,d,e){return function(f){f.reset();if(b){var g=b.dataset.fen;if(g)g=new CB.Position(g),g=new CB.Game(g),d.addColoredAnnos(b,g),f.assign(g);else{var h=b.dataset.pos;h?(g=new CB.Position,g.initString(h),g=new CB.Game(g),d.addColoredAnnos(b,g),f.assign(g)):(g=b.dataset.moves)?(f.assign(CB.PGN.parseGame(g)),f.gotoIndex(f.getMainLine().length)):e&&(f=new CB.PgnDatabase(e),d.modules[c].pgnDatabase=e,g=f.getGame(1),d.modules[c].pgnTitle=g.hdr.getStrPlayers(!1,
        0)+".pgn",d.modules[c].getKernel())}}}};f.prototype.modifyPlayingModeForTraining=function(b,c,d){if((b=b.dataset.solution)&&4==b.length){var e=CB.Square.fromString(b.substring(0,2)),f=CB.Square.fromString(b.substring(2,4)),g=new CB.Timer(function(){d.boardWin.destroyMessage()});d.Vk.fnAcceptMove=function(b){if(0<d.game.getMoveIndex())return!0;g.runOnce(2E3);if(b.from!=e||b.to!=f)return d.boardWin.addMessage("Wrong Move, sorry",!0),!1;d.boardWin.addMessage("Correct!",!0);return!0}.bind(this)}};f.prototype.addColoredAnnos=
        function(b,c){var d=b.dataset.arrows;b=b.dataset.squares;if(d){var e=d.split(",");d=new CB.ColArrowAnno;for(var f=0;f<e.length;f++){var g=e[f];if(4==g.length){var h=CB.Square.fromString(g.substring(0,2));g=CB.Square.fromString(g.substring(2,4));h=new CB.ColArrow(h,g,CB.BoardColor.GREEN);d.push(h)}}d.length&&c.setAnnoBeforeFirstMove(CB.AnnoType.ARROW_LIST,d,!0)}if(b){b=b.split(",");d=new CB.ColSqAnno;for(e=0;e<b.length;++e)f=b[e],2==f.length&&(f=CB.Square.fromString(f),f=new CB.ColSq(f,CB.BoardColor.GREEN),
            d.push(f));d.length&&c.setAnnoBeforeFirstMove(CB.AnnoType.SQUARE_LIST,d,!0)}};f.prototype.createPgnDatabase=function(b,c,d,e){if(b){var f=b.dataset.url;f?$.get(f,function(e){if(e){e=new CB.PgnDatabase(e);this.modules[d].pgnDatabase=e;this.modules[d].pgnTitle=f;var g=!1;1<e.getGameCount()?g=c(e,d,this.loadGame.bind(this)):(this.hideRibbon(d),this.resizePlugin($(b),d));g||("no"!=b.dataset.autoplay&&1<e.getGameCount()?(parseInt(b.dataset.autoplay),this.modules[d].getKernel().Vk.loadGame(this.modules[d].pgnDatabase.getGame(1)),
        this.modules[d].getKernel().hasTraining()):(this.modules[d].getKernel().Vk.loadGame(this.modules[d].pgnDatabase.getGame(1)),0<b.dataset.move&&this.modules[d].getKernel().game.gotoIndex(b.dataset.move)));this.setSingleGameCaption(this.modules[d].getKernel().game,d)}}.bind(this)).fail(function(c){this.resizePlugin($(b),d)}.bind(this)):e&&(e=new CB.PgnDatabase(e),this.modules[d].pgnDatabase=e,1<e.getGameCount()?c(e,d,this.loadGame.bind(this)):(this.hideRibbon(d),this.resizePlugin($(b),d),CB.System.isElectron()&&
    "undefined"!==typeof electronBridge&&electronBridge.setReplayTouchBar(V15,"Replay")),e=this.modules[d].pgnDatabase.getGame(1),this.modules[d].pgnTitle=e.hdr.getStrPlayers(!1,0)+".pgn",this.modules[d].getKernel().Vk.loadGame(e),this.setSingleGameCaption(e,d),this.pgnStartMoveIndex&&this.modules[d].getKernel().game.gotoIndex(this.pgnStartMoveIndex),!this.modules[d].getKernel().hasTraining()&&0<parseInt(b.dataset.autoplay)&&(this.modules[d].runAutoplayTimer=new CB.Timer(function(){this.fnAutoplay(d,
        null,b.dataset.autoplay)}.bind(this)),this.modules[d].runAutoplayTimer.runOnce(1E4)))}};f.prototype.createVideoDatabase=function(b,c,d,e){if(b){this.baseurl=V15.config.getVideoPortalUris()[0];e=b.dataset.id;var f="";e&&(f=this.baseurl+"public/video?id="+encodeURIComponent(e));var g=b.dataset.show;g&&(f=this.baseurl+"public/GetVideosFromShow?id="+g,this.show=g);$.get(f,function(e){e&&(this.modules[d].videoDatabase=e,"Training PositionVideo"===e.Category&&(this.modules[d].getKernel().PositionMode=!0),
        c(e,d,this.loadVideoGame.bind(this)),this.resizePlugin($(b),d),g&&this.checkShowIsLive(d))}.bind(this)).fail(function(){alert("sorry,can get info")}.bind(this))}};f.prototype.buildGetLiveStreamsURL=function(){return"https://videos.chessbase.com/live/getlivestreams?client=web&filter="+CB.strUtil.getURLParam("filter")};f.prototype.buildGetLiveStreamsByShowURL=function(b){return"https://videos.chessbase.com/live/getlivestreamsbyshow?show="+b};f.prototype.createOfflineVideoDatabase=function(b,c,d,e){if(b){var f=
        b.dataset.id,g={},h=[];if(f.endsWith(".txt")){f.split("/");this.modules[d].getKernel().OfflineInteractive=!0;var k=new XMLHttpRequest;k.open("GET",f,!0);k.onreadystatechange=function(){if(4===k.readyState&&(200===k.status||0==k.status)){this.modules[d].cmsiManager=new CB.CMSIManager;for(var e=k.responseText.split("\r\n"),l=0;l<e.length;l++){var m=e[l];if(-1!=m.indexOf(".mp4")||-1!=m.indexOf(".mp3")){var q=m.indexOf("<"),p=m.indexOf(">");if(0<p&&(q=m.substr(q+1,p-q-1),0<q.length)){q=f.replace("FileNameToTitle.txt",
        q);p="";var r=q.lastIndexOf("/");-1!=r&&(p=q.substr(r+1));r=p;var u=f.lastIndexOf("/");this.modules[d].baseDir=f.substr(0,u)+"/";this.modules[d].cmsiManager.addFile(r);0==this.modules[d].cmsiManager.extractStateFromFileName(p)&&(p={},p.Name=q,r=m.indexOf("["),u=m.indexOf("]"),0<u&&(p.Name=m.substr(r+1,u-r-1)),p.Id=q,p.url=q,p.gameId=q,h.push(p))}}}g.results=h;this.modules[d].offlinevideoDatabase=g;c(g,d,this.loadOfflineVideoGame.bind(this));this.resizePlugin($(b),d)}}.bind(this);k.send(null)}else this.modules[d].getKernel().OfflineInteractive=
        !1,e={},e.Name=f,e.Id=f,e.url=f,e.gameId=f,h.push(e),g.results=h,this.modules[d].offlinevideoDatabase=g,c(g,d,this.loadOfflineVideoGame.bind(this)),this.resizePlugin($(b),d)}(new CB.Timer(function(){var b='<div class="cbreplayInfo" id="replayinfo{0}">'+lm.CLICK_ENGINE_TO_ANALYSE;$("#engineEl0").html(b)}.bind(this))).runOnce(1E3)};f.prototype.getVideoShow=function(){var b=-1,c=pluginDiv.dataset.show;c&&(b=c);return b};f.prototype.createLiveVideoDatabase=function(b,c,d,e){if(b){e=this.buildGetLiveStreamsURL();
        b.dataset.id&&(e=this.buildGetLiveStreamsURL());var f=b.dataset.show;f&&(this.getCalendar(d),e=this.buildGetLiveStreamsByShowURL(f),this.show=f);$.get(e,function(e){e&&(this.modules[d].livevideoDatabase=e,c(e,d,this.loadLiveVideoGame.bind(this)),this.resizePlugin($(b),d))}.bind(this)).fail(function(){this.resizePlugin($(b),d)}.bind(this))}};f.prototype.loadTableData=function(b,c){if(b){$(b).html('<div style= "font-size:large;margin-left:auto;margin-right:auto;margin-top:20px;margin-bottom:20px">Loading Table...</div>');
        var d=b.dataset.url;d=b.dataset.name;var e=parseInt(b.dataset.top),f=b.dataset.round||1E5,g=b.dataset.tbs,h=b.dataset.caption,k=b.dataset.pic,l=b.dataset.pw||1,m=b.dataset.pd||.5,q=b.dataset.pl||0;d=String.f("{0}/results/{1}/all",V15.config.getLiveResult(),d);var p={caption:h,withPic:k};d&&$.get(d,function(d){if(d){var h={round:f,top:e,tbs:g,pointsWin:parseFloat(l),pointsDraw:parseFloat(m),pointsLoss:parseFloat(q)};this.createCrossTable(b,c,d,h,p)}}.bind(this))}};f.prototype.loadPairingData=function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 c){if(b){var d=b.dataset.name,e=parseInt(b.dataset.top),f=b.dataset.round||3E4,g=b.dataset.pw||1,h=b.dataset.pd||.5,k=b.dataset.pl||0;(d=String.f("{0}/results/{1}/all",V15.config.getLiveResult(),d))&&$.get(d,function(d){if(d)var l={round:f,top:e,pointsWin:parseFloat(g),pointsDraw:parseFloat(h),pointsLoss:parseFloat(k)};this.createPairings(b,c,d,l,{})}.bind(this))}};f.prototype.selectOrAddBoard=function(b,c){if(this.modules[b].useFirstBoard)return this.modules[b].useFirstBoard=!1,this.modules[b].kernel[0].setIdGame(c),
        0;if(this.modules[b].kernel.length<this.modules[b].maxKernels){var d=this.modules[b].addKernel(this);d.idGame=c;var e=this.modules[b].boardArea.canvas,f=this.createBoardWin(e,this.getMultiBoardOptions());f.animateBoard=!1;d.setBoardWin(f);d.Vk.createGUIElements(f);e.control.addBoard(f,c);c=$("#boardHolder"+b).width();d=$("#boardHolder"+b).height();this.launchResizeBoard(b,c,d,300);return this.modules[b].kernel.length-1}return-1};var w=function(b,c,d,f){var g=V15.panelMgr;V15.panelMgr.modules[c].nGotoMoveIndex=
        f;if(g.trySwapWithBigBoard(b,c))f&&e(c,b,V15.panelMgr.modules[c].nCurrKernel).game.gotoIndex(f);else{for(var h=0;h<g.modules[c].kernel.length;h++)if(g.modules[c].kernel[h].idGame==b){g.changeSelectedGameKernel(b);g.onWatch(c,b);f&&e(c,b,V15.panelMgr.modules[c].nCurrKernel).game.gotoIndex(f);return}var k=V15.panelMgr.selectOrAddBoard(c,b);f=0;!d&&0>k&&(f=V15.panelMgr.modules[c].getKernel().idGame,V15.panelMgr.setGameStat(c,f,""),V15.panelMgr.modules[c].getKernel().setIdGame(b),k=V15.panelMgr.modules[c].nCurrKernel);
        V15.lobby.initKibitzingById(b,V15.panelMgr.modules[c].ticket,0<=k?function(b){return e(c,b,k)}:null,function(b,d){V15.panelMgr.onMove(c,b,d)},f,function(b){V15.panelMgr.onAnno(c,b)},function(d){V15.panelMgr.modules[c].nGotoMoveIndex&&(d=e(c,b,k))&&(d.game.gotoIndex(V15.panelMgr.modules[c].nGotoMoveIndex),(new CB.Timer(function(){V15.panelMgr.modules[c].nGotoMoveIndex=0})).runOnce(1E3));V15.panelMgr.chat[c]&&!V15.panelMgr.modules[c].chatRequested&&(V15.panelMgr.modules[c].chatRequested=!0,V15.lobby.requestChatLog(V15.panelMgr.modules[c].ticket,
            b));V15.panelMgr.setCaptionText("Live: "+V15.panelMgr.modules[c].getKernel().game.hdr.event.event,c)});if(0<=k)V15.panelMgr.onWatch(c,b)}};f.prototype.addGameById=function(b,c,d){w(c,b,!1,d)};f.prototype.trySwapWithBigBoard=function(b,c,d){c=this.modules[c];if(0==c.nCurrKernel||d)if(d=c.getKernelIndexOf(b),0<d){var e=ObjUtil.clone(c.kernel[0].game),f=c.kernel[0].idGame;c.kernel[0].game.assign(c.kernel[d].game);c.kernel[0].setIdGame(b);c.kernel[d].setIdGame(f);c.kernel[d].game.assign(e);this.changeSelectedGameKernel(b);
        V15.lobby.notifySessionSwap(c.ticket,f,b);return!0}};f.prototype.initAbstractModule=function(b,c,d){return{pluginDiv:b,ticket:++g,kernel:[],nCurrKernel:0,useFirstBoard:!0,maxKernels:1,getKernel:function(b){return"undefined"!=typeof b?this.kernel[b]:this.kernel[this.nCurrKernel]},addKernel:function(b,c){var e=new CB.GameKernel(b);e.ticket=this.ticket;e.setPlayingMode(d(e));e.pluginCnt=c;e.game.addOnClickInNotationListener(b.onNotaClickListener.bind(b));this.kernel.push(e);return e},selectKernelByIdGame:function(b){for(var c=
            0;c<this.kernel.length;c++)if(this.kernel[c].idGame==b){this.nCurrKernel=c;break}},getKernelIndexOf:function(b){for(var c=0;c<this.kernel.length;c++)if(this.kernel[c].idGame==b)return c;return-1},getKernelOfIdGame:function(b){for(var c=0;c<this.kernel.length;c++)if(this.kernel[c].idGame==b)return this.kernel[c]},changeNKernels:function(b,c){var d=this.maxKernels;if(b<this.kernel.length){for(var e=b;e<this.kernel.length;e++){var f=this.multiBoard.getBoardByGameId(this.kernel[e].idGame);this.multiBoard.removeBoard(f);
            V15.lobby.setSessionToBackground(this.ticket,this.kernel[e].idGame)}c.changeSelectedGameKernel(this.kernel[0].idGame);this.kernel.length=b}this.maxKernels=b;return d}}};f.prototype.createRequestData=function(b,c,d,e,f){f={};b.dataset.mymoves?f.myMoves=!0:(f.event=b.dataset.event,f.round=b.dataset.round,f.round2=b.dataset.round2,f.player=b.dataset.player,f.white=b.dataset.white,f.black=b.dataset.black,f.date=b.dataset.date,f.team=b.dataset.team,f.kibitzRank=c,"highest"==f.round||"max"==f.round?(f.round=
        "",f.highestRoundOnly=!0):f.highestRoundOnly=!1);f.isList=function(){return!0};f.onList=function(c){e.modules[d].list=c.games;500<c.games.length&&c.games.splice(500);e.createLiveListGrid.call(e,c,d,w);e.resizePlugin.call(e,$(b),d);e.shakeFullWinBtn(d);for(var f=0;f<c.games.length;f++)e.setResultStat(d,c.games[f].id,e.getResIcon(c.games[f].result))};return f};f.prototype.loadGame=function(b,c,d,e,f){c=c||0;e||this.stopAutoplay(c);this.modules[c].getKernel().Vk.loadGame(b);f&&(new CB.Timer(function(){this.modules[c].getKernel().game.gotoIndex(f);
        this.modules[c].nota&&this.modules[c].nota.emphasizeMove()}.bind(this))).runOnce(50);this.modules[c].getKernel().game.gameNo=d;this.setSingleGameCaption(b,c)};f.prototype.loadLiveVideoGame=function(b,c){};f.prototype.loadOfflineVideoGame=function(b,c){this.gameactions=[];for(c=0;c<b.length;c++){var d=b[c],e=new CB.ScriptCommand;e.time=d.Time;e.type=d.GameActionType;e.action=d.GameActionContent;this.gameactions.push(e)}};f.prototype.loadVideoGame=function(b,c){this.gameactions=[];for(var d=0;d<b.length;d++){var e=
        b[d],f=new CB.ScriptCommand;f.time=e.Time;f.type=e.GameActionType;f.action=e.GameActionContent;this.gameactions.push(f)}this.getCMSIFenPositions(c)};f.prototype.getCMSIFenPositions=function(b){var c=this.modules[b].getKernel().Vk.videoid;c&&(c=this.baseurl+"Replay/GetCSMIFenPositions?id="+encodeURIComponent(c),$.get(c,function(c){c&&this.suppressNotationForCMSI(b)}.bind(this)))};f.prototype.suppressNotationForCMSI=function(b,c){b=this.modules[b].nota;null!=b&&b.suppressNotationForCMSI()};f.prototype.onWatch=
        function(b,c){this.setGameStat(b,c,"watch");this.modules[b].getKernel()&&this.setCaptionText("Live: "+this.modules[b].getKernel().game.hdr.event.event,b)};f.prototype.onMove=function(b,c,d){d&&this.setGameStat(b,c,"move");var e=this.modules[b].getKernelOfIdGame(c);if(e){var f=e.game.hdr.result;2>=f?this.setResultStat(b,c,this.getResIcon(f)):(f=null,d&&d.gameAction.type==CB.GameActionEnum.SETANNOTATION&&d.gameAction.anno&&(f=d.gameAction.anno[CB.AnnoType.SYMBOL]),!f&&e.game.getLastMove()&&(d=e.game.getLastMove().getAnno())&&
    (f=d[CB.AnnoType.SYMBOL]),f&&(d=f.getEval(),this.setResultStat(b,c,this.getEvalIcon(d))))}};f.prototype.onAnno=function(b,c){this.setGameStat(b,c,"anno");TRACE("Anno:"+c)};f.prototype.setGameStat=function(b,c,d){if(b=this.modules[b].list)for(var e=0;e<b.length;e++)b[e].id==c&&(b[e].stat=d);this.gridCreated&&(c=$('*[data-statIcon="'+c+'"]'),d?c.html(this.getImgTag(d)):c.html(""))};f.prototype.setResultStat=function(b,c,d){if(b=this.modules[b].list)for(var e=0;e<b.length;e++)b[e].id==c&&(b[e].res=d);
        this.gridCreated&&(c=$('*[data-resIcon="'+c+'"]'),d?c.html(this.getImgTag(d)):c.html(""))};f.prototype.refreshGridIcons=function(b){var c=this.modules[b].list;if(c)for(var d=0;d<c.length;d++)this.modules[b].getKernelOfIdGame(c[d].id)?this.setGameStat(b,c[d].id,"watch"):"watch"!=c[d].stat&&this.setGameStat(b,c[d].id,c[d].stat),this.setResultStat(b,c[d].id,c[d].res)};f.prototype.getImgTag=function(b){return'<img src="'+(CB.getCommonPath()+"Media/Ribbons/Reader/Status/"+b+'16.png" height="16px">')};
    f.prototype.openEnginePanel=function(){if(!this.modules[this.nActivePlugin].enginePanel){var b=document.getElementById("engineEl"+this.nActivePlugin);if(b){$("#engineEl"+this.nActivePlugin).css("width","calc( 100% - 21px )");var c=new CB.EngineLinesElement(this.nActivePlugin);c.initElem(b,{scrollLines:!1});this.modules[this.nActivePlugin].enginePanel=c}}this.modules[this.nActivePlugin].engineOpen=!0;b=this.nActivePlugin;$("#engineButtons"+b).show();c=this.getGameCount(b);var d=$("#west"+b).width(),
        e=$("#westSouth"+b).height();e=this.getEngineH(b,e,1<c);this.isTabbedLayout()?this.resizeEngineAndListVerti(b,1<c,e,c,d):this.resizeEngineAndListHori(b,1<c,e,c,d);return this.modules[this.nActivePlugin].enginePanel};f.prototype.closeEnginePanel=function(){this.modules[this.nActivePlugin].engineOpen=!1;$("#engineEl"+this.nActivePlugin).css("width","100%");this.resizeActivePlugin();$("#engineButtons"+this.nActivePlugin).hide()};f.prototype.setAutoShowEngine=function(){};f.prototype.setIsGuest=function(b){};
    f.prototype.useMatBalanceDefault=function(){return!0};f.prototype.onPluginExit=function(b){this.modules[b].getKernel().Vk.onExit()};f.prototype.onPluginEntry=function(b){this.modules[b].getKernel().Vk.onEntry()};f.prototype.onBlur=function(){if(0<=this.nActivePlugin)this.modules[this.nActivePlugin].getKernel().Vk.onExit()};f.prototype.onLogOff=function(){this.onBlur()};f.prototype.createDiagramPlayingMode=function(b){b=new CB.ReaderPlayingMode(b);b.blockLiveBook=!0;return b};f.prototype.initLiveGames=
        function(){this.liveGames=[];this.liveLists=[];for(var b=0;b<this.modules.length;b++)if(this.modules[b].mode==CB.ReaderMode.LIVE){var c=function(){var c=b,d=this;return function(){return d.modules[c].getKernel()}}.call(this),d={};d.requestData=this.modules[b].requestData;d.ticket=this.modules[b].ticket;d.fnGetKernel=c;this.liveLists.push(d)}};f.prototype.onPlayerLobbyConnect=function(){for(var b=0;b<this.modules.length;b++)this.modules[b].nota&&this.modules[b].nota.notaHeaderElement.resetPlayerCache()};
    f.prototype.onLogInListener=function(b){this.createHelpText(b);if(b&&!this.wasLoggedIn){for(var c=0;c<this.chat.length;c++)this.chat[c]&&this.chat[c].outLoginOk(V15.Vf.userName);this.wasLoggedIn=b}this.modules&&this.modules[0]&&this.modules[0].isMyMovesLive&&!this.liveListsRequested&&($("#listParent0").html("<strong>If your game list is empty, please manage your <a href='https://mymoves.chessbase.com'>'My Moves'</a> first.</strong>"),V15.lobby.requestLiveLists(this.liveLists),this.liveListsRequested=
        !0)};f.prototype.onTeraBrainConnect=function(){this.modules[0]&&this.modules[0].getKernel()&&this.modules[0].getKernel().Vk.checkLiveBook();V15.aTBLobby&&this.modules[0]&&this.isLive(0)&&(this.tbTimer=new CB.Timer(this.tbTimerHdl.bind(this)),this.tbFirstTimer=new CB.Timer(this.tbTimerHdl.bind(this)),this.tbFirstTimer.runOnce(2E3),this.tbTimer.runPeriodic(2E4))};f.prototype.tbTimerHdl=function(){if(V15.aTBLobby)if(!V15.aTBLobby.isConnected()&&!V15.aTBLobby.isConnecting()&&50>V15.aTBLobby.connectCount)V15.aTBLobby.connect(null,
        this),this.tbFirstTimer.runOnce(5E3);else{var b=this.modules[0];b.mode==CB.ReaderMode.LIVE&&b.kernel.forEach(function(b){V15.aTBLobby.requestWithTicket(b.idGame,b.getCurPos(),this.tbTableHandler.bind(this))}.bind(this))}};f.prototype.tbTableHandler=function(b,c){if((b=this.modules[0].getKernelOfIdGame(b))&&0<c.move[0].m_aLine[0]){var d=CB.HashTableData.generateLine(c.pos.getPosition(),c.move[0],b).lineNota,e=c.move[0].m_nEval/100,f=c.move[0].m_nDepth;e=CB.Evaluation.getEvalString(c.move[0].m_nEval)+
        " ("+e+"/"+f+")";c={value:c.move[0].m_nEval,depth:c.move[0].m_nDepth,strLine:d,strEval:e};b.tbTableEvaluation=c;b.boardWin&&(b.boardWin.displayEvaluation(!0,c),b.game.hasTBEval=!0,b.game.fireOnEval(c.depth,c.value))}};f.prototype.initDiagramAnimations=function(){$(this.allPluginClasses).each(function(b,c){if($(c).hasClass("cbdiagram")&&this.modules[b].diagramAnimations&&(this.modules[b].animationController=new CB.DiagramAnimationController(this.modules[b].diagramAnimations,this.modules[b].getKernel().getCurPos(),
        this.modules[b].getKernel().boardWin,c),this.modules[b].animationController.drawInvariants(),this.hasAutoStartDiaAnimation(this.modules[b].diagramAnimations))){var d=this.modules[b].animationController;(new CB.Timer(function(){d.play()})).runOnce(500)}}.bind(this))};f.prototype.onUserMove=function(b){if(this.modules[b].animationController)this.modules[b].animationController.onUserMove()};f.prototype.activateTrainer=function(){this.createHelper();this.readerHelper.readGameActionFileList(function(){this.autostartVideo=
        !0;this.readerHelper&&this.readerHelper.showActivateDialog(this.onActivatedVideoDownload.bind(this))}.bind(this))};f.prototype.deactivateTrainer=function(){this.createHelper();this.readerHelper.readGameActionFileList(function(){this.readerHelper&&this.readerHelper.showDeactivateDialog()}.bind(this))};f.prototype.checkHardware=function(){this.createHelper();this.readerHelper.checkHardware(function(b,c){this.readerHelper.onCheckHardware(b,c)||(new CB.Timer(function(){this.modules[0].offlineVideo.videoManager.stop()})).runOnce(500)}.bind(this))};
    f.prototype.feedbackProduct=function(){this.createHelper();this.readerHelper.feedbackProduct()};f.prototype.recreate=function(){this.destroyAll();this.inDestroy=!1;V15.panelMgr.init();V15.panelMgr.createPanels();(new CB.Timer(function(){0<$("#westNest0").length&&$("#westNest0").jqxSplitter("refresh")}.bind(this))).runOnce(1500)};f.prototype.destroyAll=function(){CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setTitleTouchBar(V15,"");this.inDestroy=!0;this.modules&&this.modules[0]&&
    this.modules[0].getKernel()&&(this.soundBtnSelector=this.notaResized=this.listResized=this.tabNavSwitchDivs=this.buttonImages=this.tabNavBtns=this.diagramBtns=this.boardBtns=this.gridCreated=this.engineOpen=this.maximized=this.livevideo=this.recorder=this.offlinevideo=this.video=this.book=this.chat=this.diagrams=null,this.modules[0].getKernel()&&this.modules[0].getKernel().destroy(),this.modules[0].getKernel().boardWin&&this.modules[0].getKernel().boardWin.destroyMessage());this.deleteRoot(0)};f.prototype.onOpenExternalURL=
        function(b){CB.System.isElectron()?"undefined"!==typeof electronBridge&&electronBridge.showExternalURL(V15,b):window.open(b,"_system")};f.prototype.onTouchBarButton=function(b){if(0==b.indexOf("slider")){var c=b.substr(6);c=parseInt(c,10);var d=this.offlinevideo[0].videoManager.getDuration();this.offlinevideo[0].videoManager.setCurrentTime(c/100*d)}switch(b){case "back":window.history.back();break;case "play":this.modules[0].offlineVideo.videoManager.play();break;case "stop":this.modules[0].offlineVideo.videoManager.stop();
        break;case "pause":this.modules[0].offlineVideo.videoManager.pause();break;case "solution":this.modules[0].getKernel().VkplaySolution();break;case "flip":this.modules[0].getKernel().boardWin&&this.modules[0].getKernel().boardWin.flipBoard();break;case "start":this.stopAutoplay(0);this.modules[0].getKernel().game.gotoStart();break;case "end":this.stopAutoplay(0);this.modules[0].getKernel().game.gotoEnd();break;case "retract":this.stopAutoplay(0);this.modules[0].getKernel().game.gotoPrev();break;case "activate":this.activateTrainer();
        break;case "deactivate":this.deactivateTrainer();break;case "senduserfeedback":this.feedbackProduct();break;case "exec":this.stopAutoplay(0)||(b=this.modules[0].getKernel().game.getAnno(CB.AnnoType.TRAINING))&&!b.solved||this.modules[0].getKernel().game.gotoNext()}};f.prototype.createHelpText=function(b){var c=0,d='<div class="cbreplayInfo" id="replayinfo{0}">';if(this.isOfflineVideo(0)||CB.System.isElectron()||CB.System.isCordova())d+="<span>"+lm.CLICK_ENGINE_TO_ANALYSE+"</span>";else if(CB.System.getIEVersion()&&
        11>CB.System.getIEVersion())d+='<span class="browserWarning">Please update your browser. Thank you!</span>';else{switch(CB.Language.getStrUserLanguage().slice(0,2)){default:b&&(d+='<div>Hello <span class="cbHelloUser">'+V15.Vf.userName+"</span>,</div>");d+="<ul>";d+="<li>Use the four cursor keys and Enter to replay the game.</li>";CB.System.isElectron()||CB.System.isCordova()||(d+='<li class="cbMaximizeHint">Try maximizing the board:<div class="cbImgFullScreen"></div></li>',d+="<li>Make moves to analyse yourself.</li>",
    CB.System.isMobile()||(d+="<li>Press Ctrl-B to rotate the board.</li>",d+="<li>Press F11 to load the next game of a database.</li>"),d+="<li>Games viewed here will automatically be stored in your <a href='http://mygames.chessbase.com?ref=pgn'>cloud clipboard</a> (if you are logged in).</li>",b||(d+="<li><a href='https://account.chessbase.com/en/create-account?ref=pgn'>Create an account</a> to access the games cloud.</li>"));break;case "de":b&&(d+='<div>Hallo <span class="cbHelloUser">'+V15.Vf.userName+
        "</span>,</div>");d+="<ul>";d+="<li>Spielen Sie die Partie mit den vier Pfeiltasten und Enter nach.</li>";CB.System.isElectron()||CB.System.isCordova()||(d+='<li class="cbMaximizeHint">Maximieren Sie das Brett:<div class="cbImgFullScreen"></div></li>',d+="<li>Geben Sie selbst Z\u00fcge ein, um zu analysieren.</li>",CB.System.isMobile()||(d+="<li>Strg-B dreht das Brett.</li>",d+="<li>F11 l\u00e4dt die n\u00e4chste Partie einer Datenbank.</li>"),d+="<li>Alle nachgespielten Partien werden im Clipboard von <a href='http://mygames.chessbase.com?ref=pgn'>MyGames</a> gespeichert (falls eingeloggt).</li>",
    b||(d+="<li><a href='https://account.chessbase.com/en/create-account?ref=pgn'>Registrieren Sie sich</a>, um MyGames zu benutzen.</li>"));break;case "es":b&&(d+='<div>Hola <span class="cbHelloUser">'+V15.Vf.userName+"</span>,</div>"),d+="<ul>",d+="<li>Use las 4 teclas de flecha para reproducir la partida.</li>",CB.System.isElectron()||CB.System.isCordova()||(d+='<li class="cbMaximizeHint">Pruebe a maximizar el tablero:<div class="cbImgFullScreen"></div></li>',d+="<li>Ejecute jugadas para analizar usted mismo.</li>",
        d+="<li>Haga clic en el indicador de turno de juego en la esquina inferior para darle la vuelta.</li>",d+="<li>Haga clic en el logo de 'MyGames' para guardar sus an\u00e1lisis.</li>",b||(d+="<li><a href='https://account.chessbase.com/en/create-account?ref=pgn'>Create an account</a> to use cloud functions</li>"))}d+="</ul>";d+='<div class="cbTinyLog"></div>';d+="</div>"}$(this.allPluginClasses).each(function(b,e){$("#engineEl"+c).html(String.f(d,b));$("#engineEl"+c).css("font-family","Roboto Condensed");
        $("#engineEl"+c).css("font-size","12px");c++})};return f}();"use strict";
CB.ReaderPlayingMode=function(){var d=function(b){CB.ReaderPlayingMode.superClass.call(this);this.kernel=b;this.nMultiVars=1;this.cntPosViews=0;this.saved=this.statsSent=!1;this.nBookTimeouts=0;this.liveBookTimer=new CB.Timer(this.liveBookTimeout.bind(this));this.fnCheckLiveBook=this.checkLiveBook.bind(this)};CB.inherit(d,CB.EngineHostMode);CB.SimpleEngineModeMixin&&CB.mixin(d,CB.SimpleEngineModeMixin);d.prototype.onBestMove=function(){};d.prototype.createGUIElements=function(b){this.superClass.createGUIElements.call(this,
    b);b.shouldAnimatePosChange=this.shouldAnimatePosChange.bind(this);CB.System.isMobile()&&(b.animSteps={forMove:.1,forPosition:.1})};d.prototype.shouldAnimatePosChange=function(){return CB.System.runsOnChessBaseDomain()||!CB.System.isNonCrossDomainIE()};var b=new CB.Vr;d.prototype.getMoveEnterType=function(){return this.kernel.game.isLineEnd()||!V15.allowMoveEntryDialog()?CB.MoveEnterType.NEWLINE:CB.MoveEnterType.QUERY};d.prototype.onResetGame=function(){this.nBookTimeouts=0};d.prototype.playSolution=
    function(b){b=this.kernel.game.getCurPos();this.cmsiPos=b.toFEN();this.orgVideoId=this.videoid;b=V15.panelMgr.modules[0].cmsiManager.collectFiles(b);for(var c=0;c<b.length;c++)if(2==V15.panelMgr.modules[0].cmsiManager.extractStateFromFileName(b[c])){V15.panelMgr.loadNewOfflineVideo(0,b[c]);break}};d.prototype.onEnteredMove=function(b){if(this.posAskBestmove&&this.posAskBestmove.equals(this.kernel.game.getCurPos())){var c=CB.Square.getStr(b.from),d=CB.Square.getStr(b.to);V15.panelMgr.fnSendChat(0,
    "ABM:"+c+"-"+d)}this.saved=!1;(c=this.kernel.game.getAnno(CB.AnnoType.TRAINING))&&(d=this.kernel.game.getNextMove())&&d.from==b.from&&d.to==b.to&&(c.solved=!0,this.kernel.game.fireOnChanged());if(this.kernel.OfflineInteractive){c=this.kernel.game.getCurPos();this.cmsiPos=c.toFEN();this.orgVideoId=this.videoid;c=V15.panelMgr.modules[0].cmsiManager.collectFiles(c);d=!1;for(var g=0;g<c.length;g++){var h=V15.panelMgr.modules[0].cmsiManager.extractStateFromFileName(c[g]),k=V15.panelMgr.modules[0].cmsiManager.extractMoveFromFileName(c[g]);
    if(k.from==b.from&&k.to==b.to){d=!0;2!=h&&3!=h||V15.panelMgr.loadNewOfflineVideo(0,c[g]);break}}if(!d)return this.ShowMessage("Please try again"),this.restoreMoveEnterPosition(),this.videoid=this.orgVideoId,!1}this.kernel.Interactive&&(c=this.kernel.game.getCurPos(),this.cmsiPos=c.toFEN(),this.orgVideoId=this.videoid,d="",V15.isLoggedIn()&&V15.Vf.userName&&(d=V15.Vf.userName),this.baseurl=V15.config.getVideoPortalUris()[0],b=this.baseurl+"Replay/GetNextIdWithMove?id="+encodeURIComponent(this.videoid)+
    "&from="+b.from+"&to="+b.to+"&user="+encodeURIComponent(d)+"&fen="+encodeURIComponent(c.toFEN()),$.get(b,function(b){if(b){var c=b.ID,d=b.MSG;2<d.length?(this.ShowMessage(d),"4"==b.STATE&&(this.restoreMoveEnterPosition(),this.videoid=this.orgVideoId)):V15.panelMgr.loadNewVideo(0,c)}}.bind(this)));"undefined"!==typeof this.kernel.pluginCnt&&V15.panelMgr.stopAutoplay(this.kernel.pluginCnt);return!0};d.prototype.onAfterMoveEntry=function(b){this.kernel.PositionMode&&(b=this.kernel.game.getCurPos(),this.baseurl=
    V15.config.getVideoPortalUris()[0],b=this.baseurl+"Public/GetVideoSnippets?fen="+encodeURIComponent(b.toNormalizedFEN()),$.get(b,function(b){b&&(b=b.Snippets,b.length&&V15.panelMgr.loadNewVideo(0,b[0].Lecture))}.bind(this)))};d.prototype.restoreMoveEnterPosition=function(){var b=new CB.Position(this.cmsiPos);b=new CB.Game(b);this.kernel.game.assign(b);this.kernel.game.updateFromExtern()};d.prototype.ShowMessage=function(b){V15.panelMgr.showMessage(b);this.kernel.boardWin.addMessage(b,!0);(new CB.Timer(function(){this.kernel.boardWin.destroyMessage()}.bind(this))).runOnce(3E3)};
    d.prototype.canAnnotateLoadedGames=function(){return!0};d.prototype.isAnalysis=function(){return!0};d.prototype.beforeGameLoad=function(){this.saveAndReset();this.saved=!1};d.prototype.afterGameLoad=function(){this.kernel.gotoFirstTrainingPosition()};d.prototype.saveAndReset=function(){16<this.cntPosViews&&!this.statsSent&&!this.isAutoplay&&(this.statsSent=!0,CB.LogReplayed(this.kernel.game.hdr.getStrPlayers(!1,0),this.cntPosViews));this.saveToCloud(!0);this.cntPosViews=0;this.statsSent=!1};d.prototype.onExit=
        function(){this.saveAndReset()};d.prototype.updateGamePos=function(){this.isAutoplay||this.cntPosViews++;b.exec(function(){this.kernel.game.getCurPos().hasLegals()&&(this.goAll(),this.isAutoplay||this.fnCheckLiveBook())}.bind(this),300);if($("#txtGameId")[0]){var c=V15.panelMgr.socialMediaUrl+"/TextBoxValues/",d={Id:$("#txtGameId").val(),moveIndex:this.kernel.game.getMoveIndex()};$.ajax({url:c,method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",async:!1,data:JSON.stringify(d),
        success:function(b){b&&($("#txtEmbedCodeExample").val(b.EmbedGameCode),$("#txtEmbedCode").val(b.EmbedGameCode),$("#txtGameUrlExample").val(b.GameUrl),$("#txtCopyUrl").val(b.GameUrl))},error:function(b,c,d){V15.panelMgr.showAlert("Error updating GameUrl.",300,130)}})}};d.prototype.checkLiveBook=function(){this.shouldAccessLiveBook()?this.updatePos&&this.updatePos.equals(this.kernel.game.getCurPos())&&!this.kernel.forceTBUpdate||(this.updatePos=ObjUtil.clone(this.kernel.game.getCurPos()),V15.aTBLobby&&
    V15.aTBLobby.requestAllMoves(this.kernel.game.getCurPos(),!1,!1,this.kernel.ticket),!this.idLBListener&&V15.aTBLobby&&(this.idLBListener=V15.aTBLobby.addOnLiveBookListener(this.liveBookListener.bind(this))),!this.idTBListener&&V15.aTBLobby&&(this.idTBListener=V15.aTBLobby.addOnTBDataListener(this.tbDataListener.bind(this))),this.liveBookTimer.runOnce(5E3),this.kernel.forceTBUpdate=!1):V15.aTBLobby&&V15.aTBLobby.fireOnLiveBookDisplay({ticket:this.kernel.ticket,moves:[]})};d.prototype.shouldAccessLiveBook=
        function(){if(!this.blockLiveBook){var b=this.kernel.getCurPos();return 6<b.getPieces().length&&16>b.getPieces().length?!1:V15.aTBLobby&&V15.aTBLobby.isLoggedIn()&&(6>this.nBookTimeouts||10>this.kernel.game.getMoveNo())&&(60>this.kernel.game.getMoveNo()||6>=b.getPieces().length||2600<this.kernel.game.hdr.getMaxElo())}};d.prototype.liveBookListener=function(b){V15.aTBLobby&&V15.aTBLobby.fireOnLiveBookDisplay(b);this.liveBookTimer.stop();this.nBookTimeouts=0};d.prototype.tbDataListener=function(){};
    d.prototype.liveBookTimeout=function(){V15.panelMgr.tbBook&&V15.panelMgr.tbBook.setEmptyText(lm.FRESH_POSITION);this.nBookTimeouts++};d.prototype.saveToCloud=function(b){return V15.cloudMgr&&V15.cloudMgr.isLoggedIn()&&!this.saved&&(1<this.cntPosViews||b)?(this.kernel.game.getMainLine().length&&this.kernel.game.isNormalInit()&&(V15.cloudMgr.saveGameToClipboard(this.kernel.game),console.log(String.f("CloudClip Saved: "+this.kernel.game.hdr)),this.saved=!0),!0):!1};return d}();CB.ReaderCommandIds={TEST:4E3};
CB.V12=function(){var d=function(b){this.Vf=new CB.ClientParams("Reader");this.versionCode=new CB.VersionCode(CB.VersionCodeEnum.JSREADER,19,11,0);console.log(this.versionCode.toString());this.appName="reader.chessbase.com";this.appUrl="https://reader.chessbase.com";this.shortAppName="reader";this.appTitle="ChessBase PGN Reader";this.gameKernel={};this.setExternalCommonPath({pics:(-1==document.URL.search(/chessbase.com/i)||-1!=document.URL.search(/cloudserver/i))&&-1==document.URL.search(/localhost/i),
    engine:!0});this.initConfig()};CB.inherit(d,CB.ChessApp);CB.mixin(d,CB.AccountAppMixin);CB.mixin(d,CB.CloudAppMixin);d.prototype.initInstance=function(){this.superClass.initInstance.call(this);this.panelMgr=new CB.ReaderPluginManager;this.commandHandlerId=this.commands.registerCommandHandler(this);this.resultPostBack=new CB.ResultPostBack;CB.System.runsInIFrame()||(window.addEventListener("blur",onBlur),window.addEventListener("focus",onFocus),window.addEventListener("resize",onResize))};d.prototype.createLiveManager=
    function(){V15.lobby=new CB.Server.LiveManager;V15.lobby.createLobby(V15.config.getLiveUris(),"guest","",CB.LoginMode.GUEST);window.addEventListener("beforeunload",onBeforeUnload);window.addEventListener("unload",onBeforeUnload);window.addEventListener("blur",onBlur);window.addEventListener("focus",onFocus);document.addEventListener("visibilitychange",onVisibilityChange);V15.lobby.connect()};d.prototype.onLogin=function(b){this.setLoggedIn(1==b.ResultType)};d.prototype.exitInstance=function(){this.superClass.exitInstance.call(this)};
    d.prototype.isExtJS=function(){return!1};d.prototype.isBoardOnlyApp=function(){return!1};d.prototype.getAppSpecificCommandIds=function(){return CB.ReaderCommandIds};d.prototype.execCommand=function(b){return this.superClass.execCommand.apply(this,arguments)};d.prototype.initConfig=function(){this.config.liveBookIsPremium=!0;this.config.board2DBottomOffset=this.config.board2DTopOffset=Math.min(16,Math.max(4,window.innerHeight/50));this.config.silentCloud=!0;this.config.silentServers=!0;this.config.delayAudioInit=
        !0;this.config.diaStyleSuffix="";this.isSchachDe()&&(this.config.diaStyleSuffix="-blue",this.config.defaultBoardTextureId=this.config.forceBoardTextureId=CB.CommandIds.BOARD2D_BLUE,this.config.forcePieceStyleId=CB.CommandIds.PIECES2D_FRITZ)};d.prototype.isSchachDe=function(){return 0<=window.location.href.search("schach.de")||0<=window.location.href.search("playchess.com")};d.prototype.getAvailableLanguages=function(){return[CB.Language.DEU,CB.Language.ESP]};d.prototype.isPlugin=function(){return!0};
    d.prototype.getLocalizationArr=function(b){var c=this.superClass.getLocalizationArr.call(this,b);CB.Loc.Reader&&(CB.Loc.Reader[b]?c.push(CB.Loc.Reader[b]):c.push(CB.Loc.Reader.ENG));return c};return d}();var V15;function onBeforeUnload(d){V15.lobby&&(V15.lobby.logOff(),CB.Timer.busyWait(700));V15.exitInstance()}function onResize(){this.V15.panelMgr.onWindowResize()}
function onBlur(){V15.saveGameToLocalStorage();V15.lobby&&CB.System.isMobile()&&(V15.blurLogOffTimer=new CB.Timer(function(){V15.lobby&&V15.lobby.logOff();V15.logOffPlayerLobby()}),V15.blurLogOffTimer.runOnce(3E4))}
function onFocus(){V15.lobby&&(CB.System.isMobile()&&!V15.lobby.isConnected()&&V15.lobby.wasLoggedIn()&&(V15.lobby.reconnectUser(),V15.playerLobby&&!V15.playerLobby.isConnected()&&V15.playerLobby.wasLoggedIn()&&V15.playerLobby.reconnectUser()),V15.blurLogOffTimer&&V15.blurLogOffTimer.stop())}function onVisibilityChange(){V15.lobby&&document.visibilityState&&("hidden"==document.visibilityState?onBlur():"visible"==document.visibilityState&&onFocus())}
function activateProduct(){this.V15.panelMgr.activateTrainer()}function deactivateProduct(){this.V15.panelMgr.deactivateTrainer()}function checkHardware(){this.V15.panelMgr.checkHardware()}function senduserfeedback(){this.V15.panelMgr.feedbackProduct()}function onChangePage(){alert("OnChangePage")}function onShowExternalURL(d){this.V15.panelMgr.onOpenExternalURL(d)}function onRecreate(){this.V15.panelMgr.recreate()}function onDestroy(){this.V15.panelMgr.destroyAll()}"use strict";
(function(d){function b(){V15.exitInstance();V15.logOffPlayerLobby();V15.logOffTeraBrainLobby();V15.logOffOnlineLobby();V15.panelMgr.onLogOff();V15.saveGameToLocalStorage()}function c(){V15.panelMgr.onBlur();CB.System.isMobile();V15.saveGameToLocalStorage()}function e(){document.hidden&&c()}$(function(){var d=document.getElementById("bodytext");d&&document.body.removeChild(d);V15=new CB.V12;V15.initInstance();V15.panelMgr.hasPlugins&&(V15.connectTeraBrainLobby(),V15.connectOnlineDBLobby(!1),V15.connectPlayerLobby(!1));
    V15.panelMgr.createPanels();window.addEventListener("beforeunload",b);CB.LOG("User="+V15.Vf.userName,"","acc");CB.$(window).on("beforeunload",b).on("blur",c).on("visibilitychange",e);V15.isLive&&V15.createLiveManager();V15.tryLogin(V15.tokenLoginHandler.bind(V15))||V15.setLoggedIn(!1);V15.panelMgr.onReady();V15.aTBLobby&&(V15.aTBLobby.callOnConnect=function(){V15.panelMgr.onTeraBrainConnect()});CB.System.isMobile()&&CB.System.runsOnLiveChessBaseCom()&&(window.scrollTo(0,0),CB.System.requestFullScreen())})})(window);